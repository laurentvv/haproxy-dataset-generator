{"title": "Starter Guide", "content": "**version 3.2.13-3**\n\n\n\n", "url": "https://docs.haproxy.org/3.2/intro.html"}
{"title": "3.1. What HAProxy is and isn't", "content": "```\nHAProxy is :\n\n  - a TCP proxy : it can accept a TCP connection from a listening socket,\n    connect to a server and attach these sockets together allowing traffic to\n    flow in both directions; IPv4, IPv6 and even UNIX sockets are supported on\n    either side, so this can provide an easy way to translate addresses between\n    different families.\n\n  - an HTTP reverse-proxy (called a \"gateway\" in HTTP terminology) : it presents\n    itself as a server, receives HTTP requests over connections accepted on a\n    listening TCP socket, and passes the requests from these connections to\n    servers using different connections. It may use any combination of HTTP/1.x\n    or HTTP/2 on any side and will even automatically detect the protocol\n    spoken on each side when ALPN is used over TLS.\n\n  - an SSL terminator / initiator / offloader : SSL/TLS may be used on the\n    connection coming from the client, on the connection going to the server,\n    or even on both connections. A lot of settings can be applied per name\n    (SNI), and may be updated at runtime without restarting. Such setups are\n    extremely scalable and deployments involving tens to hundreds of thousands\n    of certificates were reported.\n\n  - a TCP normalizer : since connections are locally terminated by the operating\n    system, there is no relation between both sides, so abnormal traffic such as\n    invalid packets, flag combinations, window advertisements, sequence numbers,\n    incomplete connections (SYN floods), or so will not be passed to the other\n    side. This protects fragile TCP stacks from protocol attacks, and also\n    allows to optimize the connection parameters with the client without having\n    to modify the servers' TCP stack settings.\n\n  - an HTTP normalizer : when configured to process HTTP traffic, only valid\n    complete requests are passed. This protects against a lot of protocol-based\n    attacks. Additionally, protocol deviations for which there is a tolerance\n    in the specification are fixed so that they don't cause problem on the\n    servers (e.g. multiple-line headers).\n\n  - an HTTP fixing tool : it can modify / fix / add / remove / rewrite the URL\n    or any request or response header. This helps fixing interoperability issues\n    in complex environments.\n\n  - a content-based switch : it can consider any element from the request to\n    decide what server to pass the request or connection to. Thus it is possible\n    to handle multiple protocols over a same port (e.g. HTTP, HTTPS, SSH).\n\n  - a server load balancer : it can load balance TCP connections and HTTP\n    requests. In TCP mode, load balancing decisions are taken for the whole\n    connection. In HTTP mode, decisions are taken per request.\n\n  - a traffic regulator : it can apply some rate limiting at various points,\n    protect the servers against overloading, adjust traffic priorities based on\n    the contents, and even pass such information to lower layers and outer\n    network components by marking packets.\n\n  - a protection against DDoS and service abuse : it can maintain a wide number\n    of statistics per IP address, URL, cookie, etc and detect when an abuse is\n    happening, then take action (slow down the offenders, block them, send them\n    to outdated contents, etc).\n\n  - an observation point for network troubleshooting : due to the precision of\n    the information reported in logs, it is often used to narrow down some\n    network-related issues.\n\n  - an HTTP compression offloader : it can compress responses which were not\n    compressed by the server, thus reducing the page load time for clients with\n    poor connectivity or using high-latency, mobile networks.\n\n  - a caching proxy : it may cache responses in RAM so that subsequent requests\n    for the same object avoid the cost of another network transfer from the\n    server as long as the object remains present and valid. It will however not\n    store objects to any persistent storage. Please note that this caching\n    feature is designed to be maintenance free and focuses solely on saving\n    haproxy's precious resources and not on save the server's resources. Caches\n    designed to optimize servers require much more tuning and flexibility. If\n    you instead need such an advanced cache, please use Varnish Cache, which\n    integrates perfectly with haproxy, especially when SSL/TLS is needed on any\n    side.\n\n  - a FastCGI gateway : FastCGI can be seen as a different representation of\n    HTTP, and as such, HAProxy can directly load-balance a farm comprising any\n    combination of FastCGI application servers without requiring to insert\n    another level of gateway between them. This results in resource savings and\n    a reduction of maintenance costs.\n\nHAProxy is not :\n\n  - an explicit HTTP proxy, i.e. the proxy that browsers use to reach the\n    internet. There are excellent open-source software dedicated for this task,\n    such as Squid. However HAProxy can be installed in front of such a proxy to\n    provide load balancing and high availability.\n\n  - a data scrubber : it will not modify the body of requests nor responses.\n\n  - a static web server : during startup, it isolates itself inside a chroot\n    jail and drops its privileges, so that it will not perform any single file-\n    system access once started. As such it cannot be turned into a static web\n    server (dynamic servers are supported through FastCGI however). There are\n    excellent open-source software for this such as Apache or Nginx, and\n    HAProxy can be easily installed in front of them to provide load balancing,\n    high availability and acceleration.\n\n  - a packet-based load balancer : it will not see IP packets nor UDP datagrams,\n    will not perform NAT or even less DSR. These are tasks for lower layers.\n    Some kernel-based components such as IPVS (Linux Virtual Server) already do\n    this pretty well and complement perfectly with HAProxy.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/intro.html"}
{"title": "3.2. How HAProxy works", "content": "```\nHAProxy is an event-driven, non-blocking engine combining a very fast I/O layer\nwith a priority-based, multi-threaded scheduler. As it is designed with a data\nforwarding goal in mind, its architecture is optimized to move data as fast as\npossible with the least possible operations. It focuses on optimizing the CPU\ncache's efficiency by sticking connections to the same CPU as long as possible.\nAs such it implements a layered model offering bypass mechanisms at each level\nensuring data doesn't reach higher levels unless needed. Most of the processing\nis performed in the kernel, and HAProxy does its best to help the kernel do the\nwork as fast as possible by giving some hints or by avoiding certain operation\nwhen it guesses they could be grouped later. As a result, typical figures show\n15% of the processing time spent in HAProxy versus 85% in the kernel in TCP or\nHTTP close mode, and about 30% for HAProxy versus 70% for the kernel in HTTP\nkeep-alive mode.\n\nA single process can run many proxy instances; configurations as large as\n300000 distinct proxies in a single process were reported to run fine. A single\ncore, single CPU setup is far more than enough for more than 99% users, and as\nsuch, users of containers and virtual machines are encouraged to use the\nabsolute smallest images they can get to save on operational costs and simplify\ntroubleshooting. However the machine HAProxy runs on must never ever swap, and\nits CPU must not be artificially throttled (sub-CPU allocation in hypervisors)\nnor be shared with compute-intensive processes which would induce a very high\ncontext-switch latency.\n\nThreading allows to exploit all available processing capacity by using one\nthread per CPU core. This is mostly useful for SSL or when data forwarding\nrates above 40 Gbps are needed. In such cases it is critically important to\navoid communications between multiple physical CPUs, which can cause strong\nbottlenecks in the network stack and in HAProxy itself. While counter-intuitive\nto some, the first thing to do when facing some performance issues is often to\nreduce the number of CPUs HAProxy runs on.\n\nHAProxy only requires the haproxy executable and a configuration file to run.\nFor logging it is highly recommended to have a properly configured syslog daemon\nand log rotations in place. Logs may also be sent to stdout/stderr, which can be\nuseful inside containers. The configuration files are parsed before starting,\nthen HAProxy tries to bind all listening sockets, and refuses to start if\nanything fails. Past this point it cannot fail anymore. This means that there\nare no runtime failures and that if it accepts to start, it will work until it\nis stopped.\n\nOnce HAProxy is started, it does exactly 3 things :\n\n  - process incoming connections;\n\n  - periodically check the servers' status (known as health checks);\n\n  - exchange information with other haproxy nodes.\n\nProcessing incoming connections is by far the most complex task as it depends\non a lot of configuration possibilities, but it can be summarized as the 9 steps\nbelow :\n\n  - accept incoming connections from listening sockets that belong to a\n    configuration entity known as a \"frontend\", which references one or multiple\n    listening addresses;\n\n  - apply the frontend-specific processing rules to these connections that may\n    result in blocking them, modifying some headers, or intercepting them to\n    execute some internal applets such as the statistics page or the CLI;\n\n  - pass these incoming connections to another configuration entity representing\n    a server farm known as a \"backend\", which contains the list of servers and\n    the load balancing strategy for this server farm;\n\n  - apply the backend-specific processing rules to these connections;\n\n  - decide which server to forward the connection to according to the load\n    balancing strategy;\n\n  - apply the backend-specific processing rules to the response data;\n\n  - apply the frontend-specific processing rules to the response data;\n\n  - emit a log to report what happened in fine details;\n\n  - in HTTP, loop back to the second step to wait for a new request, otherwise\n    close the connection.\n\nFrontends and backends are sometimes considered as half-proxies, since they only\nlook at one side of an end-to-end connection; the frontend only cares about the\nclients while the backend only cares about the servers. HAProxy also supports\nfull proxies which are exactly the union of a frontend and a backend. When HTTP\nprocessing is desired, the configuration will generally be split into frontends\nand backends as they open a lot of possibilities since any frontend may pass a\nconnection to any backend. With TCP-only proxies, using frontends and backends\nrarely provides a benefit and the configuration can be more readable with full\nproxies.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/intro.html"}
{"title": "3.3. Basic features", "content": "```\nThis section will enumerate a number of features that HAProxy implements, some\nof which are generally expected from any modern load balancer, and some of\nwhich are a direct benefit of HAProxy's architecture. More advanced features\nwill be detailed in the next section.\n\n```\n\n### [3.3.1.](#3.3.1)Basic features : Proxying\n\n```\nProxying is the action of transferring data between a client and a server over\ntwo independent connections. The following basic features are supported by\nHAProxy regarding proxying and connection management :\n\n  - Provide the server with a clean connection to protect them against any\n    client-side defect or attack;\n\n  - Listen to multiple IP addresses and/or ports, even port ranges;\n\n  - Transparent accept : intercept traffic targeting any arbitrary IP address\n    that doesn't even belong to the local system;\n\n  - Server port doesn't need to be related to listening port, and may even be\n    translated by a fixed offset (useful with ranges);\n\n  - Transparent connect : spoof the client's (or any) IP address if needed\n    when connecting to the server;\n\n  - Provide a reliable return IP address to the servers in multi-site LBs;\n\n  - Offload the server thanks to buffers and possibly short-lived connections\n    to reduce their concurrent connection count and their memory footprint;\n\n  - Optimize TCP stacks (e.g. SACK), congestion control, and reduce RTT impacts;\n\n  - Support different protocol families on both sides (e.g. IPv4/IPv6/Unix);\n\n  - Timeout enforcement : HAProxy supports multiple levels of timeouts depending\n    on the stage the connection is, so that a dead client or server, or an\n    attacker cannot be granted resources for too long;\n\n  - Protocol validation: HTTP, SSL, or payload are inspected and invalid\n    protocol elements are rejected, unless instructed to accept them anyway;\n\n  - Policy enforcement : ensure that only what is allowed may be forwarded;\n\n  - Both incoming and outgoing connections may be limited to certain network\n    namespaces (Linux only), making it easy to build a cross-container,\n    multi-tenant load balancer;\n\n  - PROXY protocol presents the client's IP address to the server even for\n    non-HTTP traffic. This is an HAProxy extension that was adopted by a number\n    of third-party products by now, at least these ones at the time of writing :\n      - client : haproxy, stud, stunnel, exaproxy, ELB, squid\n      - server : haproxy, stud, postfix, exim, nginx, squid, node.js, varnish\n\n```\n\n### [3.3.2.](#3.3.2)Basic features : SSL\n\n```\nHAProxy's SSL stack is recognized as one of the most featureful according to\nGoogle's engineers (http://istlsfastyet.com/). The most commonly used features\nmaking it quite complete are :\n\n  - SNI-based multi-hosting with no limit on sites count and focus on\n    performance. At least one deployment is known for running 50000 domains\n    with their respective certificates;\n\n  - support for wildcard certificates reduces the need for many certificates ;\n\n  - certificate-based client authentication with configurable policies on\n    failure to present a valid certificate. This allows to present a different\n    server farm to regenerate the client certificate for example;\n\n  - authentication of the backend server ensures the backend server is the real\n    one and not a man in the middle;\n\n  - authentication with the backend server lets the backend server know it's\n    really the expected haproxy node that is connecting to it;\n\n  - TLS NPN and ALPN extensions make it possible to reliably offload SPDY/HTTP2\n    connections and pass them in clear text to backend servers;\n\n  - OCSP stapling further reduces first page load time by delivering inline an\n    OCSP response when the client requests a Certificate Status Request;\n\n  - Dynamic record sizing provides both high performance and low latency, and\n    significantly reduces page load time by letting the browser start to fetch\n    new objects while packets are still in flight;\n\n  - permanent access to all relevant SSL/TLS layer information for logging,\n    access control, reporting etc. These elements can be embedded into HTTP\n    header or even as a PROXY protocol extension so that the offloaded server\n    gets all the information it would have had if it performed the SSL\n    termination itself.\n\n  - Detect, log and block certain known attacks even on vulnerable SSL libs,\n    such as the Heartbleed attack affecting certain versions of OpenSSL.\n\n  - support for stateless session resumption (RFC 5077 TLS Ticket extension).\n    TLS tickets can be updated from CLI which provides them means to implement\n    Perfect Forward Secrecy by frequently rotating the tickets.\n\n```\n\n### [3.3.3.](#3.3.3)Basic features : Monitoring\n\n```\nHAProxy focuses a lot on availability. As such it cares about servers state,\nand about reporting its own state to other network components :\n\n  - Servers' state is continuously monitored using per-server parameters. This\n    ensures the path to the server is operational for regular traffic;\n\n  - Health checks support two hysteresis for up and down transitions in order\n    to protect against state flapping;\n\n  - Checks can be sent to a different address/port/protocol : this makes it\n    easy to check a single service that is considered representative of multiple\n    ones, for example the HTTPS port for an HTTP+HTTPS server.\n\n  - Servers can track other servers and go down simultaneously : this ensures\n    that servers hosting multiple services can fail atomically and that no one\n    will be sent to a partially failed server;\n\n  - Agents may be deployed on the server to monitor load and health : a server\n    may be interested in reporting its load, operational status, administrative\n    status independently from what health checks can see. By running a simple\n    agent on the server, it's possible to consider the server's view of its own\n    health in addition to the health checks validating the whole path;\n\n  - Various check methods are available : TCP connect, HTTP request, SMTP hello,\n    SSL hello, LDAP, SQL, Redis, send/expect scripts, all with/without SSL;\n\n  - State change is notified in the logs and stats page with the failure reason\n    (e.g. the HTTP response received at the moment the failure was detected). An\n    e-mail can also be sent to a configurable address upon such a change ;\n\n  - Server state is also reported on the stats interface and can be used to take\n    routing decisions so that traffic may be sent to different farms depending\n    on their sizes and/or health (e.g. loss of an inter-DC link);\n\n  - HAProxy can use health check requests to pass information to the servers,\n    such as their names, weight, the number of other servers in the farm etc.\n    so that servers can adjust their response and decisions based on this\n    knowledge (e.g. postpone backups to keep more CPU available);\n\n  - Servers can use health checks to report more detailed state than just on/off\n    (e.g. I would like to stop, please stop sending new visitors);\n\n  - HAProxy itself can report its state to external components such as routers\n    or other load balancers, allowing to build very complete multi-path and\n    multi-layer infrastructures.\n\n```\n\n### [3.3.4.](#3.3.4)Basic features : High availability\n\n```\nJust like any serious load balancer, HAProxy cares a lot about availability to\nensure the best global service continuity :\n\n  - Only valid servers are used ; the other ones are automatically evicted from\n    load balancing farms ; under certain conditions it is still possible to\n    force to use them though;\n\n  - Support for a graceful shutdown so that it is possible to take servers out\n    of a farm without affecting any connection;\n\n  - Backup servers are automatically used when active servers are down and\n    replace them so that sessions are not lost when possible. This also allows\n    to build multiple paths to reach the same server (e.g. multiple interfaces);\n\n  - Ability to return a global failed status for a farm when too many servers\n    are down. This, combined with the monitoring capabilities makes it possible\n    for an upstream component to choose a different LB node for a given service;\n\n  - Stateless design makes it easy to build clusters : by design, HAProxy does\n    its best to ensure the highest service continuity without having to store\n    information that could be lost in the event of a failure. This ensures that\n    a takeover is the most seamless possible;\n\n  - Integrates well with standard VRRP daemon keepalived : HAProxy easily tells\n    keepalived about its state and copes very well with floating virtual IP\n    addresses. Note: only use IP redundancy protocols (VRRP/CARP) over cluster-\n    based solutions (Heartbeat, ...) as they're the ones offering the fastest,\n    most seamless, and most reliable switchover.\n\n```\n\n### [3.3.5.](#3.3.5)Basic features : Load balancing\n\n```\nHAProxy offers a fairly complete set of load balancing features, most of which\nare unfortunately not available in a number of other load balancing products :\n\n  - no less than 10 load balancing algorithms are supported, some of which apply\n    to input data to offer an infinite list of possibilities. The most common\n    ones are round-robin (for short connections, pick each server in turn),\n    leastconn (for long connections, pick the least recently used of the servers\n    with the lowest connection count), source (for SSL farms or terminal server\n    farms, the server directly depends on the client's source address), URI (for\n    HTTP caches, the server directly depends on the HTTP URI), hdr (the server\n    directly depends on the contents of a specific HTTP header field), first\n    (for short-lived virtual machines, all connections are packed on the\n    smallest possible subset of servers so that unused ones can be powered\n    down);\n\n  - all algorithms above support per-server weights so that it is possible to\n    accommodate from different server generations in a farm, or direct a small\n    fraction of the traffic to specific servers (debug mode, running the next\n    version of the software, etc);\n\n  - dynamic weights are supported for round-robin, leastconn and consistent\n    hashing ; this allows server weights to be modified on the fly from the CLI\n    or even by an agent running on the server;\n\n  - slow-start is supported whenever a dynamic weight is supported; this allows\n    a server to progressively take the traffic. This is an important feature\n    for fragile application servers which require to compile classes at runtime\n    as well as cold caches which need to fill up before being run at full\n    throttle;\n\n  - hashing can apply to various elements such as client's source address, URL\n    components, query string element, header field values, POST parameter, RDP\n    cookie;\n\n  - consistent hashing protects server farms against massive redistribution when\n    adding or removing servers in a farm. That's very important in large cache\n    farms and it allows slow-start to be used to refill cold caches;\n\n  - a number of internal metrics such as the number of connections per server,\n    per backend, the amount of available connection slots in a backend etc makes\n    it possible to build very advanced load balancing strategies.\n\n```\n\n### [3.3.6.](#3.3.6)Basic features : Stickiness\n\n```\nApplication load balancing would be useless without stickiness. HAProxy provides\na fairly comprehensive set of possibilities to maintain a visitor on the same\nserver even across various events such as server addition/removal, down/up\ncycles, and some methods are designed to be resistant to the distance between\nmultiple load balancing nodes in that they don't require any replication :\n\n  - stickiness information can be individually matched and learned from\n    different places if desired. For example a JSESSIONID cookie may be matched\n    both in a cookie and in the URL. Up to 8 parallel sources can be learned at\n    the same time and each of them may point to a different stick-table;\n\n  - stickiness information can come from anything that can be seen within a\n    request or response, including source address, TCP payload offset and\n    length, HTTP query string elements, header field values, cookies, and so\n    on.\n\n  - stick-tables are replicated between all nodes in a multi-master fashion;\n\n  - commonly used elements such as SSL-ID or RDP cookies (for TSE farms) are\n    directly accessible to ease manipulation;\n\n  - all sticking rules may be dynamically conditioned by ACLs;\n\n  - it is possible to decide not to stick to certain servers, such as backup\n    servers, so that when the nominal server comes back, it automatically takes\n    the load back. This is often used in multi-path environments;\n\n  - in HTTP it is often preferred not to learn anything and instead manipulate\n    a cookie dedicated to stickiness. For this, it's possible to detect,\n    rewrite, insert or prefix such a cookie to let the client remember what\n    server was assigned;\n\n  - the server may decide to change or clean the stickiness cookie on logout,\n    so that leaving visitors are automatically unbound from the server;\n\n  - using ACL-based rules it is also possible to selectively ignore or enforce\n    stickiness regardless of the server's state; combined with advanced health\n    checks, that helps admins verify that the server they're installing is up\n    and running before presenting it to the whole world;\n\n  - an innovative mechanism to set a maximum idle time and duration on cookies\n    ensures that stickiness can be smoothly stopped on devices which are never\n    closed (smartphones, TVs, home appliances) without having to store them on\n    persistent storage;\n\n  - multiple server entries may share the same stickiness keys so that\n    stickiness is not lost in multi-path environments when one path goes down;\n\n  - soft-stop ensures that only users with stickiness information will continue\n    to reach the server they've been assigned to but no new users will go there.\n\n```\n\n### [3.3.7.](#3.3.7)Basic features : Logging\n\n```\nLogging is an extremely important feature for a load balancer, first because a\nload balancer is often wrongly accused of causing the problems it reveals, and\nsecond because it is placed at a critical point in an infrastructure where all\nnormal and abnormal activity needs to be analyzed and correlated with other\ncomponents.\n\nHAProxy provides very detailed logs, with millisecond accuracy and the exact\nconnection accept time that can be searched in firewalls logs (e.g. for NAT\ncorrelation). By default, TCP and HTTP logs are quite detailed and contain\neverything needed for troubleshooting, such as source IP address and port,\nfrontend, backend, server, timers (request receipt duration, queue duration,\nconnection setup time, response headers time, data transfer time), global\nprocess state, connection counts, queue status, retries count, detailed\nstickiness actions and disconnect reasons, header captures with a safe output\nencoding. It is then possible to extend or replace this format to include any\nsampled data, variables, captures, resulting in very detailed information. For\nexample it is possible to log the number of cumulative requests or number of\ndifferent URLs visited by a client.\n\nThe log level may be adjusted per request using standard ACLs, so it is possible\nto automatically silent some logs considered as pollution and instead raise\nwarnings when some abnormal behavior happen for a small part of the traffic\n(e.g. too many URLs or HTTP errors for a source address). Administrative logs\nare also emitted with their own levels to inform about the loss or recovery of a\nserver for example.\n\nEach frontend and backend may use multiple independent log outputs, which eases\nmulti-tenancy. Logs are preferably sent over UDP, maybe JSON-encoded, and are\ntruncated after a configurable line length in order to guarantee delivery. But\nit is also possible to send them to stdout/stderr or any file descriptor, as\nwell as to a ring buffer that a client can subscribe to in order to retrieve\nthem.\n\n```\n\n### [3.3.8.](#3.3.8)Basic features : Statistics\n\n```\nHAProxy provides a web-based statistics reporting interface with authentication,\nsecurity levels and scopes. It is thus possible to provide each hosted customer\nwith his own page showing only his own instances. This page can be located in a\nhidden URL part of the regular web site so that no new port needs to be opened.\nThis page may also report the availability of other HAProxy nodes so that it is\neasy to spot if everything works as expected at a glance. The view is synthetic\nwith a lot of details accessible (such as error causes, last access and last\nchange duration, etc), which are also accessible as a CSV table that other tools\nmay import to draw graphs. The page may self-refresh to be used as a monitoring\npage on a large display. In administration mode, the page also allows to change\nserver state to ease maintenance operations.\n\nA Prometheus exporter is also provided so that the statistics can be consumed\nin a different format depending on the deployment.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/intro.html"}
{"title": "3.4. Standard features", "content": "```\nIn this section, some features that are very commonly used in HAProxy but are\nnot necessarily present on other load balancers are enumerated.\n\n```\n\n### [3.4.1.](#3.4.1)Standard features : Sampling and converting information\n\n```\nHAProxy supports information sampling using a wide set of \"sample fetch\nfunctions\". The principle is to extract pieces of information known as samples,\nfor immediate use. This is used for stickiness, to build conditions, to produce\ninformation in logs or to enrich HTTP headers.\n\nSamples can be fetched from various sources :\n\n  - constants : integers, strings, IP addresses, binary blocks;\n\n  - the process : date, environment variables, server/frontend/backend/process\n    state, byte/connection counts/rates, queue length, random generator, ...\n\n  - variables : per-session, per-request, per-response variables;\n\n  - the client connection : source and destination addresses and ports, and all\n    related statistics counters;\n\n  - the SSL client session : protocol, version, algorithm, cipher, key size,\n    session ID, all client and server certificate fields, certificate serial,\n    SNI, ALPN, NPN, client support for certain extensions;\n\n  - request and response buffers contents : arbitrary payload at offset/length,\n    data length, RDP cookie, decoding of SSL hello type, decoding of TLS SNI;\n\n  - HTTP (request and response) : method, URI, path, query string arguments,\n    status code, headers values, positional header value, cookies, captures,\n    authentication, body elements;\n\nA sample may then pass through a number of operators known as \"converters\" to\nexperience some transformation. A converter consumes a sample and produces a\nnew one, possibly of a completely different type. For example, a converter may\nbe used to return only the integer length of the input string, or could turn a\nstring to upper case. Any arbitrary number of converters may be applied in\nseries to a sample before final use. Among all available sample converters, the\nfollowing ones are the most commonly used :\n\n  - arithmetic and logic operators : they make it possible to perform advanced\n    computation on input data, such as computing ratios, percentages or simply\n    converting from one unit to another one;\n\n  - IP address masks are useful when some addresses need to be grouped by larger\n    networks;\n\n  - data representation : URL-decode, base64, hex, JSON strings, hashing;\n\n  - string conversion : extract substrings at fixed positions, fixed length,\n    extract specific fields around certain delimiters, extract certain words,\n    change case, apply regex-based substitution;\n\n  - date conversion : convert to HTTP date format, convert local to UTC and\n    conversely, add or remove offset;\n\n  - lookup an entry in a stick table to find statistics or assigned server;\n\n  - map-based key-to-value conversion from a file (mostly used for geolocation).\n\n```\n\n### [3.4.2.](#3.4.2)Standard features : Maps\n\n```\nMaps are a powerful type of converter consisting in loading a two-columns file\ninto memory at boot time, then looking up each input sample from the first\ncolumn and either returning the corresponding pattern on the second column if\nthe entry was found, or returning a default value. The output information also\nbeing a sample, it can in turn experience other transformations including other\nmap lookups. Maps are most commonly used to translate the client's IP address\nto an AS number or country code since they support a longest match for network\naddresses but they can be used for various other purposes.\n\nPart of their strength comes from being updatable on the fly either from the CLI\nor from certain actions using other samples, making them capable of storing and\nretrieving information between subsequent accesses. Another strength comes from\nthe binary tree based indexation which makes them extremely fast even when they\ncontain hundreds of thousands of entries, making geolocation very cheap and easy\nto set up.\n\n```\n\n### [3.4.3.](#3.4.3)Standard features : ACLs and conditions\n\n```\nMost operations in HAProxy can be made conditional. Conditions are built by\ncombining multiple ACLs using logic operators (AND, OR, NOT). Each ACL is a\nseries of tests based on the following elements :\n\n  - a sample fetch method to retrieve the element to test ;\n\n  - an optional series of converters to transform the element ;\n\n  - a list of patterns to match against ;\n\n  - a matching method to indicate how to compare the patterns with the sample\n\nFor example, the sample may be taken from the HTTP \"Host\" header, it could then\nbe converted to lower case, then matched against a number of regex patterns\nusing the regex matching method.\n\nTechnically, ACLs are built on the same core as the maps, they share the exact\nsame internal structure, pattern matching methods and performance. The only real\ndifference is that instead of returning a sample, they only return \"found\" or\nor \"not found\". In terms of usage, ACL patterns may be declared inline in the\nconfiguration file and do not require their own file. ACLs may be named for ease\nof use or to make configurations understandable. A named ACL may be declared\nmultiple times and it will evaluate all definitions in turn until one matches.\n\nAbout 13 different pattern matching methods are provided, among which IP address\nmask, integer ranges, substrings, regex. They work like functions, and just like\nwith any programming language, only what is needed is evaluated, so when a\ncondition involving an OR is already true, next ones are not evaluated, and\nsimilarly when a condition involving an AND is already false, the rest of the\ncondition is not evaluated.\n\nThere is no practical limit to the number of declared ACLs, and a handful of\ncommonly used ones are provided. However experience has shown that setups using\na lot of named ACLs are quite hard to troubleshoot and that sometimes using\nanonymous ACLs inline is easier as it requires less references out of the scope\nbeing analyzed.\n\n```\n\n### [3.4.4.](#3.4.4)Standard features : Content switching\n\n```\nHAProxy implements a mechanism known as content-based switching. The principle\nis that a connection or request arrives on a frontend, then the information\ncarried with this request or connection are processed, and at this point it is\npossible to write ACLs-based conditions making use of these information to\ndecide what backend will process the request. Thus the traffic is directed to\none backend or another based on the request's contents. The most common example\nconsists in using the Host header and/or elements from the path (sub-directories\nor file-name extensions) to decide whether an HTTP request targets a static\nobject or the application, and to route static objects traffic to a backend made\nof fast and light servers, and all the remaining traffic to a more complex\napplication server, thus constituting a fine-grained virtual hosting solution.\nThis is quite convenient to make multiple technologies coexist as a more global\nsolution.\n\nAnother use case of content-switching consists in using different load balancing\nalgorithms depending on various criteria. A cache may use a URI hash while an\napplication would use round-robin.\n\nLast but not least, it allows multiple customers to use a small share of a\ncommon resource by enforcing per-backend (thus per-customer connection limits).\n\nContent switching rules scale very well, though their performance may depend on\nthe number and complexity of the ACLs in use. But it is also possible to write\ndynamic content switching rules where a sample value directly turns into a\nbackend name and without making use of ACLs at all. Such configurations have\nbeen reported to work fine at least with 300000 backends in production.\n\n```\n\n### [3.4.5.](#3.4.5)Standard features : Stick-tables\n\n```\nStick-tables are commonly used to store stickiness information, that is, to keep\na reference to the server a certain visitor was directed to. The key is then the\nidentifier associated with the visitor (its source address, the SSL ID of the\nconnection, an HTTP or RDP cookie, the customer number extracted from the URL or\nfrom the payload, ...) and the stored value is then the server's identifier.\n\nStick tables may use 3 different types of samples for their keys : integers,\nstrings and addresses. Only one stick-table may be referenced in a proxy, and it\nis designated everywhere with the proxy name. Up to 8 keys may be tracked in\nparallel. The server identifier is committed during request or response\nprocessing once both the key and the server are known.\n\nStick-table contents may be replicated in active-active mode with other HAProxy\nnodes known as \"peers\" as well as with the new process during a reload operation\nso that all load balancing nodes share the same information and take the same\nrouting decision if client's requests are spread over multiple nodes.\n\nSince stick-tables are indexed on what allows to recognize a client, they are\noften also used to store extra information such as per-client statistics. The\nextra statistics take some extra space and need to be explicitly declared. The\ntype of statistics that may be stored includes the input and output bandwidth,\nthe number of concurrent connections, the connection rate and count over a\nperiod, the amount and frequency of errors, some specific tags and counters,\netc. In order to support keeping such information without being forced to\nstick to a given server, a special \"tracking\" feature is implemented and allows\nto track up to 3 simultaneous keys from different tables at the same time\nregardless of stickiness rules. Each stored statistics may be searched, dumped\nand cleared from the CLI and adds to the live troubleshooting capabilities.\n\nWhile this mechanism can be used to surclass a returning visitor or to adjust\nthe delivered quality of service depending on good or bad behavior, it is\nmostly used to fight against service abuse and more generally DDoS as it allows\nto build complex models to detect certain bad behaviors at a high processing\nspeed.\n\n```\n\n### [3.4.6.](#3.4.6)Standard features : Formatted strings\n\n```\nThere are many places where HAProxy needs to manipulate character strings, such\nas logs, redirects, header additions, and so on. In order to provide the\ngreatest flexibility, the notion of Formatted strings was introduced, initially\nfor logging purposes, which explains why it's still called \"log-format\". These\nstrings contain escape characters allowing to introduce various dynamic data\nincluding variables and sample fetch expressions into strings, and even to\nadjust the encoding while the result is being turned into a string (for example,\nadding quotes). This provides a powerful way to build header contents, to build\nresponse data or even response templates, or to customize log lines.\nAdditionally, in order to remain simple to build most common strings, about 50\nspecial tags are provided as shortcuts for information commonly used in logs.\n\n```\n\n### [3.4.7.](#3.4.7)Standard features : HTTP rewriting and redirection\n\n```\nInstalling a load balancer in front of an application that was never designed\nfor this can be a challenging task without the proper tools. One of the most\ncommonly requested operation in this case is to adjust requests and response\nheaders to make the load balancer appear as the origin server and to fix hard\ncoded information. This comes with changing the path in requests (which is\nstrongly advised against), modifying Host header field, modifying the Location\nresponse header field for redirects, modifying the path and domain attribute\nfor cookies, and so on. It also happens that a number of servers are somewhat\nverbose and tend to leak too much information in the response, making them more\nvulnerable to targeted attacks. While it's theoretically not the role of a load\nbalancer to clean this up, in practice it's located at the best place in the\ninfrastructure to guarantee that everything is cleaned up.\n\nSimilarly, sometimes the load balancer will have to intercept some requests and\nrespond with a redirect to a new target URL. While some people tend to confuse\nredirects and rewriting, these are two completely different concepts, since the\nrewriting makes the client and the server see different things (and disagree on\nthe location of the page being visited) while redirects ask the client to visit\nthe new URL so that it sees the same location as the server.\n\nIn order to do this, HAProxy supports various possibilities for rewriting and\nredirects, among which :\n\n  - regex-based URL and header rewriting in requests and responses. Regex are\n    the most commonly used tool to modify header values since they're easy to\n    manipulate and well understood;\n\n  - headers may also be appended, deleted or replaced based on formatted strings\n    so that it is possible to pass information there (e.g. client side TLS\n    algorithm and cipher);\n\n  - HTTP redirects can use any 3xx code to a relative, absolute, or completely\n    dynamic (formatted string) URI;\n\n  - HTTP redirects also support some extra options such as setting or clearing\n    a specific cookie, dropping the query string, appending a slash if missing,\n    and so on;\n\n  - a powerful \"return\" directive allows to customize every part of a response\n    like status, headers, body using dynamic contents or even template files.\n\n  - all operations support ACL-based conditions;\n\n```\n\n### [3.4.8.](#3.4.8)Standard features : Server protection\n\n```\nHAProxy does a lot to maximize service availability, and for this it takes\nlarge efforts to protect servers against overloading and attacks. The first\nand most important point is that only complete and valid requests are forwarded\nto the servers. The initial reason is that HAProxy needs to find the protocol\nelements it needs to stay synchronized with the byte stream, and the second\nreason is that until the request is complete, there is no way to know if some\nelements will change its semantics. The direct benefit from this is that servers\nare not exposed to invalid or incomplete requests. This is a very effective\nprotection against slowloris attacks, which have almost no impact on HAProxy.\n\nAnother important point is that HAProxy contains buffers to store requests and\nresponses, and that by only sending a request to a server when it's complete and\nby reading the whole response very quickly from the local network, the server\nside connection is used for a very short time and this preserves server\nresources as much as possible.\n\nA direct extension to this is that HAProxy can artificially limit the number of\nconcurrent connections or outstanding requests to a server, which guarantees\nthat the server will never be overloaded even if it continuously runs at 100% of\nits capacity during traffic spikes. All excess requests will simply be queued to\nbe processed when one slot is released. In the end, this huge resource savings\nmost often ensures so much better server response times that it ends up actually\nbeing faster than by overloading the server. Queued requests may be redispatched\nto other servers, or even aborted in queue when the client aborts, which also\nprotects the servers against the \"reload effect\", where each click on \"reload\"\nby a visitor on a slow-loading page usually induces a new request and maintains\nthe server in an overloaded state.\n\nThe slow-start mechanism also protects restarting servers against high traffic\nlevels while they're still finalizing their startup or compiling some classes.\n\nRegarding the protocol-level protection, it is possible to relax the HTTP parser\nto accept non standard-compliant but harmless requests or responses and even to\nfix them. This allows bogus applications to be accessible while a fix is being\ndeveloped. In parallel, offending messages are completely captured with a\ndetailed report that help developers spot the issue in the application. The most\ndangerous protocol violations are properly detected and dealt with and fixed.\nFor example malformed requests or responses with two Content-length headers are\neither fixed if the values are exactly the same, or rejected if they differ,\nsince it becomes a security problem. Protocol inspection is not limited to HTTP,\nit is also available for other protocols like TLS or RDP.\n\nWhen a protocol violation or attack is detected, there are various options to\nrespond to the user, such as returning the common \"HTTP 400 bad request\",\nclosing the connection with a TCP reset, or faking an error after a long delay\n(\"tarpit\") to confuse the attacker. All of these contribute to protecting the\nservers by discouraging the offending client from pursuing an attack that\nbecomes very expensive to maintain.\n\nHAProxy also proposes some more advanced options to protect against accidental\ndata leaks and session crossing. Not only it can log suspicious server responses\nbut it will also log and optionally block a response which might affect a given\nvisitors' confidentiality. One such example is a cacheable cookie appearing in a\ncacheable response and which may result in an intermediary cache to deliver it\nto another visitor, causing an accidental session sharing.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/intro.html"}
{"title": "3.5. Advanced features", "content": "### [3.5.1.](#3.5.1)Advanced features : Management\n\n```\nHAProxy is designed to remain extremely stable and safe to manage in a regular\nproduction environment. It is provided as a single executable file which doesn't\nrequire any installation process. Multiple versions can easily coexist, meaning\nthat it's possible (and recommended) to upgrade instances progressively by\norder of importance instead of migrating all of them at once. Configuration\nfiles are easily versioned. Configuration checking is done off-line so it\ndoesn't require to restart a service that will possibly fail. During\nconfiguration checks, a number of advanced mistakes may be detected (e.g. a rule\nhiding another one, or stickiness that will not work) and detailed warnings and\nconfiguration hints are proposed to fix them. Backwards configuration file\ncompatibility goes very far away in time, with version 1.5 still fully\nsupporting configurations for versions 1.1 written 13 years before, and 1.6\nonly dropping support for almost unused, obsolete keywords that can be done\ndifferently. The configuration and software upgrade mechanism is smooth and non\ndisruptive in that it allows old and new processes to coexist on the system,\neach handling its own connections. System status, build options, and library\ncompatibility are reported on startup.\n\nSome advanced features allow an application administrator to smoothly stop a\nserver, detect when there's no activity on it anymore, then take it off-line,\nstop it, upgrade it and ensure it doesn't take any traffic while being upgraded,\nthen test it again through the normal path without opening it to the public, and\nall of this without touching HAProxy at all. This ensures that even complicated\nproduction operations may be done during opening hours with all technical\nresources available.\n\nThe process tries to save resources as much as possible, uses memory pools to\nsave on allocation time and limit memory fragmentation, releases payload buffers\nas soon as their contents are sent, and supports enforcing strong memory limits\nabove which connections have to wait for a buffer to become available instead of\nallocating more memory. This system helps guarantee memory usage in certain\nstrict environments.\n\nA command line interface (CLI) is available as a UNIX or TCP socket, to perform\na number of operations and to retrieve troubleshooting information. Everything\ndone on this socket doesn't require a configuration change, so it is mostly used\nfor temporary changes. Using this interface it is possible to change a server's\naddress, weight and status, to consult statistics and clear counters, dump and\nclear stickiness tables, possibly selectively by key criteria, dump and kill\nclient-side and server-side connections, dump captured errors with a detailed\nanalysis of the exact cause and location of the error, dump, add and remove\nentries from ACLs and maps, update TLS shared secrets, apply connection limits\nand rate limits on the fly to arbitrary frontends (useful in shared hosting\nenvironments), and disable a specific frontend to release a listening port\n(useful when daytime operations are forbidden and a fix is needed nonetheless).\nUpdating certificates and their configuration on the fly is permitted, as well\nas enabling and consulting traces of every processing step of the traffic.\n\nFor environments where SNMP is mandatory, at least two agents exist, one is\nprovided with the HAProxy sources and relies on the Net-SNMP Perl module.\nAnother one is provided with the commercial packages and doesn't require Perl.\nBoth are roughly equivalent in terms of coverage.\n\nIt is often recommended to install 4 utilities on the machine where HAProxy is\ndeployed :\n\n  - socat (in order to connect to the CLI, though certain forks of netcat can\n    also do it to some extents);\n\n  - halog from the latest HAProxy version : this is the log analysis tool, it\n    parses native TCP and HTTP logs extremely fast (1 to 2 GB per second) and\n    extracts useful information and statistics such as requests per URL, per\n    source address, URLs sorted by response time or error rate, termination\n    codes etc. It was designed to be deployed on the production servers to\n    help troubleshoot live issues so it has to be there ready to be used;\n\n  - tcpdump : this is highly recommended to take the network traces needed to\n    troubleshoot an issue that was made visible in the logs. There is a moment\n    where application and haproxy's analysis will diverge and the network traces\n    are the only way to say who's right and who's wrong. It's also fairly common\n    to detect bugs in network stacks and hypervisors thanks to tcpdump;\n\n  - strace : it is tcpdump's companion. It will report what HAProxy really sees\n    and will help sort out the issues the operating system is responsible for\n    from the ones HAProxy is responsible for. Strace is often requested when a\n    bug in HAProxy is suspected;\n\n```\n\n### [3.5.2.](#3.5.2)Advanced features : System-specific capabilities\n\n```\nDepending on the operating system HAProxy is deployed on, certain extra features\nmay be available or needed. While it is supported on a number of platforms,\nHAProxy is primarily developed on Linux, which explains why some features are\nonly available on this platform.\n\nThe transparent bind and connect features, the support for binding connections\nto a specific network interface, as well as the ability to bind multiple\nprocesses to the same IP address and ports are only available on Linux and BSD\nsystems, though only Linux performs a kernel-side load balancing of the incoming\nrequests between the available processes.\n\nOn Linux, there are also a number of extra features and optimizations including\nsupport for network namespaces (also known as \"containers\") allowing HAProxy to\nbe a gateway between all containers, the ability to set the MSS, Netfilter marks\nand IP TOS field on the client side connection, support for TCP FastOpen on the\nlistening side, TCP user timeouts to let the kernel quickly kill connections\nwhen it detects the client has disappeared before the configured timeouts, TCP\nsplicing to let the kernel forward data between the two sides of a connections\nthus avoiding multiple memory copies, the ability to enable the \"defer-accept\"\nbind option to only get notified of an incoming connection once data become\navailable in the kernel buffers, and the ability to send the request with the\nACK confirming a connect (sometimes called \"piggy-back\") which is enabled with\nthe \"tcp-smart-connect\" option. On Linux, HAProxy also takes great care of\nmanipulating the TCP delayed ACKs to save as many packets as possible on the\nnetwork.\n\nSome systems have an unreliable clock which jumps back and forth in the past\nand in the future. This used to happen with some NUMA systems where multiple\nprocessors didn't see the exact same time of day, and recently it became more\ncommon in virtualized environments where the virtual clock has no relation with\nthe real clock, resulting in huge time jumps (sometimes up to 30 seconds have\nbeen observed). This causes a lot of trouble with respect to timeout enforcement\nin general. Due to this flaw of these systems, HAProxy maintains its own\nmonotonic clock which is based on the system's clock but where drift is measured\nand compensated for. This ensures that even with a very bad system clock, timers\nremain reasonably accurate and timeouts continue to work. Note that this problem\naffects all the software running on such systems and is not specific to HAProxy.\nThe common effects are spurious timeouts or application freezes. Thus if this\nbehavior is detected on a system, it must be fixed, regardless of the fact that\nHAProxy protects itself against it.\n\nOn Linux, a new starting process may communicate with the previous one to reuse\nits listening file descriptors so that the listening sockets are never\ninterrupted during the process's replacement.\n\n```\n\n### [3.5.3.](#3.5.3)Advanced features : Scripting\n\n```\nHAProxy can be built with support for the Lua embedded language, which opens a\nwide area of new possibilities related to complex manipulation of requests or\nresponses, routing decisions, statistics processing and so on. Using Lua it is\neven possible to establish parallel connections to other servers to exchange\ninformation. This way it becomes possible (though complex) to develop an\nauthentication system for example. Please refer to the documentation in the file\n\"doc/lua-api/index.rst\" for more information on how to use Lua.\n\n```\n\n### [3.5.4.](#3.5.4)Advanced features: Tracing\n\n```\nAt any moment an administrator may connect over the CLI and enable tracing in\nvarious internal subsystems. Various levels of details are provided by default\nso that in practice anything between one line per request to 500 lines per\nrequest can be retrieved. Filters as well as an automatic capture on/off/pause\nmechanism are available so that it really is possible to wait for a certain\nevent and watch it in detail. This is extremely convenient to diagnose protocol\nviolations from faulty servers and clients, or denial of service attacks.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/intro.html"}
{"title": "3.6. Sizing", "content": "```\nTypical CPU usage figures show 15% of the processing time spent in HAProxy\nversus 85% in the kernel in TCP or HTTP close mode, and about 30% for HAProxy\nversus 70% for the kernel in HTTP keep-alive mode. This means that the operating\nsystem and its tuning have a strong impact on the global performance.\n\nUsages vary a lot between users, some focus on bandwidth, other ones on request\nrate, others on connection concurrency, others on SSL performance. This section\naims at providing a few elements to help with this task.\n\nIt is important to keep in mind that every operation comes with a cost, so each\nindividual operation adds its overhead on top of the other ones, which may be\nnegligible in certain circumstances, and which may dominate in other cases.\n\nWhen processing the requests from a connection, we can say that :\n\n  - forwarding data costs less than parsing request or response headers;\n\n  - parsing request or response headers cost less than establishing then closing\n    a connection to a server;\n\n  - establishing an closing a connection costs less than a TLS resume operation;\n\n  - a TLS resume operation costs less than a full TLS handshake with a key\n    computation;\n\n  - an idle connection costs less CPU than a connection whose buffers hold data;\n\n  - a TLS context costs even more memory than a connection with data;\n\nSo in practice, it is cheaper to process payload bytes than header bytes, thus\nit is easier to achieve high network bandwidth with large objects (few requests\nper volume unit) than with small objects (many requests per volume unit). This\nexplains why maximum bandwidth is always measured with large objects, while\nrequest rate or connection rates are measured with small objects.\n\nSome operations scale well on multiple processes spread over multiple CPUs,\nand others don't scale as well. Network bandwidth doesn't scale very far because\nthe CPU is rarely the bottleneck for large objects, it's mostly the network\nbandwidth and data buses to reach the network interfaces. The connection rate\ndoesn't scale well over multiple processors due to a few locks in the system\nwhen dealing with the local ports table. The request rate over persistent\nconnections scales very well as it doesn't involve much memory nor network\nbandwidth and doesn't require to access locked structures. TLS key computation\nscales very well as it's totally CPU-bound. TLS resume scales moderately well,\nbut reaches its limits around 4 processes where the overhead of accessing the\nshared table offsets the small gains expected from more power.\n\nThe performance numbers one can expect from a very well tuned system are in the\nfollowing range. It is important to take them as orders of magnitude and to\nexpect significant variations in any direction based on the processor, IRQ\nsetting, memory type, network interface type, operating system tuning and so on.\n\nThe following numbers were found on a Core i7 running at 3.7 GHz equipped with\na dual-port 10 Gbps NICs running Linux kernel 3.10, HAProxy 1.6 and OpenSSL\n1.0.2. HAProxy was running as a single process on a single dedicated CPU core,\nand two extra cores were dedicated to network interrupts :\n\n  - 20 Gbps of maximum network bandwidth in clear text for objects 256 kB or\n    higher, 10 Gbps for 41kB or higher;\n\n  - 4.6 Gbps of TLS traffic using AES256-GCM cipher with large objects;\n\n  - 83000 TCP connections per second from client to server;\n\n  - 82000 HTTP connections per second from client to server;\n\n  - 97000 HTTP requests per second in server-close mode (keep-alive with the\n    client, close with the server);\n\n  - 243000 HTTP requests per second in end-to-end keep-alive mode;\n\n  - 300000 filtered TCP connections per second (anti-DDoS)\n\n  - 160000 HTTPS requests per second in keep-alive mode over persistent TLS\n    connections;\n\n  - 13100 HTTPS requests per second using TLS resumed connections;\n\n  - 1300 HTTPS connections per second using TLS connections renegotiated with\n    RSA2048;\n\n  - 20000 concurrent saturated connections per GB of RAM, including the memory\n    required for system buffers; it is possible to do better with careful tuning\n    but this result it easy to achieve.\n\n  - about 8000 concurrent TLS connections (client-side only) per GB of RAM,\n    including the memory required for system buffers;\n\n  - about 5000 concurrent end-to-end TLS connections (both sides) per GB of\n    RAM including the memory required for system buffers;\n\nA more recent benchmark featuring the multi-thread enabled HAProxy 2.4 on a\n64-core ARM Graviton2 processor in AWS reached 2 million HTTPS requests per\nsecond at sub-millisecond response time, and 100 Gbps of traffic:\n\n  https://www.haproxy.com/blog/haproxy-forwards-over-2-million-http-requests-per-second-on-a-single-aws-arm-instance/\n\nThus a good rule of thumb to keep in mind is that the request rate is divided\nby 10 between TLS keep-alive and TLS resume, and between TLS resume and TLS\nrenegotiation, while it's only divided by 3 between HTTP keep-alive and HTTP\nclose. Another good rule of thumb is to remember that a high frequency core\nwith AES instructions can do around 20 Gbps of AES-GCM per core.\n\nAnother good rule of thumb is to consider that on the same server, HAProxy will\nbe able to saturate :\n\n  - about 5-10 static file servers or caching proxies;\n\n  - about 100 anti-virus proxies;\n\n  - and about 100-1000 application servers depending on the technology in use.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/intro.html"}
{"title": "3.7. How to get HAProxy", "content": "```\nHAProxy is an open source project covered by the GPLv2 license, meaning that\neveryone is allowed to redistribute it provided that access to the sources is\nalso provided upon request, especially if any modifications were made.\n\nHAProxy evolves as a main development branch called \"master\" or \"mainline\", from\nwhich new branches are derived once the code is considered stable. A lot of web\nsites run some development branches in production on a voluntarily basis, either\nto participate to the project or because they need a bleeding edge feature, and\ntheir feedback is highly valuable to fix bugs and judge the overall quality and\nstability of the version being developed.\n\nThe new branches that are created when the code is stable enough constitute a\nstable version and are generally maintained for several years, so that there is\nno emergency to migrate to a newer branch even when you're not on the latest.\nOnce a stable branch is issued, it may only receive bug fixes, and very rarely\nminor feature updates when that makes users' life easier. All fixes that go into\na stable branch necessarily come from the master branch. This guarantees that no\nfix will be lost after an upgrade. For this reason, if you fix a bug, please\nmake the patch against the master branch, not the stable branch. You may even\ndiscover it was already fixed. This process also ensures that regressions in a\nstable branch are extremely rare, so there is never any excuse for not upgrading\nto the latest version in your current branch.\n\nBranches are numbered with two digits delimited with a dot, such as \"1.6\".\nSince 1.9, branches with an odd second digit are mostly focused on sensitive\ntechnical updates and more aimed at advanced users because they are likely to\ntrigger more bugs than the other ones. They are maintained for about a year\nonly and must not be deployed where they cannot be rolled back in emergency. A\ncomplete version includes one or two sub-version numbers indicating the level of\nfix. For example, version 1.5.14 is the 14th fix release in branch 1.5 after\nversion 1.5.0 was issued. It contains 126 fixes for individual bugs, 24 updates\non the documentation, and 75 other backported patches, most of which were needed\nto fix the aforementioned 126 bugs. An existing feature may never be modified\nnor removed in a stable branch, in order to guarantee that upgrades within the\nsame branch will always be harmless.\n\nHAProxy is available from multiple sources, at different release rhythms :\n\n  - The official community web site : http://www.haproxy.org/ : this site\n    provides the sources of the latest development release, all stable releases,\n    as well as nightly snapshots for each branch. The release cycle is not fast,\n    several months between stable releases, or between development snapshots.\n    Very old versions are still supported there. Everything is provided as\n    sources only, so whatever comes from there needs to be rebuilt and/or\n    repackaged;\n\n  - GitHub : https://github.com/haproxy/haproxy/ : this is the mirror for the\n    development branch only, which provides integration with the issue tracker,\n    continuous integration and code coverage tools. This is exclusively for\n    contributors;\n\n  - A number of operating systems such as Linux distributions and BSD ports.\n    These systems generally provide long-term maintained versions which do not\n    always contain all the fixes from the official ones, but which at least\n    contain the critical fixes. It often is a good option for most users who do\n    not seek advanced configurations and just want to keep updates easy;\n\n  - Commercial versions from http://www.haproxy.com/ : these are supported\n    professional packages built for various operating systems or provided as\n    appliances, based on the latest stable versions and including a number of\n    features backported from the next release for which there is a strong\n    demand. It is the best option for users seeking the latest features with\n    the reliability of a stable branch, the fastest response time to fix bugs,\n    or simply support contracts on top of an open source product;\n\n\nIn order to ensure that the version you're using is the latest one in your\nbranch, you need to proceed this way :\n\n  - verify which HAProxy executable you're running : some systems ship it by\n    default and administrators install their versions somewhere else on the\n    system, so it is important to verify in the startup scripts which one is\n    used;\n\n  - determine which source your HAProxy version comes from. For this, it's\n    generally sufficient to type \"haproxy -v\". A development version will\n    appear like this, with the \"dev\" word after the branch number :\n\n      HAProxy version 2.4-dev18-a5357c-137 2021/05/09 - https://haproxy.org/\n\n    A stable version will appear like this, as well as unmodified stable\n    versions provided by operating system vendors :\n\n      HAProxy version 1.5.14 2015/07/02\n\n    And a nightly snapshot of a stable version will appear like this with an\n    hexadecimal sequence after the version, and with the date of the snapshot\n    instead of the date of the release :\n\n      HAProxy version 1.5.14-e4766ba 2015/07/29\n\n    Any other format may indicate a system-specific package with its own\n    patch set. For example HAProxy Enterprise versions will appear with the\n    following format (<branch>-<latest commit>-<revision>) :\n\n      HAProxy version 1.5.0-994126-357 2015/07/02\n\n    Please note that historically versions prior to 2.4 used to report the\n    process name with a hyphen between \"HA\" and \"Proxy\", including those above\n    which were adjusted to show the correct format only, so better ignore this\n    word or use a relaxed match in scripts. Additionally, modern versions add\n    a URL linking to the project's home.\n\n    Finally, versions 2.1 and above will include a \"Status\" line indicating\n    whether the version is safe for production or not, and if so, till when, as\n    well as a link to the list of known bugs affecting this version.\n\n  - for system-specific packages, you have to check with your vendor's package\n    repository or update system to ensure that your system is still supported,\n    and that fixes are still provided for your branch. For community versions\n    coming from haproxy.org, just visit the site, verify the status of your\n    branch and compare the latest version with yours to see if you're on the\n    latest one. If not you can upgrade. If your branch is not maintained\n    anymore, you're definitely very late and will have to consider an upgrade\n    to a more recent branch (carefully read the README when doing so).\n\nHAProxy will have to be updated according to the source it came from. Usually it\nfollows the system vendor's way of upgrading a package. If it was taken from\nsources, please read the README file in the sources directory after extracting\nthe sources and follow the instructions for your operating system.\n\n```\n\n# [4.](#4)Companion products and alternatives\n\n```\nHAProxy integrates fairly well with certain products listed below, which is why\nthey are mentioned here even if not directly related to HAProxy.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/intro.html"}
{"title": "4.1. Apache HTTP server", "content": "```\nApache is the de-facto standard HTTP server. It's a very complete and modular\nproject supporting both file serving and dynamic contents. It can serve as a\nfrontend for some application servers. It can even proxy requests and cache\nresponses. In all of these use cases, a front load balancer is commonly needed.\nApache can work in various modes, some being heavier than others. Certain\nmodules still require the heavier pre-forked model and will prevent Apache from\nscaling well with a high number of connections. In this case HAProxy can provide\na tremendous help by enforcing the per-server connection limits to a safe value\nand will significantly speed up the server and preserve its resources that will\nbe better used by the application.\n\nApache can extract the client's address from the X-Forwarded-For header by using\nthe \"mod_rpaf\" extension. HAProxy will automatically feed this header when\n\"option forwardfor\" is specified in its configuration. HAProxy may also offer a\nnice protection to Apache when exposed to the internet, where it will better\nresist a wide number of types of DoS attacks.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/intro.html"}
{"title": "4.2. NGINX", "content": "```\nNGINX is the second de-facto standard HTTP server. Just like Apache, it covers a\nwide range of features. NGINX is built on a similar model as HAProxy so it has\nno problem dealing with tens of thousands of concurrent connections. When used\nas a gateway to some applications (e.g. using the included PHP FPM) it can often\nbe beneficial to set up some frontend connection limiting to reduce the load\non the PHP application. HAProxy will clearly be useful there both as a regular\nload balancer and as the traffic regulator to speed up PHP by decongesting\nit. Also since both products use very little CPU thanks to their event-driven\narchitecture, it's often easy to install both of them on the same system. NGINX\nimplements HAProxy's PROXY protocol, thus it is easy for HAProxy to pass the\nclient's connection information to NGINX so that the application gets all the\nrelevant information. Some benchmarks have also shown that for large static\nfile serving, implementing consistent hash on HAProxy in front of NGINX can be\nbeneficial by optimizing the OS' cache hit ratio, which is basically multiplied\nby the number of server nodes.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/intro.html"}
{"title": "4.3. Varnish", "content": "```\nVarnish is a smart caching reverse-proxy, probably best described as a web\napplication accelerator. Varnish doesn't implement SSL/TLS and wants to dedicate\nall of its CPU cycles to what it does best. Varnish also implements HAProxy's\nPROXY protocol so that HAProxy can very easily be deployed in front of Varnish\nas an SSL offloader as well as a load balancer and pass it all relevant client\ninformation. Also, Varnish naturally supports decompression from the cache when\na server has provided a compressed object, but doesn't compress however. HAProxy\ncan then be used to compress outgoing data when backend servers do not implement\ncompression, though it's rarely a good idea to compress on the load balancer\nunless the traffic is low.\n\nWhen building large caching farms across multiple nodes, HAProxy can make use of\nconsistent URL hashing to intelligently distribute the load to the caching nodes\nand avoid cache duplication, resulting in a total cache size which is the sum of\nall caching nodes. In addition, caching of very small dumb objects for a short\nduration on HAProxy can sometimes save network round trips and reduce the CPU\nload on both the HAProxy and the Varnish nodes. This is only possible is no\nprocessing is done on these objects on Varnish (this is often referred to as\nthe notion of \"favicon cache\", by which a sizeable percentage of useless\ndownstream requests can sometimes be avoided). However do not enable HAProxy\ncaching for a long time (more than a few seconds) in front of any other cache,\nthat would significantly complicate troubleshooting without providing really\nsignificant savings.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/intro.html"}
{"title": "4.4. Alternatives", "content": "```\nLinux Virtual Server (LVS or IPVS) is the layer 4 load balancer included within\nthe Linux kernel. It works at the packet level and handles TCP and UDP. In most\ncases it's more a complement than an alternative since it doesn't have layer 7\nknowledge at all.\n\nPound is another well-known load balancer. It's much simpler and has much less\nfeatures than HAProxy but for many very basic setups both can be used. Its\nauthor has always focused on code auditability first and wants to maintain the\nset of features low. Its thread-based architecture scales less well with high\nconnection counts, but it's a good product.\n\nPen is a quite light load balancer. It supports SSL, maintains persistence using\na fixed-size table of its clients' IP addresses. It supports a packet-oriented\nmode allowing it to support direct server return and UDP to some extents. It is\nmeant for small loads (the persistence table only has 2048 entries).\n\nNGINX can do some load balancing to some extents, though it's clearly not its\nprimary function. Production traffic is used to detect server failures, the\nload balancing algorithms are more limited, and the stickiness is very limited.\nBut it can make sense in some simple deployment scenarios where it is already\npresent. The good thing is that since it integrates very well with HAProxy,\nthere's nothing wrong with adding HAProxy later when its limits have been\nreached.\n\nVarnish also does some load balancing of its backend servers and does support\nreal health checks. It doesn't implement stickiness however, so just like with\nNGINX, as long as stickiness is not needed that can be enough to start with.\nAnd similarly, since HAProxy and Varnish integrate so well together, it's easy\nto add it later into the mix to complement the feature set.\n\n```\n\n# [5.](#5)Contacts\n\n```\nIf you want to contact the developers or any community member about anything,\nthe best way to do it usually is via the mailing list by sending your message\nto haproxy@formilux.org. Please note that this list is public and its archives\nare public as well so you should avoid disclosing sensitive information. A\nthousand of users of various experience levels are present there and even the\nmost complex questions usually find an optimal response relatively quickly.\nSuggestions are welcome too. For users having difficulties with e-mail, a\nDiscourse platform is available at http://discourse.haproxy.org/ . However\nplease keep in mind that there are less people reading questions there and that\nmost are handled by a really tiny team. In any case, please be patient and\nrespectful with those who devote their spare time helping others.\n\nI you believe you've found a bug but are not sure, it's best reported on the\nmailing list. If you're quite convinced you've found a bug, that your version\nis up-to-date in its branch, and you already have a GitHub account, feel free\nto go directly to https://github.com/haproxy/haproxy/ and file an issue with\nall possibly available details. Again, this is public so be careful not to post\ninformation you might later regret. Since the issue tracker presents itself as\na very long thread, please avoid pasting very long dumps (a few hundreds lines\nor more) and attach them instead.\n\nIf you've found what you're absolutely certain can be considered a critical\nsecurity issue that would put many users in serious trouble if discussed in a\npublic place, then you can send it with the reproducer to security@haproxy.org.\nA small team of trusted developers will receive it and will be able to propose\na fix. We usually don't use embargoes and once a fix is available it gets\nmerged. In some rare circumstances it can happen that a release is coordinated\nwith software vendors. Please note that this process usually messes up with\neveyone's work, and that rushed up releases can sometimes introduce new bugs,\nso it's best avoided unless strictly necessary; as such, there is often little\nconsideration for reports that needlessly cause such extra burden, and the best\nway to see your work credited usually is to provide a working fix, which will\nappear in changelogs.\n\n```\n\nHAProxy 3.2.13-3  Starter Guide,", "url": "https://docs.haproxy.org/3.2/intro.html"}
{"title": "1. Quick reminder about HTTP", "content": "# [1.](#1)Quick reminder about HTTP\n\n```\nWhen HAProxy is running in HTTP mode, both the request and the response are\nfully analyzed and indexed, thus it becomes possible to build matching criteria\non almost anything found in the contents.\n\nHowever, it is important to understand how HTTP requests and responses are\nformed, and how HAProxy decomposes them. It will then become easier to write\ncorrect rules and to debug existing configurations.\n\nFirst, HTTP is standardized by a series of RFC that HAProxy follows as closely\nas possible:\n  - RFC 9110: HTTP Semantics (explains the meaning of protocol elements)\n  - RFC 9111: HTTP Caching (explains the rules to follow for an HTTP cache)\n  - RFC 9112: HTTP/1.1 (representation, interoperability rules, security)\n  - RFC 9113: HTTP/2   (representation, interoperability rules, security)\n  - RFC 9114: HTTP/3   (representation, interoperability rules, security)\n\nIn addition to these, RFC 8999 to 9002 specify the QUIC transport layer used by\nthe HTTP/3 protocol.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "1.1. The HTTP transaction model", "content": "## [1.1.](#1.1)The HTTP transaction model\n\n```\nThe HTTP protocol is transaction-driven. This means that each request will lead\nto one and only one response. Originally, with version 1.0 of the protocol,\nthere was a single request per connection: a TCP connection is established from\nthe client to the server, a request is sent by the client over the connection,\nthe server responds, and the connection is closed. A new request then involves\na new connection :\n\n  [CON1] [REQ1] ... [RESP1] [CLO1] [CON2] [REQ2] ... [RESP2] [CLO2] ...\n\nIn this mode, often called the \"HTTP close\" mode, there are as many connection\nestablishments as there are HTTP transactions. Since the connection is closed\nby the server after the response, the client does not need to know the content\nlength, it considers that the response is complete when the connection closes.\nThis also means that if some responses are truncated due to network errors, the\nclient could mistakenly think a response was complete, and this used to cause\ntruncated images to be rendered on screen sometimes.\n\nDue to the transactional nature of the protocol, it was possible to improve it\nto avoid closing a connection between two subsequent transactions. In this mode\nhowever, it is mandatory that the server indicates the content length for each\nresponse so that the client does not wait indefinitely. For this, a special\nheader is used: \"Content-length\". This mode is called the \"keep-alive\" mode,\nand arrived with HTTP/1.1 (some HTTP/1.0 agents support it), and connections\nthat are reused between requests are called \"persistent connections\":\n\n  [CON] [REQ1] ... [RESP1] [REQ2] ... [RESP2] [CLO] ...\n\nIts advantages are a reduced latency between transactions, less processing\npower required on the server side, and the ability to detect a truncated\nresponse. It is generally faster than the close mode, but not always because\nsome clients often limit their concurrent connections to a smaller value, and\nthis compensates less for poor network connectivity. Also, some servers have to\nkeep the connection alive for a long time waiting for a possible new request\nand may experience a high memory usage due to the high number of connections,\nand closing too fast may break some requests that arrived at the moment the\nconnection was closed.\n\nIn this mode, the response size needs to be known upfront so that's not always\npossible with dynamically generated or compressed contents. For this reason\nanother mode was implemented, the \"chunked mode\", where instead of announcing\nthe size of the whole size at once, the sender only advertises the size of the\nnext \"chunk\" of response it already has in a buffer, and can terminate at any\nmoment with a zero-sized chunk. In this mode, the Content-Length header is not\nused.\n\nAnother improvement in the communications is the pipelining mode. It still uses\nkeep-alive, but the client does not wait for the first response to send the\nsecond request. This is useful for fetching large number of images composing a\npage :\n\n  [CON] [REQ1] [REQ2] ... [RESP1] [RESP2] [CLO] ...\n\nThis can obviously have a tremendous benefit on performance because the network\nlatency is eliminated between subsequent requests. Many HTTP agents do not\ncorrectly support pipelining since there is no way to associate a response with\nthe corresponding request in HTTP. For this reason, it is mandatory for the\nserver to reply in the exact same order as the requests were received. In\npractice, after several attempts by various clients to deploy it, it has been\ntotally abandoned for its lack of reliability on certain servers. But it is\nmandatory for servers to support it.\n\nThe next improvement is the multiplexed mode, as implemented in HTTP/2 and\nHTTP/3. In this mode, multiple transactions (i.e. request-response pairs) are\ntransmitted in parallel over a single connection, and they all progress at\ntheir own speed, independent from each other. With multiplexed protocols, a new\nnotion of \"stream\" was introduced, to represent these parallel communications\nhappening over the same connection. Each stream is generally assigned a unique\nidentifier for a given connection, that is used by both endpoints to know where\nto deliver the data. It is fairly common for clients to start many (up to 100,\nsometimes more) streams in parallel over a same connection, and let the server\nsort them out and respond in any order depending on what response is available.\nThe main benefit of the multiplexed mode is that it significantly reduces the\nnumber of round trips, and speeds up page loading time over high latency\nnetworks. It is sometimes visible on sites using many images, where all images\nappear to load in parallel.\n\nThese protocols have also improved their efficiency by adopting some mechanisms\nto compress header fields in order to reduce the number of bytes on the wire,\nso that without the appropriate tools, they are not realistically manipulable\nby hand nor readable to the naked eye like HTTP/1 was. For this reason, various\nexamples of HTTP messages continue to be represented in literature (including\nthis document) using the HTTP/1 syntax even for newer versions of the protocol.\n\nHTTP/2 suffers from some design limitations, such as packet losses affecting\nall streams at once, and if a client takes too much time to retrieve an object\n(e.g. needs to store it on disk), it may slow down its retrieval and make it\nimpossible during this time to access the data that is pending behind it. This\nis called \"head of line blocking\" or \"HoL blocking\" or sometimes just \"HoL\".\n\nHTTP/3 is implemented over QUIC, itself implemented over UDP. QUIC solves the\nhead of line blocking at the transport level by means of independently handled\nstreams. Indeed, when experiencing loss, an impacted stream does not affect the\nother streams, and all of them can be accessed in parallel. QUIC also provides\nconnection migration support but currently haproxy does not support it.\n\nBy default HAProxy operates in keep-alive mode with regards to persistent\nconnections: for each connection it processes each request and response, and\nleaves the connection idle on both sides between the end of a response and the\nstart of a new request. When it receives HTTP/2 connections from a client, it\nprocesses all the requests in parallel and leaves the connection idling,\nwaiting for new requests, just as if it was a keep-alive HTTP connection.\n\nHAProxy essentially supports 3 connection modes :\n  - keep alive    : all requests and responses are processed, and the client\n                    facing and server facing connections are kept alive for new\n                    requests. This is the default and suits the modern web and\n                    modern protocols (HTTP/2 and HTTP/3).\n\n  - server close  : the server-facing connection is closed after the response.\n\n  - close         : the connection is actively closed after end of response on\n                    both sides.\n\nIn addition to this, by default, the server-facing connection is reusable by\nany request from any client, as mandated by the HTTP protocol specification, so\nany information pertaining to a specific client has to be passed along with\neach request if needed (e.g. client's source address etc). When HTTP/2 is used\nwith a server, by default HAProxy will dedicate this connection to the same\nclient to avoid the risk of head of line blocking between clients.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "1.2. Terminology", "content": "## [1.2.](#1.2)Terminology\n\n```\nInside HAProxy, the terminology has evolved a bit over the ages to follow the\nevolutions of the HTTP protocol and its usages. While originally there was no\nsignificant difference between a connection, a session, a stream or a\ntransaction, these ones clarified over time to match closely what exists in the\nmodern versions of the HTTP protocol, though some terms remain visible in the\nconfiguration or the command line interface for the purpose of historical\ncompatibility.\n\nHere are some definitions that apply to the current version of HAProxy:\n\n  - connection: a connection is a single, bidiractional communication channel\n    between a remote agent (client or server) and haproxy, at the lowest level\n    possible. Usually it corresponds to a TCP socket established between a pair\n    of IP and ports. On the client-facing side, connections are the very first\n    entities that are instantiated when a client connects to haproxy, and rules\n    applying at the connection level are the earliest ones that apply.\n\n  - session: a session adds some context information associated with a\n    connection. This includes and information specific to the transport layer\n    (e.g. TLS keys etc), or variables. This term has long been used inside\n    HAProxy to denote end-to-end HTTP/1.0 communications between two ends, and\n    as such it remains visible in the name of certain CLI commands or\n    statistics, despite representing streams nowadays, but the help messages\n    and descriptions try to make this unambiguous. It is still valid when it\n    comes to network-level terminology (e.g. TCP sessions inside the operating\n    systems, or TCP sessions across a firewall), or for non-HTTP user-level\n    applications (e.g. a telnet session or an SSH session). It must not be\n    confused with \"application sessions\" that are used to store a full user\n    context in a cookie and require to be sent to the same server.\n\n  - stream: a stream exactly corresponds to an end-to-end bidirectional\n    communication at the application level, where analysis and transformations\n    may be applied. In HTTP, it contains a single request and its associated\n    response, and is instantiated by the arrival of the request and is finished\n    with the end of delivery of the response. In this context there is a 1:1\n    relation between such a stream and the stream of a multiplexed protocol. In\n    TCP communications there is a single stream per connection.\n\n  - transaction: a transaction is only a pair of a request and the associated\n    response. The term was used in conjunction with sessions before the streams\n    but nowadays there is a 1:1 relation between a transaction and a stream. It\n    is essentially visible in the variables' scope \"txn\" which is valid during\n    the whole transaction, hence the stream.\n\n  - request: it designates the traffic flowing from the client to the server.\n    It is mainly used for HTTP to indicate where operations are performed. This\n    term also exists for TCP operations to indicate where data are processed.\n    Requests often appear in counters as a unit of traffic or activity. They do\n    not always imply a response (e.g. due to errors), but since there is no\n    spontaneous responses without requests, requests remain a relevant metric\n    of the overall activity. In TCP there are as many requests as connections.\n\n  - response: this designates the traffic flowing from the server to the\n    client, or sometimes from HAProxy to the client, when HAProxy produces the\n    response itself (e.g. an HTTP redirect).\n\n  - service: this generally indicates some internal processing in HAProxy that\n    does not require a server, such as the stats page, the cache, or some Lua\n    code to implement a small application. A service usually reads a request,\n    performs some operations and produces a response.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "1.3. HTTP request", "content": "## [1.3.](#1.3)HTTP request\n\n```\nFirst, let's consider this HTTP request :\n\n  Line     Contents\n  number\n     1     GET /serv/login.php?lang=en&profile=2 HTTP/1.1\n     2     Host: www.mydomain.com\n     3     User-agent: my small browser\n     4     Accept: image/jpeg, image/gif\n     5     Accept: image/png\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "1.3.1. The Request line", "content": "### [1.3.1.](#1.3.1)The Request line\n\n```\nLine 1 is the \"request line\". It is always composed of 3 fields :\n\n  - a METHOD      : GET\n  - a URI         : /serv/login.php?lang=en&profile=2\n  - a version tag : HTTP/1.1\n\nAll of them are delimited by what the standard calls LWS (linear white spaces),\nwhich are commonly spaces, but can also be tabs or line feeds/carriage returns\nfollowed by spaces/tabs. The method itself cannot contain any colon (':') and\nis limited to alphabetic letters. All those various combinations make it\ndesirable that HAProxy performs the splitting itself rather than leaving it to\nthe user to write a complex or inaccurate regular expression.\n\nThe URI itself can have several forms :\n\n  - A \"relative URI\" :\n\n      /serv/login.php?lang=en&profile=2\n\n    It is a complete URL without the host part. This is generally what is\n    received by servers, reverse proxies and transparent proxies.\n\n  - An \"absolute URI\", also called a \"URL\" :\n\n      http://192.168.0.12:8080/serv/login.php?lang=en&profile=2\n\n    It is composed of a \"scheme\" (the protocol name followed by '://'), a host\n    name or address, optionally a colon (':') followed by a port number, then\n    a relative URI beginning at the first slash ('/') after the address part.\n    This is generally what proxies receive, but a server supporting HTTP/1.1\n    must accept this form too.\n\n  - a star ('*') : this form is only accepted in association with the OPTIONS\n    method and is not relayable. It is used to inquiry a next hop's\n    capabilities.\n\n  - an address:port combination : 192.168.0.12:80\n    This is used with the CONNECT method, which is used to establish TCP\n    tunnels through HTTP proxies, generally for HTTPS, but sometimes for\n    other protocols too.\n\nIn a relative URI, two sub-parts are identified. The part before the question\nmark is called the \"path\". It is typically the relative path to static objects\non the server. The part after the question mark is called the \"query string\".\nIt is mostly used with GET requests sent to dynamic scripts and is very\nspecific to the language, framework or application in use.\n\nHTTP/2 and HTTP/3 do not convey a version information with the request, so the\nversion is assumed to be the same as the one of the underlying protocol (i.e.\n\"HTTP/2\"). In addition, these protocols do not send a request line as one part,\nbut split it into individual fields called \"pseudo-headers\", whose name start\nwith a colon, and which are conveniently reassembled by HAProxy into an\nequivalent request line. For this reason, request lines found in logs may\nslightly differ between HTTP/1.x and HTTP/2 or HTTP/3.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "1.3.2. The request headers", "content": "### [1.3.2.](#1.3.2)The request headers\n\n```\nThe headers start at the second line. They are composed of a name at the\nbeginning of the line, immediately followed by a colon (':'). Traditionally,\nan LWS is added after the colon but that's not required. Then come the values.\nMultiple identical headers may be folded into one single line, delimiting the\nvalues with commas, provided that their order is respected. This is commonly\nencountered in the \"Cookie:\" field. A header may span over multiple lines if\nthe subsequent lines begin with an LWS. In the example in 1.3, lines 4 and 5\ndefine a total of 3 values for the \"Accept:\" header. Finally, all LWS at the\nbeginning or at the end of a header are ignored and are not part of the value,\nas per the specification.\n\nContrary to a common misconception, header names are not case-sensitive, and\ntheir values are not either if they refer to other header names (such as the\n\"Connection:\" header). In HTTP/2 and HTTP/3, header names are always sent in\nlower case, as can be seen when running in debug mode. Internally, all header\nnames are normalized to lower case so that HTTP/1.x and HTTP/2 or HTTP/3 use\nthe exact same representation, and they are sent as-is on the other side. This\nexplains why an HTTP/1.x request typed with camel case is delivered in lower\ncase.\n\nThe end of the headers is indicated by the first empty line. People often say\nthat it's a double line feed, which is not exact, even if a double line feed\nis one valid form of empty line.\n\nFortunately, HAProxy takes care of all these complex combinations when indexing\nheaders, checking values and counting them, so there is no reason to worry\nabout the way they could be written, but it is important not to accuse an\napplication of being buggy if it does unusual, valid things.\n\nImportant note:\n   As suggested by RFC7231, HAProxy normalizes headers by replacing line breaks\n   in the middle of headers by LWS in order to join multi-line headers. This\n   is necessary for proper analysis and helps less capable HTTP parsers to work\n   correctly and not to be fooled by such complex constructs.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "1.4. HTTP response", "content": "## [1.4.](#1.4)HTTP response\n\n```\nAn HTTP response looks very much like an HTTP request. Both are called HTTP\nmessages. Let's consider this HTTP response :\n\n  Line     Contents\n  number\n     1     HTTP/1.1 200 OK\n     2     Content-length: 350\n     3     Content-Type: text/html\n\nAs a special case, HTTP supports so called \"Informational responses\" as status\ncodes 1xx. These messages are special in that they don't convey any part of the\nresponse, they're just used as sort of a signaling message to ask a client to\ncontinue to post its request for instance. In the case of a status 100 response\nthe requested information will be carried by the next non-100 response message\nfollowing the informational one. This implies that multiple responses may be\nsent to a single request, and that this only works when keep-alive is enabled\n(1xx messages appeared in HTTP/1.1). HAProxy handles these messages and is able\nto correctly forward and skip them, and only process the next non-100 response.\nAs such, these messages are neither logged nor transformed, unless explicitly\nstate otherwise. Status 101 messages indicate that the protocol is changing\nover the same connection and that HAProxy must switch to tunnel mode, just as\nif a CONNECT had occurred. Then the Upgrade header would contain additional\ninformation about the type of protocol the connection is switching to.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "1.4.1. The response line", "content": "### [1.4.1.](#1.4.1)The response line\n\n```\nLine 1 is the \"response line\". It is always composed of 3 fields :\n\n  - a version tag : HTTP/1.1\n  - a status code : 200\n  - a reason      : OK\n\nThe status code is always 3-digit. The first digit indicates a general status :\n - 1xx = informational message to be skipped (e.g. 100, 101)\n - 2xx = OK, content is following   (e.g. 200, 206)\n - 3xx = OK, no content following   (e.g. 302, 304)\n - 4xx = error caused by the client (e.g. 401, 403, 404)\n - 5xx = error caused by the server (e.g. 500, 502, 503)\n\nStatus codes greater than 599 must not be emitted in communications, though\ncertain agents may produce them in logs to report their internal statuses.\nPlease refer to RFC9110 for the detailed meaning of all such codes. HTTP/2 and\nabove do not have a version tag and use the \":status\" pseudo-header to report\nthe status code.\n\nThe \"reason\" field is just a hint, but is not parsed by clients. Anything can\nbe found there, but it's a common practice to respect the well-established\nmessages. It can be composed of one or multiple words, such as \"OK\", \"Found\",\nor \"Authentication Required\". It does not exist in HTTP/2 and above and is\nnot emitted there. When a response from HTTP/2 or above is transmitted to an\nHTTP/1 client, HAProxy will produce such a common reason field that matches\nthe status code.\n\nHAProxy may emit the following status codes by itself :\n\n  Code  When / reason\n   200  access to stats page, and when replying to monitoring requests\n   301  when performing a redirection, depending on the configured code\n   302  when performing a redirection, depending on the configured code\n   303  when performing a redirection, depending on the configured code\n   307  when performing a redirection, depending on the configured code\n   308  when performing a redirection, depending on the configured code\n   400  for an invalid or too large request\n   401  when an authentication is required to perform the action (when\n        accessing the stats page)\n   403  when a request is forbidden by a \"http-request deny\" rule\n   404  when the requested resource could not be found\n   408  when the request timeout strikes before the request is complete\n   410  when the requested resource is no longer available and will not\n        be available again\n   413  when a HTTP/1.0 GET/HEAD/DELETE requests has a payload, also see\n        the \"h1-accept-payload-with-any-method\" option\n   500  when HAProxy encounters an unrecoverable internal error, such as a\n        memory allocation failure, which should never happen\n   501 when HAProxy is unable to satisfy a client request because of an\n       unsupported feature\n   502  when the server returns an empty, invalid or incomplete response, or\n        when an \"http-response deny\" rule blocks the response.\n   503  when no server was available to handle the request, or in response to\n        monitoring requests which match the \"monitor fail\" condition\n   504  when the response timeout strikes before the server responds\n\nThe error 4xx and 5xx codes above may be customized (see \"errorloc\" in section\n4.2). Other status codes can be emitted on purpose by specific actions (see the\n\"deny\", \"return\" and \"redirectThis keyword is available in sections :Alphabetically sorted keywords referenceAlphabetically sorted actions reference\" actions in section 4.3 for example).\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "1.4.2. The response headers", "content": "### [1.4.2.](#1.4.2)The response headers\n\n```\nResponse headers work exactly like request headers, and as such, HAProxy uses\nthe same parsing function for both. Please refer to paragraph 1.3.2 for more\ndetails.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2. Configuring HAProxy", "content": "# [2.](#2)Configuring HAProxy\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.1. Configuration file format", "content": "## [2.1.](#2.1)Configuration file format\n\n```\nHAProxy's configuration process involves 3 major sources of parameters :\n\n  - the arguments from the command-line, which always take precedence\n  - the configuration file(s), whose format is described here\n  - the running process's environment, in case some environment variables are\n    explicitly referenced\n\nThe configuration file follows a fairly simple hierarchical format which obey\na few basic rules:\n\n  1. a configuration file is an ordered sequence of statements\n\n  2. a statement is a single non-empty line before any unprotected \"#\" (hash)\n\n  3. a line is a series of tokens or \"words\" delimited by unprotected spaces or\n     tab characters\n\n  4. the first word or sequence of words of a line is one of the keywords or\n     keyword sequences listed in this document\n\n  5. all other words are all arguments of the first one, some being well-known\n     keywords listed in this document, others being values, references to other\n     parts of the configuration, or expressions\n\n  6. certain keywords delimit a section inside which only a subset of keywords\n     are supported\n\n  7. a section ends at the end of a file or on a special keyword starting a new\n     section\n\nThis is all that is needed to know to write a simple but reliable configuration\ngenerator, but this is not enough to reliably parse any configuration nor to\nfigure how to deal with certain corner cases.\n\nFirst, there are a few consequences of the rules above. Rule 6 and 7 imply that\nthe keywords used to define a new section are valid everywhere and cannot have\na different meaning in a specific section. These keywords are always a single\nword (as opposed to a sequence of words), and traditionally the section that\nfollows them is designated using the same name. For example when speaking about\nthe \"global section\", it designates the section of configuration that follows\nthe \"global\" keyword. This usage is used a lot in error messages to help locate\nthe parts that need to be addressed.\n\nA number of sections create an internal object or configuration space, which\nrequires to be distinguished from other ones. In this case they will take an\nextra word which will set the name of this particular section. For some of them\nthe section name is mandatory. For example \"frontend foo\" will create a new\nsection of type \"frontend\" named \"foo\". Usually a name is specific to its\nsection and two sections of different types may use the same name, but this is\nnot recommended as it tends to complexify configuration management.\n\nA direct consequence of rule 7 is that when multiple files are read at once,\neach of them must start with a new section, and the end of each file will end\na section. A file cannot contain sub-sections nor end an existing section and\nstart a new one.\n\nRule 1 mentioned that ordering matters. Indeed, some keywords create directives\nthat can be repeated multiple times to create ordered sequences of rules to be\napplied in a certain order. For example \"tcp-request\" can be used to alternate\n\"accept\" and \"reject\" rules on varying criteria. As such, a configuration file\nprocessor must always preserve a section's ordering when editing a file. The\nordering of sections usually does not matter except for the global section\nwhich must be placed before other sections, but it may be repeated if needed.\nIn addition, some automatic identifiers may automatically be assigned to some\nof the created objects (e.g. proxies), and by reordering sections, their\nidentifiers will change. These ones appear in the statistics for example. As\nsuch, the configuration below will assign \"foo\" ID number 1 and \"bar\" ID number\n2, which will be swapped if the two sections are reversed:\n\n     listen foo\n         bind :80\n\n     listen bar\n         bind :81\n\nAnother important point is that according to rules 2 and 3 above, empty lines,\nspaces, tabs, and comments following and unprotected \"#\" character are not part\nof the configuration as they are just used as delimiters. This implies that the\nfollowing configurations are strictly equivalent:\n\n         global#this is the global section\n     daemon#daemonize\n         frontend         foo\n     mode             http   # or tcp\n\nand:\n\n     global\n         daemon\n\n     # this is the public web frontend\n     frontend foo\n         mode http\n\nThe common practice is to align to the left only the keyword that initiates a\nnew section, and indent (i.e. prepend a tab character or a few spaces) all\nother keywords so that it's instantly visible that they belong to the same\nsection (as done in the second example above). Placing comments before a new\nsection helps the reader decide if it's the desired one. Leaving a blank line\nat the end of a section also visually helps spotting the end when editing it.\n\nTabs are very convenient for indent but they do not copy-paste well. If spaces\nare used instead, it is recommended to avoid placing too many (2 to 4) so that\nediting in field doesn't become a burden with limited editors that do not\nsupport automatic indent.\n\nIn the early days it used to be common to see arguments split at fixed tab\npositions because most keywords would not take more than two arguments. With\nmodern versions featuring complex expressions this practice does not stand\nanymore, and is not recommended.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.2. Quoting and escaping", "content": "## [2.2.](#2.2)Quoting and escaping\n\n```\nIn modern configurations, some arguments require the use of some characters\nthat were previously considered as pure delimiters. In order to make this\npossible, HAProxy supports character escaping by prepending a backslash ('\\')\nin front of the character to be escaped, weak quoting with double quotes (\"\")\naround a piece of text, and strong quoting with single quotes ('') around a\npiece of text.\n\nThis is pretty similar to what is done in a number of programming languages and\nvery close to what is commonly encountered in Bourne shell. The principle is\nthe following: while the configuration parser cuts the lines into words, it\nalso takes care of quotes and backslashes to decide whether a character is a\ndelimiter or is the raw representation of this character within the current\nword. The escape character is then removed, the quotes are removed, and the\nremaining word is used as-is as a keyword or argument for example.\n\nIf a backslash is needed in a word, it must either be escaped using itself\n(i.e. double backslash) or be strongly quoted.\n\nEscaping outside quotes is achieved by preceding a special character by a\nbackslash ('\\'):\n\n  \\    to mark a space and differentiate it from a delimiter\n  \\#   to mark a hash and differentiate it from a comment\n  \\\\   to use a backslash\n  \\'   to use a single quote and differentiate it from strong quoting\n  \\\"   to use a double quote and differentiate it from weak quoting\n\nIn addition, a few non-printable characters may be emitted using their usual\nC-language representation:\n\n  \\n   to insert a line feed (LF, character \\x0a or ASCII 10 decimal)\n  \\r   to insert a carriage return (CR, character \\x0d or ASCII 13 decimal)\n  \\t   to insert a tab (character \\x09 or ASCII 9 decimal)\n  \\xNN to insert character having ASCII code hex NN (e.g \\x0a for LF).\n\nWeak quoting is achieved by surrounding double quotes (\"\") around the character\nor sequence of characters to protect. Weak quoting prevents the interpretation\nof:\n\n       space or tab as a word separator\n  '    single quote as a strong quoting delimiter\n  #    hash as a comment start\n\nWeak quoting permits the interpretation of environment variables (which are not\nevaluated outside of quotes) by preceding them with a dollar sign ('$'). If a\ndollar character is needed inside double quotes, it must be escaped using a\nbackslash.\n\nStrong quoting is achieved by surrounding single quotes ('') around the\ncharacter or sequence of characters to protect. Inside single quotes, nothing\nis interpreted, it's the efficient way to quote regular expressions.\n\nAs a result, here is the matrix indicating how special characters can be\nentered in different contexts (unprintable characters are replaced with their\nname within angle brackets). Note that some characters that may only be\nrepresented escaped have no possible representation inside single quotes,\nhence its absence there:\n\n```\n\nCharacterUnquotedWeakly quotedStrongly quoted<TAB>\\<TAB>, \\x09\"<TAB>\", \"\\<TAB>\", \"\\x09\"'<TAB>'<LF>\\n, \\x0a\"\\n\", \"\\x0a\"<CR>\\r, \\x0d\"\\r\", \"\\x0d\"<SPC>\\<SPC>, \\x20\"<SPC>\", \"\\<SPC>\", \"\\x20\"'<SPC>'\"\\\", \\x22\"\\\"\", \"\\x22\"'\"'#\\#, \\x23\"#\", \"\\#\", \"\\x23\"'#'$$, \\$, \\x24\"\\$\", \"\\x24\"'$''\\', \\x27\"'\", \"\\'\", \"\\x27\"\\\\\\, \\x5c\"\\\\\", \"\\x5c\"'\\'Example:```\n\n# those are all strictly equivalent:\nlog-format %{+Q}o\\ %t\\ %s\\ %{-Q}r\nlog-format \"%{+Q}o %t %s %{-Q}r\"\nlog-format '%{+Q}o %t %s %{-Q}r'\nlog-format \"%{+Q}o %t\"' %s %{-Q}r'\nlog-format \"%{+Q}o %t\"' %s'\\ %{-Q}r\n\n```\n\n```\nThere is one particular case where a second level of quoting or escaping may be\nnecessary. Some keywords take arguments within parenthesis, sometimes delimited\nby commas. These arguments are commonly integers or predefined words, but when\nthey are arbitrary strings, it may be required to perform a separate level of\nescaping to disambiguate the characters that belong to the argument from the\ncharacters that are used to delimit the arguments themselves. A pretty common\ncase is the \"regsub\" converter. It takes a regular expression in argument, and\nif a closing parenthesis is needed inside, this one will require to have its\nown quotes.\n\nThe keyword argument parser is exactly the same as the top-level one regarding\nquotes, except that the \\#, \\$, and \\xNN escapes are not processed. But what is\nnot always obvious is that the delimiters used inside must first be escaped or\nquoted so that they are not resolved at the top level.\n\nLet's take this example making use of the \"regsub\" converter which takes 3\narguments, one regular expression, one replacement string and one set of flags:\n\n    # replace all occurrences of \"foo\" with \"blah\" in the path:\n    http-request set-path %[path,regsub(foo,blah,g)]\n\nHere no special quoting was necessary. But if now we want to replace either\n\"foo\" or \"bar\" with \"blah\", we'll need the regular expression \"(foo|bar)\". We\ncannot write:\n\n    http-request set-path %[path,regsub((foo|bar),blah,g)]\n\nbecause we would like the string to cut like this:\n\n    http-request set-path %[path,regsub((foo|bar),blah,g)]\n                                       |---------|----|-|\n                                 arg1 _/         /    /\n                                 arg2 __________/    /\n                                 arg3 ______________/\n\nbut actually what is passed is a string between the opening and closing\nparenthesis then garbage:\n\n    http-request set-path %[path,regsub((foo|bar),blah,g)]\n                                       |--------|--------|\n                        arg1=(foo|bar _/        /\n                    trailing garbage  _________/\n\nThe obvious solution here seems to be that the closing parenthesis needs to be\nquoted, but alone this will not work, because as mentioned above, quotes are\nprocessed by the top-level parser which will resolve them before processing\nthis word:\n\n    http-request set-path %[path,regsub(\"(foo|bar)\",blah,g)]\n    ------------ -------- ----------------------------------\n       word1       word2    word3=%[path,regsub((foo|bar),blah,g)]\n\nSo we didn't change anything for the argument parser at the second level which\nstill sees a truncated regular expression as the only argument, and garbage at\nthe end of the string. By escaping the quotes they will be passed unmodified to\nthe second level:\n\n    http-request set-path %[path,regsub(\\\"(foo|bar)\\\",blah,g)]\n    ------------ -------- ------------------------------------\n       word1       word2    word3=%[path,regsub(\"(foo|bar)\",blah,g)]\n                                                |---------||----|-|\n                                arg1=(foo|bar) _/          /    /\n                                    arg2=blah  ___________/    /\n                                        arg3=g _______________/\n\nAnother approach consists in using single quotes outside the whole string and\ndouble quotes inside (so that the double quotes are not stripped again):\n\n    http-request set-path '%[path,regsub(\"(foo|bar)\",blah,g)]'\n    ------------ --------  ----------------------------------\n       word1       word2    word3=%[path,regsub(\"(foo|bar)\",blah,g)]\n                                                |---------||----|-|\n                                arg1=(foo|bar) _/          /    /\n                                          arg2 ___________/    /\n                                          arg3 _______________/\n\nBut in this case it's important to note that delimiters embedded into the\nhigher level string remain pure characters and are not delimiters anymore. It\nparticularly means that spaces and tabs around commas are part of the string.\nThe example below is wrong on multiple points:\n\n    http-request set-path '%[path, regsub(\"(foo|bar)\", blah, g)]'\n    ------------ --------  --------------------------------------\n       word1       word2    word3=%[path, regsub(\"(foo|bar)\", blah, g)]\n                                        |--------|---------||-----|--|\n                       converter=\" regsub\" _/        /         /   /\n                                    arg1=(foo|bar) _/         /   /\n                                     arg2=\" blah\" ___________/   /\n                                        arg3=\" g\" ______________/\n\nThe single fact of surrounding commas with spaces resulted in the spaces being\npart of the field itself, hence the converter \" regsub\" (starting with a\nspace), which won't be found and will trigger an error, but more subtly, the\nreplacement string \" blah\" will insert a space in the output. A good rule of\nthumb is to never insert unneeded spaces inside expressions.\n\nWhen using regular expressions, it can happen that the dollar ('$') character\nappears in the expression or that a backslash ('\\') is used in the replacement\nstring. In this case these ones will also be processed inside the double quotes\nthus single quotes are preferred (or double escaping). Example:\n\n    http-request set-path '%[path,regsub(\"^/(here)(/|$)\",\"my/\\1\",g)]'\n    ------------ --------  -----------------------------------------\n       word1       word2    word3=%[path,regsub(\"^/(here)(/|$)\",\"my/\\1\",g)]\n                                                |-------------| |-----||-|\n                              arg1=(here)(/|$) _/               /      /\n                                    arg2=my/\\1 ________________/      /\n                                          arg3 ______________________/\n\nRemember that backslashes are not escape characters within single quotes and\nthat the whole word above is already protected against them using the single\nquotes. Conversely, if double quotes had been used around the whole expression,\nsingle the dollar character and the backslashes would have been resolved at top\nlevel, breaking the argument contents at the second level.\n\nUnfortunately, since single quotes can't be escaped inside of strong quoting,\nif you need to include single quotes in your argument, you will need to escape\nor quote them twice. There are a few ways to do this:\n\n    http-request set-var(txn.foo) str(\"\\\\'foo\\\\'\")\n    http-request set-var(txn.foo) str(\\\"\\'foo\\'\\\")\n    http-request set-var(txn.foo) str(\\\\\\'foo\\\\\\')\n\nWhen in doubt, simply do not use quotes anywhere, and start to place single or\ndouble quotes around arguments that require a comma or a closing parenthesis,\nand think about escaping these quotes using a backslash if the string contains\na dollar or a backslash. Again, this is pretty similar to what is used under\na Bourne shell when double-escaping a command passed to \"eval\". For API writers\nthe best is probably to place escaped quotes around each and every argument,\nregardless of their contents. Users will probably find that using single quotes\naround the whole expression and double quotes around each argument provides\nmore readable configurations.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.3. Environment variables", "content": "## [2.3.](#2.3)Environment variables\n\n```\nHAProxy's configuration supports environment variables. Those variables are\ninterpreted only within double quotes. Variables are expanded during the\nconfiguration parsing. Variable names must be preceded by a dollar (\"$\") and\noptionally enclosed with braces (\"{}\") similarly to what is done in Bourne\nshell. Variable names can contain alphanumerical characters or the character\nunderscore (\"_\") but should not start with a digit. If the variable contains a\nlist of several values separated by spaces, it can be expanded as individual\narguments by enclosing the variable with braces and appending the suffix '[*]'\nbefore the closing brace. It is also possible to specify a default value to\nuse when the variable is not set, by appending that value after a dash '-'\nnext to the variable name. Note that the default value only replaces non\nexisting variables, not empty ones.\n\n```\n\nExample:```\n\nbind \"fd@${FD_APP1}\"\n\nlog \"${LOCAL_SYSLOG-127.0.0.1}:514\" local0 notice  # send to local server\n\nuser \"$HAPROXY_USER\"\n\n```\n\n```\nSome variables are defined by HAProxy, they can be used in the configuration\nfile, or could be inherited by a program (See 12.9. Programs). These variables\nare listed in the matrix below, and they are classified among four categories:\n\n  * usable: the variable is accessible from the configuration, either to be\n    resolved as-is, or used within conditional blocks or predicates to enable\n    or disable this some configuration fragments, as described in section 2.4\n    \"Conditional blocks\".\n\n  * modifiable: the variable can be redefined or unset in the configuration via\n    \"setenv\"/\"unsetenv\" keywords.\n\n  * listed: the variable is listed in CLI's \"show env\" command output,\n    described in section 9.3 \"Unix Sockets commands\" of the management guide.\n\n  * exported: variable is exported to launch programs in a modified environment\n    (See section 12.9 \"Programs\"). Note that this does not apply to external\n    checks which have their own rules regarding exported variables.\n\nThere also two subcategories \"master\" and \"worker\", respectively marked 'M' and\n'W' in the table below, showing the differences between the two processes when\nHAProxy is launched in master-worker mode.\n\n  * master: the variable is set and accessible from the master process. So, it\n    will appear in the master CLI's \"show env\" output and it can be used in\n    conditional blocks or directives to enable some special settings for the\n    master (see examples in section 2.4 \"Conditional blocks\").\n\n  * worker: the variable is set and accessible from the worker process. It will\n    appear in the worker CLI's \"show env\" (or the master CLI's \"@1 show env\")\n    and it may as well condition some worker process parameters (see examples\n    from section 2.4 \"Conditional blocks\").\n\nIn standalone mode (without \"-W\" option nor the \"master-worker\" keyword) the\nprocess behaves like a worker, except for variables \"HAPROXY_MASTER_CLI\" and\n\"HAPROXY_MWORKER\" which are not defined.\n\nSome variables are marked as not usable and not modifiable:\n\n  * HAPROXY_CFGFILES\n  * HAPROXY_MWORKER\n  * HAPROXY_CLI\n  * HAPROXY_MASTER_CLI\n  * HAPROXY_LOCALPEER\n\nTheir values are undefined during configuration parsing, they are set later\nduring the initialization. So, it's recommended not to use these variables\nwithin conditional blocks and not to reference them in the global section's\n\"setenv\"/\"resetenv\"/\"unsetenv\" keywords.\n\nThe table below summaries the status of each variable for the different working\nmodes:\n\n  +--------------------------+----------+---------+------------+-----------+\n  |        variable          | exported | usable  | modifiable |  listed   |\n  |                          |          +---------+------------+-----------+\n  |                          |          |  M | W  |   M  |  W  |  M  |  W  |\n  +--------------------------+----------+----+----+------+-----+-----+-----+\n  | HAPROXY_STARTUP_VERSION  |    X     |  X | X  |      |     |  X  |  X  |\n  | HAPROXY_BRANCH           |    X     |  X | X  |      |     |  X  |  X  |\n  | HAPROXY_CFGFILES         |    X     |    |    |      |     |  X  |  X  |\n  | HAPROXY_MWORKER          |    X     |    |    |      |     |  X  |  X  |\n  | HAPROXY_CLI              |          |    |    |      |     |     |  X  |\n  | HAPROXY_MASTER_CLI       |          |    |    |      |     |  X  |     |\n  | HAPROXY_LOCALPEER        |          |    | X  |      |     |     |  X  |\n  | HAPROXY_HTTP_LOG_FMT     |          |    | X  |      |  X  |     |     |\n  | HAPROXY_HTTP_CLF_LOG_FMT |          |    | X  |      |  X  |     |     |\n  | HAPROXY_HTTPS_LOG_FMT    |          |    | X  |      |  X  |     |     |\n  | HAPROXY_TCP_LOG_FMT      |          |    | X  |      |  X  |     |     |\n  +--------------------------+----------+----+----+------+-----+-----+-----+\n\nThe variables in question are the following:\n\n  * HAPROXY_LOCALPEER: defined at the startup of the process which contains the\n    name of the local peer. (See \"-L\" in the management guide.)\n\n  * HAPROXY_CFGFILES: list of the configuration files loaded by HAProxy,\n    separated by semicolons. Can be useful in the case you specified a\n    directory.\n\n  * HAPROXY_HTTP_LOG_FMT: contains the value of the default HTTP log format as\n    defined in section 8.2.3 \"HTTP log format\". It can be used to override the\n    default log format without having to copy the whole original definition.\n\n  * HAPROXY_HTTP_CLF_LOG_FMT: contains the value of the default HTTP CLF log\n    format as defined in section 8.2.3 \"HTTP log format\". It can be used to\n    override the default log format without having to copy the whole original\n    definition.\n\n```\n\nExample:```\n\n# Add the rule that gave the final verdict to the log\nlog-format \"${HAPROXY_TCP_LOG_FMT} lr=last_rule_file:last_rule_line\"\n\n```\n\n```\n  * HAPROXY_HTTPS_LOG_FMT: similar to HAPROXY_HTTP_LOG_FMT but for HTTPS log\n    format as defined in section 8.2.4 \"HTTPS log format\".\n\n  * HAPROXY_TCP_LOG_FMT: similar to HAPROXY_HTTP_LOG_FMT but for TCP log format\n    as defined in section 8.2.2 \"TCP log format\".\n\n  * HAPROXY_TCP_CLF_LOG_FMT: similar to HAPROXY_HTTP_CLF_LOG_FMT but for TCP\n    CLF log format as defined in section 8.2.2 \"TCP log format\".\n\n  * HAPROXY_MWORKER: In master-worker mode, this variable is set to 1.\n\n  * HAPROXY_CLI: configured listeners addresses of the stats socket of every\n    processe, these addresses are separated by semicolons.\n\n  * HAPROXY_MASTER_CLI: In master-worker mode, listeners addresses of the master\n    CLI, separated by semicolons.\n\n  * HAPROXY_STARTUP_VERSION: contains the version used to start, in master-\n    worker mode this is the version which was used to start the master, even\n    after updating the binary and reloading.\n\n  * HAPROXY_BRANCH: contains the HAProxy branch version (such as \"2.8\"). It\n    does not contain the full version number. It can be useful in case of\n    migration if resources (such as maps or certificates) are in a path\n    containing the branch number.\n\nIn addition, some pseudo-variables are internally resolved and may be used as\nregular variables. Pseudo-variables always start with a dot ('.'), and are the\nonly ones where the dot is permitted. The current list of pseudo-variables is:\n\n  * .FILE: the name of the configuration file currently being parsed.\n\n  * .LINE: the line number of the configuration file currently being parsed,\n    starting at one.\n\n  * .SECTION: the name of the section currently being parsed, or its type if\n    the section doesn't have a name (e.g. \"global\"), or an empty string before\n    the first section.\n\nThese variables are resolved at the location where they are parsed. For example\nif a \".LINE\" variable is used in a \"log-format\" directive located in a defaults\nsection, its line number will be resolved before parsing and compiling the\n\"log-format\" directive, so this same line number will be reused by subsequent\nproxies.\n\nThis way it is possible to emit information to help locate a rule in variables,\nlogs, error statuses, health checks, header values, or even to use line numbers\nto name some config objects like servers for example.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.4. Conditional blocks", "content": "## [2.4.](#2.4)Conditional blocks\n\n```\nIt may sometimes be convenient to be able to conditionally enable or disable\nsome arbitrary parts of the configuration, for example to enable/disable SSL or\nciphers, enable or disable some pre-production listeners without modifying the\nconfiguration, or adjust the configuration's syntax to support two distinct\nversions of HAProxy during a migration.. HAProxy brings a set of nestable\npreprocessor-like directives which allow to integrate or ignore some blocks of\ntext. These directives must be placed on their own line and they act on the\nlines that follow them. Two of them support an expression, the other ones only\nswitch to an alternate block or end a current level. The 4 following directives\nare defined to form conditional blocks:\n\n  - .if <condition>\n  - .elif <condition>\n  - .else\n  - .endif\n\nThe \".if\" directive nests a new level, \".elif\" stays at the same level, \".else\"\nas well, and \".endif\" closes a level. Each \".if\" must be terminated by a\nmatching \".endif\". The \".elif\" may only be placed after \".if\" or \".elif\", and\nthere is no limit to the number of \".elif\" that may be chained. There may be\nonly one \".else\" per \".if\" and it must always be after the \".if\" or the last\n\".elif\" of a block.\n\nComments may be placed on the same line if needed after a '#', they will be\nignored. The directives are tokenized like other configuration directives, and\nas such it is possible to use environment variables in conditions.\n\nConditions can also be evaluated on startup with the -cc parameter.\nSee \"3. Starting HAProxy\" in the management doc.\n\nThe conditions are either an empty string (which then returns false), or an\nexpression made of any combination of:\n\n  - the integer zero ('0'), always returns \"false\"\n  - a non-nul integer (e.g. '1'), always returns \"true\".\n  - a predicate optionally followed by argument(s) in parenthesis.\n  - a condition placed between a pair of parenthesis '(' and ')'\n  - an exclamation mark ('!') preceding any of the non-empty elements above,\n    and which will negate its status.\n  - expressions combined with a logical AND ('&&'), which will be evaluated\n    from left to right until one returns false\n  - expressions combined with a logical OR ('||'), which will be evaluated\n    from right to left until one returns true\n\nThe same line tokenizer and argument parser are used as for the rest of the\nconfiguration language. Words are split around consecutive series of one or\nmore unquoted spaces or tabs, and are reassembled together using a single space\nto delimit them before evaluation, in order to save the user from having to\nquote the entire line. But this also means that spaces surrounding commas or\nparenthesis are definitely part of the value, which is not always expected.\nFor example, the expression below:\n\n   .if defined( HAPROXY_MWORKER )\n\nwill test for the existence of variable \" HAPROXY_MWORKER \" (with spaces),\nand this one:\n\n   .if streq(\"$ENABLE_SSL\",     1)\n\nwill compare the environment variable \"ENABLE_SSL\" to the value \" 1\" (with a\nsingle leading space). The reason is the line is first split into words like\nthis:\n\n   .if streq(\"$ENABLE_SSL\",     1)\n  |---|--------------------|   |--|\n    1           2               3\n\nthen the weak quoting is applied and environment variable \"$ENABLE_SSL\" is\nresolved (let's say for example that ENABLE_SSL=0), and finally the words are\nreassembled into a single string by placing a single space between the words:\n\n   .if streq(0, 1)\n  |---|-------|--|\n    1     2     3\n\nand only then it is parsed as a single expression. The space that was inserted\nbetween the comma and \"1\" is still part of the argument value, making this\nargument \" 1\":\n\n   .if streq(0, 1)\n  |---|-----|-|--|\n    \\    \\    \\  \\_ argument2: \" 1\"\n     \\    \\    \\___ argument1: \"0\"\n      \\    \\_______ function: \"streq\"\n       \\___________ directive: \".if\"\n\nIt's visible here that even if ENABLE_SSL had been equal to \"1\", it wouldn't\nhave matched \" 1\" since the string would differ by one space.\n\nNote: as explained in section \"2.2. Quoting and escaping\", a good rule of thumb\n      is to never insert unneeded spaces inside expressions.\n\nNote that like in other languages, the AND operator has precedence over the OR\noperator, so that \"A && B || C && D\" evalues as \"(A && B) || (C && D)\".\n\nThe list of currently supported predicates is the following:\n\n  - defined(<name>)       : returns true if an environment variable <name>\n                            exists, regardless of its contents\n\n  - feature(<name>)       : returns true if feature <name> is listed as present\n                            in the features list reported by \"haproxy -vv\"\n                            (which means a <name> appears after a '+')\n\n  - openssl_version_atleast(<ver>) : returns true if the current openssl\n                            version is at least as recent as <ver> otherwise\n                            false.\n                            Libraries like LibreSSL, AWS-LC and WolfSSL also\n                            provide a pseudo OpenSSL version.\n\n```\n\nExample:```\n\nssllib_name_startswith(OpenSSL) && openssl_version_atleast(1.1.1)\n\n```\n\n```\n- openssl_version_before(<ver>) : returns true if the current openssl\n                          version is strictly older than <ver> otherwise\n                          false.\n                          Libraries like LibreSSL, AWS-LC and WolfSSL also\n                          provide a pseudo OpenSSL version.\n\n```\n\nExample:```\n\nopenssl_version_before(3.5.0)\n```\n\n```\n- ssllib_name_startswith(<name>)  : return true if the SSL library name\n                          HAProxy was linked with, starts with <name>.\n\n```\n\nExample:```\n\nssllib_name_startswith(wolfSSL)\n```\n\n```\n- streq(<str1>,<str2>)  : returns true only if the two strings are equal\n- strneq(<str1>,<str2>) : returns true only if the two strings differ\n- strstr(<str1>,<str2>) : returns true only if the second string is found in\n                          the first one.\n\n- version_atleast(<ver>): returns true if the current haproxy version is\n                          at least as recent as <ver> otherwise false. The\n                          version syntax is the same as shown by \"haproxy -v\"\n                          and missing components are assumed as being zero.\n\n- version_before(<ver>) : returns true if the current haproxy version is\n                          strictly older than <ver> otherwise false. The\n                          version syntax is the same as shown by \"haproxy -v\"\n                          and missing components are assumed as being zero.\n\n- enabled(<opt>)        : returns true if the option <opt> is enabled at\n                          run-time. Only a subset of options are supported:\n                              POLL, EPOLL, KQUEUE, EVPORTS, SPLICE,\n                              GETADDRINFO, REUSEPORT, FAST-FORWARD,\n                              SERVER-SSL-VERIFY-NONE\n\n```\n\nExample:```\n\n# 1. HAPROXY_MWORKER variable is set automatically by HAProxy in master and\n# in worker process environments (see HAProxy variables matrix from\n# 2.3. Environment variables). Its presence enables an additional listener.\n\nglobal\n  master-worker\n\n.if defined(HAPROXY_MWORKER)\n    listen mwcli_px\n       bind :1111\n       ...\n.endif\n\n# 2. HAPROXY_BRANCH is set automatically by HAProxy in master and in worker\n# process environments (see HAProxy variables matrix from 2.3. Environment\n# variables). We check HAPROXY_BRANCH value and conditionally enable\n# mworker-max-reloads parameter.\n\nglobal\n  master-worker\n\n.if streq(\"$HAPROXY_BRANCH\",3.1)\n     mworker-max-reloads 5\n.endif\n\n# 3. Some arbitrary environment variables are set by user in the global\n# section. If HAProxy is started in master-worker mode, they are presented in\n# master and in worker process environments. We check values of these\n# variables and conditionally enable ports 80 and 443. Environment variables\n# checks can be mixed with features and version checks.\n\nglobal\n  setenv WITH_SSL yes\n  unsetenv SSL_ONLY\n\n.if strneq(\"$SSL_ONLY\",yes)\n       bind :80\n.endif\n\n.if streq(\"$WITH_SSL\",yes)\n  .if feature(OPENSSL)\n       bind :443 ssl crt ...\n  .endif\n.endif\n\n.if feature(OPENSSL) && (streq(\"$WITH_SSL\",yes) || streq(\"$SSL_ONLY\",yes))\n       bind :443 ssl crt ...\n.endif\n\n.if version_atleast(2.4-dev19)\n    profiling.memory on\n.endif\n\n.if !feature(OPENSSL)\n    .alert \"SSL support is mandatory\"\n.endif\n\n```\n\n```\nFour other directives are provided to report some status:\n\n  - .diag \"message\"    : emit this message only when in diagnostic mode (-dD)\n  - .notice \"message\"  : emit this message at level NOTICE\n  - .warning \"message\" : emit this message at level WARNING\n  - .alert \"message\"   : emit this message at level ALERT\n\nMessages emitted at level WARNING may cause the process to fail to start if\n\"zero-warning\" is enabled. Messages emitted at level ALERT will always cause a\nfatal error. These can be used to detect some inappropriate conditions and\nprovide advice to the user.\n\n```\n\nExample:```\n\n.if \"${A}\"\n  .if \"${B}\"\n     .notice \"A=1, B=1\"\n  .elif \"${C}\"\n     .notice \"A=1, B=0, C=1\"\n  .elif \"${D}\"\n     .warning \"A=1, B=0, C=0, D=1\"\n  .else\n     .alert \"A=1, B=0, C=0, D=0\"\n  .endif\n.else\n     .notice \"A=0\"\n.endif\n\n.diag \"WTA/2021-05-07: replace 'redirect' with 'return' after switch to 2.4\"\n      http-request redirect location /goaway if ABUSE\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.5. Time format", "content": "## [2.5.](#2.5)Time format\n\n```\nSome parameters involve values representing time, such as timeouts. These\nvalues are generally expressed in milliseconds (unless explicitly stated\notherwise) but may be expressed in any other unit by suffixing the unit to the\nnumeric value. It is important to consider this because it will not be repeated\nfor every keyword. Supported units are :\n\n  - us : microseconds. 1 microsecond = 1/1000000 second\n  - ms : milliseconds. 1 millisecond = 1/1000 second. This is the default.\n  - s  : seconds. 1s = 1000ms\n  - m  : minutes. 1m = 60s = 60000ms\n  - h  : hours.   1h = 60m = 3600s = 3600000ms\n  - d  : days.    1d = 24h = 1440m = 86400s = 86400000ms\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.6. Size format", "content": "## [2.6.](#2.6)Size format\n\n```\nSome parameters involve values representing size, such as bandwidth limits.\nThese values are generally expressed in bytes (unless explicitly stated\notherwise) but may be expressed in any other unit by suffixing the unit to the\nnumeric value. It is important to consider this because it will not be repeated\nfor every keyword. Supported units are case insensitive :\n\n  - k : kilobytes. 1 kilobyte = 1024 bytes\n  - m : megabytes. 1 megabyte = 1048576 bytes\n  - g : gigabytes. 1 gigabyte = 1073741824 bytes\n\nBoth time and size formats require integers, decimal notation is not allowed.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.7. Name format for maps and ACLs", "content": "## [2.7.](#2.7)Name format for maps and ACLs\n\n```\nIt is possible to use a list of pattern for maps or ACLs. A list of pattern is\nidentified by its name and may be used at different places in the\nconfiguration. List of pattern are split on three categories depending on\nthe name format:\n\n  * Lists of pattern based on regular files: It is the default case. The\n    filename, absolute or relative, is used as name. The file must exist\n    otherwise an error is triggered. But it may be empty. The \"file@\" prefix\n    may also be specified but it is not part of the name identifying the\n    list. A filename, with or without the prefix, references the same list of\n    pattern.\n\n  * Lists of pattern based on optional files: The filename must be preceded by\n    \"opt@\" prefix. The file existence is optional. If the file exists, its\n    content is loaded but no error is reported if not. The prefix is not part\n    of the name identifying the list. It means, for a given filename, Optional\n    files and regular files reference the same list of pattern.\n\n  * Lists of pattern based on virtual files: The name is just an identifier. It\n    is not a reference to any file. \"virt@\" prefix must be used. It is part of\n    the name. Thus it cannot be mixed with other kind of lists.\n\nVirtual files are useful when patterns are fully dynamically managed with no\npatterns on startup and on reload. Optional files may be used under the same\nconditions. But patterns can be dumped in the file, via an external script based\non the \"show map\" CLI command for instance. This way, it is possible to keep\npatterns on reload.\n\nNote: Even if it is unlikely, it means no regular file starting with \"file@\",\n      \"opt@\" or \"virt@\" can be loaded, except by adding \"./\" explicitly in\n      front of the filename (for instance \"file@./virt@map\").\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.8. Variables", "content": "## [2.8.](#2.8)Variables\n\n```\nIn HAProxy configuration, variables can be used in sample fetch functions,\nconverters, log-format strings or TCP/HTTP actions. Process-wide variables can\nbe defined, globally accessible for the whole life of the process. Some others\nhave a shorter lifespan. Variables are similar to those found in shell\nscripts. It is a symbolic name for a chunk of memory. The variables size is not\nlimited and is dynamically allocated. So they must be used with caution,\nespecially for an intensive usage. However, it is possible to limit the maximum\namount of memory used by the variables by setting \"tune.vars\" global parameters.\n\nVariables must be designated using the format \"<scope>.<name>\". The <scope> is\na single word indicating the life time of the variable. The <name> part, inside\na scope, may only contain characters 'a-z', 'A-Z', '0-9' and '_'. It is unique\nin this scope but the same name in different scopes can be used and refers to\ndifferent variables. Supported scopes are:\n\n  * proc  : for variables known during the whole process lifespan and globally\n            accessible. \"proc\" variables can be manipulated from the CLI using\n            \"get var\" and \"set var\" commands. They can also be set from\n            \"global\" sections via \"set-varThis keyword is available in sections :Process management and securityAlphabetically sorted actions referenceConverters\" and \"set-var-fmtThis keyword is available in sections :Process management and securityAlphabetically sorted actions reference\" directives.\n\n  * sess  : for variables known during the whole lifespan of a session. \"sess\"\n            variables are private to a session, not visbile from outside it and\n            not shared with other sessions.\n\n  * txn   : for variables known during the whole lifespan of a transaction. \"txn\"\n            variables are private to a stream, not visible from outside it and\n            not shared with other streams.\n\n  * req   : for variables known during the request processing for a specific\n            stream. \"req\" variables are visible from the stream creation and\n            until the first server connection attempt. They are private to a\n            stream, not visible from outside it and not shared with other\n            streams. There is no overlap at all between \"req\" and \"res\"\n            variables.\n\n  * res   : for variables known during the response processing for a specific\n            stream. \"res\" variables are visible from the first server\n            connection attempt and until the stream destruction. They are\n            private to a stream, not visible from outside it and not shared\n            with other streams. There is no overlap at all between \"req\" and\n            \"res\" variables.\n\n  * check : for variables known during a health-check execution. \"check\"\n            variables are private to a health-check, not visible from outside\n            it and are not shared with other health-checks. They can be set\n            using dedicated \"tcp-check\" or \"http-check\" directives.\n\nDepending on the context, extra scopes referencing the parent of a current\nstream can be used:\n\n  * psess : same as \"sess\" but using the session of the parent stream, if any.\n\n  * ptxn  : same as \"txn\" but using the transaction of the parent stream, if\n            any.\n\n  * preq  : same as \"req\" but using the parent stream, if any. \"preq\"\n            variables are only accessible during request processing of the\n            parent stream.\n\n  * pres  : same as \"res\" but using the parent stream, if any. \"pres\"\n            variables are only accessible during response processing of the\n            parent stream.\n\nScopes referencing the parent stream are usable from the moment it is defined.\nMost of time, there is no parent stream. But, if applicable, this will be\nexplicitly specified. For now, it is only possible to retrieve the value of\nvariables defined in a scope of the parent stream. It is not possible to set\nnor unset such variables. Usually a child stream performs some processing for\nthe parent at a precise moment and prevents it from making progress until the\noperation it does is completed. This means that the parent may be stopped in\nthe middle of a request processing or a response processing for example. As\nsuch, certain scopes will not be available from the child stream. For example\nif a request is subject to some analysis performed by a child stream, this\nchild stream will not find any variable in the \"pres\" scope since the parent is\nnot processing a response, hence doesn't have any variables in its \"res\" scope.\n\nThe content of a variable is the result of the evaluation of a sample fetch\nexpression and it inherits of the output type of this expression. It is\nimportant when the variable is used because its type must be compatible with\nits usage. For instance a variable containing a string used in \"add()\"\nconverter must be convertible to a valid integer to succeed. It is especially\ntrue when variables are compared to static value. The right matching method\nmust be used.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.9. Address formats", "content": "## [2.9.](#2.9)Address formats\n\n```\nSeveral statements as \"bind, \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\", \"nameserver\" and \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\" requires an\naddress.\n\nThis address can be a host name, an IPv4 address, an IPv6 address, or '*'.\nThe '*' is equal to the special address \"0.0.0.0\" and can be used, in the case\nof \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" or \"dgram-bind\" to listen on all IPv4 of the system.The IPv6\nequivalent is '::'.\n\nDepending of the statement, a port or port range follows the IP address. This\nis mandatory on 'bind' statement, optional on 'server'.\n\nThis address can also begin with a slash '/'. It is considered as the \"unix\"\nfamily, and '/' and following characters must be present the path.\n\nDefault socket type or transport method \"datagram\" or \"stream\" depends on the\nconfiguration statement showing the address. Indeed, 'bind' and 'server' will\nuse a \"stream\" socket type by default whereas 'log', 'nameserver' or\n'dgram-bind' will use a \"datagram\".\n\nOptionally, a prefix could be used to force the address family and/or the\nsocket type and the transport method.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.9.1. Address family prefixes", "content": "### [2.9.1.](#2.9.1)Address family prefixes\n\n```\n'abns@<name>' following <name> is an abstract namespace (Linux only).\n\n'abnsz@<name>' following <name> is a zero-terminated abstract namespace\n               (Linux only).\n\n'fd@<n>'      following address is a file descriptor <n> inherited from the\n              parent. The fd must be bound and may or may not already be\n              listening.\n\n'ip@<address>[:port1[-port2]]' following <address> is considered as an IPv4 or\n                               IPv6 address depending on the syntax. Depending\n                               on the statement using this address, a port or\n                               a port range may or must be specified.\n\n'ipv4@<address>[:port1[-port2]]' following <address> is always considered as\n                                 an IPv4 address. Depending on the statement\n                                 using this address, a port or a port range\n                                 may or must be specified.\n\n'ipv6@<address>[:port1[-port2]]' following <address> is always considered as\n                                 an IPv6 address. Depending on the statement\n                                 using this address, a port or a port range\n                                 may or must be specified.\n\n'sockpair@<n>' following address is the file descriptor of a connected unix\n               socket or of a socketpair. During a connection, the initiator\n               creates a pair of connected sockets, and passes one of them\n               over the FD to the other end. The listener waits to receive\n               the FD from the unix socket and uses it as if it were the FD\n               of an accept(). Should be used carefully.\n\n               Bugs: This protocol is known to be unreliable on macOS because\n               of an issue in the macOS sendmsg(2) implementation. The\n               connection might not be accepted correctly.\n\n\n'unix@<path>'  following string is considered as a UNIX socket <path>. this\n               prefix is useful to declare an UNIX socket path which don't\n               start by slash '/'.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.9.2. Socket type prefixes", "content": "### [2.9.2.](#2.9.2)Socket type prefixes\n\n```\nPrevious \"Address family prefixes\" can also be prefixed to force the socket\ntype and the transport method. The default depends of the statement using\nthis address but in some cases the user may force it to a different one.\nThis is the case for \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\" statement where the default is syslog over UDP\nbut we could force to use syslog over TCP.\n\nThose prefixes were designed for internal purpose and users should instead use\nuse aliases of the next section \"2.9.3 Protocol prefixes\". However these can\nsometimes be convenient, for example in combination with inherited sockets\nknown by their file descriptor number, in which case the address family is \"fd\"\nand the socket type must be declared.\n\nIf users need one those prefixes to perform what they expect because\nthey can not configure the same using the protocol prefixes, they should\nreport this to the maintainers.\n\n'stream+<family>@<address>' forces socket type and transport method\n                            to \"stream\"\n\n'dgram+<family>@<address>'  forces socket type and transport method\n                            to \"datagram\".\n\n'quic+<family>@<address>'   forces socket type to \"datagram\" and transport\n                            method to \"stream\".\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.9.3. Protocol prefixes", "content": "### [2.9.3.](#2.9.3)Protocol prefixes\n\n```\n'quic4@<address>[:port1[-port2]]' following <address> is always considered as\n                                  an IPv4 address but socket type is forced to\n                                  \"datagram\" and the transport method is forced\n                                  to \"stream\". Depending on the statement using\n                                  this address, a UDP port or port range can or\n                                  must be specified. It is equivalent to\n                                  \"quic+ipv4@\".\n\n'quic6@<address>[:port1[-port2]]' following <address> is always considered as\n                                  an IPv6 address but socket type is forced to\n                                  \"datagram\" and the transport method is forced\n                                  to \"stream\". Depending on the statement using\n                                  this address, a UDP port or port range can or\n                                  must be specified. It is equivalent to\n                                  \"quic+ipv6@\".\n\n'tcp@<address>[:port1[-port2]]' following <address> is considered as an IPv4\n                                or IPv6 address depending of the syntax but\n                                socket type and transport method is forced to\n                                \"stream\". Depending on the statement using\n                                this address, a port or a port range can or\n                                must be specified. It is considered as an alias\n                                of 'stream+ip@'.\n\n'tcp4@<address>[:port1[-port2]]' following <address> is always considered as\n                                 an IPv4 address but socket type and transport\n                                 method is forced to \"stream\". Depending on the\n                                 statement using this address, a port or port\n                                 range can or must be specified.\n                                 It is considered as an alias of 'stream+ipv4@'.\n\n'tcp6@<address>[:port1[-port2]]' following <address> is always considered as\n                                 an IPv6 address but socket type and transport\n                                 method is forced to \"stream\". Depending on the\n                                 statement using this address, a port or port\n                                 range can or must be specified.\n                                 It is considered as an alias of 'stream+ipv4@'.\n\n'mptcp@<address>[:port1[-port2]]' following <address> is considered as an IPv4\n                                  or IPv6 address depending of the syntax but\n                                  socket type and transport method is forced to\n                                  \"stream\", with the MPTCP protocol. Depending\n                                  on the statement using this address, a port or\n                                  a port range can or must be specified.\n\n'mptcp4@<address>[:port1[-port2]]' following <address> is always considered as\n                                   an IPv4 address but socket type and transport\n                                   method is forced to \"stream\", with the MPTCP\n                                   protocol. Depending on the statement using\n                                   this address, a port or port range can or\n                                   must be specified.\n\n'mptcp6@<address>[:port1[-port2]]' following <address> is always considered as\n                                   an IPv6 address but socket type and transport\n                                   method is forced to \"stream\", with the MPTCP\n                                   protocol. Depending on the statement using\n                                   this address, a port or port range can or\n                                   must be specified.\n\n'udp@<address>[:port1[-port2]]' following <address> is considered as an IPv4\n                                or IPv6 address depending of the syntax but\n                                socket type and transport method is forced to\n                                \"datagram\". Depending on the statement using\n                                this address, a port or a port range can or\n                                must be specified. It is considered as an alias\n                                of 'dgram+ip@'.\n\n'udp4@<address>[:port1[-port2]]' following <address> is always considered as\n                                 an IPv4 address but socket type and transport\n                                 method is forced to \"datagram\". Depending on\n                                 the statement using this address, a port or\n                                 port range can or must be specified.\n                                 It is considered as an alias of 'dgram+ipv4@'.\n\n'udp6@<address>[:port1[-port2]]' following <address> is always considered as\n                                 an IPv6 address but socket type and transport\n                                 method is forced to \"datagram\". Depending on\n                                 the statement using this address, a port or\n                                 port range can or must be specified.\n                                 It is considered as an alias of 'dgram+ipv4@'.\n\n'uxdg@<path>'    following string is considered as a unix socket <path> but\n                 transport method is forced to \"datagram\". It is considered as\n                 an alias of 'dgram+unix@'.\n\n'uxst@<path>'    following string is considered as a unix socket <path> but\n                 transport method is forced to \"stream\". It is considered as\n                 an alias of 'stream+unix@'.\n\nIn future versions, other prefixes could be used to specify protocols like\nQUIC which proposes stream transport based on socket of type \"datagram\".\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "2.10. Examples", "content": "## [2.10.](#2.10)Examples\n\n```\n    # Simple configuration for an HTTP proxy listening on port 80 on all\n    # interfaces and forwarding requests to a single backend \"servers\" with a\n    # single server \"server1\" listening on 127.0.0.1:8000\n    global\n        daemon\n        maxconn 256\n\n    defaults\n        mode http\n        timeout connect 5000ms\n        timeout client 50000ms\n        timeout server 50000ms\n\n    frontend http-in\n        bind *:80\n        default_backend servers\n\n    backend servers\n        server server1 127.0.0.1:8000 maxconn 32\n\n\n    # The same configuration defined with a single listen block. Shorter but\n    # less expressive, especially in HTTP mode.\n    global\n        daemon\n        maxconn 256\n\n    defaults\n        mode http\n        timeout connect 5000ms\n        timeout client 50000ms\n        timeout server 50000ms\n\n    listen http-in\n        bind *:80\n        server server1 127.0.0.1:8000 maxconn 32\n\n\nAssuming haproxy is in $PATH, test these configurations in a shell with:\n\n    $ sudo haproxy -f configuration.conf -c\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "3. Global parameters", "content": "# [3.](#3)Global parameters\n\n```\nParameters in the \"global\" section are process-wide and often OS-specific. They\nare generally set once for all and do not need being changed once correct. Some\nof them have command-line equivalents.\n\nThe following keywords are supported in the \"global\" section :\n\n * Process management and security\n   - 51degrees-allow-unmatched\n   - 51degrees-cache-size\n   - 51degrees-data-file\n   - 51degrees-difference\n   - 51degrees-drift\n   - 51degrees-property-name-list\n   - 51degrees-property-separator\n   - 51degrees-use-performance-graph\n   - 51degrees-use-predictive-graph\n   - ca-base\n   - chroot\n   - cluster-secret\n   - cpu-map\n   - cpu-policy\n   - cpu-set\n   - crt-base\n   - daemon\n   - default-path\n   - description\n   - deviceatlas-json-file\n   - deviceatlas-log-level\n   - deviceatlas-properties-cookie\n   - deviceatlas-separator\n   - dns-accept-family\n   - expose-deprecated-directives\n   - expose-experimental-directives\n   - external-check\n   - fd-hard-limit\n   - gid\n   - grace\n   - group\n   - h1-accept-payload-with-any-method\n   - h1-case-adjust\n   - h1-case-adjust-file\n   - h1-do-not-close-on-insecure-transfer-encoding\n   - h2-workaround-bogus-websocket-clients\n   - hard-stop-after\n   - harden.reject-privileged-ports.tcp\n   - harden.reject-privileged-ports.quic\n   - insecure-fork-wanted\n   - insecure-setuid-wanted\n   - issuers-chain-path\n   - key-base\n   - limited-quic\n   - localpeer\n   - log\n   - log-send-hostname\n   - log-tag\n   - lua-load\n   - lua-load-per-thread\n   - lua-prepend-path\n   - mworker-max-reloads\n   - nbthread\n   - no-quic\n   - node\n   - numa-cpu-mapping\n   - ocsp-update.disable\n   - ocsp-update.maxdelay\n   - ocsp-update.mindelay\n   - ocsp-update.httpproxy\n   - ocsp-update.mode\n   - pidfile\n   - pp2-never-send-local\n   - presetenv\n   - prealloc-fd\n   - resetenv\n   - set-dumpable\n   - set-var\n   - setenv\n   - ssl-default-bind-ciphers\n   - ssl-default-bind-ciphersuites\n   - ssl-default-bind-client-sigalgs\n   - ssl-default-bind-curves\n   - ssl-default-bind-options\n   - ssl-default-bind-sigalgs\n   - ssl-default-server-ciphers\n   - ssl-default-server-ciphersuites\n   - ssl-default-server-client-sigalgs\n   - ssl-default-server-curves\n   - ssl-default-server-options\n   - ssl-default-server-sigalgs\n   - ssl-dh-param-file\n   - ssl-propquery\n   - ssl-provider\n   - ssl-provider-path\n   - ssl-security-level\n   - ssl-server-verify\n   - ssl-skip-self-issued-ca\n   - stats\n   - stats-file\n   - strict-limits\n   - uid\n   - ulimit-n\n   - unix-bind\n   - unsetenv\n   - user\n   - wurfl-cache-size\n   - wurfl-data-file\n   - wurfl-information-list\n   - wurfl-information-list-separator\n\n * Performance tuning\n   - busy-polling\n   - max-spread-checks\n   - maxcompcpuusage\n   - maxcomprate\n   - maxconn\n   - maxconnrate\n   - maxpipes\n   - maxsessrate\n   - maxsslconn\n   - maxsslrate\n   - maxzlibmem\n   - no-memory-trimming\n   - noepoll\n   - noevports\n   - nogetaddrinfo\n   - nokqueue\n   - nopoll\n   - noreuseport\n   - nosplice\n   - profiling.memory\n   - profiling.tasks\n   - server-state-base\n   - server-state-file\n   - spread-checks\n   - ssl-engine\n   - ssl-mode-async\n   - tune.applet.zero-copy-forwarding\n   - tune.buffers.limit\n   - tune.buffers.reserve\n   - tune.bufsize\n   - tune.bufsize.small\n   - tune.comp.maxlevel\n   - tune.disable-fast-forward\n   - tune.disable-zero-copy-forwarding\n   - tune.epoll.mask-events\n   - tune.events.max-events-at-once\n   - tune.fail-alloc\n   - tune.fd.edge-triggered\n   - tune.h1.zero-copy-fwd-recv\n   - tune.h1.zero-copy-fwd-send\n   - tune.h2.be.glitches-threshold\n   - tune.h2.be.initial-window-size\n   - tune.h2.be.max-concurrent-streams\n   - tune.h2.be.rxbuf\n   - tune.h2.fe.glitches-threshold\n   - tune.h2.fe.initial-window-size\n   - tune.h2.fe.max-concurrent-streams\n   - tune.h2.fe.max-total-streams\n   - tune.h2.fe.rxbuf\n   - tune.h2.header-table-size\n   - tune.h2.initial-window-size\n   - tune.h2.max-concurrent-streams\n   - tune.h2.max-frame-size\n   - tune.h2.zero-copy-fwd-send\n   - tune.http.cookielen\n   - tune.http.logurilen\n   - tune.http.maxhdr\n   - tune.idle-pool.shared\n   - tune.idletimer\n   - tune.lua.bool-sample-conversion\n   - tune.lua.burst-timeout\n   - tune.lua.forced-yield\n   - tune.lua.log.loggers\n   - tune.lua.log.stderr\n   - tune.lua.maxmem\n   - tune.lua.service-timeout\n   - tune.lua.session-timeout\n   - tune.lua.task-timeout\n   - tune.max-checks-per-thread\n   - tune.maxaccept\n   - tune.maxpollevents\n   - tune.maxrewrite\n   - tune.max-rules-at-once\n   - tune.memory.hot-size\n   - tune.pattern.cache-size\n   - tune.peers.max-updates-at-once\n   - tune.pipesize\n   - tune.pool-high-fd-ratio\n   - tune.pool-low-fd-ratio\n   - tune.pt.zero-copy-forwarding\n   - tune.quic.cc-hystart\n   - tune.quic.cc.cubic.min-losses\n   - tune.quic.disable-tx-pacing\n   - tune.quic.disable-udp-gso\n   - tune.quic.frontend.glitches-threshold\n   - tune.quic.frontend.max-data-size\n   - tune.quic.frontend.max-idle-timeout\n   - tune.quic.frontend.max-streams-bidi\n   - tune.quic.frontend.max-tx-mem\n   - tune.quic.frontend.stream-data-ratio\n   - tune.quic.frontend.default-max-window-size\n   - tune.quic.max-frame-loss\n   - tune.quic.reorder-ratio\n   - tune.quic.retry-threshold\n   - tune.quic.socket-owner\n   - tune.quic.zero-copy-fwd-send\n   - tune.renice.runtime\n   - tune.renice.startup\n   - tune.rcvbuf.backend\n   - tune.rcvbuf.client\n   - tune.rcvbuf.frontend\n   - tune.rcvbuf.server\n   - tune.recv_enough\n   - tune.ring.queues\n   - tune.runqueue-depth\n   - tune.sched.low-latency\n   - tune.sndbuf.backend\n   - tune.sndbuf.client\n   - tune.sndbuf.frontend\n   - tune.sndbuf.server\n   - tune.stick-counters\n   - tune.ssl.cachesize\n   - tune.ssl.capture-buffer-size\n   - tune.ssl.capture-cipherlist-size (deprecated)\n   - tune.ssl.certificate-compression\n   - tune.ssl.default-dh-param\n   - tune.ssl.force-private-cache\n   - tune.ssl.hard-maxrecord\n   - tune.ssl.keylog\n   - tune.ssl.lifetime\n   - tune.ssl.maxrecord\n   - tune.ssl.ssl-ctx-cache-size\n   - tune.ssl.ocsp-update.maxdelay (deprecated)\n   - tune.ssl.ocsp-update.mindelay (deprecated)\n   - tune.takeover-other-tg-connections\n   - tune.vars.global-max-size\n   - tune.vars.proc-max-size\n   - tune.vars.reqres-max-size\n   - tune.vars.sess-max-size\n   - tune.vars.txn-max-size\n   - tune.zlib.memlevel\n   - tune.zlib.windowsize\n\n * Debugging\n   - anonkey\n   - debug.counters\n   - force-cfg-parser-pause\n   - quiet\n   - warn-blocked-traffic-after\n   - zero-warning\n\n * HTTPClient\n   - httpclient.resolvers.disabled\n   - httpclient.resolvers.id\n   - httpclient.resolvers.prefer\n   - httpclient.retries\n   - httpclient.ssl.ca-file\n   - httpclient.ssl.verify\n   - httpclient.timeout.connect\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "3.1. Process management and security", "content": "## [3.1.](#3.1)Process management and security\n\n**[51degrees-data-file](#3.1-51degrees-data-file)**<file path>```\nThe path of the 51Degrees data file to provide device detection services. The\nfile should be unzipped and accessible by HAProxy with relevant permissions.\n\nPlease note that this option is only available when HAProxy has been\ncompiled with USE_51DEGREES.\n\n```\n\n**[51degrees-property-name-list](#3.1-51degrees-property-name-list)**[<string>...]```\nA list of 51Degrees property names to be load from the dataset. A full list\nof names is available on the 51Degrees website:\nhttps://51degrees.com/resources/property-dictionary\n\nPlease note that this option is only available when HAProxy has been\ncompiled with USE_51DEGREES.\n\n```\n\n**[51degrees-property-separator](#3.1-51degrees-property-separator)**<char>```\nA char that will be appended to every property value in a response header\ncontaining 51Degrees results. If not set that will be set as ','.\n\nPlease note that this option is only available when HAProxy has been\ncompiled with USE_51DEGREES.\n\n```\n\n**[51degrees-cache-size](#3.1-51degrees-cache-size)**<number>```\nSets the size of the 51Degrees converter cache to <number> entries. This\nis an LRU cache which reminds previous device detections and their results.\nBy default, this cache is disabled.\n\nPlease note that this option is only available when HAProxy has been\ncompiled with USE_51DEGREES.\n\n```\n\n**[51degrees-use-performance-graph](#3.1-51degrees-use-performance-graph)**{ on | off }```\nEnables ('on') or disables ('off') the use of the performance graph in\nthe detection process. The default value depends on 51Degrees library.\n\nPlease note that this option is only available when HAProxy has been\ncompiled with USE_51DEGREES and 51DEGREES_VER=4.\n\n```\n\n**[51degrees-use-predictive-graph](#3.1-51degrees-use-predictive-graph)**{ on | off }```\nEnables ('on') or disables ('off') the use of the predictive graph in\nthe detection process. The default value depends on 51Degrees library.\n\nPlease note that this option is only available when HAProxy has been\ncompiled with USE_51DEGREES and 51DEGREES_VER=4.\n\n```\n\n**[51degrees-drift](#3.1-51degrees-drift)**<number>```\nSets the drift value that a detection can allow.\n\nPlease note that this option is only available when HAProxy has been\ncompiled with USE_51DEGREES and 51DEGREES_VER=4.\n\n```\n\n**[51degrees-difference](#3.1-51degrees-difference)**<number>```\nSets the difference value that a detection can allow.\n\nPlease note that this option is only available when HAProxy has been\ncompiled with USE_51DEGREES and 51DEGREES_VER=4.\n\n```\n\n**[51degrees-allow-unmatched](#3.1-51degrees-allow-unmatched)**{ on | off }```\nEnables ('on') or disables ('off') the use of unmatched nodes in the\ndetection process. The default value depends on 51Degrees library.\n\nPlease note that this option is only available when HAProxy has been\ncompiled with USE_51DEGREES and 51DEGREES_VER=4.\n\n```\n\n**[acme.scheduler](#3.1-acme.scheduler)**{ auto | off }```\nEnable or disable the ACME scheduler.\n\nThe ACME scheduler starts at HAProxy startup, it will loop over the\ncertificates and start an ACME renewal task when the notAfter value is past\ncurtime + (notAfter - notBefore) / 12, or 7 days if notBefore is not defined.\nThe scheduler will then sleep and wakeup after 12 hours.\n\nThe default value is \"auto\".\n\n```\n\n**See also:**acme**[ca-base](#3.1-ca-base)**<dir>```\nAssigns a default directory to fetch SSL CA certificates and CRLs from when a\nrelative path is used with \"ca-fileThis keyword is available in sections :Bind optionsServer and default-server options\", \"ca-verify-file\" or \"crl-fileThis keyword is available in sections :Bind optionsServer and default-server options\"\ndirectives. Absolute locations specified in \"ca-fileThis keyword is available in sections :Bind optionsServer and default-server options\", \"ca-verify-file\" and\n\"crl-fileThis keyword is available in sections :Bind optionsServer and default-server options\" prevail and ignore \"ca-base\".\n\n```\n\n**[chroot](#3.1-chroot)**<jail dir>```\nChanges current directory to <jail dir> and performs a chroot() there before\ndropping privileges. This increases the security level in case an unknown\nvulnerability would be exploited, since it would make it very hard for the\nattacker to exploit the system. This only works when the process is started\nwith superuser privileges. It is important to ensure that <jail_dir> is both\nempty and non-writable to anyone.\n\n```\n\n**[close-spread-time](#3.1-close-spread-time)**<time>```\nDefine a time window during which idle connections and active connections\nclosing is spread in case of soft-stop. After a SIGUSR1 is received and the\ngrace period is over (if any), the idle connections will all be closed at\nonce if this option is not set, and active HTTP or HTTP2 connections will be\nended after the next request is received, either by appending a \"Connection:\nclose\" line to the HTTP response, or by sending a GOAWAY frame in case of\nHTTP2. When this option is set, connection closing will be spread over this\nset <time>.\nIf the close-spread-time is set to \"infinite\", active connection closing\nduring a soft-stop will be disabled. The \"Connection: close\" header will not\nbe added to HTTP responses (or GOAWAY for HTTP2) anymore and idle connections\nwill only be closed once their timeout is reached (based on the various\ntimeouts set in the configuration).\n\n```\n\nArguments :```\n<time>  is a time window (by default in milliseconds) during which\n        connection closing will be spread during a soft-stop operation, or\n        \"infinite\" if active connection closing should be disabled.\n```\n\n```\nIt is recommended to set this setting to a value lower than the one used in\nthe \"hard-stop-after\" option if this one is used, so that all connections\nhave a chance to gracefully close before the process stops.\n\n```\n\n**See also:**grace, hard-stop-after, idle-close-on-response**[cluster-secret](#3.1-cluster-secret)**<secret>```\nDefine an ASCII string secret shared between several nodes belonging to the\nsame cluster. It could be used for different usages. It is at least used to\nderive stateless reset tokens for all the QUIC connections instantiated by\nthis process. This is also the case to derive secrets used to encrypt Retry\ntokens.\n\nIf this parameter is not set, a random value will be selected on process\nstartup. This allows to use features which rely on it, albeit with some\nlimitations.\n\n```\n\n**[cpu-map](#3.1-cpu-map)**[auto:]<thread-group>[/<thread-set>]<cpu-set>[,...][...]```\nOn some operating systems, it is possible to bind a thread group or a thread\nto a specific CPU set. This means that the designated threads will never run\non other CPUs. The \"cpu-map\" directive specifies CPU sets for individual\nthreads or thread groups. The first argument is a thread group range,\noptionally followed by a thread set. These ranges have the following format:\n\n    all | odd | even | number[-[number]]\n\n<number> must be a number between 1 and 32 or 64, depending on the machine's\nword size. Any group IDs above 'thread-groups' and any thread IDs above the\nmachine's word size are ignored. All thread numbers are relative to the group\nthey belong to. It is possible to specify a range with two such number\ndelimited by a dash ('-'). It also is possible to specify all threads at once\nusing \"all\", only odd numbers using \"odd\" or even numbers using \"even\", just\nlike with the \"threadThis keyword is available in sections :Bind optionsFetching samples from internal states\" bind directive. The second and forthcoming arguments\nare CPU sets. Each CPU set is either a unique number starting at 0 for the\nfirst CPU or a range with two such numbers delimited by a dash ('-'). These\nCPU numbers and ranges may be repeated by delimiting them with commas or by\npassing more ranges as new arguments on the same line. Outside of Linux and\nBSD operating systems, there may be a limitation on the maximum CPU index to\neither 31 or 63. Multiple \"cpu-map\" directives may be specified, but each\n\"cpu-map\" directive will replace the previous ones when they overlap.\n\nRanges can be partially defined. The higher bound can be omitted. In such\ncase, it is replaced by the corresponding maximum value, 32 or 64 depending\non the machine's word size.\n\nThe prefix \"auto:\" can be added before the thread set to let HAProxy\nautomatically bind a set of threads to a CPU by incrementing threads and\nCPU sets. To be valid, both sets must have the same size. No matter the\ndeclaration order of the CPU sets, it will be bound from the lowest to the\nhighest bound. Having both a group and a thread range with the \"auto:\"\nprefix is not supported. Only one range is supported, the other one must be\na fixed number.\n\nNote that group ranges are supported for historical reasons. Nowadays, a lone\nnumber designates a thread group and must be 1 if thread-groups are not used,\nand specifying a thread range or number requires to prepend \"1/\" in front of\nit if thread groups are not used. Finally, \"1\" is strictly equivalent to\n\"1/all\" and designates all threads in the group.\n\n```\n\nExamples:```\n\ncpu-map 1/all 0-3 # bind all threads of the first group on the\n                  # first 4 CPUs\n\ncpu-map 1/1- 0-   # will be replaced by \"cpu-map 1/1-64 0-63\"\n                  # or \"cpu-map 1/1-32 0-31\" depending on the machine's\n                  # word size.\n\n# all these lines bind thread 1 to the cpu 0, the thread 2 to cpu 1\n# and so on.\ncpu-map auto:1/1-4   0-3\ncpu-map auto:1/1-4   0-1 2-3\ncpu-map auto:1/1-4   3 2 1 0\ncpu-map auto:1/1-4   3,2,1,0\n\n# bind each thread to exactly one CPU using all/odd/even keyword\ncpu-map auto:1/all   0-63\ncpu-map auto:1/even  0-31\ncpu-map auto:1/odd   32-63\n\n# invalid cpu-map because thread and CPU sets have different sizes.\ncpu-map auto:1/1-4   0    # invalid\ncpu-map auto:1/1     0-3  # invalid\n\n# map 40 threads of those 4 groups to individual CPUs\ncpu-map auto:1/1-10   0-9\ncpu-map auto:2/1-10   10-19\ncpu-map auto:3/1-10   20-29\ncpu-map auto:4/1-10   30-39\n\n# Map 80 threads to one physical socket and 80 others to another socket\n# without forcing assignment. These are split into 4 groups since no\n# group may have more than 64 threads.\ncpu-map 1/1-40   0-39,80-119    # node0, siblings 0 & 1\ncpu-map 2/1-40   0-39,80-119\ncpu-map 3/1-40   40-79,120-159  # node1, siblings 0 & 1\ncpu-map 4/1-40   40-79,120-159\n\n```\n\n**[cpu-policy](#3.1-cpu-policy)**<policy>```\nSelects the CPU allocation policy to be used.\n\nOn multi-CPU systems, there can be plenty of reasons for not using all\navailable CPU cores, and/or for grouping them into different thread groups,\nfor performance, latency, cost, or system-wide resource management. The\n\"cpu-set\" directive already allows to evict a number of them, but once done,\nit is necessary to decide how to assign the remaining ones to threads and\nthread groups.\n\nThis mapping is normally performed using the \"cpu-map\" directive, though it\ncan be particularly difficult to maintain on heterogeneous systems.\n\nThe \"cpu-policy\" directive chooses between a small number of allocation\npolicies which one to use instead, when \"cpu-map\" is not used. The following\npolicies are currently supported:\n\n - none               no particular post-selection is performed. All enabled\n                      CPUs will be usable, and if the number of threads is\n                      not set, it will be set to the number of available CPUs\n                      but no more than 32 for 32-bit systems or 64 for 64-bit\n                      systems, per thread-group. The number of thread-groups,\n                      if not set, will be set to 1.\n\n - efficiency         exactly like \"group-by-ccx\" below, except that CPU\n                      clusters composed of cores whose performance is more\n                      than 25% above that of the next less performant one are\n                      evicted. These are typically \"big\" or \"performance\"\n                      cores. This means that if more than one type of CPU\n                      cores are detected, only the efficient one will be\n                      used. This can make sense for use with moderate loads\n                      when the most powerful cores need to be available to\n                      the application or a security component. Some modern\n                      CPUs have a large number of such efficient CPU cores\n                      which can collectively deliver a decent level of\n                      performance while using less power.\n\n - first-usable-node  if the CPUs were not previously restricted at boot (for\n                      example using the \"taskset\" utility), and if the\n                      \"nbthread\" directive was not set, then the first NUMA\n                      node with enabled CPUs will be used, and this number of\n                      CPUs will be used as the number of threads. A single\n                      thread group will be enabled with all of them, within\n                      the limit of 32 or 64 depending on the system. This is\n                      the default policy.\n\n - group-by-2-ccx     same as \"group-by-ccx\" below but create a group every\n                      two CCX. This can make sense on CPUs having many CCX of\n                      few cores each, to avoid creating many groups, or to\n                      smooth the distribution a little bit when not all cores\n                      are in use. Please note that it can have very bad\n                      performance effects when the communication between CCX\n                      is slow. This is generally recommended against.\n\n - group-by-2-clusters same as \"group-by-cluster\" but create a group every\n                      two clusters. This can make sense on CPUs having many\n                      clusters of few cores each, to avoid creating many\n                      groups, or to smooth the distribution a little bit when\n                      not all cores are in use. Please note that it can have\n                      very bad performance effects when the communication\n                      between clusters is slow. This is generally recommended\n                      against.\n\n - group-by-3-ccx     same as \"group-by-ccx\" below but create a group every\n                      three CCX. This can make sense on CPUs having many CCX\n                      of few cores each, to avoid creating many groups, or to\n                      smooth the distribution a little bit when not all cores\n                      are in use. Please note that it can have very bad\n                      performance effects when the communication between CCX\n                      is slow. This is generally recommended against.\n\n - group-by-3-clusters same as \"group-by-cluster\" but create a group every\n                      three clusters. This can make sense on CPUs having many\n                      clusters of few cores each, to avoid creating many\n                      groups, or to smooth the distribution a little bit when\n                      not all cores are in use. Please note that it can have\n                      very bad performance effects when the communication\n                      between clusters is slow. This is generally recommended\n                      against.\n\n - group-by-4-ccx     same as \"group-by-ccx\" below but create a group every\n                      four CCX. This can make sense on CPUs having many CCX\n                      of few cores each, to avoid creating many groups, or to\n                      smooth the distribution a little bit when not all cores\n                      are in use. Please note that it can have very bad\n                      performance effects when the communication between CCX\n                      is slow. This is generally recommended against.\n\n - group-by-4-clusters same as \"group-by-cluster\" but create a group every\n                      four clusters. This can make sense on CPUs having many\n                      clusters of few cores each, to avoid creating many\n                      groups, or to smooth the distribution a little bit when\n                      not all cores are in use. Please note that it can have\n                      very bad performance effects when the communication\n                      between clusters is slow. This is generally recommended\n                      against.\n\n - group-by-ccx       if neither \"nbthread\" not \"nbtgroups\" were set, then\n                      one thread group is created for each CPU core complex\n                      (\"CCX\") with available CPUs, each with as many threads\n                      as CPUs. A CCX groups CPUs having a similarly fast\n                      access to the last level cache (\"LLC\"), typically the\n                      L3 cache. On most modern machines, it is critical for\n                      performance not to mix CPUs from distant CCX in the\n                      same thread group. All threads of a group are then\n                      bound to all CPUs of the CCX so that intra-group\n                      communications remain local to the CCX without\n                      enforcing too strong a binding. The per-group thread\n                      limits and thread-group limits are respected. This is\n                      recommended on multi-socket and NUMA systems, as well\n                      as CPUs with bad inter-CCX latencies.\n\n - group-by-cluster   if neither \"nbthread\" not \"nbtgroups\" were set, then\n                      one thread group is created for each CPU cluster with\n                      available CPUs, each with as many threads as CPUs. All\n                      threads of a group are bound to all CPUs of the cluster\n                      so that intra-group communications remain local to the\n                      cluster without enforcing too strong a binding. The\n                      per-group thread limits and thread-group limits are\n                      respected. This is recommended on multi-socket and NUMA\n                      systems, as well as CPUs with bad inter-CCX latencies.\n                      On most server machines, clusters and CCX are the same,\n                      but on heterogenous machines (\"performance\" vs\n                      \"efficiency\" or \"big\" vs \"little\"), a cluster will\n                      generally be made of only a part of a CCX composed only\n                      of very similar CPUs (same type, +/-5% frequency\n                      difference max). The difference is visible on modern\n                      laptops and desktop machines used by developers and\n                      admins to validate setups.\n\n - performance        exactly like \"group-by-ccx\" above, except that CPU\n                      clusters composed of cores whose performance is less\n                      than 80% of those of the next more performant one are\n                      evicted. These are typically \"little\" or \"efficient\"\n                      cores, whose addition generally doesn't bring significant\n                      gains and can easily be counter-productive (e.g. TLS\n                      handshakes). Often, keeping such cores for other tasks\n                      such as network handling is much more effective. On\n                      development systems, these can also be used to run\n                      auxiliary tools such as load generators and monitoring\n                      tools.\n\n - resource           this is like \"group-by-cluster\" above, except that only\n                      the smallest and most efficient CPU cluster will be\n                      used, while all other ones will be ignored. This can be\n                      used to limit the resource usage to the strict minimum\n                      that still delivers decent performance, for example to\n                      try to further reduce power consumption or minimize the\n                      number of cores needed on some rented systems for a\n                      sidecar setup, in order to scale the system down more\n                      easily. Note that if a single cluster is present, it\n                      will still be fully used.\n\n```\n\n**See also:**\"[cpu-map](#cpu-map)\", \"[cpu-set](#cpu-set)\", \"[nbthread](#nbthread)\"**[cpu-set](#3.1-cpu-set)**<directive>...```\nAllows to symbolically describe what sets of CPUs to run on. The directive\nsupports the following keyword:\n  - reset              this undoes any previous limitation that could have\n                       been inherited by a service manager or a \"taskset\"\n                       command for example.\n  - drop-cpu <set>     do not bind to CPUs in this set\n  - only-cpu <set>     do not bind to CPUs not in this set\n  - drop-node <set>    do not bind to CPUs belonging to this NUMA node\n  - only-node <set>    do not bind to CPUs not belonging to this NUMA node\n  - drop-cluster <set> do not bind to CPUs on this hardware cluster number\n  - only-cluster <set> do not bind to CPUs on other hardware cluster number\n  - drop-core <set>    do not bind to CPUs on this hardware core number\n  - only-core <set>    do not bind to CPUs on other hardware core number\n  - drop-thread <set>  do not bind to CPUs on this hardware thread number\n  - only-thread <set>  do not bind to CPUs on other hardware thread number\n\n```\n\n**See also:**\"[cpu-policy](#cpu-policy)\"**[crt-base](#3.1-crt-base)**<dir>```\nAssigns a default directory to fetch SSL certificates from when a relative\npath is used with \"crtfile\" or \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\" directives. Absolute locations specified\nprevail and ignore \"crt-baseThis keyword is available in sections :Certificate StorageProcess management and security\".\n\n```\n\n**[daemon](#3.1-daemon)**```\nMakes the process fork into background. This is the recommended mode of\noperation. It is equivalent to the command line \"-D\" argument. It can be\ndisabled by the command line \"-db\" argument. This option is ignored in\nsystemd mode.\n\n```\n\n**[default-path](#3.1-default-path)**{ current | config | parent | origin<path>}```\nBy default HAProxy loads all files designated by a relative path from the\nlocation the process is started in. In some circumstances it might be\ndesirable to force all relative paths to start from a different location\njust as if the process was started from such locations. This is what this\ndirective is made for. Technically it will perform a temporary chdir() to\nthe designated location while processing each configuration file, and will\nreturn to the original directory after processing each file. It takes an\nargument indicating the policy to use when loading files whose path does\nnot start with a slash ('/'):\n  - \"current\" indicates that all relative files are to be loaded from the\n    directory the process is started in ; this is the default.\n\n  - \"config\" indicates that all relative files should be loaded from the\n    directory containing the configuration file. More specifically, if the\n    configuration file contains a slash ('/'), the longest part up to the\n    last slash is used as the directory to change to, otherwise the current\n    directory is used. This mode is convenient to bundle maps, errorfiles,\n    certificates and Lua scripts together as relocatable packages. When\n    multiple configuration files are loaded, the directory is updated for\n    each of them.\n\n  - \"parent\" indicates that all relative files should be loaded from the\n    parent of the directory containing the configuration file. More\n    specifically, if the configuration file contains a slash ('/'), \"..\"\n    is appended to the longest part up to the last slash is used as the\n    directory to change to, otherwise the directory is \"..\". This mode is\n    convenient to bundle maps, errorfiles,  certificates and Lua scripts\n    together as relocatable packages, but where each part is located in a\n    different subdirectory (e.g. \"config/\", \"certs/\", \"maps/\", ...).\n\n  - \"origin\" indicates that all relative files should be loaded from the\n    designated (mandatory) path. This may be used to ease management of\n    different HAProxy instances running in parallel on a system, where each\n    instance uses a different prefix but where the rest of the sections are\n    made easily relocatable.\n\nEach \"default-path\" directive instantly replaces any previous one and will\npossibly result in switching to a different directory. While this should\nalways result in the desired behavior, it is really not a good practice to\nuse multiple default-path directives, and if used, the policy ought to remain\nconsistent across all configuration files.\n\nWarning: some configuration elements such as maps or certificates are\nuniquely identified by their configured path. By using a relocatable layout,\nit becomes possible for several of them to end up with the same unique name,\nmaking it difficult to update them at run time, especially when multiple\nconfiguration files are loaded from different directories. It is essential to\nobserve a strict collision-free file naming scheme before adopting relative\npaths. A robust approach could consist in prefixing all files names with\ntheir respective site name, or in doing so at the directory level.\n\n```\n\n**[description](#3.1-description)**<text>```\nAdd a text that describes the instance.\n\nPlease note that it is required to escape certain characters (# for example)\nand this text is inserted into a html page so you should avoid using\n\"<\" and \">\" characters.\n\n```\n\n**[deviceatlas-json-file](#3.1-deviceatlas-json-file)**<path>```\nSets the path of the DeviceAtlas JSON data file to be loaded by the API.\nThe path must be a valid JSON data file and accessible by HAProxy process.\n\n```\n\n**[deviceatlas-log-level](#3.1-deviceatlas-log-level)**<value>```\nSets the level of information returned by the API. This directive is\noptional and set to 0 by default if not set.\n\n```\n\n**[deviceatlas-properties-cookie](#3.1-deviceatlas-properties-cookie)**<name>```\nSets the client cookie's name used for the detection if the DeviceAtlas\nClient-side component was used during the request. This directive is optional\nand set to DAPROPS by default if not set.\n\n```\n\n**[deviceatlas-separator](#3.1-deviceatlas-separator)**<char>```\nSets the character separator for the API properties results. This directive\nis optional and set to | by default if not set.\n\n```\n\n**[dns-accept-family](#3.1-dns-accept-family)**<family>[,...]```\nBy default, DNS resolvers accept both IPv4 and IPv6 addresses. This can be\ninfluenced by the \"resolve-prefer\" keywords on server lines as well as the\nfamily argument to the \"do-resolve\" action, but that is only a preference,\nwhich does not block the other family from being used when it's alone. In\nsome environments where dual-stack is not usable, stumbling on an unreachable\nIPv6-only DNS record can cause significant trouble as it will replace a\nprevious IPv4 one which would possibly have continued to work till next\nrequest. The \"dns-accept-family\" global option permits to enforce usage of\nonly one (or both) address families. The argument is a comma-delimited list\nof the following words:\n  - \"ipv4\": query and accept IPv4 addresses (\"A\" records)\n  - \"ipv6\": query and accept IPv6 addresses (\"AAAA\" records)\n  - \"auto\": use IPv4, and IPv6 if the system has a default gateway for it.\n            The result of the last check is cached for 30 seconds.\n\nWhen a single family is used, no request will be sent to resolvers for the\nother family, and any response for the othe family will be ignored. The\ndefault value is \"ipv4,ipv6\", which effectively enables both families.\n\n```\n\n**See also:**\"[resolve-prefer](#resolve-prefer)\", \"[do-resolve](#do-resolve)\"**[expose-deprecated-directives](#3.1-expose-deprecated-directives)**```\nThis statement must appear before using some directives tagged as deprecated\nto silent warnings and make sure the config file will not be rejected. Not\nall deprecated directives are concerned, only those without any alternative\nsolution.\n\n```\n\n**[expose-experimental-directives](#3.1-expose-experimental-directives)**```\nThis statement must appear before using directives tagged as experimental or\nthe config file will be rejected. Please note that features covered by this\noption are not guaranteed to work well and may break during the maintenance\ncycle. Developers will maintain them in best effort mode while the next\nversion is being worked on, and will deploy any reasonable effort to avoid\nbreaking them but with no guarantee. For these reasons, these features are\nnot expected to be supported beyond the release of the next LTS release.\nUsers who want to try experimental features are expected to upgrade quickly\nto benefit from the improvements made to that feature.\n\n```\n\n**[external-check](#3.1-external-check)**[preserve-env]```\nAllows the use of an external agent to perform health checks. This is\ndisabled by default as a security precaution, and even when enabled, checks\nmay still fail unless \"insecure-fork-wanted\" is enabled as well. If the\nprogram launched makes use of a setuid executable (it should really not),\nyou may also need to set \"insecure-setuid-wanted\" in the global section.\nBy default, the checks start with a clean environment which only contains\nvariables defined in the \"external-checkThis keyword is available in sections :Process management and securityAlphabetically sorted keywords reference\" command in the backend section. It\nmay sometimes be desirable to preserve the environment though, for example\nwhen complex scripts retrieve their extra paths or information there. This\ncan be done by appending the \"preserve-env\" keyword. In this case however it\nis strongly advised not to run a setuid nor as a privileged user, as this\nexposes the check program to potential attacks. See \"option external-check\",\nand \"insecure-fork-wanted\", and \"insecure-setuid-wanted\" for extra details.\n\n```\n\n**[fd-hard-limit](#3.1-fd-hard-limit)**<number>```\nSets an upper bound to the maximum number of file descriptors that the\nprocess will use, regardless of system limits. While \"ulimit-n\" and \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\"\nmay be used to enforce a value, when they are not set, the process will be\nlimited to the hard limit of the RLIMIT_NOFILE setting as reported by\n\"ulimit -n -H\". But some modern operating systems are now allowing extremely\nlarge values here (in the order of 1 billion), which will consume way too\nmuch RAM for regular usage. The fd-hard-limit setting is provided to enforce\na possibly lower bound to this limit. This means that it will always respect\nthe system-imposed limits when they are below <number> but the specified\nvalue will be used if system-imposed limits are higher. By default\nfd-hard-limit is set to 1048576. This default could be changed via\nDEFAULT_MAXFD compile-time variable, that could serve as the maximum (kernel)\nsystem limit, if RLIMIT_NOFILE hard limit is extremely large. fd-hard-limit\nset in global section allows to temporarily override the value provided via\nDEFAULT_MAXFD at the build-time. In the example below, no other setting is\nspecified and the maxconn value will automatically adapt to the lower of\n\"fd-hard-limit\" and the RLIMIT_NOFILE limit:\n\n    global\n        # use as many FDs as possible but no more than 50000\n        fd-hard-limit 50000\n\n```\n\n**See also:**ulimit-n, maxconn**[gid](#3.1-gid)**<number>```\nChanges the process's group ID to <number>. It is recommended that the group\nID is dedicated to HAProxy or to a small set of similar daemons. HAProxy must\nbe started with a user belonging to this group, or with superuser privileges.\nNote that if HAProxy is started from a user having supplementary groups, it\nwill only be able to drop these groups if started with superuser privileges.\nSee also \"groupThis keyword is available in sections :UserlistsPrograms (deprecated)Process management and securityBind options\" and \"uidThis keyword is available in sections :Process management and securityBind options\".\n\n```\n\n**[grace](#3.1-grace)**<time>```\nDefines a delay between SIGUSR1 and real soft-stop.\n\n```\n\nArguments :```\n<time>  is an extra delay (by default in milliseconds) after receipt of the\n        SIGUSR1 signal that will be waited for before proceeding with the\n        soft-stop operation.\n```\n\n```\nThis is used for compatibility with legacy environments where the haproxy\nprocess needs to be stopped but some external components need to detect the\nstatus before listeners are unbound. The principle is that the internal\n\"stopping\" variable (which is reported by the \"stopping\" sample fetch\nfunction) will be turned to true, but listeners will continue to accept\nconnections undisturbed, until the delay expires, after what the regular\nsoft-stop will proceed. This must not be used with processes that are\nreloaded, or this will prevent the old process from unbinding, and may\nprevent the new one from starting, or simply cause trouble.\n\n```\n\nExample:```\n\nglobal\n  grace 10s\n\n# Returns 200 OK until stopping is set via SIGUSR1\nfrontend ext-check\n  bind :9999\n  monitor-uri /ext-check\n  monitor fail if { stopping }\n\n```\n\n```\nPlease note that a more flexible and durable approach would instead consist\nfor an orchestration system in setting a global variable from the CLI, use\nthat variable to respond to external checks, then after a delay send the\nSIGUSR1 signal.\n\n```\n\nExample:```\n\n# Returns 200 OK until proc.stopping is set to non-zero. May be done\n# from HTTP using set-var(proc.stopping) or from the CLI using:\n# > set var proc.stopping int(1)\nfrontend ext-check\n  bind :9999\n  monitor-uri /ext-check\n  monitor fail if { var(proc.stopping) -m int gt 0 }\n\n```\n\n**See also:**hard-stop-after, monitor**[group](#3.1-group)**<group name>```\nSimilar to \"gidThis keyword is available in sections :Process management and securityBind options\" but uses the GID of group name <group name> from /etc/group.\nSee also \"gidThis keyword is available in sections :Process management and securityBind options\" and \"userThis keyword is available in sections :UserlistsPrograms (deprecated)Process management and securityBind options\".\n\n```\n\n**[h1-accept-payload-with-any-method](#3.1-h1-accept-payload-with-any-method)**```\nDoes not reject HTTP/1.0 GET/HEAD/DELETE requests with a payload with a\n413 Payload Too Large HTTP response.\n\nWhile It is explicitly allowed in HTTP/1.1, HTTP/1.0 is not clear on this\npoint and some old servers don't expect any payload and never look for body\nlength (via Content-Length or Transfer-Encoding headers). It means that some\nintermediaries may properly handle the payload for HTTP/1.0 GET/HEAD/DELETE\nrequests, while some others may totally ignore it. That may lead to security\nissues because a request smuggling attack is possible. Thus, by default,\nHAProxy rejects HTTP/1.0 GET/HEAD/DELETE requests with a payload.\n\nHowever, it may be an issue with some old clients. In this case, this global\noption may be set.\n\n```\n\n**[h1-do-not-close-on-insecure-transfer-encoding](#3.1-h1-do-not-close-on-insecure-transfer-encoding)**```\nAs mandated by the HTTP/1.1 specification (RFC9112#6.1), the presence of both\na Transfer-Encoding header field and a Content-Length header field in the\nsame message represents a serious risk of conveying a content smuggling\nattack if there are any HTTP/1.0 agent anywhere in the upstream of downstream\nchain, and when facing this, an agent must absolutely close the connection\nafter the response so as to prevent any exploitation. But this may have a\nperformance impact on some very old clients, especially if they need to\nrenegotiate a TLS connection for every request. This option is present to\nask HAProxy not to enforce this rule, and to just sanitize the message but\nleave the connection alive after the response. This may only be done when\nabsolutely certain that no HTTP/1.0 agents are present in the chain and that\nall implementations before HAProxy are fully HTTP/1.1 compliant regarding the\nrules that apply to these header fields. In any case, HAProxy will continue\nto ignore and drop the extraneous Content-Length header so as not to confuse\nthe next hop.\n\nWhen enabling this option to work around an old broken client or server, it\nis important to understand that regardless of the need or not for this\noption, such an agent violating this rule faces a risk to see its messages\ntruncated by old agents that would consider Content-Length and ignore\nTransfer-Encoding, since the cumulated size of the encoded chunk sizes are\nnot being accounted for. As such, the rule above is not just a matter of\nsecurity but also of taking care of getting rid of agents that may face\ncommunication trouble due to incompatibilities with older ones.\n\n```\n\n**[h1-case-adjust](#3.1-h1-case-adjust)**<from><to>```\nDefines the case adjustment to apply, when enabled, to the header name\n<from>, to change it to <to> before sending it to HTTP/1 clients or\nservers. <from> must be in lower case, and <from> and <to> must not differ\nexcept for their case. It may be repeated if several header names need to be\nadjusted. Duplicate entries are not allowed. If a lot of header names have to\nbe adjusted, it might be more convenient to use \"h1-case-adjust-file\".\nPlease note that no transformation will be applied unless \"option\nh1-case-adjust-bogus-client\" or \"option h1-case-adjust-bogus-server\" is\nspecified in a proxy.\n\nThere is no standard case for header names because, as stated in RFC7230,\nthey are case-insensitive. So applications must handle them in a case-\ninsensitive manner. But some bogus applications violate the standards and\nerroneously rely on the cases most commonly used by browsers. This problem\nbecomes critical with HTTP/2 because all header names must be exchanged in\nlower case, and HAProxy follows the same convention. All header names are\nsent in lower case to clients and servers, regardless of the HTTP version.\n\nApplications which fail to properly process requests or responses may require\nto temporarily use such workarounds to adjust header names sent to them for\nthe time it takes the application to be fixed. Please note that an\napplication which requires such workarounds might be vulnerable to content\nsmuggling attacks and must absolutely be fixed.\n\n```\n\nExample:```\n\nglobal\n  h1-case-adjust content-length Content-Length\n\n```\n\n```\nSee \"h1-case-adjust-file\", \"option h1-case-adjust-bogus-client\" and\n\"option h1-case-adjust-bogus-server\".\n\n```\n\n**[h1-case-adjust-file](#3.1-h1-case-adjust-file)**<hdrs-file>```\nDefines a file containing a list of key/value pairs used to adjust the case\nof some header names before sending them to HTTP/1 clients or servers. The\nfile <hdrs-file> must contain 2 header names per line. The first one must be\nin lower case and both must not differ except for their case. Lines which\nstart with '#' are ignored, just like empty lines. Leading and trailing tabs\nand spaces are stripped. Duplicate entries are not allowed. Please note that\nno transformation will be applied unless \"option h1-case-adjust-bogus-client\"\nor \"option h1-case-adjust-bogus-server\" is specified in a proxy.\n\nIf this directive is repeated, only the last one will be processed.  It is an\nalternative to the directive \"h1-case-adjust\" if a lot of header names need\nto be adjusted. Please read the risks associated with using this.\n\nSee \"h1-case-adjust\", \"option h1-case-adjust-bogus-client\" and\n\"option h1-case-adjust-bogus-server\".\n\n```\n\n**[h2-workaround-bogus-websocket-clients](#3.1-h2-workaround-bogus-websocket-clients)**```\nThis disables the announcement of the support for h2 websockets to clients.\nThis can be use to overcome clients which have issues when implementing the\nrelatively fresh RFC8441, such as Firefox 88. To allow clients to\nautomatically downgrade to http/1.1 for the websocket tunnel, specify h2\nsupport on the bind line using \"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" without an explicit \"protoThis keyword is available in sections :Bind optionsServer and default-server options\" keyword. If\nthis statement was previously activated, this can be disabled by prefixing\nthe keyword with \"no'.\n\n```\n\n**[hard-stop-after](#3.1-hard-stop-after)**<time>```\nDefines the maximum time allowed to perform a clean soft-stop.\n\n```\n\nArguments :```\n<time>  is the maximum time (by default in milliseconds) for which the\n        instance will remain alive when a soft-stop is received via the\n        SIGUSR1 signal.\n```\n\n```\nThis may be used to ensure that the instance will quit even if connections\nremain opened during a soft-stop (for example with long timeouts for a proxy\nin tcp mode). It applies both in TCP and HTTP mode.\n\n```\n\nExample:```\n\nglobal\n  hard-stop-after 30s\n\n```\n\n**See also:**grace**[harden.reject-privileged-ports.tcp](#3.1-harden.reject-privileged-ports.tcp)**{ on | off }**[harden.reject-privileged-ports.quic](#3.1-harden.reject-privileged-ports.quic)**{ on | off }```\nToggle per protocol protection which forbid communication with clients which\nuse privileged ports as their source port. This range of ports is defined\naccording to RFC 6335. By default, protection is active for QUIC protocol as\nthis behavior is suspicious and may be used as a spoofing or DNS/NTP\namplification attack.\n\n```\n\n**[http-err-codes](#3.1-http-err-codes)**[+-]<range>[,...][...]```\nReplace, reduce or extend the list of status codes that define an error as\nconsidered by the termination codes and the \"http_err_cnt\" counter in stick\ntables. The default range for errors is 400 to 499, but in certain contexts\nsome users prefer to exclude specific codes, especially when tracking client\nerrors (e.g. 404 on systems with dynamically generated contents). See also\n\"http-fail-codes\" and \"http_err_cnt\".\n\nA range specified without '+' nor '-' redefines the existing range to the new\none. A range starting with '+' extends the existing range to also include the\nspecified one, which may or may not overlap with the existing one. A range\nstarting with '-' removes the specified range from the existing one. A range\nconsists in a number from 100 to 599, optionally followed by \"-\" followed by\nanother number greater than or equal to the first one to indicate the high\nboundary of the range. Multiple ranges may be delimited by commas for a same\nadd/del/ replace operation.\n\n```\n\nExample:```\n\nhttp-err-codes 400,402-444,446-480,490   # sets exactly these codes\nhttp-err-codes 400-499 -450 +500         # sets 400 to 500 except 450\nhttp-err-codes -450-459                  # removes 450 to 459 from range\nhttp-err-codes +501,505                  # adds 501 and 505 to range\n\n```\n\n**[http-fail-codes](#3.1-http-fail-codes)**[+-]<range>[,...][...]```\nReplace, reduce or extend the list of status codes that define a failure as\nconsidered by the termination codes and the \"http_fail_cnt\" counter in stick\ntables. The default range for failures is 500 to 599 except 501 and 505 which\ncan be triggered by clients, and normally indicate a failure from the server\nto process the request. Some users prefer to exclude certain codes in certain\ncontexts where it is known they're not relevant, such as 500 in certain SOAP\nenvironments as it doesn't translate a server fault there. The syntax is\nexactly the same as for http-err-codes above. See also \"http-err-codes\" and\n\"http_fail_cnt\".\n\n```\n\n**[insecure-fork-wanted](#3.1-insecure-fork-wanted)**```\nBy default HAProxy tries hard to prevent any thread and process creation\nafter it starts. Doing so is particularly important when using Lua files of\nuncertain origin, and when experimenting with development versions which may\nstill contain bugs whose exploitability is uncertain. And generally speaking\nit's good hygiene to make sure that no unexpected background activity can be\ntriggered by traffic. But this prevents external checks from working, and may\nbreak some very specific Lua scripts which actively rely on the ability to\nfork. This option is there to disable this protection. Note that it is a bad\nidea to disable it, as a vulnerability in a library or within HAProxy itself\nwill be easier to exploit once disabled. In addition, forking from Lua or\nanywhere else is not reliable as the forked process may randomly embed a lock\nset by another thread and never manage to finish an operation. As such it is\nhighly recommended that this option is never used and that any workload\nrequiring such a fork be reconsidered and moved to a safer solution (such as\nagents instead of external checks). This option supports the \"no\" prefix to\ndisable it. This can also be activated with \"-dI\" on the haproxy command\nline.\n\n```\n\n**[insecure-setuid-wanted](#3.1-insecure-setuid-wanted)**```\nHAProxy doesn't need to call executables at run time (except when using\nexternal checks which are strongly recommended against), and is even expected\nto isolate itself into an empty chroot. As such, there basically is no valid\nreason to allow a setuid executable to be called without the user being fully\naware of the risks. In a situation where HAProxy would need to call external\nchecks and/or disable chroot, exploiting a vulnerability in a library or in\nHAProxy itself could lead to the execution of an external program. On Linux\nit is possible to lock the process so that any setuid bit present on such an\nexecutable is ignored. This significantly reduces the risk of privilege\nescalation in such a situation. This is what HAProxy does by default. In case\nthis causes a problem to an external check (for example one which would need\nthe \"ping\" command), then it is possible to disable this protection by\nexplicitly adding this directive in the global section. If enabled, it is\npossible to turn it back off by prefixing it with the \"no\" keyword.\n\n```\n\n**[issuers-chain-path](#3.1-issuers-chain-path)**<dir>```\nAssigns a directory to load certificate chain for issuer completion. All\nfiles must be in PEM format. For certificates loaded with \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\" or \"crt-list\",\nif certificate chain is not included in PEM (also commonly known as\nintermediate certificate), HAProxy will complete chain if the issuer of the\ncertificate corresponds to the first certificate of the chain loaded with\n\"issuers-chain-path\".\nA \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\" file with PrivateKey+Certificate+IntermediateCA2+IntermediateCA1\ncould be replaced with PrivateKey+Certificate. HAProxy will complete the\nchain if a file with IntermediateCA2+IntermediateCA1 is present in\n\"issuers-chain-path\" directory. All other certificates with the same issuer\nwill share the chain in memory.\n\nThe OCSP features are able to use the completed chain when no .issuer was\nused, or no chain was provided in the PEM.\n\n```\n\n**[key-base](#3.1-key-base)**<dir>```\nAssigns a default directory to fetch SSL private keys from when a relative\npath is used with \"key\" directives. Absolute locations specified prevail and\nignore \"key-baseThis keyword is available in sections :Certificate StorageProcess management and security\". This option only works with a crt-store load line.\n\n```\n\n**[limited-quic](#3.1-limited-quic)**```\nThis setting must be used to explicitly enable the QUIC listener bindings when\nhaproxy is compiled against a TLS/SSL stack without QUIC support, typically\nOpenSSL. It has no effect when haproxy is compiled against a TLS/SSL stack\nwith QUIC support, quictls for instance. Note that QUIC 0-RTT is not supported\nwhen this setting is set.\n\n```\n\n**[localpeer](#3.1-localpeer)**<name>```\nSets the local instance's peer name. It will be ignored if the \"-L\"\ncommand line argument is specified or if used after \"peers\" section\ndefinitions. In such cases, a warning message will be emitted during\nthe configuration parsing.\n\nThis option will also set the HAPROXY_LOCALPEER environment variable.\nSee also \"-L\" in the management guide and \"peers\" section below.\n\n```\n\n**[log](#3.1-log)**<target>[len<length>][format<format>][sample<ranges>:<sample_size>][profile<prof>]<facility>[max level[min level]]```\nAdds a global syslog server. Several global servers can be defined. They\nwill receive logs for starts and exits, as well as all logs from proxies\nconfigured with \"log globalThis keyword is available in sections :Log forwardingAlphabetically sorted keywords reference\". See \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\" option for proxies for more details.\n\n```\n\n**[log-send-hostname](#3.1-log-send-hostname)**[<string>]```\nSets the hostname field in the syslog header. If optional \"string\" parameter\nis set the header is set to the string contents, otherwise uses the hostname\nof the system. Generally used if one is not relaying logs through an\nintermediate syslog server or for simply customizing the hostname printed in\nthe logs.\n\n```\n\n**[log-tag](#3.1-log-tag)**<string>```\nSets the tag field in the syslog header to this string. It defaults to the\nprogram name as launched from the command line, which usually is \"haproxy\".\nSometimes it can be useful to differentiate between multiple processes\nrunning on the same host. See also the per-proxy \"log-tagThis keyword is available in sections :Process management and securityAlphabetically sorted keywords referenceLog profiles\" directive.\n\n```\n\n**[lua-load](#3.1-lua-load)**<file>[<arg1>[<arg2>[ ... ]]]```\nThis global directive loads and executes a Lua file in the shared context\nthat is visible to all threads. Any variable set in such a context is visible\nfrom any thread. This is the easiest and recommended way to load Lua programs\nbut it will not scale well if a lot of Lua calls are performed, as only one\nthread may be running on the global state at a time. A program loaded this\nway will always see 0 in the \"core.thread\" variable. This directive can be\nused multiple times.\n\nargs are available in the lua file using the code below in the body of the\nfile. Do not forget that Lua arrays start at index 1. A \"local\" variable\ndeclared in a file is available in the entire file and not available on\nother files.\n\n   local args = table.pack(...)\n\n```\n\n**[lua-load-per-thread](#3.1-lua-load-per-thread)**<file>[<arg1>[<arg2>[ ... ]]]```\nThis global directive loads and executes a Lua file into each started thread.\nAny global variable has a thread-local visibility so that each thread could\nsee a different value. As such it is strongly recommended not to use global\nvariables in programs loaded this way. An independent copy is loaded and\ninitialized for each thread, everything is done sequentially and in the\nthread's numeric order from 1 to nbthread. If some operations need to be\nperformed only once, the program should check the \"core.thread\" variable to\nfigure what thread is being initialized. Programs loaded this way will run\nconcurrently on all threads and will be highly scalable. This is the\nrecommended way to load simple functions that register sample-fetches,\nconverters, actions or services once it is certain the program doesn't depend\non global variables. For the sake of simplicity, the directive is available\neven if only one thread is used and even if threads are disabled (in which\ncase it will be equivalent to lua-load). This directive can be used multiple\ntimes.\n\nSee lua-load for usage of args.\n\n```\n\n**[lua-prepend-path](#3.1-lua-prepend-path)**<string>[<type>]```\nPrepends the given string followed by a semicolon to Lua's package.<type>\nvariable.\n<type> must either be \"path\" or \"cpath\". If <type> is not given it defaults\nto \"path\".\n\nLua's paths are semicolon delimited lists of patterns that specify how the\n`require` function attempts to find the source file of a library. Question\nmarks (?) within a pattern will be replaced by module name. The path is\nevaluated left to right. This implies that paths that are prepended later\nwill be checked earlier.\n\nAs an example by specifying the following path:\n\n  lua-prepend-path /usr/share/haproxy-lua/?/init.lua\n  lua-prepend-path /usr/share/haproxy-lua/?.lua\n\nWhen `require \"example\"` is being called Lua will first attempt to load the\n/usr/share/haproxy-lua/example.lua script, if that does not exist the\n/usr/share/haproxy-lua/example/init.lua will be attempted and the default\npaths if that does not exist either.\n\nSee https://www.lua.org/pil/8.1.html for the details within the Lua\ndocumentation.\n\n```\n\n**[master-worker](#3.1-master-worker)**[no-exit-on-failure]```\nMaster-worker mode. It is equivalent to the command line \"-W\" argument.\n\nThis mode will launch a \"master\" which will fork a \"worker\" after reading the\nconfiguration to process the traffic. The master is used as a process manager\nwhich will monitor the \"workers\".\n\nUsing this mode, you can reload HAProxy directly by sending a SIGUSR2 signal\nto the master. Reloading will ask the master to read the configuration again\nand fork a new worker. The previous worker will be kept until the end of its\njobs.\n\nThe master-worker mode is compatible either with the foreground or daemon\nmode.\n\nBy default, if a worker exits with a bad return code, in the case of a\nsegfault for example, all workers will be killed, and the master will leave.\nIt is convenient to combine this behavior with Restart=on-failure in a\nsystemd unit file in order to relaunch the whole process. If you don't want\nthis behavior, you must use the keyword \"no-exit-on-failure\".\n\nSee also \"-W\" in the management guide.\n\n```\n\n**[mworker-max-reloads](#3.1-mworker-max-reloads)**<number>```\nIn master-worker mode, this option limits the number of time a worker can\nsurvive to a reload. If the worker did not leave after a reload, once its\nnumber of reloads is greater than this number, the worker will receive a\nSIGTERM. This option helps to keep under control the number of workers.\nSee also \"show proc\" in the Management Guide.\n\n```\n\n**[nbthread](#3.1-nbthread)**<number>```\nThis setting is only available when support for threads was built in. It\nmakes HAProxy run on <number> threads. \"nbthread\" also works when HAProxy is\nstarted in foreground. On some platforms supporting CPU affinity, the default\n\"nbthread\" value is automatically set to the number of CPUs the process is\nbound to upon startup. This means that the thread count can easily be\nadjusted from the calling process using commands like \"taskset\" or \"cpuset\".\nOtherwise, this value defaults to 1. The default value is reported in the\noutput of \"haproxy -vv\". Note that values set here or automatically detected\nare subject to the limit set by \"thread-hard-limit\" (if set).\n\n```\n\n**[no-quic](#3.1-no-quic)**```\nDisable QUIC transport protocol. All the QUIC listeners will still be created.\nBut they will not bind their addresses. Hence, no QUIC traffic will be\nprocessed by haproxy. See also \"quic_enabled\" sample fetch.\n\n```\n\n**[numa-cpu-mapping](#3.1-numa-cpu-mapping)**```\nWhen running on a NUMA-aware platform with the cpu-policy is set to\n\"first-usable-node\" (the default one), HAProxy inspects on startup the CPU\ntopology of the machine. If a multi-socket machine is detected, the affinity\nis automatically calculated to run on the CPUs of a single node. This is done\nin order to not suffer from the performance penalties caused by the\ninter-socket bus latency. However, if the applied binding is non optimal on a\nparticular architecture, it can be disabled with the statement 'no\nnuma-cpu-mapping'. This automatic binding is also not applied if a nbthread\nstatement is present in the configuration, if the affinity of the process is\nalready specified, for example via the 'cpu-map' directive or the taskset\nutility, or if the cpu-policy is set to any other value. See also \"cpu-map\",\n\"cpu-policy\", \"cpu-set\".\n\n```\n\n**[ocsp-update.disable](#3.1-ocsp-update.disable)**[ on | off ]```\nDisable completely the ocsp-update in HAProxy. Any ocsp-update configuration\nwill be ignored. Default is \"off\".\nSee option \"ocsp-update\" for more information about the auto update\nmechanism.\n\n```\n\n**[ocsp-update.httpproxy](#3.1-ocsp-update.httpproxy)**<address>[:port]```\nAllow to use an HTTP proxy for the OCSP updates. This only works with HTTP,\nHTTPS is not supported. This option will allow the OCSP updater to send\nabsolute URI in the request to the proxy.\n\n```\n\n**[ocsp-update.maxdelay](#3.1-ocsp-update.maxdelay)**<number>**[tune.ssl.ocsp-update.maxdelay](#3.1-tune.ssl.ocsp-update.maxdelay)**<number>(deprecated)```\nSets the maximum interval between two automatic updates of the same OCSP\nresponse. This time is expressed in seconds and defaults to 3600 (1 hour). It\nmust be set to a higher value than \"ocsp-update.mindelay\". See\noption \"ocsp-update\" for more information about the auto update mechanism.\n\n```\n\n**[ocsp-update.mindelay](#3.1-ocsp-update.mindelay)**<number>**[tune.ssl.ocsp-update.mindelay](#3.1-tune.ssl.ocsp-update.mindelay)**<number>(deprecated)```\nSets the minimum interval between two automatic updates of the same OCSP\nresponse. This time is expressed in seconds and defaults to 300 (5 minutes).\nIt is particularly useful for OCSP response that do not have explicit\nexpiration times. It must be set to a lower value than\n\"ocsp-update.maxdelay\". See option \"ocsp-update\" for more\ninformation about the auto update mechanism.\n\n```\n\n**[ocsp-update.mode](#3.1-ocsp-update.mode)**[ on | off ]```\nSets the default ocsp-update mode for all certificates used in the\nconfiguration. This global option can be superseded by the crt-list\n\"ocsp-update\" option. This option is set to \"off\" by default.\nSee option \"ocsp-update\" for more information about the auto update\nmechanism.\n\n```\n\n**[pidfile](#3.1-pidfile)**<pidfile>```\nWrites PIDs of all daemons into file <pidfile> when daemon mode or writes PID\nof master process into file <pidfile> when master-worker mode. This option is\nequivalent to the \"-p\" command line argument. The file must be accessible to\nthe user starting the process. See also \"daemon\" and \"master-worker\".\n\n```\n\n**[pp2-never-send-local](#3.1-pp2-never-send-local)**```\nA bug in the PROXY protocol v2 implementation was present in HAProxy up to\nversion 2.1, causing it to emit a PROXY command instead of a LOCAL command\nfor health checks. This is particularly minor but confuses some servers'\nlogs. Sadly, the bug was discovered very late and revealed that some servers\nwhich possibly only tested their PROXY protocol implementation against\nHAProxy fail to properly handle the LOCAL command, and permanently remain in\nthe \"down\" state when HAProxy checks them. When this happens, it is possible\nto enable this global option to revert to the older (bogus) behavior for the\ntime it takes to contact the affected components' vendors and get them fixed.\nThis option is disabled by default and acts on all servers having the\n\"send-proxy-v2\" statement.\n\n```\n\n**[presetenv](#3.1-presetenv)**<name><value>```\nSets environment variable <name> to value <value>. If the variable exists, it\nis NOT overwritten. The changes immediately take effect so that the next line\nin the configuration file sees the new value. See also \"setenv\", \"resetenv\",\nand \"unsetenv\".\n\n```\n\n**[prealloc-fd](#3.1-prealloc-fd)**```\nPerforms a one-time open of the maximum file descriptor which results in a\npre-allocation of the kernel's data structures. This prevents short pauses\nwhen nbthread>1 and HAProxy opens a file descriptor which requires the kernel\nto expand its data structures.\n\n```\n\n**[resetenv](#3.1-resetenv)**[<name>...]```\nRemoves all environment variables except the ones specified in argument. It\nallows to use a clean controlled environment before setting new values with\nsetenv or unsetenv. Please note that some internal functions may make use of\nsome environment variables, such as time manipulation functions, but also\nOpenSSL or even external checks. This must be used with extreme care and only\nafter complete validation. The changes immediately take effect so that the\nnext line in the configuration file sees the new environment. See also\n\"setenv\", \"presetenv\", and \"unsetenv\".\n\n```\n\n**[server-state-base](#3.1-server-state-base)**<directory>```\nSpecifies the directory prefix to be prepended in front of all servers state\nfile names which do not start with a '/'. See also \"server-state-file\",\n\"load-server-state-from-file\" and \"server-state-file-name\".\n\n```\n\n**[server-state-file](#3.1-server-state-file)**<file>```\nSpecifies the path to the file containing state of servers. If the path starts\nwith a slash ('/'), it is considered absolute, otherwise it is considered\nrelative to the directory specified using \"server-state-base\" (if set) or to\nthe current directory. Before reloading HAProxy, it is possible to save the\nservers' current state using the stats command \"show servers state\". The\noutput of this command must be written in the file pointed by <file>. When\nstarting up, before handling traffic, HAProxy will read, load and apply state\nfor each server found in the file and available in its current running\nconfiguration. See also \"server-state-base\" and \"show servers state\",\n\"load-server-state-from-file\" and \"server-state-file-name\"\n\n```\n\n**[set-dumpable](#3.1-set-dumpable)**```\nThis option is better left disabled by default and enabled only upon a\ndeveloper's request. If it has been enabled, it may still be forcibly\ndisabled by prefixing it with the \"no\" keyword. It has no impact on\nperformance nor stability but will try hard to re-enable core dumps that were\npossibly disabled by file size limitations (ulimit -f), core size limitations\n(ulimit -c), or \"dumpability\" of a process after changing its UID/GID (such\nas /proc/sys/fs/suid_dumpable on Linux). Core dumps might still be limited by\nthe current directory's permissions (check what directory the file is started\nfrom), the chroot directory's permission (it may be needed to temporarily\ndisable the chroot directive or to move it to a dedicated writable location),\nor any other system-specific constraint. For example, some Linux flavours are\nnotorious for replacing the default core file with a path to an executable\nnot even installed on the system (check /proc/sys/kernel/core_pattern). Often,\nsimply writing \"core\", \"core.%p\" or \"/var/log/core/core.%p\" addresses the\nissue. When trying to enable this option waiting for a rare issue to\nre-appear, it's often a good idea to first try to obtain such a dump by\nissuing, for example, \"kill -11\" to the \"haproxy\" process and verify that it\nleaves a core where expected when dying.\n\n```\n\n**[set-var](#3.1-set-var)**<var-name><expr>```\nSets the process-wide variable '<var-name>' to the result of the evaluation\nof the sample expression <expr>. The variable '<var-name>' may only be a\nprocess-wide variable (using the 'proc.' prefix). It works exactly like the\n'set-var' action in TCP or HTTP rules except that the expression is evaluated\nat configuration parsing time and that the variable is instantly set. The\nsample fetch functions and converters permitted in the expression are only\nthose using internal data, typically 'int(value)' or 'str(value)'. It is\npossible to reference previously allocated variables as well. These variables\nwill then be readable (and modifiable) from the regular rule sets.\n\n```\n\nExample:```\n\nglobal\n    set-var proc.current_state str(primary)\n    set-var proc.prio int(100)\n    set-var proc.threshold int(200),sub(proc.prio)\n\n```\n\n**[set-var-fmt](#3.1-set-var-fmt)**<var-name><fmt>```\nSets the process-wide variable '<var-name>' to the string resulting from the\nevaluation of the log-format <fmt>. The variable '<var-name>' may only be a\nprocess-wide variable (using the 'proc.' prefix). It works exactly like the\n'set-var-fmt' action in TCP or HTTP rules except that the expression is\nevaluated at configuration parsing time and that the variable is instantly\nset. The sample fetch functions and converters permitted in the expression\nare only those using internal data, typically 'int(value)' or 'str(value)'.\nIt is possible to reference previously allocated variables as well. These\nvariables will then be readable (and modifiable) from the regular rule sets.\nPlease see section 8.2.6 for details on the Custom log format syntax.\n\n```\n\nExample:```\n\nglobal\n    set-var-fmt proc.current_state \"primary\"\n    set-var-fmt proc.bootid        \"%pid|%t\"\n\n```\n\n**[setcap](#3.1-setcap)**<name>[,<name>...]```\nSets a list of capabilities that must be preserved when starting and running\neither as a non-root user (uid > 0), or when starting with uid 0 (root)\nand switching then to a non-root. By default all permissions are\nlost by the uid switch, but some are often needed when trying to connect to\na server from a foreign address during transparent proxying, or when binding\nto a port below 1024, e.g. when using \"tune.quic.socket-owner connection\",\nresulting in setups running entirely under uid 0. Setting capabilities\ngenerally is a safer alternative, as only the required capabilities will be\npreserved. The feature is OS-specific and only enabled on Linux when\nUSE_LINUX_CAP=1 is set at build time. The list of supported capabilities also\ndepends on the OS and is enumerated by the error message displayed when an\ninvalid capability name or an empty one is passed. Multiple capabilities may\nbe passed, delimited by commas. Among those commonly used, \"cap_net_raw\"\nallows to transparently bind to a foreign address, and \"cap_net_bind_service\"\nallows to bind to a privileged port and may be used by QUIC. If the process\nis started and run under the same non-root user, needed capabilities should\nbe set on haproxy binary file with setcap along with this keyword. For more\ndetails about setting capabilities on haproxy binary, please see chapter\n13.1 Linux capabilities support in the Management guide.\n\n```\n\nExample:```\n\nglobal\n    setcap cap_net_bind_service,cap_net_admin\n\n```\n\n**[setenv](#3.1-setenv)**<name><value>```\nSets environment variable <name> to value <value>. If the variable exists, it\nis overwritten. The changes immediately take effect so that the next line in\nthe configuration file sees the new value. See also \"presetenv\", \"resetenv\",\nand \"unsetenv\".\n\n```\n\n**[ssl-default-bind-ciphers](#3.1-ssl-default-bind-ciphers)**<ciphers>```\nThis setting is only available when support for OpenSSL was built in. It sets\nthe default string describing the list of cipher algorithms (\"cipher suite\")\nthat are negotiated during the SSL/TLS handshake up to TLSv1.2 for all\n\"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines which do not explicitly define theirs. The format of the string\nis defined in \"man 1 ciphers\" from OpenSSL man pages. For background\ninformation and recommendations see e.g.\n(https://wiki.mozilla.org/Security/Server_Side_TLS) and\n(https://mozilla.github.io/server-side-tls/ssl-config-generator/). For TLSv1.3\ncipher configuration, please check the \"ssl-default-bind-ciphersuites\" keyword.\nPlease check the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" keyword for more information.\n\n```\n\n**[ssl-default-bind-ciphersuites](#3.1-ssl-default-bind-ciphersuites)**<ciphersuites>```\nThis setting is only available when support for OpenSSL was built in and\nOpenSSL 1.1.1 or later was used to build HAProxy. It sets the default string\ndescribing the list of cipher algorithms (\"cipher suite\") that are negotiated\nduring the TLSv1.3 handshake for all \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines which do not explicitly define\ntheirs. The format of the string is defined in\n\"man 1 ciphers\" from OpenSSL man pages under the section \"ciphersuitesThis keyword is available in sections :Bind optionsServer and default-server options\". For\ncipher configuration for TLSv1.2 and earlier, please check the\n\"ssl-default-bind-ciphers\" keyword. This setting might accept TLSv1.2\nciphersuites however this is an undocumented behavior and not recommended as\nit could be inconsistent or buggy.\nThe default TLSv1.3 ciphersuites of OpenSSL are:\n\"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256\"\n\nTLSv1.3 only supports 5 ciphersuites:\n\n- TLS_AES_128_GCM_SHA256\n- TLS_AES_256_GCM_SHA384\n- TLS_CHACHA20_POLY1305_SHA256\n- TLS_AES_128_CCM_SHA256\n- TLS_AES_128_CCM_8_SHA256\n\nPlease check the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" keyword for more information.\n\n```\n\nExample:```\n\nglobal\n    ssl-default-bind-ciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-GCM-SHA256\n    ssl-default-bind-ciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256\n\n```\n\n**[ssl-default-bind-client-sigalgs](#3.1-ssl-default-bind-client-sigalgs)**<sigalgs>```\nThis setting is only available when support for OpenSSL was built in. It sets\nthe default string describing the list of signature algorithms related to\nclient authentication for all \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines which do not explicitly define\ntheirs. The format of the string is a colon-delimited list of signature\nalgorithms. Each signature algorithm can use one of two forms: TLS1.3 signature\nscheme names (\"rsa_pss_rsae_sha256\") or the public key algorithm + digest form\n(\"ECDSA+SHA256\"). A list can contain both forms. For more information on the\nformat, see SSL_CTX_set1_client_sigalgs(3). A list of signature algorithms is\nalso available in RFC8446 section 4.2.3 and in OpenSSL in the ssl/t1_lib.c\nfile.  This setting is not applicable to TLSv1.1 and earlier versions of the\nprotocol as the signature algorithms aren't separately negotiated in these\nversions. It is not recommended to change this setting unless compatibility\nwith a middlebox is required.\n\n```\n\n**[ssl-default-bind-curves](#3.1-ssl-default-bind-curves)**<curves>```\nThis setting is only available when support for OpenSSL was built in. It sets\nthe default string describing the list of elliptic curves algorithms (\"curve\nsuite\") that are negotiated during the SSL/TLS handshake with ECDHE. The format\nof the string is a colon-delimited list of curve name.\nPlease check the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" keyword for more information.\n\n```\n\n**[ssl-default-bind-options](#3.1-ssl-default-bind-options)**[<option>]...```\nThis setting is only available when support for OpenSSL was built in. It sets\ndefault ssl-options to force on all \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines. Please check the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\"\nkeyword to see available options.\n\n```\n\nExample:```\n\nglobal\n   ssl-default-bind-options ssl-min-ver TLSv1.0 no-tls-tickets\n\n```\n\n**[ssl-default-bind-sigalgs](#3.1-ssl-default-bind-sigalgs)**<sigalgs>```\nThis setting is only available when support for OpenSSL was built in. It\nsets the default string describing the list of signature algorithms that\nare negotiated during the TLSv1.2 and TLSv1.3 handshake for all \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines\nwhich do not explicitly define theirs. The format of the string is a\ncolon-delimited list of signature algorithms. Each signature algorithm can\nuse one of two forms: TLS1.3 signature scheme names (\"rsa_pss_rsae_sha256\")\nor the public key algorithm + digest form (\"ECDSA+SHA256\"). A list\ncan contain both forms. For more information on the format,\nsee SSL_CTX_set1_sigalgs(3). A list of signature algorithms is also\navailable in RFC8446 section 4.2.3 and in OpenSSL in the ssl/t1_lib.c file.\nThis setting is not applicable to TLSv1.1 and earlier versions of the\nprotocol as the signature algorithms aren't separately negotiated in these\nversions. It is not recommended to change this setting unless compatibility\nwith a middlebox is required.\n\n```\n\n**[ssl-default-server-ciphers](#3.1-ssl-default-server-ciphers)**<ciphers>```\nThis setting is only available when support for OpenSSL was built in. It\nsets the default string describing the list of cipher algorithms that are\nnegotiated during the SSL/TLS handshake up to TLSv1.2 with the server,\nfor all \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" lines which do not explicitly define theirs. The format of\nthe string is defined in \"man 1 ciphers\" from OpenSSL man pages. For background\ninformation and recommendations see e.g.\n(https://wiki.mozilla.org/Security/Server_Side_TLS) and\n(https://mozilla.github.io/server-side-tls/ssl-config-generator/).\nFor TLSv1.3 cipher configuration, please check the\n\"ssl-default-server-ciphersuites\" keyword. Please check the \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" keyword\nfor more information.\n\n```\n\n**[ssl-default-server-ciphersuites](#3.1-ssl-default-server-ciphersuites)**<ciphersuites>```\nThis setting is only available when support for OpenSSL was built in and\nOpenSSL 1.1.1 or later was used to build HAProxy. It sets the default\nstring describing the list of cipher algorithms that are negotiated during\nthe TLSv1.3 handshake with the server, for all \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" lines which do not\nexplicitly define theirs. The format of the string is defined in\n\"man 1 ciphers\" from OpenSSL man pages under the section \"ciphersuitesThis keyword is available in sections :Bind optionsServer and default-server options\". For\ncipher configuration for TLSv1.2 and earlier, please check the\n\"ssl-default-server-ciphers\" keyword. Please check the \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" keyword for\nmore information.\n\n```\n\n**[ssl-default-server-client-sigalgs](#3.1-ssl-default-server-client-sigalgs)**<sigalgs>```\nThis setting is only available when support for OpenSSL was built in. It sets\nthe default string describing the list of signature algorithms related to\nclient authentication for all \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" lines which do not explicitly define\ntheirs. The format of the string is a colon-delimited list of signature\nalgorithms. Each signature algorithm can use one of two forms: TLS1.3 signature\nscheme names (\"rsa_pss_rsae_sha256\") or the public key algorithm + digest form\n(\"ECDSA+SHA256\"). A list can contain both forms. For more information on the\nformat, see SSL_CTX_set1_client_sigalgs(3). A list of signature algorithms is\nalso available in RFC8446 section 4.2.3 and in OpenSSL in the ssl/t1_lib.c\nfile.  This setting is not applicable to TLSv1.1 and earlier versions of the\nprotocol as the signature algorithms aren't separately negotiated in these\nversions. It is not recommended to change this setting unless compatibility\nwith a middlebox is required.\n\n```\n\n**[ssl-default-server-curves](#3.1-ssl-default-server-curves)**<curves>```\nThis setting is only available when support for OpenSSL was built in. It sets\nthe default string describing the list of elliptic curves algorithms (\"curve\nsuite\") that are negotiated during the SSL/TLS handshake with ECDHE. The format\nof the string is a colon-delimited list of curve name.\nPlease check the \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" keyword for more information.\n\n```\n\n**[ssl-default-server-options](#3.1-ssl-default-server-options)**[<option>]...```\nThis setting is only available when support for OpenSSL was built in. It sets\ndefault ssl-options to force on all \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" lines. Please check the \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\"\nkeyword to see available options.\n\n```\n\n**[ssl-default-server-sigalgs](#3.1-ssl-default-server-sigalgs)**<sigalgs>```\nThis setting is only available when support for OpenSSL was built in. It\nsets the default string describing the list of signature algorithms that\nare negotiated during the TLSv1.2 and TLSv1.3 handshake for all \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" lines\nwhich do not explicitly define theirs. The format of the string is a\ncolon-delimited list of signature algorithms. Each signature algorithm can\nuse one of two forms: TLS1.3 signature scheme names (\"rsa_pss_rsae_sha256\")\nor the public key algorithm + digest form (\"ECDSA+SHA256\"). A list\ncan contain both forms. For more information on the format,\nsee SSL_CTX_set1_sigalgs(3). A list of signature algorithms is also\navailable in RFC8446 section 4.2.3 and in OpenSSL in the ssl/t1_lib.c file.\nThis setting is not applicable to TLSv1.1 and earlier versions of the\nprotocol as the signature algorithms aren't separately negotiated in these\nversions. It is not recommended to change this setting unless compatibility\nwith a middlebox is required.\n\n```\n\n**[ssl-dh-param-file](#3.1-ssl-dh-param-file)**<file>```\nThis setting is only available when support for OpenSSL was built in. It sets\nthe default DH parameters that are used during the SSL/TLS handshake when\nephemeral Diffie-Hellman (DHE) key exchange is used, for all \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines\nwhich do not explicitly define theirs. It will be overridden by custom DH\nparameters found in a bind certificate file if any. If custom DH parameters\nare not specified either by using ssl-dh-param-file or by setting them\ndirectly in the certificate file, DHE ciphers will not be used, unless\ntune.ssl.default-dh-param is set. In this latter case, pre-defined DH\nparameters of the specified size will be used. Custom parameters are known to\nbe more secure and therefore their use is recommended.\nCustom DH parameters may be generated by using the OpenSSL command\n\"openssl dhparam <size>\", where size should be at least 2048, as 1024-bit DH\nparameters should not be considered secure anymore.\n\n```\n\n**[ssl-propquery](#3.1-ssl-propquery)**<query>```\nThis setting is only available when support for OpenSSL was built in and when\nOpenSSL's version is at least 3.0. It allows to define a default property\nstring used when fetching algorithms in providers. It behave the same way as\nthe openssl propquery option and it follows the same syntax (described in\nhttps://www.openssl.org/docs/man3.0/man7/property.html). For instance, if you\nhave two providers loaded, the foo one and the default one, the propquery\n\"?provider=foo\" allows to pick the algorithm implementations provided by the\nfoo provider by default, and to fallback on the default provider's one if it\nwas not found.\n\n```\n\n**[ssl-provider](#3.1-ssl-provider)**<name>```\nThis setting is only available when support for OpenSSL was built in and when\nOpenSSL's version is at least 3.0. It allows to load a provider during init.\nIf loading is successful, any capabilities provided by the loaded provider\nmight be used by HAProxy. Multiple 'ssl-provider' options can be specified in\na configuration file. The providers will be loaded in their order of\nappearance.\n\nPlease note that loading a provider explicitly prevents OpenSSL from loading\nthe 'default' provider automatically. OpenSSL also allows to define the\nproviders that should be loaded directly in its configuration file\n(openssl.cnf for instance) so it is not necessary to use this 'ssl-provider'\noption to load providers. The \"show ssl providers\" CLI command can be used to\nshow all the providers that were successfully loaded.\n\nThe default search path of OpenSSL provider can be found in the output of the\n\"openssl version -a\" command. If the provider is in another directory, you\ncan set the OPENSSL_MODULES environment variable, which takes the directory\nwhere your provider can be found.\n\nSee also \"ssl-propquery\" and \"ssl-provider-path\".\n\n```\n\n**[ssl-provider-path](#3.1-ssl-provider-path)**<path>```\nThis setting is only available when support for OpenSSL was built in and when\nOpenSSL's version is at least 3.0. It allows to specify the search path that\nis to be used by OpenSSL for looking for providers. It behaves the same way\nas the OPENSSL_MODULES environment variable. It will be used for any\nfollowing 'ssl-provider' option or until a new 'ssl-provider-path' is\ndefined.\nSee also \"ssl-provider\".\n\n```\n\n**[ssl-load-extra-del-ext](#3.1-ssl-load-extra-del-ext)**```\nThis setting allows to configure the way HAProxy does the lookup for the\nextra SSL files. By default HAProxy adds a new extension to the filename.\n(ex: with \"foobar.crt\" load \"foobar.crt.key\"). With this option enabled,\nHAProxy removes the extension before adding the new one (ex: with\n\"foobar.crt\" load \"foobar.key\").\n\nYour crt file must have a \".crt\" extension for this option to work.\n\nThis option is not compatible with bundle extensions (.ecdsa, .rsa. .dsa)\nand won't try to remove them.\n\nThis option is disabled by default. See also \"ssl-load-extra-files\".\n\n```\n\n**[ssl-load-extra-files](#3.1-ssl-load-extra-files)**<none|all|bundle|sctl|ocsp|issuer|key>*```\nThis setting alters the way HAProxy will look for unspecified files during\nthe loading of the SSL certificates. This option applies to certificates\nassociated to \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines as well as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" lines but some of the extra\nfiles will not have any functional impact for \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" line certificates.\n\nBy default, HAProxy discovers automatically a lot of files not specified in\nthe configuration, and you may want to disable this behavior if you want to\noptimize the startup time.\n\n\"none\": Only load the files specified in the configuration. Don't try to load\na certificate bundle if the file does not exist. In the case of a directory,\nit won't try to bundle the certificates if they have the same basename.\n\n\"all\": This is the default behavior, it will try to load everything,\nbundles, sctl, ocsp, issuer, key.\n\n\"bundle\": When a file specified in the configuration does not exist, HAProxy\nwill try to load a \"cert bundle\". Certificate bundles are only managed on the\nfrontend side and will not work for backend certificates.\n\nStarting from HAProxy 2.3, the bundles are not loaded in the same OpenSSL\ncertificate store, instead it will loads each certificate in a separate\nstore which is equivalent to declaring multiple \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\". OpenSSL 1.1.1 is\nrequired to achieve this. Which means that bundles are now used only for\nbackward compatibility and are not mandatory anymore to do an hybrid RSA/ECC\nbind configuration.\n\nTo associate these PEM files into a \"cert bundle\" that is recognized by\nHAProxy, they must be named in the following way: All PEM files that are to\nbe bundled must have the same base name, with a suffix indicating the key\ntype. Currently, three suffixes are supported: rsa, dsa and ecdsa. For\nexample, if www.example.com has two PEM files, an RSA file and an ECDSA\nfile, they must be named: \"example.pem.rsa\" and \"example.pem.ecdsa\". The\nfirst part of the filename is arbitrary; only the suffix matters. To load\nthis bundle into HAProxy, specify the base name only:\n\n```\n\nExample :```\n\nbind :8443 ssl crt example.pem\n\n```\n\n```\nNote that the suffix is not given to HAProxy; this tells HAProxy to look for\na cert bundle.\n\nHAProxy will load all PEM files in the bundle as if they were configured\nseparately in several \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\".\n\nThe bundle loading does not have an impact anymore on the directory loading\nsince files are loading separately.\n\nOn the CLI, bundles are seen as separate files, and the bundle extension is\nrequired to commit them.\n\nOCSP files (.ocsp), issuer files (.issuer), Certificate Transparency (.sctl)\nas well as private keys (.key) are supported with multi-cert bundling.\n\n\"sctl\": Try to load \"<basename>.sctl\" for each crt keyword. If provided for\na backend certificate, it will be loaded but will not have any functional\nimpact.\n\n\"ocsp\": Try to load \"<basename>.ocsp\" for each crt keyword. If provided for\na backend certificate, it will be loaded but will not have any functional\nimpact.\n\n\"issuer\": Try to load \"<basename>.issuer\" if the issuer of the OCSP file is\nnot provided in the PEM file. If provided for a backend certificate, it will\nbe loaded but will not have any functional impact.\n\n\"key\": If the private key was not provided by the PEM file, try to load a\nfile \"<basename>.key\" containing a private key.\n\nThe default behavior is \"all\".\n\n```\n\nExample:```\n\nssl-load-extra-files bundle sctl\nssl-load-extra-files sctl ocsp issuer\nssl-load-extra-files none\n\n```\n\n**See also:**\"[crt](#)- This keyword is available in sections :\n- [Load options](#crt%20%28Load%20options%29)\n- [Bind options](#crt%20%28Bind%20options%29)\n- [Server and default-server options](#crt%20%28Server%20and%20default-server%20options%29)\n\n\",[section 5.1](#5.1)about bind options and[section 5.2](#5.2)about server options.**[ssl-security-level](#3.1-ssl-security-level)**<number>```\nThis directive allows to chose the OpenSSL security level as described in\nhttps://www.openssl.org/docs/man1.1.1/man3/SSL_CTX_set_security_level.html\nThe security level will be applied to every SSL contextes in HAProxy.\nOnly a value between 0 and 5 is supported.\n\nThe default value depends on your OpenSSL version, distribution and how was\ncompiled the library.\n\nThis directive requires at least OpenSSL 1.1.1.\n\n```\n\n**[ssl-server-verify](#3.1-ssl-server-verify)**[none|required]```\nThe default behavior for SSL verify on servers side. If specified to 'none',\nservers certificates are not verified. The default is 'required' except if\nforced using cmdline option '-dV'.\n\n```\n\n**[ssl-skip-self-issued-ca](#3.1-ssl-skip-self-issued-ca)**```\nSelf issued CA, aka x509 root CA, is the anchor for chain validation: as a\nserver is useless to send it, client must have it. Standard configuration\nneed to not include such CA in PEM file. This option allows you to keep such\nCA in PEM file without sending it to the client. Use case is to provide\nissuer for ocsp without the need for '.issuer' file and be able to share it\nwith 'issuers-chain-path'. This concerns all certificates without intermediate\ncertificates. It's useless for BoringSSL, .issuer is ignored because ocsp\nbits does not need it. Requires at least OpenSSL 1.0.2.\n\n```\n\n**[stats maxconn](#3.1-stats%20maxconn)**<connections>```\nBy default, the stats socket is limited to 10 concurrent connections. It is\npossible to change this value with \"stats maxconn\".\n\n```\n\n**[stats socket](#3.1-stats%20socket)**[<address:port>|<path>][param*]```\nBinds a UNIX socket to <path> or a TCPv4/v6 address to <address:port>.\nConnections to this socket will return various statistics outputs and even\nallow some commands to be issued to change some runtime settings. Please\nconsult section 9.3 \"Unix Socket commands\" of Management Guide for more\ndetails.\n\nAll parameters supported by \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines are supported, for instance to\nrestrict access to some users or their access rights. Please consult\nsection 5.1 for more information.\n\n```\n\n**[stats timeout](#3.1-stats%20timeout)**<timeout, in milliseconds>```\nThe default timeout on the stats socket is set to 10 seconds. It is possible\nto change this value with \"stats timeout\". The value must be passed in\nmilliseconds, or be suffixed by a time unit among { us, ms, s, m, h, d }.\n\n```\n\n**[stats-file](#3.1-stats-file)**<path>```\nPath to a generated haproxy stats-file. On startup haproxy will preload the\nvalues to its internal counters. Use the CLI command \"dump stats-file\" to\nproduce such stats-file. See the management manual for more details.\n\n```\n\n**[stress-level](#3.1-stress-level)**<level>```\nActivate alternative code to stress haproxy binary. Level is an integer from\n0 to 9. The default value 0 disable any stressing execution. Levels from 1 to\n9 will increase the stress pressure on the haproxy binary. Note that using\nany positive level can significantly hurt performance. As such it should\nnever be activated unless for debugging purpose and on a developer request.\n\n```\n\n**[strict-limits](#3.1-strict-limits)**```\nMakes process fail at startup when a setrlimit fails. HAProxy tries to set the\nbest setrlimit according to what has been calculated. If it fails, it will\nemit a warning. This option is here to guarantee an explicit failure of\nHAProxy when those limits fail. It is enabled by default. It may still be\nforcibly disabled by prefixing it with the \"no\" keyword.\n\n```\n\n**[thread-group](#3.1-thread-group)**<group>[<thread-range>...]```\nThis setting is only available when support for threads was built in. It\nenumerates the list of threads that will compose thread group <group>.\nThread numbers and group numbers start at 1. Thread ranges are defined either\nusing a single thread number at once, or by specifying the lower and upper\nbounds delimited by a dash '-' (e.g. \"1-16\"). Unassigned threads will be\nautomatically assigned to unassigned thread groups, and thread groups\ndefined with this directive will never receive more threads than those\ndefined. Defining the same group multiple times overrides previous\ndefinitions with the new one. See also \"nbthread\" and \"thread-groups\".\n\n```\n\n**[thread-groups](#3.1-thread-groups)**<number>```\nThis setting is only available when support for threads was built in. It\nmakes HAProxy split its threads into <number> independent groups. At the\nmoment, the default value is 1. Thread groups make it possible to reduce\nsharing between threads to limit contention, at the expense of some extra\nconfiguration efforts. It is also the only way to use more than 64 threads\nsince up to 64 threads per group may be configured. The maximum number of\ngroups is configured at compile time and defaults to 16. See also \"nbthread\".\n\n```\n\n**[thread-hard-limit](#3.1-thread-hard-limit)**<number>```\nThis setting is used to enforce a limit to the number of threads, either\ndetected, or configured. This is particularly useful on operating systems\nwhere the number of threads is automatically detected, where a number of\nthreads lower than the number of CPUs is desired in generic and portable\nconfigurations. Indeed, while \"nbthread\" enforces a number of threads that\nwill result in a warning and bad performance if higher than CPUs available,\nthread-hard-limit will only cap the maximum value and automatically limit\nthe number of threads to no higher than this value, but will not raise lower\nvalues. If \"nbthread\" is forced to a higher value, thread-hard-limit wins,\nand a warning is emitted in so that the configuration anomaly can be\nfixed. By default there is no limit. See also \"nbthread\".\n\n```\n\n**[uid](#3.1-uid)**<number>```\nChanges the process's user ID to <number>. It is recommended that the user ID\nis dedicated to HAProxy or to a small set of similar daemons. HAProxy must\nbe started with superuser privileges in order to be able to switch to another\none. See also \"gidThis keyword is available in sections :Process management and securityBind options\" and \"userThis keyword is available in sections :UserlistsPrograms (deprecated)Process management and securityBind options\".\n\n```\n\n**[ulimit-n](#3.1-ulimit-n)**<number>```\nSets the maximum number of per-process file-descriptors to <number>. By\ndefault, it is automatically computed, so it is recommended not to use this\noption. If the intent is only to limit the number of file descriptors, better\nuse \"fd-hard-limit\" instead.\n\nNote that the dynamic servers are not taken into account in this automatic\nresource calculation. If using a large number of them, it may be needed to\nmanually specify this value.\n\n```\n\n**See also:**fd-hard-limit, maxconn**[unix-bind](#3.1-unix-bind)**[ prefix<prefix>][ mode<mode>][ user<user>][ uid<uid>][ group<group>][ gid<gid>]```\nFixes common settings to UNIX listening sockets declared in \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" statements.\nThis is mainly used to simplify declaration of those UNIX sockets and reduce\nthe risk of errors, since those settings are most commonly required but are\nalso process-specific. The <prefix> setting can be used to force all socket\npath to be relative to that directory. This might be needed to access another\ncomponent's chroot. Note that those paths are resolved before HAProxy chroots\nitself, so they are absolute. The <mode>, <user>, <uid>, <group> and <gid>\nall have the same meaning as their homonyms used by the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" statement. If\nboth are specified, the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" statement has priority, meaning that the\n\"unix-bind\" settings may be seen as process-wide default settings.\n\n```\n\n**[unsetenv](#3.1-unsetenv)**[<name>...]```\nRemoves environment variables specified in arguments. This can be useful to\nhide some sensitive information that are occasionally inherited from the\nuser's environment during some operations. Variables which did not exist are\nsilently ignored so that after the operation, it is certain that none of\nthese variables remain. The changes immediately take effect so that the next\nline in the configuration file will not see these variables. See also\n\"setenv\", \"presetenv\", and \"resetenv\".\n\n```\n\n**[user](#3.1-user)**<user name>```\nSimilar to \"uidThis keyword is available in sections :Process management and securityBind options\" but uses the UID of user name <user name> from /etc/passwd.\nSee also \"uidThis keyword is available in sections :Process management and securityBind options\" and \"groupThis keyword is available in sections :UserlistsPrograms (deprecated)Process management and securityBind options\".\n\n```\n\n**[node](#3.1-node)**<name>```\nOnly letters, digits, hyphen and underscore are allowed, like in DNS names.\n\nThis statement is useful in HA configurations where two or more processes or\nservers share the same IP address. By setting a different node-name on all\nnodes, it becomes easy to immediately spot what server is handling the\ntraffic.\n\n```\n\n**[wurfl-cache-size](#3.1-wurfl-cache-size)**<size>```\nSets the WURFL Useragent cache size. For faster lookups, already processed user\nagents are kept in a LRU cache :\n- \"0\"     : no cache is used.\n- <size>  : size of lru cache in elements.\n\nPlease note that this option is only available when HAProxy has been compiled\nwith USE_WURFL=1.\n\n```\n\n**[wurfl-data-file](#3.1-wurfl-data-file)**<file path>```\nThe path of the WURFL data file to provide device detection services. The\nfile should be accessible by HAProxy with relevant permissions.\n\nPlease note that this option is only available when HAProxy has been compiled\nwith USE_WURFL=1.\n\n```\n\n**[wurfl-information-list](#3.1-wurfl-information-list)**[<capability>]*```\nA space-delimited list of WURFL capabilities, virtual capabilities, property\nnames we plan to use in injected headers. A full list of capability and\nvirtual capability names is available on the Scientiamobile website :\n\n    https://www.scientiamobile.com/wurflCapability\n\nValid WURFL properties are:\n- wurfl_id                    Contains the device ID of the matched device.\n\n- wurfl_root_id               Contains the device root ID of the matched\n                              device.\n\n- wurfl_isdevroot             Tells if the matched device is a root device.\n                              Possible values are \"TRUE\" or \"FALSE\".\n\n- wurfl_useragent             The original useragent coming with this\n                              particular web request.\n\n- wurfl_api_version           Contains a string representing the currently\n                              used Libwurfl API version.\n\n- wurfl_info                  A string containing information on the parsed\n                              wurfl.xml and its full path.\n\n- wurfl_last_load_time        Contains the UNIX timestamp of the last time\n                              WURFL has been loaded successfully.\n\n- wurfl_normalized_useragent  The normalized useragent.\n\nPlease note that this option is only available when HAProxy has been compiled\nwith USE_WURFL=1.\n\n```\n\n**[wurfl-information-list-separator](#3.1-wurfl-information-list-separator)**<char>```\nA char that will be used to separate values in a response header containing\nWURFL results. If not set that a comma (',') will be used by default.\n\nPlease note that this option is only available when HAProxy has been compiled\nwith USE_WURFL=1.\n\n```\n\n**[wurfl-patch-file](#3.1-wurfl-patch-file)**[<file path>]```\nA list of WURFL patch file paths. Note that patches are loaded during startup\nthus before the chroot.\n\nPlease note that this option is only available when HAProxy has been compiled\nwith USE_WURFL=1.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "3.2. Performance tuning", "content": "## [3.2.](#3.2)Performance tuning\n\n**[busy-polling](#3.2-busy-polling)**```\nIn some situations, especially when dealing with low latency on processors\nsupporting a variable frequency or when running inside virtual machines, each\ntime the process waits for an I/O using the poller, the processor goes back\nto sleep or is offered to another VM for a long time, and it causes\nexcessively high latencies. This option provides a solution preventing the\nprocessor from sleeping by always using a null timeout on the pollers. This\nresults in a significant latency reduction (30 to 100 microseconds observed)\nat the expense of a risk to overheat the processor. It may even be used with\nthreads, in which case improperly bound threads may heavily conflict,\nresulting in a worse performance and high values for the CPU stolen fields\nin \"show info\" output, indicating which threads are misconfigured. It is\nimportant not to let the process run on the same processor as the network\ninterrupts when this option is used. It is also better to avoid using it on\nmultiple CPU threads sharing the same core. This option is disabled by\ndefault. If it has been enabled, it may still be forcibly disabled by\nprefixing it with the \"no\" keyword. It is ignored by the \"select\" and\n\"poll\" pollers.\n\nThis option is automatically disabled on old processes in the context of\nseamless reload; it avoids too much cpu conflicts when multiple processes\nstay around for some time waiting for the end of their current connections.\n\n```\n\n**[max-spread-checks](#3.2-max-spread-checks)**<delay in milliseconds>```\nBy default, HAProxy tries to spread the start of health checks across the\nsmallest health check interval of all the servers in a farm. The principle is\nto avoid hammering services running on the same server. But when using large\ncheck intervals (10 seconds or more), the last servers in the farm take some\ntime before starting to be tested, which can be a problem. This parameter is\nused to enforce an upper bound on delay between the first and the last check,\neven if the servers' check intervals are larger. When servers run with\nshorter intervals, their intervals will be respected though.\n\n```\n\n**[maxcompcpuusage](#3.2-maxcompcpuusage)**<number>```\nSets the maximum CPU usage HAProxy can reach before stopping the compression\nfor new requests or decreasing the compression level of current requests.\nIt works like 'maxcomprate' but measures CPU usage instead of incoming data\nbandwidth. The value is expressed in percent of the CPU used by HAProxy. A\nvalue of 100 disable the limit. The default value is 100. Setting a lower\nvalue will prevent the compression work from slowing the whole process down\nand from introducing high latencies.\n\n```\n\n**[maxcomprate](#3.2-maxcomprate)**<number>```\nSets the maximum per-process input compression rate to <number> kilobytes\nper second. For each stream, if the maximum is reached, the compression\nlevel will be decreased during the stream. If the maximum is reached at the\nbeginning of a stream, the stream will not compress at all. If the maximum\nis not reached, the compression level will be increased up to\ntune.comp.maxlevel. A value of zero means there is no limit, this is the\ndefault value.\n\n```\n\n**[maxconn](#3.2-maxconn)**<number>```\nSets the maximum per-process number of concurrent connections to <number>. It\nis equivalent to the command-line argument \"-n\". The value provided in\ncommand-line argument via \"-n\" takes the precedence over the maxconn value set\nin the global section. Haproxy process could be also compiled with\nSYSTEM_MAXCONN compile-time variable, which is served in this case as the\nsystem maxconn maximum. Again, the command-line \"-n\" argument allows at\nruntime to bypass SYSTEM_MAXCONN limit, if set. Proxies will stop accepting\nconnections when maxconn is reached. The process soft file descriptor limit\n(could be obtained with \"ulimit -n\" command) is automatically adjusted\naccording to provided maxconn. See also \"ulimit-n\". Note: the \"select\" poller\ncannot reliably use more than 1024 file descriptors on some platforms. If your\nplatform only supports select and reports \"select FAILED\" on startup, you need\nto reduce the maxconn until it works (slightly below 500 in general). If\nmaxconn value is not set, it will be automatically calculated based on the\ncurrent file descriptors limits, reported by the \"ulimit -nH\" command (we take\nthe maximum between the hard and soft values), then automatic value will be\npossibly reduced by \"fd-hard-limit\" and by memory limit, if the latter was\nenforced via \"-m\" command line option. Automatic value is also dependent from\nthe buffer size, memory allocated to compression, SSL cache size, and the use\nor not of SSL and the associated maxsslconn (which can also be automatic).\n\n```\n\n**See also:**fd-hard-limit, ulimit-n**[maxconnrate](#3.2-maxconnrate)**<number>```\nSets the maximum per-process number of connections per second to <number>.\nProxies will stop accepting connections when this limit is reached. It can be\nused to limit the global capacity regardless of each frontend capacity. It is\nimportant to note that this can only be used as a service protection measure,\nas there will not necessarily be a fair share between frontends when the\nlimit is reached, so it's a good idea to also limit each frontend to some\nvalue close to its expected share. Also, lowering tune.maxaccept can improve\nfairness.\n\n```\n\n**[maxpipes](#3.2-maxpipes)**<number>```\nSets the maximum per-process number of pipes to <number>. Currently, pipes\nare only used by kernel-based tcp splicing. Since a pipe contains two file\ndescriptors, the \"ulimit-n\" value will be increased accordingly. The default\nvalue is maxconn/4, which seems to be more than enough for most heavy usages.\nThe splice code dynamically allocates and releases pipes, and can fall back\nto standard copy, so setting this value too low may only impact performance.\n\n```\n\n**[maxsessrate](#3.2-maxsessrate)**<number>```\nSets the maximum per-process number of sessions per second to <number>.\nProxies will stop accepting connections when this limit is reached. It can be\nused to limit the global capacity regardless of each frontend capacity. It is\nimportant to note that this can only be used as a service protection measure,\nas there will not necessarily be a fair share between frontends when the\nlimit is reached, so it's a good idea to also limit each frontend to some\nvalue close to its expected share. Also, lowering tune.maxaccept can improve\nfairness.\n\n```\n\n**[maxsslconn](#3.2-maxsslconn)**<number>```\nSets the maximum per-process number of concurrent SSL connections to\n<number>. By default there is no SSL-specific limit, which means that the\nglobal maxconn setting will apply to all connections. Setting this limit\navoids having openssl use too much memory and crash when malloc returns NULL\n(since it unfortunately does not reliably check for such conditions). Note\nthat the limit applies both to incoming and outgoing connections, so one\nconnection which is deciphered then ciphered accounts for 2 SSL connections.\nIf this value is not set, but a memory limit is enforced, this value will be\nautomatically computed based on the memory limit, maxconn,  the buffer size,\nmemory allocated to compression, SSL cache size, and use of SSL in either\nfrontends, backends or both. If neither maxconn nor maxsslconn are specified\nwhen there is a memory limit, HAProxy will automatically adjust these values\nso that 100% of the connections can be made over SSL with no risk, and will\nconsider the sides where it is enabled (frontend, backend, both).\n\n```\n\n**[maxsslrate](#3.2-maxsslrate)**<number>```\nSets the maximum per-process number of SSL sessions per second to <number>.\nSSL listeners will stop accepting connections when this limit is reached. It\ncan be used to limit the global SSL CPU usage regardless of each frontend\ncapacity. It is important to note that this can only be used as a service\nprotection measure, as there will not necessarily be a fair share between\nfrontends when the limit is reached, so it's a good idea to also limit each\nfrontend to some value close to its expected share. It is also important to\nnote that the sessions are accounted before they enter the SSL stack and not\nafter, which also protects the stack against bad handshakes. Also, lowering\ntune.maxaccept can improve fairness.\n\n```\n\n**[maxzlibmem](#3.2-maxzlibmem)**<number>```\nSets the maximum amount of RAM in megabytes per process usable by the zlib.\nWhen the maximum amount is reached, future streams will not compress as long\nas RAM is unavailable. When sets to 0, there is no limit.\nThe default value is 0. The value is available in bytes on the UNIX socket\nwith \"show info\" on the line \"MaxZlibMemUsage\", the memory used by zlib is\n\"ZlibMemUsage\" in bytes.\n\n```\n\n**[no-memory-trimming](#3.2-no-memory-trimming)**```\nDisables memory trimming (\"malloc_trim\") at a few moments where attempts are\nmade to reclaim lots of memory (on memory shortage or on reload). Trimming\nmemory forces the system's allocator to scan all unused areas and to release\nthem. This is generally seen as nice action to leave more available memory to\na new process while the old one is unlikely to make significant use of it.\nBut some systems dealing with tens to hundreds of thousands of concurrent\nconnections may experience a lot of memory fragmentation, that may render\nthis release operation extremely long. During this time, no more traffic\npasses through the process, new connections are not accepted anymore, some\nhealth checks may even fail, and the watchdog may even trigger and kill the\nunresponsive process, leaving a huge core dump. If this ever happens, then it\nis suggested to use this option to disable trimming and stop trying to be\nnice with the new process. Note that advanced memory allocators usually do\nnot suffer from such a problem.\n\n```\n\n**[noepoll](#3.2-noepoll)**```\nDisables the use of the \"epoll\" event polling system on Linux. It is\nequivalent to the command-line argument \"-de\". The next polling system\nused will generally be \"poll\". See also \"nopoll\".\n\n```\n\n**[noevports](#3.2-noevports)**```\nDisables the use of the event ports event polling system on SunOS systems\nderived from Solaris 10 and later. It is equivalent to the command-line\nargument \"-dv\". The next polling system used will generally be \"poll\". See\nalso \"nopoll\".\n\n```\n\n**[nogetaddrinfo](#3.2-nogetaddrinfo)**```\nDisables the use of getaddrinfo(3) for name resolving. It is equivalent to\nthe command line argument \"-dG\". Deprecated gethostbyname(3) will be used.\n\n```\n\n**[nokqueue](#3.2-nokqueue)**```\nDisables the use of the \"kqueue\" event polling system on BSD. It is\nequivalent to the command-line argument \"-dk\". The next polling system\nused will generally be \"poll\". See also \"nopoll\".\n\n```\n\n**[nopoll](#3.2-nopoll)**```\nDisables the use of the \"poll\" event polling system. It is equivalent to the\ncommand-line argument \"-dp\". The next polling system used will be \"select\".\nIt should never be needed to disable \"poll\" since it's available on all\nplatforms supported by HAProxy. See also \"nokqueue\", \"noepoll\" and\n\"noevports\".\n\n```\n\n**[noreuseport](#3.2-noreuseport)**```\nDisables the use of SO_REUSEPORT - see socket(7). It is equivalent to the\ncommand line argument \"-dR\".\n\n```\n\n**[nosplice](#3.2-nosplice)**```\nDisables the use of kernel tcp splicing between sockets on Linux. It is\nequivalent to the command line argument \"-dS\". Data will then be copied\nusing conventional and more portable recv/send calls. Kernel tcp splicing is\nlimited to some very recent instances of kernel 2.6. Most versions between\n2.6.25 and 2.6.28 are buggy and will forward corrupted data, so they must not\nbe used. This option makes it easier to globally disable kernel splicing in\ncase of doubt. See also \"option splice-auto\", \"option splice-request\" and\n\"option splice-response\".\n\n```\n\n**[profiling.memory](#3.2-profiling.memory)**{ on | off }```\nEnables ('on') or disables ('off') per-function memory profiling. This will\nkeep usage statistics of malloc/calloc/realloc/free calls anywhere in the\nprocess (including libraries) which will be reported on the CLI using the\n\"show profiling\" command. This is essentially meant to be used when an\nabnormal memory usage is observed that cannot be explained by the pools and\nother info are required. The performance hit will typically be around 1%,\nmaybe a bit more on highly threaded machines, so it is normally suitable for\nuse in production. The same may be achieved at run time on the CLI using the\n\"set profiling memory\" command, please consult the management manual.\n\n```\n\n**[profiling.tasks](#3.2-profiling.tasks)**{ auto | on | off }```\nEnables ('on') or disables ('off') per-task CPU profiling. When set to 'auto'\nthe profiling automatically turns on a thread when it starts to suffer from\nan average latency of 1000 microseconds or higher as reported in the\n\"avg_loop_us\" activity field, and automatically turns off when the latency\nreturns below 990 microseconds (this value is an average over the last 1024\nloops so it does not vary quickly and tends to significantly smooth short\nspikes). It may also spontaneously trigger from time to time on overloaded\nsystems, containers, or virtual machines, or when the system swaps (which\nmust absolutely never happen on a load balancer).\n\nCPU profiling per task can be very convenient to report where the time is\nspent and which requests have what effect on which other request. Enabling\nit will typically affect the overall's performance by less than 1%, thus it\nis recommended to leave it to the default 'auto' value so that it only\noperates when a problem is identified. This feature requires a system\nsupporting the clock_gettime(2) syscall with clock identifiers\nCLOCK_MONOTONIC and CLOCK_THREAD_CPUTIME_ID, otherwise the reported time will\nbe zero. This option may be changed at run time using \"set profiling\" on the\nCLI.\n\n```\n\n**[spread-checks](#3.2-spread-checks)**<0..50, in percent>```\nSometimes it is desirable to avoid sending agent and health checks to\nservers at exact intervals, for instance when many logical servers are\nlocated on the same physical server. With the help of this parameter, it\nbecomes possible to add some randomness in the check interval between 0\nand +/- 50%. A value between 2 and 5 seems to show good results. The\ndefault value remains at 0.\n\n```\n\n**[ssl-engine](#3.2-ssl-engine)**<name>[algo<comma-separated list of algorithms>]```\nSets the OpenSSL engine to <name>. List of valid values for <name> may be\nobtained using the command \"openssl engine\". This statement may be used\nmultiple times, it will simply enable multiple crypto engines. Referencing an\nunsupported engine will prevent HAProxy from starting. Note that many engines\nwill lead to lower HTTPS performance than pure software with recent\nprocessors. The optional command \"algo\" sets the default algorithms an ENGINE\nwill supply using the OPENSSL function ENGINE_set_default_string(). A value\nof \"ALL\" uses the engine for all cryptographic operations. If no list of\nalgo is specified then the value of \"ALL\" is used. A comma-separated list\nof different algorithms may be specified, including: RSA, DSA, DH, EC, RAND,\nCIPHERS, DIGESTS, PKEY, PKEY_CRYPTO, PKEY_ASN1. This is the same format that\nopenssl configuration file uses:\nhttps://www.openssl.org/docs/man1.0.2/apps/config.html\n\nHAProxy Version 2.6 disabled the support for engines in the default build.\nThis option is only available when HAProxy has been built with support for\nit.  In case the ssl-engine is required HAProxy can be rebuild with the\nUSE_ENGINE=1 flag.\n\n```\n\n**[ssl-mode-async](#3.2-ssl-mode-async)**```\nAdds SSL_MODE_ASYNC mode to the SSL context. This enables asynchronous TLS\nI/O operations if asynchronous capable SSL engines are used. The current\nimplementation supports a maximum of 32 engines. The Openssl ASYNC API\ndoesn't support moving read/write buffers and is not compliant with\nHAProxy's buffer management. So the asynchronous mode is disabled on\nread/write  operations (it is only enabled during initial and renegotiation\nhandshakes).\n\n```\n\n**[tune.applet.zero-copy-forwarding](#3.2-tune.applet.zero-copy-forwarding)**{ on | off }```\nEnables ('on') of disabled ('off') the zero-copy forwarding of data for the\napplets. It is enabled by default.\n\n```\n\n**See also:**tune.disable-zero-copy-forwarding.**[tune.buffers.limit](#3.2-tune.buffers.limit)**<number>```\nSets a hard limit on the number of buffers which may be allocated per process.\nThe default value is zero which means unlimited. The limit will automatically\nbe re-adjusted to satisfy the reserved buffers for emergency situations so\nthat the user doesn't have to perform complicated calculations. Forcing this\nvalue can be particularly useful to limit the amount of memory a process may\ntake, while retaining a sane behavior. When this limit is reached, a task\nthat requests a buffer waits for another one to be released first. Most of\nthe time the waiting time is very short and not perceptible provided that\nlimits remain reasonable. However, some historical limitations have weakened\nthis mechanism over versions and it is known that in certain situations of\nsustained shortage, some tasks may freeze until their timeout expires, so it\nis safer to avoid using this when not strictly necessary.\n\n```\n\n**[tune.buffers.reserve](#3.2-tune.buffers.reserve)**<number>```\nSets the number of per-thread buffers which are pre-allocated and reserved\nfor use only during memory shortage conditions resulting in failed memory\nallocations. The minimum value is 0 and the default is 4. There is no reason\na user would want to change this value, unless a core developer suggests to\nchange it for a very specific reason.\n\n```\n\n**[tune.bufsize](#3.2-tune.bufsize)**<size>```\nSets the buffer size to this size (in bytes). Lower values allow more\nstreams to coexist in the same amount of RAM, and higher values allow some\napplications with very large cookies to work. The default value is 16384 and\ncan be changed at build time. It is strongly recommended not to change this\nfrom the default value, as very low values will break some services such as\nstatistics, and values larger than default size will increase memory usage,\npossibly causing the system to run out of memory. At least the global maxconn\nparameter should be decreased by the same factor as this one is increased. In\naddition, use of HTTP/2 mandates that this value must be 16384 or more. If an\nHTTP request is larger than (tune.bufsize - tune.maxrewrite), HAProxy will\nreturn HTTP 400 (Bad Request) error. Similarly if an HTTP response is larger\nthan this size, HAProxy will return HTTP 502 (Bad Gateway). Note that the\nvalue set using this parameter will automatically be rounded up to the next\nmultiple of 8 on 32-bit machines and 16 on 64-bit machines.\n\n```\n\n**[tune.bufsize.small](#3.2-tune.bufsize.small)**<size>```\nSets the size in bytes for small buffers. The defaults value is 1024.\n\nThese buffers are designed to be used in some specific contexts where memory\nconsumption is restrained but it seems unnecessary to allocate a full buffer.\nIf however a small buffer is not sufficient, a reallocation is automatically\ndone to switch to a standard size buffer.\n\nFor the moment, it is used only by HTTP/3 protocol to emit the response\nheaders.\n\n```\n\n**[tune.comp.maxlevel](#3.2-tune.comp.maxlevel)**<number>```\nSets the maximum compression level. The compression level affects CPU\nusage during compression. This value affects CPU usage during compression.\nEach stream using compression initializes the compression algorithm with\nthis value. The default value is 1.\n\n```\n\n**[tune.disable-fast-forward](#3.2-tune.disable-fast-forward)**[ EXPERIMENTAL ]```\nDisables the data fast-forwarding. It is a mechanism to optimize the data\nforwarding by passing data directly from a side to the other one without\nwaking the stream up. Thanks to this directive, it is possible to disable\nthis optimization. Note it also disable any kernel tcp splicing but also the\nzero-copy forwarding. This command is not meant for regular use, it will\ngenerally only be suggested by developers along complex debugging\nsessions. For this reason it is internally marked as experimental, meaning\nthat \"expose-experimental-directives\" must appear on a line before this\ndirective.\n\n```\n\n**[tune.disable-zero-copy-forwarding](#3.2-tune.disable-zero-copy-forwarding)**```\nGlobally disables the zero-copy forwarding of data. It is a mechanism to\noptimize the data fast-forwarding by avoiding to use the channel's buffer.\nThanks to this directive, it is possible to disable this optimization. Note\nit also disable any kernel tcp splicing.\n\n```\n\n**See also:**tune.pt.zero-copy-forwarding, tune.applet.zero-copy-forwarding, tune.h1.zero-copy-fwd-recv, tune.h1.zero-copy-fwd-send, tune.h2.zero-copy-fwd-send, tune.quic.zero-copy-fwd-send**[tune.epoll.mask-events](#3.2-tune.epoll.mask-events)**<event[,...]>```\nAlong HAProxy's history, a few complex issues were met that were caused by\nbugs in the epoll mechanism in the Linux kernel. These ones usually are very\nrare and unreproducible outside the reporter's environment, and may only be\nworked around by disabling epoll and switching to poll instead, which is not\nvery satisfying for high performance environments. Each time, issues affect\nonly very specific (and rare) event types, and offering the ability to mask\nthem can constitute a more acceptable work-around. This options offers this\npossibility by permitting to silently ignore events a few uncommon events\nand replace them with an input (which reports an unspecified incoming event).\nThe effect is to avoid the fast error processing paths in certain places and\nonly use the common paths. This should never be used unless being invited to\ndo so by an expert in order to diagnose or work around a kernel bug.\n\nThe option takes a single argument which is a comma-delimited list of words\neach designating an event to be masked. The currently supported list of\nevents is:\n  - \"err\":   mask the EPOLLERR event\n  - \"hup\":   mask the EPOLLHUP events\n  - \"rdhup\": mask the EPOLLRDHUP events\n\n```\n\nExample:```\n\n# mask all non-traffic epoll events:\ntune.epoll.mask-events err,hup,rdhup\n\n```\n\n**[tune.events.max-events-at-once](#3.2-tune.events.max-events-at-once)**<number>```\nSets the number of events that may be processed at once by an asynchronous\ntask handler (from event_hdl API). <number> should be included between 1\nand 10000. Large number could cause thread contention as a result of the\ntask doing heavy work without interruption, and on the other hand, small\nnumber could result in the task being constantly rescheduled because it\ncannot consume enough events per run and is not able to catch up with the\nevent producer. The default value may be forced at build time, otherwise\ndefaults to 100.\n\n```\n\n**[tune.fail-alloc](#3.2-tune.fail-alloc)**```\nIf compiled with DEBUG_FAIL_ALLOC or started with \"-dMfail\", gives the\npercentage of chances an allocation attempt fails. Must be between 0 (no\nfailure) and 100 (no success). This is useful to debug and make sure memory\nfailures are handled gracefully. When not set, the ratio is 0. However the\ncommand-line \"-dMfail\" option automatically sets it to 1% failure rate so that\nit is not necessary to change the configuration for testing.\n\n```\n\n**[tune.fd.edge-triggered](#3.2-tune.fd.edge-triggered)**{ on | off }[ EXPERIMENTAL ]```\nEnables ('on') or disables ('off') the edge-triggered polling mode for FDs\nthat support it. This is currently only support with epoll. It may noticeably\nreduce the number of epoll_ctl() calls and slightly improve performance in\ncertain scenarios. This is still experimental, it may result in frozen\nconnections if bugs are still present, and is disabled by default.\n\n```\n\n**[tune.glitches.kill.cpu-usage](#3.2-tune.glitches.kill.cpu-usage)**<number>```\nSets the minimum CPU usage between 0 and 100, at which connections showing\ntoo many glitches will be killed. This applies to connections that have\nreached their glitches-threshold limit. In environments where very long\nconnections often behave badly without causing any performance impact, it\nmight be desirable to keep them regardless of their misbehavior as long as\nthey do not hurt, and to only start to kill such connections when the CPU is\ngetting busy. This parameters allows to specify that a connection reaching\nits glitches threshold will be actively killed when the CPU usage is at this\nlevel or above, but never when it's below. Note that the CPU usage is\nmeasured per thread, so a single misbehaving connection might be killed. The\ndefault is zero, meaning that a connection reaching its glitches-threshold\nwill automatically get killed. A rule of thumb would be to set this value to\ntwice the usually observed CPU usage, or the commonly observed CPU usage plus\nhalf the idle one (i.e. if CPU commonly reaches 60%, setting 80 here can make\nsense). This parameter has no effect without tune.h2.fe.glitches-threshold or\ntune.quic.frontend.glitches-threshold. See also the global parameters\n\"tune.h2.fe.glitches-threshold\" and \"tune.quic.frontend.glitches-threshold\".\n\n```\n\n**[tune.h1.zero-copy-fwd-recv](#3.2-tune.h1.zero-copy-fwd-recv)**{ on | off }```\nEnables ('on') of disabled ('off') the zero-copy receives of data for the H1\nmultiplexer. It is enabled by default.\n\n```\n\n**See also:**tune.disable-zero-copy-forwarding, tune.h1.zero-copy-fwd-send**[tune.h1.zero-copy-fwd-send](#3.2-tune.h1.zero-copy-fwd-send)**{ on | off }```\nEnables ('on') of disabled ('off') the zero-copy sends of data for the H1\nmultiplexer. It is enabled by default.\n\n```\n\n**See also:**tune.disable-zero-copy-forwarding, tune.h1.zero-copy-fwd-recv**[tune.h2.be.glitches-threshold](#3.2-tune.h2.be.glitches-threshold)**<number>```\nSets the threshold for the number of glitches on a backend connection, where\nthat connection will automatically be killed. This allows to automatically\nkill misbehaving connections without having to write explicit rules for them.\nThe default value is zero, indicating that no threshold is set so that no\nevent will cause a connection to be closed. Beware that some H2 servers may\noccasionally cause a few glitches over long lasting connection, so any non-\nzero value here should probably be in the hundreds or thousands to be\neffective without affecting slightly bogus servers. It is also possible to\nonly kill connections when the CPU usage crosses a certain level, by using\n\"tune.glitches.kill.cpu-usage\".\n\n```\n\n**See also:**tune.h2.fe.glitches-threshold, bc_glitches, and tune.glitches.kill.cpu-usage**[tune.h2.be.initial-window-size](#3.2-tune.h2.be.initial-window-size)**<number>```\nSets the HTTP/2 initial window size for outgoing connections, which is the\nnumber of bytes the server can respond before waiting for an acknowledgment\nfrom HAProxy. This setting only affects payload contents, not headers. When\nnot set, the common default value set by tune.h2.initial-window-size applies.\nIt can make sense to slightly increase this value to allow faster downloads\nor to reduce CPU usage on the servers, at the expense of creating unfairness\nbetween clients. It is better to use tune.h2.be.rxbuf instead, which does not\ncause any unfairness. It doesn't affect resource usage.\n\n```\n\n**See also:**tune.h2.initial-window-size.**[tune.h2.be.max-concurrent-streams](#3.2-tune.h2.be.max-concurrent-streams)**<number>```\nSets the HTTP/2 maximum number of concurrent streams per outgoing connection\n(i.e. the number of outstanding requests on a single connection to a server).\nWhen not set, the default set by tune.h2.max-concurrent-streams applies. A\nsmaller value than the default 100 may improve a site's responsiveness at the\nexpense of maintaining more established connections to the servers. When the\n\"http-reuse\" setting is set to \"always\", it is recommended to reduce this\nvalue so as not to mix too many different clients over the same connection,\nbecause if a client is slower than others, a mechanism known as \"head of\nline blocking\" tends to cause cascade effect on download speed for all\nclients sharing a connection (keep tune.h2.be.initial-window-size low in this\ncase). It is highly recommended not to increase this value; some might find\nit optimal to run at low values (1..5 typically).\n\n```\n\n**[tune.h2.be.rxbuf](#3.2-tune.h2.be.rxbuf)**<size>```\nSets the HTTP/2 receive buffer size for outgoing connections, in bytes. This\nsize will be rounded up to the next multiple of tune.bufsize and will be\nshared between all streams uploading data (both HEADERS and DATA frames). In\nany case, one buffer will always be granted to each stream, and 7/8 of the\nunused buffers will be shared between streams downloading payload, allowing\nto significantly improve upload performance and avoid head-of-line blocking\n(HoL) on backend connections shared between multiple clients when http-reuse\nis set to \"always\". The advertised per-stream window is automatically\nadjusted to reflect the available space so that in practice it should not be\nrequired to touch tune.h2.be.initial-window-size. If less than the size\nrequired to deal with all streams is set, this minimum will be used. The\ndefault value is about 1600k (100 streams with 16kB buffers each).\n\n```\n\n**See also:**tune.h2.be.initial-window-size, tune.h2.fe.rxbuf, http-reuse.**[tune.h2.fe.glitches-threshold](#3.2-tune.h2.fe.glitches-threshold)**<number>```\nSets the threshold for the number of glitches on a frontend connection, where\nthat connection will automatically be killed. This allows to automatically\nkill misbehaving connections without having to write explicit rules for them.\nThe default value is zero, indicating that no threshold is set so that no\nevent will cause a connection to be closed. Beware that some H2 clientss may\noccasionally cause a few glitches over long lasting connection, so any non-\nzero value here should probably be in the hundreds or thousands to be\neffective without affecting slightly bogus clients. It is also possible to\nonly kill connections when the CPU usage crosses a certain level, by using\n\"tune.glitches.kill.cpu-usage\".\n\n```\n\n**See also:**tune.h2.be.glitches-threshold, fc_glitches, and tune.glitches.kill.cpu-usage**[tune.h2.fe.initial-window-size](#3.2-tune.h2.fe.initial-window-size)**<number>```\nSets the HTTP/2 initial window size for incoming connections, which is the\nnumber of bytes the client can upload before waiting for an acknowledgment\nfrom HAProxy. This setting only affects payload contents (i.e. the body of\nPOST requests), not headers. When not set, the common default value set by\ntune.h2.initial-window-size applies. It can make sense to increase this value\nto allow faster uploads. The default value equals tune.bufsize (16384) and\nallows at least 1.25 Mbps of bandwidth per stream over a 100 ms ping time,\nand 125 Mbps for 1 ms ping time. It doesn't affect resource usage. Using too\nlarge values may cause clients to experience a lack of responsiveness if\npages are accessed in parallel to large uploads. It is better to use\ntune.h2.fe.rxbuf instead, which does not cause any unfairness.\n\n```\n\n**See also:**tune.h2.initial-window-size.**[tune.h2.fe.max-concurrent-streams](#3.2-tune.h2.fe.max-concurrent-streams)**<number>```\nSets the HTTP/2 maximum number of concurrent streams per incoming connection\n(i.e. the number of outstanding requests on a single connection from a\nclient). When not set, the default set by tune.h2.max-concurrent-streams\napplies. A larger value than the default 100 may sometimes slightly improve\nthe page load time for complex sites with lots of small objects over high\nlatency networks but can also result in using more memory by allowing a\nclient to allocate more resources at once. The default value of 100 is\ngenerally good and it is recommended not to change this value.\n\n```\n\n**[tune.h2.fe.max-total-streams](#3.2-tune.h2.fe.max-total-streams)**<number>```\nSets the HTTP/2 maximum number of total streams processed per incoming\nconnection. Once this limit is reached, HAProxy will send a graceful GOAWAY\nframe informing the client that it will close the connection after all\npending streams have been closed. In practice, clients tend to close as fast\nas possible when receiving this, and to establish a new connection for next\nrequests. Doing this is sometimes useful and desired in situations where\nclients stay connected for a very long time and cause some imbalance inside a\nfarm. For example, in some highly dynamic environments, it is possible that\nnew load balancers are instantiated on the fly to adapt to a load increase,\nand that once the load goes down they should be stopped without breaking\nestablished connections. By setting a limit here, the connections will have\na limited lifetime and will be frequently renewed, with some possibly being\nestablished to other nodes, so that existing resources are quickly released.\n\nIt's important to understand that there is an implicit relation between this\nlimit and \"tune.h2.fe.max-concurrent-streams\" above. Indeed, HAProxy will\nalways accept to process any possibly pending streams that might be in flight\nbetween the client and the frontend, so the advertised limit will always\nautomatically be raised by the value configured in max-concurrent-streams,\nand this value will serve as a hard limit above which a violation by a non-\ncompliant client will result in the connection being closed. Thus when\ncounting the number of requests per connection from the logs, any number\nbetween max-total-streams and (max-total-streams + max-concurrent-streams)\nmay be observed depending on how fast streams are created by the client.\n\nThe default value is zero, which enforces no limit beyond those implied by\nthe protocol (2^30 ~= 1.07 billion). Values around 1000 may already cause\nfrequent connection renewal without causing any perceptible latency to most\nclients. Setting it too low may result in an increase of CPU usage due to\nfrequent TLS reconnections, in addition to increased page load time. Please\nnote that some load testing tools do not support reconnections and may report\nerrors with this setting; as such it may be needed to disable it when running\nperformance benchmarks. See also \"tune.h2.fe.max-concurrent-streams\".\n\n```\n\n**[tune.h2.fe.rxbuf](#3.2-tune.h2.fe.rxbuf)**<size>```\nSets the HTTP/2 receive buffer size for incoming connections, in bytes. This\nsize will be rounded up to the next multiple of tune.bufsize and will be\nshared between all streams uploading data (both HEADERS and DATA frames). In\nany case, one buffer will always be granted to each stream, and 7/8 of the\nunused buffers will be shared between streams uploading payload, allowing to\nsignificantly improve upload performance. The advertised per-stream window is\nautomatically adjusted to reflect the available space so that in practice it\nshould not be required to touch tune.h2.fe.initial-window-size. If less than\nthe size required to deal with all streams is set, this minimum will be used.\nThe default value of 1600k (100 streams with 16kB buffers each) permits\nroughly 130 Mbps of upload speed for a client with a 100ms RTT.\n\n```\n\n**See also:**tune.h2.fe.initial-window-size and tune.h2.be.rxbuf.**[tune.h2.header-table-size](#3.2-tune.h2.header-table-size)**<number>```\nSets the HTTP/2 dynamic header table size. It defaults to 4096 bytes and\ncannot be larger than 65536 bytes. A larger value may help certain clients\nsend more compact requests, depending on their capabilities. This amount of\nmemory is consumed for each HTTP/2 connection. It is recommended not to\nchange it.\n\n```\n\n**[tune.h2.initial-window-size](#3.2-tune.h2.initial-window-size)**<number>```\nSets the default value for the HTTP/2 initial window size, on both incoming\nand outgoing connections. This value is used for incoming connections when\ntune.h2.fe.initial-window-size is not set, and by outgoing connections when\ntune.h2.be.initial-window-size is not set. This setting is used both as the\ninitial value and as a minimum per stream. The default value equals 16384\n(tune.bufsize), which for uploads roughly allows at least 1.25 Mbps of\nbandwidth per stream over a network showing a 100 ms ping time, or 125 Mbps\nover a 1-ms local network. When less receive buffers than the maximum are in\nuse, within the limits defined by tune.h2.be.rxbuf and tune.h2.fe.rxbuf,\nunused buffers will be shared between receiving streams. As such there is\nnormally no point in changing this default setting. Given that changing this\ndefault value will both increase upload speeds and cause more unfairness\nbetween clients on downloads, it is recommended to instead use the side-\nspecific settings tune.h2.fe.initial-window-size and\ntune.h2.be.initial-window-size.\n\n```\n\n**[tune.h2.log-errors](#3.2-tune.h2.log-errors)**{ none | connection | stream }```\nSets the level of errors in the H2 demultiplexer that will generate a log.\nThe default is \"stream\", which means that any decoding error encountered in\nthe demultiplexer will lead to the emission of a log. The \"connection\" value\nindicates that only logs that result in invalidating the connection will\nproduce a log. Finally, \"none\" indicates that no decoding error will produce\nany log. It is recommended to set at least \"connection\" in order to detect\nprotocol anomalies, even if this means temporarily switching to \"none\" during\ndifficult periods.\n\n```\n\n**[tune.h2.max-concurrent-streams](#3.2-tune.h2.max-concurrent-streams)**<number>```\nSets the default HTTP/2 maximum number of concurrent streams per connection\n(i.e. the number of outstanding requests on a single connection). This value\nis used for incoming connections when tune.h2.fe.max-concurrent-streams is\nnot set, and for outgoing connections when tune.h2.be.max-concurrent-streams\nis not set. The default value is 100. The impact varies depending on the side\nso please see the two settings above for more details. It is recommended not\nto use this setting and to switch to the per-side ones instead. A value of\nzero disables the limit so a single client may create as many streams as\nallocatable by HAProxy. It is highly recommended not to change this value.\n\n```\n\n**[tune.h2.max-frame-size](#3.2-tune.h2.max-frame-size)**<number>```\nSets the HTTP/2 maximum frame size that HAProxy announces it is willing to\nreceive to its peers. The default value is the largest between 16384 and the\nbuffer size (tune.bufsize). In any case, HAProxy will not announce support\nfor frame sizes larger than buffers. The main purpose of this setting is to\nallow to limit the maximum frame size setting when using large buffers. Too\nlarge frame sizes might have performance impact or cause some peers to\nmisbehave. It is highly recommended not to change this value.\n\n```\n\n**[tune.h2.zero-copy-fwd-send](#3.2-tune.h2.zero-copy-fwd-send)**{ on | off }```\nEnables ('on') of disabled ('off') the zero-copy sends of data for the H2\nmultiplexer. It is enabled by default.\n\n```\n\n**See also:**tune.disable-zero-copy-forwarding**[tune.http.cookielen](#3.2-tune.http.cookielen)**<number>```\nSets the maximum length of captured cookies. This is the maximum value that\nthe \"capture cookie xxx len yyy\" will be allowed to take, and any upper value\nwill automatically be truncated to this one. It is important not to set too\nhigh a value because all cookie captures still allocate this size whatever\ntheir configured value (they share a same pool). This value is per request\nper response, so the memory allocated is twice this value per connection.\nWhen not specified, the limit is set to 63 characters. It is recommended not\nto change this value.\n\n```\n\n**[tune.http.logurilen](#3.2-tune.http.logurilen)**<number>```\nSets the maximum length of request URI in logs. This prevents truncating long\nrequest URIs with valuable query strings in log lines. This is not related\nto syslog limits. If you increase this limit, you may also increase the\n'log ... len yyy' parameter. Your syslog daemon may also need specific\nconfiguration directives too.\nThe default value is 1024.\n\n```\n\n**[tune.http.maxhdr](#3.2-tune.http.maxhdr)**<number>```\nSets the maximum number of headers allowed in received HTTP messages. When a\nmessage comes with a number of headers greater than this value (including the\nfirst line), it is rejected with a \"400 Bad Request\" status code for a\nrequest, or \"502 Bad Gateway\" for a response. The default value is 101, which\nis enough for all usages, considering that the widely deployed Apache server\nuses the same limit. It can be useful to push this limit further to\ntemporarily allow a buggy application to work by the time it gets fixed. The\naccepted range is 1..32767. Keep in mind that each new header consumes 32bits\nof memory for each stream, so don't push this limit too high.\n\nNote that HTTP/1.1 is a text protocol, so there is no special limit when the\nmessage is sent. The limit during the message parsing is sufficient. HTTP/2\nand HTTP/3 are binary protocols and require an encoding step. A limit is set\ntoo when headers are encoded to comply to limitation imposed by the\nprotocols. This limit is large enough but not documented on purpose. The same\nlimit is applied on the first steps of the decoding for the same reason.\n\n```\n\n**[tune.idle-pool.shared](#3.2-tune.idle-pool.shared)**{ on | off }```\nEnables ('on') or disables ('off') sharing of idle connection pools between\nthreads for a same server. The default is to share them between threads in\norder to minimize the number of persistent connections to a server, and to\noptimize the connection reuse rate. But to help with debugging or when\nsuspecting a bug in HAProxy around connection reuse, it can be convenient to\nforcefully disable this idle pool sharing between multiple threads, and force\nthis option to \"off\". The default is on. It is strongly recommended against\ndisabling this option without setting a conservative value on \"pool-low-conn\"\nfor all servers relying on connection reuse to achieve a high performance\nlevel, otherwise connections might be closed very often as the thread count\nincreases.\n\n```\n\n**[tune.idletimer](#3.2-tune.idletimer)**<timeout>```\nSets the duration after which HAProxy will consider that an empty buffer is\nprobably associated with an idle stream. This is used to optimally adjust\nsome packet sizes while forwarding large and small data alternatively. The\ndecision to use splice() or to send large buffers in SSL is modulated by this\nparameter. The value is in milliseconds between 0 and 65535. A value of zero\nmeans that HAProxy will not try to detect idle streams. The default is 1000,\nwhich seems to correctly detect end user pauses (e.g. read a page before\nclicking). There should be no reason for changing this value. Please check\ntune.ssl.maxrecord below.\n\n```\n\n**[tune.listener.default-shards](#3.2-tune.listener.default-shards)**{ by-process | by-thread | by-group }```\nNormally, all \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines will create a single shard, that is, a single\nsocket that all threads of the process will listen to. With many threads,\nthis is not very efficient, and may even induce some important overhead in\nthe kernel for updating the polling state or even distributing events to the\nvarious threads. Modern operating systems support balancing of incoming\nconnections, a mechanism that will consist in permitting multiple sockets to\nbe bound to the same address and port, and to evenly distribute all incoming\nconnections to these sockets so that each thread only sees the connections\nthat are waiting in the socket it is bound to. This significantly reduces\nkernel-side overhead and increases performance in the incoming connection\npath. This is usually enabled in HAProxy using the \"shardsThis keyword is available in sections :Peers declarationBind options\" setting on \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\"\nlines, which defaults to 1, meaning that each listener will be unique in the\nprocess. On systems with many processors, it may be more convenient to change\nthe default setting to \"by-thread\" in order to always create one listening\nsocket per thread, or \"by-group\" in order to always create one listening\nsocket per thread group. Be careful about the file descriptor usage with\n\"by-thread\" as each listener will need as many sockets as there are threads.\nAlso some operating systems (e.g. FreeBSD) are limited to no more than 256\nsockets on a same address. Note that \"by-group\" will remain equivalent to\n\"by-process\" for default configurations involving a single thread group, and\nwill fall back to sharing the same socket on systems that do not support this\nmechanism. The default is \"by-group\" with a fallback to \"by-process\" for\nsystems or socket families that do not support multiple bindings.\n\n```\n\n**[tune.listener.multi-queue](#3.2-tune.listener.multi-queue)**{ on | fair | off }```\nEnables ('on' / 'fair') or disables ('off') the listener's multi-queue accept\nwhich spreads the incoming traffic to all threads a \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line is allowed to\nrun on instead of taking them for itself. This provides a smoother traffic\ndistribution and scales much better, especially in environments where threads\nmay be unevenly loaded due to external activity (network interrupts colliding\nwith one thread for example). The default mode, \"on\", optimizes the choice of\na thread by picking in a sample the one with the less connections. It is\noften the best choice when connections are long-lived as it manages to keep\nall threads busy. A second mode, \"fair\", instead cycles through all threads\nregardless of their instant load level. It can be better suited for short-\nlived connections, or on machines with very large numbers of threads where\nthe probability to find the least loaded thread with the first mode is low.\nFinally it is possible to forcefully disable the redistribution mechanism\nusing \"off\" for troubleshooting, or for situations where connections are\nshort-lived and it is estimated that the operating system already provides a\ngood enough distribution. The default is \"on\".\n\n```\n\n**[tune.lua.bool-sample-conversion](#3.2-tune.lua.bool-sample-conversion)**{ normal | pre-3.1-bug }```\nExplicitly tell haproxy how haproxy sample objects should be handled when\npushed to Lua. Indeed, when leveraging native converters, sample fetches or\nvariables from Lua script (to name a few), haproxy converts the internal\nsmp type to equivalent Lua type. Because of historical implementation, there\nis an ambiguity around boolean handling: when doing Lua -> haproxy smp\nconversion, booleans are properly preserved, but when doing haproxy\nsmp -> Lua conversion, booleans were converted to integers by mistake. This\nmeans that a sample fetch or converter returning a boolean would return an\ninteger 0 or 1 when leveraged from Lua. Unfortunately, in Lua, booleans and\nintegers are not interchangeable. Thus, to avoid ambiguities,\n\"tune.lua.bool-sample-conversion\" must explicitly be set to either \"normal\"\n(which means dropping the historical behavior for better consistency) or\n\"pre-3.1-bug\" (enforce historical behavior to prevent existing script logic\nfrom misbehaving). If the option is not set explicitly and a Lua script is\nloaded from the configuration, haproxy will emit a warning, and the option\nwill implicitly default to \"pre-3.1-bug\" to match with the historical\nbehavior. It is recommended to set this option to \"normal\" after ensuring\nthat in-use Lua scripts are properly handling bool haproxy samples as booleans.\n\nThis setting must be set before any \"lua-load\" or \"lua-load-per-thread\"\ndirective for it to be considered, else it is ignored.\n\n```\n\n**[tune.lua.burst-timeout](#3.2-tune.lua.burst-timeout)**<timeout>```\nThe \"burst\" execution timeout applies to any Lua handler. If the handler\nfails to finish or yield before timeout is reached, it will be aborted to\nprevent thread contention, to prevent traffic from not being served for too\nlong, and ultimately to prevent the process from crashing because of the\nwatchdog kicking in. Unlike other lua timeouts which are yield-cumulative,\nburst-timeout will ensure that the time spent in a single lua execution\nwindow does not exceed the configured timeout.\n\nYielding here means that the lua execution is effectively interrupted\neither through an explicit call to lua-yielding function such as\ncore.(m)sleep() or core.yield(), or following an automatic forced-yield\n(see tune.lua.forced-yield) and that it will be resumed later when the\nrelated task is set for rescheduling. Not all lua handlers may yield: we have\nto make a distinction between yieldable handlers and unyieldable handlers.\n\nFor yieldable handlers (tasks, actions..), reaching the timeout means\n\"tune.lua.forced-yield\" might be too high for the system, reducing it\ncould improve the situation, but it could also be a good idea to check if\nadding manual yields at some key points within the lua function helps or not.\nIt may also indicate that the handler is spending too much time in a specific\nlua library function that cannot be interrupted.\n\nFor unyieldable handlers (lua converters, sample fetches), it could simply\nindicate that the handler is doing too much computation, which could result\nfrom an improper design given that such handlers, which often block the\nrequest execution flow, are expected to terminate quickly to allow the\nrequest processing to go through. A common resolution approach here would be\nto try to better optimize the lua function for speed since decreasing\n\"tune.lua.forced-yield\" won't help.\n\nThis timeout only counts the pure Lua runtime. If the Lua does a core.sleep,\nthe sleeping time is not taken in account. The default timeout is 1000ms.\n\nNote: if a lua GC cycle is initiated from the handler (either explicitly\nrequested or automatically triggered by lua after some time), the GC cycle\ntime will also be accounted for.\n\nIndeed, there is no way to deduce the GC cycle time, so this could lead to\nsome false positives on saturated systems (where GC is having hard time to\ncatch up and consumes most of the available execution runtime). If it were\nto be the case, here are some resolution leads:\n\n  - checking if the script could be optimized to reduce lua memory footprint\n  - fine-tuning lua GC parameters and / or requesting manual GC cycles\n    (see: https://www.lua.org/manual/5.4/manual.html#pdf-collectgarbage)\n  - increasing tune.lua.burst-timeout\n\nSetting value to 0 completely disables this protection.\n\n```\n\n**[tune.lua.forced-yield](#3.2-tune.lua.forced-yield)**<number>```\nThis directive forces the Lua engine to execute a yield each <number> of\ninstructions executed. This permits interrupting a long script and allows the\nHAProxy scheduler to process other tasks like accepting connections or\nforwarding traffic. The default value is 10000 instructions for scripts loaded\nusing \"lua-load-per-thread\" and MAX(500, 10000 / nbthread) instructions for\nscripts loaded using \"lua-load\" (it was found to be an optimal value for\nperformance while taking care of not creating thread contention with multiple\nthreads competing for the global lua lock).\n\nIf HAProxy often executes some Lua code but more responsiveness is required,\nthis value can be lowered. If the Lua code is quite long and its result is\nabsolutely required to process the data, the <number> can be increased, but\nthe value should be set wisely as in multithreading context it could increase\ncontention.\n\n```\n\n**[tune.lua.log.loggers](#3.2-tune.lua.log.loggers)**{ on | off }```\nEnables ('on') or disables ('off') logging the output of LUA scripts via the\nloggers applicable to the current proxy, if any.\n\nDefaults to 'on'.\n\n```\n\n**[tune.lua.log.stderr](#3.2-tune.lua.log.stderr)**{ on | auto | off }```\nEnables ('on') or disables ('off') logging the output of LUA scripts via\nstderr.\nWhen set to 'auto', logging via stderr is conditionally 'on' if any of:\n\n  - tune.lua.log.loggers is set to 'off'\n  - the script is executed in a non-proxy context with no global logger\n  - the script is executed in a proxy context with no logger attached\n\nPlease note that, when enabled, this logging is in addition to the logging\nconfigured via tune.lua.log.loggers.\n\nDefaults to 'auto'.\n\n```\n\n**[tune.lua.maxmem](#3.2-tune.lua.maxmem)**<number>```\nSets the maximum amount of RAM in megabytes per process usable by Lua. By\ndefault it is zero which means unlimited. It is important to set a limit to\nensure that a bug in a script will not result in the system running out of\nmemory.\n\n```\n\n**[tune.lua.service-timeout](#3.2-tune.lua.service-timeout)**<timeout>```\nThis is the execution timeout for the Lua services. This is useful for\npreventing infinite loops or spending too much time in Lua. This timeout\ncounts only the pure Lua runtime. If the Lua does a sleep, the sleep is\nnot taken in account. The default timeout is 4s.\n\n```\n\n**[tune.lua.session-timeout](#3.2-tune.lua.session-timeout)**<timeout>```\nThis is the execution timeout for the Lua sessions. This is useful for\npreventing infinite loops or spending too much time in Lua. This timeout\ncounts only the pure Lua runtime. If the Lua does a sleep, the sleep is\nnot taken in account. The default timeout is 4s.\n\n```\n\n**[tune.lua.task-timeout](#3.2-tune.lua.task-timeout)**<timeout>```\nPurpose is the same as \"tune.lua.session-timeout\", but this timeout is\ndedicated to the tasks. By default, this timeout isn't set because a task may\nremain alive during of the lifetime of HAProxy. For example, a task used to\ncheck servers.\n\n```\n\n**[tune.max-checks-per-thread](#3.2-tune.max-checks-per-thread)**<number>```\nSets the number of active checks per thread above which a thread will\nactively try to search a less loaded thread to run the health check, or\nqueue it until the number of active checks running on it diminishes. The\ndefault value is zero, meaning no such limit is set. It may be needed in\ncertain environments running an extremely large number of expensive checks\nwith many threads when the load appears unequal and may make health checks\nto randomly time out on startup, typically when using OpenSSL 3.0 which is\nabout 20 times more CPU-intensive on health checks than older ones. This will\nhave for result to try to level the health check work across all threads. The\nvast majority of configurations do not need to touch this parameter. Please\nnote that too low values may significantly slow down the health checking if\nchecks are slow to execute.\n\n```\n\n**[tune.maxaccept](#3.2-tune.maxaccept)**<number>```\nSets the maximum number of consecutive connections a process may accept in a\nrow before switching to other work. In single process mode, higher numbers\nused to give better performance at high connection rates, though this is not\nthe case anymore with the multi-queue. This value applies individually to\neach listener, so that the number of processes a listener is bound to is\ntaken into account. This value defaults to 4 which showed best results. If a\nsignificantly higher value was inherited from an ancient config, it might be\nworth removing it as it will both increase performance and lower response\ntime. In multi-process mode, it is divided by twice the number of processes\nthe listener is bound to. Setting this value to -1 completely disables the\nlimitation. It should normally not be needed to tweak this value.\n\n```\n\n**[tune.maxpollevents](#3.2-tune.maxpollevents)**<number>```\nSets the maximum amount of events that can be processed at once in a call to\nthe polling system. The default value is adapted to the operating system. It\nhas been noticed that reducing it below 200 tends to slightly decrease\nlatency at the expense of network bandwidth, and increasing it above 200\ntends to trade latency for slightly increased bandwidth. The configured value\nmust be lower than or equal to 1000000.\n\n```\n\n**[tune.maxrewrite](#3.2-tune.maxrewrite)**<number>```\nSets the reserved buffer space to this size in bytes. The reserved space is\nused for header rewriting or appending. The first reads on sockets will never\nfill more than bufsize-maxrewrite. Historically it has defaulted to half of\nbufsize, though that does not make much sense since there are rarely large\nnumbers of headers to add. Setting it too high prevents processing of large\nrequests or responses. Setting it too low prevents addition of new headers\nto already large requests or to POST requests. It is generally wise to set it\nto about 1024. It is automatically readjusted to half of bufsize if it is\nlarger than that. This means you don't have to worry about it when changing\nbufsize.\n\n```\n\n**[tune.max-rules-at-once](#3.2-tune.max-rules-at-once)**<number>```\nSets the maximum number of rules that can be evaluated at once in ruleset\nevaluating functions, provided that they support yielding. Indeed, it is\nnot rare to see configurations with a large number of \"tcp-request content\"\nor \"http-request\" rules for instance. A large number of rules combined with\ncpu-demanding actions (e.g.: actions that work on content) may create thread\ncontention as all the rules from a given ruleset are evaluated under the same\npolling loop if the evaluation is not interrupted. This option ensures that no\nmore than <number> number of rules may be executed under the same polling\nloop for content-oriented rulesets (those that already support yielding due\nto content inspection). What it does is that it forces the evaluating function\nto yield, so that it comes back on the next polling loop to continues the\nevaluation.\n\nAffected rulesets are:\n - \"tcp-request content\"\n - \"tcp-response content\"\n - \"http-request\"\n - \"http-response\"\n\nThe default value is 50.\n\n```\n\n**[tune.memory.hot-size](#3.2-tune.memory.hot-size)**<number>```\nSets the per-thread amount of memory that will be kept hot in the local cache\nand will never be recoverable by other threads. Access to this memory is very\nfast (lockless), and having enough is critical to maintain a good performance\nlevel under extreme thread contention. The value is expressed in bytes, and\nthe default value is configured at build time via CONFIG_HAP_POOL_CACHE_SIZE\nwhich defaults to 524288 (512 kB). A larger value may increase performance in\nsome usage scenarios, especially when performance profiles show that memory\nallocation is stressed a lot. Experience shows that a good value sits between\nonce to twice the per CPU core L2 cache size. Too large values will have a\nnegative impact on performance by making inefficient use of the L3 caches in\nthe CPUs, and will consume larger amounts of memory. It is recommended not to\nchange this value, or to proceed in small increments. In order to completely\ndisable the per-thread CPU caches, using a very small value could work, but\nit is better to use \"-dMno-cache\" on the command-line.\n\n```\n\n**[tune.notsent-lowat.client](#3.2-tune.notsent-lowat.client)**<size>**[tune.notsent-lowat.server](#3.2-tune.notsent-lowat.server)**<size>```\nAdjusts the kernel's per-socket buffering so as to report that the sending\nside of a socket is full once the amount of buffered data equals this value\nplus the measured window size. The principle is to let the strict minimum\nneeded amount of bytes in socket buffers, plus a small margin corresponding\nto what would be sent by the time haproxy tries to send again. Setting this\nto a low value (typically around tune.bufsize) allows to significantly reduce\nthe memory consumption in system buffers, and reduce the application level\nlatency incurred by flushing buffered data. This generally represents a more\neffective and more accurate setting than tune.sndbuf.client and\ntune.sndbuf.client for systems supporting it. This applies per connection\n(connection from a client or connection to a server depending on the setting)\nand is only used by TCP connections. The default is zero, which means\nunlimited. This is only available on Linux.\n\n```\n\n**[tune.pattern.cache-size](#3.2-tune.pattern.cache-size)**<number>```\nSets the size of the pattern lookup cache to <number> entries. This is an LRU\ncache which reminds previous lookups and their results. It is used by ACLs\nand maps on slow pattern lookups, namely the ones using the \"sub\", \"reg\",\n\"dir\", \"dom\", \"end\", \"bin\" match methods as well as the case-insensitive\nstrings. It applies to pattern expressions which means that it will be able\nto memorize the result of a lookup among all the patterns specified on a\nconfiguration line (including all those loaded from files). It automatically\ninvalidates entries which are updated using HTTP actions or on the CLI. The\ndefault cache size is set to 10000 entries, which limits its footprint to\nabout 5 MB per process/thread on 32-bit systems and 8 MB per process/thread\non 64-bit systems, as caches are thread/process local. There is a very low\nrisk of collision in this cache, which is in the order of the size of the\ncache divided by 2^64. Typically, at 10000 requests per second with the\ndefault cache size of 10000 entries, there's 1% chance that a brute force\nattack could cause a single collision after 60 years, or 0.1% after 6 years.\nThis is considered much lower than the risk of a memory corruption caused by\naging components. If this is not acceptable, the cache can be disabled by\nsetting this parameter to 0.\n\n```\n\n**[tune.peers.max-updates-at-once](#3.2-tune.peers.max-updates-at-once)**<number>```\nSets the maximum number of stick-table updates that haproxy will try to\nprocess at once when sending messages. Retrieving the data for these updates\nrequires some locking operations which can be CPU intensive on highly\nthreaded machines if unbound, and may also increase the traffic latency\nduring the initial batched transfer between an older and a newer process.\nConversely low values may also incur higher CPU overhead, and take longer\nto complete. The default value is 200 and it is suggested not to change it.\n\n```\n\n**[tune.pipesize](#3.2-tune.pipesize)**<size>```\nSets the kernel pipe buffer size to this size (in bytes). By default, pipes\nare the default size for the system. But sometimes when using TCP splicing,\nit can improve performance to increase pipe sizes, especially if it is\nsuspected that pipes are not filled and that many calls to splice() are\nperformed. This has an impact on the kernel's memory footprint, so this must\nnot be changed if impacts are not understood.\n\n```\n\n**[tune.pool-high-fd-ratio](#3.2-tune.pool-high-fd-ratio)**<number>```\nThis setting sets the max number of file descriptors (in percentage) used by\nHAProxy globally against the maximum number of file descriptors HAProxy can\nuse before we start killing idle connections when we can't reuse a connection\nand we have to create a new one. The default is 25 (one quarter of the file\ndescriptor will mean that roughly half of the maximum front connections can\nkeep an idle connection behind, anything beyond this probably doesn't make\nmuch sense in the general case when targeting connection reuse).\n\n```\n\n**[tune.pool-low-fd-ratio](#3.2-tune.pool-low-fd-ratio)**<number>```\nThis setting sets the max number of file descriptors (in percentage) used by\nHAProxy globally against the maximum number of file descriptors HAProxy can\nuse before we stop putting connection into the idle pool for reuse. The\ndefault is 20.\n\n```\n\n**[tune.pt.zero-copy-forwarding](#3.2-tune.pt.zero-copy-forwarding)**{ on | off }```\nEnables ('on') of disabled ('off') the zero-copy forwarding of data for the\npass-through multiplexer. To be used, the kernel splicing must also be\nconfigured. It is enabled by default.\n\n```\n\n**See also:**tune.disable-zero-copy-forwarding, option splice-auto, option splice-request and option splice-response**[tune.quic.cc-hystart](#3.2-tune.quic.cc-hystart)**{ on | off }```\nEnables ('on') or disabled ('off') the HyStart++ (RFC 9406) algorithm for\nQUIC connections used as a replacement for the slow start phase of congestion\ncontrol algorithms which may cause high packet loss. It is disabled by default.\n\n```\n\n**[tune.quic.cc.cubic.min-losses](#3.2-tune.quic.cc.cubic.min-losses)**<number>```\nDefines how many lost packets are needed for the Cubic congestion control\nalgorithm to really consider a loss event. Normally, any loss event is\nconsidered as the result of a congestion and is sufficient for Cubic to\nrestart from a smaller window. But experiments show that there can be a\nvariety of causes for losses that are not at all caused by congestion and\nthat can simply be qualified of spurious losses, and for which adjusting the\nwindow will have no effect, except slowing communication down. Poor radio\nsignal, out-of-order delivery, high CPU usage on a client causing random\ndelays, as well as system timer imprecision can be among the common causes\nfor this. This setting allows to make Cubic a bit more tolerant to spurious\nlosses, by changing the minimum number of cumulated losses between two ACKs\nto be considered as a loss event, which defaults to 1. Some significant gains\nhave been observed experimentally, but always accompanied with an aggravation\nof the bandwidth wasted on retransmits, and an increased risk of saturation\nof congested links. The value 2 may be used for short periods of time to\ncompare some metrics. Never go beyond 2 without an expert's prior analysis of\nthe situation. The default and minimum value is 1. Always use 1.\n\n```\n\n**[tune.quic.disable-tx-pacing](#3.2-tune.quic.disable-tx-pacing)**```\nDisables pacing support for QUIC emission. The purpose of pacing is to smooth\nemission of data to reduce network losses. In most scenario, it will\nsignificantly improve network throughput by avoiding retransmissions.\nHowever, it can be useful to deactivate it for networks with very high\nbandwidth/low latency characteristics to prevent unwanted delay and reduce\nCPU consumption.\n\nSee also the \"quic-cc-algo\" bind option.\n\n```\n\n**[tune.quic.disable-udp-gso](#3.2-tune.quic.disable-udp-gso)**```\nDisable UDP GSO emission. This kernel feature allows to emit multiple\ndatagrams via a single system call which is more efficient for large\ntransfer. It may be useful to disable it on developers suggestion when\nsuspecting an issue on emission.\n\n```\n\n**[tune.quic.frontend.glitches-threshold](#3.2-tune.quic.frontend.glitches-threshold)**<number>```\nSets the threshold for the number of glitches on a frontend connection, where\nthat connection will automatically be killed. This allows to automatically\nkill misbehaving connections without having to write explicit rules for them.\nThe default value is zero, indicating that no threshold is set so that no\nevent will cause a connection to be closed. Beware that some QUIC clients may\noccasionally cause a few glitches over long lasting connection, so any non-\nzero value here should probably be in the hundreds or thousands to be\neffective without affecting slightly bogus clients. It is also possible to\nonly kill connections when the CPU usage crosses a certain level, by using\n\"tune.glitches.kill.cpu-usage\".\n\n```\n\n**See also:**fc_glitches, tune.glitches.kill.cpu-usage**[tune.quic.frontend.max-data-size](#3.2-tune.quic.frontend.max-data-size)**<size>```\nThis setting is the hard limit for the number of data bytes in flight over a\nQUIC frontend connection. It is reused as the value for the initial_max_data\ntransport parameter. It directly impacts the upload bandwidth for the peer\ndepending on the latency and the per-connection memory consumption in\nhaproxy.\n\nBy default, the value is set to 0, which indicates that it must be\nautomatically generated as the product between max-streams-bidi and bufsize.\nThis can be increased for example if a backend application relies on massive\nuploads over high latency networks.\n\n```\n\n**See also:**\"[tune.quic.frontend.max-streams-bidi](#tune.quic.frontend.max-streams-bidi)\", \"[tune.quic.frontend.stream-data-ratio](#tune.quic.frontend.stream-data-ratio)\"**[tune.quic.frontend.max-idle-timeout](#3.2-tune.quic.frontend.max-idle-timeout)**<timeout>```\nSets the QUIC max_idle_timeout transport parameters in milliseconds for\nfrontends which determines the period of time after which a connection silently\ncloses if it has remained inactive during an effective period of time deduced\nfrom the two max_idle_timeout values announced by the two endpoints:\n  - the minimum of the two values if both are not null,\n  - the maximum if only one of them is not null,\n  - if both values are null, this feature is disabled.\n\nThe default value is 30000.\n\n```\n\n**[tune.quic.frontend.max-streams-bidi](#3.2-tune.quic.frontend.max-streams-bidi)**<number>```\nSets the QUIC initial_max_streams_bidi transport parameter for frontends.\nThis is the initial maximum number of bidirectional streams the remote peer\nwill be authorized to open. This determines the number of concurrent client\nrequests.\n\nThe default value is 100. Note that if you reduces it, it can restrict the\nbuffering capabilities of streams on receive, which would result in poor\nupload throughput. It can be corrected by increasing\ntune.quic.frontend.max-data-size setting.\n\n```\n\n**See also:**\"[tune.quic.frontend.max-data-size](#tune.quic.frontend.max-data-size)\", \"[tune.quic.frontend.stream-data-ratio](#tune.quic.frontend.stream-data-ratio)\"**[tune.quic.frontend.max-tx-mem](#3.2-tune.quic.frontend.max-tx-mem)**<size>```\nSets the maximum amount of memory usable by QUIC stack at the transport layer\nfor emission. This serves both as a limit of in flight bytes and multiplexer\noutput buffers. Note that to prevent threads contention this limit is not\nstrictly enforced so it can be exceeded on some occasions. Also, each\nconnection will always be able to use a window of at least 2 datagrams, so a\nproper maxconn should be used in conjunction.\n\n```\n\n**[tune.quic.frontend.stream-data-ratio](#3.2-tune.quic.frontend.stream-data-ratio)**<0..100, in percent>```\nThis setting allows to configure the hard limit of the number of data bytes\nin flight over each stream. It is expressed as a percentage relative to\n\"tune.quic.frontend.max-data-size\" setting, with the result rounded up to\nbufsize.\n\nThe default value is 90. This is suitable with the most frequent web\nscenario, where uploads is performed only for one or a few streams, whereas\nthe rest are used for download only. If max-data-size connection limit\nremains at a reasonable level, it ensures that only a portion of opened\nstreams can allocate to their maximum capacity.\n\nIn the case of an application using many uploading streams in parallel and\nsuffering from unfairness between these streams, it can make sense to reduce\nthis ratio, to increase fairness and reduce the per-stream bandwidth.\n\n```\n\n**See also:**\"[tune.quic.frontend.max-data-size](#tune.quic.frontend.max-data-size)\", \"[tune.quic.frontend.max-streams-bidi](#tune.quic.frontend.max-streams-bidi)\"**[tune.quic.frontend.default-max-window-size](#3.2-tune.quic.frontend.default-max-window-size)**<size>```\nSets the default maximum window size for the congestion controller of a\nsingle QUIC connection. The value must be written as an integer with an\noptional suffix 'k', 'm' or 'g'. It must be between 10k and 4g.\n\nQUIC multiplexer also uses the current congestion window size to determine if\nit can allocate new stream buffers on data emission. As such, the maximum\ncongestion window size also serves as a limit on this allocator.\n\nThe default value is 480k.\n\nSee also the \"quic-cc-algo\" bind option.\n\n```\n\n**[tune.quic.max-frame-loss](#3.2-tune.quic.max-frame-loss)**<number>```\nSets the limit for which a single QUIC frame can be marked as lost. If\nexceeded, the connection is considered as failing and is closed immediately.\n\nThe default value is 10.\n\n```\n\n**[tune.quic.reorder-ratio](#3.2-tune.quic.reorder-ratio)**<0..100, in percent>```\nThe ratio applied to the packet reordering threshold calculated. It may\ntrigger a high packet loss detection when too small.\n\nThe default value is 50.\n\n```\n\n**[tune.quic.retry-threshold](#3.2-tune.quic.retry-threshold)**<number>```\nDynamically enables the Retry feature for all the configured QUIC listeners\nas soon as this number of half open connections is reached. A half open\nconnection is a connection whose handshake has not already successfully\ncompleted or failed. To be functional this setting needs a cluster secret to\nbe set, if not it will be silently ignored (see \"cluster-secret\" setting).\nThis setting will be also silently ignored if the use of QUIC Retry was\nforced (see \"quic-force-retry\").\n\nThe default value is 100.\n\nSee https://www.rfc-editor.org/rfc/rfc9000.html#section-8.1.2 for more\ninformation about QUIC retry.\n\n```\n\n**[tune.quic.socket-owner](#3.2-tune.quic.socket-owner)**{ connection | listener }```\nSpecifies globally how QUIC connections will use socket for receive/send\noperations. Connections can share listener socket or each connection can\nallocate its own socket.\n\nWhen default \"connection\" value is set, a dedicated socket will be allocated\nby every QUIC connections. This option is the preferred one to achieve the\nbest performance with a large QUIC traffic. This is also the only way to\nensure soft-stop is conducted properly without data loss for QUIC connections\nand cases of transient errors during sendto() operation are handled\nefficiently. However, this relies on some advanced features from the UDP\nnetwork stack. If your platform is deemed not compatible, haproxy will\nautomatically switch to \"listener\" mode on startup. Please note that QUIC\nlisteners running on privileged ports may require to run as uid 0, or some\nOS-specific tuning to permit the target uid to bind such ports, such as\nsystem capabilities. See also the \"setcap\" global directive.\n\nThe \"listener\" value indicates that QUIC transfers will occur on the shared\nlistener socket. This option can be a good compromise for small traffic as it\nallows to reduce FD consumption. However, performance won't be optimal due to\na higher CPU usage if listeners are shared across a lot of threads or a\nlarge number of QUIC connections can be used simultaneously.\n\nThis setting is applied in conjunction with each \"quic-socket\" bind options.\nIf \"connection\" mode is used on global tuning, it will be activated for each\nlistener, unless its bind option is set to \"listener\". However, if \"listener\"\nis used globally, it will be forced on every listener instance, regardless of\ntheir individual configuration.\n\n```\n\n**[tune.quic.zero-copy-fwd-send](#3.2-tune.quic.zero-copy-fwd-send)**{ on | off }```\nEnables ('on') of disabled ('off') the zero-copy sends of data for the QUIC\nmultiplexer. It is enabled by default.\n\n```\n\n**See also:**tune.disable-zero-copy-forwarding**[tune.renice.runtime](#3.2-tune.renice.runtime)**<number>```\nThis configuration option takes a value between -20 and 19. It applies a\nscheduling priority as documented in man 2 setpriority. This priority is\napplied after the configuration parsing, which means only the worker or the\nstandalone process will apply it. It is usually configured to set a higher\npriority than a process doing configuration parsing (tune.renice.startup).\n\n```\n\n**See also:**tune.renice.startup**[tune.renice.startup](#3.2-tune.renice.startup)**<number>```\nThis configuration option takes a value between -20 and 19. It applies a\nscheduling priority as documented in man 2 setpriority. This priority is\napplied before applying the rest of the configuration which can be useful if\nyou want to lower the priority for configuration parsing. This is applied on\nthe standalone process or the worker before configuration parsing. Once the\nconfiguration is parsed, the previous priority is restored unless\ntune.renice.runtime is used.\n\n```\n\n**See also:**tune.renice.runtime**[tune.rcvbuf.backend](#3.2-tune.rcvbuf.backend)**<size>**[tune.rcvbuf.frontend](#3.2-tune.rcvbuf.frontend)**<size>```\nFor the kernel socket receive buffer size on non-connected sockets to this\nsize. This can be used QUIC in listener mode and log-forward on the frontend.\nThe default system buffers might sometimes be too small for sockets receiving\nlots of aggregated traffic, causing some losses and possibly retransmits (in\ncase of QUIC), possibly slowing down connection establishment under heavy\ntraffic. The value is expressed in bytes, applied to each socket. In listener\nmode, sockets are shared between all connections, and the total number of\nsockets depends on the \"shardsThis keyword is available in sections :Peers declarationBind options\" value of the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line. There's no good\nvalue, a good one corresponds to an expected size per connection multiplied\nby the expected number of connections. The kernel may trim large values. See\nalso \"tune.rcvbuf.client\" and \"tune.rcvbuf.server\" for their connected socket\ncounter parts, as well as \"tune.sndbuf.backend\" and \"tune.sndbuf.frontend\"\nfor the send setting.\n\n```\n\n**[tune.rcvbuf.client](#3.2-tune.rcvbuf.client)**<size>**[tune.rcvbuf.server](#3.2-tune.rcvbuf.server)**<size>```\nForces the kernel socket receive buffer size on the client or the server side\nto the specified value in bytes. This value applies to all TCP/HTTP frontends\nand backends. It should normally never be set, and the default size (0) lets\nthe kernel auto-tune this value depending on the amount of available memory.\nHowever it can sometimes help to set it to very low values (e.g. 4096) in\norder to save kernel memory by preventing it from buffering too large amounts\nof received data. Lower values will significantly increase CPU usage though.\n\n```\n\n**[tune.recv_enough](#3.2-tune.recv_enough)**<size>```\nHAProxy uses some hints to detect that a short read indicates the end of the\nsocket buffers. One of them is that a read returns more than <recv_enough>\nbytes, which defaults to 10136 (7 segments of 1448 each). This default value\nmay be changed by this setting to better deal with workloads involving lots\nof short messages such as telnet or SSH sessions.\n\n```\n\n**[tune.ring.queues](#3.2-tune.ring.queues)**<number>```\nSets the number of write queues in front of ring buffers. This can have an\neffect on the CPU usage of traces during debugging sessions, and both too\nlow or too large a value can have an important effect. The good value was\ndetermined experimentally by developers and there should be no reason to\ntry to change it unless instructed to do so in order to try to address\nspecific issues. Such a setting should not be left in the configuration\nacross version upgrades because its optimal value may evolve over time.\n\n```\n\n**[tune.runqueue-depth](#3.2-tune.runqueue-depth)**<number>```\nSets the maximum amount of task that can be processed at once when running\ntasks. The default value depends on the number of threads but sits between 35\nand 280, which tend to show the highest request rates and lowest latencies.\nIncreasing it may incur latency when dealing with I/Os, making it too small\ncan incur extra overhead. Higher thread counts benefit from lower values.\nWhen experimenting with much larger values, it may be useful to also enable\ntune.sched.low-latency and possibly tune.fd.edge-triggered to limit the\nmaximum latency to the lowest possible.\n\n```\n\n**[tune.sched.low-latency](#3.2-tune.sched.low-latency)**{ on | off }```\nEnables ('on') or disables ('off') the low-latency task scheduler. By default\nHAProxy processes tasks from several classes one class at a time as this is\nthe most efficient. But when running with large values of tune.runqueue-depth\nthis can have a measurable effect on request or connection latency. When this\nlow-latency setting is enabled, tasks of lower priority classes will always\nbe executed before other ones if they exist. This will permit to lower the\nmaximum latency experienced by new requests or connections in the middle of\nmassive traffic, at the expense of a higher impact on this large traffic.\nFor regular usage it is better to leave this off. The default value is off.\n\n```\n\n**[tune.sndbuf.backend](#3.2-tune.sndbuf.backend)**<size>**[tune.sndbuf.frontend](#3.2-tune.sndbuf.frontend)**<size>```\nFor the kernel socket send buffer size on non-connected sockets to this size.\nThis can be used for UNIX socket and UDP logging on the backend side, and for\nQUIC in listener mode on the frontend. The default system buffers might\nsometimes be too small for sockets shared between many connections (or log\nsenders), causing some losses and possibly retransmits, slowing down new\nconnection establishment under high traffic. The value is expressed in bytes,\napplied to each socket. In listener mode, sockets are shared between all\nconnections, and the total number of sockets depends on the \"shardsThis keyword is available in sections :Peers declarationBind options\" value of\nthe \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line. There's no good value, a good one corresponds to an expected\nsize per connection multiplied by the expected number of connections. The\nkernel may trim large values. See also \"tune.sndbuf.client\" and\n\"tune.sndbuf.server\" for their connected socket counter parts, as well as\n\"tune.rcvbuf.backend\" and \"tune.rcvbuf.frontend\" for the receive setting.\n\n```\n\n**[tune.sndbuf.client](#3.2-tune.sndbuf.client)**<size>**[tune.sndbuf.server](#3.2-tune.sndbuf.server)**<size>```\nForces the kernel socket send buffer size on the client or the server side to\nthe specified value in bytes. This value applies to all TCP/HTTP frontends\nand backends. It should normally never be set, and the default size (0) lets\nthe kernel auto-tune this value depending on the amount of available memory.\nHowever it can sometimes help to set it to very low values (e.g. 4096) in\norder to save kernel memory by preventing it from buffering too large amounts\nof received data. Lower values will significantly increase CPU usage though.\nAnother use case is to prevent write timeouts with extremely slow clients due\nto the kernel waiting for a large part of the buffer to be read before\nnotifying HAProxy again. See also tune.notsent-lowat.client and\ntune.notsent-lowat.server for more effective settings to more finely control\nmemory usage and responsiveness on Linux without hurting performance.\n\n```\n\n**[tune.ssl.cachesize](#3.2-tune.ssl.cachesize)**<number>```\nSets the size of the global SSL session cache, in a number of blocks. A block\nis large enough to contain an encoded session without peer certificate.  An\nencoded session with peer certificate is stored in multiple blocks depending\non the size of the peer certificate. A block uses approximately 200 bytes of\nmemory (based on `sizeof(struct sh_ssl_sess_hdr) + SHSESS_BLOCK_MIN_SIZE`\ncalculation used for `shctx_init` function). The default value may be forced\nat build time, otherwise defaults to 20000. When the cache is full, the most\nidle entries are purged and reassigned. Higher values reduce the occurrence\nof such a purge, hence the number of CPU-intensive SSL handshakes by ensuring\nthat all users keep their session as long as possible. All entries are\npre-allocated upon startup. Setting this value to 0 disables the SSL session\ncache.\n\n```\n\n**[tune.ssl.capture-buffer-size](#3.2-tune.ssl.capture-buffer-size)**<number>**[tune.ssl.capture-cipherlist-size](#3.2-tune.ssl.capture-cipherlist-size)**<number>(deprecated)```\nSets the maximum size of the buffer used for capturing client hello cipher\nlist, extensions list, elliptic curves list and elliptic curve point\nformats. If the value is 0 (default value) the capture is disabled,\notherwise a buffer is allocated for each SSL/TLS connection.\n\n```\n\n**[tune.ssl.certificate-compression](#3.2-tune.ssl.certificate-compression)**{ auto | off }```\nThis setting allows to configure the certificate compression support which is\nan extension (RFC 8879) to TLS 1.3.\n\nWhen set to \"auto\" it uses the default value of the TLS library.\n\nWith \"off\" it tries to explicitely disable the support of the feature.\nHAProxy won't try to send compressed certificates anymore nor accept\ncompressed certificates.\n\nConfigures both backend and frontend sides.\n\nThis keyword is supported by OpenSSL >= 3.2.0.\n\nThe default value is auto.\n\n```\n\n**[tune.ssl.default-dh-param](#3.2-tune.ssl.default-dh-param)**<number>```\nSets the maximum size of the Diffie-Hellman parameters used for generating\nthe ephemeral/temporary Diffie-Hellman key in case of DHE key exchange. The\nfinal size will try to match the size of the server's RSA (or DSA) key (e.g,\na 2048 bits temporary DH key for a 2048 bits RSA key), but will not exceed\nthis maximum value. Only 1024 or higher values are allowed. Higher values\nwill increase the CPU load, and values greater than 1024 bits are not\nsupported by Java 7 and earlier clients. This value is not used if static\nDiffie-Hellman parameters are supplied either directly in the certificate\nfile or by using the ssl-dh-param-file parameter.\nIf there is neither a default-dh-param nor a ssl-dh-param-file defined, and\nif the server's PEM file of a given frontend does not specify its own DH\nparameters, then DHE ciphers will be unavailable for this frontend.\n\n```\n\n**[tune.ssl.force-private-cache](#3.2-tune.ssl.force-private-cache)**```\nThis option disables SSL session cache sharing between all processes. It\nshould normally not be used since it will force many renegotiations due to\nclients hitting a random process. But it may be required on some operating\nsystems where none of the SSL cache synchronization method may be used. In\nthis case, adding a first layer of hash-based load balancing before the SSL\nlayer might limit the impact of the lack of session sharing.\n\n```\n\n**[tune.ssl.hard-maxrecord](#3.2-tune.ssl.hard-maxrecord)**<number>```\nSets the maximum amount of bytes passed to SSL_write() at any time. Default\nvalue 0 means there is no limit. In contrast to tune.ssl.maxrecord this\nsettings will not be adjusted dynamically. Smaller records may decrease\nthroughput, but may be required when dealing with low-footprint clients.\n\n```\n\n**[tune.ssl.keylog](#3.2-tune.ssl.keylog)**{ on | off }```\nThis option activates the logging of the TLS keys. It should be used with\ncare as it will consume more memory per SSL session and could decrease\nperformances. This is disabled by default.\n\nThese sample fetches should be used to generate the SSLKEYLOGFILE that is\nrequired to decipher traffic with wireshark.\n\nhttps://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/Key_Log_Format\n\nThe SSLKEYLOG is a series of lines which are formatted this way:\n\n  <Label> <space> <ClientRandom> <space> <Secret>\n\nThe ClientRandom is provided by the %[ssl_fc_client_random,hex] sample\nfetch, the secret and the Label could be find in the array below. You need\nto generate a SSLKEYLOGFILE with all the labels in this array.\n\nThe following sample fetches are hexadecimal strings and does not need to be\nconverted.\n\nSSLKEYLOGFILE Label             |  Sample fetches for the Secrets\n--------------------------------|-----------------------------------------\nCLIENT_EARLY_TRAFFIC_SECRET     |  %[ssl_xx_client_early_traffic_secret]\nCLIENT_HANDSHAKE_TRAFFIC_SECRET |  %[ssl_xx_client_handshake_traffic_secret]\nSERVER_HANDSHAKE_TRAFFIC_SECRET |  %[ssl_xx_server_handshake_traffic_secret]\nCLIENT_TRAFFIC_SECRET_0         |  %[ssl_xx_client_traffic_secret_0]\nSERVER_TRAFFIC_SECRET_0         |  %[ssl_xx_server_traffic_secret_0]\nEXPORTER_SECRET                 |  %[ssl_xx_exporter_secret]\nEARLY_EXPORTER_SECRET           |  %[ssl_xx_early_exporter_secret]\n\nThese fetches exists for frontend (fc) or backend (bc) sides, replace \"xx\" by\n\"fc\" or \"bc\" to use the right side.\n\nThis is only available with OpenSSL 1.1.1, and useful with TLS1.3 session.\n\nIf you want to generate the content of a SSLKEYLOGFILE with TLS < 1.3, you\nonly need this line:\n\n\"CLIENT_RANDOM %[ssl_fc_client_random,hex] %[ssl_fc_session_key,hex]\"\n\nA complete keylog could be generate with a log-format these way, even though\nthis is not ideal for syslog:\n\n  log-format \"CLIENT_EARLY_TRAFFIC_SECRET %[ssl_bc_client_random,hex] %[ssl_bc_client_early_traffic_secret]\\n\n              CLIENT_HANDSHAKE_TRAFFIC_SECRET %[ssl_bc_client_random,hex] %[ssl_bc_client_handshake_traffic_secret]\\n\n              SERVER_HANDSHAKE_TRAFFIC_SECRET %[ssl_bc_client_random,hex] %[ssl_bc_server_handshake_traffic_secret]\\n\n              CLIENT_TRAFFIC_SECRET_0 %[ssl_bc_client_random,hex] %[ssl_bc_client_traffic_secret_0]\\n\n              SERVER_TRAFFIC_SECRET_0 %[ssl_bc_client_random,hex] %[ssl_bc_server_traffic_secret_0]\\n\n              EXPORTER_SECRET %[ssl_bc_client_random,hex] %[ssl_bc_exporter_secret]\\n\n              EARLY_EXPORTER_SECRET %[ssl_bc_client_random,hex] %[ssl_bc_early_exporter_secret]\"\n\n```\n\n**[tune.ssl.lifetime](#3.2-tune.ssl.lifetime)**<timeout>```\nSets how long a cached SSL session may remain valid. This time is expressed\nin seconds and defaults to 300 (5 min). It is important to understand that it\ndoes not guarantee that sessions will last that long, because if the cache is\nfull, the longest idle sessions will be purged despite their configured\nlifetime. The real usefulness of this setting is to prevent sessions from\nbeing used for too long.\n\n```\n\n**[tune.ssl.maxrecord](#3.2-tune.ssl.maxrecord)**<number>```\nSets the maximum amount of bytes passed to SSL_write() at the beginning of\nthe data transfer. Default value 0 means there is no limit. Over SSL/TLS,\nthe client can decipher the data only once it has received a full record.\nWith large records, it means that clients might have to download up to 16kB\nof data before starting to process them. Limiting the value can improve page\nload times on browsers located over high latency or low bandwidth networks.\nIt is suggested to find optimal values which fit into 1 or 2 TCP segments\n(generally 1448 bytes over Ethernet with TCP timestamps enabled, or 1460 when\ntimestamps are disabled), keeping in mind that SSL/TLS add some overhead.\nTypical values of 1419 and 2859 gave good results during tests. Use\n\"strace -e trace=write\" to find the best value. HAProxy will automatically\nswitch to this setting after an idle stream has been detected (see\ntune.idletimer above). See also tune.ssl.hard-maxrecord.\n\n```\n\n**[tune.ssl.ssl-ctx-cache-size](#3.2-tune.ssl.ssl-ctx-cache-size)**<number>```\nSets the size of the cache used to store generated certificates to <number>\nentries. This is a LRU cache. Because generating a SSL certificate\ndynamically is expensive, they are cached. The default cache size is set to\n1000 entries.\n\n```\n\n**[tune.stick-counters](#3.2-tune.stick-counters)**<number>```\nSets the number of stick-counters that may be tracked at the same time by a\nconnection or a request via \"track-sc*\" actions in \"tcp-request\" or\n\"http-request\" rules. The default value is set at build time by the macro\nMAX_SESS_STK_CTR, and defaults to 3. With this setting it is possible to\nchange the value and ignore the one passed at build time. Increasing this\nvalue may be needed when porting complex configurations to haproxy, but users\nare warned against the costs: each entry takes 16 bytes per connection and\n16 bytes per request, all of which need to be allocated and zeroed for all\nrequests even when not used. As such a value of 10 will inflate the memory\nconsumption per request by 320 bytes and will cause this memory to be erased\nfor each request, which does have measurable CPU impacts. Conversely, when\nno \"track-sc\" rules are used, the value may be lowered (0 being valid to\nentirely disable stick-counters).\n\n```\n\n**[tune.takeover-other-tg-connections](#3.2-tune.takeover-other-tg-connections)**<value>```\nBy default, we won't attempt to use idle connections from other thread groups.\nThis can however be changed. Valid values for <value> are : \"none\", the\ndefault, if used, no attempt will be made to use idle connections from\nother thread groups, \"restricted\" where we will only attempt to get an idle\nconnection from another thread if we're using protocols that can't create\nnew connections, such as reverse http, as well as when using strict-maxconn,\nand \"full\" where we will always look in other thread groups for idle\nconnections.\nNote that using connections from other thread groups can occur performance\npenalties, so it should not be used unless really needed.\n\n```\n\n**[tune.vars.global-max-size](#3.2-tune.vars.global-max-size)**<size>**[tune.vars.proc-max-size](#3.2-tune.vars.proc-max-size)**<size>**[tune.vars.reqres-max-size](#3.2-tune.vars.reqres-max-size)**<size>**[tune.vars.sess-max-size](#3.2-tune.vars.sess-max-size)**<size>**[tune.vars.txn-max-size](#3.2-tune.vars.txn-max-size)**<size>```\nThese five tunes help to manage the maximum amount of memory used by the\nvariables system. \"global\" limits the overall amount of memory available for\nall scopes. \"proc\" limits the memory for the process scope, \"sess\" limits the\nmemory for the session scope, \"txn\" for the transaction scope, and \"reqres\"\nlimits the memory for each request or response processing.\nMemory accounting is hierarchical, meaning more coarse grained limits include\nthe finer grained ones: \"proc\" includes \"sess\", \"sess\" includes \"txn\", and\n\"txn\" includes \"reqres\".\n\nFor example, when \"tune.vars.sess-max-size\" is limited to 100,\n\"tune.vars.txn-max-size\" and \"tune.vars.reqres-max-size\" cannot exceed\n100 either. If we create a variable \"txn.var\" that contains 100 bytes,\nall available space is consumed.\nNotice that exceeding the limits at runtime will not result in an error\nmessage, but values might be cut off or corrupted. So make sure to accurately\nplan for the amount of space needed to store all your variables.\n\n```\n\n**[tune.zlib.memlevel](#3.2-tune.zlib.memlevel)**<number>```\nSets the memLevel parameter in zlib initialization for each stream. It\ndefines how much memory should be allocated for the internal compression\nstate. A value of 1 uses minimum memory but is slow and reduces compression\nratio, a value of 9 uses maximum memory for optimal speed. Can be a value\nbetween 1 and 9. The default value is 8.\n\n```\n\n**[tune.zlib.windowsize](#3.2-tune.zlib.windowsize)**<number>```\nSets the window size (the size of the history buffer) as a parameter of the\nzlib initialization for each stream. Larger values of this parameter result\nin better compression at the expense of memory usage. Can be a value between\n8 and 15. The default value is 15.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "3.3. Debugging", "content": "## [3.3.](#3.3)Debugging\n\n**[anonkey](#3.3-anonkey)**<key>```\nThis sets the global anonymizing key to <key>, which must be a 32-bit number\nbetween 0 and 4294967295. This is the key that will be used by default by CLI\ncommands when anonymized mode is enabled. This key may also be set at runtime\nfrom the CLI command \"set anon global-key\". See also command line argument\n\"-dC\" in the management manual.\n\n```\n\n**[debug.counters](#3.3-debug.counters)**{ on | off }```\nEnables ('on') or disables ('off') the updating of event counters in the\ncode. These are the counters reported under the type \"CNT\" in the CLI command\n\"debug counters\". These counters are only available when the code was build\nwith DEBUG_COUNTERS set to a value 1 or above. With the value 1, the counters\nare not updated by default (\"debug.counters off\"), and with value 2, they are\nupdated by default (\"debug.counters on\"). There is normally no reason to\nchange this setting unless a developer requests it, or unless it is suspected\nto consume abnormal amounts of CPU (in which case a report to developers is\nnecessary with a dump of the counters). It is also possible to change this\nstatus at run time using the \"debug counters\" CLI command. Please consult the\nmanagement manual.\n\n```\n\n**[force-cfg-parser-pause](#3.3-force-cfg-parser-pause)**<timeout>```\nThis command is pausing the configuration parser for <timeout> milliseconds.\nThis is useful for development or for testing timeouts of init scripts,\nparticularly to simulate a very long reload.\nIt requires the expose-experimental-directives to be set.\n\n<timeout> is the timeout value specified in milliseconds by default, but\n            can be in any other unit if the number is suffixed by the unit,\n            as explained at the top of this document.\n\n```\n\nExample:```\n\nglobal\n    expose-experimental-directives\n    force-cfg-parser-pause 10s\n\n```\n\n**[quick-exit](#3.3-quick-exit)**```\nThis speeds up the old process exit upon reload by skipping the releasing of\nmemory objects and listeners, since all of these are reclaimed by the\noperating system at the process' death. The gains are only marginal (in the\norder of a few hundred milliseconds for huge configurations at most). The\nmain target usage in fact is when a bug is spotted in the deinit() code, as\nthis allows to bypass it. It is better not to use this unless instructed to\ndo so by developers.\n\n```\n\n**[quiet](#3.3-quiet)**```\nDo not display any message during startup. It is equivalent to the command-\nline argument \"-q\".\n\n```\n\n**[warn-blocked-traffic-after](#3.3-warn-blocked-traffic-after)**<time>```\nThis allows to adjust the delay after which a stuck task blocking the traffic\nwill trigger the emission of a warning on the standard error output. The\ndelay is expressed in milliseconds and defaults to 100 ms. Permitted values\nmust be comprised between 1 ms and 1000 ms included. Lower values will\ntrigger warnings frequently and higher ones will rarely. The watchdog will\nkill a runaway task that fails to respond twice for one second anyway, so a\n1000 ms warning delay will normally not trigger any warning. It is\nrecommended to stay with values between 10 and 100ms to detect configuration\nanomalies that may degrade the user's experience, causing long response times\nor jerkiness on interactive sessions. For example, a poorly designed Lua\nsample-fetch function doing heavy computations, or a very large map_reg or\nmap_regm map file with a very high evaluation cost may cause such trouble.\nFor comparison a TLS handshake can eat between one and two milliseconds, and\ncompressing a 16kB HTTP response buffer is around one millisecond. The output\ncontains a thread dump of the offending task with a backtrace and some\ncontext that helps figure where the time is being spent.\n\n```\n\n**[zero-warning](#3.3-zero-warning)**```\nWhen this option is set, HAProxy will refuse to start if any warning was\nemitted while processing the configuration and applying it. It means that\nwarnings about bad combinations of parameters, warnings about very high\nlimits that couldn't be set, and so on, make the process exit with an error\nduring startup. A few late startup warnings cannot be caught by this option,\nsuch as the failure to drop supplementary groups when changing the group ID\nin \"daemon\" or \"master-worker\" modes, or the failure to mark the process\ndumpable after the fork(). This option does not catch warnings emitted at\nruntime. It is highly recommended to set this option on configurations that\nare not changed often, as it helps to detect subtle mistakes and keep the\nconfiguration clean and forward-compatible. Note that \"haproxy -c\" will also\nreport errors in such a case. This option is equivalent to command line\nargument \"-dW\".\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "3.4. HTTPClient tuning", "content": "## [3.4.](#3.4)HTTPClient tuning\n\n```\nHTTPClient is an internal HTTP library, it can be used by various subsystems,\nfor example in LUA scripts. HTTPClient is not used in the data path, in other\nwords it has nothing with HTTP traffic passing through HAProxy.\n\n```\n\n**[httpclient.resolvers.disabled](#3.4-httpclient.resolvers.disabled)**<on|off>```\nDisable the DNS resolution of the httpclient. Prevent the creation of the\n\"default\" resolvers section.\n\nDefault value is off.\n\n```\n\n**[httpclient.resolvers.id](#3.4-httpclient.resolvers.id)**<resolvers id>```\nThis option defines the resolvers section with which the httpclient will try\nto resolve.\n\nDefault option is the \"default\" resolvers ID. By default, if this option is\nnot used, it will simply disable the resolving if the section is not found.\n\nHowever, when this option is explicitly enabled it will trigger a\nconfiguration error if it fails to load.\n\n```\n\n**[httpclient.resolvers.prefer](#3.4-httpclient.resolvers.prefer)**<ipv4|ipv6>```\nThis option allows to chose which family of IP you want when resolving,\nwhich is convenient when IPv6 is not available on your network. Default\noption is \"ipv6\".\n\n```\n\n**[httpclient.retries](#3.4-httpclient.retries)**<number>```\nThis option allows to configure the number of retries attempt of the\nhttpclient when a request failed. This does the same as the \"retries\" keyword\nin a backend.\n\nDefault value is 3.\n\n```\n\n**[httpclient.ssl.ca-file](#3.4-httpclient.ssl.ca-file)**<cafile>```\nThis option defines the ca-file which should be used to verify the server\ncertificate. It takes the same parameters as the \"ca-fileThis keyword is available in sections :Bind optionsServer and default-server options\" option on the\nserver line.\n\nBy default and when this option is not used, the value is\n\"@system-ca\" which tries to load the CA of the system. If it fails the SSL\nwill be disabled for the httpclient.\n\nHowever, when this option is explicitly enabled it will trigger a\nconfiguration error if it fails.\n\n```\n\n**[httpclient.ssl.verify](#3.4-httpclient.ssl.verify)**[none|required]```\nWorks the same way as the verify option on server lines. If specified to 'none',\nservers certificates are not verified. Default option is \"required\".\n\nBy default and when this option is not used, the value is\n\"required\". If it fails the SSL will be disabled for the httpclient.\n\nHowever, when this option is explicitly enabled it will trigger a\nconfiguration error if it fails.\n\n```\n\n**[httpclient.timeout.connect](#3.4-httpclient.timeout.connect)**<timeout>```\nSet the maximum time to wait for a connection attempt by default for the\nhttpclient.\n\n```\n\nArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nThe default value is 5000ms.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "4. Proxies", "content": "# [4.](#4)Proxies\n\n```\nProxy configuration can be located in a set of sections :\n - defaults [<name>] [ from <defaults_name> ]\n - frontend <name>   [ from <defaults_name> ]\n - backend  <name>   [ from <defaults_name> ]\n - listen   <name>   [ from <defaults_name> ]\n\nA \"frontend\" section describes a set of listening sockets accepting client\nconnections.\n\nA \"backend\" section describes a set of servers to which the proxy will connect\nto forward incoming connections.\n\nA \"listen\" section defines a complete proxy with its frontend and backend\nparts combined in one section. It is generally useful for TCP-only traffic.\n\nA \"defaults\" section resets all settings to the documented ones and presets new\nones for use by subsequent sections. All of \"frontend\", \"backend\" and \"listen\"\nsections always take their initial settings from a defaults section, by default\nthe latest one that appears before the newly created section. It is possible to\nexplicitly designate a specific \"defaults\" section to load the initial settings\nfrom by indicating its name on the section line after the optional keyword\n\"from\". While \"defaults\" section do not impose a name, this use is encouraged\nfor better readability. It is also the only way to designate a specific section\nto use instead of the default previous one. Since \"defaults\" section names are\noptional, by default a very permissive check is applied on their name and these\nare even permitted to overlap. However if a \"defaults\" section is referenced by\nany other section, its name must comply with the syntax imposed on all proxy\nnames, and this name must be unique among the defaults sections. Please note\nthat regardless of what is currently permitted, it is recommended to avoid\nduplicate section names in general and to respect the same syntax as for proxy\nnames. This rule might be enforced in a future version. In addition, a warning\nis emitted if a defaults section is explicitly used by a proxy while it is also\nimplicitly used by another one because it is the last one defined. It is highly\nencouraged to not mix both usages by always using explicit references or by\nadding a last common defaults section reserved for all implicit uses.\n\nNote that it is even possible for a defaults section to take its initial\nsettings from another one, and as such, inherit settings across multiple levels\nof defaults sections. This can be convenient to establish certain configuration\nprofiles to carry groups of default settings (e.g. TCP vs HTTP or short vs long\ntimeouts) but can quickly become confusing to follow.\n\nAll proxy names must be formed from upper and lower case letters, digits,\n'-' (dash), '_' (underscore) , '.' (dot) and ':' (colon). ACL names are\ncase-sensitive, which means that \"www\" and \"WWW\" are two different proxies.\n\nHistorically, all proxy names could overlap, it just caused troubles in the\nlogs. Since the introduction of content switching, it is mandatory that two\nproxies with overlapping capabilities (frontend/backend) have different names.\nHowever, it is still permitted that a frontend and a backend share the same\nname, as this configuration seems to be commonly encountered.\n\nRight now, two major proxy modes are supported : \"tcp\", also known as layer 4,\nand \"http\", also known as layer 7. In layer 4 mode, HAProxy simply forwards\nbidirectional traffic between two sides. In layer 7 mode, HAProxy analyzes the\nprotocol, and can interact with it by allowing, blocking, switching, adding,\nmodifying, or removing arbitrary contents in requests or responses, based on\narbitrary criteria.\n\nIn HTTP mode, the processing applied to requests and responses flowing over\na connection depends in the combination of the frontend's HTTP options and\nthe backend's. HAProxy supports 3 connection modes :\n\n  - KAL : keep alive (\"option http-keep-alive\") which is the default mode : all\n    requests and responses are processed, and connections remain open but idle\n    between responses and new requests.\n\n  - SCL: server close (\"option http-server-close\") : the server-facing\n    connection is closed after the end of the response is received, but the\n    client-facing connection remains open.\n\n  - CLO: close (\"option httpclose\"): the connection is closed after the end of\n    the response and \"Connection: close\" appended in both directions.\n\nThe effective mode that will be applied to a connection passing through a\nfrontend and a backend can be determined by both proxy modes according to the\nfollowing matrix, but in short, the modes are symmetric, keep-alive is the\nweakest option and close is the strongest.\n\n                   Backend mode\n\n                | KAL | SCL | CLO\n            ----+-----+-----+----\n            KAL | KAL | SCL | CLO\n            ----+-----+-----+----\n   mode     SCL | SCL | SCL | CLO\n            ----+-----+-----+----\n            CLO | CLO | CLO | CLO\n\nIt is possible to chain a TCP frontend to an HTTP backend. It is pointless if\nonly HTTP traffic is handled. But it may be used to handle several protocols\nwithin the same frontend. In this case, the client's connection is first handled\nas a raw tcp connection before being upgraded to HTTP. Before the upgrade, the\ncontent processings are performend on raw data. Once upgraded, data is parsed\nand stored using an internal representation called HTX and it is no longer\npossible to rely on raw representation. There is no way to go back.\n\nThere are two kind of upgrades, in-place upgrades and destructive upgrades. The\nfirst ones involves a TCP to HTTP/1 upgrade. In HTTP/1, the request\nprocessings are serialized, thus the applicative stream can be preserved. The\nsecond one involves a TCP to HTTP/2 upgrade. Because it is a multiplexed\nprotocol, the applicative stream cannot be associated to any HTTP/2 stream and\nis destroyed. New applicative streams are then created when HAProxy receives\nnew HTTP/2 streams at the lower level, in the H2 multiplexer. It is important\nto understand this difference because that drastically changes the way to\nprocess data. When an HTTP/1 upgrade is performed, the content processings\nalready performed on raw data are neither lost nor reexecuted while for an\nHTTP/2 upgrade, applicative streams are distinct and all frontend rules are\nevaluated systematically on each one. And as said, the first stream, the TCP\none, is destroyed, but only after the frontend rules were evaluated.\n\nThere is another importnat point to understand when HTTP processings are\nperformed from a TCP proxy. While HAProxy is able to parse HTTP/1 in-fly from\ntcp-request content rules, it is not possible for HTTP/2. Only the HTTP/2\npreface can be parsed. This is a huge limitation regarding the HTTP content\nanalysis in TCP. Concretely it is only possible to know if received data are\nHTTP. For instance, it is not possible to choose a backend based on the Host\nheader value while it is trivial in HTTP/1. Hopefully, there is a solution to\nmitigate this drawback.\n\nThere are two ways to perform an HTTP upgrade. The first one, the historical\nmethod, is to select an HTTP backend. The upgrade happens when the backend is\nset. Thus, for in-place upgrades, only the backend configuration is considered\nin the HTTP data processing. For destructive upgrades, the applicative stream\nis destroyed, thus its processing is stopped. With this method, possibilities\nto choose a backend with an HTTP/2 connection are really limited, as mentioned\nabove, and a bit useless because the stream is destroyed. The second method is\nto upgrade during the tcp-request content rules evaluation, thanks to the\n\"switch-mode http\" action. In this case, the upgrade is performed in the\nfrontend context and it is possible to define HTTP directives in this\nfrontend. For in-place upgrades, it offers all the power of the HTTP analysis\nas soon as possible. It is not that far from an HTTP frontend. For destructive\nupgrades, it does not change anything except it is useless to choose a backend\non limited information. It is of course the recommended method. Thus, testing\nthe request protocol from the tcp-request content rules to perform an HTTP\nupgrade is enough. All the remaining HTTP manipulation may be moved to the\nfrontend http-request ruleset. But keep in mind that tcp-request content rules\nremains evaluated on each streams, that can't be changed.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "4.1. Proxy keywords matrix", "content": "## [4.1.](#4.1)Proxy keywords matrix\n\n```\nThe following list of keywords is supported. Most of them may only be used in a\nlimited set of section types. Some of them are marked as \"deprecated\" because\nthey are inherited from an old syntax which may be confusing or functionally\nlimited, and there are new recommended keywords to replace them. Keywords\nmarked with \"(*)\" can be optionally inverted using the \"no\" prefix, e.g. \"no\noption contstats\". This makes sense when the option has been enabled by default\nand must be disabled for a specific instance. Such options may also be prefixed\nwith \"default\" in order to restore default settings regardless of what has been\nspecified in a previous \"defaults\" section. Keywords supported in defaults\nsections marked with \"(!)\" are only supported in named defaults sections, not\nanonymous ones.\n\nNote: Some dangerous and not recommended directives are intentionnaly not\n      listed in the following matrix. It is on purpose. These directives are\n      documentated. But by not listing them below is one more way to discourage\n      anyone to use it.\n\n```\n\nkeyworddefaultsfrontendlistenbackend[acl](#4-acl)[backlog](#4-backlog)[balance](#4-balance)[bind](#4-bind)[capture cookie](#4-capture%20cookie)[capture request header](#4-capture%20request%20header)[capture response header](#4-capture%20response%20header)[clitcpka-cnt](#4-clitcpka-cnt)[clitcpka-idle](#4-clitcpka-idle)[clitcpka-intvl](#4-clitcpka-intvl)[compression](#4-compression)[cookie](#4-cookie)[crt](#4-crt)[declare capture](#4-declare%20capture)[default-server](#4-default-server)[default_backend](#4-default_backend)[description](#4-description)[disabled](#4-disabled)[dispatch](#4-dispatch)[email-alert from](#4-email-alert%20from)keyworddefaultsfrontendlistenbackend[email-alert level](#4-email-alert%20level)[email-alert mailers](#4-email-alert%20mailers)[email-alert myhostname](#4-email-alert%20myhostname)[email-alert to](#4-email-alert%20to)[enabled](#4-enabled)[errorfile](#4-errorfile)[errorfiles](#4-errorfiles)[errorloc](#4-errorloc)[errorloc302](#4-errorloc302)[errorloc303](#4-errorloc303)[error-log-format](#4-error-log-format)[force-persist](#4-force-persist)[filter](#4-filter)[fullconn](#4-fullconn)[guid](#4-guid)[hash-balance-factor](#4-hash-balance-factor)[hash-preserve-affinity](#4-hash-preserve-affinity)[hash-type](#4-hash-type)[http-after-response](#4-http-after-response)[http-check comment](#4-http-check%20comment)keyworddefaultsfrontendlistenbackend[http-check connect](#4-http-check%20connect)[http-check disable-on-404](#4-http-check%20disable-on-404)[http-check expect](#4-http-check%20expect)[http-check send](#4-http-check%20send)[http-check send-state](#4-http-check%20send-state)[http-check set-var](#4-http-check%20set-var)[http-check unset-var](#4-http-check%20unset-var)[http-error](#4-http-error)[http-request](#4-http-request)[http-response](#4-http-response)[http-reuse](#4-http-reuse)[http-send-name-header](#4-http-send-name-header)[id](#4-id)[ignore-persist](#4-ignore-persist)[load-server-state-from-file](#4-load-server-state-from-file)[(*)log](#4-log)[log-format](#4-log-format)[log-format-sd](#4-log-format-sd)[log-tag](#4-log-tag)[log-steps](#4-log-steps)keyworddefaultsfrontendlistenbackend[max-keep-alive-queue](#4-max-keep-alive-queue)[max-session-srv-conns](#4-max-session-srv-conns)[maxconn](#4-maxconn)[mode](#4-mode)[monitor fail](#4-monitor%20fail)[monitor-uri](#4-monitor-uri)[(*)option abortonclose](#4-option%20abortonclose)[(*)option allbackups](#4-option%20allbackups)[(*)option checkcache](#4-option%20checkcache)[(*)option clitcpka](#4-option%20clitcpka)[(*)option contstats](#4-option%20contstats)[(*)option disable-h2-upgrade](#4-option%20disable-h2-upgrade)[(*)option dontlog-normal](#4-option%20dontlog-normal)[(*)option dontlognull](#4-option%20dontlognull)[option forwardfor](#4-option%20forwardfor)[(*)option forwarded](#4-option%20forwarded)[(*)option h1-case-adjust-bogus-client](#4-option%20h1-case-adjust-bogus-client)[(*)option h1-case-adjust-bogus-server](#4-option%20h1-case-adjust-bogus-server)[(*)option http-buffer-request](#4-option%20http-buffer-request)[(*)option http-drop-request-trailers](#4-option%20http-drop-request-trailers)keyworddefaultsfrontendlistenbackend[(*)option http-drop-response-trailers](#4-option%20http-drop-response-trailers)[(*)option http-ignore-probes](#4-option%20http-ignore-probes)[(*)option http-keep-alive](#4-option%20http-keep-alive)[(*)option http-no-delay](#4-option%20http-no-delay)[(*)option http-pretend-keepalive](#4-option%20http-pretend-keepalive)[option http-restrict-req-hdr-names](#4-option%20http-restrict-req-hdr-names)[(*)option http-server-close](#4-option%20http-server-close)[(*)option http-use-proxy-header](#4-option%20http-use-proxy-header)[option httpchk](#4-option%20httpchk)[(*)option httpclose](#4-option%20httpclose)[option httplog](#4-option%20httplog)[option httpslog](#4-option%20httpslog)[(*)option independent-streams](#4-option%20independent-streams)[option ldap-check](#4-option%20ldap-check)[option external-check](#4-option%20external-check)[(*)option log-health-checks](#4-option%20log-health-checks)[(*)option log-separate-errors](#4-option%20log-separate-errors)[(*)option logasap](#4-option%20logasap)[option mysql-check](#4-option%20mysql-check)[(*)option nolinger](#4-option%20nolinger)keyworddefaultsfrontendlistenbackend[option originalto](#4-option%20originalto)[(*)option persist](#4-option%20persist)[option pgsql-check](#4-option%20pgsql-check)[(*)option prefer-last-server](#4-option%20prefer-last-server)[(*)option redispatch](#4-option%20redispatch)[option redis-check](#4-option%20redis-check)[option smtpchk](#4-option%20smtpchk)[(*)option socket-stats](#4-option%20socket-stats)[(*)option splice-auto](#4-option%20splice-auto)[(*)option splice-request](#4-option%20splice-request)[(*)option splice-response](#4-option%20splice-response)[option spop-check](#4-option%20spop-check)[(*)option srvtcpka](#4-option%20srvtcpka)[option ssl-hello-chk](#4-option%20ssl-hello-chk)[option tcp-check](#4-option%20tcp-check)[(*)option tcp-smart-accept](#4-option%20tcp-smart-accept)[(*)option tcp-smart-connect](#4-option%20tcp-smart-connect)[option tcpka](#4-option%20tcpka)[option tcplog](#4-option%20tcplog)[(*)option transparent](#4-option%20transparent)keyworddefaultsfrontendlistenbackend[(*)option idle-close-on-response](#4-option%20idle-close-on-response)[external-check command](#4-external-check%20command)[external-check path](#4-external-check%20path)[persist rdp-cookie](#4-persist%20rdp-cookie)[quic-initial](#4-quic-initial)[rate-limit sessions](#4-rate-limit%20sessions)[redirect](#4-redirect)[retries](#4-retries)[retry-on](#4-retry-on)[server](#4-server)[server-state-file-name](#4-server-state-file-name)[server-template](#4-server-template)[source](#4-source)[srvtcpka-cnt](#4-srvtcpka-cnt)[srvtcpka-idle](#4-srvtcpka-idle)[srvtcpka-intvl](#4-srvtcpka-intvl)[stats admin](#4-stats%20admin)[stats auth](#4-stats%20auth)[stats enable](#4-stats%20enable)[stats hide-version](#4-stats%20hide-version)keyworddefaultsfrontendlistenbackend[stats http-request](#4-stats%20http-request)[stats realm](#4-stats%20realm)[stats refresh](#4-stats%20refresh)[stats scope](#4-stats%20scope)[stats show-desc](#4-stats%20show-desc)[stats show-legends](#4-stats%20show-legends)[stats show-node](#4-stats%20show-node)[stats uri](#4-stats%20uri)[stick match](#4-stick%20match)[stick on](#4-stick%20on)[stick store-request](#4-stick%20store-request)[stick store-response](#4-stick%20store-response)[stick-table](#4-stick-table)[tcp-check comment](#4-tcp-check%20comment)[tcp-check connect](#4-tcp-check%20connect)[tcp-check expect](#4-tcp-check%20expect)[tcp-check send](#4-tcp-check%20send)[tcp-check send-lf](#4-tcp-check%20send-lf)[tcp-check send-binary](#4-tcp-check%20send-binary)[tcp-check send-binary-lf](#4-tcp-check%20send-binary-lf)keyworddefaultsfrontendlistenbackend[tcp-check set-var](#4-tcp-check%20set-var)[tcp-check unset-var](#4-tcp-check%20unset-var)[tcp-request connection](#4-tcp-request%20connection)[tcp-request content](#4-tcp-request%20content)[tcp-request inspect-delay](#4-tcp-request%20inspect-delay)[tcp-request session](#4-tcp-request%20session)[tcp-response content](#4-tcp-response%20content)[tcp-response inspect-delay](#4-tcp-response%20inspect-delay)[timeout check](#4-timeout%20check)[timeout client](#4-timeout%20client)[timeout client-fin](#4-timeout%20client-fin)[timeout client-hs](#4-timeout%20client-hs)[timeout connect](#4-timeout%20connect)[timeout http-keep-alive](#4-timeout%20http-keep-alive)[timeout http-request](#4-timeout%20http-request)[timeout queue](#4-timeout%20queue)[timeout server](#4-timeout%20server)[timeout server-fin](#4-timeout%20server-fin)[timeout tarpit](#4-timeout%20tarpit)[timeout tunnel](#4-timeout%20tunnel)keyworddefaultsfrontendlistenbackend[(deprecated)transparent](#4-transparent)[unique-id-format](#4-unique-id-format)[unique-id-header](#4-unique-id-header)[use_backend](#4-use_backend)[use-fcgi-app](#4-use-fcgi-app)[use-server](#4-use-server)", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "4.2. Alphabetically sorted keywords reference", "content": "## [4.2.](#4.2)Alphabetically sorted keywords reference\n\n```\nThis section provides a description of each keyword and its usage.\n\n```\n\n**[acl](#4.2-acl)**<aclname><criterion>[flags][operator]<value>...```\nDeclare or complete an access list.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyes(!)yesyesyes```\nThis directive is only available from named defaults sections, not anonymous\nones. ACLs defined in a defaults section are not visible from other sections\nusing it.\n\n```\n\nExample:```\n\nacl invalid_src  src          0.0.0.0/7 224.0.0.0/3\nacl invalid_src  src_port     0:1023\nacl local_dst    hdr(host) -i localhost\n\n```\n\n```\nSee section 7 about ACL usage.\n\n```\n\n**[backlog](#4.2-backlog)**<conns>```\nGive hints to the system about the approximate listen backlog desired size\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<conns>   is the number of pending connections. Depending on the operating\n          system, it may represent the number of already acknowledged\n          connections, of non-acknowledged ones, or both.\n```\n\n```\nThis option is only meaningful for stream listeners, including QUIC ones. Its\nbehavior however is not identical with QUIC instances.\n\nFor all listeners but QUIC, in order to protect against SYN flood attacks,\none solution is to increase the system's SYN backlog size. Depending on the\nsystem, sometimes it is just tunable via a system parameter, sometimes it is\nnot adjustable at all, and sometimes the system relies on hints given by the\napplication at the time of the listen() syscall. By default, HAProxy passes\nthe frontend's maxconn value to the listen() syscall. On systems which can\nmake use of this value, it can sometimes be useful to be able to specify a\ndifferent value, hence this backlog parameter.\n\nOn Linux 2.4, the parameter is ignored by the system. On Linux 2.6, it is\nused as a hint and the system accepts up to the smallest greater power of\ntwo, and never more than some limits (usually 32768).\n\nFor QUIC listeners, backlog sets a shared limits for both the maximum count\nof active handshakes and connections waiting to be accepted. The handshake\nphase relies primarily of the network latency with the remote peer, whereas\nthe second phase depends solely on haproxy load. When either one of this\nlimit is reached, haproxy starts to drop reception of INITIAL packets,\npreventing any new connection allocation, until the connection excess starts\nto decrease. This situation may cause browsers to silently downgrade the HTTP\nversions and switching to TCP.\n\n```\n\n**See also :**\"[maxconn](#)- This keyword is available in sections :\n- [Log forwarding](#maxconn%20%28Log%20forwarding%29)\n- [Performance tuning](#maxconn%20%28Performance%20tuning%29)\n- [Alphabetically sorted keywords reference](#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Bind options](#maxconn%20%28Bind%20options%29)\n- [Server and default-server options](#maxconn%20%28Server%20and%20default-server%20options%29)\n\n\" and the target operating system's tuning guide.**[balance](#4.2-balance)**<algorithm>[<arguments>]**[balance url_param](#4.2-balance%20url_param)**<param>[check_post]```\nDefine the load balancing algorithm to be used in a backend.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<algorithm> is the algorithm used to select a server when doing load\n            balancing. This only applies when no persistence information\n            is available, or when a connection is redispatched to another\n            server. <algorithm> may be one of the following :\n\n  roundrobin  Each server is used in turns, according to their weights.\n              This is the smoothest and fairest algorithm when the server's\n              processing time remains equally distributed. This algorithm\n              is dynamic, which means that server weights may be adjusted\n              on the fly for slow starts for instance. It is limited by\n              design to 4095 active servers per backend. Note that in some\n              large farms, when a server becomes up after having been down\n              for a very short time, it may sometimes take a few hundreds\n              requests for it to be re-integrated into the farm and start\n              receiving traffic. This is normal, though very rare. It is\n              indicated here in case you would have the chance to observe\n              it, so that you don't worry. Note: weights are ignored for\n              backends in LOG mode.\n\n  static-rr   Each server is used in turns, according to their weights.\n              This algorithm is as similar to roundrobin except that it is\n              static, which means that changing a server's weight on the\n              fly will have no effect. On the other hand, it has no design\n              limitation on the number of servers, and when a server goes\n              up, it is always immediately reintroduced into the farm, once\n              the full map is recomputed. It also uses slightly less CPU to\n              run (around -1%). This algorithm is not usable in LOG mode.\n\n  leastconn   The server with the lowest number of connections receives the\n              connection. Round-robin is performed within groups of servers\n              of the same load to ensure that all servers will be used. Use\n              of this algorithm is recommended where very long sessions are\n              expected, such as LDAP, SQL, TSE, etc... but is not very well\n              suited for protocols using short sessions such as HTTP. This\n              algorithm is dynamic, which means that server weights may be\n              adjusted on the fly for slow starts for instance. It will\n              also consider the number of queued connections in addition to\n              the established ones in order to minimize queuing. This\n              algorithm is not usable in LOG mode.\n\n  first       The first server with available connection slots receives the\n              connection. The servers are chosen from the lowest numeric\n              identifier to the highest (see server parameter \"idThis keyword is available in sections :Alphabetically sorted keywords referenceBind optionsServer and default-server options\"), which\n              defaults to the server's position in the farm. Once a server\n              reaches its maxconn value, the next server is used. It does\n              not make sense to use this algorithm without setting maxconn.\n              The purpose of this algorithm is to always use the smallest\n              number of servers so that extra servers can be powered off\n              during non-intensive hours. This algorithm ignores the server\n              weight, and brings more benefit to long session such as RDP\n              or IMAP than HTTP, though it can be useful there too. In\n              order to use this algorithm efficiently, it is recommended\n              that a cloud controller regularly checks server usage to turn\n              them off when unused, and regularly checks backend queue to\n              turn new servers on when the queue inflates. Alternatively,\n              using \"http-check send-state\" may inform servers on the load.\n              This algorithm is not usable in LOG mode.\n\n  hash        Takes a regular sample expression in argument. The expression\n              is evaluated for each request and hashed according to the\n              configured hash-type. The result of the hash is divided by\n              the total weight of the running servers to designate which\n              server will receive the request. This can be used in place of\n              \"sourceThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\", \"uri\", \"hdr()\", \"url_param()\", \"rdp-cookie\" to make\n              use of a converter, refine the evaluation, or be used to\n              extract data from local variables for example. When the data\n              is not available, round robin will apply. This algorithm is\n              static by default, which means that changing a server's\n              weight on the fly will have no effect, but this can be\n              changed using \"hash-type\". This algorithm is not usable for\n              backends in LOG mode, please use \"log-hash\" instead.\n\n  source      The source IP address is hashed and divided by the total\n              weight of the running servers to designate which server will\n              receive the request. This ensures that the same client IP\n              address will always reach the same server as long as no\n              server goes down or up. If the hash result changes due to the\n              number of running servers changing, many clients will be\n              directed to a different server. This algorithm is generally\n              used in TCP mode where no cookie may be inserted. It may also\n              be used on the Internet to provide a best-effort stickiness\n              to clients which refuse session cookies. This algorithm is\n              static by default, which means that changing a server's\n              weight on the fly will have no effect, but this can be\n              changed using \"hash-type\". See also the \"hash\" option above.\n              This algorithm is not usable for backends in LOG mode.\n\n  uri         This algorithm hashes either the left part of the URI (before\n              the question mark) or the whole URI (if the \"whole\" parameter\n              is present) and divides the hash value by the total weight of\n              the running servers. The result designates which server will\n              receive the request. This ensures that the same URI will\n              always be directed to the same server as long as no server\n              goes up or down. This is used with proxy caches and\n              anti-virus proxies in order to maximize the cache hit rate.\n              Note that this algorithm may only be used in an HTTP backend.\n              This algorithm is static by default, which means that\n              changing a server's weight on the fly will have no effect,\n              but this can be changed using \"hash-type\".\n\n              This algorithm supports two optional parameters \"len\" and\n              \"depth\", both followed by a positive integer number. These\n              options may be helpful when it is needed to balance servers\n              based on the beginning of the URI only. The \"len\" parameter\n              indicates that the algorithm should only consider that many\n              characters at the beginning of the URI to compute the hash.\n              Note that having \"len\" set to 1 rarely makes sense since most\n              URIs start with a leading \"/\".\n\n              The \"depth\" parameter indicates the maximum directory depth\n              to be used to compute the hash. One level is counted for each\n              slash in the request. If both parameters are specified, the\n              evaluation stops when either is reached.\n\n              A \"path-only\" parameter indicates that the hashing key starts\n              at the first '/' of the path. This can be used to ignore the\n              authority part of absolute URIs, and to make sure that HTTP/1\n              and HTTP/2 URIs will provide the same hash. See also the\n              \"hash\" option above.\n\n  url_param   The URL parameter specified in argument will be looked up in\n              the query string of each HTTP GET request.\n\n              If the modifier \"check_post\" is used, then an HTTP POST\n              request entity will be searched for the parameter argument,\n              when it is not found in a query string after a question mark\n              ('?') in the URL. The message body will only start to be\n              analyzed once either the advertised amount of data has been\n              received or the request buffer is full. In the unlikely event\n              that chunked encoding is used, only the first chunk is\n              scanned. Parameter values separated by a chunk boundary, may\n              be randomly balanced if at all. This keyword used to support\n              an optional <max_wait> parameter which is now ignored.\n\n              If the parameter is found followed by an equal sign ('=') and\n              a value, then the value is hashed and divided by the total\n              weight of the running servers. The result designates which\n              server will receive the request.\n\n              This is used to track user identifiers in requests and ensure\n              that a same user ID will always be sent to the same server as\n              long as no server goes up or down. If no value is found or if\n              the parameter is not found, then a round robin algorithm is\n              applied. Note that this algorithm may only be used in an HTTP\n              backend. This algorithm is static by default, which means\n              that changing a server's weight on the fly will have no\n              effect, but this can be changed using \"hash-type\". See also\n              the \"hash\" option above.\n\n  hdr(<name>) The HTTP header <name> will be looked up in each HTTP\n              request. Just as with the equivalent ACL 'hdr()' function,\n              the header name in parenthesis is not case sensitive. If the\n              header is absent or if it does not contain any value, the\n              roundrobin algorithm is applied instead.\n\n              An optional 'use_domain_only' parameter is available, for\n              reducing the hash algorithm to the main domain part with some\n              specific headers such as 'Host'. For instance, in the Host\n              value \"haproxy.1wt.eu\", only \"1wt\" will be considered.\n\n              This algorithm is static by default, which means that\n              changing a server's weight on the fly will have no effect,\n              but this can be changed using \"hash-type\". See also the\n              \"hash\" option above.\n\n  random\n  random(<draws>)\n              A random number will be used as the key for the consistent\n              hashing function. This means that the servers' weights are\n              respected, dynamic weight changes immediately take effect, as\n              well as new server additions. Random load balancing can be\n              useful with large farms or when servers are frequently added\n              or removed as it may avoid the hammering effect that could\n              result from roundrobin or leastconn in this situation. The\n              hash-balance-factor directive can be used to further improve\n              fairness of the load balancing, especially in situations\n              where servers show highly variable response times. When an\n              argument <draws> is present, it must be an integer value one\n              or greater, indicating the number of draws before selecting\n              the least loaded of these servers. It was indeed demonstrated\n              that picking the least loaded of two servers is enough to\n              significantly improve the fairness of the algorithm, by\n              always avoiding to pick the most loaded server within a farm\n              and getting rid of any bias that could be induced by the\n              unfair distribution of the consistent list. Higher values N\n              will take away N-1 of the highest loaded servers at the\n              expense of performance. With very high values, the algorithm\n              will converge towards the leastconn's result but much slower.\n              The default value is 2, which generally shows very good\n              distribution and performance. This algorithm is also known as\n              the Power of Two Random Choices and is described here :\n              http://www.eecs.harvard.edu/~michaelm/postscripts/handbook2001.pdf\n\n              For backends in LOG mode, the number of draws is ignored and\n              a single random is picked since there is no notion of server\n              load. Random log balancing can be useful with large farms or\n              when servers are frequently added or removed from the pool of\n              available servers as it may avoid the hammering effect that\n              could result from roundrobin in this situation.\n\n  rdp-cookie\n  rdp-cookie(<name>)\n              The RDP cookie <name> (or \"mstshash\" if omitted) will be\n              looked up and hashed for each incoming TCP request. Just as\n              with the equivalent ACL 'req.rdp_cookie()' function, the name\n              is not case-sensitive. This mechanism is useful as a degraded\n              persistence mode, as it makes it possible to always send the\n              same user (or the same session ID) to the same server. If the\n              cookie is not found, the normal roundrobin algorithm is\n              used instead.\n\n              Note that for this to work, the frontend must ensure that an\n              RDP cookie is already present in the request buffer. For this\n              you must use 'tcp-request content accept' rule combined with\n              a 'req.rdp_cookie_cnt' ACL.\n\n              This algorithm is static by default, which means that\n              changing a server's weight on the fly will have no effect,\n              but this can be changed using \"hash-type\". See also the\n              \"hash\" option above.\n\n  log-hash    Takes a comma-delimited list of converters in argument. These\n              converters are applied in sequence to the input log message,\n              and the result will be cast as a string then hashed according\n              to the configured hash-type. The resulting hash will be used\n              to select the destination server among the ones declared in\n              the log backend. The goal of this algorithm is to be able to\n              extract a key within the final log message using string\n              converters and then be able to stick to the same server thanks\n              to the hash. Only \"map-based\" hashes are supported for now.\n              This algorithm is only usable for backends in LOG mode, for\n              others, please use \"hash\" instead.\n\n  sticky      Tries to stick to the same server as much as possible. The\n              first server in the list of available servers receives all\n              the log messages. When the server goes DOWN, the next server\n              in the list takes its place. When a previously DOWN server\n              goes back UP it is added at the end of the list so that the\n              sticky server doesn't change until it becomes DOWN.\n\n<arguments> is an optional list of arguments which may be needed by some\n            algorithms. Right now, only \"url_param\", \"uri\" and \"log-hash\"\n            support an optional argument.\n```\n\n```\nThe load balancing algorithm of a backend is set to roundrobin when no other\nalgorithm, mode nor option have been set. The algorithm may only be set once\nfor each backend.\n\nWith authentication schemes that require the same connection like NTLM, URI\nbased algorithms must not be used, as they would cause subsequent requests\nto be routed to different backend servers, breaking the invalid assumptions\nNTLM relies on.\n\nTCP/HTTP Examples :\n      balance roundrobin\n      balance url_param userid\n      balance url_param session_id check_post 64\n      balance hdr(User-Agent)\n      balance hdr(host)\n      balance hdr(Host) use_domain_only\n      balance hash req.cookie(clientid)\n      balance hash var(req.client_id)\n      balance hash req.hdr_ip(x-forwarded-for,-1),ipmask(24)\n\nLOG backend examples:\n      global\n        log backend@mylog-rrb local0 # send all logs to mylog-rrb backend\n        log backend@mylog-hash local0 # send all logs to mylog-hash backend\n\n      backend mylog-rrb\n        mode log\n        balance roundrobin\n\n        server s1 udp@127.0.0.1:514 # will receive 50% of log messages\n        server s2 udp@127.0.0.1:514\n\n      backend mylog-hash\n        mode log\n\n        # extract \"METHOD URL PROTO\" at the end of the log message,\n        # and let haproxy hash it so that log messages generated from\n        # similar requests get sent to the same syslog server:\n        balance log-hash 'field(-2,\\\")'\n\n        # server list here\n        server s1 127.0.0.1:514\n        #...\n\nNote: the following caveats and limitations on using the \"check_post\"\nextension with \"url_param\" must be considered :\n\n  - all POST requests are eligible for consideration, because there is no way\n    to determine if the parameters will be found in the body or entity which\n    may contain binary data. Therefore another method may be required to\n    restrict consideration of POST requests that have no URL parameters in\n    the body. (see acl http_end)\n\n  - using a <max_wait> value larger than the request buffer size does not\n    make sense and is useless. The buffer size is set at build time, and\n    defaults to 16 kB.\n\n  - Content-Encoding is not supported, the parameter search will probably\n    fail; and load balancing will fall back to Round Robin.\n\n  - Expect: 100-continue is not supported, load balancing will fall back to\n    Round Robin.\n\n  - Transfer-Encoding (RFC7230 3.3.1) is only supported in the first chunk.\n    If the entire parameter value is not present in the first chunk, the\n    selection of server is undefined (actually, defined by how little\n    actually appeared in the first chunk).\n\n  - This feature does not support generation of a 100, 411 or 501 response.\n\n  - In some cases, requesting \"check_post\" MAY attempt to scan the entire\n    contents of a message body. Scanning normally terminates when linear\n    white space or control characters are found, indicating the end of what\n    might be a URL parameter list. This is probably not a concern with SGML\n    type message bodies.\n\n```\n\n**See also :**\"[dispatch](#dispatch)\", \"[cookie](#)- This keyword is available in sections :\n- [Alphabetically sorted keywords reference](#cookie%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Server and default-server options](#cookie%20%28Server%20and%20default-server%20options%29)\n- [Fetching HTTP samples (Layer 7)](#cookie%20%28Fetching%20HTTP%20samples%20%28Layer%207%29%29)\n\n\", \"[transparent](#option%20transparent)\", \"[hash-type](#hash-type)\".**[bind](#4.2-bind)**[<address>]:<port_range>[, ...][param*]**[bind](#4.2-bind)**/<path>[, ...][param*]```\nDefine one or several listening addresses and/or ports in a frontend.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesnoArguments :```\n<address>     is optional and can be a host name, an IPv4 address, an IPv6\n              address, or '*'. It designates the address the frontend will\n              listen on. If unset, all IPv4 addresses of the system will be\n              listened on. The same will apply for '*' or the system's\n              special address \"0.0.0.0\". The IPv6 equivalent is '::'. Note\n              that for UDP, specific OS features are required when binding\n              on multiple addresses to ensure the correct network interface\n              and source address will be used on response. In other way,\n              for QUIC listeners only bind on multiple addresses if running\n              with a modern enough systems.\n\n              Optionally, an address family prefix may be used before the\n              address to force the family regardless of the address format,\n              which can be useful to specify a path to a unix socket with\n              no slash ('/'). Currently supported prefixes are :\n                - 'ipv4@'  -> address is always IPv4\n                - 'ipv6@'  -> address is always IPv6\n                - 'udp@'   -> address is resolved as IPv4 or IPv6 and\n                  protocol UDP is used. Currently those listeners are\n                  supported only in log-forward sections.\n                - 'udp4@'  -> address is always IPv4 and protocol UDP\n                  is used. Currently those listeners are supported\n                  only in log-forward sections.\n                - 'udp6@'  -> address is always IPv6 and protocol UDP\n                  is used. Currently those listeners are supported\n                  only in log-forward sections.\n                - 'unix@'  -> address is a path to a local unix socket\n                - 'abns@'  -> address is in abstract namespace (Linux only).\n                - 'abnsz@'  -> address is in abstract namespace (Linux only)\n                   but it is explicitly zero-terminated. This means no \\0\n                   padding is used to complete sun_path. It is useful to\n                   interconnect with programs that don't implement the\n                   default abns naming logic that haproxy uses.\n                - 'fd@<n>' -> use file descriptor <n> inherited from the\n                  parent. The fd must be bound and may or may not already\n                  be listening.\n                - 'sockpair@<n>'-> like fd@ but you must use the fd of a\n                  connected unix socket or of a socketpair. The bind waits\n                  to receive a FD over the unix socket and uses it as if it\n                  was the FD of an accept(). Should be used carefully.\n                - 'quic4@' -> address is resolved as IPv4 and protocol UDP\n                  is used. Note that to achieve the best performance with a\n                  large traffic you should keep \"tune.quic.socket-owner\" on\n                  connection. Else QUIC connections will be multiplexed\n                  over the listener socket. Another alternative would be to\n                  duplicate QUIC listener instances over several threads,\n                  for example using \"shardsThis keyword is available in sections :Peers declarationBind options\" keyword to at least reduce\n                  thread contention.\n                - 'quic6@' -> address is resolved as IPv6 and protocol UDP\n                  is used. The performance note for QUIC over IPv4 applies\n                  as well.\n                - 'rhttp@' [ EXPERIMENTAL ] -> used for reverse HTTP.\n                  Address must be a server with the format\n                  '<backend>/<server>'. The server will be used to\n                  instantiate connections to a remote address. The listener\n                  will try to maintain \"nbconn\" connections. This is an\n                  experimental features which requires\n                  \"expose-experimental-directives\" on a line before this\n                  bind.\n\n              You may want to reference some environment variables in the\n              address parameter, see section 2.3 about environment\n              variables.\n\n<port_range>  is either a unique TCP port, or a port range for which the\n              proxy will accept connections for the IP address specified\n              above. The port is mandatory for TCP listeners. Note that in\n              the case of an IPv6 address, the port is always the number\n              after the last colon (':'). A range can either be :\n               - a numerical port (ex: '80')\n               - a dash-delimited ports range explicitly stating the lower\n                 and upper bounds (ex: '2000-2100') which are included in\n                 the range.\n\n              Particular care must be taken against port ranges, because\n              every <address:port> couple consumes one socket (= a file\n              descriptor), so it's easy to consume lots of descriptors\n              with a simple range, and to run out of sockets. Also, each\n              <address:port> couple must be used only once among all\n              instances running on a same system. Please note that binding\n              to ports lower than 1024 generally require particular\n              privileges to start the program, which are independent of\n              the 'uid' parameter.\n\n<path>        is a UNIX socket path beginning with a slash ('/'). This is\n              alternative to the TCP listening port. HAProxy will then\n              receive UNIX connections on the socket located at this place.\n              The path must begin with a slash and by default is absolute.\n              It can be relative to the prefix defined by \"unix-bind\" in\n              the global section. Note that the total length of the prefix\n              followed by the socket path cannot exceed some system limits\n              for UNIX sockets, which commonly are set to 107 characters.\n\n<param*>      is a list of parameters common to all sockets declared on the\n              same line. These numerous parameters depend on OS and build\n              options and have a complete section dedicated to them. Please\n              refer to section 5 to for more details.\n```\n\n```\nIt is possible to specify a list of address:port combinations delimited by\ncommas. The frontend will then listen on all of these addresses. There is no\nfixed limit to the number of addresses and ports which can be listened on in\na frontend, as well as there is no limit to the number of \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" statements\nin a frontend.\n\n```\n\nExample :```\n\nlisten http_proxy\n    bind :80,:443\n    bind 10.0.0.1:10080,10.0.0.1:10443\n    bind /var/run/ssl-frontend.sock user root mode 600 accept-proxy\n\nlisten http_https_proxy\n    bind :80\n    bind :443 ssl crt /etc/haproxy/site.pem\n\nlisten http_https_proxy_explicit\n    bind ipv6@:80\n    bind ipv4@public_ssl:443 ssl crt /etc/haproxy/site.pem\n    bind unix@ssl-frontend.sock user root mode 600 accept-proxy\n\nlisten external_bind_app1\n    bind \"fd@${FD_APP1}\"\n\nlisten h3_quic_proxy\n    bind quic4@10.0.0.1:8888 ssl crt /etc/mycrt\n\n```\n\n```\nNote: regarding Linux's abstract namespace sockets, \"abns\" HAProxy sockets\n      uses the whole sun_path length is used for the address length. Some\n      other programs such as socat use the string length only by default.\n      Pass the option \",unix-tightsocklen=0\" to any abstract socket\n      definition in socat to make it compatible with HAProxy's, or use the\n      \"abnsz\" HAProxy socket family instead.\n\n```\n\n**See also :**\"[source](#)- This keyword is available in sections :\n- [Alphabetically sorted keywords reference](#source%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Server and default-server options](#source%20%28Server%20and%20default-server%20options%29)\n\n\", \"[option forwardfor](#option%20forwardfor)\", \"[unix-bind](#unix-bind)\" and the PROXY protocol documentation, and[section 5](#5)about bind options.**[capture cookie](#4.2-capture%20cookie)**<name>len<length>```\nCapture and log a cookie in the request and in the response.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesnoArguments :```\n<name>    is the beginning of the name of the cookie to capture. In order\n          to match the exact name, simply suffix the name with an equal\n          sign ('='). The full name will appear in the logs, which is\n          useful with application servers which adjust both the cookie name\n          and value (e.g. ASPSESSIONXXX).\n\n<length>  is the maximum number of characters to report in the logs, which\n          include the cookie name, the equal sign and the value, all in the\n          standard \"name=value\" form. The string will be truncated on the\n          right if it exceeds <length>.\n```\n\n```\nOnly the first cookie is captured. Both the \"cookieThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server optionsFetching HTTP samples (Layer 7)\" request headers and the\n\"set-cookie\" response headers are monitored. This is particularly useful to\ncheck for application bugs causing session crossing or stealing between\nusers, because generally the user's cookies can only change on a login page.\n\nWhen the cookie was not presented by the client, the associated log column\nwill report \"-\". When a request does not cause a cookie to be assigned by the\nserver, a \"-\" is reported in the response column.\n\nThe capture is performed in the frontend only because it is necessary that\nthe log format does not change for a given frontend depending on the\nbackends. This may change in the future. Note that there can be only one\n\"capture cookie\" statement in a frontend. The maximum capture length is set\nby the global \"tune.http.cookielen\" setting and defaults to 63 characters. It\nis not possible to specify a capture in a \"defaults\" section.\n\n```\n\nExample:```\n\ncapture cookie ASPSESSION len 32\n\n```\n\n**See also :**\"[capture request header](#capture%20request%20header)\", \"[capture response header](#capture%20response%20header)\" as well as[section 8](#8)about logging.**[capture request header](#4.2-capture%20request%20header)**<name>len<length>```\nCapture and log the last occurrence of the specified request header.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesnoArguments :```\n<name>    is the name of the header to capture. The header names are not\n          case-sensitive, but it is a common practice to write them as they\n          appear in the requests, with the first letter of each word in\n          upper case. The header name will not appear in the logs, only the\n          value is reported, but the position in the logs is respected.\n\n<length>  is the maximum number of characters to extract from the value and\n          report in the logs. The string will be truncated on the right if\n          it exceeds <length>.\n```\n\n```\nThe complete value of the last occurrence of the header is captured. The\nvalue will be added to the logs between braces ('{}'). If multiple headers\nare captured, they will be delimited by a vertical bar ('|') and will appear\nin the same order they were declared in the configuration. Non-existent\nheaders will be logged just as an empty string. Common uses for request\nheader captures include the \"Host\" field in virtual hosting environments, the\n\"Content-length\" when uploads are supported, \"User-agent\" to quickly\ndifferentiate between real users and robots, and \"X-Forwarded-For\" in proxied\nenvironments to find where the request came from.\n\nNote that when capturing headers such as \"User-agent\", some spaces may be\nlogged, making the log analysis more difficult. Thus be careful about what\nyou log if you know your log parser is not smart enough to rely on the\nbraces.\n\nThere is no limit to the number of captured request headers nor to their\nlength, though it is wise to keep them low to limit memory usage per stream.\nIn order to keep log format consistent for a same frontend, header captures\ncan only be declared in a frontend. It is not possible to specify a capture\nin a \"defaults\" section.\n\n```\n\nExample:```\n\ncapture request header Host len 15\ncapture request header X-Forwarded-For len 15\ncapture request header Referer len 15\n\n```\n\n**See also :**\"[capture cookie](#capture%20cookie)\", \"[capture response header](#capture%20response%20header)\" as well as[section 8](#8)about logging.**[capture response header](#4.2-capture%20response%20header)**<name>len<length>```\nCapture and log the last occurrence of the specified response header.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesnoArguments :```\n<name>    is the name of the header to capture. The header names are not\n          case-sensitive, but it is a common practice to write them as they\n          appear in the response, with the first letter of each word in\n          upper case. The header name will not appear in the logs, only the\n          value is reported, but the position in the logs is respected.\n\n<length>  is the maximum number of characters to extract from the value and\n          report in the logs. The string will be truncated on the right if\n          it exceeds <length>.\n```\n\n```\nThe complete value of the last occurrence of the header is captured. The\nresult will be added to the logs between braces ('{}') after the captured\nrequest headers. If multiple headers are captured, they will be delimited by\na vertical bar ('|') and will appear in the same order they were declared in\nthe configuration. Non-existent headers will be logged just as an empty\nstring. Common uses for response header captures include the \"Content-length\"\nheader which indicates how many bytes are expected to be returned, the\n\"Location\" header to track redirections.\n\nThere is no limit to the number of captured response headers nor to their\nlength, though it is wise to keep them low to limit memory usage per stream.\nIn order to keep log format consistent for a same frontend, header captures\ncan only be declared in a frontend. It is not possible to specify a capture\nin a \"defaults\" section.\n\n```\n\nExample:```\n\ncapture response header Content-length len 9\ncapture response header Location len 15\n\n```\n\n**See also :**\"[capture cookie](#capture%20cookie)\", \"[capture request header](#capture%20request%20header)\" as well as[section 8](#8)about logging.**[clitcpka-cnt](#4.2-clitcpka-cnt)**<count>```\nSets the maximum number of keepalive probes TCP should send before dropping\nthe connection on the client side.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<count>   is the maximum number of keepalive probes.\n```\n\n```\nThis keyword corresponds to the socket option TCP_KEEPCNT. If this keyword\nis not specified, system-wide TCP parameter (tcp_keepalive_probes) is used.\nThe availability of this setting depends on the operating system. It is\nknown to work on Linux.\n\n```\n\n**See also :**\"[option clitcpka](#option%20clitcpka)\", \"[clitcpka-idle](#clitcpka-idle)\", \"[clitcpka-intvl](#clitcpka-intvl)\".**[clitcpka-idle](#4.2-clitcpka-idle)**<timeout>```\nSets the time the connection needs to remain idle before TCP starts sending\nkeepalive probes, if enabled the sending of TCP keepalive packets on the\nclient side.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<timeout> is the time the connection needs to remain idle before TCP starts\n          sending keepalive probes. It is specified in seconds by default,\n          but can be in any other unit if the number is suffixed by the\n          unit, as explained at the top of this document.\n```\n\n```\nThis keyword corresponds to the socket option TCP_KEEPIDLE. If this keyword\nis not specified, system-wide TCP parameter (tcp_keepalive_time) is used.\nThe availability of this setting depends on the operating system. It is\nknown to work on Linux.\n\n```\n\n**See also :**\"[option clitcpka](#option%20clitcpka)\", \"[clitcpka-cnt](#clitcpka-cnt)\", \"[clitcpka-intvl](#clitcpka-intvl)\".**[clitcpka-intvl](#4.2-clitcpka-intvl)**<timeout>```\nSets the time between individual keepalive probes on the client side.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<timeout> is the time between individual keepalive probes. It is specified\n          in seconds by default, but can be in any other unit if the number\n          is suffixed by the unit, as explained at the top of this\n          document.\n```\n\n```\nThis keyword corresponds to the socket option TCP_KEEPINTVL. If this keyword\nis not specified, system-wide TCP parameter (tcp_keepalive_intvl) is used.\nThe availability of this setting depends on the operating system. It is\nknown to work on Linux.\n\n```\n\n**See also :**\"[option clitcpka](#option%20clitcpka)\", \"[clitcpka-cnt](#clitcpka-cnt)\", \"[clitcpka-idle](#clitcpka-idle)\".**[compression algo](#4.2-compression%20algo)**<algorithm>...**[compression algo-req](#4.2-compression%20algo-req)**<algorithm>**[compression algo-res](#4.2-compression%20algo-res)**<algorithm>**[compression type](#4.2-compression%20type)**<mime type>...```\nEnable HTTP compression.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\nalgo     is followed by the list of supported compression algorithms for\n         responses (legacy keyword)\nalgo-req is followed by compression algorithm for request (only one is\n         provided).\nalgo-res is followed by the list of supported compression algorithms for\n         responses.\ntype     is followed by the list of MIME types that will be compressed for\n         responses (legacy keyword).\ntype-req is followed by the list of MIME types that will be compressed for\n         requests.\ntype-res is followed by the list of MIME types that will be compressed for\n         responses.\n```\n\n```\nThe currently supported algorithms are :\n  identity     this is mostly for debugging, and it was useful for developing\n               the compression feature. Identity does not apply any change on\n               data.\n\n  gzip         applies gzip compression. This setting is only available when\n               support for zlib or libslz was built in.\n\n  deflate      same as \"gzip\", but with deflate algorithm and zlib format.\n               Note that this algorithm has ambiguous support on many\n               browsers and no support at all from recent ones. It is\n               strongly recommended not to use it for anything else than\n               experimentation. This setting is only available when support\n               for zlib or libslz was built in.\n\n  raw-deflate  same as \"deflate\" without the zlib wrapper, and used as an\n               alternative when the browser wants \"deflate\". All major\n               browsers understand it and despite violating the standards,\n               it is known to work better than \"deflate\", at least on MSIE\n               and some versions of Safari. Do not use it in conjunction\n               with \"deflate\", use either one or the other since both react\n               to the same Accept-Encoding token. This setting is only\n               available when support for zlib or libslz was built in.\n\nCompression will be activated depending on the Accept-Encoding request\nheader. With identity, it does not take care of that header.\nIf backend servers support HTTP compression, these directives\nwill be no-op: HAProxy will see the compressed response and will not\ncompress again. If backend servers do not support HTTP compression and\nthere is Accept-Encoding header in request, HAProxy will compress the\nmatching response.\n\nCompression is disabled when:\n  * the request does not advertise a supported compression algorithm in the\n    \"Accept-Encoding\" header\n  * the response message is not HTTP/1.1 or above\n  * HTTP status code is not one of 200, 201, 202, or 203\n  * response contain neither a \"Content-Length\" header nor a\n    \"Transfer-Encoding\" whose last value is \"chunked\"\n  * response contains a \"Content-Type\" header whose first value starts with\n    \"multipart\"\n  * the response contains the \"no-transform\" value in the \"Cache-control\"\n    header\n  * User-Agent matches \"Mozilla/4\" unless it is MSIE 6 with XP SP2, or MSIE 7\n    and later\n  * The response contains a \"Content-Encoding\" header, indicating that the\n    response is already compressed (see compression offload)\n  * The response contains an invalid \"ETag\" header or multiple ETag headers\n  * The payload size is smaller than the minimum size\n    (see compression minsize-res)\n\nNote: The compression does not emit the Warning header.\n\n```\n\nExamples :```\n\ncompression algo gzip\ncompression type text/html text/plain\n\n```\n\n**See also :**\"[compression offload](#compression%20offload)\", \"[compression direction](#compression%20direction)\", \"[compression minsize-req](#compression%20minsize-req)\" and \"[compression minsize-res](#compression%20minsize-res)\"**[compression minsize-req](#4.2-compression%20minsize-req)**<size>**[compression minsize-res](#4.2-compression%20minsize-res)**<size>```\nSets the minimum payload size in bytes for compression to be applied.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyes```\nPayloads smaller than this size will not be compressed, avoiding unnecessary\nCPU overhead for data that would not significantly benefit from compression.\n\"minsize-req\" applies on requests and \"minsize-res\" on responses.\nThe default value is 0.\n\n```\n\n**[compression offload](#4.2-compression%20offload)**```\nMakes HAProxy work as a compression offloader only.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesyes```\nThe \"offload\" setting makes HAProxy remove the Accept-Encoding header to\nprevent backend servers from compressing responses. It is strongly\nrecommended not to do this because this means that all the compression work\nwill be done on the single point where HAProxy is located. However in some\ndeployment scenarios, HAProxy may be installed in front of a buggy gateway\nwith broken HTTP compression implementation which can't be turned off.\nIn that case HAProxy can be used to prevent that gateway from emitting\ninvalid payloads. In this case, simply removing the header in the\nconfiguration does not work because it applies before the header is parsed,\nso that prevents HAProxy from compressing. The \"offload\" setting should\nthen be used for such scenarios.\n\nIf this setting is used in a defaults section, a warning is emitted and the\noption is ignored.\n\n```\n\n**See also :**\"[compression type](#compression%20type)\", \"[compression algo](#compression%20algo)\", \"[compression direction](#compression%20direction)\"**[compression direction](#4.2-compression%20direction)**<direction>```\nMakes haproxy able to compress both requests and responses.\nValid values are \"request\", to compress only requests, \"response\", to\ncompress only responses, or \"both\", when you want to compress both.\nThe default value is \"response\".\n\nMay be used in the following contexts: http\n\n```\n\n**See also :**\"[compression type](#compression%20type)\", \"[compression algo](#compression%20algo)\", \"[compression offload](#compression%20offload)\"**[cookie](#4.2-cookie)**<name>[ rewrite | insert | prefix ][ indirect ][ nocache ][ postonly ][ preserve ][ httponly ][ secure ][ domain<domain>]*[ maxidle<idle>][ maxlife<life>][ dynamic ][ attr<value>]*```\nEnable cookie-based persistence in a backend.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<name>    is the name of the cookie which will be monitored, modified or\n          inserted in order to bring persistence. This cookie is sent to\n          the client via a \"Set-Cookie\" header in the response, and is\n          brought back by the client in a \"Cookie\" header in all requests.\n          Special care should be taken to choose a name which does not\n          conflict with any likely application cookie. Also, if the same\n          backends are subject to be used by the same clients (e.g.\n          HTTP/HTTPS), care should be taken to use different cookie names\n          between all backends if persistence between them is not desired.\n\nrewrite   This keyword indicates that the cookie will be provided by the\n          server and that HAProxy will have to modify its value to set the\n          server's identifier in it. This mode is handy when the management\n          of complex combinations of \"Set-cookie\" and \"Cache-control\"\n          headers is left to the application. The application can then\n          decide whether or not it is appropriate to emit a persistence\n          cookie. Since all responses should be monitored, this mode\n          doesn't work in HTTP tunnel mode. Unless the application\n          behavior is very complex and/or broken, it is advised not to\n          start with this mode for new deployments. This keyword is\n          incompatible with \"insert\" and \"prefix\".\n\ninsert    This keyword indicates that the persistence cookie will have to\n          be inserted by HAProxy in server responses if the client did not\n\n          already have a cookie that would have permitted it to access this\n          server. When used without the \"preserve\" option, if the server\n          emits a cookie with the same name, it will be removed before\n          processing. For this reason, this mode can be used to upgrade\n          existing configurations running in the \"rewrite\" mode. The cookie\n          will only be a session cookie and will not be stored on the\n          client's disk. By default, unless the \"indirect\" option is added,\n          the server will see the cookies emitted by the client. Due to\n          caching effects, it is generally wise to add the \"nocache\" or\n          \"postonly\" keywords (see below). The \"insert\" keyword is not\n          compatible with \"rewrite\" and \"prefix\".\n\nprefix    This keyword indicates that instead of relying on a dedicated\n          cookie for the persistence, an existing one will be completed.\n          This may be needed in some specific environments where the client\n          does not support more than one single cookie and the application\n          already needs it. In this case, whenever the server sets a cookie\n          named <name>, it will be prefixed with the server's identifier\n          and a delimiter. The prefix will be removed from all client\n          requests so that the server still finds the cookie it emitted.\n          Since all requests and responses are subject to being modified,\n          this mode doesn't work with tunnel mode. The \"prefix\" keyword is\n          not compatible with \"rewrite\" and \"insert\". Note: it is highly\n          recommended not to use \"indirect\" with \"prefix\", otherwise server\n          cookie updates would not be sent to clients.\n\nindirect  When this option is specified, no cookie will be emitted to a\n          client which already has a valid one for the server which has\n          processed the request. If the server sets such a cookie itself,\n          it will be removed, unless the \"preserve\" option is also set. In\n          \"insert\" mode, this will additionally remove cookies from the\n          requests transmitted to the server, making the persistence\n          mechanism totally transparent from an application point of view.\n          Note: it is highly recommended not to use \"indirect\" with\n          \"prefix\", otherwise server cookie updates would not be sent to\n          clients.\n\nnocache   This option is recommended in conjunction with the insert mode\n          when there is a cache between the client and HAProxy, as it\n          ensures that a cacheable response will be tagged non-cacheable if\n          a cookie needs to be inserted. This is important because if all\n          persistence cookies are added on a cacheable home page for\n          instance, then all customers will then fetch the page from an\n          outer cache and will all share the same persistence cookie,\n          leading to one server receiving much more traffic than others.\n          See also the \"insert\" and \"postonly\" options.\n\npostonly  This option ensures that cookie insertion will only be performed\n          on responses to POST requests. It is an alternative to the\n          \"nocache\" option, because POST responses are not cacheable, so\n          this ensures that the persistence cookie will never get cached.\n          Since most sites do not need any sort of persistence before the\n          first POST which generally is a login request, this is a very\n          efficient method to optimize caching without risking to find a\n          persistence cookie in the cache.\n          See also the \"insert\" and \"nocache\" options.\n\npreserve  This option may only be used with \"insert\" and/or \"indirect\". It\n          allows the server to emit the persistence cookie itself. In this\n          case, if a cookie is found in the response, HAProxy will leave it\n          untouched. This is useful in order to end persistence after a\n          logout request for instance. For this, the server just has to\n          emit a cookie with an invalid value (e.g. empty) or with a date in\n          the past. By combining this mechanism with the \"disable-on-404\"\n          check option, it is possible to perform a completely graceful\n          shutdown because users will definitely leave the server after\n          they logout.\n\nhttponly  This option tells HAProxy to add an \"HttpOnly\" cookie attribute\n          when a cookie is inserted. This attribute is used so that a\n          user agent doesn't share the cookie with non-HTTP components.\n          Please check RFC6265 for more information on this attribute.\n\nsecure    This option tells HAProxy to add a \"Secure\" cookie attribute when\n          a cookie is inserted. This attribute is used so that a user agent\n          never emits this cookie over non-secure channels, which means\n          that a cookie learned with this flag will be presented only over\n          SSL/TLS connections. Please check RFC6265 for more information on\n          this attribute.\n\ndomain    This option allows to specify the domain at which a cookie is\n          inserted. It requires exactly one parameter: a valid domain\n          name. If the domain begins with a dot, the browser is allowed to\n          use it for any host ending with that name. It is also possible to\n          specify several domain names by invoking this option multiple\n          times. Some browsers might have small limits on the number of\n          domains, so be careful when doing that. For the record, sending\n          10 domains to MSIE 6 or Firefox 2 works as expected.\n\nmaxidle   This option allows inserted cookies to be ignored after some idle\n          time. It only works with insert-mode cookies. When a cookie is\n          sent to the client, the date this cookie was emitted is sent too.\n          Upon further presentations of this cookie, if the date is older\n          than the delay indicated by the parameter (in seconds), it will\n          be ignored. Otherwise, it will be refreshed if needed when the\n          response is sent to the client. This is particularly useful to\n          prevent users who never close their browsers from remaining for\n          too long on the same server (e.g. after a farm size change). When\n          this option is set and a cookie has no date, it is always\n          accepted, but gets refreshed in the response. This maintains the\n          ability for admins to access their sites. Cookies that have a\n          date in the future further than 24 hours are ignored. Doing so\n          lets admins fix timezone issues without risking kicking users off\n          the site.\n\nmaxlife   This option allows inserted cookies to be ignored after some life\n          time, whether they're in use or not. It only works with insert\n          mode cookies. When a cookie is first sent to the client, the date\n          this cookie was emitted is sent too. Upon further presentations\n          of this cookie, if the date is older than the delay indicated by\n          the parameter (in seconds), it will be ignored. If the cookie in\n          the request has no date, it is accepted and a date will be set.\n          Cookies that have a date in the future further than 24 hours are\n          ignored. Doing so lets admins fix timezone issues without risking\n          kicking users off the site. Contrary to maxidle, this value is\n          not refreshed, only the first visit date counts. Both maxidle and\n          maxlife may be used at the time. This is particularly useful to\n          prevent users who never close their browsers from remaining for\n          too long on the same server (e.g. after a farm size change). This\n          is stronger than the maxidle method in that it forces a\n          redispatch after some absolute delay.\n\ndynamic   Activate dynamic cookies. When used, a session cookie is\n          dynamically created for each server, based on the IP and port\n          of the server, and a secret key, specified in the\n          \"dynamic-cookie-key\" backend directive.\n          The cookie will be regenerated each time the IP address change,\n          and is only generated for IPv4/IPv6.\n\nattr      This option tells HAProxy to add an extra attribute when a\n          cookie is inserted. The attribute value can contain any\n          characters except control ones or \";\". This option may be\n          repeated.\n```\n\n```\nThere can be only one persistence cookie per HTTP backend, and it can be\ndeclared in a defaults section. The value of the cookie will be the value\nindicated after the \"cookieThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server optionsFetching HTTP samples (Layer 7)\" keyword in a \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" statement. If no cookie\nis declared for a given server, the cookie is not set.\n\n```\n\nExamples :```\n\ncookie JSESSIONID prefix\ncookie SRV insert indirect nocache\ncookie SRV insert postonly indirect\ncookie SRV insert indirect nocache maxidle 30m maxlife 8h\n\n```\n\n**See also :**\"balance source\", \"[capture cookie](#capture%20cookie)\", \"[server](#)- This keyword is available in sections :\n- [Peers declaration](#server%20%28Peers%20declaration%29)\n- [Rings](#server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\" and \"[ignore-persist](#ignore-persist)\".**[declare capture](#4.2-declare%20capture)**[ request | response ]len<length>```\nDeclares a capture slot.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesnoArguments:```\n<length> is the length allowed for the capture.\n```\n\n```\nThis declaration is only available in the frontend or listen section, but the\nreserved slot can be used in the backends. The \"request\" keyword allocates a\ncapture slot for use in the request, and \"response\" allocates a capture slot\nfor use in the response.\n\n```\n\n**See also:**\"[capture-req](#capture-req)\", \"[capture-res](#capture-res)\" (sample converters), \"[capture.req.hdr](#capture.req.hdr)\", \"[capture.res.hdr](#capture.res.hdr)\" (sample fetches), \"http-request capture\" and \"http-response capture\".**[default-server](#4.2-default-server)**[param*]```\nChange default options for a server in a backend\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments:```\n<param*>  is a list of parameters for this server. The \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\"\n          keyword accepts an important number of options and has a complete\n          section dedicated to it. Please refer to section 5 for more\n          details.\n```\n\nExample :```\n\ndefault-server inter 1000 weight 13\n\n```\n\n**See also:**\"[server](#)- This keyword is available in sections :\n- [Peers declaration](#server%20%28Peers%20declaration%29)\n- [Rings](#server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\" and[section 5](#5)about server options**[default_backend](#4.2-default_backend)**<backend>```\nSpecify the backend to use when no \"use_backend\" rule has been matched.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<backend> is the name of the backend to use.\n```\n\n```\nWhen doing content-switching between frontend and backends using the\n\"use_backend\" keyword, it is often useful to indicate which backend will be\nused when no rule has matched. It generally is the dynamic backend which\nwill catch all undetermined requests.\n\n```\n\nExample :```\n\nuse_backend     dynamic  if  url_dyn\nuse_backend     static   if  url_css url_img extension_img\ndefault_backend dynamic\n\n```\n\n**See also :**\"[use_backend](#use_backend)\"**[description](#4.2-description)**<string>```\nDescribe a listen, frontend or backend.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesyesArguments :string```\nAllows to add a sentence to describe the related object in the HAProxy HTML\nstats page. The description will be printed on the right of the object name\nit describes.\nNo need to backslash spaces in the <string> arguments.\n\n```\n\n**[disabled](#4.2-disabled)**```\nDisable a proxy, frontend or backend.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nThe \"disabledThis keyword is available in sections :Peers declarationAlphabetically sorted keywords referenceServer and default-server options\" keyword is used to disable an instance, mainly in order to\nliberate a listening port or to temporarily disable a service. The instance\nwill still be created and its configuration will be checked, but it will be\ncreated in the \"stopped\" state and will appear as such in the statistics. It\nwill not receive any traffic nor will it send any health-checks or logs. It\nis possible to disable many instances at once by adding the \"disabledThis keyword is available in sections :Peers declarationAlphabetically sorted keywords referenceServer and default-server options\"\nkeyword in a \"defaults\" section.\n\n```\n\n**See also :**\"[enabled](#)- This keyword is available in sections :\n- [Peers declaration](#enabled%20%28Peers%20declaration%29)\n- [Alphabetically sorted keywords reference](#enabled%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Server and default-server options](#enabled%20%28Server%20and%20default-server%20options%29)\n\n\"**[dispatch](#4.2-dispatch)**<address>:<port>```\nSet a default server address\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyesArguments :```\n<address> is the IPv4 address of the default server. Alternatively, a\n          resolvable hostname is supported, but this name will be resolved\n          during start-up.\n\n<ports>   is a mandatory port specification. All connections will be sent\n          to this port, and it is not permitted to use port offsets as is\n          possible with normal servers.\n```\n\n```\nThe \"dispatch\" keyword designates a default server for use when no other\nserver can take the connection. In the past it was used to forward non\npersistent connections to an auxiliary load balancer. Due to its simple\nsyntax, it has also been used for simple TCP relays. It is recommended not to\nuse it for more clarity, and to use the \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" directive instead.\n\n```\n\n**See also :**\"[server](#)- This keyword is available in sections :\n- [Peers declaration](#server%20%28Peers%20declaration%29)\n- [Rings](#server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\"**[dynamic-cookie-key](#4.2-dynamic-cookie-key)**<string>```\nSet the dynamic cookie secret key for a backend.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :The secret key to be used.```\nWhen dynamic cookies are enabled (see the \"dynamic\" directive for cookie),\na dynamic cookie is created for each server (unless one is explicitly\nspecified on the \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" line), using a hash of the IP address of the\nserver, the TCP port, and the secret key.\nThat way, we can ensure session persistence across multiple load-balancers,\neven if servers are dynamically added or removed.\n\n```\n\n**[enabled](#4.2-enabled)**```\nEnable a proxy, frontend or backend.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nThe \"enabledThis keyword is available in sections :Peers declarationAlphabetically sorted keywords referenceServer and default-server options\" keyword is used to explicitly enable an instance, when the\ndefaults has been set to \"disabledThis keyword is available in sections :Peers declarationAlphabetically sorted keywords referenceServer and default-server options\". This is very rarely used.\n\n```\n\n**See also :**\"[disabled](#)- This keyword is available in sections :\n- [Peers declaration](#disabled%20%28Peers%20declaration%29)\n- [Alphabetically sorted keywords reference](#disabled%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Server and default-server options](#disabled%20%28Server%20and%20default-server%20options%29)\n\n\"**[errorfile](#4.2-errorfile)**<code><file>```\nReturn a file contents instead of errors generated by HAProxy\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<code>    is the HTTP status code. Currently, HAProxy is capable of\n          generating codes 200, 400, 401, 403, 404, 405, 407, 408, 410,\n          413, 414, 425, 429, 431, 500, 501, 502, 503, and 504.\n\n<file>    designates a file containing the full HTTP response. It is\n          recommended to follow the common practice of appending \".http\" to\n          the filename so that people do not confuse the response with HTML\n          error pages, and to use absolute paths, since files are read\n          before any chroot is performed.\n```\n\n```\nIt is important to understand that this keyword is not meant to rewrite\nerrors returned by the server, but errors detected and returned by HAProxy.\nThis is why the list of supported errors is limited to a small set.\n\nCode 200 is emitted in response to requests matching a \"monitor-uri\" rule.\n\nThe files are parsed when HAProxy starts and must be valid according to the\nHTTP specification. They should not exceed the configured buffer size\n(BUFSIZE), which generally is 16 kB, otherwise an internal error will be\nreturned. It is also wise not to put any reference to local contents\n(e.g. images) in order to avoid loops between the client and HAProxy when all\nservers are down, causing an error to be returned instead of an\nimage. Finally, The response cannot exceed (tune.bufsize - tune.maxrewrite)\nso that \"http-after-response\" rules still have room to operate (see\n\"tune.maxrewrite\").\n\nThe files are read at the same time as the configuration and kept in memory.\nFor this reason, the errors continue to be returned even when the process is\nchrooted, and no file change is considered while the process is running. A\nsimple method for developing those files consists in associating them to the\n403 status code and interrogating a blocked URL.\n\n```\n\n**See also :**\"[http-error](#http-error)\", \"[errorloc](#errorloc)\", \"[errorloc302](#errorloc302)\", \"[errorloc303](#errorloc303)\"Example :```\n\nerrorfile 400 /etc/haproxy/errorfiles/400badreq.http\nerrorfile 408 /dev/null  # work around Chrome pre-connect bug\nerrorfile 403 /etc/haproxy/errorfiles/403forbid.http\nerrorfile 503 /etc/haproxy/errorfiles/503sorry.http\n\n```\n\n**[errorfiles](#4.2-errorfiles)**<name>[<code>...]```\nImport, fully or partially, the error files defined in the <name> http-errors\nsection.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<name>  is the name of an existing http-errors section.\n\n<code>  is a HTTP status code. Several status code may be listed.\n        Currently, HAProxy is capable of generating codes 200, 400, 401,\n        403, 404, 405, 407, 408, 410, 413, 414, 425, 429, 431, 500, 501,\n        502, 503, and 504.\n```\n\n```\nErrors defined in the http-errors section with the name <name> are imported\nin the current proxy. If no status code is specified, all error files of the\nhttp-errors section are imported. Otherwise, only error files associated to\nthe listed status code are imported. Those error files override the already\ndefined custom errors for the proxy. And they may be overridden by following\nones. Functionally, it is exactly the same as declaring all error files by\nhand using \"errorfileThis keyword is available in sections :HTTP-errorsAlphabetically sorted keywords reference\" directives.\n\n```\n\n**See also :**\"[http-error](#http-error)\", \"[errorfile](#)- This keyword is available in sections :\n- [HTTP-errors](#errorfile%20%28HTTP-errors%29)\n- [Alphabetically sorted keywords reference](#errorfile%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[errorloc](#errorloc)\", \"[errorloc302](#errorloc302)\" , \"[errorloc303](#errorloc303)\" and[section 12.4](#12.4)about http-errors.Example :```\n\nerrorfiles generic\nerrorfiles site-1 403 404\n\n```\n\n**[errorloc](#4.2-errorloc)**<code><url>**[errorloc302](#4.2-errorloc302)**<code><url>```\nReturn an HTTP redirection to a URL instead of errors generated by HAProxy\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<code>    is the HTTP status code. Currently, HAProxy is capable of\n          generating codes 200, 400, 401, 403, 404, 405, 407, 408, 410,\n          413, 414, 425, 429, 431, 500, 501, 502, 503, and 504.\n\n<url>     it is the exact contents of the \"Location\" header. It may contain\n          either a relative URI to an error page hosted on the same site,\n          or an absolute URI designating an error page on another site.\n          Special care should be given to relative URIs to avoid redirect\n          loops if the URI itself may generate the same error (e.g. 500).\n```\n\n```\nIt is important to understand that this keyword is not meant to rewrite\nerrors returned by the server, but errors detected and returned by HAProxy.\nThis is why the list of supported errors is limited to a small set.\n\nCode 200 is emitted in response to requests matching a \"monitor-uri\" rule.\n\nNote that both keyword return the HTTP 302 status code, which tells the\nclient to fetch the designated URL using the same HTTP method. This can be\nquite problematic in case of non-GET methods such as POST, because the URL\nsent to the client might not be allowed for something other than GET. To\nwork around this problem, please use \"errorloc303\" which send the HTTP 303\nstatus code, indicating to the client that the URL must be fetched with a GET\nrequest.\n\n```\n\n**See also :**\"[http-error](#http-error)\", \"[errorfile](#)- This keyword is available in sections :\n- [HTTP-errors](#errorfile%20%28HTTP-errors%29)\n- [Alphabetically sorted keywords reference](#errorfile%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[errorloc303](#errorloc303)\"**[errorloc303](#4.2-errorloc303)**<code><url>```\nReturn an HTTP redirection to a URL instead of errors generated by HAProxy\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<code>    is the HTTP status code. Currently, HAProxy is capable of\n          generating codes 200, 400, 401, 403, 404, 405, 407, 408, 410,\n          413, 414, 425, 429, 431, 500, 501, 502, 503, and 504.\n\n<url>     it is the exact contents of the \"Location\" header. It may contain\n          either a relative URI to an error page hosted on the same site,\n          or an absolute URI designating an error page on another site.\n          Special care should be given to relative URIs to avoid redirect\n          loops if the URI itself may generate the same error (e.g. 500).\n```\n\n```\nIt is important to understand that this keyword is not meant to rewrite\nerrors returned by the server, but errors detected and returned by HAProxy.\nThis is why the list of supported errors is limited to a small set.\n\nCode 200 is emitted in response to requests matching a \"monitor-uri\" rule.\n\nNote that both keyword return the HTTP 303 status code, which tells the\nclient to fetch the designated URL using the same HTTP GET method. This\nsolves the usual problems associated with \"errorloc\" and the 302 code. It is\npossible that some very old browsers designed before HTTP/1.1 do not support\nit, but no such problem has been reported till now.\n\n```\n\n**See also :**\"[http-error](#http-error)\", \"[errorfile](#)- This keyword is available in sections :\n- [HTTP-errors](#errorfile%20%28HTTP-errors%29)\n- [Alphabetically sorted keywords reference](#errorfile%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[errorloc](#errorloc)\", \"[errorloc302](#errorloc302)\"**[email-alert from](#4.2-email-alert%20from)**<emailaddr>```\nDeclare the from email address to be used in both the envelope and header\nof email alerts. This is the address that email alerts are sent from.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<emailaddr> is the from email address to use when sending email alerts\n```\n\n```\nAlso requires \"email-alert mailers\" and \"email-alert to\" to be set\nand if so sending email alerts is enabled for the proxy.\n\n```\n\n**See also :**\"[email-alert level](#email-alert%20level)\", \"[email-alert mailers](#email-alert%20mailers)\", \"[email-alert myhostname](#email-alert%20myhostname)\", \"[email-alert to](#email-alert%20to)\",[section 12.3](#12.3)about mailers.**[email-alert level](#4.2-email-alert%20level)**<level>```\nDeclare the maximum log level of messages for which email alerts will be\nsent. This acts as a filter on the sending of email alerts.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<level> One of the 8 syslog levels:\n          emerg alert crit err warning notice info  debug\n        The above syslog levels are ordered from lowest to highest.\n```\n\n```\nBy default level is alert\n\nAlso requires \"email-alert from\", \"email-alert mailers\" and\n\"email-alert to\" to be set and if so sending email alerts is enabled\nfor the proxy.\n\nAlerts are sent when :\n\n* An un-paused server is marked as down and <level> is alert or lower\n* A paused server is marked as down and <level> is notice or lower\n* A server is marked as up or enters the drain state and <level>\n  is notice or lower\n* \"option log-health-checks\" is enabled, <level> is info or lower,\n   and a health check status update occurs\n\n```\n\n**See also :**\"[email-alert from](#email-alert%20from)\", \"[email-alert mailers](#email-alert%20mailers)\", \"[email-alert myhostname](#email-alert%20myhostname)\", \"[email-alert to](#email-alert%20to)\",[section 12.3](#12.3)about mailers.**[email-alert mailers](#4.2-email-alert%20mailers)**<mailersect>```\nDeclare the mailers to be used when sending email alerts\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<mailersect> is the name of the mailers section to send email alerts.\n```\n\n```\nAlso requires \"email-alert from\" and \"email-alert to\" to be set\nand if so sending email alerts is enabled for the proxy.\n\n```\n\n**See also :**\"[email-alert from](#email-alert%20from)\", \"[email-alert level](#email-alert%20level)\", \"[email-alert myhostname](#email-alert%20myhostname)\", \"[email-alert to](#email-alert%20to)\",[section 12.3](#12.3)about mailers.**[email-alert myhostname](#4.2-email-alert%20myhostname)**<hostname>```\nDeclare the to hostname address to be used when communicating with\nmailers.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<hostname> is the hostname to use when communicating with mailers\n```\n\n```\nBy default the systems hostname is used.\n\nAlso requires \"email-alert from\", \"email-alert mailers\" and\n\"email-alert to\" to be set and if so sending email alerts is enabled\nfor the proxy.\n\n```\n\n**See also :**\"[email-alert from](#email-alert%20from)\", \"[email-alert level](#email-alert%20level)\", \"[email-alert mailers](#email-alert%20mailers)\", \"[email-alert to](#email-alert%20to)\",[section 12.3](#12.3)about mailers.**[email-alert to](#4.2-email-alert%20to)**<emailaddr>```\nDeclare both the recipient address in the envelope and to address in the\nheader of email alerts. This is the address that email alerts are sent to.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<emailaddr> is the to email address to use when sending email alerts\n```\n\n```\nAlso requires \"email-alert mailers\" and \"email-alert to\" to be set\nand if so sending email alerts is enabled for the proxy.\n\n```\n\n**See also :**\"[email-alert from](#email-alert%20from)\", \"[email-alert level](#email-alert%20level)\", \"[email-alert mailers](#email-alert%20mailers)\", \"[email-alert myhostname](#email-alert%20myhostname)\",[section 12.3](#12.3)about mailers.**[error-log-format](#4.2-error-log-format)**<fmt>```\nSpecifies the log format string to use in case of connection error on the frontend side.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesno```\nThis directive specifies the log format string that will be used for logs\ncontaining information related to errors, timeouts, retries redispatches or\nHTTP status code 5xx. This format will in short be used for every log line\nthat would be concerned by the \"log-separate-errors\" option, including\nconnection errors described in section 8.2.5.\n\nIf the directive is used in a defaults section, all subsequent frontends will\nuse the same log format. Please see section 8.2.6 which covers the custom log\nformat string in depth.\n\n\"error-log-format\" directive overrides previous \"error-log-format\"\ndirectives.\n\n```\n\n**[force-persist](#4.2-force-persist)**{ if | unless }<condition>```\nDeclare a condition to force persistence on down servers\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyes```\nBy default, requests are not dispatched to down servers. It is possible to\nforce this using \"option persist\", but it is unconditional and redispatches\nto a valid server if \"option redispatch\" is set. That leaves with very little\npossibilities to force some requests to reach a server which is artificially\nmarked down for maintenance operations.\n\nThe \"force-persist\" statement allows one to declare various ACL-based\nconditions which, when met, will cause a request to ignore the down status of\na server and still try to connect to it. That makes it possible to start a\nserver, still replying an error to the health checks, and run a specially\nconfigured browser to test the service. Among the handy methods, one could\nuse a specific source IP address, or a specific cookie. The cookie also has\nthe advantage that it can easily be added/removed on the browser from a test\npage. Once the service is validated, it is then possible to open the service\nto the world by returning a valid response to health checks.\n\nThe forced persistence is enabled when an \"if\" condition is met, or unless an\n\"unless\" condition is met. The final redispatch is always disabled when this\nis used.\n\n```\n\n**See also :**\"[option redispatch](#option%20redispatch)\", \"[ignore-persist](#ignore-persist)\", \"[persist](#option%20persist)\", and[section 7](#7)about ACL usage.**[filter](#4.2-filter)**<name>[param*]```\nAdd the filter <name> in the filter list attached to the proxy.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesyesArguments :```\n<name>     is the name of the filter. Officially supported filters are\n           referenced in section 9.\n\n<param*>   is a list of parameters accepted by the filter <name>. The\n           parsing of these parameters are the responsibility of the\n           filter. Please refer to the documentation of the corresponding\n           filter (section 9) for all details on the supported parameters.\n```\n\n```\nMultiple occurrences of the filter line can be used for the same proxy. The\nsame filter can be referenced many times if needed.\n\n```\n\nExample:```\n\nlisten\n  bind *:80\n\n  filter trace name BEFORE-HTTP-COMP\n  filter compression\n  filter trace name AFTER-HTTP-COMP\n\n  compression algo gzip\n  compression offload\n\n  server srv1 192.168.0.1:80\n\n```\n\n**See also :**[section 9](#9).**[fullconn](#4.2-fullconn)**<conns>```\nSpecify at what backend load the servers will reach their maxconn\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<conns>   is the number of connections on the backend which will make the\n          servers use the maximal number of connections.\n```\n\n```\nWhen a server has a \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" parameter specified, it means that its number\nof concurrent connections will never go higher. Additionally, if it has a\n\"minconn\" parameter, it indicates a dynamic limit following the backend's\nload. The server will then always accept at least <minconn> connections,\nnever more than <maxconn>, and the limit will be on the ramp between both\nvalues when the backend has less than <conns> concurrent connections. This\nmakes it possible to limit the load on the servers during normal loads, but\npush it further for important loads without overloading the servers during\nexceptional loads.\n\nSince it's hard to get this value right, HAProxy automatically sets it to\n10% of the sum of the maxconns of all frontends that may branch to this\nbackend (based on \"use_backend\" and \"default_backend\" rules). That way it's\nsafe to leave it unset. However, \"use_backend\" involving dynamic names are\nnot counted since there is no way to know if they could match or not.\n\n```\n\nExample :```\n\n# The servers will accept between 100 and 1000 concurrent connections each\n# and the maximum of 1000 will be reached when the backend reaches 10000\n# connections.\nbackend dynamic\n   fullconn   10000\n   server     srv1   dyn1:80 minconn 100 maxconn 1000\n   server     srv2   dyn2:80 minconn 100 maxconn 1000\n\n```\n\n**See also :**\"[maxconn](#)- This keyword is available in sections :\n- [Log forwarding](#maxconn%20%28Log%20forwarding%29)\n- [Performance tuning](#maxconn%20%28Performance%20tuning%29)\n- [Alphabetically sorted keywords reference](#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Bind options](#maxconn%20%28Bind%20options%29)\n- [Server and default-server options](#maxconn%20%28Server%20and%20default-server%20options%29)\n\n\", \"[server](#)- This keyword is available in sections :\n- [Peers declaration](#server%20%28Peers%20declaration%29)\n- [Rings](#server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\"**[guid](#4.2-guid)**<string>```\nSpecify a case-sensitive global unique ID for this proxy.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesyes```\n<string> must be unique across all haproxy configuration on every object\ntypes. Format is left unspecified to allow the user to select its naming\npolicy. The only restriction is its length which cannot be greater than\n127 characters. All alphanumerical values and '.', ':', '-' and '_'\ncharacters are valid.\n\n```\n\n**[hash-balance-factor](#4.2-hash-balance-factor)**<factor>```\nSpecify the balancing factor for bounded-load consistent hashing\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnonoyesArguments :```\n<factor> is the control for the maximum number of concurrent requests to\n         send to a server, expressed as a percentage of the average number\n         of concurrent requests across all of the active servers.\n```\n\n```\nSpecifying a \"hash-balance-factor\" for a server with \"hash-type consistent\"\nenables an algorithm that prevents any one server from getting too many\nrequests at once, even if some hash buckets receive many more requests than\nothers. Setting <factor> to 0 (the default) disables the feature. Otherwise,\n<factor> is a percentage greater than 100. For example, if <factor> is 150,\nthen no server will be allowed to have a load more than 1.5 times the average.\nIf server weights are used, they will be respected.\n\nIf the first-choice server is disqualified, the algorithm will choose another\nserver based on the request hash, until a server with additional capacity is\nfound. A higher <factor> allows more imbalance between the servers, while a\nlower <factor> means that more servers will be checked on average, affecting\nperformance. Reasonable values are from 125 to 200.\n\nThis setting is also used by \"balance random\" which internally relies on the\nconsistent hashing mechanism.\n\n```\n\n**See also :**\"[balance](#balance)\" and \"[hash-type](#hash-type)\".**[hash-preserve-affinity](#4.2-hash-preserve-affinity)**{ always | maxconn | maxqueue }```\nSpecify a method for assigning streams to servers with hash load balancing\nwhen servers are satured or have a full queue.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyes```\nThe following values can be specified:\n\n  - \"always\"   : this is the default strategy. A stream is assigned to a\n                 server based on hashing irrespective of whether the server\n                 is currently saturated.\n\n  - \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\"  : when selected, servers that have \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" set and are\n                 currently saturated will be skipped. Another server will be\n                 picked by following the hashing ring. This has no effect on\n                 servers that do not set \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\". If all servers are\n                 saturated, the request is enqueued to the last server in the\n                 hash ring before the initially selected server.\n\n  - \"maxqueue\" : when selected, servers that have \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" set, \"maxqueue\"\n                 set to a non-zero value (limited queue size) and currently\n                 have a full queue will be skipped. Another server will be\n                 picked by following the hashing ring. This has no effect on\n                 servers that do not set both \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" and \"maxqueue\".\n\n```\n\n**See also :**\"[maxconn](#)- This keyword is available in sections :\n- [Log forwarding](#maxconn%20%28Log%20forwarding%29)\n- [Performance tuning](#maxconn%20%28Performance%20tuning%29)\n- [Alphabetically sorted keywords reference](#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Bind options](#maxconn%20%28Bind%20options%29)\n- [Server and default-server options](#maxconn%20%28Server%20and%20default-server%20options%29)\n\n\", \"[maxqueue](#maxqueue)\", \"[hash-balance-factor](#hash-balance-factor)\"**[hash-type](#4.2-hash-type)**<method><function><modifier>```\nSpecify a method to use for mapping hashes to servers\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<method> is the method used to select a server from the hash computed by\n         the <function> :\n\n  map-based   the hash table is a static array containing all alive servers.\n              The hashes will be very smooth, will consider weights, but\n              will be static in that weight changes while a server is up\n              will be ignored. This means that there will be no slow start.\n              Also, since a server is selected by its position in the array,\n              most mappings are changed when the server count changes. This\n              means that when a server goes up or down, or when a server is\n              added to a farm, most connections will be redistributed to\n              different servers. This can be inconvenient with caches for\n              instance.\n\n  consistent  the hash table is a tree filled with many occurrences of each\n              server. The hash key is looked up in the tree and the closest\n              server is chosen. This hash is dynamic, it supports changing\n              weights while the servers are up, so it is compatible with the\n              slow start feature. It has the advantage that when a server\n              goes up or down, only its associations are moved. When a\n              server is added to the farm, only a few part of the mappings\n              are redistributed, making it an ideal method for caches.\n              However, due to its principle, the distribution will never be\n              very smooth and it may sometimes be necessary to adjust a\n              server's weight or its ID to get a more balanced distribution.\n              In order to get the same distribution on multiple load\n              balancers, it is important that all servers have the exact\n              same IDs. Note: consistent hash uses sdbm and avalanche if no\n              hash function is specified.\n\n<function> is the hash function to be used :\n\n   sdbm   this function was created initially for sdbm (a public-domain\n          reimplementation of ndbm) database library. It was found to do\n          well in scrambling bits, causing better distribution of the keys\n          and fewer splits. It also happens to be a good general hashing\n          function with good distribution, unless the total server weight\n          is a multiple of 64, in which case applying the avalanche\n          modifier may help.\n\n   djb2   this function was first proposed by Dan Bernstein many years ago\n          on comp.lang.c. Studies have shown that for certain workload this\n          function provides a better distribution than sdbm. It generally\n          works well with text-based inputs though it can perform extremely\n          poorly with numeric-only input or when the total server weight is\n          a multiple of 33, unless the avalanche modifier is also used.\n\n   wt6    this function was designed for HAProxy while testing other\n          functions in the past. It is not as smooth as the other ones, but\n          is much less sensible to the input data set or to the number of\n          servers. It can make sense as an alternative to sdbm+avalanche or\n          djb2+avalanche for consistent hashing or when hashing on numeric\n          data such as a source IP address or a visitor identifier in a URL\n          parameter.\n\n   crc32  this is the most common CRC32 implementation as used in Ethernet,\n          gzip, PNG, etc. It is slower than the other ones but may provide\n          a better distribution or less predictable results especially when\n          used on strings.\n\n   none   don't hash the key, the key will be used as a hash, this can be\n          useful to manually hash the key using a converter for that purpose\n          and let haproxy use the result directly.\n\n<modifier> indicates an optional method applied after hashing the key :\n\n   avalanche   This directive indicates that the result from the hash\n               function above should not be used in its raw form but that\n               a 4-byte full avalanche hash must be applied first. The\n               purpose of this step is to mix the resulting bits from the\n               previous hash in order to avoid any undesired effect when\n               the input contains some limited values or when the number of\n               servers is a multiple of one of the hash's components (64\n               for SDBM, 33 for DJB2). Enabling avalanche tends to make the\n               result less predictable, but it's also not as smooth as when\n               using the original function. Some testing might be needed\n               with some workloads. This hash is one of the many proposed\n               by Bob Jenkins.\n```\n\n```\nThe default hash type is \"map-based\" and is recommended for most usages. The\ndefault function is \"sdbm\", the selection of a function should be based on\nthe range of the values being hashed.\n\n```\n\n**See also :**\"[balance](#balance)\", \"[hash-balance-factor](#hash-balance-factor)\", \"[hash-preserve-affinity](#hash-preserve-affinity)\", \"[server](#)- This keyword is available in sections :\n- [Peers declaration](#server%20%28Peers%20declaration%29)\n- [Rings](#server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\"**[http-after-response](#4.2-http-after-response)**<action><options...>[{ if | unless }<condition>]```\nAccess control for all Layer 7 responses (server, applet/service and internal\nones).\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyes(!)yesyesyes```\nThe http-after-response statement defines a set of rules which apply to layer\n7 processing. The rules are evaluated in their declaration order when they\nare met in a frontend, listen or backend section. Since these rules apply on\nresponses, the backend rules are applied first, followed by the frontend's\nrules. Any rule may optionally be followed by an ACL-based condition, in\nwhich case it will only be evaluated if the condition evaluates true.\n\nUnlike http-response rules, these ones are applied on all responses, the\nserver ones but also to all responses generated by HAProxy. These rules are\nevaluated at the end of the responses analysis, before the data forwarding\nphase.\n\nThe condition is evaluated just before the action is executed, and the action\nis performed exactly once. As such, there is no problem if an action changes\nan element which is checked as part of the condition. This also means that\nmultiple actions may rely on the same condition so that the first action that\nchanges the condition's evaluation is sufficient to implicitly disable the\nremaining actions. This is used for example when trying to assign a value to\na variable from various sources when it's empty. There is no limit to the\nnumber of \"http-after-response\" statements per instance.\n\nThe first keyword after \"http-after-response\" in the syntax is the rule's\naction, optionally followed by a varying number of arguments for the action.\nThe supported actions and their respective syntaxes are enumerated in section\n4.3 \"Actions\" (look for actions which tick \"HTTP Aft\").\n\nThis directive is only available from named defaults sections, not anonymous\nones. Rules defined in the defaults section are evaluated before ones in the\nassociated proxy section. To avoid ambiguities, in this case the same\ndefaults section cannot be used by proxies with the frontend capability and\nby proxies with the backend capability. It means a listen section cannot use\na defaults section defining such rules.\n\nNote: Errors emitted in early stage of the request parsing are handled by the\n      multiplexer at a lower level, before any http analysis. Thus no\n      http-after-response ruleset is evaluated on these errors.\n\n```\n\nExample:```\n\nhttp-after-response set-header Strict-Transport-Security \"max-age=31536000\"\nhttp-after-response set-header Cache-Control \"no-store,no-cache,private\"\nhttp-after-response set-header Pragma \"no-cache\"\n\n```\n\n**[http-check comment](#4.2-http-check%20comment)**<string>```\nDefines a comment for the following the http-check rule, reported in logs if\nit fails.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<string>  is the comment message to add in logs if the following http-check\n          rule fails.\n```\n\n```\nIt only works for connect, send and expect rules. It is useful to make\nuser-friendly error reporting.\n\n```\n\n**See also :**\"[option httpchk](#option%20httpchk)\", \"[http-check connect](#http-check%20connect)\", \"[http-check send](#http-check%20send)\" and \"[http-check expect](#http-check%20expect)\".**[http-check connect](#4.2-http-check%20connect)**[default][port<expr>][addr<ip>][send-proxy][via-socks4][ssl][sni<sni>][alpn<alpn>][linger][proto<name>][comment<msg>]```\nOpens a new connection to perform an HTTP health check\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\ncomment <msg>  defines a message to report if the rule evaluation fails.\n\ndefault      Use default options of the server line to do the health\n             checks. The server options are used only if not redefined.\n\nport <expr>  if not set, check port or server port is used.\n             It tells HAProxy where to open the connection to.\n             <port> must be a valid TCP port source integer, from 1 to\n             65535 or an sample-fetch expression.\n\naddr <ip>    defines the IP address to do the health check.\n\nsend-proxy   send a PROXY protocol string\n\nvia-socks4   enables outgoing health checks using upstream socks4 proxy.\n\nssl          opens a ciphered connection\n\nsni <sni>    specifies the SNI to use to do health checks over SSL.\n\nalpn <alpn>  defines which protocols to advertise with ALPN. The protocol\n             list consists in a comma-delimited list of protocol names,\n             for instance: \"h2,http/1.1\". If it is not set, the server ALPN\n             is used.\n\nproto <name> forces the multiplexer's protocol to use for this connection.\n             It must be an HTTP mux protocol and it must be usable on the\n             backend side. The list of available protocols is reported in\n             haproxy -vv.\n\nlinger       cleanly close the connection instead of using a single RST.\n```\n\n```\nJust like tcp-check health checks, it is possible to configure the connection\nto use to perform HTTP health check. This directive should also be used to\ndescribe a scenario involving several request/response exchanges, possibly on\ndifferent ports or with different servers.\n\nWhen there are no TCP port configured on the server line neither server port\ndirective, then the first step of the http-check sequence must be to specify\nthe port with a \"http-check connect\".\n\nIn an http-check ruleset a 'connect' is required, it is also mandatory to start\nthe ruleset with a 'connect' rule. Purpose is to ensure admin know what they\ndo.\n\nWhen a connect must start the ruleset, if may still be preceded by set-var,\nunset-var or comment rules.\n\n```\n\nExamples :```\n\n# check HTTP and HTTPs services on a server.\n# first open port 80 thanks to server line port directive, then\n# tcp-check opens port 443, ciphered and run a request on it:\noption httpchk\n\nhttp-check connect\nhttp-check send meth GET uri / ver HTTP/1.1 hdr host haproxy.1wt.eu\nhttp-check expect status 200-399\nhttp-check connect port 443 ssl sni haproxy.1wt.eu\nhttp-check send meth GET uri / ver HTTP/1.1 hdr host haproxy.1wt.eu\nhttp-check expect status 200-399\n\nserver www 10.0.0.1 check port 80\n\n```\n\n**See also :**\"[option httpchk](#option%20httpchk)\", \"[http-check send](#http-check%20send)\", \"[http-check expect](#http-check%20expect)\"**[http-check disable-on-404](#4.2-http-check%20disable-on-404)**```\nEnable a maintenance mode upon HTTP/404 response to health-checks\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nWhen this option is set, a server which returns an HTTP code 404 will be\nexcluded from further load-balancing, but will still receive persistent\nconnections. This provides a very convenient method for Web administrators\nto perform a graceful shutdown of their servers. It is also important to note\nthat a server which is detected as failed while it was in this mode will not\ngenerate an alert, just a notice. If the server responds 2xx or 3xx again, it\nwill immediately be reinserted into the farm. The status on the stats page\nreports \"NOLB\" for a server in this mode. It is important to note that this\noption only works in conjunction with the \"httpchk\" option. If this option\nis used with \"http-check expect\", then it has precedence over it so that 404\nresponses will still be considered as soft-stop. Note also that a stopped\nserver will stay stopped even if it replies 404s. This option is only\nevaluated for running servers.\n\n```\n\n**See also :**\"[option httpchk](#option%20httpchk)\" and \"[http-check expect](#http-check%20expect)\".**[http-check expect](#4.2-http-check%20expect)**[min-recv<int>][comment<msg>][ok-status<st>][error-status<st>][tout-status<st>][on-success<fmt>][on-error<fmt>][status-code<expr>][!]<match><pattern>```\nMake HTTP health checks consider response contents or specific status codes\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\ncomment <msg>  defines a message to report if the rule evaluation fails.\n\nmin-recv  is optional and can define the minimum amount of data required to\n          evaluate the current expect rule. If the number of received bytes\n          is under this limit, the check will wait for more data. This\n          option can be used to resolve some ambiguous matching rules or to\n          avoid executing costly regex matches on content known to be still\n          incomplete. If an exact string is used, the minimum between the\n          string length and this parameter is used. This parameter is\n          ignored if it is set to -1. If the expect rule does not match,\n          the check will wait for more data. If set to 0, the evaluation\n          result is always conclusive.\n\nok-status <st>     is optional and can be used to set the check status if\n                   the expect rule is successfully evaluated and if it is\n                   the last rule in the tcp-check ruleset. \"L7OK\", \"L7OKC\",\n                   \"L6OK\" and \"L4OK\" are supported :\n                     - L7OK  : check passed on layer 7\n                     - L7OKC : check conditionally passed on layer 7, set\n                               server to NOLB state.\n                     - L6OK  : check passed on layer 6\n                     - L4OK  : check passed on layer 4\n                   By default \"L7OK\" is used.\n\nerror-status <st>  is optional and can be used to set the check status if\n                   an error occurred during the expect rule evaluation.\n                   \"L7OKC\", \"L7RSP\", \"L7STS\", \"L6RSP\" and \"L4CON\" are\n                   supported :\n                     - L7OKC : check conditionally passed on layer 7, set\n                               server to NOLB state.\n                     - L7RSP : layer 7 invalid response - protocol error\n                     - L7STS : layer 7 response error, for example HTTP 5xx\n                     - L6RSP : layer 6 invalid response - protocol error\n                     - L4CON : layer 1-4 connection problem\n                   By default \"L7RSP\" is used.\n\ntout-status <st>   is optional and can be used to set the check status if\n                   a timeout occurred during the expect rule evaluation.\n                   \"L7TOUT\", \"L6TOUT\", and \"L4TOUT\" are supported :\n                     - L7TOUT : layer 7 (HTTP/SMTP) timeout\n                     - L6TOUT : layer 6 (SSL) timeout\n                     - L4TOUT : layer 1-4 timeout\n                   By default \"L7TOUT\" is used.\n\non-success <fmt>   is optional and can be used to customize the\n                   informational message reported in logs if the expect\n                   rule is successfully evaluated and if it is the last rule\n                   in the tcp-check ruleset. <fmt> is a Custom log format\n                   string (see section 8.2.6).\n\non-error <fmt>     is optional and can be used to customize the\n                   informational message reported in logs if an error\n                   occurred during the expect rule evaluation. <fmt> is a\n                   Custom log format string (see section 8.2.6).\n\n<match>   is a keyword indicating how to look for a specific pattern in the\n          response. The keyword may be one of \"status\", \"rstatus\", \"hdr\",\n          \"fhdr\", \"string\", or \"rstring\". The keyword may be preceded by an\n          exclamation mark (\"!\") to negate the match. Spaces are allowed\n          between the exclamation mark and the keyword. See below for more\n          details on the supported keywords.\n\n<pattern> is the pattern to look for. It may be a string, a regular\n          expression or a more complex pattern with several arguments. If\n          the string pattern contains spaces, they must be escaped with the\n          usual backslash ('\\').\n```\n\n```\nBy default, \"option httpchk\" considers that response statuses 2xx and 3xx\nare valid, and that others are invalid. When \"http-check expect\" is used,\nit defines what is considered valid or invalid. Only one \"http-check\"\nstatement is supported in a backend. If a server fails to respond or times\nout, the check obviously fails. The available matches are :\n\n  status <codes> :  test the status codes found parsing <codes> string. it\n                    must be a comma-separated list of status codes or range\n                    codes. A health check response will be considered as\n                    valid if the response's status code matches any status\n                    code or is inside any range of the list. If the \"status\"\n                    keyword is prefixed with \"!\", then the response will be\n                    considered invalid if the status code matches.\n\n  rstatus <regex> : test a regular expression for the HTTP status code.\n                    A health check response will be considered valid if the\n                    response's status code matches the expression. If the\n                    \"rstatus\" keyword is prefixed with \"!\", then the response\n                    will be considered invalid if the status code matches.\n                    This is mostly used to check for multiple codes.\n\n  hdr  { name | name-lf } [ -m <meth> ] <name>\n       [ { value | value-lf } [ -m <meth> ] <value> :\n                    test the specified header pattern on the HTTP response\n                    headers. The name pattern is mandatory but the value\n                    pattern is optional. If not specified, only the header\n                    presence is verified. <meth> is the matching method,\n                    applied on the header name or the header value. Supported\n                    matching methods are \"str\" (exact match), \"beg\" (prefix\n                    match), \"end\" (suffix match), \"sub\" (substring match) or\n                    \"reg\" (regex match). If not specified, exact matching\n                    method is used. If the \"name-lf\" parameter is used,\n                    <name> is evaluated as a Custom log format string (see\n                    section 8.2.6). If \"value-lf\" parameter is used, <value>\n                    is evaluated as a log-format string. These parameters\n                    cannot be used with the regex matching method. Finally,\n                    the header value is considered as comma-separated\n                    list. Note that matchings are case insensitive on the\n                    header names.\n\n  fhdr { name | name-lf } [ -m <meth> ] <name>\n       [ { value | value-lf } [ -m <meth> ] <value> :\n                    test the specified full header pattern on the HTTP\n                    response headers. It does exactly the same as the \"hdr\"\n                    keyword, except the full header value is tested, commas\n                    are not considered as delimiters.\n\n  string <string> : test the exact string match in the HTTP response body.\n                    A health check response will be considered valid if the\n                    response's body contains this exact string. If the\n                    \"string\" keyword is prefixed with \"!\", then the response\n                    will be considered invalid if the body contains this\n                    string. This can be used to look for a mandatory word at\n                    the end of a dynamic page, or to detect a failure when a\n                    specific error appears on the check page (e.g. a stack\n                    trace).\n\n  rstring <regex> : test a regular expression on the HTTP response body.\n                    A health check response will be considered valid if the\n                    response's body matches this expression. If the \"rstring\"\n                    keyword is prefixed with \"!\", then the response will be\n                    considered invalid if the body matches the expression.\n                    This can be used to look for a mandatory word at the end\n                    of a dynamic page, or to detect a failure when a specific\n                    error appears on the check page (e.g. a stack trace).\n\n  string-lf <fmt> : test a Custom log format string (see section 8.2.6) match\n                    in the HTTP response body. A health check response will\n                    be considered valid if the response's body contains the\n                    string resulting of the evaluation of <fmt>, which\n                    follows the log-format rules. If prefixed with \"!\", then\n                    the response will be considered invalid if the body\n                    contains the string.\n\nIt is important to note that the responses will be limited to a certain size\ndefined by the global \"tune.bufsize\" option, which defaults to 16384 bytes.\nThus, too large responses may not contain the mandatory pattern when using\n\"string\" or \"rstring\". If a large response is absolutely required, it is\npossible to change the default max size by setting the global variable.\nHowever, it is worth keeping in mind that parsing very large responses can\nwaste some CPU cycles, especially when regular expressions are used, and that\nit is always better to focus the checks on smaller resources.\n\nIn an http-check ruleset, the last expect rule may be implicit. If no expect\nrule is specified after the last \"http-check send\", an implicit expect rule\nis defined to match on 2xx or 3xx status codes. It means this rule is also\ndefined if there is no \"http-check\" rule at all, when only \"option httpchk\"\nis set.\n\nLast, if \"http-check expect\" is combined with \"http-check disable-on-404\",\nthen this last one has precedence when the server responds with 404.\n\n```\n\nExamples :```\n\n# only accept status 200 as valid\nhttp-check expect status 200,201,300-310\n\n# be sure a sessid coookie is set\nhttp-check expect header name \"set-cookie\" value -m beg \"sessid=\"\n\n# consider SQL errors as errors\nhttp-check expect ! string SQL\\ Error\n\n# consider status 5xx only as errors\nhttp-check expect ! rstatus ^5\n\n# check that we have a correct hexadecimal tag before /html\nhttp-check expect rstring <!--tag:[0-9a-f]*--></html>\n\n```\n\n**See also :**\"[option httpchk](#option%20httpchk)\", \"[http-check connect](#http-check%20connect)\", \"[http-check disable-on-404](#http-check%20disable-on-404)\" and \"[http-check send](#http-check%20send)\".**[http-check send](#4.2-http-check%20send)**[meth<method>][{ uri<uri>| uri-lf<fmt>}>][ver<version>][hdr<name><fmt>]*[{ body<string>| body-lf<fmt>}][comment<msg>]```\nAdd a possible list of headers and/or a body to the request sent during HTTP\nhealth checks.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\ncomment <msg>  defines a message to report if the rule evaluation fails.\n\nmeth <method>  is the optional HTTP method used with the requests. When not\n               set, the \"OPTIONS\" method is used, as it generally requires\n               low server processing and is easy to filter out from the\n               logs. Any method may be used, though it is not recommended\n               to invent non-standard ones.\n\nuri <uri>      is optional and set the URI referenced in the HTTP requests\n               to the string <uri>. It defaults to \"/\" which is accessible\n               by default on almost any server, but may be changed to any\n               other URI. Query strings are permitted.\n\nuri-lf <fmt>   is optional and set the URI referenced in the HTTP requests\n               using the Custom log format <fmt> (see section 8.2.6). It\n               defaults to \"/\" which is accessible by default on almost any\n               server, but may be changed to any other URI. Query strings\n               are permitted.\n\nver <version>  is the optional HTTP version string. It defaults to\n               \"HTTP/1.0\" but some servers might behave incorrectly in HTTP\n               1.0, so turning it to HTTP/1.1 may sometimes help. Note that\n               the Host field is mandatory in HTTP/1.1, use \"hdr\" argument\n               to add it.\n\nhdr <name> <fmt>  adds the HTTP header field whose name is specified in\n                  <name> and whose value is defined by <fmt>, which follows\n                  the Custom log format rules described in section 8.2.6.\n\nbody <string>  add the body defined by <string> to the request sent during\n               HTTP health checks. If defined, the \"Content-Length\" header\n               is thus automatically added to the request.\n\nbody-lf <fmt>  add the body defined by the Custom log format <fmt> (see\n               section 8.2.6) to the request sent during HTTP health\n               checks. If defined, the \"Content-Length\" header is thus\n               automatically added to the request.\n```\n\n```\nIn addition to the request line defined by the \"option httpchk\" directive,\nthis one is the valid way to add some headers and optionally a body to the\nrequest sent during HTTP health checks. If a body is defined, the associate\n\"Content-Length\" header is automatically added. Thus, this header or\n\"Transfer-encoding\" header should not be present in the request provided by\n\"http-check send\". If so, it will be ignored. The old trick consisting to add\nheaders after the version string on the \"option httpchk\" line is now\ndeprecated.\n\nAlso \"http-check send\" doesn't support HTTP keep-alive. Keep in mind that it\nwill automatically append a \"Connection: close\" header, unless a Connection\nheader has already already been configured via a hdr entry.\n\nNote that the Host header and the request authority, when both defined, are\nautomatically synchronized. It means when the HTTP request is sent, when a\nHost is inserted in the request, the request authority is accordingly\nupdated. Thus, don't be surprised if the Host header value overwrites the\nconfigured request authority.\n\nNote also for now, no Host header is automatically added in HTTP/1.1 or above\nrequests. You should add it explicitly.\n\n```\n\n**See also :**\"[option httpchk](#option%20httpchk)\", \"[http-check send-state](#http-check%20send-state)\" and \"[http-check expect](#http-check%20expect)\".**[http-check send-state](#4.2-http-check%20send-state)**```\nEnable emission of a state header with HTTP health checks\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nWhen this option is set, HAProxy will systematically send a special header\n\"X-Haproxy-Server-State\" with a list of parameters indicating to each server\nhow they are seen by HAProxy. This can be used for instance when a server is\nmanipulated without access to HAProxy and the operator needs to know whether\nHAProxy still sees it up or not, or if the server is the last one in a farm.\n\nThe header is composed of fields delimited by semi-colons, the first of which\nis a word (\"UP\", \"DOWN\", \"NOLB\"), possibly followed by a number of valid\nchecks on the total number before transition, just as appears in the stats\ninterface. Next headers are in the form \"<variable>=<value>\", indicating in\nno specific order some values available in the stats interface :\n  - a variable \"address\", containing the address of the backend server.\n    This corresponds to the <address> field in the server declaration. For\n    unix domain sockets, it will read \"unix\".\n\n  - a variable \"port\", containing the port of the backend server. This\n    corresponds to the <port> field in the server declaration. For unix\n    domain sockets, it will read \"unix\".\n\n  - a variable \"name\", containing the name of the backend followed by a slash\n    (\"/\") then the name of the server. This can be used when a server is\n    checked in multiple backends.\n\n  - a variable \"node\" containing the name of the HAProxy node, as set in the\n    global \"node\" variable, otherwise the system's hostname if unspecified.\n\n  - a variable \"weight\" indicating the weight of the server, a slash (\"/\")\n    and the total weight of the farm (just counting usable servers). This\n    helps to know if other servers are available to handle the load when this\n    one fails.\n\n  - a variable \"scur\" indicating the current number of concurrent connections\n    on the server, followed by a slash (\"/\") then the total number of\n    connections on all servers of the same backend.\n\n  - a variable \"qcur\" indicating the current number of requests in the\n    server's queue.\n\nExample of a header received by the application server :\n  >>>  X-Haproxy-Server-State: UP 2/3; name=bck/srv2; node=lb1; weight=1/2; \\\n         scur=13/22; qcur=0\n\n```\n\n**See also :**\"[option httpchk](#option%20httpchk)\", \"[http-check disable-on-404](#http-check%20disable-on-404)\" and \"[http-check send](#http-check%20send)\".**[http-check set-var](#4.2-http-check%20set-var)**(<var-name>[,<cond>...])<expr>**[http-check set-var-fmt](#4.2-http-check%20set-var-fmt)**(<var-name>[,<cond>...])<fmt>```\nThis operation sets the content of a variable. The variable is declared inline.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<var-name>   The name of the variable. Only \"proc\", \"sess\" and \"check\"\n             scopes can be used. See section 2.8 about variables for details.\n\n <cond>      A set of conditions that must all be true for the variable to\n             actually be set (such as \"ifnotempty\", \"ifgt\" ...). See the\n             set-var converter's description for a full list of possible\n             conditions.\n\n <expr>      Is a sample-fetch expression potentially followed by converters.\n\n <fmt>       This is the value expressed using Custom log format (see Custom\n             Log Format in section 8.2.6).\n```\n\nExamples :```\n\nhttp-check set-var(check.port) int(1234)\nhttp-check set-var-fmt(check.port) \"name=%H\"\n\n```\n\n**[http-check unset-var](#4.2-http-check%20unset-var)**(<var-name>)```\nFree a reference to a variable within its scope.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<var-name>   The name of the variable. Only \"proc\", \"sess\" and \"check\"\n             scopes can be used. See section 2.8 about variables for details.\n```\n\nExamples :```\n\nhttp-check unset-var(check.port)\n\n```\n\n**[http-error status](#4.2-http-error%20status)**<code>[content-type<type>][{ default-errorfiles | errorfile<file>| errorfiles<name>| file<file>| lf-file<file>| string<str>| lf-string<fmt>}][ hdr<name><fmt>]*```\nDefines a custom error message to use instead of errors generated by HAProxy.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\nstatus <code>        is the HTTP status code. It must be specified.\n                     Currently, HAProxy is capable of generating codes\n                     200, 400, 401, 403, 404, 405, 407, 408, 410, 413,\n                     414, 425, 429, 431, 500, 501, 502, 503, and 504.\n\ncontent-type <type>  is the response content type, for instance\n                     \"text/plain\". This parameter is ignored and should be\n                     omitted when an errorfile is configured or when the\n                     payload is empty. Otherwise, it must be defined.\n\ndefault-errorfiles   Reset the previously defined error message for current\n                     proxy for the status <code>. If used on a backend, the\n                     frontend error message is used, if defined. If used on\n                     a frontend, the default error message is used.\n\nerrorfile <file>     designates a file containing the full HTTP response.\n                     It is recommended to follow the common practice of\n                     appending \".http\" to the filename so that people do\n                     not confuse the response with HTML error pages, and to\n                     use absolute paths, since files are read before any\n                     chroot is performed.\n\nerrorfiles <name>    designates the http-errors section to use to import\n                     the error message with the status code <code>. If no\n                     such message is found, the proxy's error messages are\n                     considered.\n\nfile <file>          specifies the file to use as response payload. If the\n                     file is not empty, its content-type must be set as\n                     argument to \"content-type\", otherwise, any\n                     \"content-type\" argument is ignored. <file> is\n                     considered as a raw string.\n\nstring <str>         specifies the raw string to use as response payload.\n                     The content-type must always be set as argument to\n                     \"content-type\".\n\nlf-file <file>       specifies the file to use as response payload. If the\n                     file is not empty, its content-type must be set as\n                     argument to \"content-type\", otherwise, any\n                     \"content-type\" argument is ignored. <file> is\n                     evaluated as a Custom log format (see section 8.2.6).\n\nlf-string <str>      specifies the log-format string to use as response\n                     payload. The content-type must always be set as\n                     argument to \"content-type\".\n\nhdr <name> <fmt>     adds to the response the HTTP header field whose name\n                     is specified in <name> and whose value is defined by\n                     <fmt>, which follows the Custom log format rules (see\n                     section 8.2.6). This parameter is ignored if an\n                     errorfile is used.\n```\n\n```\nThis directive may be used instead of \"errorfileThis keyword is available in sections :HTTP-errorsAlphabetically sorted keywords reference\", to define a custom error\nmessage. As \"errorfileThis keyword is available in sections :HTTP-errorsAlphabetically sorted keywords reference\" directive, it is used for errors detected and\nreturned by HAProxy. If an errorfile is defined, it is parsed when HAProxy\nstarts and must be valid according to the HTTP standards. The generated\nresponse must not exceed the configured buffer size (BUFFSIZE), otherwise an\ninternal error will be returned.  Finally, if you consider to use some\nhttp-after-response rules to rewrite these errors, the reserved buffer space\nshould be available (see \"tune.maxrewrite\").\n\nThe files are read at the same time as the configuration and kept in memory.\nFor this reason, the errors continue to be returned even when the process is\nchrooted, and no file change is considered while the process is running.\n\nNote: 400/408/500 errors emitted in early stage of the request parsing are\n      handled by the multiplexer at a lower level. No custom formatting is\n      supported at this level. Thus only static error messages, defined with\n      \"errorfileThis keyword is available in sections :HTTP-errorsAlphabetically sorted keywords reference\" directive, are supported. However, this limitation only\n      exists during the request headers parsing or between two transactions.\n\n```\n\n**See also :**\"[errorfile](#)- This keyword is available in sections :\n- [HTTP-errors](#errorfile%20%28HTTP-errors%29)\n- [Alphabetically sorted keywords reference](#errorfile%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[errorfiles](#errorfiles)\", \"[errorloc](#errorloc)\", \"[errorloc302](#errorloc302)\", \"[errorloc303](#errorloc303)\" and[section 12.4](#12.4)about http-errors.**[http-request](#4.2-http-request)**<action>[options...][{ if | unless }<condition>]```\nAccess control for Layer 7 requests\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyes(!)yesyesyes```\nThe http-request statement defines a set of rules which apply to layer 7\nprocessing. The rules are evaluated in their declaration order when they are\nmet in a frontend, listen or backend section. Any rule may optionally be\nfollowed by an ACL-based condition, in which case it will only be evaluated\nif the condition evaluates to true.\n\nThe condition is evaluated just before the action is executed, and the action\nis performed exactly once. As such, there is no problem if an action changes\nan element which is checked as part of the condition. This also means that\nmultiple actions may rely on the same condition so that the first action that\nchanges the condition's evaluation is sufficient to implicitly disable the\nremaining actions. This is used for example when trying to assign a value to\na variable from various sources when it's empty. There is no limit to the\nnumber of \"http-request\" statements per instance.\n\nThe first keyword after \"http-request\" in the syntax is the rule's action,\noptionally followed by a varying number of arguments for the action. The\nsupported actions and their respective syntaxes are enumerated in section 4.3\n\"Actions\" (look for actions which tick \"HTTP Req\").\n\nThis directive is only available from named defaults sections, not anonymous\nones. Rules defined in the defaults section are evaluated before ones in the\nassociated proxy section. To avoid ambiguities, in this case the same\ndefaults section cannot be used by proxies with the frontend capability and\nby proxies with the backend capability. It means a listen section cannot use\na defaults section defining such rules.\n\n```\n\nExample:```\n\nacl nagios src 192.168.129.3\nacl local_net src 192.168.0.0/16\nacl auth_ok http_auth(L1)\n\nhttp-request allow if nagios\nhttp-request allow if local_net auth_ok\nhttp-request auth realm Gimme if local_net auth_ok\nhttp-request deny\n\n```\n\nExample:```\n\nacl key req.hdr(X-Add-Acl-Key) -m found\nacl add path /addacl\nacl del path /delacl\n\nacl myhost hdr(Host) -f myhost.lst\n\nhttp-request add-acl(myhost.lst) %[req.hdr(X-Add-Acl-Key)] if key add\nhttp-request del-acl(myhost.lst) %[req.hdr(X-Add-Acl-Key)] if key del\n\n```\n\nExample:```\n\nacl value  req.hdr(X-Value) -m found\nacl setmap path /setmap\nacl delmap path /delmap\n\nuse_backend bk_appli if { hdr(Host),map_str(map.lst) -m found }\n\nhttp-request set-map(map.lst) %[src] %[req.hdr(X-Value)] if setmap value\nhttp-request del-map(map.lst) %[src]                     if delmap\n\n```\n\n**See also :**\"[stats http-request](#stats%20http-request)\",[section 12.2](#12.2)about userlists and[section 7](#7)about ACL usage.**[http-response](#4.2-http-response)**<action><options...>[{ if | unless }<condition>]```\nAccess control for Layer 7 responses\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyes(!)yesyesyes```\nThe http-response statement defines a set of rules which apply to layer 7\nprocessing. The rules are evaluated in their declaration order when they are\nmet in a frontend, listen or backend section. Since these rules apply on\nresponses, the backend rules are applied first, followed by the frontend's\nrules. Any rule may optionally be followed by an ACL-based condition, in\nwhich case it will only be evaluated if the condition evaluates to true.\n\nThe condition is evaluated just before the action is executed, and the action\nis performed exactly once. As such, there is no problem if an action changes\nan element which is checked as part of the condition. This also means that\nmultiple actions may rely on the same condition so that the first action that\nchanges the condition's evaluation is sufficient to implicitly disable the\nremaining actions. This is used for example when trying to assign a value to\na variable from various sources when it's empty. There is no limit to the\nnumber of \"http-response\" statements per instance.\n\nThe first keyword after \"http-response\" in the syntax is the rule's action,\noptionally followed by a varying number of arguments for the action. The\nsupported actions and their respective syntaxes are enumerated in section 4.3\n\"Actions\" (look for actions which tick \"HTTP Res\").\n\nThis directive is only available from named defaults sections, not anonymous\nones. Rules defined in the defaults section are evaluated before ones in the\nassociated proxy section. To avoid ambiguities, in this case the same\ndefaults section cannot be used by proxies with the frontend capability and\nby proxies with the backend capability. It means a listen section cannot use\na defaults section defining such rules.\n\n```\n\nExample:```\n\nacl key_acl res.hdr(X-Acl-Key) -m found\n\nacl myhost hdr(Host) -f myhost.lst\n\nhttp-response add-acl(myhost.lst) %[res.hdr(X-Acl-Key)] if key_acl\nhttp-response del-acl(myhost.lst) %[res.hdr(X-Acl-Key)] if key_acl\n\n```\n\nExample:```\n\nacl value  res.hdr(X-Value) -m found\n\nuse_backend bk_appli if { hdr(Host),map_str(map.lst) -m found }\n\nhttp-response set-map(map.lst) %[src] %[res.hdr(X-Value)] if value\nhttp-response del-map(map.lst) %[src]                     if ! value\n\n```\n\n**See also :**\"[http-request](#http-request)\",[section 12.2](#12.2)about userlists and[section 7](#7)about ACL usage.**[http-reuse](#4.2-http-reuse)**{ never | safe | aggressive | always }```\nDeclare how idle HTTP connections may be shared between requests\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyes```\nIn order to avoid the cost of setting up new connections to backend servers\nfor each HTTP request, HAProxy tries to keep such idle connections opened\nafter being used. These connections are specific to a server and are stored\nin a list called a pool, and are grouped together by a set of common key\nproperties. Subsequent HTTP requests will cause a lookup of a compatible\nconnection sharing identical properties in the associated pool and result in\nthis connection being reused instead of establishing a new one.\n\nA limit on the number of idle connections to keep on a server can be\nspecified via the \"pool-max-conn\" server keyword. Unused connections are\nperiodically purged according to the \"pool-purge-delay\" interval.\n\nThe following connection properties are used to determine if an idle\nconnection is eligible for reuse on a given request:\n- source and destination addresses\n- proxy protocol\n- TOS and mark socket options\n- connection name, determined either by the result of the evaluation of the\n  \"pool-conn-name\" expression if present, otherwise by the \"sni\" expression\n\nIn some occasions, connection lookup or reuse is not performed due to extra\nrestrictions. This is determined by the reuse strategy specified via the\nkeyword argument:\n\n  - \"never\"  : idle connections are never shared between sessions. This mode\n               may be enforced to cancel a different strategy inherited from\n               a defaults section or for troubleshooting. For example, if an\n               old bogus application considers that multiple requests over\n               the same connection come from the same client and it is not\n               possible to fix the application, it may be desirable to\n               disable connection sharing in a single backend. An example of\n               such an application could be an old HAProxy using cookie\n               insertion in tunnel mode and not checking any request past the\n               first one.\n\n  - \"safe\"   : this is the default and the recommended strategy. The first\n               request of a session is always sent over its own connection,\n               and only subsequent requests may be dispatched over other\n               existing connections. This ensures that in case the server\n               closes the connection when the request is being sent, the\n               browser can decide to silently retry it. Since it is exactly\n               equivalent to regular keep-alive, there should be no side\n               effects. There is also a special handling for the connections\n               using protocols subject to Head-of-line blocking (backend with\n               h2 or fcgi). In this case, when at least one stream is\n               processed, the used connection is reserved to handle streams\n               of the same session. When no more streams are processed, the\n               connection is released and can be reused.\n\n  - \"aggressive\" : this mode may be useful in webservices environments where\n               all servers are not necessarily known and where it would be\n               appreciable to deliver most first requests over existing\n               connections. In this case, first requests are only delivered\n               over existing connections that have been reused at least once,\n               proving that the server correctly supports connection reuse.\n               It should only be used when it's sure that the client can\n               retry a failed request once in a while and where the benefit\n               of aggressive connection reuse significantly outweighs the\n               downsides of rare connection failures.\n\n  - \"always\" : this mode is only recommended when the path to the server is\n               known for never breaking existing connections quickly after\n               releasing them. It allows the first request of a session to be\n               sent to an existing connection. This can provide a significant\n               performance increase over the \"safe\" strategy when the backend\n               is a cache farm, since such components tend to show a\n               consistent behavior and will benefit from the connection\n               sharing. It is recommended that the \"http-keep-alive\" timeout\n               remains low in this mode so that no dead connections remain\n               usable. In most cases, this will lead to the same performance\n               gains as \"aggressive\" but with more risks. It should only be\n               used when it improves the situation over \"aggressive\".\n\nAlso note that connections with certain bogus authentication schemes (relying\non the connection) like NTLM are marked private if possible and never shared.\nThis won't be the case however when using a protocol with multiplexing\nabilities and using reuse mode level value greater than the default \"safe\"\nstrategy as in this case nothing prevents the connection from being already\nshared.\n\nThe rules to decide to keep an idle connection opened or to close it after\nprocessing are also governed by the \"tune.pool-low-fd-ratio\" (default: 20%)\nand \"tune.pool-high-fd-ratio\" (default: 25%). These correspond to the\npercentage of total file descriptors spent in idle connections above which\nhaproxy will respectively refrain from keeping a connection opened after a\nresponse, and actively kill idle connections. Some setups using a very high\nratio of idle connections, either because of too low a global \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\", or\ndue to a lot of HTTP/2 or HTTP/3 traffic on the frontend (few connections)\nbut HTTP/1 connections on the backend, may observe a lower reuse rate because\ntoo few connections are kept open. It may be desirable in this case to adjust\nsuch thresholds or simply to increase the global \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" value.\n\nWhen thread groups are explicitly enabled, it is important to understand that\nidle connections are only usable between threads from a same group. As such\nit may happen that unfair load between groups leads to more idle connections\nbeing needed, causing a lower reuse rate. The same solution may then be\napplied (increase global \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" or increase pool ratios).\n\n```\n\n**See also :**\"[option http-keep-alive](#option%20http-keep-alive)\", \"[pool-conn-name](#pool-conn-name)\", \"[pool-max-conn](#pool-max-conn)\", \"[pool-purge-delay](#pool-purge-delay)\", \"server maxconn\", \"[sni](#sni)\", \"[thread-groups](#thread-groups)\", \"[tune.pool-high-fd-ratio](#tune.pool-high-fd-ratio)\", \"[tune.pool-low-fd-ratio](#tune.pool-low-fd-ratio)\"**[http-send-name-header](#4.2-http-send-name-header)**[<header>]```\nAdd the server name to a request. Use the header string given by <header>\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<header>  The header string to use to send the server name\n```\n\n```\nThe \"http-send-name-header\" statement causes the header field named <header>\nto be set to the name of the target server at the moment the request is about\nto be sent on the wire. Any existing occurrences of this header are removed.\nUpon retries and redispatches, the header field is updated to always reflect\nthe server being attempted to connect to. Given that this header is modified\nvery late in the connection setup, it may have unexpected effects on already\nmodified headers. For example using it with transport-level header such as\nconnection, content-length, transfer-encoding and so on will likely result in\ninvalid requests being sent to the server. Additionally it has been reported\nthat this directive is currently being used as a way to overwrite the Host\nheader field in outgoing requests; while this trick has been known to work\nas a side effect of the feature for some time, it is not officially supported\nand might possibly not work anymore in a future version depending on the\ntechnical difficulties this feature induces. A long-term solution instead\nconsists in fixing the application which required this trick so that it binds\nto the correct host name.\n\n```\n\n**See also :**\"[server](#)- This keyword is available in sections :\n- [Peers declaration](#server%20%28Peers%20declaration%29)\n- [Rings](#server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\"**[id](#4.2-id)**<value>```\nSet a persistent ID to a proxy.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesyesArguments :none```\nSet a persistent ID for the proxy. This ID must be unique and positive.\nAn unused ID will automatically be assigned if unset. The first assigned\nvalue will be 1. This ID is currently only returned in statistics.\n\n```\n\n**[ignore-persist](#4.2-ignore-persist)**{ if | unless }<condition>```\nDeclare a condition to ignore persistence\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyes```\nBy default, when cookie persistence is enabled, every requests containing\nthe cookie are unconditionally persistent (assuming the target server is up\nand running).\n\nThe \"ignore-persist\" statement allows one to declare various ACL-based\nconditions which, when met, will cause a request to ignore persistence.\nThis is sometimes useful to load balance requests for static files, which\noften don't require persistence. This can also be used to fully disable\npersistence for a specific User-Agent (for example, some web crawler bots).\n\nThe persistence is ignored when an \"if\" condition is met, or unless an\n\"unless\" condition is met.\n\n```\n\nExample:```\n\nacl url_static  path_beg         /static /images /img /css\nacl url_static  path_end         .gif .png .jpg .css .js\nignore-persist  if url_static\n\n```\n\n**See also :**\"[force-persist](#force-persist)\", \"[cookie](#)- This keyword is available in sections :\n- [Alphabetically sorted keywords reference](#cookie%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Server and default-server options](#cookie%20%28Server%20and%20default-server%20options%29)\n- [Fetching HTTP samples (Layer 7)](#cookie%20%28Fetching%20HTTP%20samples%20%28Layer%207%29%29)\n\n\", and[section 7](#7)about ACL usage.**[load-server-state-from-file](#4.2-load-server-state-from-file)**{ global | local | none }```\nAllow seamless reload of HAProxy\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyes```\nThis directive points HAProxy to a file where server state from previous\nrunning process has been saved. That way, when starting up, before handling\ntraffic, the new process can apply old states to servers exactly has if no\nreload occurred. The purpose of the \"load-server-state-from-file\" directive is\nto tell HAProxy which file to use. For now, only 2 arguments to either prevent\nloading state or load states from a file containing all backends and servers.\nThe state file can be generated by running the command \"show servers state\"\nover the stats socket and redirect output.\n\nThe format of the file is versioned and is very specific. To understand it,\nplease read the documentation of the \"show servers state\" command (chapter\n9.3 of Management Guide).\n\n```\n\nArguments:```\nglobal     load the content of the file pointed by the global directive\n           named \"server-state-file\".\n\nlocal      load the content of the file pointed by the directive\n           \"server-state-file-name\" if set. If not set, then the backend\n           name is used as a file name.\n\nnone       don't load any stat for this backend\n```\n\n```\nNotes:\n  - server's IP address is preserved across reloads by default, but the\n    order can be changed thanks to the server's \"init-addr\" setting. This\n    means that an IP address change performed on the CLI at run time will\n    be preserved, and that any change to the local resolver (e.g. /etc/hosts)\n    will possibly not have any effect if the state file is in use.\n\n  - server's weight is applied from previous running process unless it has\n    has changed between previous and new configuration files.\n\n```\n\nExample:```\n\nMinimal configurationglobal\n stats socket /tmp/socket\n server-state-file /tmp/server_state\n\ndefaults\n load-server-state-from-file global\n\nbackend bk\n server s1 127.0.0.1:22 check weight 11\n server s2 127.0.0.1:22 check weight 12\n\n```\n\n```\nThen one can run :\n\n  socat /tmp/socket - <<< \"show servers state\" > /tmp/server_state\n\nContent of the file /tmp/server_state would be like this:\n\n  1\n  # <field names skipped for the doc example>\n  1 bk 1 s1 127.0.0.1 2 0 11 11 4 6 3 4 6 0 0\n  1 bk 2 s2 127.0.0.1 2 0 12 12 4 6 3 4 6 0 0\n\n```\n\nExample:```\n\nMinimal configurationglobal\n stats socket /tmp/socket\n server-state-base /etc/haproxy/states\n\ndefaults\n load-server-state-from-file local\n\nbackend bk\n server s1 127.0.0.1:22 check weight 11\n server s2 127.0.0.1:22 check weight 12\n\n```\n\n```\nThen one can run :\n\n  socat /tmp/socket - <<< \"show servers state bk\" > /etc/haproxy/states/bk\n\nContent of the file /etc/haproxy/states/bk would be like this:\n\n  1\n  # <field names skipped for the doc example>\n  1 bk 1 s1 127.0.0.1 2 0 11 11 4 6 3 4 6 0 0\n  1 bk 2 s2 127.0.0.1 2 0 12 12 4 6 3 4 6 0 0\n\n```\n\n**See also:**\"[server-state-file](#server-state-file)\", \"[server-state-file-name](#server-state-file-name)\", and \"show servers state\"**[log global](#4.2-log%20global)****[log](#4.2-log)**<target>[len<length>][format<format>][sample<ranges>:<sample_size>][profile<prof>]<facility>[<level>[<minlevel>]]**[no log](#4.2-no%20log)**```\nEnable per-instance logging of events and traffic.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyes```\nPrefix :\n  no         should be used when the logger list must be flushed. For example,\n             if you don't want to inherit from the default logger list. This\n             prefix does not allow arguments.\n\n```\n\nArguments :```\nglobal     should be used when the instance's logging parameters are the\n           same as the global ones. This is the most common usage. \"global\"\n           replaces all log arguments with those of the log entries found\n           in the \"global\" section. Only one \"log globalThis keyword is available in sections :Log forwardingAlphabetically sorted keywords reference\" statement may be\n           used per instance, and this form takes no other parameter.\n\n<target>   indicates where to send the logs. It takes the same format as\n           for the \"global\" section's logs, and can be one of :\n\n           - An IPv4 address optionally followed by a colon (':') and a UDP\n             port. If no port is specified, 514 is used by default (the\n             standard syslog port).\n\n           - An IPv6 address followed by a colon (':') and optionally a UDP\n             port. If no port is specified, 514 is used by default (the\n             standard syslog port).\n\n           - A filesystem path to a UNIX domain socket, keeping in mind\n             considerations for chroot (be sure the path is accessible\n             inside the chroot) and uid/gid (be sure the path is\n             appropriately writable).\n\n           - A file descriptor number in the form \"fd@<number>\", which may\n             point to a pipe, terminal, or socket. In this case unbuffered\n             logs are used and one writev() call per log is performed. This\n             is a bit expensive but acceptable for most workloads. Messages\n             sent this way will not be truncated but may be dropped, in\n             which case the DroppedLogs counter will be incremented. The\n             writev() call is atomic even on pipes for messages up to\n             PIPE_BUF size, which POSIX recommends to be at least 512 and\n             which is 4096 bytes on most modern operating systems. Any\n             larger message may be interleaved with messages from other\n             processes.  Exceptionally for debugging purposes the file\n             descriptor may also be directed to a file, but doing so will\n             significantly slow HAProxy down as non-blocking calls will be\n             ignored. Also there will be no way to purge nor rotate this\n             file without restarting the process. Note that the configured\n             syslog format is preserved, so the output is suitable for use\n             with a TCP syslog server. See also the \"short\" and \"raw\"\n             formats below.\n\n           - \"stdout\" / \"stderr\", which are respectively aliases for \"fd@1\"\n             and \"fd@2\", see above.\n\n           - A ring buffer in the form \"ring@<name>\", which will correspond\n             to an in-memory ring buffer accessible over the CLI using the\n             \"show events\" command, which will also list existing rings and\n             their sizes. Such buffers are lost on reload or restart but\n             when used as a complement this can help troubleshooting by\n             having the logs instantly available. See section 12.5 about\n             rings.\n\n           - A log backend in the form \"backend@<name>\", which will send\n             log messages to the corresponding log backend responsible for\n             sending the message to the proper server according to the\n             backend's lb settings. A log backend is a backend section with\n             \"mode log\" set (see \"modeThis keyword is available in sections :Alphabetically sorted keywords referenceBind options\" for more information).\n\n           - An explicit stream address prefix such as \"tcp@\",\"tcp6@\",\n             \"tcp4@\" or \"uxst@\" will allocate an implicit ring buffer with\n             a stream forward server targeting the given address.\n\n           You may want to reference some environment variables in the\n           address parameter, see section 2.3 about environment variables.\n\n<length>   is an optional maximum line length. Log lines larger than this\n           value will be truncated before being sent. The reason is that\n           syslog servers act differently on log line length. All servers\n           support the default value of 1024, but some servers simply drop\n           larger lines while others do log them. If a server supports long\n           lines, it may make sense to set this value here in order to avoid\n           truncating long lines. Similarly, if a server drops long lines,\n           it is preferable to truncate them before sending them. Accepted\n           values are 80 to 65535 inclusive. The default value of 1024 is\n           generally fine for all standard usages. Some specific cases of\n           long captures or JSON-formatted logs may require larger values.\n           You may also need to increase \"tune.http.logurilen\" if your\n           request URIs are truncated.\n\n<ranges>   A list of comma-separated ranges to identify the logs to sample.\n           This is used to balance the load of the logs to send to the log\n           server. The limits of the ranges cannot be null. They are numbered\n           from 1. The size or period (in number of logs) of the sample must\n           be set with <sample_size> parameter.\n\n<sample_size>\n           The size of the sample in number of logs to consider when balancing\n           their logging loads. It is used to balance the load of the logs to\n           send to the syslog server. This size must be greater or equal to the\n           maximum of the high limits of the ranges.\n           (see also <ranges> parameter).\n\n<format> is the log format used when generating syslog messages. It may be\n         one of the following :\n\n  local     Analog to rfc3164 syslog message format except that hostname\n            field is stripped. This is the default.\n            Note: option \"log-send-hostname\" switches the default to\n            rfc3164.\n\n  rfc3164   The RFC3164 syslog message format.\n            (https://tools.ietf.org/html/rfc3164)\n\n  rfc5424   The RFC5424 syslog message format.\n            (https://tools.ietf.org/html/rfc5424)\n\n  priority  A message containing only a level plus syslog facility between\n            angle brackets such as '<63>', followed by the text. The PID,\n            date, time, process name and system name are omitted. This is\n            designed to be used with a local log server.\n\n  short     A message containing only a level between angle brackets such as\n            '<3>', followed by the text. The PID, date, time, process name\n            and system name are omitted. This is designed to be used with a\n            local log server. This format is compatible with what the\n            systemd logger consumes.\n\n  timed     A message containing only a level between angle brackets such as\n            '<3>', followed by ISO date and by the text. The PID, process\n            name and system name are omitted. This is designed to be\n            used with a local log server.\n\n  iso       A message containing only the ISO date, followed by the text.\n            The PID, process name and system name are omitted. This is\n            designed to be used with a local log server.\n\n  raw       A message containing only the text. The level, PID, date, time,\n            process name and system name are omitted. This is designed to\n            be used in containers or during development, where the severity\n            only depends on the file descriptor used (stdout/stderr).\n\n<prof>     name of the optional \"log-profile\" section that will be\n           considered during the log building process to override some\n           log options. Check out \"8.3.5. Log profiles\" for more info.\n\n<facility> must be one of the 24 standard syslog facilities :\n\n               kern   user   mail   daemon auth   syslog lpr    news\n               uucp   cron   auth2  ftp    ntp    audit  alert  cron2\n               local0 local1 local2 local3 local4 local5 local6 local7\n\n           Note that the facility is ignored for the \"short\" and \"raw\"\n           formats, but still required as a positional field. It is\n           recommended to use \"daemon\" in this case to make it clear that\n           it's only supposed to be used locally.\n\n<level>    is optional and can be specified to filter outgoing messages. By\n           default, all messages are sent. If a level is specified, only\n           messages with a severity at least as important as this level\n           will be sent. An optional minimum level can be specified. If it\n           is set, logs emitted with a more severe level than this one will\n           be capped to this level. This is used to avoid sending \"emerg\"\n           messages on all terminals on some default syslog configurations.\n           Eight levels are known :\n\n             emerg  alert  crit   err    warning notice info  debug\n```\n\n```\nIt is important to keep in mind that it is the frontend which decides what to\nlog from a connection, and that in case of content switching, the log entries\nfrom the backend will be ignored. Connections are logged at level \"info\".\n\nHowever, backend log declaration define how and where servers status changes\nwill be logged. Level \"notice\" will be used to indicate a server going up,\n\"warning\" will be used for termination signals and definitive service\ntermination, and \"alert\" will be used for when a server goes down.\n\nNote : According to RFC3164, messages are truncated to 1024 bytes before\n       being emitted.\n\n```\n\nExample :```\n\nlog global\nlog stdout format short daemon          # send log to systemd\nlog stdout format raw daemon            # send everything to stdout\nlog stderr format raw daemon notice     # send important events to stderr\nlog 127.0.0.1:514 local0 notice         # only send important events\nlog tcp@127.0.0.1:514 local0 notice notice  # same but limit output\n                                            # level and send in tcp\nlog \"${LOCAL_SYSLOG}:514\" local0 notice   # send to local server\n\n```\n\n**[log-format](#4.2-log-format)**<fmt>```\nSpecifies the custom log format string to use for traffic logs\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesno```\nThis directive specifies the log format string that will be used for all logs\nresulting from traffic passing through the frontend using this line. If the\ndirective is used in a defaults section, all subsequent frontends will use\nthe same log format. Please see section 8.2.6 which covers the custom log\nformat string in depth.\n\nA specific log-format used only in case of connection error can also be\ndefined, see the \"error-log-format\" option.\n\n\"log-format\" directive overrides previous \"option tcplog\", \"log-format\",\n\"option httplog\" and \"option httpslog\" directives.\n\n```\n\n**[log-format-sd](#4.2-log-format-sd)**<fmt>```\nSpecifies the Custom log format string used to produce RFC5424 structured-data\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesno```\nThis directive specifies the RFC5424 structured-data log format string that\nwill be used for all logs resulting from traffic passing through the frontend\nusing this line. If the directive is used in a defaults section, all\nsubsequent frontends will use the same log format. Please see section 8.2.6\nwhich covers the log format string in depth.\n\nSee https://tools.ietf.org/html/rfc5424#section-6.3 for more information\nabout the RFC5424 structured-data part.\n\nNote : This log format string will be used only for loggers that have set\n       log format to \"rfc5424\".\n\n```\n\nExample :```\n\nlog-format-sd [exampleSDID@1234\\ bytes=\\\"%B\\\"\\ status=\\\"%ST\\\"]\n\n```\n\n**[log-steps](#4.2-log-steps)**<steps>```\nSpecifies at which steps during transaction processing logs should be\ngenerated.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesno```\nDuring tcp/http transaction processing, haproxy may produce logs at different\nsteps during the processing (ie: accept, connect, request, response, close).\n\nBy default, HAProxy emits a single log per transaction, once all of the\nitems used in the logformat expression could be satisfied, which means\nthat in practice the log is usually emitted at the end of the transaction\n(after the end of the response for HTTP or end of connection for TCP),\nunless \"option logasap\" is used.\n\nThe \"log-steps\" directive allows to refine the precise instants where\nlogs will be emitted, and even permits to emit multiple logs for a\nsame transaction. Special value 'all' may be used to enable all available\nlog origins, making it possible to track a transaction from accept to close.\nIndidivual log origins may also be specified using their names separated by\nspaces to selectively enable when logs should be produced.\n\nCommon log origins are: accept, connect, request, response, close.\n\n```\n\nExample:```\n\nfrontend myfront\n    option httplog\n    log-steps accept,close         #only log accept and close for the txn\n\n```\n\n```\nLog origins specified as \"logging steps\" (such as accept, close) can be\nused as-is in log-profiles (after 'on' directive). Combining \"log-steps\"\nwith log-profiles is really interesting to have fine-grained control over\nlogs automatically generated by haproxy during transaction processing.\n\n```\n\n**See also :**\"[log-profile](#log-profile)\"**[log-tag](#4.2-log-tag)**<string>```\nSpecifies the log tag to use for all outgoing logs\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyes```\nSets the tag field in the syslog header to this string. It defaults to the\nlog-tag set in the global section, otherwise the program name as launched\nfrom the command line, which usually is \"HAProxy\". Sometimes it can be useful\nto differentiate between multiple processes running on the same host, or to\ndifferentiate customer instances running in the same process. In the backend,\nlogs about servers up/down will use this tag. As a hint, it can be convenient\nto set a log-tag related to a hosted customer in a defaults section then put\nall the frontends and backends for that customer, then start another customer\nin a new defaults section. See also the global \"log-tagThis keyword is available in sections :Process management and securityAlphabetically sorted keywords referenceLog profiles\" directive.\n\n```\n\n**[max-keep-alive-queue](#4.2-max-keep-alive-queue)**<value>```\nSet the maximum server queue size for maintaining keep-alive connections\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyes```\nHTTP keep-alive tries to reuse the same server connection whenever possible,\nbut sometimes it can be counter-productive, for example if a server has a lot\nof connections while other ones are idle. This is especially true for static\nservers.\n\nThe purpose of this setting is to set a threshold on the number of queued\nconnections at which HAProxy stops trying to reuse the same server and prefers\nto find another one. The default value, -1, means there is no limit. A value\nof zero means that keep-alive requests will never be queued. For very close\nservers which can be reached with a low latency and which are not sensible to\nbreaking keep-alive, a low value is recommended (e.g. local static server can\nuse a value of 10 or less). For remote servers suffering from a high latency,\nhigher values might be needed to cover for the latency and/or the cost of\npicking a different server.\n\nNote that this has no impact on responses which are maintained to the same\nserver consecutively to a 401 response. They will still go to the same server\neven if they have to be queued.\n\n```\n\n**See also :**\"[option http-server-close](#option%20http-server-close)\", \"[option prefer-last-server](#option%20prefer-last-server)\", server \"[maxconn](#)- This keyword is available in sections :\n- [Log forwarding](#maxconn%20%28Log%20forwarding%29)\n- [Performance tuning](#maxconn%20%28Performance%20tuning%29)\n- [Alphabetically sorted keywords reference](#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Bind options](#maxconn%20%28Bind%20options%29)\n- [Server and default-server options](#maxconn%20%28Server%20and%20default-server%20options%29)\n\n\" and cookie persistence.**[max-session-srv-conns](#4.2-max-session-srv-conns)**<nb>```\nSet the maximum number of outgoing connections we can keep idling for a given\nclient session. The default is 5 (it precisely equals MAX_SRV_LIST which is\ndefined at build time).\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesno**[maxconn](#4.2-maxconn)**<conns>```\nFix the maximum number of concurrent connections on a frontend\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<conns>   is the maximum number of concurrent connections the frontend will\n          accept to serve. Excess connections will be queued by the system\n          in the socket's listen queue and will be served once a connection\n          closes.\n```\n\n```\nIf the system supports it, it can be useful on big sites to raise this limit\nvery high so that HAProxy manages connection queues, instead of leaving the\nclients with unanswered connection attempts. This value should not exceed the\nglobal maxconn. Also, keep in mind that a connection contains two buffers\nof tune.bufsize (16kB by default) each, as well as some other data resulting\nin about 33 kB of RAM being consumed per established connection. That means\nthat a medium system equipped with 1GB of RAM can withstand around\n20000-25000 concurrent connections if properly tuned.\n\nAlso, when <conns> is set to large values, it is possible that the servers\nare not sized to accept such loads, and for this reason it is generally wise\nto assign them some reasonable connection limits.\n\nWhen this value is set to zero, which is the default, the global \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\"\nvalue is used.\n\n```\n\n**See also :**\"[server](#)- This keyword is available in sections :\n- [Peers declaration](#server%20%28Peers%20declaration%29)\n- [Rings](#server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", global section's \"[maxconn](#)- This keyword is available in sections :\n- [Log forwarding](#maxconn%20%28Log%20forwarding%29)\n- [Performance tuning](#maxconn%20%28Performance%20tuning%29)\n- [Alphabetically sorted keywords reference](#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Bind options](#maxconn%20%28Bind%20options%29)\n- [Server and default-server options](#maxconn%20%28Server%20and%20default-server%20options%29)\n\n\", \"[fullconn](#fullconn)\"**[mode](#4.2-mode)**{ tcp|http|log|spop }```\nSet the running mode or protocol of the instance\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\ntcp       The instance will work in pure TCP mode. A full-duplex connection\n          will be established between clients and servers, and no layer 7\n          examination will be performed. This is the default mode. It\n          should be used for SSL, SSH, SMTP, ...\n\nhttp      The instance will work in HTTP mode. The client request will be\n          analyzed in depth before connecting to any server. Any request\n          which is not RFC-compliant will be rejected. Layer 7 filtering,\n          processing and switching will be possible. This is the mode which\n          brings HAProxy most of its value.\n\nlog       When used in a backend section, it will turn the backend into a\n          log backend. Such backend can be used as a log destination for\n          any \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\" directive by using the \"backend@<name>\" syntax. Log\n          messages will be distributed to the servers from the backend\n          according to the lb settings which can be configured using the\n          \"balance\" keyword. Log backends support UDP servers by prefixing\n          the server's address with the \"udp@\" prefix. Common backend and\n          server features are supported, but not TCP or HTTP specific ones.\n\nspop      When used in a backend section, it will turn the backend into a\n          spop backend. This mode is mandatory if the backend contains\n          SPOA servers, but when mode is tcp, it will automatically be\n          converted to mode spop if such servers are detected.\n```\n\n```\nWhen doing content switching, it is mandatory that the frontend and the\nbackend are in the same mode (generally HTTP), otherwise the configuration\nwill be refused.\n\n```\n\nExample :```\n\ndefaults http_instances\n    mode http\n\n```\n\n**[monitor fail](#4.2-monitor%20fail)**{ if | unless }<condition>```\nAdd a condition to report a failure to a monitor HTTP request.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesnoArguments :```\nif <cond>     the monitor request will fail if the condition is satisfied,\n              and will succeed otherwise. The condition should describe a\n              combined test which must induce a failure if all conditions\n              are met, for instance a low number of servers both in a\n              backend and its backup.\n\nunless <cond> the monitor request will succeed only if the condition is\n              satisfied, and will fail otherwise. Such a condition may be\n              based on a test on the presence of a minimum number of active\n              servers in a list of backends.\n```\n\n```\nThis statement adds a condition which can force the response to a monitor\nrequest to report a failure. By default, when an external component queries\nthe URI dedicated to monitoring, a 200 response is returned. When one of the\nconditions above is met, HAProxy will return 503 instead of 200. This is\nvery useful to report a site failure to an external component which may base\nrouting advertisements between multiple sites on the availability reported by\nHAProxy. In this case, one would rely on an ACL involving the \"nbsrvThis keyword is available in sections :ConvertersFetching samples from internal states\"\ncriterion. Note that \"monitor fail\" only works in HTTP mode. Both status\nmessages may be tweaked using \"errorfileThis keyword is available in sections :HTTP-errorsAlphabetically sorted keywords reference\" or \"errorloc\" if needed.\n\n```\n\nExample:```\n\nfrontend www\n   mode http\n   acl site_dead nbsrv(dynamic) lt 2\n   acl site_dead nbsrv(static)  lt 2\n   monitor-uri   /site_alive\n   monitor fail  if site_dead\n\n```\n\n**See also :**\"[monitor-uri](#monitor-uri)\", \"[errorfile](#)- This keyword is available in sections :\n- [HTTP-errors](#errorfile%20%28HTTP-errors%29)\n- [Alphabetically sorted keywords reference](#errorfile%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[errorloc](#errorloc)\"**[monitor-uri](#4.2-monitor-uri)**<uri>```\nIntercept a URI used by external components' monitor requests\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<uri>     is the exact URI which we want to intercept to return HAProxy's\n          health status instead of forwarding the request.\n```\n\n```\nWhen an HTTP request referencing <uri> will be received on a frontend,\nHAProxy will not forward it nor log it, but instead will return either\n\"HTTP/1.0 200 OK\" or \"HTTP/1.0 503 Service unavailable\", depending on failure\nconditions defined with \"monitor fail\". This is normally enough for any\nfront-end HTTP probe to detect that the service is UP and running without\nforwarding the request to a backend server. Note that the HTTP method, the\nversion and all headers are ignored, but the request must at least be valid\nat the HTTP level. This keyword may only be used with an HTTP-mode frontend.\n\nMonitor requests are processed very early, just after the request is parsed\nand even before any \"http-request\". The only rulesets applied before are the\ntcp-request ones. They cannot be logged either, and it is the intended\npurpose. Only one URI may be configured for monitoring; when multiple\n\"monitor-uri\" statements are present, the last one will define the URI to\nbe used. They are only used to report HAProxy's health to an upper component,\nnothing more. However, it is possible to add any number of conditions using\n\"monitor fail\" and ACLs so that the result can be adjusted to whatever check\ncan be imagined (most often the number of available servers in a backend).\n\nNote: if <uri> starts by a slash ('/'), the matching is performed against the\n      request's path instead of the request's uri. It is a workaround to let\n      the HTTP/2 requests match the monitor-uri. Indeed, in HTTP/2, clients\n      are encouraged to send absolute URIs only.\n\n```\n\nExample :```\n\n# Use /haproxy_test to report HAProxy's status\nfrontend www\n    mode http\n    monitor-uri /haproxy_test\n\n```\n\n**See also :**\"[monitor fail](#monitor%20fail)\"**[option abortonclose](#4.2-option%20abortonclose)****[no option abortonclose](#4.2-no%20option%20abortonclose)**```\nEnable or disable early dropping of aborted requests pending in queues.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nIn presence of very high loads, the servers will take some time to respond.\nThe per-instance connection queue will inflate, and the response time will\nincrease respective to the size of the queue times the average per-stream\nresponse time. When clients will wait for more than a few seconds, they will\noften hit the \"STOP\" button on their browser, leaving a useless request in\nthe queue, and slowing down other users, and the servers as well, because the\nrequest will eventually be served, then aborted at the first error\nencountered while delivering the response.\n\nAs there is no way to distinguish between a full STOP and a simple output\nclose on the client side, HTTP agents should be conservative and consider\nthat the client might only have closed its output channel while waiting for\nthe response. However, this introduces risks of congestion when lots of users\ndo the same, and is completely useless nowadays because probably no client at\nall will close the stream while waiting for the response. Some HTTP agents\nsupport this behavior (Squid, Apache, HAProxy), and others do not (TUX, most\nhardware-based load balancers). So the probability for a closed input channel\nto represent a user hitting the \"STOP\" button is close to 100%, and the risk\nof being the single component to break rare but valid traffic is extremely\nlow, which adds to the temptation to be able to abort a stream early while\nstill not served and not pollute the servers.\n\nIn HAProxy, the user can choose the desired behavior using the option\n\"abortonclose\". By default (without the option) the behavior is HTTP\ncompliant and aborted requests will be served. But when the option is\nspecified, a stream with an incoming channel closed will be aborted while\nit is still possible, either pending in the queue for a connection slot, or\nduring the connection establishment if the server has not yet acknowledged\nthe connection request. This considerably reduces the queue size and the load\non saturated servers when users are tempted to click on STOP, which in turn\nreduces the response time for other users.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[timeout queue](#timeout%20queue)\" and server's \"[maxconn](#)- This keyword is available in sections :\n- [Log forwarding](#maxconn%20%28Log%20forwarding%29)\n- [Performance tuning](#maxconn%20%28Performance%20tuning%29)\n- [Alphabetically sorted keywords reference](#maxconn%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Bind options](#maxconn%20%28Bind%20options%29)\n- [Server and default-server options](#maxconn%20%28Server%20and%20default-server%20options%29)\n\n\" and \"[maxqueue](#maxqueue)\" parameters**[option accept-invalid-http-request](#4.2-option%20accept-invalid-http-request)**(deprecated)**[no option accept-invalid-http-request](#4.2-no%20option%20accept-invalid-http-request)**(deprecated)```\nEnable or disable relaxing of HTTP request parsing\n\nThe \"accept-invalid-http-request\" keyword is deprecated, use \"option\naccept-unsafe-violations-in-http-request\" instead.\n\n```\n\n**[option accept-invalid-http-response](#4.2-option%20accept-invalid-http-response)**(deprecated)**[no option accept-invalid-http-response](#4.2-no%20option%20accept-invalid-http-response)**(deprecated)```\nEnable or disable relaxing of HTTP response parsing\n\nThe \"accept-invalid-http-response\" keyword is deprecated, use \"option\naccept-unsafe-violations-in-http-response\" instead.\n\n```\n\n**[option accept-unsafe-violations-in-http-request](#4.2-option%20accept-unsafe-violations-in-http-request)****[no option accept-unsafe-violations-in-http-request](#4.2-no%20option%20accept-unsafe-violations-in-http-request)**```\nEnable or disable relaxing of HTTP request parsing\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nBy default, HAProxy complies with the different HTTP RFCs in terms of message\nparsing. This means the message parsing is quite strict and causes an error\nto be returned to the client for malformed messages. This is the desired\nbehavior as such malformed messages are essentially used to build attacks\nexploiting server weaknesses, and bypass security filtering. Sometimes, a\nbuggy browser will not respect these RCFs for whatever reason (configuration,\nimplementation...) and the issue will not be immediately fixed. In such case,\nit is possible to relax HAProxy's parser to accept some invalid requests by\nspecifying this option. Most of rules concern the H1 parsing for historical\nreason. Newer HTTP versions tends to be cleaner and applications follow more\nstickly these protocols.\n\nWhen this option is set, the following rules are observed:\n\n  * In H1 only, invalid characters, including NULL character, in header name\n    will be accepted;\n\n  * In H1 only, NULL character in header value will be accepted;\n\n  * In H1 only, characters above 127 in the URI will be accepted. The list of\n    characters allowed to appear in a URI is well defined by RFC3986, and\n    chars 0-31, 32 (space), 34 ('\"'), 60 ('<'), 62 ('>'), 92 ('\\'), 94 ('^'),\n    96 ('`'), 123 ('{'), 124 ('|'), 125 ('}'), 127 (delete) and anything\n    above are normally not allowed. In H1, all character between (0..32) and\n    127 will always be blocked. All characters above 127 (excluded) will also\n    be blocked, except when this option is enabled. Other characters\n    (33..126) will not be checked at all.\n\n  * In H1 and H2, URLs containing fragment references ('#' after the path)\n    will be accepted;\n\n  * In H1 only, no check will be performed on the authority for CONNECT\n    requests;\n\n  * In H1 only, no check will be performed against the authority and the Host\n    header value.\n\n  * In H1 only, tests on the HTTP version will be relaxed. It will allow\n    HTTP/0.9 GET requests to pass through (no version specified), as well as\n    different protocol names (e.g. RTSP), and multiple digits for both the\n    major and the minor version.\n\n  * In H1 only, WebSocket (RFC6455) requests failing to present a valid\n    \"Sec-Websocket-Key\" header field will be accepted.\n\nThis option should never be enabled by default as it hides application bugs\nand open security breaches. It should only be deployed after a problem has\nbeen confirmed.\n\nWhen this option is enabled, invalid but accepted H1 requests will be\ncaptured in order to permit later analysis using the \"show errors\" request on\nthe UNIX stats socket.Doing this also helps confirming that the issue has\nbeen solved.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option accept-unsafe-violations-in-http-response](#option%20accept-unsafe-violations-in-http-response)\" and \"show errors\" on the stats socket.**[option accept-unsafe-violations-in-http-response](#4.2-option%20accept-unsafe-violations-in-http-response)****[no option accept-unsafe-violations-in-http-response](#4.2-no%20option%20accept-unsafe-violations-in-http-response)**```\nEnable or disable relaxing of HTTP response parsing\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nSimilarly to \"option accept-unsafe-violations-in-http-request\", this option\nmay be used to relax parsing rules of HTTP responses. It should only be\nenabled for trusted legacy servers to accept some invalid responses. Most of\nrules concern the H1 parsing for historical reason. Newer HTTP versions tends\nto be cleaner and applications follow more stickly these protocols.\n\nWhen this option is set, the following rules are observed:\n\n  * In H1 only, invalid characters, including NULL character, in header name\n    will be accepted;\n\n  * In H1 only, NULL character in header value will be accepted;\n\n  * In H1 only, empty values or several \"chunked\" value occurrences for\n    Transfer-Encoding header will be accepted;\n\n  * In H1 only, no check will be performed against the authority and the Host\n    header value.\n\n  * In H1 only, tests on the HTTP version will be relaxed. It will allow\n    different protocol names (e.g. RTSP), and multiple digits for both the\n    major and the minor version.\n\n  * In H1 only, WebSocket (RFC6455) responses failing to present a valid\n    \"Sec-Websocket-Accept\" header field will be accepted.\n\nThis option should never be enabled by default as it hides application bugs\nand open security breaches. It should only be deployed after a problem has\nbeen confirmed.\n\nWhen this option is enabled, erroneous header names will still be accepted in\nresponses, but the complete response will be captured in order to permit\nlater analysis using the \"show errors\" request on the UNIX stats socket.\nDoing this also helps confirming that the issue has been solved.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option accept-unsafe-violations-in-http-request](#option%20accept-unsafe-violations-in-http-request)\" and \"show errors\" on the stats socket.**[option allbackups](#4.2-option%20allbackups)****[no option allbackups](#4.2-no%20option%20allbackups)**```\nUse either all backup servers at a time or only the first one\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nBy default, the first operational backup server gets all traffic when normal\nservers are all down. Sometimes, it may be preferred to use multiple backups\nat once, because one will not be enough. When \"option allbackups\" is enabled,\nthe load balancing will be performed among all backup servers when all normal\nones are unavailable. The same load balancing algorithm will be used and the\nservers' weights will be respected. Thus, there will not be any priority\norder between the backup servers anymore.\n\nThis option is mostly used with static server farms dedicated to return a\n\"sorry\" page when an application is completely offline.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**[option checkcache](#4.2-option%20checkcache)****[no option checkcache](#4.2-no%20option%20checkcache)**```\nAnalyze all server responses and block responses with cacheable cookies\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nSome high-level frameworks set application cookies everywhere and do not\nalways let enough control to the developer to manage how the responses should\nbe cached. When a session cookie is returned on a cacheable object, there is a\nhigh risk of session crossing or stealing between users traversing the same\ncaches. In some situations, it is better to block the response than to let\nsome sensitive session information go in the wild.\n\nThe option \"checkcache\" enables deep inspection of all server responses for\nstrict compliance with HTTP specification in terms of cacheability. It\ncarefully checks \"Cache-control\", \"Pragma\" and \"Set-cookie\" headers in server\nresponse to check if there's a risk of caching a cookie on a client-side\nproxy. When this option is enabled, the only responses which can be delivered\nto the client are :\n  - all those without \"Set-Cookie\" header;\n  - all those with a return code other than 200, 203, 204, 206, 300, 301,\n    404, 405, 410, 414, 501, provided that the server has not set a\n    \"Cache-control: public\" header field;\n  - all those that result from a request using a method other than GET, HEAD,\n    OPTIONS, TRACE, provided that the server has not set a 'Cache-Control:\n    public' header field;\n  - those with a 'Pragma: no-cache' header\n  - those with a 'Cache-control: private' header\n  - those with a 'Cache-control: no-store' header\n  - those with a 'Cache-control: max-age=0' header\n  - those with a 'Cache-control: s-maxage=0' header\n  - those with a 'Cache-control: no-cache' header\n  - those with a 'Cache-control: no-cache=\"set-cookie\"' header\n  - those with a 'Cache-control: no-cache=\"set-cookie,' header\n    (allowing other fields after set-cookie)\n\nIf a response doesn't respect these requirements, then it will be blocked\njust as if it was from an \"http-response deny\" rule, with an \"HTTP 502 bad\ngateway\". The session state shows \"PH--\" meaning that the proxy blocked the\nresponse during headers processing. Additionally, an alert will be sent in\nthe logs so that admins are informed that there's something to be fixed.\n\nDue to the high impact on the application, the application should be tested\nin depth with the option enabled before going to production. It is also a\ngood practice to always activate it during tests, even if it is not used in\nproduction, as it will report potentially dangerous application behaviors.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**[option clitcpka](#4.2-option%20clitcpka)****[no option clitcpka](#4.2-no%20option%20clitcpka)**```\nEnable or disable the sending of TCP keepalive packets on the client side\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nWhen there is a firewall or any session-aware component between a client and\na server, and when the protocol involves very long sessions with long idle\nperiods (e.g. remote desktops), there is a risk that one of the intermediate\ncomponents decides to expire a session which has remained idle for too long.\n\nEnabling socket-level TCP keep-alives makes the system regularly send packets\nto the other end of the connection, leaving it active. The delay between\nkeep-alive probes is controlled by the system only and depends both on the\noperating system and its tuning parameters.\n\nIt is important to understand that keep-alive packets are neither emitted nor\nreceived at the application level. It is only the network stacks which sees\nthem. For this reason, even if one side of the proxy already uses keep-alives\nto maintain its connection alive, those keep-alive packets will not be\nforwarded to the other side of the proxy.\n\nPlease note that this has nothing to do with HTTP keep-alive.\n\nUsing option \"clitcpka\" enables the emission of TCP keep-alive probes on the\nclient side of a connection, which should help when session expirations are\nnoticed between HAProxy and a client.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option srvtcpka](#option%20srvtcpka)\", \"[option tcpka](#option%20tcpka)\"**[option contstats](#4.2-option%20contstats)**```\nEnable continuous traffic statistics updates\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nBy default, counters used for statistics calculation are incremented\nonly when a stream finishes. It works quite well when serving small\nobjects, but with big ones (for example large images or archives) or\nwith A/V streaming, a graph generated from HAProxy counters looks like\na hedgehog. With this option enabled counters get incremented frequently\nalong the stream, typically every 5 seconds, which is often enough to\nproduce clean graphs. Recounting touches a hotpath directly so it is not\nnot enabled by default, as it can cause a lot of wakeups for very large\nsession counts and cause a small performance drop.\n\n```\n\n**[option disable-h2-upgrade](#4.2-option%20disable-h2-upgrade)****[no option disable-h2-upgrade](#4.2-no%20option%20disable-h2-upgrade)**```\nEnable or disable the implicit HTTP/2 upgrade from an HTTP/1.x client\nconnection.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nBy default, HAProxy is able to implicitly upgrade an HTTP/1.x client\nconnection to an HTTP/2 connection if the first request it receives from a\ngiven HTTP connection matches the HTTP/2 connection preface (i.e. the string\n\"PRI * HTTP/2.0\\r\\n\\r\\nSM\\r\\n\\r\\n\"). This way, it is possible to support\nHTTP/1.x and HTTP/2 clients on a non-SSL connections. This option must be\nused to disable the implicit upgrade. Note this implicit upgrade is only\nsupported for HTTP proxies, thus this option too. Note also it is possible to\nforce the HTTP/2 on clear connections by specifying \"proto h2\" on the bind\nline. Finally, this option is applied on all bind lines. To disable implicit\nHTTP/2 upgrades for a specific bind line, it is possible to use \"proto h1\".\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**[option dontlog-normal](#4.2-option%20dontlog-normal)****[no option dontlog-normal](#4.2-no%20option%20dontlog-normal)**```\nEnable or disable logging of normal, successful connections\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nThere are large sites dealing with several thousand connections per second\nand for which logging is a major pain. Some of them are even forced to turn\nlogs off and cannot debug production issues. Setting this option ensures that\nnormal connections, those which experience no error, no timeout, no retry nor\nredispatch, will not be logged. This leaves disk space for anomalies. In HTTP\nmode, the response status code is checked and return codes 5xx will still be\nlogged.\n\nIt is strongly discouraged to use this option as most of the time, the key to\ncomplex issues is in the normal logs which will not be logged here. If you\nneed to separate logs, see the \"log-separate-errors\" option instead.\n\n```\n\n**See also :**\"[log](#)- This keyword is available in sections :\n- [Peers declaration](#log%20%28Peers%20declaration%29)\n- [Log forwarding](#log%20%28Log%20forwarding%29)\n- [Process management and security](#log%20%28Process%20management%20and%20security%29)\n- [Alphabetically sorted keywords reference](#log%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[dontlognull](#option%20dontlognull)\", \"[log-separate-errors](#option%20log-separate-errors)\" and[section 8](#8)about logging.**[option dontlognull](#4.2-option%20dontlognull)****[no option dontlognull](#4.2-no%20option%20dontlognull)**```\nEnable or disable logging of null connections\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nIn certain environments, there are components which will regularly connect to\nvarious systems to ensure that they are still alive. It can be the case from\nanother load balancer as well as from monitoring systems. By default, even a\nsimple port probe or scan will produce a log. If those connections pollute\nthe logs too much, it is possible to enable option \"dontlognull\" to indicate\nthat a connection on which no data has been transferred will not be logged,\nwhich typically corresponds to those probes. Note that errors will still be\nreturned to the client and accounted for in the stats. If this is not what is\ndesired, option http-ignore-probes can be used instead.\n\nIt is generally recommended not to use this option in uncontrolled\nenvironments (e.g. internet), otherwise scans and other malicious activities\nwould not be logged.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[log](#)- This keyword is available in sections :\n- [Peers declaration](#log%20%28Peers%20declaration%29)\n- [Log forwarding](#log%20%28Log%20forwarding%29)\n- [Process management and security](#log%20%28Process%20management%20and%20security%29)\n- [Alphabetically sorted keywords reference](#log%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[http-ignore-probes](#option%20http-ignore-probes)\", \"[monitor-uri](#monitor-uri)\", and[section 8](#8)about logging.**[option forwarded](#4.2-option%20forwarded)**[ proto ][ host | host-expr<host_expr>][ by | by-expr<by_expr>][ by_port | by_port-expr<by_port_expr>][ for | for-expr<for_expr>][ for_port | for_port-expr<for_port_expr>]**[no option forwarded](#4.2-no%20option%20forwarded)**```\nEnable insertion of the rfc 7239 forwarded header in requests sent to servers\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<host_expr>     optional argument to specify a custom sample expression\n                those result will be used as 'host' parameter value\n\n<by_expr>       optional argument to specify a custom sample expression\n                those result will be used as 'by' parameter nodename value\n\n<for_expr>      optional argument to specify a custom sample expression\n                those result will be used as 'for' parameter nodename value\n\n<by_port_expr>  optional argument to specify a custom sample expression\n                those result will be used as 'by' parameter nodeport value\n\n<for_port_expr> optional argument to specify a custom sample expression\n                those result will be used as 'for' parameter nodeport value\n```\n\n```\nSince HAProxy works in reverse-proxy mode, servers are losing some request\ncontext (request origin: client ip address, protocol used...)\n\nA common way to address this limitation is to use the well known\nx-forward-for and x-forward-* friends to expose some of this context to the\nunderlying servers/applications.\nWhile this use to work and is widely deployed, it is not officially supported\nby the IETF and can be the root of some interoperability as well as security\nissues.\n\nTo solve this, a new HTTP extension has been described by the IETF:\nforwarded header (RFC7239).\nMore information here: https://www.rfc-editor.org/rfc/rfc7239.html\n\nThe use of this single header allow to convey numerous details\nwithin the same header, and most importantly, fixes the proxy chaining\nissue. (the rfc allows for multiple chained proxies to append their own\nvalues to an already existing header).\n\nThis option may be specified in defaults, listen or backend section, but it\nwill be ignored for frontend sections.\n\nSetting option forwarded without arguments results in using default implicit\nbehavior.\nDefault behavior enables proto parameter and injects original client ip.\n\nThe equivalent explicit/manual configuration would be:\n      option forwarded proto for\n\nThe keyword 'by' is used to enable 'by' parameter (\"nodename\") in\nforwarded header. It allows to embed request proxy information.\n'by' value will be set to proxy ip (destination address)\nIf not available (ie: UNIX listener), 'by' will be set to\n\"unknown\".\n\nThe keyword 'by-expr' is used to enable 'by' parameter (\"nodename\") in\nforwarded header. It allows to embed request proxy information.\n'by' value will be set to the result of the sample expression\n<by_expr>, if valid, otherwise it will be set to \"unknown\".\n\nThe keyword 'for' is used to enable 'for' parameter (\"nodename\") in\nforwarded header. It allows to embed request client information.\n'for' value will be set to client ip (source address)\nIf not available (ie: UNIX listener), 'for' will be set to\n\"unknown\".\n\nThe keyword 'for-expr' is used to enable 'for' parameter (\"nodename\") in\nforwarded header. It allows to embed request client information.\n'for' value will be set to the result of the sample expression\n<for_expr>, if valid, otherwise it will be set to \"unknown\".\n\nThe keyword 'by_port' is used to provide \"nodeport\" info to\n'by' parameter. 'by_port' requires 'by' or 'by-expr' to be set or\nit will be ignored.\n\"nodeport\" will be set to proxy (destination) port if available,\notherwise it will be ignored.\n\nThe keyword 'by_port-expr' is used to provide \"nodeport\" info to\n'by' parameter. 'by_port-expr' requires 'by' or 'by-expr' to be set or\nit will be ignored.\n\"nodeport\" will be set to the result of the sample expression\n<by_port_expr>, if valid, otherwise it will be ignored.\n\nThe keyword 'for_port' is used to provide \"nodeport\" info to\n'for' parameter. 'for_port' requires 'for' or 'for-expr' to be set or\nit will be ignored.\n\"nodeport\" will be set to client (source) port if available,\notherwise it will be ignored.\n\nThe keyword 'for_port-expr' is used to provide \"nodeport\" info to\n'for' parameter. 'for_port-expr' requires 'for' or 'for-expr' to be set or\nit will be ignored.\n\"nodeport\" will be set to the result of the sample expression\n<for_port_expr>, if valid, otherwise it will be ignored.\n\n```\n\nExamples :```\n\n# Those servers want the ip address and protocol of the client request\n# Resulting header would look like this:\n#   forwarded: proto=http;for=127.0.0.1\nbackend www_default\n    mode http\n    option forwarded\n    #equivalent to: option forwarded proto for\n\n# Those servers want the requested host and hashed client ip address\n# as well as client source port (you should use seed for xxh32 if ensuring\n# ip privacy is a concern)\n# Resulting header would look like this:\n#   forwarded: host=\"haproxy.org\";for=\"_000000007F2F367E:60138\"\nbackend www_host\n    mode http\n    option forwarded host for-expr src,xxh32,hex for_port\n\n# Those servers want custom data in host, for and by parameters\n# Resulting header would look like this:\n#   forwarded: host=\"host.com\";by=_haproxy;for=\"[::1]:10\"\nbackend www_custom\n    mode http\n    option forwarded host-expr str(host.com) by-expr str(_haproxy) for for_port-expr int(10)\n\n# Those servers want random 'for' obfuscated identifiers for request\n# tracing purposes while protecting sensitive IP information\n# Resulting header would look like this:\n#   forwarded: for=_000000002B1F4D63\nbackend www_for_hide\n    mode http\n    option forwarded for-expr rand,hex\n\n```\n\n**See also :**\"[option forwardfor](#option%20forwardfor)\", \"[option originalto](#option%20originalto)\"**[option forwardfor](#4.2-option%20forwardfor)**[ except<network>][ header<name>][ if-none ]```\nEnable insertion of the X-Forwarded-For header to requests sent to servers\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<network> is an optional argument used to disable this option for sources\n          matching <network>\n<name>    an optional argument to specify a different \"X-Forwarded-For\"\n          header name.\n```\n\n```\nSince HAProxy works in reverse-proxy mode, the servers see its IP address as\ntheir client address. This is sometimes annoying when the client's IP address\nis expected in server logs. To solve this problem, the well-known HTTP header\n\"X-Forwarded-For\" may be added by HAProxy to all requests sent to the server.\nThis header contains a value representing the client's IP address. Since this\nheader is always appended at the end of the existing header list, the server\nmust be configured to always use the last occurrence of this header only. See\nthe server's manual to find how to enable use of this standard header. Note\nthat only the last occurrence of the header must be used, since it is really\npossible that the client has already brought one.\n\nThe keyword \"header\" may be used to supply a different header name to replace\nthe default \"X-Forwarded-For\". This can be useful where you might already\nhave a \"X-Forwarded-For\" header from a different application (e.g. stunnel),\nand you need preserve it. Also if your backend server doesn't use the\n\"X-Forwarded-For\" header and requires different one (e.g. Zeus Web Servers\nrequire \"X-Cluster-Client-IP\").\n\nSometimes, a same HAProxy instance may be shared between a direct client\naccess and a reverse-proxy access (for instance when an SSL reverse-proxy is\nused to decrypt HTTPS traffic). It is possible to disable the addition of the\nheader for a known source address or network by adding the \"except\" keyword\nfollowed by the network address. In this case, any source IP matching the\nnetwork will not cause an addition of this header. Most common uses are with\nprivate networks or 127.0.0.1. IPv4 and IPv6 are both supported.\n\nAlternatively, the keyword \"if-none\" states that the header will only be\nadded if it is not present. This should only be used in perfectly trusted\nenvironment, as this might cause a security issue if headers reaching HAProxy\nare under the control of the end-user.\n\nThis option may be specified either in the frontend or in the backend. If at\nleast one of them uses it, the header will be added. Note that the backend's\nsetting of the header subargument takes precedence over the frontend's if\nboth are defined. In the case of the \"if-none\" argument, if at least one of\nthe frontend or the backend does not specify it, it wants the addition to be\nmandatory, so it wins.\n\n```\n\nExample :```\n\n# Public HTTP address also used by stunnel on the same machine\nfrontend www\n    mode http\n    option forwardfor except 127.0.0.1  # stunnel already adds the header\n\n# Those servers want the IP Address in X-Client\nbackend www\n    mode http\n    option forwardfor header X-Client\n\n```\n\n**See also :**\"[option httpclose](#option%20httpclose)\", \"[option http-server-close](#option%20http-server-close)\", \"[option http-keep-alive](#option%20http-keep-alive)\"**[option h1-case-adjust-bogus-client](#4.2-option%20h1-case-adjust-bogus-client)****[no option h1-case-adjust-bogus-client](#4.2-no%20option%20h1-case-adjust-bogus-client)**```\nEnable or disable the case adjustment of HTTP/1 headers sent to bogus clients\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nThere is no standard case for header names because, as stated in RFC7230,\nthey are case-insensitive. So applications must handle them in a case-\ninsensitive manner. But some bogus applications violate the standards and\nerroneously rely on the cases most commonly used by browsers. This problem\nbecomes critical with HTTP/2 because all header names must be exchanged in\nlower case, and HAProxy follows the same convention. All header names are\nsent in lower case to clients and servers, regardless of the HTTP version.\n\nWhen HAProxy receives an HTTP/1 response, its header names are converted to\nlower case and manipulated and sent this way to the clients. If a client is\nknown to violate the HTTP standards and to fail to process a response coming\nfrom HAProxy, it is possible to transform the lower case header names to a\ndifferent format when the response is formatted and sent to the client, by\nenabling this option and specifying the list of headers to be reformatted\nusing the global directives \"h1-case-adjust\" or \"h1-case-adjust-file\". This\nmust only be a temporary workaround for the time it takes the client to be\nfixed, because clients which require such workarounds might be vulnerable to\ncontent smuggling attacks and must absolutely be fixed.\n\nPlease note that this option will not affect standards-compliant clients.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also:**\"[option h1-case-adjust-bogus-server](#option%20h1-case-adjust-bogus-server)\", \"[h1-case-adjust](#h1-case-adjust)\", \"[h1-case-adjust-file](#h1-case-adjust-file)\".**[option h1-case-adjust-bogus-server](#4.2-option%20h1-case-adjust-bogus-server)****[no option h1-case-adjust-bogus-server](#4.2-no%20option%20h1-case-adjust-bogus-server)**```\nEnable or disable the case adjustment of HTTP/1 headers sent to bogus servers\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nThere is no standard case for header names because, as stated in RFC7230,\nthey are case-insensitive. So applications must handle them in a case-\ninsensitive manner. But some bogus applications violate the standards and\nerroneously rely on the cases most commonly used by browsers. This problem\nbecomes critical with HTTP/2 because all header names must be exchanged in\nlower case, and HAProxy follows the same convention. All header names are\nsent in lower case to clients and servers, regardless of the HTTP version.\n\nWhen HAProxy receives an HTTP/1 request, its header names are converted to\nlower case and manipulated and sent this way to the servers. If a server is\nknown to violate the HTTP standards and to fail to process a request coming\nfrom HAProxy, it is possible to transform the lower case header names to a\ndifferent format when the request is formatted and sent to the server, by\nenabling this option and specifying the list of headers to be reformatted\nusing the global directives \"h1-case-adjust\" or \"h1-case-adjust-file\". This\nmust only be a temporary workaround for the time it takes the server to be\nfixed, because servers which require such workarounds might be vulnerable to\ncontent smuggling attacks and must absolutely be fixed.\n\nPlease note that this option will not affect standards-compliant servers.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also:**\"[option h1-case-adjust-bogus-client](#option%20h1-case-adjust-bogus-client)\", \"[h1-case-adjust](#h1-case-adjust)\", \"[h1-case-adjust-file](#h1-case-adjust-file)\".**[option http-buffer-request](#4.2-option%20http-buffer-request)****[no option http-buffer-request](#4.2-no%20option%20http-buffer-request)**```\nEnable or disable waiting for whole HTTP request body before proceeding\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nIt is sometimes desirable to wait for the body of an HTTP request before\ntaking a decision. This is what is being done by \"balance url_param\" for\nexample. The first use case is to buffer requests from slow clients before\nconnecting to the server. Another use case consists in taking the routing\ndecision based on the request body's contents. This option placed in a\nfrontend or backend forces the HTTP processing to wait until either the whole\nbody is received or the request buffer is full. It can have undesired side\neffects with some applications abusing HTTP by expecting unbuffered\ntransmissions between the frontend and the backend, so this should definitely\nnot be used by default.\n\n```\n\n**See also :**\"[option http-no-delay](#option%20http-no-delay)\", \"[timeout http-request](#timeout%20http-request)\", \"http-request wait-for-body\"**[option http-drop-request-trailers](#4.2-option%20http-drop-request-trailers)****[no option http-drop-request-trailers](#4.2-no%20option%20http-drop-request-trailers)**```\nDrop the HTTP trailers from the request when sent to the server\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnonoyesArguments :none```\nWhen this option is enabled, any HTTP trailers found in a request will be\ndropped before sending it to the server.\n\nRFC9110#section-6.5.1 stated that trailer fields could be merged into the\nheader fields. It should be done on purpose, but it may be a problem for some\napplications, espcially if malicious clients hide sensitive header fields in\nthe trailers part and some intermediaries merge them with headers with no\nspecific checks. In that case, this option can be enabled on the backend to\ndrop any trailer fields found in requests before sending them to the server.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also:**\"[option http-drop-response-trailers](#option%20http-drop-response-trailers)\"**[option http-drop-response-trailers](#4.2-option%20http-drop-response-trailers)****[no option http-drop-response-trailers](#4.2-no%20option%20http-drop-response-trailers)**```\nDrop the HTTP trailers from the response when sent to the client\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nThis option is similar to \"option http-drop-request-trailers\" but it must be\nused to drop trailer fields from responses before sending them to clients.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also:**\"[option http-drop-request-trailers](#option%20http-drop-request-trailers)\"**[option http-ignore-probes](#4.2-option%20http-ignore-probes)****[no option http-ignore-probes](#4.2-no%20option%20http-ignore-probes)**```\nEnable or disable logging of null connections and request timeouts\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nRecently some browsers started to implement a \"pre-connect\" feature\nconsisting in speculatively connecting to some recently visited web sites\njust in case the user would like to visit them. This results in many\nconnections being established to web sites, which end up in 408 Request\nTimeout if the timeout strikes first, or 400 Bad Request when the browser\ndecides to close them first. These ones pollute the log and feed the error\ncounters. There was already \"option dontlognull\" but it's insufficient in\nthis case. Instead, this option does the following things :\n   - prevent any 400/408 message from being sent to the client if nothing\n     was received over a connection before it was closed;\n   - prevent any log from being emitted in this situation;\n   - prevent any error counter from being incremented\n\nThat way the empty connection is silently ignored. Note that it is better\nnot to use this unless it is clear that it is needed, because it will hide\nreal problems. The most common reason for not receiving a request and seeing\na 408 is due to an MTU inconsistency between the client and an intermediary\nelement such as a VPN, which blocks too large packets. These issues are\ngenerally seen with POST requests as well as GET with large cookies. The logs\nare often the only way to detect them.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[log](#)- This keyword is available in sections :\n- [Peers declaration](#log%20%28Peers%20declaration%29)\n- [Log forwarding](#log%20%28Log%20forwarding%29)\n- [Process management and security](#log%20%28Process%20management%20and%20security%29)\n- [Alphabetically sorted keywords reference](#log%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[dontlognull](#option%20dontlognull)\", \"[errorfile](#)- This keyword is available in sections :\n- [HTTP-errors](#errorfile%20%28HTTP-errors%29)\n- [Alphabetically sorted keywords reference](#errorfile%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", and[section 8](#8)about logging.**[option http-keep-alive](#4.2-option%20http-keep-alive)****[no option http-keep-alive](#4.2-no%20option%20http-keep-alive)**```\nEnable or disable HTTP keep-alive from client to server for HTTP/1.x\nconnections\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nBy default HAProxy operates in keep-alive mode with regards to persistent\nHTTP/1.x connections: for each connection it processes each request and\nresponse, and leaves the connection idle on both sides. This mode may be\nchanged by several options such as \"option http-server-close\" or \"option\nhttpclose\". This option allows to set back the keep-alive mode, which can be\nuseful when another mode was used in a defaults section.\n\nSetting \"option http-keep-alive\" enables HTTP keep-alive mode on the client-\nand server- sides. This provides the lowest latency on the client side (slow\nnetwork) and the fastest session reuse on the server side at the expense\nof maintaining idle connections to the servers. In general, it is possible\nwith this option to achieve approximately twice the request rate that the\n\"http-server-close\" option achieves on small objects. There are mainly two\nsituations where this option may be useful :\n\n  - when the server is non-HTTP compliant and authenticates the connection\n    instead of requests (e.g. NTLM authentication)\n\n  - when the cost of establishing the connection to the server is significant\n    compared to the cost of retrieving the associated object from the server.\n\nThis last case can happen when the server is a fast static server of cache.\n\nAt the moment, logs will not indicate whether requests came from the same\nsession or not. The accept date reported in the logs corresponds to the end\nof the previous request, and the request time corresponds to the time spent\nwaiting for a new request. The keep-alive request time is still bound to the\ntimeout defined by \"timeout http-keep-alive\" or \"timeout http-request\" if\nnot set.\n\nThis option disables and replaces any previous \"option httpclose\" or \"option\nhttp-server-close\".\n\n```\n\n**See also :**\"[option httpclose](#option%20httpclose)\",, \"[option http-server-close](#option%20http-server-close)\", \"[option prefer-last-server](#option%20prefer-last-server)\" and \"[option http-pretend-keepalive](#option%20http-pretend-keepalive)\".**[option http-no-delay](#4.2-option%20http-no-delay)****[no option http-no-delay](#4.2-no%20option%20http-no-delay)**```\nInstruct the system to favor low interactive delays over performance in HTTP\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nIn HTTP, each payload is unidirectional and has no notion of interactivity.\nAny agent is expected to queue data somewhat for a reasonably low delay.\nThere are some very rare server-to-server applications that abuse the HTTP\nprotocol and expect the payload phase to be highly interactive, with many\ninterleaved data chunks in both directions within a single request. This is\nabsolutely not supported by the HTTP specification and will not work across\nmost proxies or servers. When such applications attempt to do this through\nHAProxy, it works but they will experience high delays due to the network\noptimizations which favor performance by instructing the system to wait for\nenough data to be available in order to only send full packets. Typical\ndelays are around 200 ms per round trip. Note that this only happens with\nabnormal uses. Normal uses such as CONNECT requests nor WebSockets are not\naffected.\n\nWhen \"option http-no-delay\" is present in either the frontend or the backend\nused by a connection, all such optimizations will be disabled in order to\nmake the exchanges as fast as possible. Of course this offers no guarantee on\nthe functionality, as it may break at any other place. But if it works via\nHAProxy, it will work as fast as possible. This option should never be used\nby default, and should never be used at all unless such a buggy application\nis discovered. The impact of using this option is an increase of bandwidth\nusage and CPU usage, which may significantly lower performance in high\nlatency environments.\n\n```\n\n**See also :**\"[option http-buffer-request](#option%20http-buffer-request)\"**[option http-pretend-keepalive](#4.2-option%20http-pretend-keepalive)****[no option http-pretend-keepalive](#4.2-no%20option%20http-pretend-keepalive)**```\nDefine whether HAProxy will announce keepalive for HTTP/1.x connection to the\nserver or not\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nWhen running with \"option http-server-close\" or \"option httpclose\", HAProxy\nadds a \"Connection: close\" header to the HTTP/1.x request forwarded to the\nserver. Unfortunately, when some servers see this header, they automatically\nrefrain from using the chunked encoding for responses of unknown length,\nwhile this is totally unrelated. The effect is that a client or a cache could\nreceive an incomplete response without being aware of it, and consider the\nresponse complete.\n\nBy setting \"option http-pretend-keepalive\", HAProxy will make the server\nbelieve it will keep the connection alive. The server will then not fall back\nto the abnormal undesired above. When HAProxy gets the whole response, it\nwill close the connection with the server just as it would do with the\n\"option httpclose\". That way the client gets a normal response and the\nconnection is correctly closed on the server side.\n\nIt is recommended not to enable this option by default, because most servers\nwill more efficiently close the connection themselves after the last packet,\nand release its buffers slightly earlier. Also, the added packet on the\nnetwork could slightly reduce the overall peak performance. However it is\nworth noting that when this option is enabled, HAProxy will have slightly\nless work to do. So if HAProxy is the bottleneck on the whole architecture,\nenabling this option might save a few CPU cycles.\n\nThis option may be set in backend and listen sections. Using it in a frontend\nsection will be ignored and a warning will be reported during startup. It is\na backend related option, so there is no real reason to set it on a\nfrontend.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option httpclose](#option%20httpclose)\", \"[option http-server-close](#option%20http-server-close)\", and \"[option http-keep-alive](#option%20http-keep-alive)\"**[option http-restrict-req-hdr-names](#4.2-option%20http-restrict-req-hdr-names)**{ preserve | delete | reject }```\nSet HAProxy policy about HTTP request header names containing characters\noutside the \"[a-zA-Z0-9-]\" charset\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\npreserve  disable the filtering. It is the default mode for HTTP proxies\n          with no FastCGI application configured.\n\ndelete    remove request headers with a name containing a character\n          outside the \"[a-zA-Z0-9-]\" charset. It is the default mode for\n          HTTP backends with a configured FastCGI application.\n\nreject    reject the request with a 403-Forbidden response if it contains a\n          header name with a character outside the \"[a-zA-Z0-9-]\" charset.\n```\n\n```\nThis option may be used to restrict the request header names to alphanumeric\nand hyphen characters ([A-Za-z0-9-]). This may be mandatory to interoperate\nwith non-HTTP compliant servers that fail to handle some characters in header\nnames. It may also be mandatory for FastCGI applications because all\nnon-alphanumeric characters in header names are replaced by an underscore\n('_'). Thus, it is easily possible to mix up header names and bypass some\nrules. For instance, \"X-Forwarded-For\" and \"X_Forwarded-For\" headers are both\nconverted to \"HTTP_X_FORWARDED_FOR\" in FastCGI.\n\nNote this option is evaluated per proxy and after the http-request rules\nevaluation.\n\n```\n\n**[option http-server-close](#4.2-option%20http-server-close)****[no option http-server-close](#4.2-no%20option%20http-server-close)**```\nEnable or disable HTTP/1.x connection closing on the server side\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nBy default HAProxy operates in keep-alive mode with regards to persistent\nHTTP/1.x connections: for each connection it processes each request and\nresponse, and leaves the connection idle on both sides. This mode may be\nchanged by several options such as \"option http-server-close\" or \"option\nhttpclose\". Setting \"option http-server-close\" enables HTTP connection-close\nmode on the server side while keeping the ability to support HTTP keep-alive\nand pipelining on the client side. This provides the lowest latency on the\nclient side (slow network) and the fastest session reuse on the server side\nto save server resources, similarly to \"option httpclose\".  It also permits\nnon-keepalive capable servers to be served in keep-alive mode to the clients\nif they conform to the requirements of RFC7230. Please note that some servers\ndo not always conform to those requirements when they see \"Connection: close\"\nin the request. The effect will be that keep-alive will never be used. A\nworkaround consists in enabling \"option http-pretend-keepalive\".\n\nAt the moment, logs will not indicate whether requests came from the same\nsession or not. The accept date reported in the logs corresponds to the end\nof the previous request, and the request time corresponds to the time spent\nwaiting for a new request. The keep-alive request time is still bound to the\ntimeout defined by \"timeout http-keep-alive\" or \"timeout http-request\" if\nnot set.\n\nThis option may be set both in a frontend and in a backend. It is enabled if\nat least one of the frontend or backend holding a connection has it enabled.\nIt disables and replaces any previous \"option httpclose\" or \"option\nhttp-keep-alive\". Please check section 4 (\"Proxies\") to see how this option\ncombines with others when frontend and backend options differ.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option httpclose](#option%20httpclose)\", \"[option http-pretend-keepalive](#option%20http-pretend-keepalive)\" and \"[option http-keep-alive](#option%20http-keep-alive)\".**[option http-use-proxy-header](#4.2-option%20http-use-proxy-header)****[no option http-use-proxy-header](#4.2-no%20option%20http-use-proxy-header)**```\nMake use of non-standard Proxy-Connection header instead of Connection\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nWhile RFC7230 explicitly states that HTTP/1.1 agents must use the\nConnection header to indicate their wish of persistent or non-persistent\nconnections, both browsers and proxies ignore this header for proxied\nconnections and make use of the undocumented, non-standard Proxy-Connection\nheader instead. The issue begins when trying to put a load balancer between\nbrowsers and such proxies, because there will be a difference between what\nHAProxy understands and what the client and the proxy agree on.\n\nBy setting this option in a frontend, HAProxy can automatically switch to use\nthat non-standard header if it sees proxied requests. A proxied request is\ndefined here as one where the URI begins with neither a '/' nor a '*'. This\nis incompatible with the HTTP tunnel mode. Note that this option can only be\nspecified in a frontend and will affect the request along its whole life.\n\nAlso, when this option is set, a request which requires authentication will\nautomatically switch to use proxy authentication headers if it is itself a\nproxied request. That makes it possible to check or enforce authentication in\nfront of an existing proxy.\n\nThis option should normally never be used, except in front of a proxy.\n\n```\n\n**See also :**\"[option httpclose](#option%20httpclose)\", and \"[option http-server-close](#option%20http-server-close)\".**[option httpchk](#4.2-option%20httpchk)****[option httpchk](#4.2-option%20httpchk)**<uri>**[option httpchk](#4.2-option%20httpchk)**<method><uri>**[option httpchk](#4.2-option%20httpchk)**<method><uri><version>**[option httpchk](#4.2-option%20httpchk)**<method><uri><version><host>```\nEnables HTTP protocol to check on the servers health\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<method>  is the optional HTTP method used with the requests. When not set,\n          the \"OPTIONS\" method is used, as it generally requires low server\n          processing and is easy to filter out from the logs. Any method\n          may be used, though it is not recommended to invent non-standard\n          ones.\n\n<uri>     is the URI referenced in the HTTP requests. It defaults to \" / \"\n          which is accessible by default on almost any server, but may be\n          changed to any other URI. Query strings are permitted.\n\n<version> is the optional HTTP version string. It defaults to \"HTTP/1.0\"\n          but some servers might behave incorrectly in HTTP 1.0, so turning\n          it to HTTP/1.1 may sometimes help. Note that the Host field is\n          mandatory in HTTP/1.1.\n\n<host>    is the optional HTTP Host header value. It is not set by default.\n          It is a log-format string.\n```\n\n```\nBy default, server health checks only consist in trying to establish a TCP\nconnection. When \"option httpchk\" is specified, a complete HTTP request is\nsent once the TCP connection is established, and responses 2xx and 3xx are\nconsidered valid, while all other ones indicate a server failure, including\nthe lack of any response.\n\nCombined with \"http-check\" directives, it is possible to customize the\nrequest sent during the HTTP health checks or the matching rules on the\nresponse. It is also possible to configure a send/expect sequence, just like\nwith the directive \"tcp-check\" for TCP health checks.\n\nThe server configuration is used by default to open connections to perform\nHTTP health checks. By it is also possible to overwrite server parameters\nusing \"http-check connect\" rules.\n\n\"httpchk\" option does not necessarily require an HTTP backend, it also works\nwith plain TCP backends. This is particularly useful to check simple scripts\nbound to some dedicated ports using the inetd daemon. However, it will always\ninternally relies on an HTX multiplexer. Thus, it means the request\nformatting and the response parsing will be strict.\n\n```\n\nExamples :```\n\n# Relay HTTPS traffic to Apache instance and check service availability\n# using HTTP request \"OPTIONS * HTTP/1.1\" on port 80.\nbackend https_relay\n    mode tcp\n    option httpchk OPTIONS * HTTP/1.1\n    http-check send hdr Host www\n    server apache1 192.168.1.1:443 check port 80\n\n```\n\n**See also :**\"[option ssl-hello-chk](#option%20ssl-hello-chk)\", \"[option smtpchk](#option%20smtpchk)\", \"[option mysql-check](#option%20mysql-check)\", \"[option pgsql-check](#option%20pgsql-check)\", \"[http-check](#http-check)\" and the \"[check](#check)\", \"[port](#port)\" and \"[inter](#inter)\" server options.**[option httpclose](#4.2-option%20httpclose)****[no option httpclose](#4.2-no%20option%20httpclose)**```\nEnable or disable HTTP/1.x connection closing\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nBy default HAProxy operates in keep-alive mode with regards to persistent\nHTTP/1.x connections: for each connection it processes each request and\nresponse, and leaves the connection idle on both sides. This mode may be\nchanged by several options such as \"option http-server-close\" or \"option\nhttpclose\".\n\nIf \"option httpclose\" is set, HAProxy will close the client or the server\nconnection, depending where the option is set. The frontend is considered for\nclient connections while the backend is considered for server ones. If the\noption is set on a listener, it is applied both on client and server\nconnections. It will check if a \"Connection: close\" header is already set in\neach direction, and will add one if missing.\n\nThis option may also be combined with \"option http-pretend-keepalive\", which\nwill disable sending of the \"Connection: close\" request header, but will\nstill cause the connection to be closed once the whole response is received.\n\nIt disables and replaces any previous \"option http-server-close\" or \"option\nhttp-keep-alive\".\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option http-server-close](#option%20http-server-close)\".**[option httplog](#4.2-option%20httplog)**[ clf ]```\nEnable logging of HTTP request, stream state and timers\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\nclf       if the \"clf\" argument is added, then the output format will be\n          the CLF format instead of HAProxy's default HTTP format. You can\n          use this when you need to feed HAProxy's logs through a specific\n          log analyzer which only support the CLF format and which is not\n          extensible.\n```\n\n```\nBy default, the log output format is very poor, as it only contains the\nsource and destination addresses, and the instance name. By specifying\n\"option httplog\", each log line turns into a much richer format including,\nbut not limited to, the HTTP request, the connection timers, the stream\nstatus, the connections numbers, the captured headers and cookies, the\nfrontend, backend and server name, and of course the source address and\nports.\n\nSpecifying only \"option httplog\" will automatically clear the 'clf' mode\nif it was set by default.\n\n\"option httplog\" overrides any previous \"log-format\" directive.\n\n```\n\n**See also :**[section 8](#8)about logging.**[option httpslog](#4.2-option%20httpslog)**```\nEnable logging of HTTPS request, stream state and timers\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesno```\nBy default, the log output format is very poor, as it only contains the\nsource and destination addresses, and the instance name. By specifying\n\"option httpslog\", each log line turns into a much richer format including,\nbut not limited to, the HTTP request, the connection timers, the stream\nstatus, the connections numbers, the captured headers and cookies, the\nfrontend, backend and server name, the SSL certificate verification and SSL\nhandshake statuses, and of course the source address and ports.\n\n\"option httpslog\" overrides any previous \"log-format\" directive.\n\n```\n\n**See also :**[section 8](#8)about logging.**[option independent-streams](#4.2-option%20independent-streams)****[no option independent-streams](#4.2-no%20option%20independent-streams)**```\nEnable or disable independent timeout processing for both directions\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nBy default, when data is sent over a socket, both the write timeout and the\nread timeout for that socket are refreshed, because we consider that there is\nactivity on that socket, and we have no other means of guessing if we should\nreceive data or not.\n\nWhile this default behavior is desirable for almost all applications, there\nexists a situation where it is desirable to disable it, and only refresh the\nread timeout if there are incoming data. This happens on streams with large\ntimeouts and low amounts of exchanged data such as telnet session. If the\nserver suddenly disappears, the output data accumulates in the system's\nsocket buffers, both timeouts are correctly refreshed, and there is no way\nto know the server does not receive them, so we don't timeout. However, when\nthe underlying protocol always echoes sent data, it would be enough by itself\nto detect the issue using the read timeout. Note that this problem does not\nhappen with more verbose protocols because data won't accumulate long in the\nsocket buffers.\n\nWhen this option is set on the frontend, it will disable read timeout updates\non data sent to the client. There probably is little use of this case. When\nthe option is set on the backend, it will disable read timeout updates on\ndata sent to the server. Doing so will typically break large HTTP posts from\nslow lines, so use it with caution.\n\n```\n\n**See also :**\"[timeout client](#)- This keyword is available in sections :\n- [Log forwarding](#timeout%20client%20%28Log%20forwarding%29)\n- [Alphabetically sorted keywords reference](#timeout%20client%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[timeout server](#)- This keyword is available in sections :\n- [Rings](#timeout%20server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#timeout%20server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\" and \"[timeout tunnel](#timeout%20tunnel)\"**[option ldap-check](#4.2-option%20ldap-check)**```\nUse LDAPv3 health checks for server testing\n\nMay be used in the following contexts: tcp\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nIt is possible to test that the server correctly talks LDAPv3 instead of just\ntesting that it accepts the TCP connection. When this option is set, an\nLDAPv3 anonymous simple bind message is sent to the server, and the response\nis analyzed to find an LDAPv3 bind response message.\n\nThe server is considered valid only when the LDAP response contains success\nresultCode (http://tools.ietf.org/html/rfc4511#section-4.1.9).\n\nLogging of bind requests is server dependent see your documentation how to\nconfigure it.\n\n```\n\nExample :```\n\noption ldap-check\n\n```\n\n**See also :**\"[option httpchk](#option%20httpchk)\"**[option external-check](#4.2-option%20external-check)**```\nUse external processes for server health checks\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyes```\nIt is possible to test the health of a server using an external command.\nThis is achieved by running the executable set using \"external-check\ncommand\".\n\nRequires the \"external-checkThis keyword is available in sections :Process management and securityAlphabetically sorted keywords reference\" global to be set.\n\n```\n\n**See also :**\"[external-check](#)- This keyword is available in sections :\n- [Process management and security](#external-check%20%28Process%20management%20and%20security%29)\n- [Alphabetically sorted keywords reference](#external-check%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[external-check command](#external-check%20command)\", \"[external-check path](#external-check%20path)\"**[option idle-close-on-response](#4.2-option%20idle-close-on-response)****[no option idle-close-on-response](#4.2-no%20option%20idle-close-on-response)**```\nAvoid closing idle frontend connections if a soft stop is in progress\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nBy default, idle connections will be closed during a soft stop. In some\nenvironments, a client talking to the proxy may have prepared some idle\nconnections in order to send requests later. If there is no proper retry on\nwrite errors, this can result in errors while haproxy is reloading. Even\nthough a proper implementation should retry on connection/write errors, this\noption was introduced to support backwards compatibility with haproxy prior\nto version 2.4. Indeed before v2.4, haproxy used to wait for a last request\nand response to add a \"connection: close\" header before closing, thus\nnotifying the client that the connection would not be reusable.\n\nIn a real life example, this behavior was seen in AWS using the ALB in front\nof a haproxy. The end result was ALB sending 502 during haproxy reloads.\n\nUsers are warned that using this option may increase the number of old\nprocesses if connections remain idle for too long. Adjusting the client\ntimeouts and/or the \"hard-stop-after\" parameter accordingly might be\nneeded in case of frequent reloads.\n\n```\n\n**See also:**\"[timeout client](#)- This keyword is available in sections :\n- [Log forwarding](#timeout%20client%20%28Log%20forwarding%29)\n- [Alphabetically sorted keywords reference](#timeout%20client%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[timeout client-fin](#timeout%20client-fin)\", \"[timeout http-request](#timeout%20http-request)\", \"[hard-stop-after](#hard-stop-after)\"**[option log-health-checks](#4.2-option%20log-health-checks)****[no option log-health-checks](#4.2-no%20option%20log-health-checks)**```\nEnable or disable logging of health checks status updates\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nBy default, failed health check are logged if server is UP and successful\nhealth checks are logged if server is DOWN, so the amount of additional\ninformation is limited.\n\nWhen this option is enabled, any change of the health check status or to\nthe server's health will be logged, so that it becomes possible to know\nthat a server was failing occasional checks before crashing, or exactly when\nit failed to respond a valid HTTP status, then when the port started to\nreject connections, then when the server stopped responding at all.\n\nNote that status changes not caused by health checks (e.g. enable/disable on\nthe CLI) are intentionally not logged by this option.\n\n```\n\n**See also:**\"[option httpchk](#option%20httpchk)\", \"[option ldap-check](#option%20ldap-check)\", \"[option mysql-check](#option%20mysql-check)\", \"[option pgsql-check](#option%20pgsql-check)\", \"[option redis-check](#option%20redis-check)\", \"[option smtpchk](#option%20smtpchk)\", \"[option tcp-check](#option%20tcp-check)\", \"[log](#)- This keyword is available in sections :\n- [Peers declaration](#log%20%28Peers%20declaration%29)\n- [Log forwarding](#log%20%28Log%20forwarding%29)\n- [Process management and security](#log%20%28Process%20management%20and%20security%29)\n- [Alphabetically sorted keywords reference](#log%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\" and[section 8](#8)about logging.**[option log-separate-errors](#4.2-option%20log-separate-errors)****[no option log-separate-errors](#4.2-no%20option%20log-separate-errors)**```\nChange log level for non-completely successful connections\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nSometimes looking for errors in logs is not easy. This option makes HAProxy\nraise the level of logs containing potentially interesting information such\nas errors, timeouts, retries, redispatches, or HTTP status codes 5xx. The\nlevel changes from \"info\" to \"err\". This makes it possible to log them\nseparately to a different file with most syslog daemons. Be careful not to\nremove them from the original file, otherwise you would lose ordering which\nprovides very important information.\n\nUsing this option, large sites dealing with several thousand connections per\nsecond may log normal traffic to a rotating buffer and only archive smaller\nerror logs.\n\n```\n\n**See also :**\"[log](#)- This keyword is available in sections :\n- [Peers declaration](#log%20%28Peers%20declaration%29)\n- [Log forwarding](#log%20%28Log%20forwarding%29)\n- [Process management and security](#log%20%28Process%20management%20and%20security%29)\n- [Alphabetically sorted keywords reference](#log%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[dontlognull](#option%20dontlognull)\", \"[dontlog-normal](#option%20dontlog-normal)\" and[section 8](#8)about logging.**[option logasap](#4.2-option%20logasap)****[no option logasap](#4.2-no%20option%20logasap)**```\nEnable or disable early logging.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nBy default, logs are emitted when all the log format aliases and sample\nfetches used in the definition of the log-format string return a value, or\nwhen the stream is terminated. This allows the built in log-format strings\nto account for the transfer time, or the number of bytes in log messages.\n\nWhen handling long lived connections such as large file transfers or RDP,\nit may take a while for the request or connection to appear in the logs.\nUsing \"option logasap\", the log message is created as soon as the server\nconnection is established in mode tcp, or as soon as the server sends the\ncomplete headers in mode http. Missing information in the logs will be the\ntotal number of bytes which will only indicate the amount of data transferred\nbefore the message was created and the total time which will not take the\nremainder of the connection life or transfer time into account. For the case\nof HTTP, it is good practice to capture the Content-Length response header\nso that the logs at least indicate how many bytes are expected to be\ntransferred.\n\n```\n\nExamples :```\n\n  listen http_proxy 0.0.0.0:80\n      mode http\n      option httplog\n      option logasap\n      log 192.168.2.200 local3\n\n>>> Feb  6 12:14:14 localhost \\\n      haproxy[14389]: 10.0.1.2:33317 [06/Feb/2009:12:14:14.655] http-in \\\n      static/srv1 9/10/7/14/+30 200 +243 - - ---- 3/1/1/1/0 1/0 \\\n      \"GET /image.iso HTTP/1.0\"\n\n```\n\n**See also :**\"[option httplog](#option%20httplog)\", \"[capture response header](#capture%20response%20header)\", and[section 8](#8)about logging.**[option mysql-check](#4.2-option%20mysql-check)**[ user<username>[{ post-41 | pre-41 }]]```\nUse MySQL health checks for server testing\n\nMay be used in the following contexts: tcp\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<username> This is the username which will be used when connecting to MySQL\n           server.\npost-41    Send post v4.1 client compatible checks (the default)\npre-41     Send pre v4.1 client compatible checks\n```\n\n```\nIf you specify a username, the check consists of sending two MySQL packet,\none Client Authentication packet, and one QUIT packet, to correctly close\nMySQL session. We then parse the MySQL Handshake Initialization packet and/or\nError packet. It is a basic but useful test which does not produce error nor\naborted connect on the server. However, it requires an unlocked authorised\nuser without a password. To create a basic limited user in MySQL with\noptional resource limits:\n\n    CREATE USER '<username>'@'<ip_of_haproxy|network_of_haproxy/netmask>'\n    /*!50701 WITH MAX_QUERIES_PER_HOUR 1 MAX_UPDATES_PER_HOUR 0 */\n    /*M!100201 MAX_STATEMENT_TIME 0.0001 */;\n\nIf you don't specify a username (it is deprecated and not recommended), the\ncheck only consists in parsing the Mysql Handshake Initialization packet or\nError packet, we don't send anything in this mode. It was reported that it\ncan generate lockout if check is too frequent and/or if there is not enough\ntraffic. In fact, you need in this case to check MySQL \"max_connect_errors\"\nvalue as if a connection is established successfully within fewer than MySQL\n\"max_connect_errors\" attempts after a previous connection was interrupted,\nthe error count for the host is cleared to zero. If HAProxy's server get\nblocked, the \"FLUSH HOSTS\" statement is the only way to unblock it.\n\nRemember that this does not check database presence nor database consistency.\nTo do this, you can use an external check with xinetd for example.\n\nThe check requires MySQL >=3.22, for older version, please use TCP check.\n\nMost often, an incoming MySQL server needs to see the client's IP address for\nvarious purposes, including IP privilege matching and connection logging.\nWhen possible, it is often wise to masquerade the client's IP address when\nconnecting to the server using the \"usesrc\" argument of the \"sourceThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\" keyword,\nwhich requires the transparent proxy feature to be compiled in, and the MySQL\nserver to route the client via the machine hosting HAProxy.\n\n```\n\n**See also:**\"[option httpchk](#option%20httpchk)\"**[option nolinger](#4.2-option%20nolinger)****[no option nolinger](#4.2-no%20option%20nolinger)**```\nEnable or disable immediate session resource cleaning after close\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nWhen clients or servers abort connections in a dirty way (e.g. they are\nphysically disconnected), the session timeouts triggers and the session is\nclosed. But it will remain in FIN_WAIT1 state for some time in the system,\nusing some resources and possibly limiting the ability to establish newer\nconnections.\n\nWhen this happens, it is possible to activate \"option nolinger\" which forces\nthe system to immediately remove any socket's pending data on close. Thus,\na TCP RST is emitted, any pending data are truncated, and the session is\ninstantly purged from the system's tables. The generally visible effect for\na client is that responses are truncated if the close happens with a last\nblock of data (e.g. on a redirect or error response). On the server side,\nit may help release the source ports immediately when forwarding a client\naborts in tunnels. In both cases, TCP resets are emitted and given that\nthe session is instantly destroyed, there will be no retransmit. On a lossy\nnetwork this can increase problems, especially when there is a firewall on\nthe lossy side, because the firewall might see and process the reset (hence\npurge its session) and block any further traffic for this session,, including\nretransmits from the other side. So if the other side doesn't receive it,\nit will never receive any RST again, and the firewall might log many blocked\npackets.\n\nFor all these reasons, it is strongly recommended NOT to use this option,\nunless absolutely needed as a last resort. In most situations, using the\n\"client-fin\" or \"server-fin\" timeouts achieves similar results with a more\nreliable behavior. On Linux it's also possible to use the \"tcp-utThis keyword is available in sections :Bind optionsServer and default-server options\" bind or\nserver setting.\n\nThis option may be used both on frontends and backends, depending on the side\nwhere it is required. Use it on the frontend for clients, and on the backend\nfor servers. While this option is technically supported in \"defaults\"\nsections, it must really not be used there as it risks to accidentally\npropagate to sections that must no use it and to cause problems there.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also:**\"[timeout client-fin](#timeout%20client-fin)\", \"[timeout server-fin](#timeout%20server-fin)\", \"[tcp-ut](#)- This keyword is available in sections :\n- [Bind options](#tcp-ut%20%28Bind%20options%29)\n- [Server and default-server options](#tcp-ut%20%28Server%20and%20default-server%20options%29)\n\n\" bind or server keywords.**[option originalto](#4.2-option%20originalto)**[ except<network>][ header<name>]```\nEnable insertion of the X-Original-To header to requests sent to servers\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<network> is an optional argument used to disable this option for sources\n          matching <network>\n<name>    an optional argument to specify a different \"X-Original-To\"\n          header name.\n```\n\n```\nSince HAProxy can work in transparent mode, every request from a client can\nbe redirected to the proxy and HAProxy itself can proxy every request to a\ncomplex SQUID environment and the destination host from SO_ORIGINAL_DST will\nbe lost. This is annoying when you want access rules based on destination ip\naddresses. To solve this problem, a new HTTP header \"X-Original-To\" may be\nadded by HAProxy to all requests sent to the server. This header contains a\nvalue representing the original destination IP address. Since this must be\nconfigured to always use the last occurrence of this header only. Note that\nonly the last occurrence of the header must be used, since it is really\npossible that the client has already brought one.\n\nThe keyword \"header\" may be used to supply a different header name to replace\nthe default \"X-Original-To\". This can be useful where you might already\nhave a \"X-Original-To\" header from a different application, and you need\npreserve it. Also if your backend server doesn't use the \"X-Original-To\"\nheader and requires different one.\n\nSometimes, a same HAProxy instance may be shared between a direct client\naccess and a reverse-proxy access (for instance when an SSL reverse-proxy is\nused to decrypt HTTPS traffic). It is possible to disable the addition of the\nheader for a known destination address or network by adding the \"except\"\nkeyword followed by the network address. In this case, any destination IP\nmatching the network will not cause an addition of this header. Most common\nuses are with private networks or 127.0.0.1. IPv4 and IPv6 are both\nsupported.\n\nThis option may be specified either in the frontend or in the backend. If at\nleast one of them uses it, the header will be added. Note that the backend's\nsetting of the header subargument takes precedence over the frontend's if\nboth are defined.\n\n```\n\nExamples :```\n\n# Original Destination address\nfrontend www\n    mode http\n    option originalto except 127.0.0.1\n\n# Those servers want the IP Address in X-Client-Dst\nbackend www\n    mode http\n    option originalto header X-Client-Dst\n\n```\n\n**See also :**\"[option httpclose](#option%20httpclose)\", \"[option http-server-close](#option%20http-server-close)\".**[option persist](#4.2-option%20persist)****[no option persist](#4.2-no%20option%20persist)**```\nEnable or disable forced persistence on down servers\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nWhen an HTTP request reaches a backend with a cookie which references a dead\nserver, by default it is redispatched to another server. It is possible to\nforce the request to be sent to the dead server first using \"option persist\"\nif absolutely needed. A common use case is when servers are under extreme\nload and spend their time flapping. In this case, the users would still be\ndirected to the server they opened the session on, in the hope they would be\ncorrectly served. It is recommended to use \"option redispatch\" in conjunction\nwith this option so that in the event it would not be possible to connect to\nthe server at all (server definitely dead), the client would finally be\nredirected to another valid server.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option redispatch](#option%20redispatch)\", \"[retries](#retries)\", \"[force-persist](#force-persist)\"**[option pgsql-check user](#4.2-option%20pgsql-check%20user)**<username>```\nUse PostgreSQL health checks for server testing\n\nMay be used in the following contexts: tcp\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<username> This is the username which will be used when connecting to\n           PostgreSQL server.\n```\n\n```\nThe check sends a PostgreSQL StartupMessage and waits for either\nAuthentication request or ErrorResponse message. It is a basic but useful\ntest which does not produce error nor aborted connect on the server.\nThis check is identical with the \"mysql-check\".\n\n```\n\n**See also:**\"[option httpchk](#option%20httpchk)\"**[option prefer-last-server](#4.2-option%20prefer-last-server)****[no option prefer-last-server](#4.2-no%20option%20prefer-last-server)**```\nAllow multiple load balanced requests to remain on the same server\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nWhen the load balancing algorithm in use is not deterministic, and a previous\nrequest was sent to a server to which HAProxy still holds a connection, it is\nsometimes desirable that subsequent requests on a same session go to the same\nserver as much as possible. Note that this is different from persistence, as\nwe only indicate a preference which HAProxy tries to apply without any form\nof warranty. The real use is for keep-alive connections sent to servers. When\nthis option is used, HAProxy will try to reuse the same connection that is\nattached to the server instead of rebalancing to another server, causing a\nclose of the connection. This can make sense for static file servers. It does\nnot make much sense to use this in combination with hashing algorithms. Note,\nHAProxy already automatically tries to stick to a server which sends a 401 or\nto a proxy which sends a 407 (authentication required), when the load\nbalancing algorithm is not deterministic. This is mandatory for use with the\nbroken NTLM authentication challenge, and significantly helps in\ntroubleshooting some faulty applications. Option prefer-last-server might be\ndesirable in these environments as well, to avoid redistributing the traffic\nafter every other response.\n\nIt may be useful to precise here, which load balancing algorithms are\nconsidered deterministic. Deterministic algorithms will always select the same\nserver for a given client data, assuming the set of available servers has not\nchanged. In general, deterministic algorithms involve hasing or lookups on the\nincoming requests to choose the target server. However, this is not always the\ncase; \"static-rr\", for example, can be also considered as deterministic because\nthe server choice is based on the server's static weight, making the selection\npredictable. \"sticky\" algorithm provides deterministic routing for the\nreturning clients.\n\nAs for non-deterministic algorithms, these algorithms select a server based on\ndynamic server state or simple rotation, so two consecutive requests are not\nguaranteed to land on the same server. option prefer-last-server is designed\nspecifically for these. roundrobin, leastconn are examples of such algorithms.\n\nIf this option has been enabled in a \"defaults\" section, it can be\ndisabled in a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also:**\"[option http-keep-alive](#option%20http-keep-alive)\"**[option redispatch](#4.2-option%20redispatch)****[option redispatch](#4.2-option%20redispatch)**<interval>**[no option redispatch](#4.2-no%20option%20redispatch)**```\nEnable or disable session redistribution in case of connection failure\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<interval> The optional integer value that controls how often redispatches\n           occur when retrying connections. Positive value P indicates a\n           redispatch is desired on every Pth retry, and negative value\n           N indicate a redispatch is desired on the Nth retry prior to the\n           last retry. For example, the default of -1 preserves the\n           historical behavior of redispatching on the last retry, a\n           positive value of 1 would indicate a redispatch on every retry,\n           and a positive value of 3 would indicate a redispatch on every\n           third retry. You can disable redispatches with a value of 0.\n```\n\n```\nIn HTTP mode, if a server designated by a cookie is down, clients may\ndefinitely stick to it, for example when using \"option persist\" or\n\"force-persist\", because they cannot flush the cookie, so they will not\nbe able to access the service anymore.\n\nSpecifying \"option redispatch\" will allow the proxy to break cookie or\nconsistent hash based persistence and redistribute them to a working server.\n\nActive servers are selected from a subset of the list of available\nservers. Active servers that are not down or in maintenance (i.e., whose\nhealth is not checked or that have been checked as \"up\"), are selected in the\nfollowing order:\n\n  1. Any active, non-backup server, if any, or,\n\n  2. If the \"allbackups\" option is not set, the first backup server in the\n     list, or\n\n  3. If the \"allbackups\" option is set, any backup server.\n\nWhen a retry occurs, HAProxy tries to select another server than the last\none. The new server is selected from the current list of servers.\n\nSometimes, if the list is updated between retries (e.g., if numerous retries\noccur and last longer than the time needed to check that a server is down,\nremove it from the list and fall back on the list of backup servers),\nconnections may be redirected to a backup server, though.\n\nIt also allows to retry connections to another server in case of multiple\nconnection failures. Of course, it requires having \"retries\" set to a nonzero\nvalue.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option persist](#option%20persist)\", \"[force-persist](#force-persist)\", \"[retries](#retries)\"**[option redis-check](#4.2-option%20redis-check)**```\nUse redis health checks for server testing\n\nMay be used in the following contexts: tcp\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nIt is possible to test that the server correctly talks REDIS protocol instead\nof just testing that it accepts the TCP connection. When this option is set,\na PING redis command is sent to the server, and the response is analyzed to\nfind the \"+PONG\" response message.\n\n```\n\nExample :```\n\noption redis-check\n\n```\n\n**See also :**\"[option httpchk](#option%20httpchk)\", \"[option tcp-check](#option%20tcp-check)\", \"[tcp-check expect](#tcp-check%20expect)\"**[option smtpchk](#4.2-option%20smtpchk)****[option smtpchk](#4.2-option%20smtpchk)**<hello><domain>```\nUse SMTP health checks for server testing\n\nMay be used in the following contexts: tcp\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<hello>   is an optional argument. It is the \"hello\" command to use. It can\n          be either \"HELO\" (for SMTP) or \"EHLO\" (for ESMTP). All other\n          values will be turned into the default command (\"HELO\").\n\n<domain>  is the domain name to present to the server. It may only be\n          specified (and is mandatory) if the hello command has been\n          specified. By default, \"localhost\" is used.\n```\n\n```\nWhen \"option smtpchk\" is set, the health checks will consist in TCP\nconnections followed by an SMTP command. By default, this command is\n\"HELO localhost\". The server's return code is analyzed and only return codes\nstarting with a \"2\" will be considered as valid. All other responses,\nincluding a lack of response will constitute an error and will indicate a\ndead server.\n\nThis test is meant to be used with SMTP servers or relays. Depending on the\nrequest, it is possible that some servers do not log each connection attempt,\nso you may want to experiment to improve the behavior. Using telnet on port\n25 is often easier than adjusting the configuration.\n\nMost often, an incoming SMTP server needs to see the client's IP address for\nvarious purposes, including spam filtering, anti-spoofing and logging. When\npossible, it is often wise to masquerade the client's IP address when\nconnecting to the server using the \"usesrc\" argument of the \"sourceThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\" keyword,\nwhich requires the transparent proxy feature to be compiled in.\n\n```\n\nExample :```\n\noption smtpchk HELO mydomain.org\n\n```\n\n**See also :**\"[option httpchk](#option%20httpchk)\", \"[source](#)- This keyword is available in sections :\n- [Alphabetically sorted keywords reference](#source%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Server and default-server options](#source%20%28Server%20and%20default-server%20options%29)\n\n\"**[option socket-stats](#4.2-option%20socket-stats)****[no option socket-stats](#4.2-no%20option%20socket-stats)**```\nEnable or disable collecting & providing separate statistics for each socket.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none**[option splice-auto](#4.2-option%20splice-auto)****[no option splice-auto](#4.2-no%20option%20splice-auto)**```\nEnable or disable automatic kernel acceleration on sockets in both directions\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nWhen this option is enabled either on a frontend or on a backend, HAProxy\nwill automatically evaluate the opportunity to use kernel tcp splicing to\nforward data between the client and the server, in either direction. HAProxy\nuses heuristics to estimate if kernel splicing might improve performance or\nnot. Both directions are handled independently. Note that the heuristics used\nare not much aggressive in order to limit excessive use of splicing. This\noption requires splicing to be enabled at compile time, and may be globally\ndisabled with the global option \"nosplice\". Since splice uses pipes, using it\nrequires that there are enough spare pipes.\n\nImportant note: kernel-based TCP splicing is a Linux-specific feature which\nfirst appeared in kernel 2.6.25. It offers kernel-based acceleration to\ntransfer data between sockets without copying these data to user-space, thus\nproviding noticeable performance gains and CPU cycles savings. Since many\nearly implementations are buggy, corrupt data and/or are inefficient, this\nfeature is not enabled by default, and it should be used with extreme care.\nWhile it is not possible to detect the correctness of an implementation,\n2.6.29 is the first version offering a properly working implementation. In\ncase of doubt, splicing may be globally disabled using the global \"nosplice\"\nkeyword.\n\n```\n\nExample :```\n\noption splice-auto\n\n```\n\n```\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option splice-request](#option%20splice-request)\", \"[option splice-response](#option%20splice-response)\", and global options \"[nosplice](#nosplice)\" and \"[maxpipes](#maxpipes)\"**[option splice-request](#4.2-option%20splice-request)****[no option splice-request](#4.2-no%20option%20splice-request)**```\nEnable or disable automatic kernel acceleration on sockets for requests\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nWhen this option is enabled either on a frontend or on a backend, HAProxy\nwill use kernel tcp splicing whenever possible to forward data going from\nthe client to the server. It might still use the recv/send scheme if there\nare no spare pipes left. This option requires splicing to be enabled at\ncompile time, and may be globally disabled with the global option \"nosplice\".\nSince splice uses pipes, using it requires that there are enough spare pipes.\n\nImportant note: see \"option splice-auto\" for usage limitations.\n\n```\n\nExample :```\n\noption splice-request\n\n```\n\n```\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option splice-auto](#option%20splice-auto)\", \"[option splice-response](#option%20splice-response)\", and global options \"[nosplice](#nosplice)\" and \"[maxpipes](#maxpipes)\"**[option splice-response](#4.2-option%20splice-response)****[no option splice-response](#4.2-no%20option%20splice-response)**```\nEnable or disable automatic kernel acceleration on sockets for responses\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nWhen this option is enabled either on a frontend or on a backend, HAProxy\nwill use kernel tcp splicing whenever possible to forward data going from\nthe server to the client. It might still use the recv/send scheme if there\nare no spare pipes left. This option requires splicing to be enabled at\ncompile time, and may be globally disabled with the global option \"nosplice\".\nSince splice uses pipes, using it requires that there are enough spare pipes.\n\nImportant note: see \"option splice-auto\" for usage limitations.\n\n```\n\nExample :```\n\noption splice-response\n\n```\n\n```\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option splice-auto](#option%20splice-auto)\", \"[option splice-request](#option%20splice-request)\", and global options \"[nosplice](#nosplice)\" and \"[maxpipes](#maxpipes)\"**[option spop-check](#4.2-option%20spop-check)**```\nUse SPOP health checks for server testing\n\nMay be used in the following contexts: tcp\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nIt is possible to test that the server correctly talks SPOP protocol instead\nof just testing that it accepts the TCP connection. When this option is set,\na HELLO handshake is performed between HAProxy and the server, and the\nresponse is analyzed to check no error is reported.\n\n```\n\nExample :```\n\noption spop-check\n\n```\n\n**See also :**\"[option httpchk](#option%20httpchk)\"**[option srvtcpka](#4.2-option%20srvtcpka)****[no option srvtcpka](#4.2-no%20option%20srvtcpka)**```\nEnable or disable the sending of TCP keepalive packets on the server side\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nWhen there is a firewall or any session-aware component between a client and\na server, and when the protocol involves very long sessions with long idle\nperiods (e.g. remote desktops), there is a risk that one of the intermediate\ncomponents decides to expire a session which has remained idle for too long.\n\nEnabling socket-level TCP keep-alives makes the system regularly send packets\nto the other end of the connection, leaving it active. The delay between\nkeep-alive probes is controlled by the system only and depends both on the\noperating system and its tuning parameters.\n\nIt is important to understand that keep-alive packets are neither emitted nor\nreceived at the application level. It is only the network stacks which sees\nthem. For this reason, even if one side of the proxy already uses keep-alives\nto maintain its connection alive, those keep-alive packets will not be\nforwarded to the other side of the proxy.\n\nPlease note that this has nothing to do with HTTP keep-alive.\n\nUsing option \"srvtcpka\" enables the emission of TCP keep-alive probes on the\nserver side of a connection, which should help when session expirations are\nnoticed between HAProxy and a server.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option clitcpka](#option%20clitcpka)\", \"[option tcpka](#option%20tcpka)\"**[option ssl-hello-chk](#4.2-option%20ssl-hello-chk)**```\nUse SSLv3 client hello health checks for server testing\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nWhen some SSL-based protocols are relayed in TCP mode through HAProxy, it is\npossible to test that the server correctly talks SSL instead of just testing\nthat it accepts the TCP connection. When \"option ssl-hello-chk\" is set, pure\nSSLv3 client hello messages are sent once the connection is established to\nthe server, and the response is analyzed to find an SSL server hello message.\nThe server is considered valid only when the response contains this server\nhello message.\n\nAll servers tested till there correctly reply to SSLv3 client hello messages,\nand most servers tested do not even log the requests containing only hello\nmessages, which is appreciable.\n\nNote that this check works even when SSL support was not built into HAProxy\nbecause it forges the SSL message. When SSL support is available, it is best\nto use native SSL health checks instead of this one.\n\n```\n\n**See also:**\"[option httpchk](#option%20httpchk)\", \"[check-ssl](#check-ssl)\"**[option tcp-check](#4.2-option%20tcp-check)**```\nPerform health checks using tcp-check send/expect sequences\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyes```\nThis health check method is intended to be combined with \"tcp-check\" command\nlists in order to support send/expect types of health check sequences.\n\nTCP checks currently support 4 modes of operations :\n  - no \"tcp-check\" directive : the health check only consists in a connection\n    attempt, which remains the default mode.\n\n  - \"tcp-check send\" or \"tcp-check send-binary\" only is mentioned : this is\n    used to send a string along with a connection opening. With some\n    protocols, it helps sending a \"QUIT\" message for example that prevents\n    the server from logging a connection error for each health check. The\n    check result will still be based on the ability to open the connection\n    only.\n\n  - \"tcp-check expect\" only is mentioned : this is used to test a banner.\n    The connection is opened and HAProxy waits for the server to present some\n    contents which must validate some rules. The check result will be based\n    on the matching between the contents and the rules. This is suited for\n    POP, IMAP, SMTP, FTP, SSH, TELNET.\n\n  - both \"tcp-check send\" and \"tcp-check expect\" are mentioned : this is\n    used to test a hello-type protocol. HAProxy sends a message, the server\n    responds and its response is analyzed. the check result will be based on\n    the matching between the response contents and the rules. This is often\n    suited for protocols which require a binding or a request/response model.\n    LDAP, MySQL, Redis and SSL are example of such protocols, though they\n    already all have their dedicated checks with a deeper understanding of\n    the respective protocols.\n    In this mode, many questions may be sent and many answers may be\n    analyzed.\n\nA fifth mode can be used to insert comments in different steps of the script.\n\nFor each tcp-check rule you create, you can add a \"comment\" directive,\nfollowed by a string. This string will be reported in the log and stderr in\ndebug mode. It is useful to make user-friendly error reporting.  The\n\"comment\" is of course optional.\n\nDuring the execution of a health check, a variable scope is made available to\nstore data samples, using the \"tcp-check set-var\" operation. Freeing those\nvariable is possible using \"tcp-check unset-var\".\n\n```\n\nExamples :```\n\n# perform a POP check (analyze only server's banner)\noption tcp-check\ntcp-check expect string +OK\\ POP3\\ ready comment POP\\ protocol\n\n# perform an IMAP check (analyze only server's banner)\noption tcp-check\ntcp-check expect string *\\ OK\\ IMAP4\\ ready comment IMAP\\ protocol\n\n# look for the redis master server after ensuring it speaks well\n# redis protocol, then it exits properly.\n# (send a command then analyze the response 3 times)\noption tcp-check\ntcp-check comment PING\\ phase\ntcp-check send PING\\r\\n\ntcp-check expect string +PONG\ntcp-check comment role\\ check\ntcp-check send info\\ replication\\r\\n\ntcp-check expect string role:master\ntcp-check comment QUIT\\ phase\ntcp-check send QUIT\\r\\n\ntcp-check expect string +OK\n\nforge a HTTP request, then analyze the response\n(send many headers before analyzing)\noption tcp-check\ntcp-check comment forge\\ and\\ send\\ HTTP\\ request\ntcp-check send HEAD\\ /\\ HTTP/1.1\\r\\n\ntcp-check send Host:\\ www.mydomain.com\\r\\n\ntcp-check send User-Agent:\\ HAProxy\\ tcpcheck\\r\\n\ntcp-check send \\r\\n\ntcp-check expect rstring HTTP/1\\..\\ (2..|3..) comment check\\ HTTP\\ response\n\n```\n\n**See also :**\"[tcp-check connect](#tcp-check%20connect)\", \"[tcp-check expect](#tcp-check%20expect)\" and \"[tcp-check send](#tcp-check%20send)\".**[option tcp-smart-accept](#4.2-option%20tcp-smart-accept)****[no option tcp-smart-accept](#4.2-no%20option%20tcp-smart-accept)**```\nEnable or disable the saving of one ACK packet during the accept sequence\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :none```\nWhen an HTTP connection request comes in, the system acknowledges it on\nbehalf of HAProxy, then the client immediately sends its request, and the\nsystem acknowledges it too while it is notifying HAProxy about the new\nconnection. HAProxy then reads the request and responds. This means that we\nhave one TCP ACK sent by the system for nothing, because the request could\nvery well be acknowledged by HAProxy when it sends its response.\n\nFor this reason, in HTTP mode, HAProxy automatically asks the system to avoid\nsending this useless ACK on platforms which support it (currently at least\nLinux). It must not cause any problem, because the system will send it anyway\nafter 40 ms if the response takes more time than expected to come.\n\nDuring complex network debugging sessions, it may be desirable to disable\nthis optimization because delayed ACKs can make troubleshooting more complex\nwhen trying to identify where packets are delayed. It is then possible to\nfall back to normal behavior by specifying \"no option tcp-smart-accept\".\n\nIt is also possible to force it for non-HTTP proxies by simply specifying\n\"option tcp-smart-accept\". For instance, it can make sense with some services\nsuch as SMTP where the server speaks first.\n\nIt is recommended to avoid forcing this option in a defaults section. In case\nof doubt, consider setting it back to automatic values by prepending the\n\"default\" keyword before it, or disabling it using the \"no\" keyword.\n\n```\n\n**See also :**\"[option tcp-smart-connect](#option%20tcp-smart-connect)\"**[option tcp-smart-connect](#4.2-option%20tcp-smart-connect)****[no option tcp-smart-connect](#4.2-no%20option%20tcp-smart-connect)**```\nEnable or disable the saving of one ACK packet during the connect sequence\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nOn certain systems (at least Linux), HAProxy can ask the kernel not to\nimmediately send an empty ACK upon a connection request, but to directly\nsend the buffer request instead. This saves one packet on the network and\nthus boosts performance. It can also be useful for some servers, because they\nimmediately get the request along with the incoming connection.\n\nThis feature is enabled when \"option tcp-smart-connect\" is set in a backend.\nIt is not enabled by default because it makes network troubleshooting more\ncomplex.\n\nIt only makes sense to enable it with protocols where the client speaks first\nsuch as HTTP. In other situations, if there is no data to send in place of\nthe ACK, a normal ACK is sent.\n\nIf this option has been enabled in a \"defaults\" section, it can be disabled\nin a specific instance by prepending the \"no\" keyword before it.\n\n```\n\n**See also :**\"[option tcp-smart-accept](#option%20tcp-smart-accept)\"**[option tcpka](#4.2-option%20tcpka)**```\nEnable or disable the sending of TCP keepalive packets on both sides\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nWhen there is a firewall or any session-aware component between a client and\na server, and when the protocol involves very long sessions with long idle\nperiods (e.g. remote desktops), there is a risk that one of the intermediate\ncomponents decides to expire a session which has remained idle for too long.\n\nEnabling socket-level TCP keep-alives makes the system regularly send packets\nto the other end of the connection, leaving it active. The delay between\nkeep-alive probes is controlled by the system only and depends both on the\noperating system and its tuning parameters.\n\nIt is important to understand that keep-alive packets are neither emitted nor\nreceived at the application level. It is only the network stacks which sees\nthem. For this reason, even if one side of the proxy already uses keep-alives\nto maintain its connection alive, those keep-alive packets will not be\nforwarded to the other side of the proxy.\n\nPlease note that this has nothing to do with HTTP keep-alive.\n\nUsing option \"tcpka\" enables the emission of TCP keep-alive probes on both\nthe client and server sides of a connection. Note that this is meaningful\nonly in \"defaults\" or \"listen\" sections. If this option is used in a\nfrontend, only the client side will get keep-alives, and if this option is\nused in a backend, only the server side will get keep-alives. For this\nreason, it is strongly recommended to explicitly use \"option clitcpka\" and\n\"option srvtcpka\" when the configuration is split between frontends and\nbackends.\n\n```\n\n**See also :**\"[option clitcpka](#option%20clitcpka)\", \"[option srvtcpka](#option%20srvtcpka)\"**[option tcplog](#4.2-option%20tcplog)**[clf]```\nEnable advanced logging of TCP connections with stream state and timers\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\nclf       if the \"clf\" argument is added, then the output format will be\n          the CLF format instead of HAProxy's default TCP format. You can\n          use this when you need to feed HAProxy's logs through a specific\n          log analyzer which only support the CLF format and which is not\n          extensible.  Since this expects an HTTP format some of the\n          values have been pre set. The http request will show as TCP and\n          the response code will show as 000.\n```\n\n```\nBy default, the log output format is very poor, as it only contains the\nsource and destination addresses, and the instance name. By specifying\n\"option tcplog\", each log line turns into a much richer format including, but\nnot limited to, the connection timers, the stream status, the connections\nnumbers, the frontend, backend and server name, and of course the source\naddress and ports. This option is useful for pure TCP proxies in order to\nfind which of the client or server disconnects or times out. For normal HTTP\nproxies, it's better to use \"option httplog\" which is even more complete.\n\n\"option tcplog\" overrides any previous \"log-format\" directive.\n\n```\n\n**See also :**\"[option httplog](#option%20httplog)\", and[section 8](#8)about logging.**[option transparent](#4.2-option%20transparent)****[no option transparent](#4.2-no%20option%20transparent)**```\nEnable client-side transparent proxying\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nThis option was introduced in order to provide layer 7 persistence to layer 3\nload balancers. The idea is to use the OS's ability to redirect an incoming\nconnection for a remote address to a local process (here HAProxy), and let\nthis process know what address was initially requested. When this option is\nused, sessions without cookies will be forwarded to the original destination\nIP address of the incoming request (which should match that of another\nequipment), while requests with cookies will still be forwarded to the\nappropriate server.\n\nNote that contrary to a common belief, this option does NOT make HAProxy\npresent the client's IP to the server when establishing the connection.\n\n```\n\n**See also:**the \"usesrc\" argument of the \"[source](#)- This keyword is available in sections :\n- [Alphabetically sorted keywords reference](#source%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Server and default-server options](#source%20%28Server%20and%20default-server%20options%29)\n\n\" keyword, and the \"[transparent](#option%20transparent)\" option of the \"[bind](#)- This keyword is available in sections :\n- [Peers declaration](#bind%20%28Peers%20declaration%29)\n- [Log forwarding](#bind%20%28Log%20forwarding%29)\n- [Alphabetically sorted keywords reference](#bind%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\" keyword.**[external-check command](#4.2-external-check%20command)**<command>```\nExecutable to run when performing an external-check\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<command> is the external command to run\n```\n\n```\nThe arguments passed to the to the command are:\n\n<proxy_address> <proxy_port> <server_address> <server_port>\n\nThe <proxy_address> and <proxy_port> are derived from the first listener\nthat is either IPv4, IPv6 or a UNIX socket. In the case of a UNIX socket\nlistener the proxy_address will be the path of the socket and the\n<proxy_port> will be the string \"NOT_USED\". In a backend section, it's not\npossible to determine a listener, and both <proxy_address> and <proxy_port>\nwill have the string value \"NOT_USED\".\n\nSome values are also provided through environment variables.\n\nEnvironment variables :\n  HAPROXY_PROXY_ADDR      The first bind address if available (or empty if not\n                          applicable, for example in a \"backend\" section).\n\n  HAPROXY_PROXY_ID        The backend id.\n\n  HAPROXY_PROXY_NAME      The backend name.\n\n  HAPROXY_PROXY_PORT      The first bind port if available (or empty if not\n                          applicable, for example in a \"backend\" section or\n                          for a UNIX socket).\n\n  HAPROXY_SERVER_ADDR     The server address.\n\n  HAPROXY_SERVER_CURCONN  The current number of connections on the server.\n\n  HAPROXY_SERVER_ID       The server id.\n\n  HAPROXY_SERVER_MAXCONN  The server max connections.\n\n  HAPROXY_SERVER_NAME     The server name.\n\n  HAPROXY_SERVER_PORT     The server port if available (or empty for a UNIX\n                          socket).\n\n  HAPROXY_SERVER_SSL      \"0\" when SSL is not used, \"1\" when it is used\n\n  HAPROXY_SERVER_PROTO    The protocol used by this server, which can be one\n                          of \"cli\" (the haproxy CLI), \"syslog\" (syslog TCP\n                          server), \"peers\" (peers TCP server), \"h1\" (HTTP/1.x\n                          server), \"h2\" (HTTP/2 server), or \"tcp\" (any other\n                          TCP server).\n\n  PATH                    The PATH environment variable used when executing\n                          the command may be set using \"external-check path\".\n\nIf the command executed and exits with a zero status then the check is\nconsidered to have passed, otherwise the check is considered to have\nfailed.\n\n```\n\nExample :```\n\nexternal-check command /bin/true\n\n```\n\n**See also :**\"[external-check](#)- This keyword is available in sections :\n- [Process management and security](#external-check%20%28Process%20management%20and%20security%29)\n- [Alphabetically sorted keywords reference](#external-check%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[option external-check](#option%20external-check)\", \"[external-check path](#external-check%20path)\"**[external-check path](#4.2-external-check%20path)**<path>```\nThe value of the PATH environment variable used when running an external-check\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<path> is the path used when executing external command to run\n```\n\n```\nThe default path is \"\".\n\n```\n\nExample :```\n\nexternal-check path \"/usr/bin:/bin\"\n\n```\n\n**See also :**\"[external-check](#)- This keyword is available in sections :\n- [Process management and security](#external-check%20%28Process%20management%20and%20security%29)\n- [Alphabetically sorted keywords reference](#external-check%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[option external-check](#option%20external-check)\", \"[external-check command](#external-check%20command)\"**[persist rdp-cookie](#4.2-persist%20rdp-cookie)****[persist rdp-cookie](#4.2-persist%20rdp-cookie)**(<name>)```\nEnable RDP cookie-based persistence\n\nMay be used in the following contexts: tcp\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<name>    is the optional name of the RDP cookie to check. If omitted, the\n          default cookie name \"msts\" will be used. There currently is no\n          valid reason to change this name.\n```\n\n```\nThis statement enables persistence based on an RDP cookie. The RDP cookie\ncontains all information required to find the server in the list of known\nservers. So when this option is set in the backend, the request is analyzed\nand if an RDP cookie is found, it is decoded. If it matches a known server\nwhich is still UP (or if \"option persist\" is set), then the connection is\nforwarded to this server.\n\nNote that this only makes sense in a TCP backend, but for this to work, the\nfrontend must have waited long enough to ensure that an RDP cookie is present\nin the request buffer. This is the same requirement as with the \"rdp-cookie\"\nload-balancing method. Thus it is highly recommended to put all statements in\na single \"listen\" section.\n\nAlso, it is important to understand that the terminal server will emit this\nRDP cookie only if it is configured for \"token redirection mode\", which means\nthat the \"IP address redirection\" option is disabled.\n\n```\n\nExample :```\n\nlisten tse-farm\n    bind :3389\n    # wait up to 5s for an RDP cookie in the request\n    tcp-request inspect-delay 5s\n    tcp-request content accept if RDP_COOKIE\n    # apply RDP cookie persistence\n    persist rdp-cookie\n    # if server is unknown, let's balance on the same cookie.\n    # alternatively, \"balance leastconn\" may be useful too.\n    balance rdp-cookie\n    server srv1 1.1.1.1:3389\n    server srv2 1.1.1.2:3389\n\n```\n\n**See also :**\"balance rdp-cookie\", \"[tcp-request](#tcp-request)\" and the \"[req.rdp_cookie](#req.rdp_cookie)\" ACL.**[quic-initial](#4.2-quic-initial)**<action>[{ if | unless }<condition>]```\nPerform an action on an incoming QUIC Initial packet. Contrary to\n\"tcp-request connection\", this is executed prior to any connection element\ninstantiation and starting and completion of the SSL handshake, which is more\nefficient when wanting to reject connections attempts.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyes(!)yesyesnoArguments :```\n<action>    defines the action to perform if the condition applies. See\n            below.\n\n<condition> is a standard layer4-only ACL-based condition (see section 7).\n            However, QUIC initial rules are executed too early even for\n            some layer4 sample fetch methods despite no configuration\n            warning and may result in unspecified runtime behavior,\n            although they will not crash. Consider that only internal\n            samples and layer4 \"src*\" and \"dst*\" are considered as\n            supported for now.\n```\n\n```\nThis action is executed early during QUIC packet parsing. As such, only a\nminimal list of actions is supported :\n  - accept\n  - dgram-drop\n  - reject\n  - send-retry\n\n```\n\n**[rate-limit sessions](#4.2-rate-limit%20sessions)**<rate>```\nSet a limit on the number of new sessions accepted per second on a frontend\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<rate>    The <rate> parameter is an integer designating the maximum number\n          of new sessions per second to accept on the frontend.\n```\n\n```\nWhen the frontend reaches the specified number of new sessions per second, it\nstops accepting new connections until the rate drops below the limit again.\nDuring this time, the pending sessions will be kept in the socket's backlog\n(in system buffers) and HAProxy will not even be aware that sessions are\npending. When applying very low limit on a highly loaded service, it may make\nsense to increase the socket's backlog using the \"backlogThis keyword is available in sections :Log forwardingAlphabetically sorted keywords referenceBind options\" keyword.\n\nThis feature is particularly efficient at blocking connection-based attacks\nor service abuse on fragile servers. Since the session rate is measured every\nmillisecond, it is extremely accurate. Also, the limit applies immediately,\nno delay is needed at all to detect the threshold.\n\n```\n\nExample :```\n\nLimit the connection rate on SMTP to 10 per second maxlisten smtp\n    mode tcp\n    bind :25\n    rate-limit sessions 10\n    server smtp1 127.0.0.1:1025\n\n```\n\n```\nNote : when the maximum rate is reached, the frontend's status is not changed\n       but its sockets appear as \"WAITING\" in the statistics if the\n       \"socket-stats\" option is enabled.\n\n```\n\n**See also :**the \"[backlog](#)- This keyword is available in sections :\n- [Log forwarding](#backlog%20%28Log%20forwarding%29)\n- [Alphabetically sorted keywords reference](#backlog%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Bind options](#backlog%20%28Bind%20options%29)\n\n\" keyword and the \"[fe_sess_rate](#fe_sess_rate)\" ACL criterion.**[redirect location](#4.2-redirect%20location)**<loc>[code<code>]<option>[{if | unless}<condition>]**[redirect prefix](#4.2-redirect%20prefix)**<pfx>[code<code>]<option>[{if | unless}<condition>]**[redirect scheme](#4.2-redirect%20scheme)**<sch>[code<code>]<option>[{if | unless}<condition>]```\nReturn an HTTP redirection if/unless a condition is matched\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesyes```\nIf/unless the condition is matched, the HTTP request will lead to a redirect\nresponse. If no condition is specified, the redirect applies unconditionally.\n\n```\n\nArguments :```\n<loc>     With \"redirect location\", the exact value in <loc> is placed into\n          the HTTP \"Location\" header. When used in an \"http-request\" rule,\n          <loc> value follows the Custom log format rules and can include\n          some dynamic values (see Custom log format in section 8.2.6).\n\n<pfx>     With \"redirect prefix\", the \"Location\" header is built from the\n          concatenation of <pfx> and the complete URI path, including the\n          query string, unless the \"drop-query\" option is specified (see\n          below). As a special case, if <pfx> equals exactly \"/\", then\n          nothing is inserted before the original URI. It allows one to\n          redirect to the same URL (for instance, to insert a cookie). When\n          used in an \"http-request\" rule, <pfx> value follows the Custom\n          Log Format rules and can include some dynamic values (see Custom\n          Log Format in section 8.2.6).\n\n<sch>     With \"redirect scheme\", then the \"Location\" header is built by\n          concatenating <sch> with \"://\" then the first occurrence of the\n          \"Host\" header, and then the URI path, including the query string\n          unless the \"drop-query\" option is specified (see below). If no\n          path is found or if the path is \"*\", then \"/\" is used instead. If\n          no \"Host\" header is found, then an empty host component will be\n          returned, which most recent browsers interpret as redirecting to\n          the same host. This directive is mostly used to redirect HTTP to\n          HTTPS. When used in an \"http-request\" rule, <sch> value follows\n          the Custom log format rules and can include some dynamic values\n          (see Custom log format in section 8.2.6).\n\n<code>    The code is optional. It indicates which type of HTTP redirection\n          is desired. Only codes 301, 302, 303, 307 and 308 are supported,\n          with 302 used by default if no code is specified. 301 means\n          \"Moved permanently\", and a browser may cache the Location. 302\n          means \"Moved temporarily\" and means that the browser should not\n          cache the redirection. 303 is equivalent to 302 except that the\n          browser will fetch the location with a GET method. 307 is just\n          like 302 but makes it clear that the same method must be reused.\n          Likewise, 308 replaces 301 if the same method must be used.\n\n<option>  There are several options which can be specified to adjust the\n          expected behavior of a redirection :\n\n  - \"drop-query\"\n    When this keyword is used in a prefix-based redirection, then the\n    location will be set without any possible query-string, which is useful\n    for directing users to a non-secure page for instance. It has no effect\n    with a location-type redirect.\n\n  - \"append-slash\"\n    This keyword may be used in conjunction with \"drop-query\" to redirect\n    users who use a URL not ending with a '/' to the same one with the '/'.\n    It can be useful to ensure that search engines will only see one URL.\n    For this, a return code 301 is preferred.\n\n  - \"ignore-empty\"\n    This keyword only has effect when a location is produced using a log\n    format expression (i.e. when used in http-request or http-response).\n    It indicates that if the result of the expression is empty, the rule\n    should silently be skipped. The main use is to allow mass-redirects\n    of known paths using a simple map.\n\n  - \"set-cookie NAME[=value]\"\n    A \"Set-Cookie\" header will be added with NAME (and optionally \"=value\")\n    to the response. This is sometimes used to indicate that a user has\n    been seen, for instance to protect against some types of DoS. No other\n    cookie option is added, so the cookie will be a session cookie. Note\n    that for a browser, a sole cookie name without an equal sign is\n    different from a cookie with an equal sign.\n\n  - \"set-cookie-fmt <fmt>\"\n    It is equivaliant to the option above, except the \"Set-Cookie\" header\n    will be filled with the result of the log-format string <fmt>\n    evaluation. Be careful to respect the \"NAME[=value]\" format because no\n    special check are performed during the configuration parsing.\n\n  - \"clear-cookie NAME[=]\"\n    A \"Set-Cookie\" header will be added with NAME (and optionally \"=\"), but\n    with the \"Max-Age\" attribute set to zero. This will tell the browser to\n    delete this cookie. It is useful for instance on logout pages. It is\n    important to note that clearing the cookie \"NAME\" will not remove a\n    cookie set with \"NAME=value\". You have to clear the cookie \"NAME=\" for\n    that, because the browser makes the difference.\n\n  - \"keep-query\"\n    When this keyword is used in a location-based redirection, then the\n    query-string of the original URI, if any, will be appended to the\n    location. If no query-string is found, nothing is added. If the\n    location already contains a query-string, the original one will be\n    appended with the '&' delimiter.\n```\n\nExample:```\n\nMove the login URL only to HTTPS.acl clear      dst_port  80\nacl secure     dst_port  8080\nacl login_page url_beg   /login\nacl logout     url_beg   /logout\nacl uid_given  url_reg   /login?userid=[^&]+\nacl cookie_set hdr_sub(cookie) SEEN=1\n\nredirect prefix   https://mysite.com set-cookie SEEN=1 if !cookie_set\nredirect prefix   https://mysite.com           if login_page !secure\nredirect prefix   http://mysite.com drop-query if login_page !uid_given\nredirect location http://mysite.com/           if !login_page secure\nredirect location / clear-cookie USERID=       if logout\n\n```\n\nExample:```\n\nSend redirects for request for articles without a '/'.acl missing_slash path_reg ^/article/[^/]*$\nredirect code 301 prefix / drop-query append-slash if missing_slash\n\n```\n\nExample:```\n\nRedirect all HTTP traffic to HTTPS when SSL is handled by HAProxy.redirect scheme https if !{ ssl_fc }\n\n```\n\nExample:```\n\nAppend 'www.' prefix in front of all hosts not having ithttp-request redirect code 301 location      \\\n  http://www.%[hdr(host)]%[capture.req.uri]  \\\n  unless { hdr_beg(host) -i www }\n\n```\n\nExample:```\n\nPermanently redirect only old URLs to new oneshttp-request redirect code 301 location               \\\n  %[path,map_str(old-blog-articles.map)] ignore-empty\n\n```\n\n```\nSee section 7 about ACL usage.\n\n```\n\n**[retries](#4.2-retries)**<value>```\nSet the number of retries to perform on a server after a failure\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<value>   is the number of times a request or connection attempt should be\n          retried on a server after a failure.\n```\n\n```\nBy default, retries apply only to new connection attempts. However, when\nthe \"retry-on\" directive is used, other conditions might trigger a retry\n(e.g. empty response, undesired status code), and each of them will count\none attempt, and when the total number attempts reaches the value here, an\nerror will be returned.\n\nIn order to avoid immediate reconnections to a server which is restarting,\na turn-around timer of min(\"timeout connectThis keyword is available in sections :RingsAlphabetically sorted keywords reference\", one second) is applied before\na retry occurs on the same server.\n\nWhen \"option redispatch\" is set, some retries may be performed on another\nserver even if a cookie references a different server. By default this will\nonly be the last retry unless an argument is passed to \"option redispatch\".\n\n```\n\n**See also :**\"[option redispatch](#option%20redispatch)\"**[retry-on](#4.2-retry-on)**[space-delimited list of keywords]```\nSpecify when to attempt to automatically retry a failed request.\nThis setting is only valid when \"modeThis keyword is available in sections :Alphabetically sorted keywords referenceBind options\" is set to http and is silently ignored\notherwise.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<keywords>  is a space-delimited list of keywords or HTTP status codes, each\n            representing a type of failure event on which an attempt to\n            retry the request is desired. Please read the notes at the\n            bottom before changing this setting. The following keywords are\n            supported :\n\n  none              never retry\n\n  conn-failure      retry when the connection or the SSL handshake failed\n                    and the request could not be sent. This is the default.\n\n  empty-response    retry when the server connection was closed after part\n                    of the request was sent, and nothing was received from\n                    the server. This type of failure may be caused by the\n                    request timeout on the server side, poor network\n                    condition, or a server crash or restart while\n                    processing the request.\n\n  junk-response     retry when the server returned something not looking\n                    like a complete HTTP response. This includes partial\n                    responses headers as well as non-HTTP contents. It\n                    usually is a bad idea to retry on such events, which\n                    may be caused a configuration issue (wrong server port)\n                    or by the request being harmful to the server (buffer\n                    overflow attack for example).\n\n  response-timeout  the server timeout stroke while waiting for the server\n                    to respond to the request. This may be caused by poor\n                    network condition, the reuse of an idle connection\n                    which has expired on the path, or by the request being\n                    extremely expensive to process. It generally is a bad\n                    idea to retry on such events on servers dealing with\n                    heavy database processing (full scans, etc) as it may\n                    amplify denial of service attacks.\n\n  0rtt-rejected     retry requests which were sent over early data and were\n                    rejected by the server. These requests are generally\n                    considered to be safe to retry.\n\n  <status>          any HTTP status code among \"401\" (Unauthorized), \"403\"\n                    (Forbidden), \"404\" (Not Found), \"408\" (Request Timeout),\n                    \"421\" (Misdirected Request), \"425\" (Too Early),\n                    \"429\" (Too Many Requests), \"500\" (Server Error),\n                    \"501\" (Not Implemented), \"502\" (Bad Gateway),\n                    \"503\" (Service Unavailable), \"504\" (Gateway Timeout).\n\n  all-retryable-errors\n                    retry request for any error that are considered\n                    retryable. This currently activates \"conn-failure\",\n                    \"empty-response\", \"junk-response\", \"response-timeout\",\n                    \"0rtt-rejected\", \"500\", \"502\", \"503\", and \"504\".\n```\n\n```\nUsing this directive replaces any previous settings with the new ones; it is\nnot cumulative.\n\nPlease note that using anything other than \"none\" and \"conn-failure\" requires\nto allocate a buffer and copy the whole request into it, so it has memory and\nperformance impacts. Requests not fitting in a single buffer will never be\nretried (see the global tune.bufsize setting).\n\nYou have to make sure the application has a replay protection mechanism built\nin such as a unique transaction IDs passed in requests, or that replaying the\nsame request has no consequence, or it is very dangerous to use any retry-on\nvalue beside \"conn-failure\" and \"none\". Static file servers and caches are\ngenerally considered safe against any type of retry. Using a status code can\nbe useful to quickly leave a server showing an abnormal behavior (out of\nmemory, file system issues, etc), but in this case it may be a good idea to\nimmediately redispatch the connection to another server (please see \"option\nredispatch\" for this). Last, it is important to understand that most causes\nof failures are the requests themselves and that retrying a request causing a\nserver to misbehave will often make the situation even worse for this server,\nor for the whole service in case of redispatch.\n\nUnless you know exactly how the application deals with replayed requests, you\nshould not use this directive.\n\nThe default is \"conn-failure\".\n\n```\n\nExample:```\n\nretry-on 503 504\n\n```\n\n**See also:**\"[retries](#retries)\", \"[option redispatch](#option%20redispatch)\", \"[tune.bufsize](#tune.bufsize)\"**[server](#4.2-server)**<name><address>[:[port]][param*]```\nDeclare a server in a backend\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyesArguments :```\n<name>    is the internal name assigned to this server. This name will\n          appear in logs and alerts. If \"http-send-name-header\" is\n          set, it will be added to the request header sent to the server.\n\n<address> is the IPv4 or IPv6 address of the server. Alternatively, a\n          resolvable hostname is supported, but this name will be resolved\n          during start-up. Address \"0.0.0.0\" or \"*\" has a special meaning.\n          It indicates that the connection will be forwarded to the same IP\n          address as the one from the client connection. This is useful in\n          transparent proxy architectures where the client's connection is\n          intercepted and HAProxy must forward to the original destination\n          address. This is more or less what the \"transparent\" keyword does\n          except that with a server it's possible to limit concurrency and\n          to report statistics. Optionally, an address family prefix may be\n          used before the address to force the family regardless of the\n          address format, which can be useful to specify a path to a unix\n          socket with no slash ('/'). Currently supported prefixes are :\n                - 'ipv4@'  -> address is always IPv4\n                - 'ipv6@'  -> address is always IPv6\n                - 'unix@'  -> address is a path to a local unix socket\n                - 'abns@'  -> address is in abstract namespace (Linux only)\n                - 'abnsz@'  -> address is in abstract namespace (Linux only)\n                   but it is explicitly zero-terminated. This means no \\0\n                   padding is used to complete sun_path. It is useful to\n                   interconnect with programs that don't implement the\n                   default abns naming logic that haproxy uses.\n                - 'sockpair@' -> address is the FD of a connected unix\n                  socket or of a socketpair. During a connection, the\n                  backend creates a pair of connected sockets, and passes\n                  one of them over the FD. The bind part will use the\n                  received socket as the client FD. Should be used\n                  carefully.\n                - 'rhttp@' [ EXPERIMENTAL ] -> custom address family for a\n                  passive server in HTTP reverse context. This is an\n                  experimental features which requires\n                  \"expose-experimental-directives\" on a line before this\n                  server.\n          You may want to reference some environment variables in the\n          address parameter, see section 2.3 about environment\n          variables. The \"init-addr\" setting can be used to modify the way\n          IP addresses should be resolved upon startup.\n\n<port>    is an optional port specification. If set, all connections will\n          be sent to this port. If unset, the same port the client\n          connected to will be used. The port may also be prefixed by a \"+\"\n          or a \"-\". In this case, the server's port will be determined by\n          adding this value to the client's port.\n\n<param*>  is a list of parameters for this server. The \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" keywords\n          accepts an important number of options and has a complete section\n          dedicated to it. Please refer to section 5 for more details.\n```\n\nExamples :```\n\nserver first  10.1.1.1:1080 cookie first  check inter 1000\nserver second 10.1.1.2:1080 cookie second check inter 1000\nserver transp ipv4@\nserver backup \"${SRV_BACKUP}:1080\" backup\nserver www1_dc1 \"${LAN_DC1}.101:80\"\nserver www1_dc2 \"${LAN_DC2}.101:80\"\n\n```\n\n```\nNote: regarding Linux's abstract namespace sockets, \"abns\" HAProxy sockets\n      uses the whole sun_path length is used for the address length. Some\n      other programs such as socat use the string length only by default.\n      Pass the option \",unix-tightsocklen=0\" to any abstract socket\n      definition in socat to make it compatible with HAProxy's, or use the\n      \"abnsz\" HAProxy socket family instead.\n\n```\n\n**See also:**\"[default-server](#)- This keyword is available in sections :\n- [Peers declaration](#default-server%20%28Peers%20declaration%29)\n- [Alphabetically sorted keywords reference](#default-server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[http-send-name-header](#http-send-name-header)\" and[section 5](#5)about server options**[server-state-file-name](#4.2-server-state-file-name)**[{ use-backend-name |<file>}]```\nSet the server state file to read, load and apply to servers available in\nthis backend.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyes```\nIt only applies when the directive \"load-server-state-from-file\" is set to\n\"local\". When <file> is not provided, if \"use-backend-name\" is used or if\nthis directive is not set, then backend name is used. If <file> starts with a\nslash '/', then it is considered as an absolute path. Otherwise, <file> is\nconcatenated to the global directive \"server-state-base\".\n\n```\n\nExample:```\n\nThe minimal configuration below would make HAProxy look for the state server file '/etc/haproxy/states/bk':global\n  server-state-file-base /etc/haproxy/states\n\nbackend bk\n  load-server-state-from-file\n\n```\n\n**See also:**\"[server-state-base](#server-state-base)\", \"[load-server-state-from-file](#load-server-state-from-file)\", and \"show servers state\"**[server-template](#4.2-server-template)**<prefix><num | range><fqdn>[:<port>][params*]```\nSet a template to initialize servers with shared parameters.\nThe names of these servers are built from <prefix> and <num | range> parameters.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyesArguments:```\n<prefix>  A prefix for the server names to be built.\n\n<num | range>\n          If <num> is provided, this template initializes <num> servers\n          with 1 up to <num> as server name suffixes. A range of numbers\n          <num_low>-<num_high> may also be used to use <num_low> up to\n          <num_high> as server name suffixes.\n\n<fqdn>    A FQDN for all the servers this template initializes.\n\n<port>    Same meaning as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" <port> argument (see \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" keyword).\n\n<params*>\n          Remaining server parameters among all those supported by \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\"\n          keyword.\n```\n\nExamples:```\n\n# Initializes 3 servers with srv1, srv2 and srv3 as names,\n# google.com as FQDN, and health-check enabled.\nserver-template srv 1-3 google.com:80 check\n\n# or\nserver-template srv 3 google.com:80 check\n\n# would be equivalent to:\nserver srv1 google.com:80 check\nserver srv2 google.com:80 check\nserver srv3 google.com:80 check\n\n```\n\n**[source](#4.2-source)**<addr>[:<port>][usesrc{<addr2>[:<port2>]| client | clientip }]**[source](#4.2-source)**<addr>[:<port>][usesrc{<addr2>[:<port2>]| hdr_ip(<hdr>[,<occ>]) }]**[source](#4.2-source)**<addr>[:<port>][interface<name>]```\nSet the source address for outgoing connections\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<addr>    is the IPv4 address HAProxy will bind to before connecting to a\n          server. This address is also used as a source for health checks.\n\n          The default value of 0.0.0.0 means that the system will select\n          the most appropriate address to reach its destination. Optionally\n          an address family prefix may be used before the address to force\n          the family regardless of the address format, which can be useful\n          to specify a path to a unix socket with no slash ('/'). Currently\n          supported prefixes are :\n            - 'ipv4@' -> address is always IPv4\n            - 'ipv6@' -> address is always IPv6\n            - 'unix@' -> address is a path to a local unix socket\n            - 'abns@' -> address is in abstract namespace (Linux only)\n            - 'abnsz@'  -> address is in zero-terminated abstract namespace\n                           (Linux only)\n\n          You may want to reference some environment variables in the\n          address parameter, see section 2.3 about environment variables.\n\n<port>    is an optional port. It is normally not needed but may be useful\n          in some very specific contexts. The default value of zero means\n          the system will select a free port. Note that port ranges are not\n          supported in the backend. If you want to force port ranges, you\n          have to specify them on each \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" line.\n\n<addr2>   is the IP address to present to the server when connections are\n          forwarded in full transparent proxy mode. This is currently only\n          supported on some patched Linux kernels. When this address is\n          specified, clients connecting to the server will be presented\n          with this address, while health checks will still use the address\n          <addr>.\n\n<port2>   is the optional port to present to the server when connections\n          are forwarded in full transparent proxy mode (see <addr2> above).\n          The default value of zero means the system will select a free\n          port.\n\n<hdr>     is the name of a HTTP header in which to fetch the IP to bind to.\n          This is the name of a comma-separated header list which can\n          contain multiple IP addresses. By default, the last occurrence is\n          used. This is designed to work with the X-Forwarded-For header\n          and to automatically bind to the client's IP address as seen\n          by previous proxy, typically Stunnel. In order to use another\n          occurrence from the last one, please see the <occ> parameter\n          below. When the header (or occurrence) is not found, no binding\n          is performed so that the proxy's default IP address is used. Also\n          keep in mind that the header name is case insensitive, as for any\n          HTTP header.\n\n<occ>     is the occurrence number of a value to be used in a multi-value\n          header. This is to be used in conjunction with \"hdr_ip(<hdr>)\",\n          in order to specify which occurrence to use for the source IP\n          address. Positive values indicate a position from the first\n          occurrence, 1 being the first one. Negative values indicate\n          positions relative to the last one, -1 being the last one. This\n          is helpful for situations where an X-Forwarded-For header is set\n          at the entry point of an infrastructure and must be used several\n          proxy layers away. When this value is not specified, -1 is\n          assumed. Passing a zero here disables the feature.\n\n<name>    is an optional interface name to which to bind to for outgoing\n          traffic. On systems supporting this features (currently, only\n          Linux), this allows one to bind all traffic to the server to\n          this interface even if it is not the one the system would select\n          based on routing tables. This should be used with extreme care.\n          Note that using this option requires root privileges.\n```\n\n```\nThe \"sourceThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\" keyword is useful in complex environments where a specific\naddress only is allowed to connect to the servers. It may be needed when a\nprivate address must be used through a public gateway for instance, and it is\nknown that the system cannot determine the adequate source address by itself.\n\nAn extension which is available on certain patched Linux kernels may be used\nthrough the \"usesrc\" optional keyword. It makes it possible to connect to the\nservers with an IP address which does not belong to the system itself. This\nis called \"full transparent proxy mode\". For this to work, the destination\nservers have to route their traffic back to this address through the machine\nrunning HAProxy, and IP forwarding must generally be enabled on this machine.\n\nIn this \"full transparent proxy\" mode, it is possible to force a specific IP\naddress to be presented to the servers. This is not much used in fact. A more\ncommon use is to tell HAProxy to present the client's IP address. For this,\nthere are two methods :\n\n  - present the client's IP and port addresses. This is the most transparent\n    mode, but it can cause problems when IP connection tracking is enabled on\n    the machine, because a same connection may be seen twice with different\n    states. However, this solution presents the huge advantage of not\n    limiting the system to the 64k outgoing address+port couples, because all\n    of the client ranges may be used.\n\n  - present only the client's IP address and select a spare port. This\n    solution is still quite elegant but slightly less transparent (downstream\n    firewalls logs will not match upstream's). It also presents the downside\n    of limiting the number of concurrent connections to the usual 64k ports.\n    However, since the upstream and downstream ports are different, local IP\n    connection tracking on the machine will not be upset by the reuse of the\n    same session.\n\nThis option sets the default source for all servers in the backend. It may\nalso be specified in a \"defaults\" section. Finer source address specification\nis possible at the server level using the \"sourceThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\" server option. Refer to\nsection 5 for more information.\n\nIn order to work, \"usesrc\" requires root privileges, or on supported systems,\nthe \"cap_net_raw\" capability. See also the \"setcap\" global directive.\n\n```\n\nExamples :```\n\nbackend private\n    # Connect to the servers using our 192.168.1.200 source address\n    source 192.168.1.200\n\nbackend transparent_ssl1\n    # Connect to the SSL farm from the client's source address\n    source 192.168.1.200 usesrc clientip\n\nbackend transparent_ssl2\n    # Connect to the SSL farm from the client's source address and port\n    # not recommended if IP conntrack is present on the local machine.\n    source 192.168.1.200 usesrc client\n\nbackend transparent_ssl3\n    # Connect to the SSL farm from the client's source address. It\n    # is more conntrack-friendly.\n    source 192.168.1.200 usesrc clientip\n\nbackend transparent_smtp\n    # Connect to the SMTP farm from the client's source address/port\n    # with Tproxy version 4.\n    source 0.0.0.0 usesrc clientip\n\nbackend transparent_http\n    # Connect to the servers using the client's IP as seen by previous\n    # proxy.\n    source 0.0.0.0 usesrc hdr_ip(x-forwarded-for,-1)\n\n```\n\n**See also :**the \"[source](#)- This keyword is available in sections :\n- [Alphabetically sorted keywords reference](#source%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Server and default-server options](#source%20%28Server%20and%20default-server%20options%29)\n\n\" server option in[section 5](#5), the Tproxy patches for the Linux kernel on www.balabit.com, the \"[bind](#)- This keyword is available in sections :\n- [Peers declaration](#bind%20%28Peers%20declaration%29)\n- [Log forwarding](#bind%20%28Log%20forwarding%29)\n- [Alphabetically sorted keywords reference](#bind%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\" keyword.**[srvtcpka-cnt](#4.2-srvtcpka-cnt)**<count>```\nSets the maximum number of keepalive probes TCP should send before dropping\nthe connection on the server side.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<count>   is the maximum number of keepalive probes.\n```\n\n```\nThis keyword corresponds to the socket option TCP_KEEPCNT. If this keyword\nis not specified, system-wide TCP parameter (tcp_keepalive_probes) is used.\nThe availability of this setting depends on the operating system. It is\nknown to work on Linux.\n\n```\n\n**See also :**\"[option srvtcpka](#option%20srvtcpka)\", \"[srvtcpka-idle](#srvtcpka-idle)\", \"[srvtcpka-intvl](#srvtcpka-intvl)\".**[srvtcpka-idle](#4.2-srvtcpka-idle)**<timeout>```\nSets the time the connection needs to remain idle before TCP starts sending\nkeepalive probes, if enabled the sending of TCP keepalive packets on the\nserver side.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<timeout> is the time the connection needs to remain idle before TCP starts\n          sending keepalive probes. It is specified in seconds by default,\n          but can be in any other unit if the number is suffixed by the\n          unit, as explained at the top of this document.\n```\n\n```\nThis keyword corresponds to the socket option TCP_KEEPIDLE. If this keyword\nis not specified, system-wide TCP parameter (tcp_keepalive_time) is used.\nThe availability of this setting depends on the operating system. It is\nknown to work on Linux.\n\n```\n\n**See also :**\"[option srvtcpka](#option%20srvtcpka)\", \"[srvtcpka-cnt](#srvtcpka-cnt)\", \"[srvtcpka-intvl](#srvtcpka-intvl)\".**[srvtcpka-intvl](#4.2-srvtcpka-intvl)**<timeout>```\nSets the time between individual keepalive probes on the server side.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<timeout> is the time between individual keepalive probes. It is specified\n          in seconds by default, but can be in any other unit if the number\n          is suffixed by the unit, as explained at the top of this\n          document.\n```\n\n```\nThis keyword corresponds to the socket option TCP_KEEPINTVL. If this keyword\nis not specified, system-wide TCP parameter (tcp_keepalive_intvl) is used.\nThe availability of this setting depends on the operating system. It is\nknown to work on Linux.\n\n```\n\n**See also :**\"[option srvtcpka](#option%20srvtcpka)\", \"[srvtcpka-cnt](#srvtcpka-cnt)\", \"[srvtcpka-idle](#srvtcpka-idle)\".**[stats admin](#4.2-stats%20admin)**{ if | unless }<cond>```\nEnable statistics admin level if/unless a condition is matched\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesyes```\nThis statement enables the statistics admin level if/unless a condition is\nmatched.\n\nThe admin level allows to enable/disable servers from the web interface. By\ndefault, statistics page is read-only for security reasons.\n\nCurrently, the POST request is limited to the buffer size minus the reserved\nbuffer space, which means that if the list of servers is too long, the\nrequest won't be processed. It is recommended to alter few servers at a\ntime.\n\n```\n\nExample :```\n\n# statistics admin level only for localhost\nbackend stats_localhost\n    stats enable\n    stats admin if LOCALHOST\n\n```\n\nExample :```\n\n# statistics admin level always enabled because of the authentication\nbackend stats_auth\n    stats enable\n    stats auth  admin:AdMiN123\n    stats admin if TRUE\n\n```\n\nExample :```\n\n# statistics admin level depends on the authenticated user\nuserlist stats-auth\n    group admin    users admin\n    user  admin    insecure-password 'AdMiN123'\n    group readonly users haproxy\n    user  haproxy  insecure-password 'haproxy'\n\nbackend stats_auth\n    stats enable\n    acl AUTH       http_auth(stats-auth)\n    acl AUTH_ADMIN http_auth_group(stats-auth) admin\n    stats http-request auth unless AUTH\n    stats admin if AUTH_ADMIN\n\n```\n\n**See also :**\"[stats enable](#stats%20enable)\", \"[stats auth](#stats%20auth)\", \"[stats http-request](#stats%20http-request)\",[section 12.2](#12.2)about userlists and[section 7](#7)about ACL usage.**[ssl-f-use](#4.2-ssl-f-use)**[<sslbindconf>...]*```\nAssignate a certificate to the current frontend.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesnoArguments :```\n<sslbindconf> supports the following keywords from the bind line\n(see Section 5.1. Bind options):\n\n- allow-0rtt\n- alpn\n- ca-file\n- ca-verify-file\n- ciphers\n- ciphersuites\n- client-sigalgs\n- crl-file\n- curves\n- ecdhe\n- no-alpn\n- no-ca-names\n- npn\n- sigalgs\n- ssl-min-ver\n- ssl-max-ver\n- verify\n\nsslbindconf also supports the following keywords from the crt-store load\nkeyword (see Section 12.7.1. Load options):\n\n- crt\n- key\n- ocsp\n- issuer\n- sctl\n- ocsp-update\n```\n\n```\nAssignate a certificate <crtname> to a crt-list created automatically with the\nfrontend name and prefixed by @ (ex: '@frontend1').\n\nThis implicit crt-list will be assigned to every \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" bind lines in the\ncurrent frontend.\n\ncrt-list commands from the stats socket are effective with this crt-list, so\none could replace, remove or add certificates and SSL options to it.\n\n```\n\nExample :```\n\nfrontend https\n    bind :443 ssl\n    bind quic4@:443 ssl\n    ssl-f-use crt foobar.pem.rsa sigalgs \"RSA-PSS+SHA256\"\n    ssl-f-use crt test.foobar.pem\n    ssl-f-use crt test2.foobar.crt key test2.foobar.key ocsp test2.foobar.ocsp ocsp-update on\n\n```\n\n**See also :**\"[crt-list](#crt-list)\" and \"[crt](#)- This keyword is available in sections :\n- [Load options](#crt%20%28Load%20options%29)\n- [Bind options](#crt%20%28Bind%20options%29)\n- [Server and default-server options](#crt%20%28Server%20and%20default-server%20options%29)\n\n\".**[stats auth](#4.2-stats%20auth)**<user>:<passwd>```\nEnable statistics with authentication and grant access to an account\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<user>    is a user name to grant access to\n\n<passwd>  is the cleartext password associated to this user\n```\n\n```\nThis statement enables statistics with default settings, and restricts access\nto declared users only. It may be repeated as many times as necessary to\nallow as many users as desired. When a user tries to access the statistics\nwithout a valid account, a \"401 Forbidden\" response will be returned so that\nthe browser asks the user to provide a valid user and password. The real\nwhich will be returned to the browser is configurable using \"stats realm\".\n\nSince the authentication method is HTTP Basic Authentication, the passwords\ncirculate in cleartext on the network. Thus, it was decided that the\nconfiguration file would also use cleartext passwords to remind the users\nthat those ones should not be sensitive and not shared with any other account.\n\nIt is also possible to reduce the scope of the proxies which appear in the\nreport using \"stats scope\".\n\nThough this statement alone is enough to enable statistics reporting, it is\nrecommended to set all other settings in order to avoid relying on default\nunobvious parameters.\n\n```\n\nExample :```\n\n# public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   HAProxy\\ Statistics\n    stats auth    admin1:AdMiN123\n    stats auth    admin2:AdMiN321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n\n```\n\n**See also :**\"[stats enable](#stats%20enable)\", \"[stats realm](#stats%20realm)\", \"[stats scope](#stats%20scope)\", \"[stats uri](#stats%20uri)\"**[stats enable](#4.2-stats%20enable)**```\nEnable statistics reporting with default settings\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nThis statement enables statistics reporting with default settings defined\nat build time. Unless stated otherwise, these settings are used :\n  - stats uri   : /haproxy?stats\n  - stats realm : \"HAProxy Statistics\"\n  - stats auth  : no authentication\n  - stats scope : no restriction\n\nThough this statement alone is enough to enable statistics reporting, it is\nrecommended to set all other settings in order to avoid relying on default\nunobvious parameters.\n\n```\n\nExample :```\n\n# public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   HAProxy\\ Statistics\n    stats auth    admin1:AdMiN123\n    stats auth    admin2:AdMiN321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n\n```\n\n**See also :**\"[stats auth](#stats%20auth)\", \"[stats realm](#stats%20realm)\", \"[stats uri](#stats%20uri)\"**[stats hide-version](#4.2-stats%20hide-version)**```\nEnable statistics and hide HAProxy version reporting\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nBy default, the stats page reports some useful status information along with\nthe statistics. Among them is HAProxy's version. However, it is generally\nconsidered dangerous to report precise version to anyone, as it can help them\ntarget known weaknesses with specific attacks. The \"stats hide-version\"\nstatement removes the version from the statistics report. This is recommended\nfor public sites or any site with a weak login/password.\n\nThough this statement alone is enough to enable statistics reporting, it is\nrecommended to set all other settings in order to avoid relying on default\nunobvious parameters.\n\n```\n\nExample :```\n\n# public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   HAProxy\\ Statistics\n    stats auth    admin1:AdMiN123\n    stats auth    admin2:AdMiN321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n\n```\n\n**See also :**\"[stats auth](#stats%20auth)\", \"[stats enable](#stats%20enable)\", \"[stats realm](#stats%20realm)\", \"[stats uri](#stats%20uri)\"**[stats http-request](#4.2-stats%20http-request)**{ allow | deny | auth[realm<realm>]}[{ if | unless }<condition>]```\nAccess control for statistics\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyes```\nAs \"http-request\", these set of options allow to fine control access to\nstatistics. Each option may be followed by if/unless and acl.\nFirst option with matched condition (or option without condition) is final.\nFor \"deny\" a 403 error will be returned, for \"allow\" normal processing is\nperformed, for \"auth\" a 401/407 error code is returned so the client\nshould be asked to enter a username and password.\n\nThere is no fixed limit to the number of http-request statements per\ninstance.\n\n```\n\n**See also :**\"[http-request](#http-request)\",[section 12.2](#12.2)about userlists and[section 7](#7)about ACL usage.**[stats realm](#4.2-stats%20realm)**<realm>```\nEnable statistics and set authentication realm\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<realm>   is the name of the HTTP Basic Authentication realm reported to\n          the browser. The browser uses it to display it in the pop-up\n          inviting the user to enter a valid username and password.\n```\n\n```\nThe realm is read as a single word, so any spaces in it should be escaped\nusing a backslash ('\\').\n\nThis statement is useful only in conjunction with \"stats auth\" since it is\nonly related to authentication.\n\nThough this statement alone is enough to enable statistics reporting, it is\nrecommended to set all other settings in order to avoid relying on default\nunobvious parameters.\n\n```\n\nExample :```\n\n# public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   HAProxy\\ Statistics\n    stats auth    admin1:AdMiN123\n    stats auth    admin2:AdMiN321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n\n```\n\n**See also :**\"[stats auth](#stats%20auth)\", \"[stats enable](#stats%20enable)\", \"[stats uri](#stats%20uri)\"**[stats refresh](#4.2-stats%20refresh)**<delay>```\nEnable statistics with automatic refresh\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<delay>   is the suggested refresh delay, specified in seconds, which will\n          be returned to the browser consulting the report page. While the\n          browser is free to apply any delay, it will generally respect it\n          and refresh the page this every seconds. The refresh interval may\n          be specified in any other non-default time unit, by suffixing the\n          unit after the value, as explained at the top of this document.\n```\n\n```\nThis statement is useful on monitoring displays with a permanent page\nreporting the load balancer's activity. When set, the HTML report page will\ninclude a link \"refresh\"/\"stop refresh\" so that the user can select whether\nthey want automatic refresh of the page or not.\n\nThough this statement alone is enough to enable statistics reporting, it is\nrecommended to set all other settings in order to avoid relying on default\nunobvious parameters.\n\n```\n\nExample :```\n\n# public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   HAProxy\\ Statistics\n    stats auth    admin1:AdMiN123\n    stats auth    admin2:AdMiN321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n\n```\n\n**See also :**\"[stats auth](#stats%20auth)\", \"[stats enable](#stats%20enable)\", \"[stats realm](#stats%20realm)\", \"[stats uri](#stats%20uri)\"**[stats scope](#4.2-stats%20scope)**{<name>| \".\" }```\nEnable statistics and limit access scope\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<name>    is the name of a listen, frontend or backend section to be\n          reported. The special name \".\" (a single dot) designates the\n          section in which the statement appears.\n```\n\n```\nWhen this statement is specified, only the sections enumerated with this\nstatement will appear in the report. All other ones will be hidden. This\nstatement may appear as many times as needed if multiple sections need to be\nreported. Please note that the name checking is performed as simple string\ncomparisons, and that it is never checked that a give section name really\nexists.\n\nThough this statement alone is enough to enable statistics reporting, it is\nrecommended to set all other settings in order to avoid relying on default\nunobvious parameters.\n\n```\n\nExample :```\n\n# public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   HAProxy\\ Statistics\n    stats auth    admin1:AdMiN123\n    stats auth    admin2:AdMiN321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n\n```\n\n**See also :**\"[stats auth](#stats%20auth)\", \"[stats enable](#stats%20enable)\", \"[stats realm](#stats%20realm)\", \"[stats uri](#stats%20uri)\"**[stats show-desc](#4.2-stats%20show-desc)**[<desc>]```\nEnable reporting of a description on the statistics page.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyes```\n  <desc>    is an optional description to be reported. If unspecified, the\n            description from global section is automatically used instead.\n\nThis statement is useful for users that offer shared services to their\ncustomers, where node or description should be different for each customer.\n\nThough this statement alone is enough to enable statistics reporting, it is\nrecommended to set all other settings in order to avoid relying on default\nunobvious parameters. By default description is not shown.\n\n```\n\nExample :```\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats show-desc Master node for Europe, Asia, Africa\n    stats uri       /admin?stats\n    stats refresh   5s\n\n```\n\n**See also:**\"show-node\", \"[stats enable](#stats%20enable)\", \"[stats uri](#stats%20uri)\" and \"[description](#)- This keyword is available in sections :\n- [Rings](#description%20%28Rings%29)\n- [Process management and security](#description%20%28Process%20management%20and%20security%29)\n- [Alphabetically sorted keywords reference](#description%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\" in global section.**[stats show-legends](#4.2-stats%20show-legends)**```\nEnable reporting additional information on the statistics page\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nEnable reporting additional information on the statistics page :\n  - cap: capabilities (proxy)\n  - mode: one of tcp, http or health (proxy)\n  - id: SNMP ID (proxy, socket, server)\n  - IP (socket, server)\n  - cookie (backend, server)\n\nThough this statement alone is enough to enable statistics reporting, it is\nrecommended to set all other settings in order to avoid relying on default\nunobvious parameters. Default behavior is not to show this information.\n\n```\n\n**See also:**\"[stats enable](#stats%20enable)\", \"[stats uri](#stats%20uri)\".**[stats show-modules](#4.2-stats%20show-modules)**```\nEnable display of extra statistics module on the statistics page\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :none```\nNew columns are added at the end of the line containing the extra statistics\nvalues as a tooltip.\n\nThough this statement alone is enough to enable statistics reporting, it is\nrecommended to set all other settings in order to avoid relying on default\nunobvious parameters. Default behavior is not to show this information.\n\n```\n\n**See also:**\"[stats enable](#stats%20enable)\", \"[stats uri](#stats%20uri)\".**[stats show-node](#4.2-stats%20show-node)**[<name>]```\nEnable reporting of a host name on the statistics page.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments:```\n<name>    is an optional name to be reported. If unspecified, the\n          node name from global section is automatically used instead.\n```\n\n```\nThis statement is useful for users that offer shared services to their\ncustomers, where node or description might be different on a stats page\nprovided for each customer. Default behavior is not to show host name.\n\nThough this statement alone is enough to enable statistics reporting, it is\nrecommended to set all other settings in order to avoid relying on default\nunobvious parameters.\n\n```\n\nExample:```\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats show-node Europe-1\n    stats uri       /admin?stats\n    stats refresh   5s\n\n```\n\n**See also:**\"show-desc\", \"[stats enable](#stats%20enable)\", \"[stats uri](#stats%20uri)\", and \"[node](#node)\" in global section.**[stats uri](#4.2-stats%20uri)**<prefix>```\nEnable statistics and define the URI prefix to access them\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<prefix>  is the prefix of any URI which will be redirected to stats. This\n          prefix may contain a question mark ('?') to indicate part of a\n          query string.\n```\n\n```\nThe statistics URI is intercepted on the relayed traffic, so it appears as a\npage within the normal application. It is strongly advised to ensure that the\nselected URI will never appear in the application, otherwise it will never be\npossible to reach it in the application.\n\nThe default URI compiled in HAProxy is \"/haproxy?stats\", but this may be\nchanged at build time, so it's better to always explicitly specify it here.\nIt is generally a good idea to include a question mark in the URI so that\nintermediate proxies refrain from caching the results. Also, since any string\nbeginning with the prefix will be accepted as a stats request, the question\nmark helps ensuring that no valid URI will begin with the same words.\n\nIt is sometimes very convenient to use \"/\" as the URI prefix, and put that\nstatement in a \"listen\" instance of its own. That makes it easy to dedicate\nan address or a port to statistics only.\n\nThough this statement alone is enough to enable statistics reporting, it is\nrecommended to set all other settings in order to avoid relying on default\nunobvious parameters.\n\n```\n\nExample :```\n\n# public access (limited to this backend only)\nbackend public_www\n    server srv1 192.168.0.1:80\n    stats enable\n    stats hide-version\n    stats scope   .\n    stats uri     /admin?stats\n    stats realm   HAProxy\\ Statistics\n    stats auth    admin1:AdMiN123\n    stats auth    admin2:AdMiN321\n\n# internal monitoring access (unlimited)\nbackend private_monitoring\n    stats enable\n    stats uri     /admin?stats\n    stats refresh 5s\n\n```\n\n**See also :**\"[stats auth](#stats%20auth)\", \"[stats enable](#stats%20enable)\", \"[stats realm](#stats%20realm)\"**[stick match](#4.2-stick%20match)**<pattern>[table<table>][{if | unless}<cond>]```\nDefine a request pattern matching condition to stick a user to a server\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyesArguments :```\n<pattern>  is a sample expression rule as described in section 7.3. It\n           describes what elements of the incoming request or connection\n           will be analyzed in the hope to find a matching entry in a\n           stickiness table. This rule is mandatory.\n\n<table>    is an optional stickiness table name. If unspecified, the same\n           backend's table is used. A stickiness table is declared using\n           the \"stick-tableThis keyword is available in sections :Stick-tables declarationAlphabetically sorted keywords reference\" statement.\n\n<cond>     is an optional matching condition. It makes it possible to match\n           on a certain criterion only when other conditions are met (or\n           not met). For instance, it could be used to match on a source IP\n           address except when a request passes through a known proxy, in\n           which case we'd match on a header containing that IP address.\n```\n\n```\nSome protocols or applications require complex stickiness rules and cannot\nalways simply rely on cookies nor hashing. The \"stick match\" statement\ndescribes a rule to extract the stickiness criterion from an incoming request\nor connection. See section 7 for a complete list of possible patterns and\ntransformation rules.\n\nThe table has to be declared using the \"stick-tableThis keyword is available in sections :Stick-tables declarationAlphabetically sorted keywords reference\" statement. It must be of\na type compatible with the pattern. By default it is the one which is present\nin the same backend. It is possible to share a table with other backends by\nreferencing it using the \"tableThis keyword is available in sections :Stick-tables declarationPeers declaration\" keyword. If another table is referenced,\nthe server's ID inside the backends are used. By default, all server IDs\nstart at 1 in each backend, so the server ordering is enough. But in case of\ndoubt, it is highly recommended to force server IDs using their \"idThis keyword is available in sections :Alphabetically sorted keywords referenceBind optionsServer and default-server options\" setting.\n\nIt is possible to restrict the conditions where a \"stick match\" statement\nwill apply, using \"if\" or \"unless\" followed by a condition. See section 7 for\nACL based conditions.\n\nThere is no limit on the number of \"stick match\" statements. The first that\napplies and matches will cause the request to be directed to the same server\nas was used for the request which created the entry. That way, multiple\nmatches can be used as fallbacks.\n\nThe stick rules are checked after the persistence cookies, so they will not\naffect stickiness if a cookie has already been used to select a server. That\nway, it becomes very easy to insert cookies and match on IP addresses in\norder to maintain stickiness between HTTP and HTTPS.\n\n```\n\nExample :```\n\n# forward SMTP users to the same server they just used for POP in the\n# last 30 minutes\nbackend pop\n    mode tcp\n    balance roundrobin\n    stick store-request src\n    stick-table type ip size 200k expire 30m\n    server s1 192.168.1.1:110\n    server s2 192.168.1.1:110\n\nbackend smtp\n    mode tcp\n    balance roundrobin\n    stick match src table pop\n    server s1 192.168.1.1:25\n    server s2 192.168.1.1:25\n\n```\n\n**See also :**\"[stick-table](#)- This keyword is available in sections :\n- [Stick-tables declaration](#stick-table%20%28Stick-tables%20declaration%29)\n- [Alphabetically sorted keywords reference](#stick-table%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[stick on](#stick%20on)\",[section 11](#11)about stick-tables, and[section 7](#7)about ACLs and samples fetching.**[stick on](#4.2-stick%20on)**<pattern>[table<table>][{if | unless}<condition>]```\nDefine a request pattern to associate a user to a server\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyes```\nNote : This form is exactly equivalent to \"stick match\" followed by\n       \"stick store-request\", all with the same arguments. Please refer\n       to both keywords for details. It is only provided as a convenience\n       for writing more maintainable configurations.\n\n```\n\nExamples :```\n\n# The following form ...\nstick on src table pop if !localhost\n\n# ...is strictly equivalent to this one :\nstick match src table pop if !localhost\nstick store-request src table pop if !localhost\n\n\n# Use cookie persistence for HTTP, and stick on source address for HTTPS as\n# well as HTTP without cookie. Share the same table between both accesses.\nbackend http\n    mode http\n    balance roundrobin\n    stick on src table https\n    cookie SRV insert indirect nocache\n    server s1 192.168.1.1:80 cookie s1\n    server s2 192.168.1.1:80 cookie s2\n\nbackend https\n    mode tcp\n    balance roundrobin\n    stick-table type ip size 200k expire 30m\n    stick on src\n    server s1 192.168.1.1:443\n    server s2 192.168.1.1:443\n\n```\n\n**See also :**\"[stick match](#stick%20match)\", \"[stick store-request](#stick%20store-request)\", and[section 11](#11)about stick-tables.**[stick store-request](#4.2-stick%20store-request)**<pattern>[table<table>][{if | unless}<condition>]```\nDefine a request pattern used to create an entry in a stickiness table\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyesArguments :```\n<pattern>  is a sample expression rule as described in section 7.3. It\n           describes what elements of the incoming request or connection\n           will be analyzed, extracted and stored in the table once a\n           server is selected.\n\n<table>    is an optional stickiness table name. If unspecified, the same\n           backend's table is used. A stickiness table is declared using\n           the \"stick-tableThis keyword is available in sections :Stick-tables declarationAlphabetically sorted keywords reference\" statement.\n\n<cond>     is an optional storage condition. It makes it possible to store\n           certain criteria only when some conditions are met (or not met).\n           For instance, it could be used to store the source IP address\n           except when the request passes through a known proxy, in which\n           case we'd store a converted form of a header containing that IP\n           address.\n```\n\n```\nSome protocols or applications require complex stickiness rules and cannot\nalways simply rely on cookies nor hashing. The \"stick store-request\" statement\ndescribes a rule to decide what to extract from the request and when to do\nit, in order to store it into a stickiness table for further requests to\nmatch it using the \"stick match\" statement. Obviously the extracted part must\nmake sense and have a chance to be matched in a further request. Storing a\nclient's IP address for instance often makes sense. Storing an ID found in a\nURL parameter also makes sense. Storing a source port will almost never make\nany sense because it will be randomly matched. See section 7 for a complete\nlist of possible patterns and transformation rules.\n\nThe table has to be declared using the \"stick-tableThis keyword is available in sections :Stick-tables declarationAlphabetically sorted keywords reference\" statement. It must be of\na type compatible with the pattern. By default it is the one which is present\nin the same backend. It is possible to share a table with other backends by\nreferencing it using the \"tableThis keyword is available in sections :Stick-tables declarationPeers declaration\" keyword. If another table is referenced,\nthe server's ID inside the backends are used. By default, all server IDs\nstart at 1 in each backend, so the server ordering is enough. But in case of\ndoubt, it is highly recommended to force server IDs using their \"idThis keyword is available in sections :Alphabetically sorted keywords referenceBind optionsServer and default-server options\" setting.\n\nIt is possible to restrict the conditions where a \"stick store-request\"\nstatement will apply, using \"if\" or \"unless\" followed by a condition. This\ncondition will be evaluated while parsing the request, so any criteria can be\nused. See section 7 for ACL based conditions.\n\nThere is no limit on the number of \"stick store-request\" statements, but\nthere is a limit of 8 simultaneous stores per request or response. This\nmakes it possible to store up to 8 criteria, all extracted from either the\nrequest or the response, regardless of the number of rules. Only the 8 first\nones which match will be kept. Using this, it is possible to feed multiple\ntables at once in the hope to increase the chance to recognize a user on\nanother protocol or access method. Using multiple store-request rules with\nthe same table is possible and may be used to find the best criterion to rely\non, by arranging the rules by decreasing preference order. Only the first\nextracted criterion for a given table will be stored. All subsequent store-\nrequest rules referencing the same table will be skipped and their ACLs will\nnot be evaluated.\n\nThe \"store-request\" rules are evaluated once the server connection has been\nestablished, so that the table will contain the real server that processed\nthe request.\n\n```\n\nExample :```\n\n# forward SMTP users to the same server they just used for POP in the\n# last 30 minutes\nbackend pop\n    mode tcp\n    balance roundrobin\n    stick store-request src\n    stick-table type ip size 200k expire 30m\n    server s1 192.168.1.1:110\n    server s2 192.168.1.1:110\n\nbackend smtp\n    mode tcp\n    balance roundrobin\n    stick match src table pop\n    server s1 192.168.1.1:25\n    server s2 192.168.1.1:25\n\n```\n\n**See also :**\"[stick-table](#)- This keyword is available in sections :\n- [Stick-tables declaration](#stick-table%20%28Stick-tables%20declaration%29)\n- [Alphabetically sorted keywords reference](#stick-table%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[stick on](#stick%20on)\",[section 11](#11)about stick-tables, and[section 7](#7)about ACLs and sample fetching.**[stick store-response](#4.2-stick%20store-response)**<pattern>[table<table>][{if | unless}<condition>]```\nDefine a response pattern used to create an entry in a stickiness table\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyesArguments :```\n<pattern>  is a sample expression rule as described in section 7.3. It\n           describes what elements of the response or connection will\n           be analyzed, extracted and stored in the table once a\n           server is selected.\n\n<table>    is an optional stickiness table name. If unspecified, the same\n           backend's table is used. A stickiness table is declared using\n           the \"stick-tableThis keyword is available in sections :Stick-tables declarationAlphabetically sorted keywords reference\" statement.\n\n<cond>     is an optional storage condition. It makes it possible to store\n           certain criteria only when some conditions are met (or not met).\n           For instance, it could be used to store the SSL session ID only\n           when the response is a SSL server hello.\n```\n\n```\nSome protocols or applications require complex stickiness rules and cannot\nalways simply rely on cookies nor hashing. The \"stick store-response\"\nstatement  describes a rule to decide what to extract from the response and\nwhen to do it, in order to store it into a stickiness table for further\nrequests to match it using the \"stick match\" statement. Obviously the\nextracted part must make sense and have a chance to be matched in a further\nrequest. Storing an ID found in a header of a response makes sense.\nSee section 7 for a complete list of possible patterns and transformation\nrules.\n\nThe table has to be declared using the \"stick-tableThis keyword is available in sections :Stick-tables declarationAlphabetically sorted keywords reference\" statement. It must be of\na type compatible with the pattern. By default it is the one which is present\nin the same backend. It is possible to share a table with other backends by\nreferencing it using the \"tableThis keyword is available in sections :Stick-tables declarationPeers declaration\" keyword. If another table is referenced,\nthe server's ID inside the backends are used. By default, all server IDs\nstart at 1 in each backend, so the server ordering is enough. But in case of\ndoubt, it is highly recommended to force server IDs using their \"idThis keyword is available in sections :Alphabetically sorted keywords referenceBind optionsServer and default-server options\" setting.\n\nIt is possible to restrict the conditions where a \"stick store-response\"\nstatement will apply, using \"if\" or \"unless\" followed by a condition. This\ncondition will be evaluated while parsing the response, so any criteria can\nbe used. See section 7 for ACL based conditions.\n\nThere is no limit on the number of \"stick store-response\" statements, but\nthere is a limit of 8 simultaneous stores per request or response. This\nmakes it possible to store up to 8 criteria, all extracted from either the\nrequest or the response, regardless of the number of rules. Only the 8 first\nones which match will be kept. Using this, it is possible to feed multiple\ntables at once in the hope to increase the chance to recognize a user on\nanother protocol or access method. Using multiple store-response rules with\nthe same table is possible and may be used to find the best criterion to rely\non, by arranging the rules by decreasing preference order. Only the first\nextracted criterion for a given table will be stored. All subsequent store-\nresponse rules referencing the same table will be skipped and their ACLs will\nnot be evaluated. However, even if a store-request rule references a table, a\nstore-response rule may also use the same table. This means that each table\nmay learn exactly one element from the request and one element from the\nresponse at once.\n\nThe table will contain the real server that processed the request.\n\n```\n\nExample :```\n\n# Learn SSL session ID from both request and response and create affinity.\nbackend https\n    mode tcp\n    balance roundrobin\n    # maximum SSL session ID length is 32 bytes.\n    stick-table type binary len 32 size 30k expire 30m\n\n    acl clienthello req.ssl_hello_type 1\n    acl serverhello res.ssl_hello_type 2\n\n    # use tcp content accepts to detects ssl client and server hello.\n    tcp-request inspect-delay 5s\n    tcp-request content accept if clienthello\n\n    # no timeout on response inspect delay by default.\n    tcp-response content accept if serverhello\n\n    # SSL session ID (SSLID) may be present on a client or server hello.\n    # Its length is coded on 1 byte at offset 43 and its value starts\n    # at offset 44.\n\n    # Match and learn on request if client hello.\n    stick on req.payload_lv(43,1) if clienthello\n\n    # Learn on response if server hello.\n    stick store-response resp.payload_lv(43,1) if serverhello\n\n    server s1 192.168.1.1:443\n    server s2 192.168.1.1:443\n\n```\n\n**See also :**\"[stick-table](#)- This keyword is available in sections :\n- [Stick-tables declaration](#stick-table%20%28Stick-tables%20declaration%29)\n- [Alphabetically sorted keywords reference](#stick-table%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[stick on](#stick%20on)\",[section 11](#11)about stick-tables, and[section 7](#7)about ACLs and pattern extraction.**[stick-table type](#4.2-stick-table%20type)**<type>size<size>[expire<expire>][args...]```\nConfigure the stickiness table for the current section\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesyes```\nThis is used to declare and configure a stick-table. Please refer to section\n11.1 for the complete details and the list of supported arguments. Only the\ntype and the size are mandatory.\n\n```\n\n**[tcp-check comment](#4.2-tcp-check%20comment)**<string>```\nDefines a comment for the following the tcp-check rule, reported in logs if\nit fails.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<string>  is the comment message to add in logs if the following tcp-check\n          rule fails.\n```\n\n```\nIt only works for connect, send and expect rules. It is useful to make\nuser-friendly error reporting.\n\n```\n\n**See also :**\"[option tcp-check](#option%20tcp-check)\", \"[tcp-check connect](#tcp-check%20connect)\", \"[tcp-check send](#tcp-check%20send)\" and \"[tcp-check expect](#tcp-check%20expect)\".**[tcp-check connect](#4.2-tcp-check%20connect)**[default][port<expr>][addr<ip>][send-proxy][via-socks4][ssl][sni<sni>][alpn<alpn>][linger][proto<name>][comment<msg>]```\nOpens a new connection\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\ncomment <msg>  defines a message to report if the rule evaluation fails.\n\ndefault      Use default options of the server line to do the health\n             checks. The server options are used only if not redefined.\n\nport <expr>  if not set, check port or server port is used.\n             It tells HAProxy where to open the connection to.\n             <port> must be a valid TCP port source integer, from 1 to\n             65535 or an sample-fetch expression.\n\naddr <ip>    defines the IP address to do the health check.\n\nsend-proxy   send a PROXY protocol string\n\nvia-socks4   enables outgoing health checks using upstream socks4 proxy.\n\nssl          opens a ciphered connection\n\nsni <sni>    specifies the SNI to use to do health checks over SSL.\n\nalpn <alpn>  defines which protocols to advertise with ALPN. The protocol\n             list consists in a comma-delimited list of protocol names,\n             for instance: \"http/1.1,http/1.0\" (without quotes).\n             If it is not set, the server ALPN is used.\n\nproto <name> forces the multiplexer's protocol to use for this connection.\n             It must be a TCP mux protocol and it must be usable on the\n             backend side. The list of available protocols is reported in\n             haproxy -vv.\n\nlinger       cleanly close the connection instead of using a single RST.\n```\n\n```\nWhen an application lies on more than a single TCP port or when HAProxy\nload-balance many services in a single backend, it makes sense to probe all\nthe services individually before considering a server as operational.\n\nWhen there are no TCP port configured on the server line neither server port\ndirective, then the 'tcp-check connect port <port>' must be the first step\nof the sequence.\n\nIn a tcp-check ruleset a 'connect' is required, it is also mandatory to start\nthe ruleset with a 'connect' rule. Purpose is to ensure admin know what they\ndo.\n\nWhen a connect must start the ruleset, if may still be preceded by set-var,\nunset-var or comment rules.\n\n```\n\nExamples :```\n\n# check HTTP and HTTPs services on a server.\n# first open port 80 thanks to server line port directive, then\n# tcp-check opens port 443, ciphered and run a request on it:\noption tcp-check\ntcp-check connect\ntcp-check send GET\\ /\\ HTTP/1.0\\r\\n\ntcp-check send Host:\\ haproxy.1wt.eu\\r\\n\ntcp-check send \\r\\n\ntcp-check expect rstring (2..|3..)\ntcp-check connect port 443 ssl\ntcp-check send GET\\ /\\ HTTP/1.0\\r\\n\ntcp-check send Host:\\ haproxy.1wt.eu\\r\\n\ntcp-check send \\r\\n\ntcp-check expect rstring (2..|3..)\nserver www 10.0.0.1 check port 80\n\n# check both POP and IMAP from a single server:\noption tcp-check\ntcp-check connect port 110 linger\ntcp-check expect string +OK\\ POP3\\ ready\ntcp-check connect port 143\ntcp-check expect string *\\ OK\\ IMAP4\\ ready\nserver mail 10.0.0.1 check\n\n```\n\n**See also :**\"[option tcp-check](#option%20tcp-check)\", \"[tcp-check send](#tcp-check%20send)\", \"[tcp-check expect](#tcp-check%20expect)\"**[tcp-check expect](#4.2-tcp-check%20expect)**[min-recv<int>][comment<msg>][ok-status<st>][error-status<st>][tout-status<st>][on-success<fmt>][on-error<fmt>][status-code<expr>][!]<match><pattern>```\nSpecify data to be collected and analyzed during a generic health check\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\ncomment <msg>  defines a message to report if the rule evaluation fails.\n\nmin-recv  is optional and can define the minimum amount of data required to\n          evaluate the current expect rule. If the number of received bytes\n          is under this limit, the check will wait for more data. This\n          option can be used to resolve some ambiguous matching rules or to\n          avoid executing costly regex matches on content known to be still\n          incomplete. If an exact string (string or binary) is used, the\n          minimum between the string length and this parameter is used.\n          This parameter is ignored if it is set to -1. If the expect rule\n          does not match, the check will wait for more data. If set to 0,\n          the evaluation result is always conclusive.\n\n<match>   is a keyword indicating how to look for a specific pattern in the\n          response. The keyword may be one of \"string\", \"rstring\", \"binary\" or\n          \"rbinary\".\n          The keyword may be preceded by an exclamation mark (\"!\") to negate\n          the match. Spaces are allowed between the exclamation mark and the\n          keyword. See below for more details on the supported keywords.\n\nok-status <st>     is optional and can be used to set the check status if\n                   the expect rule is successfully evaluated and if it is\n                   the last rule in the tcp-check ruleset. \"L7OK\", \"L7OKC\",\n                   \"L6OK\" and \"L4OK\" are supported :\n                     - L7OK  : check passed on layer 7\n                     - L7OKC : check conditionally passed on layer 7, set\n                               server to NOLB state.\n                     - L6OK  : check passed on layer 6\n                     - L4OK  : check passed on layer 4\n                    By default \"L7OK\" is used.\n\nerror-status <st>  is optional and can be used to set the check status if\n                   an error occurred during the expect rule evaluation.\n                   \"L7OKC\", \"L7RSP\", \"L7STS\", \"L6RSP\" and \"L4CON\" are\n                   supported :\n                     - L7OKC : check conditionally passed on layer 7, set\n                               server to NOLB state.\n                     - L7RSP : layer 7 invalid response - protocol error\n                     - L7STS : layer 7 response error, for example HTTP 5xx\n                     - L6RSP : layer 6 invalid response - protocol error\n                     - L4CON : layer 1-4 connection problem\n                   By default \"L7RSP\" is used.\n\ntout-status <st>   is optional and can be used to set the check status if\n                   a timeout occurred during the expect rule evaluation.\n                   \"L7TOUT\", \"L6TOUT\", and \"L4TOUT\" are supported :\n                     - L7TOUT : layer 7 (HTTP/SMTP) timeout\n                     - L6TOUT : layer 6 (SSL) timeout\n                     - L4TOUT : layer 1-4 timeout\n                   By default \"L7TOUT\" is used.\n\non-success <fmt>   is optional and can be used to customize the\n                   informational message reported in logs if the expect\n                   rule is successfully evaluated and if it is the last rule\n                   in the tcp-check ruleset. <fmt> is a Custom log format\n                   (see section 8.2.6).\n\non-error <fmt>     is optional and can be used to customize the\n                   informational message reported in logs if an error\n                   occurred during the expect rule evaluation. <fmt> is a\n                   Custom log format (see section 8.2.6).\n\nstatus-code <expr> is optional and can be used to set the check status code\n                   reported in logs, on success or on error. <expr> is a\n                   standard HAProxy expression formed by a sample-fetch\n                   followed by some converters.\n\n<pattern> is the pattern to look for. It may be a string or a regular\n          expression. If the pattern contains spaces, they must be escaped\n          with the usual backslash ('\\').\n          If the match is set to binary, then the pattern must be passed as\n          a series of hexadecimal digits in an even number. Each sequence of\n          two digits will represent a byte. The hexadecimal digits may be\n          used upper or lower case.\n```\n\n```\nThe available matches are intentionally similar to their http-check cousins :\n\n  string <string> : test the exact string matches in the response buffer.\n                    A health check response will be considered valid if the\n                    response's buffer contains this exact string. If the\n                    \"string\" keyword is prefixed with \"!\", then the response\n                    will be considered invalid if the body contains this\n                    string. This can be used to look for a mandatory pattern\n                    in a protocol response, or to detect a failure when a\n                    specific error appears in a protocol banner.\n\n  rstring <regex> : test a regular expression on the response buffer.\n                    A health check response will be considered valid if the\n                    response's buffer matches this expression. If the\n                    \"rstring\" keyword is prefixed with \"!\", then the response\n                    will be considered invalid if the body matches the\n                    expression.\n\n  string-lf <fmt> : test a Custom log format match in the response's buffer.\n                    A health check response will be considered valid if the\n                    response's buffer contains the  string resulting of the\n                    evaluation of <fmt>, which follows the Custom log format\n                    rules described in section 8.2.6. If prefixed with \"!\",\n                    then the response will be considered invalid if the\n                    buffer contains the string.\n\n  binary <hexstring> : test the exact string in its hexadecimal form matches\n                       in the response buffer. A health check response will\n                       be considered valid if the response's buffer contains\n                       this exact hexadecimal string.\n                       Purpose is to match data on binary protocols.\n\n  rbinary <regex> : test a regular expression on the response buffer, like\n                    \"rstring\". However, the response buffer is transformed\n                    into its hexadecimal form, including NUL-bytes. This\n                    allows using all regex engines to match any binary\n                    content.  The hexadecimal transformation takes twice the\n                    size of the original response. As such, the expected\n                    pattern should work on at-most half the response buffer\n                    size.\n\n  binary-lf <hexfmt> : test a Custom log format in its hexadecimal form match\n                       in the response's buffer. A health check response will\n                       be considered valid if the response's buffer contains\n                       the hexadecimal string resulting of the evaluation of\n                       <fmt>, which follows the Custom log format rules (see\n                       section 8.2.6). If prefixed with \"!\", then the\n                       response will be considered invalid if the buffer\n                       contains the hexadecimal string. The hexadecimal\n                       string is converted in a binary string before matching\n                       the response's buffer.\n\nIt is important to note that the responses will be limited to a certain size\ndefined by the global \"tune.bufsize\" option, which defaults to 16384 bytes.\nThus, too large responses may not contain the mandatory pattern when using\n\"string\", \"rstring\" or binary. If a large response is absolutely required, it\nis possible to change the default max size by setting the global variable.\nHowever, it is worth keeping in mind that parsing very large responses can\nwaste some CPU cycles, especially when regular expressions are used, and that\nit is always better to focus the checks on smaller resources. Also, in its\ncurrent state, the check will not find any string nor regex past a null\ncharacter in the response. Similarly it is not possible to request matching\nthe null character.\n\n```\n\nExamples :```\n\n# perform a POP check\noption tcp-check\ntcp-check expect string +OK\\ POP3\\ ready\n\n# perform an IMAP check\noption tcp-check\ntcp-check expect string *\\ OK\\ IMAP4\\ ready\n\n# look for the redis master server\noption tcp-check\ntcp-check send PING\\r\\n\ntcp-check expect string +PONG\ntcp-check send info\\ replication\\r\\n\ntcp-check expect string role:master\ntcp-check send QUIT\\r\\n\ntcp-check expect string +OK\n\n```\n\n**See also :**\"[option tcp-check](#option%20tcp-check)\", \"[tcp-check connect](#tcp-check%20connect)\", \"[tcp-check send](#tcp-check%20send)\", \"[tcp-check send-binary](#tcp-check%20send-binary)\", \"[http-check expect](#http-check%20expect)\", tune.bufsize**[tcp-check send](#4.2-tcp-check%20send)**<data>[comment<msg>]**[tcp-check send-lf](#4.2-tcp-check%20send-lf)**<fmt>[comment<msg>]```\nSpecify a string or a Custom log format to be sent as a question during a\ngeneric health check\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\ncomment <msg>  defines a message to report if the rule evaluation fails.\n\n<data>         is the string that will be sent during a generic health\n               check session.\n\n<fmt>          is the Custom log format that will be sent, once evaluated,\n               during a generic health check session (see section 8.2.6).\n```\n\nExamples :```\n\n# look for the redis master server\noption tcp-check\ntcp-check send info\\ replication\\r\\n\ntcp-check expect string role:master\n\n```\n\n**See also :**\"[option tcp-check](#option%20tcp-check)\", \"[tcp-check connect](#tcp-check%20connect)\", \"[tcp-check expect](#tcp-check%20expect)\", \"[tcp-check send-binary](#tcp-check%20send-binary)\", tune.bufsize**[tcp-check send-binary](#4.2-tcp-check%20send-binary)**<hexstring>[comment<msg>]**[tcp-check send-binary-lf](#4.2-tcp-check%20send-binary-lf)**<hexfmt>[comment<msg>]```\nSpecify an hex digits string or an hex digits Custom log format to be sent as\na binary question during a raw tcp health check\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\ncomment <msg>  defines a message to report if the rule evaluation fails.\n\n<hexstring>    is the hexadecimal string that will be send, once converted\n               to binary, during a generic health check session.\n\n<hexfmt>       is the hexadecimal Custom log format that will be send, once\n               evaluated and converted to binary, during a generic health\n               check session (see section 8.2.6).\n```\n\nExamples :```\n\n# redis check in binary\noption tcp-check\ntcp-check send-binary 50494e470d0a # PING\\r\\n\ntcp-check expect binary 2b504F4e47 # +PONG\n\n```\n\n**See also :**\"[option tcp-check](#option%20tcp-check)\", \"[tcp-check connect](#tcp-check%20connect)\", \"[tcp-check expect](#tcp-check%20expect)\", \"[tcp-check send](#tcp-check%20send)\", tune.bufsize**[tcp-check set-var](#4.2-tcp-check%20set-var)**(<var-name>[,<cond>...])<expr>**[tcp-check set-var-fmt](#4.2-tcp-check%20set-var-fmt)**(<var-name>[,<cond>...])<fmt>```\nThis operation sets the content of a variable. The variable is declared inline.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<var-name>   The name of the variable. Only \"proc\", \"sess\" and \"check\"\n             scopes can be used. See section 2.8 about variables for details.\n\n <cond>      A set of conditions that must all be true for the variable to\n             actually be set (such as \"ifnotempty\", \"ifgt\" ...). See the\n             set-var converter's description for a full list of possible\n             conditions.\n\n <expr>      Is a sample-fetch expression potentially followed by converters.\n\n <fmt>       This is the value expressed using Custom log format rules (see\n             Custom log format in section 8.2.6).\n```\n\nExamples :```\n\ntcp-check set-var(check.port) int(1234)\ntcp-check set-var-fmt(check.name) \"%H\"\n\n```\n\n**[tcp-check unset-var](#4.2-tcp-check%20unset-var)**(<var-name>)```\nFree a reference to a variable within its scope.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<var-name>   The name of the variable. Only \"proc\", \"sess\" and \"check\"\n             scopes can be used. See section 2.8 about variables for details.\n```\n\nExamples :```\n\ntcp-check unset-var(check.port)\n\n```\n\n**[tcp-request connection](#4.2-tcp-request%20connection)**<action><options...>[{ if | unless }<condition>]```\nPerform an action on an incoming connection depending on a layer 4 condition\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyes(!)yesyesnoArguments :```\n<action>    defines the action to perform if the condition applies. See\n            below.\n\n<condition> is a standard layer4-only ACL-based condition (see section 7).\n```\n\n```\nImmediately after acceptance of a new incoming connection, it is possible to\nevaluate some conditions to decide whether this connection must be accepted\nor dropped or have its counters tracked. Those conditions cannot make use of\nany data contents because the connection has not been read from yet, and the\nbuffers are not yet allocated. This is used to selectively and very quickly\naccept or drop connections from various sources with a very low overhead. If\nsome contents need to be inspected in order to take the decision, the\n\"tcp-request content\" statements must be used instead.\n\nThe \"tcp-request connection\" rules are evaluated in their exact declaration\norder. If no rule matches or if there is no rule, the default action is to\naccept the incoming connection. There is no specific limit to the number of\nrules which may be inserted. Any rule may optionally be followed by an\nACL-based condition, in which case it will only be evaluated if the condition\nevaluates to true.\n\nThe condition is evaluated just before the action is executed, and the action\nis performed exactly once. As such, there is no problem if an action changes\nan element which is checked as part of the condition. This also means that\nmultiple actions may rely on the same condition so that the first action that\nchanges the condition's evaluation is sufficient to implicitly disable the\nremaining actions. This is used for example when trying to assign a value to\na variable from various sources when it's empty.\n\nThe first keyword after \"tcp-request connection\" in the syntax is the rule's\naction, optionally followed by a varying number of arguments for the action.\nThe supported actions and their respective syntaxes are enumerated in\nsection 4.3 \"Actions\" (look for actions which tick \"TCP RqCon\").\n\nThis directive is only available from named defaults sections, not anonymous\nones. Rules defined in the defaults section are evaluated before ones in the\nassociated proxy section. To avoid ambiguities, in this case the same\ndefaults section cannot be used by proxies with the frontend capability and\nby proxies with the backend capability. It means a listen section cannot use\na defaults section defining such rules.\n\nNote that the \"if/unless\" condition is optional. If no condition is set on\nthe action, it is simply performed unconditionally. That can be useful for\n\"track-sc*\" actions as well as for changing the default action to a reject.\n\n```\n\nExample:```\n\nAccept all connections from white-listed hosts, reject too fast connection without counting them, and track accepted connections. This results in connection rate being capped from abusive sources.tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }\ntcp-request connection reject if { src_conn_rate gt 10 }\ntcp-request connection track-sc0 src\n\n```\n\nExample:```\n\nAccept all connections from white-listed hosts, count all other connections and reject too fast ones. This results in abusive ones being blocked as long as they don't slow down.tcp-request connection accept if { src -f /etc/haproxy/whitelist.lst }\ntcp-request connection track-sc0 src\ntcp-request connection reject if { sc0_conn_rate gt 10 }\n\n```\n\nExample:```\n\nEnable the PROXY protocol for traffic coming from all known proxies.tcp-request connection expect-proxy layer4 if { src -f proxies.lst }\n\n```\n\n```\nSee section 7 about ACL usage.\n\n```\n\n**See also :**\"[tcp-request session](#tcp-request%20session)\", \"[tcp-request content](#tcp-request%20content)\", \"[stick-table](#)- This keyword is available in sections :\n- [Stick-tables declaration](#stick-table%20%28Stick-tables%20declaration%29)\n- [Alphabetically sorted keywords reference](#stick-table%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\"**[tcp-request content](#4.2-tcp-request%20content)**<action>[{if | unless}<condition>]```\nPerform an action on a new session depending on a layer 4-7 condition\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyes(!)yesyesyesArguments :```\n<action>    defines the action to perform if the condition applies. See\n            below.\n\n<condition> is a standard layer 4-7 ACL-based condition (see section 7).\n```\n\n```\nA request's contents can be analyzed at an early stage of request processing\ncalled \"TCP content inspection\". During this stage, ACL-based rules are\nevaluated every time the request contents are updated, until either an\n\"accept\", a \"reject\" or a \"switch-mode\" rule matches, or the TCP request\ninspection delay expires with no matching rule.\n\nThe first difference between these rules and \"tcp-request connection\" rules\nis that \"tcp-request content\" rules can make use of contents to take a\ndecision. Most often, these decisions will consider a protocol recognition or\nvalidity. The second difference is that content-based rules can be used in\nboth frontends and backends. In case of HTTP keep-alive with the client, all\ntcp-request content rules are evaluated again, so HAProxy keeps a record of\nwhat sticky counters were assigned by a \"tcp-request connection\" versus a\n\"tcp-request content\" rule, and flushes all the content-related ones after\nprocessing an HTTP request, so that they may be evaluated again by the rules\nbeing evaluated again for the next request. This is of particular importance\nwhen the rule tracks some L7 information or when it is conditioned by an\nL7-based ACL, since tracking may change between requests.\n\nContent-based rules are evaluated in their exact declaration order. If no\nrule matches or if there is no rule, the default action is to accept the\ncontents. There is no specific limit to the number of rules which may be\ninserted.\n\nWhile there is nothing mandatory about it, it is recommended to use the\ntrack-sc0 in \"tcp-request connection\" rules, track-sc1 for \"tcp-request\ncontent\" rules in the frontend, and track-sc2 for \"tcp-request content\"\nrules in the backend, because that makes the configuration more readable\nand easier to troubleshoot, but this is just a guideline and all counters\nmay be used everywhere.\n\nThe first keyword after \"tcp-request content\" in the syntax is the rule's\naction, optionally followed by a varying number of arguments for the action.\nThe supported actions and their respective syntaxes are enumerated in\nsection 4.3 \"Actions\" (look for actions which tick \"TCP RqCnt\").\n\nThis directive is only available from named defaults sections, not anonymous\nones. Rules defined in the defaults section are evaluated before ones in the\nassociated proxy section. To avoid ambiguities, in this case the same\ndefaults section cannot be used by proxies with the frontend capability and\nby proxies with the backend capability. It means a listen section cannot use\na defaults section defining such rules.\n\nNote that the \"if/unless\" condition is optional. If no condition is set on\nthe action, it is simply performed unconditionally. That can be useful for\n\"track-sc*\" actions as well as for changing the default action to a reject.\n\nNote also that it is recommended to use a \"tcp-request session\" rule to track\ninformation that does *not* depend on Layer 7 contents, especially for HTTP\nfrontends. Some HTTP processing are performed at the session level and may\nlead to an early rejection of the requests. Thus, the tracking at the content\nlevel may be disturbed in such case. A warning is emitted during startup to\nprevent, as far as possible, such unreliable usage.\n\nIt is perfectly possible to match layer 7 contents with \"tcp-request content\"\nrules from a TCP proxy, since HTTP-specific ACL matches are able to\npreliminarily parse the contents of a buffer before extracting the required\ndata. If the buffered contents do not parse as a valid HTTP message, then the\nACL does not match.  The parser which is involved there is exactly the same\nas for all other HTTP processing, so there is no risk of parsing something\ndifferently. In an HTTP frontend or an HTTP backend, it is guaranteed that\nHTTP contents will always be immediately present when the rule is evaluated\nfirst because the HTTP parsing is performed in the early stages of the\nconnection processing, at the session level. But for such proxies, using\n\"http-request\" rules is much more natural and recommended.\n\nTracking layer7 information is also possible provided that the information\nare present when the rule is processed. The rule processing engine is able to\nwait until the inspect delay expires when the data to be tracked is not yet\navailable.\n\n```\n\nExample:```\n\ntcp-request content use-service lua.deny if { src -f /etc/haproxy/blacklist.lst }\n\n```\n\nExample:```\n\ntcp-request content set-var(sess.my_var) src\ntcp-request content set-var-fmt(sess.from) %[src]:%[src_port]\ntcp-request content unset-var(sess.my_var2)\n\n```\n\nExample:```\n\n# Accept HTTP requests containing a Host header saying \"example.com\"\n# and reject everything else. (Only works for HTTP/1 connections)\nacl is_host_com hdr(Host) -i example.com\ntcp-request inspect-delay 30s\ntcp-request content accept if is_host_com\ntcp-request content reject\n\n# Accept HTTP requests containing a Host header saying \"example.com\"\n# and reject everything else. (works for HTTP/1 and HTTP/2 connections)\nacl is_host_com hdr(Host) -i example.com\ntcp-request inspect-delay 5s\ntcp-request content switch-mode http if HTTP\ntcp-request content reject   # non-HTTP traffic is implicit here\n...\nhttp-request reject unless is_host_com\n\n```\n\nExample:```\n\n# reject SMTP connection if client speaks first\ntcp-request inspect-delay 30s\nacl content_present req.len gt 0\ntcp-request content reject if content_present\n\n# Forward HTTPS connection only if client speaks\ntcp-request inspect-delay 30s\nacl content_present req.len gt 0\ntcp-request content accept if content_present\ntcp-request content reject\n\n```\n\nExample:```\n\n# Track the last IP(stick-table type string) from X-Forwarded-For\ntcp-request inspect-delay 10s\ntcp-request content track-sc0 hdr(x-forwarded-for,-1)\n# Or track the last IP(stick-table type ip|ipv6) from X-Forwarded-For\ntcp-request content track-sc0 req.hdr_ip(x-forwarded-for,-1)\n\n```\n\nExample:```\n\n# track request counts per \"base\" (concatenation of Host+URL)\ntcp-request inspect-delay 10s\ntcp-request content track-sc0 base table req-rate\n\n```\n\nExample:```\n\nTrack per-frontend and per-backend counters, block abusers at the frontend when the backend detects abuse(and marks gpc0).frontend http\n    # Use General Purpose Counter 0 in SC0 as a global abuse counter\n    # protecting all our sites\n    stick-table type ip size 1m expire 5m store gpc0\n    tcp-request connection track-sc0 src\n    tcp-request connection reject if { sc0_get_gpc0 gt 0 }\n    ...\n    use_backend http_dynamic if { path_end .php }\n\nbackend http_dynamic\n    # if a source makes too fast requests to this dynamic site (tracked\n    # by SC1), block it globally in the frontend.\n    stick-table type ip size 1m expire 5m store http_req_rate(10s)\n    acl click_too_fast sc1_http_req_rate gt 10\n    acl mark_as_abuser sc0_inc_gpc0(http) gt 0\n    tcp-request content track-sc1 src\n    tcp-request content reject if click_too_fast mark_as_abuser\n\n```\n\n```\nSee section 7 about ACL usage.\n\n```\n\n**See also :**\"[tcp-request connection](#tcp-request%20connection)\", \"[tcp-request session](#tcp-request%20session)\", \"[tcp-request inspect-delay](#tcp-request%20inspect-delay)\", and \"[http-request](#http-request)\".**[tcp-request inspect-delay](#4.2-tcp-request%20inspect-delay)**<timeout>```\nSet the maximum allowed time to wait for data during content inspection\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyes(!)yesyesyesArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nPeople using HAProxy primarily as a TCP relay are often worried about the\nrisk of passing any type of protocol to a server without any analysis. In\norder to be able to analyze the request contents, we must first withhold\nthe data then analyze them. This statement simply enables withholding of\ndata for at most the specified amount of time.\n\nTCP content inspection applies very early when a connection reaches a\nfrontend, then very early when the connection is forwarded to a backend. This\nmeans that a connection may experience a first delay in the frontend and a\nsecond delay in the backend if both have tcp-request rules.\n\nNote that when performing content inspection, HAProxy will evaluate the whole\nrules for every new chunk which gets in, taking into account the fact that\nthose data are partial. If no rule matches before the aforementioned delay,\na last check is performed upon expiration, this time considering that the\ncontents are definitive. If no delay is set, HAProxy will not wait at all\nand will immediately apply a verdict based on the available information.\nObviously this is unlikely to be very useful and might even be racy, so such\nsetups are not recommended.\n\nNote the inspection delay is shortened if an connection error or shutdown is\nexperienced or if the request buffer appears as full.\n\nAs soon as a rule matches, the request is released and continues as usual. If\nthe timeout is reached and no rule matches, the default policy will be to let\nit pass through unaffected.\n\nFor most protocols, it is enough to set it to a few seconds, as most clients\nsend the full request immediately upon connection. Add 3 or more seconds to\ncover TCP retransmits but that's all. For some protocols, it may make sense\nto use large values, for instance to ensure that the client never talks\nbefore the server (e.g. SMTP), or to wait for a client to talk before passing\ndata to the server (e.g. SSL). Note that the client timeout must cover at\nleast the inspection delay, otherwise it will expire first. If the client\ncloses the connection or if the buffer is full, the delay immediately expires\nsince the contents will not be able to change anymore.\n\nThis directive is only available from named defaults sections, not anonymous\nones. Proxies inherit this value from their defaults section.\n\n```\n\n**See also :**\"tcp-request content accept\", \"tcp-request content reject\", \"[timeout client](#)- This keyword is available in sections :\n- [Log forwarding](#timeout%20client%20%28Log%20forwarding%29)\n- [Alphabetically sorted keywords reference](#timeout%20client%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\".**[tcp-request session](#4.2-tcp-request%20session)**<action>[{if | unless}<condition>]```\nPerform an action on a validated session depending on a layer 5 condition\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyes(!)yesyesnoArguments :```\n<action>    defines the action to perform if the condition applies. See\n            below.\n\n<condition> is a standard layer5-only ACL-based condition (see section 7).\n```\n\n```\nOnce a session is validated, (i.e. after all handshakes have been completed),\nit is possible to evaluate some conditions to decide whether this session\nmust be accepted or dropped or have its counters tracked. Those conditions\ncannot make use of any data contents because no buffers are allocated yet and\nthe processing cannot wait at this stage. The main use case is to copy some\nearly information into variables (since variables are accessible in the\nsession), or to keep track of some information collected after the handshake,\nsuch as SSL-level elements (SNI, ciphers, client cert's CN) or information\nfrom the PROXY protocol header (e.g. track a source forwarded this way). The\nextracted information can thus be copied to a variable or tracked using\n\"track-sc\" rules. Of course it is also possible to decide to accept/reject as\nwith other rulesets. Most operations performed here could also be performed\nin \"tcp-request content\" rules, except that in HTTP these rules are evaluated\nfor each new request, and that might not always be acceptable. For example a\nrule might increment a counter on each evaluation. It would also be possible\nthat a country is resolved by geolocation from the source IP address,\nassigned to a session-wide variable, then the source address rewritten from\nan HTTP header for all requests. If some contents need to be inspected in\norder to take the decision, the \"tcp-request content\" statements must be used\ninstead.\n\nThe \"tcp-request session\" rules are evaluated in their exact declaration\norder. If no rule matches or if there is no rule, the default action is to\naccept the incoming session. There is no specific limit to the number of\nrules which may be inserted.\n\nThe first keyword after \"tcp-request session\" in the syntax is the rule's\naction, optionally followed by a varying number of arguments for the action.\nThe supported actions and their respective syntaxes are enumerated in\nsection 4.3 \"Actions\" (look for actions which tick \"TCP RqSes\").\n\nThis directive is only available from named defaults sections, not anonymous\nones. Rules defined in the defaults section are evaluated before ones in the\nassociated proxy section. To avoid ambiguities, in this case the same\ndefaults section cannot be used by proxies with the frontend capability and\nby proxies with the backend capability. It means a listen section cannot use\na defaults section defining such rules.\n\nNote that the \"if/unless\" condition is optional. If no condition is set on\nthe action, it is simply performed unconditionally. That can be useful for\n\"track-sc*\" actions as well as for changing the default action to a reject.\n\n```\n\nExample:```\n\nTrack the original source address by default, or the one advertised in the PROXY protocol header for connection coming from the local proxies. The first connection-level rule enables receipt of the PROXY protocol for these ones, the second rule tracks whatever address we decide to keep after optional decoding.tcp-request connection expect-proxy layer4 if { src -f proxies.lst }\ntcp-request session track-sc0 src\n\n```\n\nExample:```\n\nAccept all sessions from white-listed hosts, reject too fast sessions without counting them, and track accepted sessions. This results in session rate being capped from abusive sources.tcp-request session accept if { src -f /etc/haproxy/whitelist.lst }\ntcp-request session reject if { src_sess_rate gt 10 }\ntcp-request session track-sc0 src\n\n```\n\nExample:```\n\nAccept all sessions from white-listed hosts, count all other sessions and reject too fast ones. This results in abusive ones being blocked as long as they don't slow down.tcp-request session accept if { src -f /etc/haproxy/whitelist.lst }\ntcp-request session track-sc0 src\ntcp-request session reject if { sc0_sess_rate gt 10 }\n\n```\n\n```\nSee section 7 about ACL usage.\n\n```\n\n**See also :**\"[tcp-request connection](#tcp-request%20connection)\", \"[tcp-request content](#tcp-request%20content)\", \"[stick-table](#)- This keyword is available in sections :\n- [Stick-tables declaration](#stick-table%20%28Stick-tables%20declaration%29)\n- [Alphabetically sorted keywords reference](#stick-table%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\"**[tcp-response content](#4.2-tcp-response%20content)**<action>[{if | unless}<condition>]```\nPerform an action on a session response depending on a layer 4-7 condition\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyes(!)noyesyesArguments :```\n<action>    defines the action to perform if the condition applies. See\n            below.\n\n<condition> is a standard layer 4-7 ACL-based condition (see section 7).\n```\n\n```\nResponse contents can be analyzed at an early stage of response processing\ncalled \"TCP content inspection\". During this stage, ACL-based rules are\nevaluated every time the response contents are updated, until either a final\nrule matches, or a TCP response inspection delay is set and expires with no\nmatching rule.\n\nMost often, these decisions will consider a protocol recognition or validity.\n\nContent-based rules are evaluated in their exact declaration order. If no\nrule matches or if there is no rule, the default action is to accept the\ncontents. There is no specific limit to the number of rules which may be\ninserted.\n\nThe first keyword after \"tcp-response content\" in the syntax is the rule's\naction, optionally followed by a varying number of arguments for the action.\nThe supported actions and their respective syntaxes are enumerated in\nsection 4.3 \"Actions\" (look for actions which tick \"TCP RsCnt\").\n\nThis directive is only available from named defaults sections, not anonymous\nones. Rules defined in the defaults section are evaluated before ones in the\nassociated proxy section. To avoid ambiguities, in this case the same\ndefaults section cannot be used by proxies with the frontend capability and\nby proxies with the backend capability. It means a listen section cannot use\na defaults section defining such rules.\n\nNote that the \"if/unless\" condition is optional. If no condition is set on\nthe action, it is simply performed unconditionally. That can be useful for\nfor changing the default action to a reject.\n\nSeveral types of actions are supported :\n\nIt is perfectly possible to match layer 7 contents with \"tcp-response\ncontent\" rules, but then it is important to ensure that a full response has\nbeen buffered, otherwise no contents will match. In order to achieve this,\nthe best solution involves detecting the HTTP protocol during the inspection\nperiod.\n\nSee section 7 about ACL usage.\n\n```\n\n**See also :**\"[tcp-request content](#tcp-request%20content)\", \"[tcp-response inspect-delay](#tcp-response%20inspect-delay)\"**[tcp-response inspect-delay](#4.2-tcp-response%20inspect-delay)**<timeout>```\nSet the maximum allowed time to wait for a response during content inspection\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyes(!)noyesyesArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nThis directive is only available from named defaults sections, not anonymous\nones. Proxies inherit this value from their defaults section.\n\n```\n\n**See also :**\"[tcp-response content](#tcp-response%20content)\", \"[tcp-request inspect-delay](#tcp-request%20inspect-delay)\".**[timeout check](#4.2-timeout%20check)**<timeout>```\nSet additional check timeout, but only after a connection has been already\nestablished.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments:```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nIf set, HAProxy uses min(\"timeout connectThis keyword is available in sections :RingsAlphabetically sorted keywords reference\", \"inter\") as a connect timeout\nfor check and \"timeout check\" as an additional read timeout. The \"min\" is\nused so that people running with *very* long \"timeout connectThis keyword is available in sections :RingsAlphabetically sorted keywords reference\" (e.g. those\nwho needed this due to the queue or tarpit) do not slow down their checks.\n(Please also note that there is no valid reason to have such long connect\ntimeouts, because \"timeout queue\" and \"timeout tarpit\" can always be used to\navoid that).\n\nIf \"timeout check\" is not set HAProxy uses \"inter\" for complete check\ntimeout (connect + read) exactly like all <1.3.15 version.\n\nIn most cases check request is much simpler and faster to handle than normal\nrequests and people may want to kick out laggy servers so this timeout should\nbe smaller than \"timeout serverThis keyword is available in sections :RingsAlphabetically sorted keywords reference\".\n\nThis parameter is specific to backends, but can be specified once for all in\n\"defaults\" sections. This is in fact one of the easiest solutions not to\nforget about it.\n\n```\n\n**See also:**\"[timeout connect](#)- This keyword is available in sections :\n- [Rings](#timeout%20connect%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#timeout%20connect%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[timeout queue](#timeout%20queue)\", \"[timeout server](#)- This keyword is available in sections :\n- [Rings](#timeout%20server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#timeout%20server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[timeout tarpit](#timeout%20tarpit)\".**[timeout client](#4.2-timeout%20client)**<timeout>```\nSet the maximum inactivity time on the client side.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nThe inactivity timeout applies when the client is expected to acknowledge or\nsend data. In HTTP mode, this timeout is particularly important to consider\nduring the first phase, when the client sends the request, and during the\nresponse while it is reading data sent by the server. That said, for the\nfirst phase, it is preferable to set the \"timeout http-request\" to better\nprotect HAProxy from Slowloris like attacks. The value is specified in\nmilliseconds by default, but can be in any other unit if the number is\nsuffixed by the unit, as specified at the top of this document. In TCP mode\n(and to a lesser extent, in HTTP mode), it is highly recommended that the\nclient timeout remains equal to the server timeout in order to avoid complex\nsituations to debug. It is a good practice to cover one or several TCP packet\nlosses by specifying timeouts that are slightly above multiples of 3 seconds\n(e.g. 4 or 5 seconds). If some long-lived streams are mixed with short-lived\nstreams (e.g. WebSocket and HTTP), it's worth considering \"timeout tunnel\",\nwhich overrides \"timeout clientThis keyword is available in sections :Log forwardingAlphabetically sorted keywords reference\" and \"timeout serverThis keyword is available in sections :RingsAlphabetically sorted keywords reference\" for tunnels, as well as\n\"timeout client-fin\" for half-closed connections.\n\nThis parameter is specific to frontends, but can be specified once for all in\n\"defaults\" sections. This is in fact one of the easiest solutions not to\nforget about it. An unspecified timeout results in an infinite timeout, which\nis not recommended. Such a usage is accepted and works but reports a warning\nduring startup because it may result in accumulation of expired sessions in\nthe system if the system's timeouts are not configured either.\n\n```\n\n**See also :**\"[timeout server](#)- This keyword is available in sections :\n- [Rings](#timeout%20server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#timeout%20server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[timeout tunnel](#timeout%20tunnel)\", \"[timeout http-request](#timeout%20http-request)\".**[timeout client-fin](#4.2-timeout%20client-fin)**<timeout>```\nSet the inactivity timeout on the client side for half-closed connections.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nThe inactivity timeout applies when the client is expected to acknowledge or\nsend data while one direction is already shut down. This timeout is different\nfrom \"timeout clientThis keyword is available in sections :Log forwardingAlphabetically sorted keywords reference\" in that it only applies to connections which are closed\nin one direction. This is particularly useful to avoid keeping connections in\nFIN_WAIT state for too long when clients do not disconnect cleanly. This\nproblem is particularly common long connections such as RDP or WebSocket.\nNote that this timeout can override \"timeout tunnel\" when a connection shuts\ndown in one direction. It is applied to idle HTTP/2 connections once a GOAWAY\nframe was sent, often indicating an expectation that the connection quickly\nends.\n\nThis parameter is specific to frontends, but can be specified once for all in\n\"defaults\" sections. By default it is not set, so half-closed connections\nwill use the other timeouts (timeout.client or timeout.tunnel).\n\n```\n\n**See also :**\"[timeout client](#)- This keyword is available in sections :\n- [Log forwarding](#timeout%20client%20%28Log%20forwarding%29)\n- [Alphabetically sorted keywords reference](#timeout%20client%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[timeout server-fin](#timeout%20server-fin)\", and \"[timeout tunnel](#timeout%20tunnel)\".**[timeout client-hs](#4.2-timeout%20client-hs)**<timeout>```\nSet the maximum time to wait for a client TLS handshake to complete. This is\nusable both for TCP and QUIC connections.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nIf this handshake timeout is not set, this is the client timeout which is used\nin place.\n\n```\n\n**[timeout connect](#4.2-timeout%20connect)**<timeout>```\nSet the maximum time to wait for a connection attempt to a server to succeed.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nIf the server is located on the same LAN as HAProxy, the connection should be\nimmediate (less than a few milliseconds). Anyway, it is a good practice to\ncover one or several TCP packet losses by specifying timeouts that are\nslightly above multiples of 3 seconds (e.g. 4 or 5 seconds). By default, the\nconnect timeout also presets both queue and tarpit timeouts to the same value\nif these have not been specified.\n\nThis parameter is specific to backends, but can be specified once for all in\n\"defaults\" sections. This is in fact one of the easiest solutions not to\nforget about it. An unspecified timeout results in an infinite timeout, which\nis not recommended. Such a usage is accepted and works but reports a warning\nduring startup because it may result in accumulation of failed sessions in\nthe system if the system's timeouts are not configured either.\n\n```\n\n**See also:**\"[timeout check](#timeout%20check)\", \"[timeout queue](#timeout%20queue)\", \"[timeout server](#)- This keyword is available in sections :\n- [Rings](#timeout%20server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#timeout%20server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[timeout tarpit](#timeout%20tarpit)\".**[timeout http-keep-alive](#4.2-timeout%20http-keep-alive)**<timeout>```\nSet the maximum allowed time to wait for a new HTTP request to appear\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nBy default, the time to wait for a new request in case of keep-alive is set\nby \"timeout http-request\". However this is not always convenient because some\npeople want very short keep-alive timeouts in order to release connections\nfaster, and others prefer to have larger ones but still have short timeouts\nonce the request has started to present itself.\n\nThe \"http-keep-alive\" timeout covers these needs. It will define how long to\nwait for a new HTTP request to start coming after a response was sent. Once\nthe first byte of request has been seen, the \"http-request\" timeout is used\nto wait for the complete request to come. Note that empty lines prior to a\nnew request do not refresh the timeout and are not counted as a new request.\n\nThere is also another difference between the two timeouts : when a connection\nexpires during timeout http-keep-alive, no error is returned, the connection\njust closes. If the connection expires in \"http-request\" while waiting for a\nrequest to complete, an HTTP 408 error is returned to the client before\nclosing the connection, unless \"option http-ignore-probes\" is set in the\nfrontend.\n\nIn general \"timeout http-keep-alive\" is best used to prevent clients from\nholding open an otherwise idle connection too long on sites seeing large\namounts of short connections. This can be accomplished by setting the value\nto a few tens to hundreds of milliseconds in HTTP/1.1. This will close the\nconnection after the client requests a page without having to hold that\nconnection open to wait for more activity from the client. In that scenario,\na new activity from the browser would result in a new handshake at the TCP\nand/or SSL layer. A common use case for this is HTTP sites serving only a\nredirect to the HTTPS page. Such connections are better not kept idle too\nlong because they won't be reused, unless maybe to fetch a favicon.\n\nAnother use case is the exact opposite: some sites want to permit clients\nto reuse idle connections for a long time (e.g. 30 seconds to one minute) but\ndo not want to wait that long for the first request, in order to avoid a very\ninexpensive attack vector. In this case, the http-keep-alive timeout would be\nset to a large value, but http-request would remain low (a few seconds).\n\nWhen set to a very small value additional requests that are not pipelined\nare likely going to be handled over another connection unless the requests\nare truly pipelined, which is very rare with HTTP/1.1 (requests being sent\nback-to-back without waiting for a response). Most HTTP/1.1 implementations\nsend a request, wait for a response and then send another request. A small\nvalue here for HTTP/1.1 may be advantageous to use less memory and sockets\nfor sites with hundreds of thousands of clients, at the expense of an\nincrease in handshake computation costs.\n\nSpecial care should be taken with small values when dealing with HTTP/2. The\nnature of HTTP/2 is to multiplex requests over a connection in order to save\non the overhead of reconnecting the TCP and/or SSL layers. The protocol also\nuses control frames which cope poorly with early TCP connection closures, on\nvery rare occasions this may result in truncated responses when data are\ndestroyed in flight after leaving HAProxy (which then cannot even log an\nerror). A suggested low starting value for HTTP/2 connections would be around\n4 seconds. This would prevent most modern keep-alive implementations from\nneedlessly holding open stale connections, and at the same time would allow\nsubsequent requests to reuse the connection. However, this should be adjusted\nas needed and is simply a starting point.\n\nIf this parameter is not set, the \"http-request\" timeout applies, and if both\nare not set, \"timeout clientThis keyword is available in sections :Log forwardingAlphabetically sorted keywords reference\" still applies at the lower level. It should be\nset in the frontend to take effect, unless the frontend is in TCP mode, in\nwhich case the HTTP backend's timeout will be used.\n\n```\n\n**See also :**\"[timeout http-request](#timeout%20http-request)\", \"[timeout client](#)- This keyword is available in sections :\n- [Log forwarding](#timeout%20client%20%28Log%20forwarding%29)\n- [Alphabetically sorted keywords reference](#timeout%20client%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\".**[timeout http-request](#4.2-timeout%20http-request)**<timeout>```\nSet the maximum allowed time to wait for a complete HTTP request\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nIn order to offer DoS protection, it may be required to lower the maximum\naccepted time to receive a complete HTTP request without affecting the client\ntimeout. This helps protecting against established connections on which\nnothing is sent. The client timeout cannot offer a good protection against\nthis abuse because it is an inactivity timeout, which means that if the\nattacker sends one character every now and then, the timeout will not\ntrigger. With the HTTP request timeout, no matter what speed the client\ntypes, the request will be aborted if it does not complete in time. When the\ntimeout expires, an HTTP 408 response is sent to the client to inform it\nabout the problem, and the connection is closed. The logs will report\ntermination codes \"cR\". Some recent browsers are having problems with this\nstandard, well-documented behavior, so it might be needed to hide the 408\ncode using \"option http-ignore-probes\" or \"errorfile 408 /dev/null\". See\nmore details in the explanations of the \"cR\" termination code in section 8.5.\n\nBy default, this timeout only applies to the header part of the request,\nand not to any data. As soon as the empty line is received, this timeout is\nnot used anymore. When combined with \"option http-buffer-request\", this\ntimeout also applies to the body of the request..\nIt is used again on keep-alive connections to wait for a second\nrequest if \"timeout http-keep-alive\" is not set.\n\nGenerally it is enough to set it to a few seconds, as most clients send the\nfull request immediately upon connection. Add 3 or more seconds to cover TCP\nretransmits but that's all. Setting it to very low values (e.g. 50 ms) will\ngenerally work on local networks as long as there are no packet losses. This\nwill prevent people from sending bare HTTP requests using telnet.\n\nIf this parameter is not set, the client timeout still applies between each\nchunk of the incoming request. It should be set in the frontend to take\neffect, unless the frontend is in TCP mode, in which case the HTTP backend's\ntimeout will be used.\n\n```\n\n**See also :**\"[errorfile](#)- This keyword is available in sections :\n- [HTTP-errors](#errorfile%20%28HTTP-errors%29)\n- [Alphabetically sorted keywords reference](#errorfile%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[http-ignore-probes](#option%20http-ignore-probes)\", \"[timeout http-keep-alive](#timeout%20http-keep-alive)\", and \"[timeout client](#)- This keyword is available in sections :\n- [Log forwarding](#timeout%20client%20%28Log%20forwarding%29)\n- [Alphabetically sorted keywords reference](#timeout%20client%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[option http-buffer-request](#option%20http-buffer-request)\".**[timeout queue](#4.2-timeout%20queue)**<timeout>```\nSet the maximum time to wait in the queue for a connection slot to be free\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nWhen a server's maxconn is reached, connections are left pending in a queue\nwhich may be server-specific or global to the backend. In order not to wait\nindefinitely, a timeout is applied to requests pending in the queue. If the\ntimeout is reached, it is considered that the request will almost never be\nserved, so it is dropped and a 503 error is returned to the client.\n\nThe \"timeout queue\" statement allows to fix the maximum time for a request to\nbe left pending in a queue. If unspecified, the same value as the backend's\nconnection timeout (\"timeout connectThis keyword is available in sections :RingsAlphabetically sorted keywords reference\") is used, for backwards compatibility\nwith older versions with no \"timeout queue\" parameter.\n\n```\n\n**See also :**\"[timeout connect](#)- This keyword is available in sections :\n- [Rings](#timeout%20connect%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#timeout%20connect%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\".**[timeout server](#4.2-timeout%20server)**<timeout>```\nSet the maximum inactivity time on the server side.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nThe inactivity timeout applies when the server is expected to acknowledge or\nsend data. In HTTP mode, this timeout is particularly important to consider\nduring the first phase of the server's response, when it has to send the\nheaders, as it directly represents the server's processing time for the\nrequest. To find out what value to put there, it's often good to start with\nwhat would be considered as unacceptable response times, then check the logs\nto observe the response time distribution, and adjust the value accordingly.\n\nThe value is specified in milliseconds by default, but can be in any other\nunit if the number is suffixed by the unit, as specified at the top of this\ndocument. In TCP mode (and to a lesser extent, in HTTP mode), it is highly\nrecommended that the client timeout remains equal to the server timeout in\norder to avoid complex situations to debug. Whatever the expected server\nresponse times, it is a good practice to cover at least one or several TCP\npacket losses by specifying timeouts that are slightly above multiples of 3\nseconds (e.g. 4 or 5 seconds minimum). If some long-lived streams are mixed\nwith short-lived streams (e.g. WebSocket and HTTP), it's worth considering\n\"timeout tunnel\", which overrides \"timeout clientThis keyword is available in sections :Log forwardingAlphabetically sorted keywords reference\" and \"timeout serverThis keyword is available in sections :RingsAlphabetically sorted keywords reference\" for\ntunnels.\n\nThis parameter is specific to backends, but can be specified once for all in\n\"defaults\" sections. This is in fact one of the easiest solutions not to\nforget about it. An unspecified timeout results in an infinite timeout, which\nis not recommended. Such a usage is accepted and works but reports a warning\nduring startup because it may result in accumulation of expired sessions in\nthe system if the system's timeouts are not configured either.\n\n```\n\n**See also :**\"[timeout client](#)- This keyword is available in sections :\n- [Log forwarding](#timeout%20client%20%28Log%20forwarding%29)\n- [Alphabetically sorted keywords reference](#timeout%20client%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\" and \"[timeout tunnel](#timeout%20tunnel)\".**[timeout server-fin](#4.2-timeout%20server-fin)**<timeout>```\nSet the inactivity timeout on the server side for half-closed connections.\n\nMay be used in the following contexts: tcp, http, log\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nThe inactivity timeout applies when the server is expected to acknowledge or\nsend data while one direction is already shut down. This timeout is different\nfrom \"timeout serverThis keyword is available in sections :RingsAlphabetically sorted keywords reference\" in that it only applies to connections which are closed\nin one direction. This is particularly useful to avoid keeping connections in\nFIN_WAIT state for too long when a remote server does not disconnect cleanly.\nThis problem is particularly common long connections such as RDP or WebSocket.\nNote that this timeout can override \"timeout tunnel\" when a connection shuts\ndown in one direction. This setting was provided for completeness, but in most\nsituations, it should not be needed.\n\nThis parameter is specific to backends, but can be specified once for all in\n\"defaults\" sections. By default it is not set, so half-closed connections\nwill use the other timeouts (timeout.server or timeout.tunnel).\n\n```\n\n**See also :**\"[timeout client-fin](#timeout%20client-fin)\", \"[timeout server](#)- This keyword is available in sections :\n- [Rings](#timeout%20server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#timeout%20server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", and \"[timeout tunnel](#timeout%20tunnel)\".**[timeout tarpit](#4.2-timeout%20tarpit)**<timeout>```\nSet the duration for which tarpitted connections will be maintained\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesyesArguments :```\n<timeout> is the tarpit duration specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nWhen a connection is tarpitted using \"http-request tarpit\", it is maintained\nopen with no activity for a certain amount of time, then closed. \"timeout\ntarpit\" defines how long it will be maintained open.\n\nThe value is specified in milliseconds by default, but can be in any other\nunit if the number is suffixed by the unit, as specified at the top of this\ndocument. If unspecified, the same value as the backend's connection timeout\n(\"timeout connectThis keyword is available in sections :RingsAlphabetically sorted keywords reference\") is used, for backwards compatibility with older versions\nwith no \"timeout tarpit\" parameter.\n\n```\n\n**See also :**\"[timeout connect](#)- This keyword is available in sections :\n- [Rings](#timeout%20connect%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#timeout%20connect%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\".**[timeout tunnel](#4.2-timeout%20tunnel)**<timeout>```\nSet the maximum inactivity time on the client and server side for tunnels.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n```\nThe tunnel timeout applies when a bidirectional connection is established\nbetween a client and a server, and the connection remains inactive in both\ndirections. This timeout supersedes both the client and server timeouts once\nthe connection becomes a tunnel. In TCP, this timeout is used as soon as no\nanalyzer remains attached to either connection (e.g. tcp content rules are\naccepted). In HTTP, this timeout is used when a connection is upgraded (e.g.\nwhen switching to the WebSocket protocol, or forwarding a CONNECT request\nto a proxy), or after the first response when no keepalive/close option is\nspecified.\n\nSince this timeout is usually used in conjunction with long-lived connections,\nit usually is a good idea to also set \"timeout client-fin\" to handle the\nsituation where a client suddenly disappears from the net and does not\nacknowledge a close, or sends a shutdown and does not acknowledge pending\ndata anymore. This can happen in lossy networks where firewalls are present,\nand is detected by the presence of large amounts of sessions in a FIN_WAIT\nstate.\n\nThe value is specified in milliseconds by default, but can be in any other\nunit if the number is suffixed by the unit, as specified at the top of this\ndocument. Whatever the expected normal idle time, it is a good practice to\ncover at least one or several TCP packet losses by specifying timeouts that\nare slightly above multiples of 3 seconds (e.g. 4 or 5 seconds minimum).\n\nThis parameter is specific to backends, but can be specified once for all in\n\"defaults\" sections. This is in fact one of the easiest solutions not to\nforget about it.\n\n```\n\nExample :```\n\ndefaults http\n    option http-server-close\n    timeout connect 5s\n    timeout client 30s\n    timeout client-fin 30s\n    timeout server 30s\n    timeout tunnel  1h    # timeout to use with WebSocket and CONNECT\n\n```\n\n**See also :**\"[timeout client](#)- This keyword is available in sections :\n- [Log forwarding](#timeout%20client%20%28Log%20forwarding%29)\n- [Alphabetically sorted keywords reference](#timeout%20client%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\", \"[timeout client-fin](#timeout%20client-fin)\", \"[timeout server](#)- This keyword is available in sections :\n- [Rings](#timeout%20server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#timeout%20server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\".**[transparent](#4.2-transparent)**(deprecated)```\nEnable client-side transparent proxying\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesnoyesyesArguments :none```\nThis keyword was introduced in order to provide layer 7 persistence to layer\n3 load balancers. The idea is to use the OS's ability to redirect an incoming\nconnection for a remote address to a local process (here HAProxy), and let\nthis process know what address was initially requested. When this option is\nused, sessions without cookies will be forwarded to the original destination\nIP address of the incoming request (which should match that of another\nequipment), while requests with cookies will still be forwarded to the\nappropriate server.\n\nThe \"transparent\" keyword is deprecated, use \"option transparent\" instead.\n\nNote that contrary to a common belief, this option does NOT make HAProxy\npresent the client's IP to the server when establishing the connection.\n\n```\n\n**See also:**\"[option transparent](#option%20transparent)\"**[unique-id-format](#4.2-unique-id-format)**<fmt>```\nGenerate a unique ID for each request.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<fmt>   is a Custom log format string (see section 8.2.6).\n```\n\n```\nThis keyword creates a ID for each request using the custom log format. A\nunique ID is useful to trace a request passing through many components of\na complex infrastructure. The newly created ID may also be logged using the\n%ID alias in the Custom log format string.\n\nThe format should be composed from elements that are guaranteed to be\nunique when combined together. For instance, if multiple HAProxy instances\nare involved, it might be important to include the node name. It is often\nneeded to log the incoming connection's source and destination addresses\nand ports. Note that since multiple requests may be performed over the same\nconnection, including a request counter may help differentiate them.\nSimilarly, a timestamp may protect against a rollover of the counter.\nLogging the process ID will avoid collisions after a service restart.\n\nIt is recommended to use hexadecimal notation for many fields since it\nmakes them more compact and saves space in logs.\n\n```\n\nExample:```\n\nunique-id-format %{+X}o\\ %ci:%cp_%fi:%fp_%Ts_%rt:%pid\n\nwill generate:\n\n       7F000001:8296_7F00001E:1F90_4F7B0A69_0003:790A\n\n```\n\n**See also:**\"[unique-id-header](#unique-id-header)\"**[unique-id-header](#4.2-unique-id-header)**<name>```\nAdd a unique ID header in the HTTP request.\n\nMay be used in the following contexts: http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendyesyesyesnoArguments :```\n<name>   is the name of the header.\n```\n\n```\nAdd a unique-id header in the HTTP request sent to the server, using the\nunique-id-format. It can't work if the unique-id-format doesn't exist.\n\n```\n\nExample:```\n\n    unique-id-format %{+X}o\\ %ci:%cp_%fi:%fp_%Ts_%rt:%pid\n    unique-id-header X-Unique-ID\n\n    will generate:\n\n       X-Unique-ID: 7F000001:8296_7F00001E:1F90_4F7B0A69_0003:790A\n\nSee also: \"unique-id-format\"\n\n```\n\n**[use_backend](#4.2-use_backend)**<backend>[{if | unless}<condition>]```\nSwitch to a specific backend if/unless an ACL-based condition is matched.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnoyesyesnoArguments :```\n<backend>   is the name of a valid backend or \"listen\" section, or a\n            Custom log format resolving to a backend name (see Custom\n            Log Format in section 8.2.6).\n\n<condition> is a condition composed of ACLs, as described in section 7. If\n            it is omitted, the rule is unconditionally applied.\n```\n\n```\nWhen doing content-switching, connections arrive on a frontend and are then\ndispatched to various backends depending on a number of conditions. The\nrelation between the conditions and the backends is described with the\n\"use_backend\" keyword. While it is normally used with HTTP processing, it can\nalso be used in pure TCP, either without content using stateless ACLs (e.g.\nsource address validation) or combined with a \"tcp-request\" rule to wait for\nsome payload.\n\nThere may be as many \"use_backend\" rules as desired. All of these rules are\nevaluated in their declaration order, and the first one which matches will\nassign the backend.\n\nIn the first form, the backend will be used if the condition is met. In the\nsecond form, the backend will be used if the condition is not met. If no\ncondition is valid, the backend defined with \"default_backend\" will be used.\nIf no default backend is defined, either the servers in the same section are\nused (in case of a \"listen\" section) or, in case of a frontend, no server is\nused and a 503 service unavailable response is returned.\n\nNote that it is possible to switch from a TCP frontend to an HTTP backend. In\nthis case, either the frontend has already checked that the protocol is HTTP,\nand backend processing will immediately follow, or the backend will wait for\na complete HTTP request to get in. This feature is useful when a frontend\nmust decode several protocols on a unique port, one of them being HTTP.\n\nWhen <backend> is a simple name, it is resolved at configuration time, and an\nerror is reported if the specified backend does not exist. If <backend> is\na Custom log format instead, no check may be done at configuration time, so\nthe backend name is resolved dynamically at run time. If the resulting\nbackend name does not correspond to any valid backend, no other rule is\nevaluated, and the default_backend directive is applied instead. Note that\nwhen using dynamic backend names, it is highly recommended to use a prefix\nthat no other backend uses in order to ensure that an unauthorized backend\ncannot be forced from the request.\n\nIt is worth mentioning that \"use_backend\" rules with an explicit name are\nused to detect the association between frontends and backends to compute the\nbackend's \"fullconn\" setting. This cannot be done for dynamic names.\n\n```\n\n**See also:**\"[default_backend](#default_backend)\", \"[tcp-request](#tcp-request)\", \"[fullconn](#fullconn)\", \"[log-format](#log-format)\", and[section 7](#7)about ACLs.**[use-fcgi-app](#4.2-use-fcgi-app)**<name>```\nDefines the FastCGI application to use for the backend.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyesArguments :```\n<name>    is the name of the FastCGI application to use.\n```\n\n```\nSee section 10.1 about FastCGI application setup for details.\n\n```\n\n**[use-server](#4.2-use-server)**<server>if<condition>**[use-server](#4.2-use-server)**<server>unless<condition>```\nOnly use a specific server if/unless an ACL-based condition is matched.\n\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyesArguments :```\n<server>    is the name of a valid server in the same backend section\n            or a Custom log format string resolving to a server name\n            (see section 8.2.6).\n\n<condition> is a condition composed of ACLs, as described in section 7.\n```\n\n```\nBy default, connections which arrive to a backend are load-balanced across\nthe available servers according to the configured algorithm, unless a\npersistence mechanism such as a cookie is used and found in the request.\n\nSometimes it is desirable to forward a particular request to a specific\nserver without having to declare a dedicated backend for this server. This\ncan be achieved using the \"use-server\" rules. These rules are evaluated after\nthe \"redirectThis keyword is available in sections :Alphabetically sorted keywords referenceAlphabetically sorted actions reference\" rules and before evaluating cookies, and they have precedence\non them. There may be as many \"use-server\" rules as desired. All of these\nrules are evaluated in their declaration order, and the first one which\nmatches will assign the server.\n\nIf a rule designates a server which is down, and \"option persist\" is not used\nand no force-persist rule was validated, it is ignored and evaluation goes on\nwith the next rules until one matches.\n\nIn the first form, the server will be used if the condition is met. In the\nsecond form, the server will be used if the condition is not met. If no\ncondition is valid, the processing continues and the server will be assigned\naccording to other persistence mechanisms.\n\nNote that even if a rule is matched, cookie processing is still performed but\ndoes not assign the server. This allows prefixed cookies to have their prefix\nstripped.\n\nThe \"use-server\" statement works both in HTTP and TCP mode. This makes it\nsuitable for use with content-based inspection. For instance, a server could\nbe selected in a farm according to the TLS SNI field when using protocols with\nimplicit TLS (also see \"req.ssl_sni\"). And if these servers have their weight\nset to zero, they will not be used for other traffic.\n\n```\n\nExample :```\n\n# intercept incoming TLS requests based on the SNI field\nuse-server www if { req.ssl_sni -i www.example.com }\nserver     www 192.168.0.1:443 weight 0\nuse-server mail if { req.ssl_sni -i mail.example.com }\nserver     mail 192.168.0.1:465 weight 0\nuse-server imap if { req.ssl_sni -i imap.example.com }\nserver     imap 192.168.0.1:993 weight 0\n# all the rest is forwarded to this server\nserver  default 192.168.0.2:443 check\n\n```\n\n```\nWhen <server> is a simple name, it is checked against existing servers in the\nconfiguration and an error is reported if the specified server does not exist.\nIf it is a Custom log format, no check is performed when parsing the\nconfiguration, and if we can't resolve a valid server name at runtime but the\nuse-server rule was conditioned by an ACL returning true, no other use-server\nrule is applied and we fall back to load balancing.\n\n```\n\n**See also:**\"[use_backend](#use_backend)\",[section 5](#5)about server and[section 7](#7)about ACLs.", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "4.3. Actions keywords matrix", "content": "## [4.3.](#4.3)Actions keywords matrix\n\n```\nSeveral rule sets are evaluated at various stages of the request or response\nprocessing, and for each rule found in these rule sets, an action may be\nexecuted if the optional condition is met.\n\nA large number of actions are provided by default, they can modify contents,\naccept/block processing, change internal states etc. And it is possible to\ndefine new actions in Lua (in which case their names will always be prefixed\nwith \"lua.\").\n\nWhile historically some actions did only exist in specific rule sets, nowadays\nmany actions are usable with many rule sets. The listing in this section will\nindicate for which supported action where it may be used, by ticking the\ncorresponding abbreviated entry names among the following rule sets:\n\n  - QUIC  Ini: the action is valid for \"quic-initial\" rules\n  - TCP RqCon: the action is valid for \"tcp-request connection\" rules\n  - TCP RqSes: the action is valid for \"tcp-request session\" rules\n  - TCP RqCnt: the action is valid for \"tcp-request content\" rules\n  - TCP RsCnt: the action is valid for \"tcp-response content\" rules\n  - HTTP  Req:  the action is valid for \"http-request\" rules\n  - HTTP  Res:  the action is valid for \"http-response\" rules\n  - HTTP  Aft:  the action is valid for \"http-after-response\" rules\n\nThe same abbreviations are used in the reference section 4.4 below.\n\n```\n\nkeywordQUIC: IniTCP: RqConRqSesRqCntRsCntHTTP: ReqResAft[accept](#4-accept)[add-acl](#4-add-acl)[add-header](#4-add-header)[allow](#4-allow)[attach-srv](#4-attach-srv)[auth](#4-auth)[cache-store](#4-cache-store)[cache-use](#4-cache-use)[capture](#4-capture)[close](#4-close)[del-acl](#4-del-acl)[del-header](#4-del-header)[del-map](#4-del-map)[deny](#4-deny)[dgram-drop](#4-dgram-drop)[disable-l7-retry](#4-disable-l7-retry)[do-log](#4-do-log)[do-resolve](#4-do-resolve)[early-hint](#4-early-hint)[expect-netscaler-cip](#4-expect-netscaler-cip)keywordQUIC: IniTCP: RqConRqSesRqCntRsCntHTTP: ReqResAft[expect-proxy layer4](#4-expect-proxy%20layer4)[normalize-uri](#4-normalize-uri)[pause](#4-pause)[redirect](#4-redirect)[reject](#4-reject)[replace-header](#4-replace-header)[replace-path](#4-replace-path)[replace-pathq](#4-replace-pathq)[replace-uri](#4-replace-uri)[replace-value](#4-replace-value)[return](#4-return)[sc-add-gpc](#4-sc-add-gpc)[sc-inc-gpc](#4-sc-inc-gpc)[sc-inc-gpc0](#4-sc-inc-gpc0)[sc-inc-gpc1](#4-sc-inc-gpc1)[sc-set-gpt](#4-sc-set-gpt)[sc-set-gpt0](#4-sc-set-gpt0)[send-retry](#4-send-retry)[send-spoe-group](#4-send-spoe-group)[set-bandwidth-limit](#4-set-bandwidth-limit)keywordQUIC: IniTCP: RqConRqSesRqCntRsCntHTTP: ReqResAft[set-bc-mark](#4-set-bc-mark)[set-bc-tos](#4-set-bc-tos)[set-dst](#4-set-dst)[set-dst-port](#4-set-dst-port)[set-fc-mark](#4-set-fc-mark)[set-fc-tos](#4-set-fc-tos)[set-header](#4-set-header)[set-log-level](#4-set-log-level)[set-map](#4-set-map)[(deprecated)set-mark](#4-set-mark)[set-method](#4-set-method)[set-nice](#4-set-nice)[set-path](#4-set-path)[set-pathq](#4-set-pathq)[set-priority-class](#4-set-priority-class)[set-priority-offset](#4-set-priority-offset)[set-query](#4-set-query)[set-retries](#4-set-retries)[set-src](#4-set-src)[set-src-port](#4-set-src-port)keywordQUIC: IniTCP: RqConRqSesRqCntRsCntHTTP: ReqResAft[set-status](#4-set-status)[set-timeout](#4-set-timeout)[(deprecated)set-tos](#4-set-tos)[set-uri](#4-set-uri)[set-var](#4-set-var)[set-var-fmt](#4-set-var-fmt)[silent-drop](#4-silent-drop)[strict-mode](#4-strict-mode)[switch-mode](#4-switch-mode)[tarpit](#4-tarpit)[track-sc0](#4-track-sc0)[track-sc1](#4-track-sc1)[track-sc2](#4-track-sc2)[unset-var](#4-unset-var)[use-service](#4-use-service)[wait-for-body](#4-wait-for-body)[wait-for-handshake](#4-wait-for-handshake)", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "4.4. Alphabetically sorted actions reference", "content": "## [4.4.](#4.4)Alphabetically sorted actions reference\n\n```\nThis section provides a detailed description of each action and its usage,\nusing the same ruleset terminology marking as described in section 4.3 above.\n\n```\n\n**[accept](#4.4-accept)**Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis stops the evaluation of the rules and lets the request or response pass\nthe check. This action is final, i.e. no further rules from the same rule set\nare evaluated for the current section. There is no difference between this\nand the \"allow\" action except that for historical compatibility, \"accept\" is\nused for TCP and QUIC rules and \"allow\" for HTTP rules. See also the \"allow\"\naction below.\n\n```\n\n**[add-acl](#4.4-add-acl)**(<file-name>)<key fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to add a new entry into an ACL. The ACL must be loaded from a\nfile (even a dummy empty file). The file name of the ACL to be updated is\npassed between parentheses. It takes one argument: <key fmt>, which follows\nCustom log format rules described in section 8.2.6, to collect content of the\nnew entry. It performs a lookup in the ACL before insertion, to avoid\nduplicated (or more) values. It is the equivalent of the \"add acl\" command\nfrom the stats socket, but can be triggered by an HTTP request.\n\n```\n\n**[add-header](#4.4-add-header)**<name><fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis appends an HTTP header field whose name is specified in <name> and\nwhose value is defined by <fmt> which follows the Custom log format rules\n(see Custom log format in section 8.2.6). This is particularly useful to pass\nconnection-specific information to the server (e.g. the client's SSL\ncertificate), or to combine several headers into one. This rule is not final,\nso it is possible to add other similar rules. Note that header addition is\nperformed immediately, so one rule might reuse the resulting header from a\nprevious rule.\n\n```\n\n**[allow](#4.4-allow)**Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis stops the evaluation of the rules and lets the request pass the check.\nThis action is final, i.e. no further rules from the same rule set are\nevaluated for the current section. There is no difference between this and\nthe \"accept\" action except that for historical compatibility, \"accept\" is\nused for TCP rules and \"allow\" for HTTP rules. See also the \"accept\" action\nabove.\n\n```\n\n**[attach-srv](#4.4-attach-srv)**<srv>[name<expr>][ EXPERIMENTAL ]Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to intercept the connection after proper HTTP/2 establishment.\nThe connection is reversed to the backend side and inserted into the idle\npool of server <srv>. This may only be used with servers having an 'rhttp@'\naddress.\n\nThe connection is inserted into the server idle pool with a name defined by\nthe result of the <expr> evaluation. This is the name that will be matched\nagainst by requests subject to \"pool-conn-name\" or \"sni\" parameter. See\n\"http-reuse\" for more details.\n\nReverse HTTP is currently still in active development. Configuration\nmechanism may change in the future. For this reason it is internally marked\nas experimental, meaning that \"expose-experimental-directives\" must appear on\na line before this directive.\n\nNote that a very similar but independent protocol is under development. See\nhttps://www.ietf.org/archive/id/draft-bt-httpbis-reverse-http-00.html.\n\n```\n\n**[auth](#4.4-auth)**[realm<realm>]Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis stops the evaluation of the rules and immediately responds with an\nHTTP 401 or 407 error code to invite the user to present a valid user name\nand password. No further \"http-request\" rules are evaluated. An optional\n\"realm\" parameter is supported, it sets the authentication realm that is\nreturned with the response (typically the application's name).\n\nThe corresponding proxy's error message is used. It may be customized using\nan \"errorfileThis keyword is available in sections :HTTP-errorsAlphabetically sorted keywords reference\" or an \"http-error\" directive. For 401 responses, all\noccurrences of the WWW-Authenticate header are removed and replaced by a new\none with a basic authentication challenge for realm \"<realm>\". For 407\nresponses, the same is done on the Proxy-Authenticate header. If the error\nmessage must not be altered, consider to use \"http-request return\" rule\ninstead.\n\n```\n\nExample:```\n\nacl auth_ok http_auth_group(L1) G1\nhttp-request auth unless auth_ok\n\n```\n\n**[cache-store](#4.4-cache-store)**<name>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nStore an http-response within the cache. The storage of the response headers\nis done at this step, which means you can use others http-response actions\nto modify headers before or after the storage of the response. This action\nis responsible for the setup of the cache storage filter.\n\nSee section 6.2 about cache setup.\n\n```\n\n**[cache-use](#4.4-cache-use)**<name>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nTry to deliver a cached object from the cache <name>. This directive is also\nmandatory to store the cache as it calculates the cache hash. If you want to\nuse a condition for both storage and delivering that's a good idea to put it\nafter this one.\n\nSee section 6.2 about cache setup.\n\n```\n\n**[capture](#4.4-capture)**<sample>[ len<length>| id<id>]Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis captures sample expression <sample> from the request or response buffer,\nand converts it to a string of at most <len> characters. The resulting string\nis stored into the next \"captureThis keyword is available in sections :Alphabetically sorted keywords referenceAlphabetically sorted actions reference\" slot (either request or response), so it\nwill possibly appear next to some captured HTTP headers. It will then\nautomatically appear in the logs, and it will be possible to extract it using\nsample fetch methods to feed it into headers or anything. The length should\nbe limited given that this size will be allocated for each capture during the\nwhole stream life. Note that the length is only usable with \"http-request\"\nrules. Please check section 7.3 (Fetching samples), \"capture request header\"\nand \"capture response header\" for more information.\n\nIf the keyword \"idThis keyword is available in sections :Alphabetically sorted keywords referenceBind optionsServer and default-server options\" is used instead of \"len\", the action tries to store the\ncaptured string in a previously declared capture slot. This is useful to run\ncaptures in backends. The slot id can be declared by a previous directive\n\"http-request capture\" or with the \"declare capture\" keyword.\n\nWhen using this action in a backend, please double check that the relevant\nfrontend(s) have the required capture slots otherwise, this rule will be\nignored at run time. This can't be detected at configuration parsing time due\nto HAProxy's ability to dynamically resolve backend name at runtime.\n\n```\n\n**[close](#4.4-close)**Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to immediately close the connection with the server. No further\n\"tcp-response content\" rules are evaluated. The main purpose of this action\nis to force a connection to be finished between a client and a server after\nan exchange when the application protocol expects some long time outs to\nelapse first. The goal is to eliminate idle connections which take\nsignificant resources on servers with certain protocols.\n\n```\n\n**[del-acl](#4.4-del-acl)**(<file-name>)<key fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to delete an entry from an ACL. The ACL must be loaded from a\nfile (even a dummy empty file). The file name of the ACL to be updated is\npassed between parentheses. It takes one argument: <key fmt>, which follows\nCustom log format rules of section 8.2.6, to collect content of the entry to\ndelete.  It is the equivalent of the \"del acl\" command from the stats socket,\nbut can be triggered by an HTTP request or response.\n\n```\n\n**[del-header](#4.4-del-header)**<name>[ -m<meth>]Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis removes all HTTP header fields whose name is specified in <name>. <meth>\nis the matching method, applied on the header name. Supported matching methods\nare \"str\" (exact match), \"beg\" (prefix match), \"end\" (suffix match), \"sub\"\n(substring match) and \"reg\" (regex match). If not specified, exact matching\nmethod is used.\n\n```\n\n**[del-map](#4.4-del-map)**(<map-name>)<key fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to delete an entry from a MAP. <map-name> must follow the format\ndescribed in 2.7. about name format for maps and ACLs. The name of the MAP to\nbe updated is passed between parentheses. It takes one argument: <key fmt>,\nwhich follows Custom log format rules of section 8.2.6, to collect content of\nthe entry to delete.  It takes one argument: \"file name\" It is the equivalent\nof the \"del map\" command from the stats socket, but can be triggered by an\nHTTP request or response.\n\n```\n\n**[deny](#4.4-deny)**[{ status | deny_status }<code>][ content-type<type>][{ default-errorfiles | errorfile<file>| errorfiles<name>| file<file>| lf-file<file>| string<str>| lf-string<fmt>}][ hdr<name><fmt>]*Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis stops the evaluation of the rules and immediately rejects the request or\nresponse. By default an HTTP 403 error is returned for requests, and 502 for\nresponses, but the returned response may be customized using same syntax as\nfor the \"return\" action. Thus, see \"return\" below for details. For\ncompatibility purposes, when no argument is defined, or only \"deny_status\",\nthe argument \"default-errorfiles\" is implied. It means \"deny [deny_status\n<status>]\" is an alias of \"deny [status <status>] default-errorfiles\". This\naction is final, i.e. no further rules from the same rule set are evaluated\nfor the current section. See also the \"return\" action for the advanced\nsyntax.\n\n```\n\n**[dgram-drop](#4.4-dgram-drop)**Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis silently ignores the reception of a QUIC initial packet which otherwise\nwould have resulted in a new QUIC connection instantiation and its SSL\nhandshake execution.\n\n```\n\n**[disable-l7-retry](#4.4-disable-l7-retry)**Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis disables any attempt to retry the request if it fails for any other\nreason than a connection failure. This can be useful for example to make\nsure POST requests aren't retried on failure.\n\n```\n\n**[do-log](#4.4-do-log)**Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis action manually triggers a log emission on the proxy. This means\nlog options on the proxy will be considered (including formatting options\nsuch as \"log-format\"), but it will not interfere with the logs automatically\ngenerated by the proxy during transaction handling. It currently doesn't\nsupport any argument, though extensions may appear in future versions.\n\nUsing \"log-profile\", it is possible to precisely describe how the log should\nbe emitted for each of the available contexts where the action may be used.\nThat is, 'on' keyword followed by of the following values: 'quic-init',\n'tcp-req-conn', 'tcp-req-sess', 'tcp-req-cont', 'tcp-res-cont', 'http-req',\n'http-res', 'http-after-res'.\n\nAlso, they will be properly reported when using \"%OG\" logformat alias.\n\n```\n\nExample:```\n\nlog-profile myprof\n  on tcp-req-conn format \"Connect: %ci\"\n\nfrontend myfront\n  log stdout format rfc5424 profile myprof local0\n  log-format \"log generated using proxy logformat, from '%OG'\"\n  tcp-request connection do-log             #uses special log-profile format\n  tcp-request content do-log                #uses proxy logformat\n\n```\n\n**[do-resolve](#4.4-do-resolve)**(<var>,<resolvers>[,ipv4|ipv6])<expr>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis action performs a DNS resolution of the output of <expr> and stores\nthe result in the variable <var>. It uses the DNS resolvers section\npointed by <resolvers>.\nIt is possible to choose a resolution preference using the optional\narguments 'ipv4' or 'ipv6'. See also the global \"dns-accept-family\" keyword\nto enforce strict usage of a specific family.\n\nWhen performing the DNS resolution, the client side connection is on\npause waiting till the end of the resolution.\nIf an IP address can be found, it is stored into <var>. If any kind of\nerror occurs, then <var> is not set.\nOne can use this action to discover a server IP address at run time and\nbased on information found in the request (IE a Host header).\nIf this action is used to find the server's IP address (using the\n\"set-dst\" action), then the server IP address in the backend must be set\nto 0.0.0.0. The do-resolve action takes an host-only parameter, any port must\nbe removed from the string.\n\n```\n\nExample:```\n\nresolvers mydns\n  nameserver local 127.0.0.53:53\n  nameserver google 8.8.8.8:53\n  timeout retry   1s\n  hold valid 10s\n  hold nx 3s\n  hold other 3s\n  hold obsolete 0s\n  accepted_payload_size 8192\n\nfrontend fe\n  bind 10.42.0.1:80\n  http-request do-resolve(txn.myip,mydns,ipv4) hdr(Host),host_only\n  http-request capture var(txn.myip) len 40\n\n  # return 503 when the variable is not set,\n  # which mean DNS resolution error\n  use_backend b_503 unless { var(txn.myip) -m found }\n\n  default_backend be\n\nbackend b_503\n  # dummy backend used to return 503.\n  # one can use the errorfile directive to send a nice\n  # 503 error page to end users\n\nbackend be\n  # rule to prevent HAProxy from reconnecting to services\n  # on the local network (forged DNS name used to scan the network)\n  http-request deny if { var(txn.myip) -m ip 127.0.0.0/8 10.0.0.0/8 }\n  http-request set-dst var(txn.myip)\n  server clear 0.0.0.0:0\n\n```\n\n```\nNOTE: Don't forget to set the \"protection\" rules to ensure HAProxy won't\n      be used to scan the network or worst won't loop over itself...\n\n```\n\n**[early-hint](#4.4-early-hint)**<name><fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to build an HTTP 103 Early Hints response prior to any other one.\nThis appends an HTTP header field to this response whose name is specified in\n<name> and whose value is defined by <fmt> which follows the Custom Log\nFormat rules (see Custom log format in section 8.2.6). This is particularly\nuseful to pass to the client some Link headers to preload resources required\nto render the HTML documents.\n\nSee RFC 8297 for more information.\n\n```\n\n**[expect-netscaler-cip layer4](#4.4-expect-netscaler-cip%20layer4)**Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis configures the client-facing connection to receive a NetScaler Client IP\ninsertion protocol header before any byte is read from the socket.  This is\nequivalent to having the \"accept-netscaler-cip\" keyword on the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line,\nexcept that using the TCP rule allows the PROXY protocol to be accepted only\nfor certain IP address ranges using an ACL. This is convenient when multiple\nlayers of load balancers are passed through by traffic coming from public\nhosts.\n\n```\n\n**[expect-proxy layer4](#4.4-expect-proxy%20layer4)**Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis configures the client-facing connection to receive a PROXY protocol\nheader before any byte is read from the socket. This is equivalent to having\nthe \"accept-proxy\" keyword on the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line, except that using the TCP rule\nallows the PROXY protocol to be accepted only for certain IP address ranges\nusing an ACL. This is convenient when multiple layers of load balancers are\npassed through by traffic coming from public hosts.\n\n```\n\n**[normalize-uri](#4.4-normalize-uri)**<normalizer>**[normalize-uri fragment-encode](#4.4-normalize-uri%20fragment-encode)****[normalize-uri fragment-strip](#4.4-normalize-uri%20fragment-strip)****[normalize-uri path-merge-slashes](#4.4-normalize-uri%20path-merge-slashes)****[normalize-uri path-strip-dot](#4.4-normalize-uri%20path-strip-dot)****[normalize-uri path-strip-dotdot](#4.4-normalize-uri%20path-strip-dotdot)**[ full ]**[normalize-uri percent-decode-unreserved](#4.4-normalize-uri%20percent-decode-unreserved)**[ strict ]**[normalize-uri percent-to-uppercase](#4.4-normalize-uri%20percent-to-uppercase)**[ strict ]**[normalize-uri query-sort-by-name](#4.4-normalize-uri%20query-sort-by-name)**Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nPerforms normalization of the request's URI.\n\nURI normalization in HAProxy 2.4 is currently available as an experimental\ntechnical preview. As such, it requires the global directive\n'expose-experimental-directives' first to be able to invoke it. You should be\nprepared that the behavior of normalizers might change to fix possible\nissues, possibly breaking proper request processing in your infrastructure.\n\nEach normalizer handles a single type of normalization to allow for a\nfine-grained selection of the level of normalization that is appropriate for\nthe supported backend.\n\nAs an example the \"path-strip-dotdot\" normalizer might be useful for a static\nfileserver that directly maps the requested URI to the path within the local\nfilesystem. However it might break routing of an API that expects a specific\nnumber of segments in the path.\n\nIt is important to note that some normalizers might result in unsafe\ntransformations for broken URIs. It might also be possible that a combination\nof normalizers that are safe by themselves results in unsafe transformations\nwhen improperly combined.\n\nAs an example the \"percent-decode-unreserved\" normalizer might result in\nunexpected results when a broken URI includes bare percent characters. One\nsuch a broken URI is \"/%%36%36\" which would be decoded to \"/%66\" which in\nturn is equivalent to \"/f\". By specifying the \"strict\" option requests to\nsuch a broken URI would safely be rejected.\n\nThe following normalizers are available:\n\n- fragment-encode: Encodes \"#\" as \"%23\".\n\n    The \"fragment-strip\" normalizer should be preferred, unless it is known\n    that broken clients do not correctly encode '#' within the path component.\n\n```\n\nExample:```\n\n- /#foo  -> /%23foo\n\n```\n\n```\n- fragment-strip: Removes the URI's \"fragment\" component.\n\n    According to RFC 3986#3.5 the \"fragment\" component of an URI should not\n    be sent, but handled by the User Agent after retrieving a resource.\n\n    This normalizer should be applied first to ensure that the fragment is\n    not interpreted as part of the request's path component.\n\n```\n\nExample:```\n\n- /#foo  -> /\n\n```\n\n```\n- path-strip-dot: Removes \"/./\" segments within the \"path\" component\n    (RFC 3986#6.2.2.3).\n\n    Segments including percent encoded dots (\"%2E\") will not be detected. Use\n    the \"percent-decode-unreserved\" normalizer first if this is undesired.\n\n```\n\nExample:```\n\n- /.            -> /\n- /./bar/       -> /bar/\n- /a/./a        -> /a/a\n- /.well-known/ -> /.well-known/ (no change)\n\n```\n\n```\n- path-strip-dotdot: Normalizes \"/../\" segments within the \"path\" component\n    (RFC 3986#6.2.2.3).\n\n    This merges segments that attempt to access the parent directory with\n    their preceding segment.\n\n    Empty segments do not receive special treatment. Use the \"merge-slashes\"\n    normalizer first if this is undesired.\n\n    Segments including percent encoded dots (\"%2E\") will not be detected. Use\n    the \"percent-decode-unreserved\" normalizer first if this is undesired.\n\n```\n\nExample:```\n\n- /foo/../     -> /\n- /foo/../bar/ -> /bar/\n- /foo/bar/../ -> /foo/\n- /../bar/     -> /../bar/\n- /bar/../../  -> /../\n- /foo//../    -> /foo/\n- /foo/%2E%2E/ -> /foo/%2E%2E/\n\n```\n\n```\nIf the \"full\" option is specified then \"../\" at the beginning will be\nremoved as well:\n\n```\n\nExample:```\n\n- /../bar/     -> /bar/\n- /bar/../../  -> /\n\n```\n\n```\n- path-merge-slashes: Merges adjacent slashes within the \"path\" component\n    into a single slash.\n\n```\n\nExample:```\n\n- //        -> /\n- /foo//bar -> /foo/bar\n\n```\n\n```\n- percent-decode-unreserved: Decodes unreserved percent encoded characters to\n    their representation as a regular character (RFC 3986#6.2.2.2).\n\n    The set of unreserved characters includes all letters, all digits, \"-\",\n    \".\", \"_\", and \"~\".\n\n```\n\nExample:```\n\n- /%61dmin       -> /admin\n- /foo%3Fbar=baz -> /foo%3Fbar=baz (no change)\n- /%%36%36       -> /%66           (unsafe)\n- /%ZZ           -> /%ZZ\n\n```\n\n```\nIf the \"strict\" option is specified then invalid sequences will result\nin a HTTP 400 Bad Request being returned.\n\n```\n\nExample:```\n\n- /%%36%36 -> HTTP 400\n- /%ZZ     -> HTTP 400\n\n```\n\n```\n- percent-to-uppercase: Uppercases letters within percent-encoded sequences\n    (RFC 3986#6.2.2.1).\n\n```\n\nExample:```\n\n- /%6f -> /%6F\n- /%zz -> /%zz\n\n```\n\n```\nIf the \"strict\" option is specified then invalid sequences will result\nin a HTTP 400 Bad Request being returned.\n\n```\n\nExample:```\n\n- /%zz -> HTTP 400\n\n```\n\n```\n- query-sort-by-name: Sorts the query string parameters by parameter name.\n    Parameters are assumed to be delimited by '&'. Shorter names sort before\n    longer names and identical parameter names maintain their relative order.\n\n```\n\nExample:```\n\n- /?c=3&a=1&b=2         -> /?a=1&b=2&c=3\n- /?aaa=3&a=1&aa=2      -> /?a=1&aa=2&aaa=3\n- /?a=3&b=4&a=1&b=5&a=2 -> /?a=3&a=1&a=2&b=4&b=5\n\n```\n\n**[pause](#4.4-pause)**{<timeout>|<expr>}Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis suspends the message analysis for the sepcified number of milliseconds.\nThe timeout can be specified in milliseconds or with any other unit if the\nnumber is suffixed by the unit as explained at the top of this document. It\nis also possible to write an expression which must return a number\ninterpreted as a timeout in milliseconds. If the expression evaluation fails\nor if it returns an invalid value, the action is ignored and the evaluation\ncontinues.\n\nThis action may be used for debugging purpose. But it could also be used to\nslow down some clients based on specific criteria. For instance, it is\npossible to slow down clients if their requests rate is too high, by tracking\nthem via a \"track-sc\" rule.\n\n```\n\n**[redirect](#4.4-redirect)**<rule>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis performs an HTTP redirection based on a redirect rule. This is exactly\nthe same as the \"redirectThis keyword is available in sections :Alphabetically sorted keywords referenceAlphabetically sorted actions reference\" statement except that it inserts a redirect rule\nwhich is processed in the middle of other \"http-request\" or \"http-response\"\nrules and that these rules use the Custom log format. For responses, only\nthe \"location\" type of redirect is permitted. In addition, when a redirect is\nperformed during a response, the transfer from the server to HAProxy is\ninterrupted so that no payload can be forwarded to the client. This may cause\nsome connections to be closed on HTTP/1. This action is final, i.e. no\nfurther rules from the same rule set are evaluated for the current section.\nSee the \"redirectThis keyword is available in sections :Alphabetically sorted keywords referenceAlphabetically sorted actions reference\" keyword for the rule's syntax.\n\n```\n\n**[reject](#4.4-reject)**Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis stops the evaluation of the rules and immediately closes the connection\nwithout sending any response. For HTTP rules, it acts similarly to the\n\"tcp-request content reject\" rules. It can be useful to force an immediate\nconnection closure on HTTP/2 connections.\n\nIn \"tcp-request connection\" rules, rejected connections do not even become a\nsession, which is why they are accounted separately for in the stats, as\n\"denied connections\". They are not considered for the session rate-limit and\nare not logged either. The reason is that these rules should only be used to\nfilter extremely high connection rates such as the ones encountered during a\nmassive DDoS attack. Under these extreme conditions, the simple action of\nlogging each event would make the system collapse and would considerably\nlower the filtering capacity. If logging is absolutely desired, then\n\"tcp-request content\" rules should be used instead, as \"tcp-request session\"\nrules will not log either.\n\nWhen used in \"tcp-response content\" rules, the server connection will be\nclosed and the response aborted. This is generally used to prevent sensitive\ninformation from leaking, typically after inspecting contents in conjunction\nwith the \"wait-for-body\" action.\n\nThis action can also be used in \"quic-initial\" rules. The newly opened QUIC\nconnection is immediately closed without any SSL handshake processing and the\nclient is notified via a CONNECTION_REFUSED error code.\n\n```\n\n**[replace-header](#4.4-replace-header)**<name><match-regex><replace-fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis matches the value of all occurrences of header field <name> against\n<match-regex>. Matching is performed case-sensitively. Matching values are\ncompletely replaced by <replace-fmt>. Format characters are allowed in\n<replace-fmt> and work like <fmt> arguments in \"http-request add-header\".\nStandard back-references using the backslash ('\\') followed by a number are\nsupported.\n\nThis action acts on whole header lines, regardless of the number of values\nthey may contain. Thus it is well-suited to process headers naturally\ncontaining commas in their value, such as If-Modified-Since or Set-Cookie.\nHeaders that contain a comma-separated list of values, such as Accept, or\nCache-Control should be processed using the \"replace-value\" action instead.\nSee also the \"replace-value\" action.\n\n```\n\nExample:```\n\nhttp-request replace-header Cookie foo=([^;]*);(.*) foo=\\1;ip=%bi;\\2\n\n# applied to:\nCookie: foo=foobar; expires=Tue, 14-Jun-2016 01:40:45 GMT;\n\n# outputs:\nCookie: foo=foobar;ip=192.168.1.20; expires=Tue, 14-Jun-2016 01:40:45 GMT;\n\n# assuming the backend IP is 192.168.1.20\n\nhttp-request replace-header User-Agent curl foo\n\n# applied to:\nUser-Agent: curl/7.47.0\n\n# outputs:\nUser-Agent: foo\n\n```\n\nExample:```\n\nhttp-response replace-header Set-Cookie (C=[^;]*);(.*) \\1;ip=%bi;\\2\n\n# applied to:\nSet-Cookie: C=1; expires=Tue, 14-Jun-2016 01:40:45 GMT\n\n# outputs:\nSet-Cookie: C=1;ip=192.168.1.20; expires=Tue, 14-Jun-2016 01:40:45 GMT\n\n# assuming the backend IP is 192.168.1.20.\n\n```\n\n**[replace-path](#4.4-replace-path)**<match-regex><replace-fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis works like \"replace-header\" except that it works on the request's path\ncomponent instead of a header. The path component starts at the first '/'\nafter an optional scheme+authority and ends before the question mark. Thus,\nthe replacement does not modify the scheme, the authority and the\nquery-string.\n\nIt is worth noting that regular expressions may be more expensive to evaluate\nthan certain ACLs, so rare replacements may benefit from a condition to avoid\nperforming the evaluation at all if it does not match.\n\n```\n\nExample:```\n\n# prefix /foo : turn /bar?q=1 into /foo/bar?q=1 :\nhttp-request replace-path (.*) /foo\\1\n\n# strip /foo : turn /foo/bar?q=1 into /bar?q=1\nhttp-request replace-path /foo/(.*) /\\1\n# or more efficient if only some requests match :\nhttp-request replace-path /foo/(.*) /\\1 if { url_beg /foo/ }\n\n```\n\n**[replace-pathq](#4.4-replace-pathq)**<match-regex><replace-fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis does the same as \"http-request replace-path\" except that the path\ncontains the query-string if any is present. Thus, the path and the\nquery-string are replaced.\n\n```\n\nExample:```\n\n# suffix /foo : turn /bar?q=1 into /bar/foo?q=1 :\nhttp-request replace-pathq ([^?]*)(\\?(.*))? \\1/foo\\2\n\n```\n\n**[replace-uri](#4.4-replace-uri)**<match-regex><replace-fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis works like \"replace-header\" except that it works on the request's URI part\ninstead of a header. The URI part may contain an optional scheme, authority or\nquery string. These are considered to be part of the value that is matched\nagainst.\n\nIt is worth noting that regular expressions may be more expensive to evaluate\nthan certain ACLs, so rare replacements may benefit from a condition to avoid\nperforming the evaluation at all if it does not match.\n\nIMPORTANT NOTE: historically in HTTP/1.x, the vast majority of requests sent\nby browsers use the \"origin form\", which differs from the \"absolute form\" in\nthat they do not contain a scheme nor authority in the URI portion. Mostly\nonly requests sent to proxies, those forged by hand and some emitted by\ncertain applications use the absolute form. As such, \"replace-uri\" usually\nworks fine most of the time in HTTP/1.x with rules starting with a \"/\". But\nwith HTTP/2, clients are encouraged to send absolute URIs only, which look\nlike the ones HTTP/1 clients use to talk to proxies. Such partial replace-uri\nrules may then fail in HTTP/2 when they work in HTTP/1. Either the rules need\nto be adapted to optionally match a scheme and authority, or replace-path\nshould be used.\n\n```\n\nExample:```\n\n# rewrite all \"http\" absolute requests to \"https\":\nhttp-request replace-uri ^http://(.*) https://\\1\n\n# prefix /foo : turn /bar?q=1 into /foo/bar?q=1 :\nhttp-request replace-uri ([^/:]*://[^/]*)?(.*) \\1/foo\\2\n\n```\n\n**[replace-value](#4.4-replace-value)**<name><match-regex><replace-fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis works like \"replace-header\" except that it matches the regex against\nevery comma-delimited value of the header field <name> instead of the\nentire header. This is suited for all headers which are allowed to carry\nmore than one value. An example could be the Accept request header, or\nCache-Control for requests or responses.\n\n```\n\nExample:```\n\nhttp-request replace-value X-Forwarded-For ^192\\.168\\.(.*)$ 172.16.\\1\n\n# applied to:\nX-Forwarded-For: 192.168.10.1, 192.168.13.24, 10.0.0.37\n\n# outputs:\nX-Forwarded-For: 172.16.10.1, 172.16.13.24, 10.0.0.37\n\n```\n\nExample:```\n\nhttp-after-response replace-value Cache-control ^public$ private\n\n# applied to:\nCache-Control: max-age=3600, public\n\n# outputs:\nCache-Control: max-age=3600, private\n\n```\n\n**[return](#4.4-return)**[ status<code>][ content-type<type>][{ default-errorfiles | errorfile<file>| errorfiles<name>| file<file>| lf-file<file>| string<str>| lf-string<fmt>}][ hdr<name><fmt>]*Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis stops the evaluation of the rules and immediately returns a response. The\ndefault status code used for the response is 200. It can be optionally\nspecified as an arguments to \"status\". The response content-type may also be\nspecified as an argument to \"content-type\". Finally the response itself may\nbe defined. It can be a full HTTP response specifying the errorfile to use,\nor the response payload specifying the file or the string to use. These rules\nare followed to create the response :\n\n* If neither the errorfile nor the payload to use is defined, a dummy\n  response is returned. Only the \"status\" argument is considered. It can be\n  any code in the range [200, 599]. The \"content-type\" argument, if any, is\n  ignored.\n\n* If \"default-errorfiles\" argument is set, the proxy's errorfiles are\n  considered.  If the \"status\" argument is defined, it must be one of the\n  status code handled by HAProxy (200, 400, 403, 404, 405, 408, 410, 413,\n  414, 425, 429, 431, 500, 501, 502, 503, and 504). The \"content-type\"\n  argument, if any, is ignored.\n\n* If a specific errorfile is defined, with an \"errorfileThis keyword is available in sections :HTTP-errorsAlphabetically sorted keywords reference\" argument, the\n  corresponding file, containing a full HTTP response, is returned. Only the\n  \"status\" argument is considered. It must be one of the status code handled\n  by HAProxy (200, 400, 403, 404, 405, 408, 410, 413, 414, 425, 429, 431,\n  500, 501, 502, 503, and 504). The \"content-type\" argument, if any, is\n  ignored.\n\n* If an http-errors section is defined, with an \"errorfiles\" argument, the\n  corresponding file in the specified http-errors section, containing a full\n  HTTP response, is returned. Only the \"status\" argument is considered. It\n  must be one of the status code handled by HAProxy (200, 400, 403, 404, 405,\n  408, 410, 413, 414, 425, 429, 431, 500, 501, 502, 503, and 504).\n  The \"content-type\" argument, if any, is ignored.\n\n* If a \"file\" or a \"lf-file\" argument is specified, the file's content is\n  used as the response payload. If the file is not empty, its content-type\n  must be set as argument to \"content-type\". Otherwise, any \"content-type\"\n  argument is ignored. With a \"lf-file\" argument, the file's content is\n  evaluated as a Custom log format (see section 8.2.6). With a \"file\"\n  argument, it is considered as a raw content.\n\n* If a \"string\" or \"lf-string\" argument is specified, the defined string is\n  used as the response payload. The content-type must always be set as\n  argument to \"content-type\". With a \"lf-string\" argument, the string is\n  evaluated as a Custom log format (see section 8.2.6). With a \"string\"\n  argument, it is considered as a raw string.\n\nWhen the response is not based on an errorfile, it is possible to append HTTP\nheader fields to the response using \"hdr\" arguments. Otherwise, all \"hdr\"\narguments are ignored. For each one, the header name is specified in <name>\nand its value is defined by <fmt> which follows the Custom log format rules\ndescribed in section 8.2.6.\n\nNote that the generated response must be smaller than a buffer. And to avoid\nany warning, when an errorfile or a raw file is loaded, the buffer space\nreserved for the headers rewriting should also be free.\n\nThis action is final, i.e. no further rules from the same rule set are\nevaluated for the current section.\n\n```\n\nExample:```\n\nhttp-request return errorfile /etc/haproxy/errorfiles/200.http \\\n    if { path /ping }\n\nhttp-request return content-type image/x-icon file /var/www/favicon.ico  \\\n    if { path /favicon.ico }\n\nhttp-request return status 403 content-type text/plain    \\\n    lf-string \"Access denied. IP %[src] is blacklisted.\"  \\\n    if { src -f /etc/haproxy/blacklist.lst }\n\n```\n\n**[sc-add-gpc](#4.4-sc-add-gpc)**(<idx>,<sc-id>){<int>|<expr>}Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis action increments the General Purpose Counter at the index <idx> of the\narray associated to the sticky counter designated by <sc-id> by the value of\neither integer <int> or the integer evaluation of expression <expr>. Integers\nand expressions are limited to unsigned 32-bit values. If an error occurs,\nthis action silently fails and the actions evaluation continues. <idx> is an\ninteger between 0 and 99 and <sc-id> is an integer between 0 and 2. It also\nsilently fails if the there is no GPC stored at this index. The entry in the\ntable is refreshed even if the value is zero. The 'gpc_rate' is automatically\nadjusted to reflect the average growth rate of the gpc value.\n\nThis action applies only to the 'gpc' and 'gpc_rate' array data_types (and\nnot to the legacy 'gpc0', 'gpc1', 'gpc0_rate' nor 'gpc1_rate' data_types).\nThere is no equivalent function for legacy data types, but if the value is\nalways 1, please see 'sc-inc-gpc()', 'sc-inc-gpc0()' and 'sc-inc-gpc1()'.\nThere is no way to decrement the value either, but it is possible to store\nexact values in a General Purpose Tag using 'sc-set-gpt()' instead.\n\nThe main use of this action is to count scores or total volumes (e.g.\nestimated danger per source IP reported by the server or a WAF, total\nuploaded bytes, etc).\n\n```\n\n**[sc-inc-gpc](#4.4-sc-inc-gpc)**(<idx>,<sc-id>)Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis actions increments the General Purpose Counter at the index <idx> of the\narray associated to the sticky counter designated by <sc-id>. If an error\noccurs, this action silently fails and the actions evaluation continues.\n<idx> is an integer between 0 and 99 and <sc-id> is an integer between 0 and\n2. It also silently fails if the there is no GPC stored at this index. This\naction applies only to the 'gpc' and 'gpc_rate' array data_types (and not to\nthe legacy 'gpc0', 'gpc1', 'gpc0_rate' nor 'gpc1_rate' data_types).\n\n```\n\n**[sc-inc-gpc0](#4.4-sc-inc-gpc0)**(<sc-id>)**[sc-inc-gpc1](#4.4-sc-inc-gpc1)**(<sc-id>)Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis actions increments the GPC0 or GPC1 counter according with the sticky\ncounter designated by <sc-id>. If an error occurs, this action silently fails\nand the actions evaluation continues.\n\n```\n\n**[sc-set-gpt](#4.4-sc-set-gpt)**(<idx>,<sc-id>){<int>|<expr>}Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis action sets the 32-bit unsigned GPT at the index <idx> of the array\nassociated to the sticky counter designated by <sc-id> at the value of\n<int>/<expr>. The expected result is a boolean.\n\nIf an error occurs, this action silently fails and the actions evaluation\ncontinues. <idx> is an integer between 0 and 99 and <sc-id> is an integer\nbetween 0 and 2. It also silently fails if the there is no GPT stored\nat this index.\n\nThis action applies only to the 'gpt' array data_type (and not to the\nlegacy 'gpt0' data-type).\n\n```\n\n**[sc-set-gpt0](#4.4-sc-set-gpt0)**(<sc-id>){<int>|<expr>}Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis action sets the 32-bit unsigned GPT0 tag according to the sticky counter\ndesignated by <sc-id> and the value of <int>/<expr>. The expected result is a\nboolean. If an error occurs, this action silently fails and the actions\nevaluation continues. This action is an alias for \"sc-set-gpt(0,<sc-id>)\".\nSee also the \"sc-set-gpt\" action.\n\n```\n\n**[send-retry](#4.4-send-retry)**Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis action forces the emission of a Retry packet in response to a client\nInitial packet without token. This is useful to ensure client address is\nvalidated prior to instantiating any connection elements and starting the\nhandshake.\n\n```\n\n**[send-spoe-group](#4.4-send-spoe-group)**<engine-name><group-name>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis action is used to trigger sending of a group of SPOE messages. To do so,\nthe SPOE engine used to send messages must be defined, as well as the SPOE\ngroup to send. Of course, the SPOE engine must refer to an existing SPOE\nfilter. If not engine name is provided on the SPOE filter line, the SPOE\nagent name must be used.\n\n```\n\nArguments:```\n<engine-name>  The SPOE engine name.\n\n<group-name>   The SPOE group name as specified in the engine\n               configuration.\n```\n\n**[set-bandwidth-limit](#4.4-set-bandwidth-limit)**<name>[limit{<expr>|<size>}][period{<expr>|<time>}]Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis action is used to enable the bandwidth limitation filter <name>, either\non the upload or download direction depending on the filter type. Custom\nlimit and period may be defined, if and only if <name> references a\nper-stream bandwidth limitation filter. When a set-bandwidth-limit rule is\nexecuted, it first resets all settings of the filter to their defaults prior\nto enabling it. As a consequence, if several \"set-bandwidth-limit\" actions\nare executed for the same filter, only the last one is considered. Several\nbandwidth limitation filters can be enabled on the same stream.\n\nNote that this action cannot be used in a defaults section because bandwidth\nlimitation filters cannot be defined in defaults sections. In addition, only\nthe HTTP payload transfer is limited. The HTTP headers are not considered.\n\n```\n\nArguments:```\n<expr>  Is a standard HAProxy expression formed by a sample-fetch followed\n        by some converters. The result is converted to an integer. It is\n        interpreted as a size in bytes for the \"limit\" parameter and as a\n        duration in milliseconds for the \"period\" parameter.\n\n<size>  Is a number. It follows the HAProxy size format and is expressed in\n        bytes.\n\n<time>  Is a number. It follows the HAProxy time format and is expressed in\n        milliseconds.\n```\n\nExample:```\n\nhttp-request set-bandwidth-limit global-limit\nhttp-request set-bandwidth-limit my-limit limit 1m period 10s\n\n```\n\n```\nSee section 9.7 about bandwidth limitation filter setup.\n\n```\n\n**[set-bc-mark](#4.4-set-bc-mark)**{<mark>|<expr>}Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to set the Netfilter/IPFW MARK on the backend connection (all\npackets sent to the server) to the value passed in <mark> or <expr> on\nplatforms which support it. This value is an unsigned 32 bit value which can\nbe matched by netfilter/ipfw and by the routing table or monitoring the\npackets through DTrace. <mark> can be expressed both in decimal or hexadecimal\nformat (prefixed by \"0x\"). Alternatively, <expr> can be used: it is a standard\nHAProxy expression formed by a sample-fetch followed by some converters which\nmust resolve to integer type. This action can be useful to force certain\npackets to take a different route (for example a cheaper network path for bulk\ndownloads). This works on Linux kernels 2.6.32 and above and requires admin\nprivileges, as well on FreeBSD and OpenBSD. The mark will be set for the whole\nduration of the backend/server connection (from connect to close).\n\n```\n\n**[set-bc-tos](#4.4-set-bc-tos)**{<tos>|<expr>}Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to set the TOS or DSCP field value on the backend connection\n(all packets sent to the server) to the value passed in <tos> or <expr> on\nplatforms which support this. This value represents the whole 8 bits of the\nIP TOS field. Note that only the 6 higher bits are used in DSCP or TOS, and\nthe two lower bits are always 0. Alternatively, <expr> can be used: it is a\nstandard HAProxy expression formed by a sample-fetch followed by some\nconverters which must resolve to integer type. This action can be used to\nadjust some routing behavior on inner routers based on some information from\nthe request. The tos will be set for the whole duration of the backend/server\nconnection (from connect to close).\n\nSee RFC 2474, 2597, 3260 and 4594 for more information.\n\n```\n\n**[set-dst](#4.4-set-dst)**<expr>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to set the destination IP address to the value of specified\nexpression. Useful when a proxy in front of HAProxy rewrites destination IP,\nbut provides the correct IP in a HTTP header; or you want to mask the IP for\nprivacy. If you want to connect to the new address/port, use '0.0.0.0:0' as a\nserver address in the backend.\n\n```\n\nArguments:```\n<expr>  Is a standard HAProxy expression formed by a sample-fetch followed\n        by some converters.\n```\n\nExample:```\n\nhttp-request set-dst hdr(x-dst)\nhttp-request set-dst dst,ipmask(24)\n\n```\n\n```\nWhen possible, set-dst preserves the original destination port as long as the\naddress family allows it, otherwise the destination port is set to 0.\n\n```\n\n**[set-dst-port](#4.4-set-dst-port)**<expr>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to set the destination port address to the value of specified\nexpression. If you want to connect to the new address/port, use '0.0.0.0:0'\nas a server address in the backend.\n\n```\n\nArguments:```\n<expr>  Is a standard HAProxy expression formed by a sample-fetch\n        followed by some converters.\n```\n\nExample:```\n\nhttp-request set-dst-port hdr(x-port)\nhttp-request set-dst-port int(4000)\n\n```\n\n```\nWhen possible, set-dst-port preserves the original destination address as\nlong as the address family supports a port, otherwise it forces the\ndestination address to IPv4 \"0.0.0.0\" before rewriting the port.\n\n```\n\n**[set-fc-mark](#4.4-set-fc-mark)**{<mark>|<expr>}Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to set the Netfilter/IPFW MARK on all packets sent to the client\nto the value passed in <mark> or <expr> on platforms which support it. This\nvalue is an unsigned 32 bit value which can be matched by netfilter/ipfw and\nby the routing table or monitoring the packets through DTrace. <mark> can be\nexpressed both in decimal or hexadecimal format (prefixed by \"0x\").\nAlternatively, <expr> can be used: it is a standard HAProxy expression formed\nby a sample-fetch followed by some converters which must resolve to integer\ntype. This action can be useful to force certain packets to take a different\nroute (for example a cheaper network path for bulk downloads). This works on\nLinux kernels 2.6.32 and above and requires admin privileges, as well on\nFreeBSD and OpenBSD.\n\n```\n\n**[set-fc-tos](#4.4-set-fc-tos)**{<tos |<expr>}Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to set the TOS or DSCP field value of packets sent to the client\nto the value passed in <tos> or <expr> on platforms which support this. This\nvalue represents the whole 8 bits of the IP TOS field. Note that only the 6\nhigher bits are used in DSCP or TOS, and the two lower bits are always 0.\nAlternatively, <expr> can be used: it is a standard HAProxy expression formed\nby a sample-fetch followed by some converters which must resolve to integer\ntype. This action can be used to adjust some routing behavior on border\nrouters based on some information from the request.\n\nSee RFC 2474, 2597, 3260 and 4594 for more information.\n\n```\n\n**[set-header](#4.4-set-header)**<name><fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis does the same as the \"add-header\" action except that the header is first\nremoved if it existed. This is useful when passing security information to\nthe server, where the header must not be manipulated by external users, or to\nforce certain response headers such as \"Server\" to hide external information.\nNote that the new value is computed before the removal so it is possible to\nconcatenate a value to an existing header.\n\n```\n\nExample:```\n\nhttp-request set-header X-Haproxy-Current-Date %T\nhttp-request set-header X-SSL                  %[ssl_fc]\nhttp-request set-header X-SSL-Session_ID       %[ssl_fc_session_id,hex]\nhttp-request set-header X-SSL-Client-Verify    %[ssl_c_verify]\nhttp-request set-header X-SSL-Client-DN        %{+Q}[ssl_c_s_dn]\nhttp-request set-header X-SSL-Client-CN        %{+Q}[ssl_c_s_dn(cn)]\nhttp-request set-header X-SSL-Issuer           %{+Q}[ssl_c_i_dn]\nhttp-request set-header X-SSL-Client-NotBefore %{+Q}[ssl_c_notbefore]\nhttp-request set-header X-SSL-Client-NotAfter  %{+Q}[ssl_c_notafter]\n\n```\n\n**[set-log-level](#4.4-set-log-level)**<level>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to change the log level of the current request when a certain\ncondition is met. Valid levels are the 8 syslog levels (see the \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\"\nkeyword) plus the special level \"silent\" which disables logging for this\nrequest. This rule is not final so the last matching rule wins. This rule\ncan be useful to disable health checks coming from another equipment.\n\n```\n\n**[set-map](#4.4-set-map)**(<map-name>)<key fmt><value fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to add a new entry into a map. <map-name> must follow the format\ndescribed in 2.7. about name format for maps and ACLs. The name of the MAP to\nbe updated is passed between parentheses. It takes 2 arguments: <key fmt>,\nwhich follows Custom log format rules described in section 8.2.6, used to\ncollect map key, and <value fmt>, which follows Custom log format rules, used\nto collect content for the new entry. It performs a lookup in the map before\ninsertion, to avoid duplicated (or more) values. It is the equivalent of the\n\"set map\" command from the stats socket, but can be triggered by an HTTP\nrequest.\n\n```\n\n**[set-mark](#4.4-set-mark)**<mark>(deprecated)```\nThis is an alias for \"set-fc-mark\" (which should be used instead).\n\n```\n\n**[set-method](#4.4-set-method)**<fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis rewrites the request method with the result of the evaluation of format\nstring <fmt>. There should be very few valid reasons for having to do so as\nthis is more likely to break something than to fix it.\n\n```\n\n**[set-nice](#4.4-set-nice)**<nice>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis sets the \"nice\" factor of the current request/response being processed.\nIt only has effect against the other requests being processed at the same\ntime.  The default value is 0, unless altered by the \"nice\" setting on the\n\"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line. The accepted range is -1024..1024. The higher the value, the\nnicest the request will be. Lower values will make the request more important\nthan other ones. This can be useful to improve the speed of some requests, or\nlower the priority of non-important requests. Using this setting without\nprior experimentation can cause some major slowdown.\n\n```\n\n**[set-path](#4.4-set-path)**<fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis rewrites the request path with the result of the evaluation of format\nstring <fmt>. The query string, if any, is left intact. If a scheme and\nauthority is found before the path, they are left intact as well. If the\nrequest doesn't have a path (\"*\"), this one is replaced with the format.\nThis can be used to prepend a directory component in front of a path for\nexample. See also \"http-request set-query\" and \"http-request set-uri\".\n\n```\n\nExample :```\n\n# prepend the host name before the path\nhttp-request set-path /%[hdr(host)]%[path]\n\n```\n\n**[set-pathq](#4.4-set-pathq)**<fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis does the same as \"http-request set-path\" except that the query-string is\nalso rewritten. It may be used to remove the query-string, including the\nquestion mark (it is not possible using \"http-request set-query\").\n\n```\n\n**[set-priority-class](#4.4-set-priority-class)**<expr>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to set the queue priority class of the current request.\nThe value must be a sample expression which converts to an integer in the\nrange -2047..2047. Results outside this range will be truncated.\nThe priority class determines the order in which queued requests are\nprocessed. Lower values have higher priority.\n\n```\n\n**[set-priority-offset](#4.4-set-priority-offset)**<expr>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to set the queue priority timestamp offset of the current\nrequest. The value must be a sample expression which converts to an integer\nin the range -524287..524287. Results outside this range will be truncated.\nWhen a request is queued, it is ordered first by the priority class, then by\nthe current timestamp adjusted by the given offset in milliseconds. Lower\nvalues have higher priority.\nNote that the resulting timestamp is is only tracked with enough precision\nfor 524,287ms (8m44s287ms). If the request is queued long enough to where the\nadjusted timestamp exceeds this value, it will be misidentified as highest\npriority. Thus it is important to set \"timeout queue\" to a value, where when\ncombined with the offset, does not exceed this limit.\n\n```\n\n**[set-query](#4.4-set-query)**<fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis rewrites the request's query string which appears after the first\nquestion mark (\"?\") with the result of the evaluation of format string <fmt>.\nThe part prior to the question mark is left intact. If the request doesn't\ncontain a question mark and the new value is not empty, then one is added at\nthe end of the URI, followed by the new value. If a question mark was\npresent, it will never be removed even if the value is empty. This can be\nused to add or remove parameters from the query string.\n\nSee also \"http-request set-query\" and \"http-request set-uri\".\n\n```\n\nExample:```\n\n# replace \"%3D\" with \"=\" in the query string\nhttp-request set-query %[query,regsub(%3D,=,g)]\n\n```\n\n**[set-retries](#4.4-set-retries)**<int>|<epxr>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis action overrides the specified \"retries\" value for the current stream\nonly. It can be an integer value, in the range [0, 100], or an expression\nwhich must return a integer in the range [0, 100].\n\nNote that this action is only relevant on the backend side and thus this rule\nis only available for the proxies with backend capability. It is also not\nallowed in \"defaults\" sections.\n\n```\n\nExample:```\n\ntcp-request content set-retries 3\nhttp-request set-retries var(txn.retries)\n\n```\n\n**[set-src](#4.4-set-src)**<expr>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to set the source IP address to the value of specified\nexpression. Useful when a proxy in front of HAProxy rewrites source IP, but\nprovides the correct IP in a HTTP header; or you want to mask source IP for\nprivacy. All subsequent calls to \"src\" fetch will return this value\n(see example).\n\n```\n\nArguments :```\n<expr>  Is a standard HAProxy expression formed by a sample-fetch followed\n        by some converters.\n```\n\n```\nSee also \"option forwardfor\".\n\n```\n\nExample:```\n\nhttp-request set-src hdr(x-forwarded-for)\nhttp-request set-src src,ipmask(24)\n\n# After the masking this will track connections\n# based on the IP address with the last byte zeroed out.\nhttp-request track-sc0 src\n\n```\n\n```\nWhen possible, set-src preserves the original source port as long as the\naddress family allows it, otherwise the source port is set to 0.\n\n```\n\n**[set-src-port](#4.4-set-src-port)**<expr>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to set the source port address to the value of specified\nexpression.\n\n```\n\nArguments:```\n<expr>  Is a standard HAProxy expression formed by a sample-fetch followed\n        by some converters.\n```\n\nExample:```\n\nhttp-request set-src-port hdr(x-port)\nhttp-request set-src-port int(4000)\n\n```\n\n```\nWhen possible, set-src-port preserves the original source address as long as\nthe address family supports a port, otherwise it forces the source address to\nIPv4 \"0.0.0.0\" before rewriting the port.\n\n```\n\n**[set-status](#4.4-set-status)**<status>[reason<str>]Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis replaces the response status code with <status> which must be an integer\nbetween 100 and 999. Optionally, a custom reason text can be provided defined\nby <str>, or the default reason for the specified code will be used as a\nfallback. Note that the reason string only exists in HTTP/1.x and is ignored\nby other versions of the protocol.\n\n```\n\nExample:```\n\n# return \"431 Request Header Fields Too Large\"\nhttp-response set-status 431\n# return \"503 Slow Down\", custom reason\nhttp-response set-status 503 reason \"Slow Down\".\n\n```\n\n**[set-timeout](#4.4-set-timeout)**{ client | server | tunnel }{<timeout>|<expr>}Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis action overrides the specified \"client\", \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" or \"tunnel\" timeout\nfor the current stream only. The timeout can be specified in milliseconds or\nwith any other unit if the number is suffixed by the unit as explained at the\ntop of this document. It is also possible to write an expression which must\nreturn a number interpreted as a timeout in milliseconds.\n\nNote that the server/tunnel timeouts are only relevant on the backend side\nand thus this rule is only available for the proxies with backend\ncapabilities. Likewise, client timeout is only relevant for frontend side.\nAlso the timeout value must be non-null to obtain the expected results.\n\n```\n\nExample:```\n\nhttp-request set-timeout tunnel 5s\nhttp-request set-timeout server req.hdr(host),map_int(host.lst)\n\n```\n\nExample:```\n\nhttp-response set-timeout tunnel 5s\nhttp-response set-timeout server res.hdr(X-Refresh-Seconds),mul(1000)\n\n```\n\n**[set-tos](#4.4-set-tos)**<tos>(deprecated)```\nThis is an alias for \"set-fc-tos\" (which should be used instead).\n\n```\n\n**[set-uri](#4.4-set-uri)**<fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis rewrites the request URI with the result of the evaluation of format\nstring <fmt>. The scheme, authority, path and query string are all replaced\nat once. This can be used to rewrite hosts in front of proxies, or to perform\ncomplex modifications to the URI such as moving parts between the path and\nthe query string. If an absolute URI is set, it will be sent as is to\nHTTP/1.1 servers. If it is not the desired behavior, the host, the path\nand/or the query string should be set separately.\nSee also \"http-request set-path\" and \"http-request set-query\".\n\n```\n\n**[set-var](#4.4-set-var)**(<var-name>[,<cond>...])<expr>**[set-var-fmt](#4.4-set-var-fmt)**(<var-name>[,<cond>...])<fmt>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to set the contents of a variable. The variable is declared\ninline.\n\n```\n\nArguments:```\n<var-name>   The name of the variable. Variable of the parent stream cannot\n             be set. See section 2.8 about variables for details.\n\n <cond>      A set of conditions that must all be true for the variable to\n             actually be set (such as \"ifnotempty\", \"ifgt\" ...). See the\n             set-var converter's description for a full list of possible\n             conditions.\n\n <expr>      Is a standard HAProxy expression formed by a sample-fetch\n             followed by some converters.\n\n <fmt>       This is the value expressed using Custom log format rules (see\n             Custom log format in section 8.2.6).\n```\n\n```\nAll scopes are usable for HTTP rules, but scopes \"proc\" and \"sess\" are the\nonly usable ones in rule sets which do not have access to contents such as\n\"tcp-request connection\" and \"tcp-request session\".\n\n```\n\nExample:```\n\nhttp-request set-var(req.my_var) req.fhdr(user-agent),lower\nhttp-request set-var-fmt(txn.from) %[src]:%[src_port]\n\n```\n\n**[silent-drop](#4.4-silent-drop)**[ rst-ttl<ttl>]Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis stops the evaluation of the rules and makes the client-facing connection\nsuddenly disappear using a system-dependent way that tries to prevent the\nclient from being notified. When called without the rst-ttl argument,\nwe try to prevent sending any FIN or RST packet back to the client by\nusing TCP_REPAIR. If this fails (mainly because of missing privileges),\nwe fall back to sending a RST packet with a TTL of 1.\n\nThe effect is that the client still sees an established connection while\nthere is none on HAProxy, saving resources. However, stateful equipment\nplaced between the HAProxy and the client (firewalls, proxies,\nload balancers) will also keep the established connection in their\nsession tables.\n\nThe optional rst-ttl changes this behaviour: TCP_REPAIR is not used, and an\nRST packet with a configurable TTL is sent. When set to a reasonable value,\nthe RST packet travels through the local infrastructure, deleting the\nconnection in firewalls and other systems, but disappears before reaching\nthe client. Future packets from the client will then be dropped already by\nfront equipment. These local RSTs protect local resources, but not the\nclient's. This must not be used unless the consequences of doing this are\nfully understood.\n\n```\n\n**[strict-mode](#4.4-strict-mode)**{ on | off }Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis enables or disables the strict rewriting mode for following rules. It\ndoes not affect rules declared before it and it is only applicable on rules\nperforming a rewrite on the requests. When the strict mode is enabled, any\nrewrite failure triggers an internal error. Otherwise, such errors are\nsilently ignored. The purpose of the strict rewriting mode is to make some\nrewrites optional while others must be performed to continue the request\nprocessing.\n\nBy default, the strict rewriting mode is enabled. Its value is also reset\nwhen a ruleset evaluation ends. So, for instance, if you change the mode on\nthe frontend, the default mode is restored when HAProxy starts the backend\nrules evaluation.\n\n```\n\n**[switch-mode http](#4.4-switch-mode%20http)**[ proto<name>]Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis action is used to perform a connection upgrade. Only HTTP upgrades are\nsupported for now. The protocol may optionally be specified. This action is\nonly available for a proxy with the frontend capability. The connection\nupgrade is immediately performed, following \"tcp-request content\" rules are\nnot evaluated. This upgrade method should be preferred to the implicit one\nconsisting to rely on the backend mode. When used, it is possible to set HTTP\ndirectives in a frontend without any warning. These directives will be\nconditionally evaluated if the HTTP upgrade is performed. However, an HTTP\nbackend must still be selected. It remains unsupported to route an HTTP\nconnection (upgraded or not) to a TCP server.\n\nSee section 4 about Proxies for more details on HTTP upgrades.\n\n```\n\n**[tarpit](#4.4-tarpit)**[{ status | deny_status }<code>][content-type<type>][{ default-errorfiles | errorfile<file>| errorfiles<name>| file<file>| lf-file<file>| string<str>| lf-string<fmt>}][ hdr<name><fmt>]*Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis stops the evaluation of the rules and immediately blocks the request\nwithout responding for a delay specified by \"timeout tarpit\" or\n\"timeout connectThis keyword is available in sections :RingsAlphabetically sorted keywords reference\" if the former is not set. After that delay, if the client\nis still connected, a response is returned so that the client does not\nsuspect it has been tarpitted. Logs will report the flags \"PT\". The goal of\nthe tarpit rule is to slow down robots during an attack when they're limited\non the number of concurrent requests. It can be very efficient against very\ndumb robots, and will significantly reduce the load on firewalls compared to\na \"deny\" rule. But when facing \"correctly\" developed robots, it can make\nthings worse by forcing HAProxy and the front firewall to support insane\nnumber of concurrent connections. By default an HTTP error 500 is returned.\nBut the response may be customized using same syntax than\n\"http-request return\" rules. Thus, see \"http-request return\" for details.\n\nFor compatibility purpose, when no argument is defined, or only \"deny_status\",\nthe argument \"default-errorfiles\" is implied. It means\n\"http-request tarpit [deny_status <status>]\" is an alias of\n\"http-request tarpit [status <status>] default-errorfiles\".\nNo further \"http-request\" rules are evaluated.\nSee also \"http-request return\" and \"http-request silent-drop\".\n\n```\n\n**[track-sc0](#4.4-track-sc0)**<key>[table<table>]**[track-sc1](#4.4-track-sc1)**<key>[table<table>]**[track-sc2](#4.4-track-sc2)**<key>[table<table>]Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis enables tracking of sticky counters from current request. These rules do\nnot stop evaluation and do not change default action. The number of counters\nthat may be simultaneously tracked by the same connection is set by the\nglobal \"tune.stick-counters\" setting, which defaults to MAX_SESS_STKCTR if\nset at build time (it is reported in haproxy -vv) and which defaults to 3,\nso the track-sc number is between 0 and (tune.stick-counters-1). The first\n\"track-sc0\" rule executed enables tracking of the counters of the specified\ntable as the first set. The first \"track-sc1\" rule executed enables tracking\nof the counters of the specified table as the second set. The first\n\"track-sc2\" rule executed enables tracking of the counters of the specified\ntable as the third set. It is a recommended practice to use the first set of\ncounters for the per-frontend counters and the second set for the per-backend\nones. But this is just a guideline, all may be used everywhere.\n\n```\n\nArguments :```\n<key>   is mandatory, and is a sample expression rule as described in\n        section 7.3. It describes what elements of the incoming connection,\n        request or response will be analyzed, extracted, combined, and used\n        to select which table entry to update the counters.\n\n<table> is an optional table to be used instead of the default one, which\n        is the stick-table declared in the current proxy. All the counters\n        for the matches and updates for the key will then be performed in\n        that table until the session ends.\n```\n\n```\nOnce a \"track-sc*\" rule is executed, the key is looked up in the table and if\nit is not found, an entry is allocated for it. Then a pointer to that entry\nis kept during all the session's life, and this entry's counters are updated\nas often as possible, every time the session's counters are updated, and also\nsystematically when the session ends. Counters are only updated for events\nthat happen after the tracking has been started. As an exception, connection\ncounters and request counters are systematically updated so that they reflect\nuseful information.\n\nIf the entry tracks concurrent connection counters, one connection is counted\nfor as long as the entry is tracked, and the entry will not expire during\nthat time. Tracking counters also provides a performance advantage over just\nchecking the keys, because only one table lookup is performed for all ACL\nchecks that make use of it.\n\n```\n\n**[unset-var](#4.4-unset-var)**(<var-name>)Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis is used to unset a variable. See the \"set-varThis keyword is available in sections :Process management and securityAlphabetically sorted actions referenceConverters\" action for details about\n<var-name>.\n\n```\n\nExample:```\n\nhttp-request unset-var(req.my_var)\n\n```\n\n**[use-service](#4.4-use-service)**<service-name>Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis action executes the configured TCP or HTTP service to reply to the\nrequest, depending on the rule set it's used in. The rule is final, i.e.\nno further rules are evaluated in the same rule set.\n\nA service may choose to reply by sending any valid response or it may\nimmediately close the connection without sending any response. For HTTP\nservices, a valid response requires a valid HTTP response. Outside natives\nservices, for instance the Prometheus exporter for HTTP services, it is\npossible to write custom TCP and HTTP services in Lua.\n\n```\n\nArguments :```\n<service-name>  is mandatory. It is the service to call\n```\n\nExample:```\n\nhttp-request use-service prometheus-exporter if { path /metrics }\n\n```\n\n**[wait-for-body time](#4.4-wait-for-body%20time)**<time>[ at-least<bytes>]Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis will delay the processing of the request or response until one of the\nfollowing conditions occurs:\n- The full request body is received, in which case processing proceeds\n  normally.\n- <bytes> bytes have been received, when the \"at-least\" argument is given and\n  <bytes> is non-zero, in which case processing proceeds normally.\n- The request buffer is full, in which case processing proceeds normally. The\n  size of this buffer is determined by the \"tune.bufsize\" option.\n- The request has been waiting for more than <time> milliseconds. In this\n  case HAProxy will respond with a 408 \"Request Timeout\" error to the client\n  and stop processing the request. Note that if any of the other conditions\n  happens first, this timeout will not occur even if the full body has\n  not yet been received.\n\nThis action may be used as a replacement for \"option http-buffer-request\".\n\n```\n\nArguments :```\n<time>    is mandatory. It is the maximum time to wait for the body. It\n          follows the HAProxy time format and is expressed in milliseconds.\n\n<bytes>   is optional. It is the minimum payload size to receive to stop to\n          wait. It follows the HAProxy size format and is expressed in\n          bytes. A value of 0 (the default) means no limit.\n```\n\nExample:```\n\nhttp-request wait-for-body time 1s at-least 1k if METH_POST\n\n```\n\n**See also :**\"[option http-buffer-request](#option%20http-buffer-request)\"**[wait-for-handshake](#4.4-wait-for-handshake)**Usable in :\n\nQUIC IniTCP RqConRqSesRqCntRsCntHTTP ReqResAft```\nThis will delay the processing of the request until the SSL handshake\nhappened. This is mostly useful to delay processing early data until we're\nsure they are valid.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "5. Bind and server options", "content": "# [5.](#5)Bind and server options\n\n```\nThe \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\", \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" and \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" keywords support a number of settings\ndepending on some build options and on the system HAProxy was built on. These\nsettings generally each consist in one word sometimes followed by a value,\nwritten on the same line as the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" or \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" line. All these options are\ndescribed in this section.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "5.1. Bind options", "content": "## [5.1.](#5.1)Bind options\n\n```\nThe \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" keyword supports a certain number of settings which are all passed\nas arguments on the same line. The order in which those arguments appear makes\nno importance, provided that they appear after the bind address. All of these\nparameters are optional. Some of them consist in a single words (booleans),\nwhile other ones expect a value after them. In this case, the value must be\nprovided immediately after the setting name.\n\nThe currently supported settings are the following ones.\n\n```\n\n**[accept-netscaler-cip](#5.1-accept-netscaler-cip)**<magic number>```\nEnforces the use of the NetScaler Client IP insertion protocol over any\nconnection accepted by any of the TCP sockets declared on the same line. The\nNetScaler Client IP insertion protocol dictates the layer 3/4 addresses of\nthe incoming connection to be used everywhere an address is used, with the\nonly exception of \"tcp-request connection\" rules which will only see the\nreal connection address. Logs will reflect the addresses indicated in the\nprotocol, unless it is violated, in which case the real  address will still\nbe used. This keyword combined with support from external components can be\nused as an efficient and reliable alternative to the X-Forwarded-For\nmechanism which is not always reliable and not even always usable. See also\n\"tcp-request connection expect-netscaler-cip\" for a finer-grained setting of\nwhich client is allowed to use the protocol.\n\n```\n\n**[accept-proxy](#5.1-accept-proxy)**```\nEnforces the use of the PROXY protocol over any connection accepted by any of\nthe sockets declared on the same line. Versions 1 and 2 of the PROXY protocol\nare supported and correctly detected. The PROXY protocol dictates the layer\n3/4 addresses of the incoming connection to be used everywhere an address is\nused, with the only exception of \"tcp-request connection\" rules which will\nonly see the real connection address. Logs will reflect the addresses\nindicated in the protocol, unless it is violated, in which case the real\naddress will still be used. This keyword combined with support from external\ncomponents can be used as an efficient and reliable alternative to the\nX-Forwarded-For mechanism which is not always reliable and not even always\nusable. See also \"tcp-request connection expect-proxy\" for a finer-grained\nsetting of which client is allowed to use the protocol.\n\n```\n\n**[allow-0rtt](#5.1-allow-0rtt)**```\nAllow receiving early data when using TLSv1.3. This is disabled by default,\ndue to security considerations. Because it is vulnerable to replay attacks,\nyou should only allow if for requests that are safe to replay, i.e. requests\nthat are idempotent. You can use the \"wait-for-handshake\" action for any\nrequest that wouldn't be safe with early data.\n\n```\n\n**[alpn](#5.1-alpn)**<protocols>```\nThis enables the TLS ALPN extension and advertises the specified protocol\nlist as supported on top of ALPN. The protocol list consists in a comma-\ndelimited list of protocol names, for instance: \"http/1.1,http/1.0\" (without\nquotes). This requires that the SSL library is built with support for TLS\nextensions enabled (check with haproxy -vv). The ALPN extension replaces the\ninitial NPN extension. At the protocol layer, ALPN is required to enable\nHTTP/2 on an HTTPS frontend and HTTP/3 on a QUIC frontend. However, when such\nfrontends have none of \"npnThis keyword is available in sections :Bind optionsServer and default-server options\", \"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" and \"no-alpn\" set, a default value of\n\"h2,http/1.1\" will be used for a regular HTTPS frontend, and \"h3\" for a QUIC\nfrontend. Versions of OpenSSL prior to 1.0.2 didn't support ALPN and only\nsupposed the now obsolete NPN extension. At the time of writing this, most\nbrowsers still support both ALPN and NPN for HTTP/2 so a fallback to NPN may\nstill work for a while. But ALPN must be used whenever possible. Protocols\nnot advertised are not negotiated. For example it is possible to only accept\nHTTP/2 connections with this:\n\n     bind :443 ssl crt pub.pem alpn h2  # explicitly disable HTTP/1.1\n\nQUIC supports only h3 and hq-interop as ALPN. h3 is for HTTP/3 and hq-interop\nis used for http/0.9 and QUIC interop runner (see https://interop.seemann.io).\nEach \"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" statement will replace a previous one. In order to remove them,\nuse \"no-alpn\".\n\nNote that some old browsers such as Firefox 88 used to experience issues with\nWebSocket over H2, and in case such a setup is encountered, it may be needed\nto either explicitly disable HTTP/2 in the \"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" string by forcing it to\n\"http/1.1\" or \"no-alpn\", or to enable \"h2-workaround-bogus-websocket-clients\"\nglobally.\n\n```\n\n**[backlog](#5.1-backlog)**<backlog>```\nSets the socket's backlog to this value. If unspecified or 0, the frontend's\nbacklog is used instead, which generally defaults to the maxconn value.\n\n```\n\n**[ca-file](#5.1-ca-file)**<cafile>```\nThis setting is only available when support for OpenSSL was built in. It\ndesignates a PEM file from which to load CA certificates used to verify\nclient's certificate. It is possible to load a directory containing multiple\nCAs, in this case HAProxy will try to load every \".pem\", \".crt\", \".cer\", and\n.crl\" available in the directory, files starting with a dot are ignored.\n\nWarning: The \"@system-ca\" parameter could be used in place of the cafile\nin order to use the trusted CAs of your system, like its done with the server\ndirective. But you mustn't use it unless you know what you are doing.\nConfiguring it this way basically mean that the bind will accept any client\ncertificate generated from one of the CA present on your system, which is\nextremely insecure.\n\n```\n\n**[ca-ignore-err](#5.1-ca-ignore-err)**[all|<errorID>,...]```\nThis setting is only available when support for OpenSSL was built in.\nSets a comma separated list of errorIDs to ignore during verify at depth > 0.\nIt could be a numerical ID, or the constant name (X509_V_ERR) which is\navailable in the OpenSSL documentation:\nhttps://www.openssl.org/docs/manmaster/man3/X509_STORE_CTX_get_error.html#ERROR-CODES\nIt is recommended to use the constant name as the numerical value can change\nin new version of OpenSSL.\nIf set to 'all', all errors are ignored. SSL handshake is not aborted if an\nerror is ignored.\n\n```\n\n**[ca-sign-file](#5.1-ca-sign-file)**<cafile>```\nThis setting is only available when support for OpenSSL was built in. It\ndesignates a PEM file containing both the CA certificate and the CA private\nkey used to create and sign server's certificates. This is a mandatory\nsetting when the dynamic generation of certificates is enabled. See\n'generate-certificates' for details.\n\n```\n\n**[ca-sign-pass](#5.1-ca-sign-pass)**<passphrase>```\nThis setting is only available when support for OpenSSL was built in. It is\nthe CA private key passphrase. This setting is optional and used only when\nthe dynamic generation of certificates is enabled. See\n'generate-certificates' for details.\n\n```\n\n**[ca-verify-file](#5.1-ca-verify-file)**<cafile>```\nThis setting designates a PEM file from which to load CA certificates used to\nverify client's certificate. It designates CA certificates which must not be\nincluded in CA names sent in server hello message. Typically, \"ca-fileThis keyword is available in sections :Bind optionsServer and default-server options\" must\nbe defined with intermediate certificates, and \"ca-verify-file\" with\ncertificates to ending the chain, like root CA.\n\n```\n\n**[ciphers](#5.1-ciphers)**<ciphers>```\nThis setting is only available when support for OpenSSL was built in. It sets\nthe string describing the list of cipher algorithms (\"cipher suite\") that are\nnegotiated during the SSL/TLS handshake up to TLSv1.2. The format of the\nstring is defined in \"man 1 ciphers\" from OpenSSL man pages. For background\ninformation and recommendations see e.g.\n(https://wiki.mozilla.org/Security/Server_Side_TLS) and\n(https://mozilla.github.io/server-side-tls/ssl-config-generator/). For TLSv1.3\ncipher configuration, please check the \"ciphersuitesThis keyword is available in sections :Bind optionsServer and default-server options\" keyword.\n\n```\n\n**[ciphersuites](#5.1-ciphersuites)**<ciphersuites>```\nThis setting is only available when support for OpenSSL was built in and\nOpenSSL 1.1.1 or later was used to build HAProxy. It sets the string describing\nthe list of cipher algorithms (\"cipher suite\") that are negotiated during the\nTLSv1.3 handshake. The format of the string is defined in \"man 1 ciphers\" from\nOpenSSL man pages under the \"ciphersuitesThis keyword is available in sections :Bind optionsServer and default-server options\" section. For cipher configuration\nfor TLSv1.2 and earlier, please check the \"ciphersThis keyword is available in sections :Bind optionsServer and default-server options\" keyword.\nThis setting might accept TLSv1.2 ciphersuites however this is an\nundocumented behavior and not recommended as it could be inconsistent or buggy.\nThe default TLSv1.3 ciphersuites of OpenSSL are:\n\"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256\"\n\nTLSv1.3 only supports 5 ciphersuites:\n\n- TLS_AES_128_GCM_SHA256\n- TLS_AES_256_GCM_SHA384\n- TLS_CHACHA20_POLY1305_SHA256\n- TLS_AES_128_CCM_SHA256\n- TLS_AES_128_CCM_8_SHA256\n\n```\n\nExample:```\n\nciphers ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-GCM-SHA256\nciphersuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256\n\n```\n\n**[client-sigalgs](#5.1-client-sigalgs)**<sigalgs>```\nThis setting is only available when support for OpenSSL was built in. It sets\nthe string describing the list of signature algorithms related to client\nauthentication that are negotiated . The format of the string is defined in\n\"man 3 SSL_CTX_set1_client_sigalgs\" from the OpenSSL man pages. It is not\nrecommended to use this setting if no specific usecase was identified.\n\n```\n\n**[crl-file](#5.1-crl-file)**<crlfile>```\nThis setting is only available when support for OpenSSL was built in. It\ndesignates a PEM file from which to load certificate revocation list used\nto verify client's certificate. You need to provide a certificate revocation\nlist for every certificate of your certificate authority chain.\n\n```\n\n**[crt](#5.1-crt)**<cert>```\nThis setting is only available when support for OpenSSL was built in.\n\nHAProxy uses a cache system, the files are loaded only once in the certificate\nstorage, and each next \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\" keyword will use this cached version. When the\ncertificate was declared in a \"crt-store\", the certificate storage is\npopulated from there and don't try to load additional files by detecting file\nextensions.\n\nIt designates a PEM file containing both the required certificates and any\nassociated private keys. This file can be built by concatenating multiple\nPEM files into one (e.g. cat cert.pem key.pem > combined.pem). If your CA\nrequires an intermediate certificate, this can also be concatenated into this\nfile. Intermediate certificate can also be shared in a directory via\n\"issuers-chain-path\" directive.\n\nIf the file does not contain a private key, HAProxy will try to load\nthe key at the same path suffixed by a \".key\".\n\nIf the OpenSSL used supports Diffie-Hellman, parameters present in this file\nare loaded.\n\nIf a directory name is used instead of a PEM file, then all files found in\nthat directory will be loaded in alphabetic order unless their name ends\nwith '.key', '.issuer', '.ocsp' or '.sctl' (reserved extensions). Files\nstarting with a dot are also ignored. This directive may be specified multiple\ntimes in order to load certificates from multiple files or directories. The\ncertificates will be presented to clients who provide a valid TLS Server Name\nIndication field matching one of their CN or alt subjects. Wildcards are\nsupported, where a wildcard character '*' is used instead of the first\nhostname component (e.g. *.example.org matches www.example.org but not\nwww.sub.example.org). If an empty directory is used, HAProxy will not start\nunless the \"strict-sni\" keyword is used.\n\nIf no SNI is provided by the client or if the SSL library does not support\nTLS extensions, or if the client provides an SNI hostname which does not\nmatch any certificate, then the first loaded certificate will be presented.\nThis means that when loading certificates from a directory, it is highly\nrecommended to load the default one first as a file or to ensure that it will\nalways be the first one in the directory. In order to chose multiple default\ncertificates (1 rsa and 1 ecdsa), there are 3 options:\n- A multi-cert bundle can be configured as the first certificate\n  (`crt foobar.pem` in the configuration where the existing files\n  are `foobar.pem.ecdsa` and `foobar.pem.rsa`.\n- Or a '*' filter for each certificate in a crt-list line.\n- The 'default-crt' keyword can be used.\n\nNote that the same cert may be loaded multiple times without side effects.\n\nSome CAs (such as GoDaddy) offer a drop down list of server types that do not\ninclude HAProxy when obtaining a certificate. If this happens be sure to\nchoose a web server that the CA believes requires an intermediate CA (for\nGoDaddy, selection Apache Tomcat will get the correct bundle, but many\nothers, e.g. nginx, result in a wrong bundle that will not work for some\nclients).\n\nFor each PEM file, HAProxy checks for the presence of file at the same path\nsuffixed by \".ocsp\". If such file is found, support for the TLS Certificate\nStatus Request extension (also known as \"OCSP stapling\") is automatically\nenabled. The content of this file is optional. If not empty, it must contain\na valid OCSP Response in DER format. In order to be valid an OCSP Response\nmust comply with the following rules: it has to indicate a good status,\nit has to be a single response for the certificate of the PEM file, and it\nhas to be valid at the moment of addition. If these rules are not respected\nthe OCSP Response is ignored and a warning is emitted. In order to  identify\nwhich certificate an OCSP Response applies to, the issuer's certificate is\nnecessary. If the issuer's certificate is not found in the PEM file, it will\nbe loaded from a file at the same path as the PEM file suffixed by \".issuer\"\nif it exists otherwise it will fail with an error.\n\nFor each PEM file, HAProxy also checks for the presence of file at the same\npath suffixed by \".sctl\". If such file is found, support for Certificate\nTransparency (RFC6962) TLS extension is enabled. The file must contain a\nvalid Signed Certificate Timestamp List, as described in RFC. File is parsed\nto check basic syntax, but no signatures are verified.\n\nThere are cases where it is desirable to support multiple key types, e.g. RSA\nand ECDSA in the cipher suites offered to the clients. This allows clients\nthat support EC certificates to be able to use EC ciphers, while\nsimultaneously supporting older, RSA only clients.\n\nTo achieve this, OpenSSL 1.1.1 is required, you can configure this behavior\nby providing one crt entry per certificate type, or by configuring a \"cert\nbundle\" like it was required before HAProxy 1.8. See \"ssl-load-extra-files\".\n\n```\n\n**[crt-ignore-err](#5.1-crt-ignore-err)**<errors>```\nThis setting is only available when support for OpenSSL was built in. Sets a\ncomma separated list of errorIDs to ignore during verify at depth == 0.\nIt could be a numerical ID, or the constant name (X509_V_ERR) which is\navailable in the OpenSSL documentation:\nhttps://www.openssl.org/docs/manmaster/man3/X509_STORE_CTX_get_error.html#ERROR-CODES\nIt is recommended to use the constant name as the numerical value can change\nin new version of OpenSSL.\nIf set to 'all', all errors are ignored. SSL handshake is not aborted if an\nerror is ignored.\n\n```\n\n**[crt-list](#5.1-crt-list)**<file>```\nThis setting is only available when support for OpenSSL was built in. It\ndesignates a list of PEM file with an optional ssl configuration and a SNI\nfilter per certificate, with the following format for each line :\n\n      <crtfile> [\\[<sslbindconf> ...\\]] [[!]<snifilter> ...]\n\nEmpty lines as well as lines beginning with a hash ('#') will be ignored.\n\nThe crt-list can be manipulated dynamically over the stats socket. (See \"add\nssl crt-list\", \"del ssl crt-list\", \"show ssl crt-list\" in the management\nguide).\n\ncrt-list are usually dedicated files, however a directory loaded with the \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\"\ndirective is represented internally as a crt-list. The \"ssl-f-use\" directive\nin a frontend also declares a crt-list linked to this frontend.\n\ncrtfile:\n\n  This is the filename of the certificate, or an identifier if it was declared\n  elsewhere (over the CLI or in a crt-store with an alias for example).\n\n  It is possible to use the same <crtfile> on multiple lines with different\n  options and filters.\n\n  Multi-cert bundling (see \"ssl-load-extra-files\") is supported in a\n  crt-list, as long as only the base name is given in <crtfile>. HAProxy\n  will duplicate the crt-list line internally, adding an algorithm extension\n  (.rsa, .ecdsa, .dsa) when loading the file.\n\nsslbindconf:\n\n   <sslbindconf> supports the following keywords from the bind line (see\n   Section 5.1. Bind options):\n\n   - allow-0rtt\n   - alpn\n   - ca-file\n   - ca-verify-file\n   - ciphers\n   - ciphersuites\n   - client-sigalgs\n   - crl-file\n   - curves\n   - ecdhe\n   - no-alpn\n   - no-ca-names\n   - npn\n   - sigalgs\n   - ssl-min-ver\n   - ssl-max-ver\n   - verify\n\n   <sslbindconf> also supports the following keywords from the crt-store load\n   keyword (see Section 12.7.1. Load options):\n\n   - crt\n   - key\n   - ocsp\n   - issuer\n   - sctl\n   - ocsp-update\n\n  Parameters from the bind line are inherited in <sslbindconf>, if none were\n  specified, the default options are inherited, the parameters specified in\n  <sslbindconf> overwrite those inherited settings.\n\nsnifilter:\n\n  When the <snifilter> parameter is used on a crt-list line, the CN and SAN\n  are not used anymore to select the certificate on this line during the\n  handshake but the <snifilter> is used instead.\n\n  <snifilter> is a list of entries separated by spaces. This list can contain\n  domains, or wildcards. The wildcards are in wildcard DNS format, using a\n  single asterisk as the first character of the entry. It is possible to\n  exclude a domain from a wildcard with a negative filter by specifying a '!'\n  in front of a single domain. Having a ! in front of a * is ignored. Having\n  negative filters without a wildcard on the same line is not supported as\n  well. The special entry '*' is used to specify default certificates, which\n  are used as fallback when no domain matched.\n\n  The certificates will be presented to clients who provide a valid TLS\n  Server Name Indication field matching one of the SNI filters, or the CN and\n  SAN of a <crtfile>. The matching algorithm first looks for a positive domain\n  entry in the list, if not found it will try to look for a wildcard in the\n  list. If a wilcard match, haproxy checks for a negative filter from the\n  same line and unmatch if necessary. In case of multiple key algorithms\n  (RSA,ECDSA,DSA), HAProxy will try to match one certificate per type and\n  chose the right one depending on what is supported by the client.\n\n  If no SNI is presented by the client or if no certificate matched, this\n  will fallback to one of the default certificate. To disable the default\n  certificate fallback, the 'strict-sni' option may be used.\n  When multiple default certificates are defined, HAProxy is able to chose\n  the right ECDSA or RSA one depending on what the client supports.\n\n  The first declared certificate of a bind line is used as a default\n  certificate, either from crt or crt-list option.\n  It is also possible to declare a '*' filter, which will add this\n  certificate to the list of default certificates. To clarify the\n  configuration, the default certificates could be explicited (with a '*'\n  filter) at the beginning of the list, so an implicit default is not added\n  before.\n  Due to multi-cert bundles being duplicated for each algorithm in the\n  crt-list, only one algorithm will occupy the first line in the crt-list and\n  be considered as default. Either specify the entire bundle as default by\n  declaring '*' as the filter or setting it on the bind line.\n\n  The \"show ssl sni\" command on the stats socket could be used to debug your\n  configuration. (See \"show ssl sni\" in the management guide)\n\n```\n\nExample:```\n\n# comment\ndefault.pem.rsa *\ndefault.pem.ecdsa *\ncert2.pem [alpn h2,http/1.1]\ncertW.pem *.domain.tld !secure.domain.tld\ncertS.pem [curves X25519:P-256 ciphers ECDHE-ECDSA-AES256-GCM-SHA384] secure.domain.tld\nfoo.crt [key bar.pem ocsp foo.ocsp ocsp-update on] foo.bar.com\n\n```\n\n**[default-crt](#5.1-default-crt)**<cert>```\nThis option does the same as the \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\" option, with the difference that this\ncertificate will be used as a default one as well. It is possible to add\nmultiple default certificates to have an ECDSA and an RSA one, having more is\nnot really useful.\n\nThis option does not disable implicit default certificates, if a 'crt'\ncertificate is declared first before any 'default-crt' or other 'crt' it will\nstill be used as a default certificate.\n\nA default certificate is used when no \"strict-sni\" option is used on the bind\nline. A default certificate is provided when the servername extension was not\nused by the client, or when the servername does not match any configured\ncertificate.\n\n```\n\nExample:```\n\n# this bind line has 2 default certificates\nbind *:443 default-crt foobar.pem.rsa default-crt foobar.pem.ecdsa crt website.pem.rsa\n\n# this bind line has 3 default certificates\nbind *:443 crt website.pem.rsa default-crt foobar.pem.rsa default-crt foobar.pem.ecdsa\n\n```\n\n```\nSee also the \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\" keyword.\n\n```\n\n**[curves](#5.1-curves)**<curves>```\nThis setting is only available when support for OpenSSL was built in. It sets\nthe string describing the list of elliptic curves algorithms (\"curve suite\")\nthat are negotiated during the SSL/TLS handshake with ECDHE. The format of the\nstring is a colon-delimited list of curve name.\n\n```\n\nExample:```\n\n\"X25519:P-256\" (without quote)When \"curvesThis keyword is available in sections :ACMEBind optionsServer and default-server options\" is set, \"ecdhe\" parameter is ignored.\n\n```\n\n**[defer-accept](#5.1-defer-accept)**```\nIs an optional keyword which is supported only on certain Linux kernels. It\nstates that a connection will only be accepted once some data arrive on it,\nor at worst after the first retransmit. This should be used only on protocols\nfor which the client talks first (e.g. HTTP). It can slightly improve\nperformance by ensuring that most of the request is already available when\nthe connection is accepted. On the other hand, it will not be able to detect\nconnections which don't talk. It is important to note that this option is\nbroken in all kernels up to 2.6.31, as the connection is never accepted until\nthe client talks. This can cause issues with front firewalls which would see\nan established connection while the proxy will only see it in SYN_RECV. This\noption is only supported on TCPv4/TCPv6 sockets and ignored by other ones.\n\n```\n\n**[ecdhe](#5.1-ecdhe)**<named curve>```\nThis setting is only available when support for OpenSSL was built in. It sets\nthe named curve (RFC 4492) used to generate ECDH ephemeral keys. By default,\nused named curve is prime256v1.\n\n```\n\n**[expose-fd listeners](#5.1-expose-fd%20listeners)**```\nThis option is only usable with the stats socket. It gives your stats socket\nthe capability to pass listeners FD to another HAProxy process.\nIn master-worker mode, this is not required anymore, the listeners will be\npassed using the internal socketpairs between the master and the workers.\nSee also \"-x\" in the management guide.\n\n```\n\n**[force-sslv3](#5.1-force-sslv3)**```\nThis option enforces use of SSLv3 only on SSL connections instantiated from\nthis listener. SSLv3 is generally less expensive than the TLS counterparts\nfor high connection rates. This option is also available on global statement\n\"ssl-default-bind-options\". See also \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\".\n\n```\n\n**[force-tlsv10](#5.1-force-tlsv10)**```\nThis option enforces use of TLSv1.0 only on SSL connections instantiated from\nthis listener. This option is also available on global statement\n\"ssl-default-bind-options\". See also \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\".\n\n```\n\n**[force-tlsv11](#5.1-force-tlsv11)**```\nThis option enforces use of TLSv1.1 only on SSL connections instantiated from\nthis listener. This option is also available on global statement\n\"ssl-default-bind-options\". See also \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\".\n\n```\n\n**[force-tlsv12](#5.1-force-tlsv12)**```\nThis option enforces use of TLSv1.2 only on SSL connections instantiated from\nthis listener. This option is also available on global statement\n\"ssl-default-bind-options\". See also \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\".\n\n```\n\n**[force-tlsv13](#5.1-force-tlsv13)**```\nThis option enforces use of TLSv1.3 only on SSL connections instantiated from\nthis listener. This option is also available on global statement\n\"ssl-default-bind-options\". See also \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\".\n\n```\n\n**[generate-certificates](#5.1-generate-certificates)**```\nThis setting is only available when support for OpenSSL was built in. It\nenables the dynamic SSL certificates generation. A CA certificate and its\nprivate key are necessary (see 'ca-sign-file'). When HAProxy is configured as\na transparent forward proxy, SSL requests generate errors because of a common\nname mismatch on the certificate presented to the client. With this option\nenabled, HAProxy will try to forge a certificate using the SNI hostname\nindicated by the client. This is done only if no certificate matches the SNI\nhostname (see 'crt-list'). If an error occurs, the default certificate is\nused, else the 'strict-sni' option is set.\nIt can also be used when HAProxy is configured as a reverse proxy to ease the\ndeployment of an architecture with many backends.\n\nCreating a SSL certificate is an expensive operation, so a LRU cache is used\nto store forged certificates (see 'tune.ssl.ssl-ctx-cache-size'). It\nincreases the HAProxy's memory footprint to reduce latency when the same\ncertificate is used many times.\n\n```\n\n**[gid](#5.1-gid)**<gid>```\nSets the group of the UNIX sockets to the designated system gid. It can also\nbe set by default in the global section's \"unix-bind\" statement. Note that\nsome platforms simply ignore this. This setting is equivalent to the \"groupThis keyword is available in sections :UserlistsPrograms (deprecated)Process management and securityBind options\"\nsetting except that the group ID is used instead of its name. This setting is\nignored by non UNIX sockets.\n\n```\n\n**[group](#5.1-group)**<group>```\nSets the group of the UNIX sockets to the designated system group. It can\nalso be set by default in the global section's \"unix-bind\" statement. Note\nthat some platforms simply ignore this. This setting is equivalent to the\n\"gidThis keyword is available in sections :Process management and securityBind options\" setting except that the group name is used instead of its gid. This\nsetting is ignored by non UNIX sockets.\n\n```\n\n**[guid-prefix](#5.1-guid-prefix)**<string>```\nGenerate case-sensitive global unique IDs for each listening sockets\nallocated on this bind line. Prefix will be concatenated to listeners\nposition index on the current bind line, with character '-' as separator. See\n\"guidThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\" proxy keyword description for more information on its format.\n\n```\n\n**[id](#5.1-id)**<id>```\nFixes the socket ID. By default, socket IDs are automatically assigned, but\nsometimes it is more convenient to fix them to ease monitoring. This value\nmust be strictly positive and unique within the listener/frontend. This\noption can only be used when defining only a single socket.\n\n```\n\n**[idle-ping](#5.1-idle-ping)**<delay>```\nMay be used in the following contexts: tcp, http, log\n\nDefine an interval for periodic liveliness on idle frontend connections. If\nthe peer is unable to respond before the next scheduled test, the connection\nis closed. Else, the client timeout is refreshed and the connection is kept.\nNote that http-request/http-keep-alive timers run in parallel and are not\nrefreshed by idle-ping.\n\nThis feature relies on specific underlying protocol support. For now, only H2\nmux implements it. Idle-ping is simply ignored by other protocols.\n\nThis option is particularly useful when using reverse HTTP. Setting it on the\nbind line is useful for the peer which is responsible to actively initiate\nconnections and will then receive incoming traffic through them.\n\n```\n\n**[interface](#5.1-interface)**<interface>```\nRestricts the socket to a specific interface. When specified, only packets\nreceived from that particular interface are processed by the socket. This is\ncurrently only supported on Linux. The interface must be a primary system\ninterface, not an aliased interface. It is also possible to bind multiple\nfrontends to the same address if they are bound to different interfaces. Note\nthat binding to a network interface requires root privileges. This parameter\nis only compatible with TCPv4/TCPv6 sockets. When specified, return traffic\nuses the same interface as inbound traffic, and its associated routing table,\neven if there are explicit routes through different interfaces configured.\nThis can prove useful to address asymmetric routing issues when the same\nclient IP addresses need to be able to reach frontends hosted on different\ninterfaces.\n\n```\n\n**[label](#5.1-label)**<label>```\nSets an optional label for these sockets. It could be used group sockets by\nlabel, independently of where the bind lines were declared.\n\n```\n\n**[level](#5.1-level)**<level>```\nThis setting is used with the stats sockets only to restrict the nature of\nthe commands that can be issued on the socket. It is ignored by other\nsockets. <level> can be one of :\n- \"userThis keyword is available in sections :UserlistsPrograms (deprecated)Process management and securityBind options\" is the least privileged level; only non-sensitive stats can be\n  read, and no change is allowed. It would make sense on systems where it\n  is not easy to restrict access to the socket.\n- \"operator\" is the default level and fits most common uses. All data can\n  be read, and only non-sensitive changes are permitted (e.g. clear max\n  counters).\n- \"admin\" should be used with care, as everything is permitted (e.g. clear\n  all counters).\n\n```\n\n**[maxconn](#5.1-maxconn)**<maxconn>```\nLimits the sockets to this number of concurrent connections. Extraneous\nconnections will remain in the system's backlog until a connection is\nreleased. If unspecified, the limit will be the same as the frontend's\nmaxconn. Note that in case of port ranges or multiple addresses, the same\nvalue will be applied to each socket. This setting enables different\nlimitations on expensive sockets, for instance SSL entries which may easily\neat all memory.\n\n```\n\n**[mode](#5.1-mode)**<mode>```\nSets the octal mode used to define access permissions on the UNIX socket. It\ncan also be set by default in the global section's \"unix-bind\" statement.\nNote that some platforms simply ignore this. This setting is ignored by non\nUNIX sockets.\n\n```\n\n**[mss](#5.1-mss)**<maxseg>```\nSets the TCP Maximum Segment Size (MSS) value to be advertised on incoming\nconnections. This can be used to force a lower MSS for certain specific\nports, for instance for connections passing through a VPN. Note that this\nrelies on a kernel feature which is theoretically supported under Linux but\nwas buggy in all versions prior to 2.6.28. It may or may not work on other\noperating systems. It may also not change the advertised value but change the\neffective size of outgoing segments. The commonly advertised value for TCPv4\nover Ethernet networks is 1460 = 1500(MTU) - 40(IP+TCP). If this value is\npositive, it will be used as the advertised MSS. If it is negative, it will\nindicate by how much to reduce the incoming connection's advertised MSS for\noutgoing segments. This parameter is only compatible with TCP v4/v6 sockets.\n\n```\n\n**[name](#5.1-name)**<name>```\nSets an optional name for these sockets, which will be reported on the stats\npage.\n\n```\n\n**[namespace](#5.1-namespace)**<name>```\nOn Linux, it is possible to specify which network namespace a socket will\nbelong to. This directive makes it possible to explicitly bind a listener to\na namespace different from the default one. Please refer to your operating\nsystem's documentation to find more details about network namespaces.\n\n```\n\n**[nbconn](#5.1-nbconn)**<nbconn>[ EXPERIMENTAL ]```\nThis setting is only valid for listener instances which uses reverse HTTP.\nThis will define the count of connections which will be mounted in parallel.\nIf not specified, a default value of 1 is used.\n\nReverse HTTP is currently still in active development. Configuration\nmechanism may change in the future. For this reason it is internally marked\nas expirmental, meaning that \"expose-experimental-directives\" must appear on\na line before this directive.\n\n```\n\n**[nice](#5.1-nice)**<nice>```\nSets the 'niceness' of connections initiated from the socket. Value must be\nin the range -1024..1024 inclusive, and defaults to zero. Positive values\nmeans that such connections are more friendly to others and easily offer\ntheir place in the scheduler. On the opposite, negative values mean that\nconnections want to run with a higher priority than others. The difference\nonly happens under high loads when the system is close to saturation.\nNegative values are appropriate for low-latency or administration services,\nand high values are generally recommended for CPU intensive tasks such as SSL\nprocessing or bulk transfers which are less sensible to latency. For example,\nit may make sense to use a positive value for an SMTP socket and a negative\none for an RDP socket.\n\n```\n\n**[no-alpn](#5.1-no-alpn)**```\nDisables ALPN processing (technically speaking this sets the ALPN string to\nan empty string that will not be advertised). It permits to cancel a previous\noccurrence of an \"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" setting and to disable application protocol\nnegotiation. It may also be used to prevent a listener from negotiating ALPN\nwith a client on an HTTPS or QUIC listener; by default, HTTPS listeners will\nadvertise \"h2,http/1.1\" and QUIC listeners will advertise \"h3\". See also\n\"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" bove. Note that when using \"crt-list\", a certificate may override the\n\"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" setting and re-enable its processing.\n\n```\n\n**[no-ca-names](#5.1-no-ca-names)**```\nThis setting is only available when support for OpenSSL was built in. It\nprevents from send CA names in server hello message when ca-file is used.\nUse \"ca-verify-file\" instead of \"ca-fileThis keyword is available in sections :Bind optionsServer and default-server options\" with \"no-ca-names\".\n\n```\n\n**[no-sslv3](#5.1-no-sslv3)**```\nThis setting is only available when support for OpenSSL was built in. It\ndisables support for SSLv3 on any sockets instantiated from the listener when\nSSL is supported. Note that SSLv2 is forced disabled in the code and cannot\nbe enabled using any configuration option. This option is also available on\nglobal statement \"ssl-default-bind-options\". Use \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and\n\"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\" instead.\n\n```\n\n**[no-strict-sni](#5.1-no-strict-sni)**```\nThis setting is only available when support for OpenSSL was built in. It\ndisables strict-sni enforcement from a previous \"strict-sni\" directive. It\nmay be needed in order to selectively disable strict-sni usage on a \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\"\nline when it was already globally enforced via \"ssl-default-bind-options\".\nSee also the \"strict-sni\" bind option.\n\n```\n\n**[no-tls-tickets](#5.1-no-tls-tickets)**```\nThis setting is only available when support for OpenSSL was built in. It\ndisables the stateless session resumption (RFC 5077 TLS Ticket\nextension) and force to use stateful session resumption. Stateless\nsession resumption is more expensive in CPU usage. This option is also\navailable on global statement \"ssl-default-bind-options\".\nThe TLS ticket mechanism is only used up to TLS 1.2.\nForward Secrecy is compromised with TLS tickets, unless ticket keys\nare periodically rotated (via reload or by using \"tls-ticket-keys\").\n\n```\n\n**[no-tlsv10](#5.1-no-tlsv10)**```\nThis setting is only available when support for OpenSSL was built in. It\ndisables support for TLSv1.0 on any sockets instantiated from the listener\nwhen SSL is supported. Note that SSLv2 is forced disabled in the code and\ncannot be enabled using any configuration option. This option is also\navailable on global statement \"ssl-default-bind-options\". Use \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\"\nand \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\" instead.\n\n```\n\n**[no-tlsv11](#5.1-no-tlsv11)**```\nThis setting is only available when support for OpenSSL was built in. It\ndisables support for TLSv1.1 on any sockets instantiated from the listener\nwhen SSL is supported. Note that SSLv2 is forced disabled in the code and\ncannot be enabled using any configuration option. This option is also\navailable on global statement \"ssl-default-bind-options\". Use \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\"\nand \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\" instead.\n\n```\n\n**[no-tlsv12](#5.1-no-tlsv12)**```\nThis setting is only available when support for OpenSSL was built in. It\ndisables support for TLSv1.2 on any sockets instantiated from the listener\nwhen SSL is supported. Note that SSLv2 is forced disabled in the code and\ncannot be enabled using any configuration option. This option is also\navailable on global statement \"ssl-default-bind-options\". Use \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\"\nand \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\" instead.\n\n```\n\n**[no-tlsv13](#5.1-no-tlsv13)**```\nThis setting is only available when support for OpenSSL was built in. It\ndisables support for TLSv1.3 on any sockets instantiated from the listener\nwhen SSL is supported. Note that SSLv2 is forced disabled in the code and\ncannot be enabled using any configuration option. This option is also\navailable on global statement \"ssl-default-bind-options\". Use \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\"\nand \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\" instead.\n\n```\n\n**[npn](#5.1-npn)**<protocols>```\nThis enables the NPN TLS extension and advertises the specified protocol list\nas supported on top of NPN. The protocol list consists in a comma-delimited\nlist of protocol names, for instance: \"http/1.1,http/1.0\" (without quotes).\nThis requires that the SSL library is built with support for TLS extensions\nenabled (check with haproxy -vv). Note that the NPN extension has been\nreplaced with the ALPN extension (see the \"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" keyword), though this one is\nonly available starting with OpenSSL 1.0.2. If HTTP/2 is desired on an older\nversion of OpenSSL, NPN might still be used as most clients still support it\nat the time of writing this. It is possible to enable both NPN and ALPN\nthough it probably doesn't make any sense out of testing.\n\n```\n\n**[prefer-client-ciphers](#5.1-prefer-client-ciphers)**```\nUse the client's preference when selecting the cipher suite, by default\nthe server's preference is enforced. This option is also available on\nglobal statement \"ssl-default-bind-options\".\n\nNote that with OpenSSL >= 1.1.1 ChaCha20-Poly1305 is reprioritized anyway\n(without setting this option), if a ChaCha20-Poly1305 cipher is at the top of\nthe client cipher list.\n\nWhen using a dual algorithms setup (RSA + ECDSA), the selection algorithm\nwill chose between RSA and ECDSA and will always prioritize ECDSA. Once the\nright certificate is chosen, it will let the SSL library prioritize ciphers,\ncurves etc. Meaning this option can't be used to prioritize an RSA\ncertificate over an ECDSA one.\n\n```\n\n**[proto](#5.1-proto)**<name>```\nForces the multiplexer's protocol to use for the incoming connections. It\nmust be compatible with the mode of the frontend (TCP or HTTP). It must also\nbe usable on the frontend side. The list of available protocols is reported\nin haproxy -vv. The protocols properties are reported : the mode (TCP/HTTP),\nthe side (FE/BE), the mux name and its flags.\n\nSome protocols are subject to the head-of-line blocking on server side\n(flag=HOL_RISK). Finally some protocols don't support upgrades (flag=NO_UPG).\nThe HTX compatibility is also reported (flag=HTX).\n\nHere are the protocols that may be used as argument to a \"protoThis keyword is available in sections :Bind optionsServer and default-server options\" directive on\na bind line :\n\n  h2   : mode=HTTP  side=FE|BE  mux=H2    flags=HTX|HOL_RISK|NO_UPG\n  h1   : mode=HTTP  side=FE|BE  mux=H1    flags=HTX|NO_UPG\n  none : mode=TCP   side=FE|BE  mux=PASS  flags=NO_UPG\n\nIdea behind this option is to bypass the selection of the best multiplexer's\nprotocol for all connections instantiated from this listening socket. For\ninstance, it is possible to force the http/2 on clear TCP by specifying \"proto\nh2\" on the bind line.\n\n```\n\n**[quic-cc-algo](#5.1-quic-cc-algo)**{ cubic | newreno | bbr | nocc }[(<args,...>)]```\nThis is a QUIC specific setting to select the congestion control algorithm\nfor any connection attempts to the configured QUIC listeners. They are\nsimilar to those used by TCP.\n\nPacing is activated on top of the congestion algorithm to reduce loss and\nimprove throughput. It can be turned off via \"tune.quic.disable-tx-pacing\"\nglobal keyword. In most cases, pacing should remain activated, especially\nwhen using BBR as it relies on it to work as expected. Using BBR without\npacing may cause slowdowns or high loss rates during transfers.\n\nDefault value: cubic\n\nFor further customization, a list of parameters can be specified after the\nalgorithm token. It must be written between parenthesis, separated by a\ncomma. Each argument is optional and can be empty if needed. Here is the\nmandatory order of each parameters :\n- maximum window size in bytes. It must be greater than 10k and smaller than\n  4g. By default \"tune.quic.frontend.default-max-window-size\" value is used.\n\n```\n\nExample:```\n\n# newreno congestion control algorithm\nquic-cc-algo newreno\n# cubic congestion control algorithm with one megabytes as window\nquic-cc-algo cubic(1m)\n\n```\n\n```\nA special value \"nocc\" may be used to force a fixed congestion window always\nset at the maximum size. It is reserved for debugging scenarios to remove any\nside effects caused by the congestion controller. It must not be used in\nproduction as it can quickly lead to network issues such as a high loss rate.\n\n```\n\n**[quic-force-retry](#5.1-quic-force-retry)**```\nThis is a QUIC specific setting which forces the use of the QUIC Retry feature\nfor all the connection attempts to the configured QUIC listeners. It consists\nin verifying the peers are able to receive packets at the transport address\nthey used to initiate a new connection, sending them a Retry packet which\ncontains a token. This token must be sent back to the Retry packet sender,\nthis latter being the only one to be able to validate the token. Note that QUIC\nRetry will always be used even if a Retry threshold was set (see\n\"tune.quic.retry-threshold\" setting).\n\nThis setting requires the cluster secret to be set or else an error will be\nreported on startup (see \"cluster-secret\").\n\nSee https://www.rfc-editor.org/rfc/rfc9000.html#section-8.1.2 for more\ninformation about QUIC retry.\n\n```\n\n**[quic-socket](#5.1-quic-socket)**[ connection | listener ]```\nThis QUIC specific setting allows to define the socket allocation mode for\nthe specific listeners. See \"tune.quic.socket-owner\" for a full description\nof its usage.\n\n```\n\n**[severity-output](#5.1-severity-output)**<format>```\nThis setting is used with the stats sockets only to configure severity\nlevel output prepended to informational feedback messages. Severity\nlevel of messages can range between 0 and 7, conforming to syslog\nrfc5424. Valid and successful socket commands requesting data\n(i.e. \"show map\", \"get acl foo\" etc.) will never have a severity level\nprepended. It is ignored by other sockets. <format> can be one of :\n- \"none\" (default) no severity level is prepended to feedback messages.\n- \"number\" severity level is prepended as a number.\n- \"string\" severity level is prepended as a string following the\n  rfc5424 convention.\n\n```\n\n**[shards](#5.1-shards)**{<number>| by-thread | by-group }```\nIn multi-threaded mode, on operating systems supporting multiple listeners on\nthe same IP:port, this will automatically create this number of multiple\nidentical listeners for the same line, all bound to a fair share of the number\nof the threads attached to this listener. This can sometimes be useful when\nusing very large thread counts where the in-kernel locking on a single socket\nstarts to cause a significant overhead. In this case the incoming traffic is\ndistributed over multiple sockets and the contention is reduced. Note that\ndoing this can easily increase the CPU usage by making more threads work a\nlittle bit.\n\nIf the number of shards is higher than the number of available threads, it\nwill automatically be trimmed to the number of threads (i.e. one shard per\nthread). The special \"by-thread\" value also creates as many shards as there\nare threads on the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line. Since the system will evenly distribute the\nincoming traffic between all these shards, it is important that this number\nis an integral divisor of the number of threads. Alternately, the other\nspecial value \"by-group\" will create one shard per thread group. This can\nbe useful when dealing with many threads and not wanting to create too many\nsockets. The load distribution will be a bit less optimal but the contention\n(especially in the system) will still be lower than with a single socket.\n\nOn operating systems that do not support multiple sockets bound to the same\naddress, \"by-thread\" and \"by-group\" will automatically fall back to a single\nshard. For \"by-group\" this is done without any warning since it doesn't\nchange anything for a single group, and will result in sockets being\nduplicated for each group anyway. However, for \"by-thread\", a diagnostic\nwarning will be emitted if this happens since the resulting number of\nlisteners will not be the expected one.\n\n```\n\n**[sigalgs](#5.1-sigalgs)**<sigalgs>```\nThis setting is only available when support for OpenSSL was built in. It sets\nthe string describing the list of signature algorithms that are negotiated\nduring the TLSv1.2 and TLSv1.3 handshake. The format of the string is defined\nin \"man 3 SSL_CTX_set1_sigalgs\" from the OpenSSL man pages. It is not\nrecommended to use this setting unless compatibility with a middlebox is\nrequired.\n\n```\n\n**[ssl](#5.1-ssl)**```\nThis setting is only available when support for OpenSSL was built in. It\nenables SSL deciphering on connections instantiated from this listener. A\ncertificate is necessary (see \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\" above). All contents in the buffers will\nappear in clear text, so that ACLs and HTTP processing will only have access\nto deciphered contents. SSLv3 is disabled per default, use \"ssl-min-ver SSLv3\"\nto enable it.\n\n```\n\n**[ssl-max-ver](#5.1-ssl-max-ver)**[ SSLv3 | TLSv1.0 | TLSv1.1 | TLSv1.2 | TLSv1.3 ]```\nThis option enforces use of <version> or lower on SSL connections instantiated\nfrom this listener. Using this setting without \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" can be\nambiguous because the default ssl-min-ver value could change in future HAProxy\nversions. This option is also available on global statement\n\"ssl-default-bind-options\". See also \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\".\n\n```\n\n**[ssl-min-ver](#5.1-ssl-min-ver)**[ SSLv3 | TLSv1.0 | TLSv1.1 | TLSv1.2 | TLSv1.3 ]```\nThis option enforces use of <version> or upper on SSL connections\ninstantiated from this listener. The default value is \"TLSv1.2\". This option\nis also available on global statement \"ssl-default-bind-options\".\nSee also \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\".\n\n```\n\n**[strict-sni](#5.1-strict-sni)**```\nThis setting is only available when support for OpenSSL was built in. The\nSSL/TLS negotiation is allowed only if the client provided an SNI that matches\na certificate. The default certificate is not used. This option also allows\nstarting without any certificate on a bind line, so an empty directory could\nbe used and filled later from the stats socket. This option is also available\non global statement \"ssl-default-bind-options\", and may be selectively\ndisabled on a \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line using \"no-strict-sni\". See the \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\" option for\nmore information. See \"add ssl crt-list\" command in the management guide.\n\n```\n\n**[tcp-ut](#5.1-tcp-ut)**<delay>```\nSets the TCP User Timeout for all incoming connections instantiated from this\nlistening socket. This option is available on Linux since version 2.6.37. It\nallows HAProxy to configure a timeout for sockets which contain data not\nreceiving an acknowledgment for the configured delay. This is especially\nuseful on long-lived connections experiencing long idle periods such as\nremote terminals or database connection pools, where the client and server\ntimeouts must remain high to allow a long period of idle, but where it is\nimportant to detect that the client has disappeared in order to release all\nresources associated with its connection (and the server's session). The\nargument is a delay expressed in milliseconds by default. This only works\nfor regular TCP connections, and is ignored for other protocols.\n\n```\n\n**[tfo](#5.1-tfo)**```\nIs an optional keyword which is supported only on Linux kernels >= 3.7. It\nenables TCP Fast Open on the listening socket, which means that clients which\nsupport this feature will be able to send a request and receive a response\nduring the 3-way handshake starting from second connection, thus saving one\nround-trip after the first connection. This only makes sense with protocols\nthat use high connection rates and where each round trip matters. This can\npossibly cause issues with many firewalls which do not accept data on SYN\npackets, so this option should only be enabled once well tested. This option\nis only supported on TCPv4/TCPv6 sockets and ignored by other ones. You may\nneed to build HAProxy with USE_TFO=1 if your libc doesn't define\nTCP_FASTOPEN.\n\n```\n\n**[thread](#5.1-thread)**[<thread-group>/]<thread-set>[,...]```\nThis restricts the list of threads on which this listener is allowed to run.\nIt does not enforce any of them but eliminates those which do not match. It\nlimits the threads allowed to process incoming connections for this listener.\n\nThere are two numbering schemes. By default, thread numbers are absolute in\nthe process, comprised between 1 and the value specified in global.nbthread.\nIt is also possible to designate a thread number using its relative number\ninside its thread group, by specifying the thread group number first, then a\nslash ('/') and the relative thread number(s). In this case thread numbers\nalso start at 1 and end at 32 or 64 depending on the platform. When absolute\nthread numbers are specified, they will be automatically translated to\nrelative numbers once thread groups are known. Usually, absolute numbers are\npreferred for simple configurations, and relative ones are preferred for\ncomplex configurations where CPU arrangement matters for performance.\n\nAfter the optional thread group number, the \"thread-set\" specification must\nuse the following format:\n\n    \"all\" | \"odd\" | \"even\" | [number][-[number]]\n\nAs their names imply, \"all\" validates all threads within the set (either all\nof the group's when a group is specified, or all of the process' threads),\n\"odd\" validates all odd-numberred threads (every other thread starting at 1)\neither for the process or the group, and \"even\" validates all even-numberred\nthreads (every other thread starting at 2). If instead thread number ranges\nare used, then all threads included in the range from the first to the last\nthread number are validated. The numbers are either relative to the group\nor absolute depending on the presence of a thread group number. If the first\nthread number is omitted, \"1\" is used, representing either the first thread\nof the group or the first thread of the process. If the last thread number is\nomitted, either the last thread number of the group (32 or 64) is used, or\nthe last thread number of the process (global.nbthread).\n\nThese ranges may be repeated and delimited by a comma, so that non-contiguous\nthread sets can be specified, and the group, if present, must be specified\nagain for each new range. Note that it is not permitted to mix group-relative\nand absolute specifications because the whole \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line must use either\nan absolute notation or a relative one, as those not set will be resolved at\nthe end of the parsing.\n\nIt is important to know that each listener described by a \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line creates\nat least one socket represented by at least one file descriptor. Since file\ndescriptors cannot span multiple thread groups, if a \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line specifies a\nthread range that covers more than one group, several file descriptors will\nautomatically be created so that there is at least one per group. Technically\nspeaking they all refer to the same socket in the kernel, but they will get a\ndistinct identifier in haproxy and will even have a dedicated stats entry if\n\"option socket-stats\" is used.\n\nThe main purpose is to have multiple bind lines sharing the same IP:port but\nnot the same thread in a listener, so that the system can distribute the\nincoming connections into multiple queues, bypassing haproxy's internal queue\nload balancing. Currently Linux 3.9 and above is known for supporting this.\nSee also the \"shardsThis keyword is available in sections :Peers declarationBind options\" keyword above that automates duplication of \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\"\nlines and their assignment to multiple groups of threads.\n\nThis keyword is compatible with reverse HTTP binds. However, it is forbidden\nto specify a thread set which spans across several thread groups for such a\nlistener as this may caused \"nbconn\" to not work as intended.\n\n```\n\n**[tls-tickets](#5.1-tls-tickets)**```\nThis setting is only available when support for OpenSSL was built in. It\nenables the stateless session resumption (RFC 5077 TLS Ticket extension). It\nis the default, but it may be needed to selectively re-enable the feature on\na \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line if it had been globaly disabled via \"no-tls-ticketsThis keyword is available in sections :Bind optionsServer and default-server options\" mentioned\nin \"ssl-default-bind-options\". See also the \"no-tls-ticketsThis keyword is available in sections :Bind optionsServer and default-server options\" bind keyword.\n\n```\n\n**[tls-ticket-keys](#5.1-tls-ticket-keys)**<keyfile>```\nSets the TLS ticket keys file to load the keys from. The keys need to be 48\nor 80 bytes long, depending if aes128 or aes256 is used, encoded with base64\nwith one line per key (ex. openssl rand 80 | openssl base64 -A | xargs echo).\nThe first key determines the key length used for next keys: you can't mix\naes128 and aes256 keys. Number of keys is specified by the TLS_TICKETS_NO\nbuild option (default 3) and at least as many keys need to be present in\nthe file. Last TLS_TICKETS_NO keys will be used for decryption and the\npenultimate one for encryption. This enables easy key rotation by just\nappending new key to the file and reloading the process.  Keys must be\nperiodically rotated (ex. every 12h) or Perfect Forward Secrecy is\ncompromised. It is also a good idea to keep the keys off any permanent\nstorage such as hard drives (hint: use tmpfs and don't swap those files).\nLifetime hint can be changed using tune.ssl.timeout.\n\n```\n\n**[transparent](#5.1-transparent)**```\nIs an optional keyword which is supported only on certain Linux kernels. It\nindicates that the addresses will be bound even if they do not belong to the\nlocal machine, and that packets targeting any of these addresses will be\nintercepted just as if the addresses were locally configured. This normally\nrequires that IP forwarding is enabled. Caution! do not use this with the\ndefault address '*', as it would redirect any traffic for the specified port.\nThis keyword is available only when HAProxy is built with USE_LINUX_TPROXY=1.\nThis parameter is only compatible with TCPv4 and TCPv6 sockets, depending on\nkernel version. Some distribution kernels include backports of the feature,\nso check for support with your vendor.\n\n```\n\n**[uid](#5.1-uid)**<uid>```\nSets the owner of the UNIX sockets to the designated system uid. It can also\nbe set by default in the global section's \"unix-bind\" statement. Note that\nsome platforms simply ignore this. This setting is equivalent to the \"userThis keyword is available in sections :UserlistsPrograms (deprecated)Process management and securityBind options\"\nsetting except that the user numeric ID is used instead of its name. This\nsetting is ignored by non UNIX sockets.\n\n```\n\n**[user](#5.1-user)**<user>```\nSets the owner of the UNIX sockets to the designated system user. It can also\nbe set by default in the global section's \"unix-bind\" statement. Note that\nsome platforms simply ignore this. This setting is equivalent to the \"uidThis keyword is available in sections :Process management and securityBind options\"\nsetting except that the user name is used instead of its uid. This setting is\nignored by non UNIX sockets.\n\n```\n\n**[v4v6](#5.1-v4v6)**```\nIs an optional keyword which is supported only on most recent systems\nincluding Linux kernels >= 2.4.21. It is used to bind a socket to both IPv4\nand IPv6 when it uses the default address. Doing so is sometimes necessary\non systems which bind to IPv6 only by default. It has no effect on non-IPv6\nsockets, and is overridden by the \"v6only\" option.\n\n```\n\n**[v6only](#5.1-v6only)**```\nIs an optional keyword which is supported only on most recent systems\nincluding Linux kernels >= 2.4.21. It is used to bind a socket to IPv6 only\nwhen it uses the default address. Doing so is sometimes preferred to doing it\nsystem-wide as it is per-listener. It has no effect on non-IPv6 sockets and\nhas precedence over the \"v4v6\" option.\n\n```\n\n**[verify](#5.1-verify)**[none|optional|required]```\nThis setting is only available when support for OpenSSL was built in. If set\nto 'none', client certificate is not requested. This is the default. In other\ncases, a client certificate is requested. If the client does not provide a\ncertificate after the request and if 'verify' is set to 'required', then the\nhandshake is aborted, while it would have succeeded if set to 'optional'. The\ncertificate provided by the client is always verified using CAs from\n'ca-file' and optional CRLs from 'crl-file'. On verify failure the handshake\nis aborted, regardless of the 'verify' option, unless the error code exactly\nmatches one of those listed with 'ca-ignore-err' or 'crt-ignore-err'.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "5.2. Server and default-server options", "content": "## [5.2.](#5.2)Server and default-server options\n\n```\nThe \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" and \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" keywords support a certain number of settings\nwhich are all passed as arguments on the server line. The order in which those\narguments appear does not count, and they are all optional. Some of those\nsettings are single words (booleans) while others expect one or several values\nafter them. In this case, the values must immediately follow the setting name.\nExcept default-server, all those settings must be specified after the server's\naddress if they are used:\n\n  server <name> <address>[:port] [settings ...]\n  default-server [settings ...]\n\nNote that all these settings are supported both by \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" and \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\"\nkeywords, except \"idThis keyword is available in sections :Alphabetically sorted keywords referenceBind optionsServer and default-server options\" which is only supported by \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\".\n\nThe currently supported settings are the following ones.\n\n```\n\n**[addr](#5.2-addr)**<ipv4|ipv6>```\nMay be used in the following contexts: tcp, http, log\n\nUsing the \"addr\" parameter, it becomes possible to use a different IP address\nto send health-checks or to probe the agent-check. On some servers, it may be\ndesirable to dedicate an IP address to specific component able to perform\ncomplex tests which are more suitable to health-checks than the application.\nThis parameter is ignored if the \"check\" parameter is not set. See also the\n\"port\" parameter.\n\n```\n\n**[agent-check](#5.2-agent-check)**```\nMay be used in the following contexts: tcp, http, log\n\nEnable an auxiliary agent check which is run independently of a regular\nhealth check. An agent health check is performed by making a TCP connection\nto the port set by the \"agent-port\" parameter and reading an ASCII string\nterminated by the first '\\r' or '\\n' met. The string is made of a series of\nwords delimited by spaces, tabs or commas in any order, each consisting of :\n\n- An ASCII representation of a positive integer percentage, e.g. \"75%\".\n  Values in this format will set the weight proportional to the initial\n  weight of a server as configured when HAProxy starts. Note that a zero\n  weight is reported on the stats page as \"DRAIN\" since it has the same\n  effect on the server (it's removed from the LB farm). It is the legacy way\n  to set the weight of a server. Setting it with the \"weight:\" prefix is\n  preferred.\n\n- The string \"weight:\" following by an positive integer or a positive\n  integer percentage, with no space. If the value ends with the '%' sign,\n  then the new weight will be proportional to the initially weight of the\n  server. Otherwise, the value is considered as an absolute weight and must\n  be between 0 and 256. Servers which are part of a farm running a static\n  load-balancing algorithm have stricter limitations because the weight\n  cannot change once set. Thus for these servers, the only accepted values\n  are 0 and 100% (or 0 and the initial weight). Changes take effect\n  immediately, though certain LB algorithms require a certain amount of\n  requests to consider changes. Note that a zero weight is reported on the\n  stats page as \"DRAIN\" since it has the same effect on the server (it's\n  removed from the LB farm).\n\n- The string \"maxconn:\" followed by an integer (no space between). Values\n  in this format will set the maxconn of a server. The maximum number of\n  connections advertised needs to be multiplied by the number of load\n  balancers and different backends that use this health check to get the\n  total number of connections the server might receive. Example: maxconn:30\n\n- The word \"ready\". This will turn the server's administrative state to the\n  READY mode, thus canceling any DRAIN or MAINT state\n\n- The word \"drain\". This will turn the server's administrative state to the\n  DRAIN mode, thus it will not accept any new connections other than those\n  that are accepted via persistence.\n\n- The word \"maint\". This will turn the server's administrative state to the\n  MAINT mode, thus it will not accept any new connections at all, and health\n  checks will be stopped.\n\n- The words \"down\", \"fail\", or \"stopped\", optionally followed by a\n  description string after a sharp ('#'). All of these mark the server's\n  operating state as DOWN, but since the word itself is reported on the stats\n  page, the difference allows an administrator to know if the situation was\n  expected or not : the service may intentionally be stopped, may appear up\n  but fail some validity tests, or may be seen as down (e.g. missing process,\n  or port not responding).\n\n- The word \"up\" sets back the server's operating state as UP if health checks\n  also report that the service is accessible.\n\nParameters which are not advertised by the agent are not changed. For\nexample, an agent might be designed to monitor CPU usage and only report a\nrelative weight and never interact with the operating status. Similarly, an\nagent could be designed as an end-user interface with 3 radio buttons\nallowing an administrator to change only the administrative state. However,\nit is important to consider that only the agent may revert its own actions,\nso if a server is set to DRAIN mode or to DOWN state using the agent, the\nagent must implement the other equivalent actions to bring the service into\noperations again.\n\nFailure to connect to the agent is not considered an error as connectivity\nis tested by the regular health check which is enabled by the \"check\"\nparameter. Warning though, it is not a good idea to stop an agent after it\nreports \"down\", since only an agent reporting \"up\" will be able to turn the\nserver up again. Note that the CLI on the Unix stats socket is also able to\nforce an agent's result in order to work around a bogus agent if needed.\n\nRequires the \"agent-port\" parameter to be set. See also the \"agent-inter\"\nand \"no-agent-check\" parameters.\n\n```\n\n**[agent-send](#5.2-agent-send)**<string>```\nMay be used in the following contexts: tcp, http, log\n\nIf this option is specified, HAProxy will send the given string (verbatim)\nto the agent server upon connection. You could, for example, encode\nthe backend name into this string, which would enable your agent to send\ndifferent responses based on the backend. Make sure to include a '\\n' if\nyou want to terminate your request with a newline.\n\n```\n\n**[agent-inter](#5.2-agent-inter)**<delay>```\nMay be used in the following contexts: tcp, http, log\n\nThe \"agent-inter\" parameter sets the interval between two agent checks\nto <delay> milliseconds. If left unspecified, the delay defaults to 2000 ms.\n\nJust as with every other time-based parameter, it may be entered in any\nother explicit unit among { us, ms, s, m, h, d }. The \"agent-inter\"\nparameter also serves as a timeout for agent checks \"timeout check\" is\nnot set. In order to reduce \"resonance\" effects when multiple servers are\nhosted on the same hardware, the agent and health checks of all servers\nare started with a small time offset between them. It is also possible to\nadd some random noise in the agent and health checks interval using the\nglobal \"spread-checks\" keyword. This makes sense for instance when a lot\nof backends use the same servers.\n\nSee also the \"agent-check\" and \"agent-port\" parameters.\n\n```\n\n**[agent-addr](#5.2-agent-addr)**<addr>```\nMay be used in the following contexts: tcp, http, log\n\nThe \"agent-addr\" parameter sets address for agent check.\n\nYou can offload agent-check to another target, so you can make single place\nmanaging status and weights of servers defined in HAProxy in case you can't\nmake self-aware and self-managing services. You can specify both IP or\nhostname, it will be resolved.\n\n```\n\n**[agent-port](#5.2-agent-port)**<port>```\nMay be used in the following contexts: tcp, http, log\n\nThe \"agent-port\" parameter sets the TCP port used for agent checks.\n\nSee also the \"agent-check\" and \"agent-inter\" parameters.\n\n```\n\n**[allow-0rtt](#5.2-allow-0rtt)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nAllow sending early data to the server when using TLS 1.3.\nNote that early data will be sent only if the client used early data, or\nif the backend uses \"retry-on\" with the \"0rtt-rejected\" keyword.\n\n```\n\n**[alpn](#5.2-alpn)**<protocols>```\nMay be used in the following contexts: tcp, http\n\nThis enables the TLS ALPN extension and advertises the specified protocol\nlist as supported on top of ALPN. The protocol list consists in a comma-\ndelimited list of protocol names, for instance: \"http/1.1,http/1.0\" (without\nquotes). This requires that the SSL library is built with support for TLS\nextensions enabled (check with haproxy -vv). The ALPN extension replaces the\ninitial NPN extension. ALPN is required to connect to HTTP/2 servers.\nVersions of OpenSSL prior to 1.0.2 didn't support ALPN and only supposed the\nnow obsolete NPN extension.\nIf both HTTP/2 and HTTP/1.1 are expected to be supported, both versions can\nbe advertised, in order of preference, like below :\n\n     server 127.0.0.1:443 ssl crt pub.pem alpn h2,http/1.1\n\nSee also \"ws\" to use an alternative ALPN for websocket streams.\n\n```\n\n**[backup](#5.2-backup)**```\nMay be used in the following contexts: tcp, http, log\n\nWhen \"backup\" is present on a server line, the server is only used in load\nbalancing when all other non-backup servers are unavailable. Requests coming\nwith a persistence cookie referencing the server will always be served\nthough. By default, only the first operational backup server is used, unless\nthe \"allbackups\" option is set in the backend. See also the \"no-backup\" and\n\"allbackups\" options.\n\n```\n\n**[ca-file](#5.2-ca-file)**<cafile>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis setting is only available when support for OpenSSL was built in. It\ndesignates a PEM file from which to load CA certificates used to verify\nserver's certificate. It is possible to load a directory containing multiple\nCAs, in this case HAProxy will try to load every \".pem\", \".crt\", \".cer\", and\n.crl\" available in the directory, files starting with a dot are ignored.\n\nIn order to use the trusted CAs of your system, the \"@system-ca\" parameter\ncould be used in place of the cafile. The location of this directory could be\noverwritten by setting the SSL_CERT_DIR environment variable.\n\n```\n\n**[check](#5.2-check)**```\nMay be used in the following contexts: tcp, http, log\n\nThis option enables health checks on a server:\n  - when not set, no health checking is performed, and the server is always\n    considered available.\n  - when set and no other check method is configured, the server is considered\n    available when a connection can be established at the highest configured\n    transport layer. This means TCP by default, or SSL/TLS when \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" or\n    \"check-ssl\" are set, both possibly combined with connection prefixes such\n    as a PROXY protocol header when \"send-proxy\" or \"check-send-proxy\" are\n    set. This behavior is slightly different for dynamic servers, read the\n    following paragraphs for more details.\n  - when set and an application-level health check is defined, the\n    application-level exchanges are performed on top of the configured\n    transport layer and the server is considered available if all of the\n    exchanges succeed.\n\nBy default, health checks are performed on the same address and port as\nconfigured on the server, using the same encapsulation parameters (SSL/TLS,\nproxy-protocol header, etc... ). It is possible to change the destination\naddress using \"addr\" and the port using \"port\". When done, it is assumed the\nserver isn't checked on the service port, and configured encapsulation\nparameters are not reused. One must explicitly set \"check-send-proxy\" to send\nconnection headers, \"check-ssl\" to use SSL/TLS.\n\nNote that the implicit configuration of ssl and PROXY protocol is not\nperformed for dynamic servers. In this case, it is required to explicitly\nuse \"check-ssl\" and \"check-send-proxy\" when wanted, even if the check port is\nnot overridden.\n\nWhen \"sni\" or \"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" are set on the server line, their value is not used for\nhealth checks and one must use \"check-sni\" or \"check-alpn\".\n\nThe default source address for health check traffic is the same as the one\ndefined in the backend. It can be changed with the \"sourceThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\" keyword.\n\nThe interval between checks can be set using the \"inter\" keyword, and the\n\"rise\" and \"fall\" keywords can be used to define how many successful or\nfailed health checks are required to flag a server available or not\navailable.\n\nOptional application-level health checks can be configured with \"option\nhttpchk\", \"option mysql-check\" \"option smtpchk\", \"option pgsql-check\",\n\"option ldap-check\", or \"option redis-check\".\n\n```\n\nExample:```\n\n# simple tcp check\nbackend foo\n  server s1 192.168.0.1:80 check\n# this does a tcp connect + tls handshake\nbackend foo\n  server s1 192.168.0.1:443 ssl check\n# simple tcp check is enough for check success\nbackend foo\n  option tcp-check\n  tcp-check connect\n  server s1 192.168.0.1:443 ssl check\n\n```\n\n**[check-reuse-pool](#5.2-check-reuse-pool)**```\nMay be used in the following contexts: tcp, http\n\nThis option permits checks to reuse idle connections if available instead of\nopening a dedicated one. The connection is reinserted in the pool on check\ncompletion. The main objective is to limit the number of connections opening\nand closure on a specific server. This feature is compatible only with\nhttp-check rulesets. It is silently ignored for other check types.\n\nFor configuration simplicity, this option is silently ignored if any specific\ncheck connect option is defined, either on the server line or via a custom\ntcp-check connect rule.\n\nThis option is automatically enabled for servers acting as passive reverse\nHTTP gateway, as for those servers connect is only supported through reuse.\n\n```\n\n**See also:**\"[check-pool-conn-name](#check-pool-conn-name)\"**[check-send-proxy](#5.2-check-send-proxy)**```\nMay be used in the following contexts: tcp, http\n\nThis option forces emission of a PROXY protocol line with outgoing health\nchecks, regardless of whether the server uses send-proxy or not for the\nnormal traffic. By default, the PROXY protocol is enabled for health checks\nif it is already enabled for normal traffic and if no \"port\" nor \"addr\"\ndirective is present. However, if such a directive is present, the\n\"check-send-proxy\" option needs to be used to force the use of the\nprotocol. See also the \"send-proxy\" option for more information.\n\n```\n\n**[check-alpn](#5.2-check-alpn)**<protocols>```\nMay be used in the following contexts: tcp, http\n\nDefines which protocols to advertise with ALPN. The protocol list consists in\na comma-delimited list of protocol names, for instance: \"http/1.1,http/1.0\"\n(without quotes). If it is not set, the server ALPN is used.\n\n```\n\n**[check-pool-conn-name](#5.2-check-pool-conn-name)**<name>```\nMay be used in the following contexts: tcp, http\n\nWhen connection reuse is performed for checks, uses <name> if set as a\nconnection identifier to match a corresponding connection in the pool. This\nserves as the equivalent to the \"pool-conn-name\" server keyword. \"check-sni\"\nwill also be used as a fallback if the current option is not used.\n\n```\n\n**See also:**\"[check-reuse-pool](#check-reuse-pool)\"**[check-proto](#5.2-check-proto)**<name>```\nMay be used in the following contexts: tcp, http\n\nForces the multiplexer's protocol to use for the server's health-check\nconnections. It must be compatible with the health-check type (TCP or\nHTTP). It must also be usable on the backend side. The list of available\nprotocols is reported in haproxy -vv. The protocols properties are\nreported : the mode (TCP/HTTP), the side (FE/BE), the mux name and its flags.\n\nSome protocols are subject to the head-of-line blocking on server side\n(flag=HOL_RISK). Finally some protocols don't support upgrades (flag=NO_UPG).\nThe HTX compatibility is also reported (flag=HTX).\n\nHere are the protocols that may be used as argument to a \"check-proto\"\ndirective on a server line:\n\n  h2   : mode=HTTP  side=FE|BE  mux=H2    flags=HTX|HOL_RISK|NO_UPG\n  fcgi : mode=HTTP  side=BE     mux=FCGI  flags=HTX|HOL_RISK|NO_UPG\n  h1   : mode=HTTP  side=FE|BE  mux=H1    flags=HTX|NO_UPG\n  none : mode=TCP   side=FE|BE  mux=PASS  flags=NO_UPG\n\nIdea behind this option is to bypass the selection of the best multiplexer's\nprotocol for health-check connections established to this server.\nIf not defined, the server one will be used, if set.\n\n```\n\n**[check-sni](#5.2-check-sni)**<sni>```\nMay be used in the following contexts: tcp, http, log\n\nThis option allows you to specify the SNI to be used when doing health checks\nover SSL. It is only possible to use a string to set <sni>. If you want to\nset a SNI for proxied traffic, see \"sni\".\n\n```\n\n**[check-ssl](#5.2-check-ssl)**```\nMay be used in the following contexts: tcp, http, log\n\nThis option forces encryption of all health checks over SSL, regardless of\nwhether the server uses SSL or not for the normal traffic. This is generally\nused when an explicit \"port\" or \"addr\" directive is specified and SSL health\nchecks are not inherited. It is important to understand that this option\ninserts an SSL transport layer below the checks, so that a simple TCP connect\ncheck becomes an SSL connect, which replaces the old ssl-hello-chk. The most\ncommon use is to send HTTPS checks by combining \"httpchk\" with SSL checks.\nAll SSL settings are common to health checks and traffic (e.g. ciphers).\nSee the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option for more information and \"no-check-ssl\" to disable\nthis option.\n\n```\n\n**[check-via-socks4](#5.2-check-via-socks4)**```\nMay be used in the following contexts: tcp, http, log\n\nThis option enables outgoing health checks using upstream socks4 proxy. By\ndefault, the health checks won't go through socks tunnel even it was enabled\nfor normal traffic.\n\n```\n\n**[ciphers](#5.2-ciphers)**<ciphers>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis setting is only available when support for OpenSSL was built in. This\noption sets the string describing the list of cipher algorithms that is\nnegotiated during the SSL/TLS handshake with the server. The format of the\nstring is defined in \"man 1 ciphers\" from OpenSSL man pages. For background\ninformation and recommendations see e.g.\n(https://wiki.mozilla.org/Security/Server_Side_TLS) and\n(https://mozilla.github.io/server-side-tls/ssl-config-generator/). For TLSv1.3\ncipher configuration, please check the \"ciphersuitesThis keyword is available in sections :Bind optionsServer and default-server options\" keyword.\n\n```\n\n**[ciphersuites](#5.2-ciphersuites)**<ciphersuites>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis setting is only available when support for OpenSSL was built in and\nOpenSSL 1.1.1 or later was used to build HAProxy. This option sets the string\ndescribing the list of cipher algorithms that is negotiated during the TLS\n1.3 handshake with the server. The format of the string is defined in\n\"man 1 ciphers\" from OpenSSL man pages under the \"ciphersuitesThis keyword is available in sections :Bind optionsServer and default-server options\" section.\nFor cipher configuration for TLSv1.2 and earlier, please check the \"ciphersThis keyword is available in sections :Bind optionsServer and default-server options\"\nkeyword.\n\n```\n\n**[client-sigalgs](#5.2-client-sigalgs)**<sigalgs>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis setting is only available when support for OpenSSL was built in. It sets\nthe string describing the list of signature algorithms related to client\nauthentication that are negotiated . The format of the string is defined in\n\"man 3 SSL_CTX_set1_client_sigalgs\" from the OpenSSL man pages. It is not\nrecommended to use this setting if no specific usecase was identified.\n\n```\n\n**[cookie](#5.2-cookie)**<value>```\nMay be used in the following contexts: http\n\nThe \"cookieThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server optionsFetching HTTP samples (Layer 7)\" parameter sets the cookie value assigned to the server to\n<value>. This value will be checked in incoming requests, and the first\noperational server possessing the same value will be selected. In return, in\ncookie insertion or rewrite modes, this value will be assigned to the cookie\nsent to the client. There is nothing wrong in having several servers sharing\nthe same cookie value, and it is in fact somewhat common between normal and\nbackup servers. See also the \"cookieThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server optionsFetching HTTP samples (Layer 7)\" keyword in backend section.\n\n```\n\n**[crl-file](#5.2-crl-file)**<crlfile>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis setting is only available when support for OpenSSL was built in. It\ndesignates a PEM file from which to load certificate revocation list used\nto verify server's certificate.\n\n```\n\n**[crt](#5.2-crt)**<cert>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis setting is only available when support for OpenSSL was built in.\nIt designates a PEM file from which to load both a certificate and the\nassociated private key. This file can be built by concatenating both PEM\nfiles into one. This certificate will be sent if the server send a client\ncertificate request.\n\nIf the file does not contain a private key, HAProxy will try to load the key\nat the same path suffixed by a \".key\" (provided the \"ssl-load-extra-files\"\noption is set accordingly).\n\n```\n\n**[curves](#5.2-curves)**<curves>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis setting is only available when support for OpenSSL was built in. It sets\nthe string describing the list of elliptic curves algorithms (\"curve suite\")\nthat are negotiated during the SSL/TLS handshake with ECDHE. The format of the\nstring is a colon-delimited list of curve name.\n\n```\n\nExample:```\n\n\"X25519:P-256\" (without quote)\n```\n\n**[disabled](#5.2-disabled)**```\nMay be used in the following contexts: tcp, http, log\n\nThe \"disabledThis keyword is available in sections :Peers declarationAlphabetically sorted keywords referenceServer and default-server options\" keyword starts the server in the \"disabledThis keyword is available in sections :Peers declarationAlphabetically sorted keywords referenceServer and default-server options\" state. That means\nthat it is marked down in maintenance mode, and no connection other than the\nones allowed by persist mode will reach it. It is very well suited to setup\nnew servers, because normal traffic will never reach them, while it is still\npossible to test the service by making use of the force-persist mechanism.\nSee also \"enabledThis keyword is available in sections :Peers declarationAlphabetically sorted keywords referenceServer and default-server options\" setting.\n\n```\n\n**[enabled](#5.2-enabled)**```\nMay be used in the following contexts: tcp, http, log\n\nThis option may be used as 'server' setting to reset any 'disabled'\nsetting which would have been inherited from 'default-server' directive as\ndefault value.\nIt may also be used as 'default-server' setting to reset any previous\n'default-server' 'disabled' setting.\n\n```\n\n**[error-limit](#5.2-error-limit)**<count>```\nMay be used in the following contexts: tcp, http, log\n\nIf health observing is enabled, the \"error-limit\" parameter specifies the\nnumber of consecutive errors that triggers event selected by the \"on-error\"\noption. By default it is set to 10 consecutive errors.\n\nSee also the \"check\", \"error-limit\" and \"on-error\".\n\n```\n\n**[fall](#5.2-fall)**<count>```\nMay be used in the following contexts: tcp, http, log\n\nThe \"fall\" parameter states that a server will be considered as dead after\n<count> consecutive unsuccessful health checks. This value defaults to 3 if\nunspecified. See also the \"check\", \"inter\" and \"rise\" parameters.\n\n```\n\n**[force-sslv3](#5.2-force-sslv3)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option enforces use of SSLv3 only when SSL is used to communicate with\nthe server. SSLv3 is generally less expensive than the TLS counterparts for\nhigh connection rates. This option is also available on global statement\n\"ssl-default-server-options\". See also \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and ssl-max-ver\".\n\n```\n\n**[force-tlsv10](#5.2-force-tlsv10)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option enforces use of TLSv1.0 only when SSL is used to communicate with\nthe server. This option is also available on global statement\n\"ssl-default-server-options\". See also \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and ssl-max-ver\".\n\n```\n\n**[force-tlsv11](#5.2-force-tlsv11)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option enforces use of TLSv1.1 only when SSL is used to communicate with\nthe server. This option is also available on global statement\n\"ssl-default-server-options\". See also \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and ssl-max-ver\".\n\n```\n\n**[force-tlsv12](#5.2-force-tlsv12)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option enforces use of TLSv1.2 only when SSL is used to communicate with\nthe server. This option is also available on global statement\n\"ssl-default-server-options\". See also \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and ssl-max-ver\".\n\n```\n\n**[force-tlsv13](#5.2-force-tlsv13)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option enforces use of TLSv1.3 only when SSL is used to communicate with\nthe server. This option is also available on global statement\n\"ssl-default-server-options\". See also \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and ssl-max-ver\".\n\n```\n\n**[guid](#5.2-guid)**<string>```\nMay be used in the following contexts: tcp, http, log\n\nSpecify a case-sensitive global unique ID for this server. This must be\nunique across all haproxy configuration on every object types. See \"guidThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\"\nproxy keyword description for more information on its format.\n\n```\n\n**[hash-key](#5.2-hash-key)**<key>```\nMay be used in the following contexts: tcp, http, log\n\nSpecify how \"hash-type consistent\" node keys are computed\n\n```\n\nArguments :```\n<key>   <key> may be one of the following :\n\n  id         The node keys will be derived from the server's numeric\n             identifier as set from \"idThis keyword is available in sections :Alphabetically sorted keywords referenceBind optionsServer and default-server options\" or which defaults to its position\n             in the server list. This is the default. Note that only the 28\n             lowest bits of the ID will be used (i.e. (id % 268435456)), so\n             better only use values comprised between 1 and this value to\n             avoid overlap.\n\n  addr       The node keys will be derived from the server's address, when\n             available, or else fall back on \"idThis keyword is available in sections :Alphabetically sorted keywords referenceBind optionsServer and default-server options\".\n\n  addr-port  The node keys will be derived from the server's address and\n             port, when available, or else fall back on \"idThis keyword is available in sections :Alphabetically sorted keywords referenceBind optionsServer and default-server options\".\n```\n\n```\nThe \"addr\" and \"addr-port\" options may be useful in scenarios where multiple\nHAProxy processes are balancing traffic to the same set of servers. If the\nserver order of each process is different (because, for example, DNS records\nwere resolved in different orders) then this will allow each independent\nHAProxy processes to agree on routing decisions. Note: \"balance random\" also\nuses \"hash-type consistent\", and the quality of the distribution will depend\non the quality of the keys.\n\n```\n\n**[id](#5.2-id)**<value>```\nMay be used in the following contexts: tcp, http, log\n\nSet a persistent ID for the server. This ID must be positive and unique for\nthe proxy. An unused ID will automatically be assigned if unset. The first\nassigned value will be 1. This ID is currently only returned in statistics.\n\n```\n\n**[idle-ping](#5.2-idle-ping)**<delay>```\nMay be used in the following contexts: tcp, http, log\n\nDefine an interval for periodic liveliness on idle backend connections. If\nthe peer is unable to respond before the next scheduled test, the connection\nis closed. This keyword refers to the backend side, so it is useful to check\nthat idle connections are still usable. Note that this won't prevent the\nconnection from being destroyed on idle pool purge.\n\nThis feature relies on specific underlying protocol support. For now, only H2\nmux implements it. Idle-ping is simply ignored by other protocols.\n\nThis option is particularly useful when using reverse HTTP. Setting it on the\nserver line is useful for the peer which listen for incoming connections and\nattach them to a corresponding server to be able to reuse later on traffic\nforwarding.\n\n```\n\n**[init-addr](#5.2-init-addr)**{last | libc | none |<ip>},[...]*```\nMay be used in the following contexts: tcp, http, log\n\nIndicate in what order the server's address should be resolved upon startup\nif it uses an FQDN. Attempts are made to resolve the address by applying in\nturn each of the methods mentioned in the comma-delimited list. The first\nmethod which succeeds is used. If the end of the list is reached without\nfinding a working method, an error is thrown. Method \"last\" suggests to pick\nthe address which appears in the state file (see \"server-state-file\"). Method\n\"libc\" uses the libc's internal resolver (gethostbyname() or getaddrinfo()\ndepending on the operating system and build options). Method \"none\"\nspecifically indicates that the server should start without any valid IP\naddress in a down state. It can be useful to ignore some DNS issues upon\nstartup, waiting for the situation to get fixed later. Finally, an IP address\n(IPv4 or IPv6) may be provided. It can be the currently known address of the\nserver (e.g. filled by a configuration generator), or the address of a dummy\nserver used to catch old sessions and present them with a decent error\nmessage for example. When the \"first\" load balancing algorithm is used, this\nIP address could point to a fake server used to trigger the creation of new\ninstances on the fly. This option defaults to \"last,libc\" indicating that the\nprevious address found in the state file (if any) is used first, otherwise\nthe libc's resolver is used. This ensures continued compatibility with the\nhistoric behavior. When using internal resolvers, it is generally recommended\nto either disable libc-based resolution, or make it explicit (see section 5.3\nfor more details).\n\nExample 1:\n    defaults\n        # never fail on address resolution\n        default-server init-addr last,libc,none\n\nExample 2:\n    defaults\n        # disable libc resolution in combination with resolvers\n        default-server init-addr last,none\n\n```\n\n**[inter](#5.2-inter)**<delay>**[fastinter](#5.2-fastinter)**<delay>**[downinter](#5.2-downinter)**<delay>```\nMay be used in the following contexts: tcp, http, log\n\nThe \"inter\" parameter sets the interval between two consecutive health checks\nto <delay> milliseconds. If left unspecified, the delay defaults to 2000 ms.\nIt is also possible to use \"fastinter\" and \"downinter\" to optimize delays\nbetween checks depending on the server state :\n\n```\n\nServer stateInterval usedUP 100% (non-transitional)\"[inter](#inter)\"Transitionally UP (going down \"[fall](#fall)\"),Transitionally DOWN (going up \"[rise](#rise)\"),or yet unchecked.\"[fastinter](#fastinter)\" if set,\"[inter](#inter)\" otherwise.DOWN 100% (non-transitional)\"[downinter](#downinter)\" if set,\"[inter](#inter)\" otherwise.```\nJust as with every other time-based parameter, they can be entered in any\nother explicit unit among { us, ms, s, m, h, d }. The \"inter\" parameter also\nserves as a timeout for health checks sent to servers if \"timeout check\" is\nnot set. In order to reduce \"resonance\" effects when multiple servers are\nhosted on the same hardware, the agent and health checks of all servers\nare started with a small time offset between them. It is also possible to\nadd some random noise in the agent and health checks interval using the\nglobal \"spread-checks\" keyword. This makes sense for instance when a lot\nof backends use the same servers. The global \"tune.max-checks-per-thread\"\nsetting, if defined to a non-nul value, will limit the number of concurrent\nchecks being performed at once on any given thread. In order to achieve this,\nhaproxy will put in a queue the checks that were about to start on a thread\nthat has reached this limit, until another check finishes. This will have for\neffect to extend the effective check interval. In such a case, reducing the\n\"inter\" setting will have a very limited effect as it will not be able to\nreduce the time spent in the queue.\n\n```\n\n**[init-state](#5.2-init-state)**{ fully-up | up | down | fully-down }```\nMay be used in the following contexts: tcp, http\n\n```\n\nMay be used in sections :\n\ndefaultsfrontendlistenbackendnonoyesyes```\nThe \"init-state\" option sets the initial state of the server:\n  - when set to 'fully-up', the server is considered immediately available\n    and can turn to the DOWN state when ALL health checks fail.\n  - when set to 'up' (the default), the server is considered immediately\n    available and will initiate a health check that can turn it to the DOWN\n    state immediately if it fails.\n  - when set to 'down', the server initially is considered unavailable and\n    will initiate a health check that can turn it to the UP state immediately\n    if it succeeds.\n  - when set to 'fully-down', the server is initially considered unavailable\n    and can turn to the UP state when ALL health checks succeed.\n\nThe server's init-state is considered when the HAProxy instance is\n(re)started, a new server is detected (for example via service discovery /\nDNS resolution), a dynamic server is inlived, a server exits maintenance,\netc.\n\n```\n\nExamples:```\n\n# pass client traffic ONLY to Redis \"master\" node\nbackend redis-master\n  mode tcp\n  balance first\n  option tcp-check\n  tcp-check send role\\r\\n\n  tcp-check expect string master\n  server-template redis 3 _redis._tcp.redis-headless-service.sandbox.svc.cluster.local:6379 check ... init-state down\n\n# pass traffic to the server only after 3 successful health checks\nbackend google-backend\n  mode http\n  server srv1 google.com:80 check init-state fully-down rise 3\n  server srv2 google.com:80 check init-state fully-down rise 3\n\n```\n\n**See also:**\"[option tcp-check](#option%20tcp-check)\", \"[option httpchk](#option%20httpchk)\"**[log-bufsize](#5.2-log-bufsize)**<bufsize>```\nMay be used in the following contexts: log\n\nThe \"log-bufsize\" specifies the ring bufsize to use for the implicit ring\nthat will be associated to the log server in a log backend. When not\nspecified, this defaults to BUFSIZE. Use of a greater value will increase\nmemory usage but can help to prevent the loss of log messages with slow\nservers since the buffer will be able to hold more pending messages.\nThis keyword may only be used in log backend sections (with \"mode log\")\n\n```\n\n**[log-proto](#5.2-log-proto)**<logproto>```\nMay be used in the following contexts: log, ring\n\nThe \"log-proto\" specifies the protocol used to forward event messages to\na server configured in a log or ring section. Possible values are \"legacy\"\nand \"octet-count\" corresponding respectively to \"Non-transparent-framing\"\nand \"Octet counting\" in rfc6587. \"legacy\" is the default.\n\n```\n\n**[maxconn](#5.2-maxconn)**<maxconn>```\nMay be used in the following contexts: tcp, http\n\nThe \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" parameter specifies the maximal number of concurrent\nconnections that will be sent to this server. If the number of incoming\nconcurrent connections goes higher than this value, they will be queued,\nwaiting for a slot to be released. This parameter is very important as it can\nsave fragile servers from going down under extreme loads. If a \"minconn\"\nparameter is specified, the limit becomes dynamic. The default value is \"0\"\nwhich means unlimited. See also the \"minconn\" and \"maxqueue\" parameters, and\nthe backend's \"fullconn\" keyword.\n\nIn HTTP mode this parameter limits the number of concurrent requests instead\nof the number of connections. Multiple requests might be multiplexed over a\nsingle TCP connection to the server. As an example if you specify a maxconn\nof 50 you might see between 1 and 50 actual server connections, but no more\nthan 50 concurrent requests.\n\n```\n\n**[maxqueue](#5.2-maxqueue)**<maxqueue>```\nMay be used in the following contexts: tcp, http\n\nThe \"maxqueue\" parameter specifies the maximal number of connections which\nwill wait in the queue for this server. If this limit is reached, next\nrequests will be redispatched to other servers instead of indefinitely\nwaiting to be served. This will break persistence but may allow people to\nquickly re-log in when the server they try to connect to is dying. Some load\nbalancing algorithms such as leastconn take this into account and accept to\nadd requests into a server's queue up to this value if it is explicitly set\nto a value greater than zero, which often allows to better smooth the load\nwhen dealing with single-digit maxconn values. The default value is \"0\" which\nmeans the queue is unlimited. See also the \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" and \"minconn\" parameters\nand \"balance leastconn\".\n\n```\n\n**[max-reuse](#5.2-max-reuse)**<count>```\nMay be used in the following contexts: http, ring\n\nWhen used under http context:\n\nThe \"max-reuse\" argument indicates the HTTP connection processors that they\nshould not reuse a server connection more than this number of times to send\nnew requests. Permitted values are -1 (the default), which disables this\nlimit, or any positive value. Value zero will effectively disable keep-alive.\nThis is only used to work around certain server bugs which cause them to leak\nresources over time. The argument is not necessarily respected by the lower\nlayers as there might be technical limitations making it impossible to\nenforce. At least HTTP/2 connections to servers will respect it.\n\nWhen used under ring context:\n\nThe \"max-reuse\" argument indicates that the sink TCP connection processors\nthat they should not reuse a server connection more than this number of\ntimes to send messages. It means that the connection to the server will be\nforcefully destroyed once at least \"max-reuse + 1\" messages were handled on\nthe same connection. The connection to the server will then be automatically\nre-created. When dealing with a large amount of messages in multithreading\ncontext, this can help to better distribute the ring's load over multiple\nthreads. Indeed, each connection is bound to the same CPU thread for its\nentire duration: unlike HTTP, there is no thing like syslog transaction, so\nthe server connection could live indefinitely as long as the server doesn't\nclose the connection or no network error occurs. By destroying connections\nfrom time to time we give the opportunity to other threads to pick-up some\nmessages in turn. It may also help gracefully rotate log servers in contexts\nwhere there is an extra load-balancing layer between haproxy and the log\nservers. However, keep in mind that each connection recycling will leave an\noutgoing port in TIME_WAIT state that will not be reusable for around one\nminute on modern operating systems, and that as such, one must be careful\nnot to use too low values to prevent rapid source port exhaustion. As a rule\nof thumb, make sure never to close more than a few times per second, and\npreferably much less often. Permitted values are -1 (the default), which\ndisables this limit, or any positive value. Unlike under HTTP context, when\nused with sink servers \"max-reuse\" is a best-effort: ring messages are\nbatched, so the limit is checked between each batch.\n\n```\n\n**[minconn](#5.2-minconn)**<minconn>```\nMay be used in the following contexts: tcp, http\n\nWhen the \"minconn\" parameter is set, the maxconn limit becomes a dynamic\nlimit following the backend's load. The server will always accept at least\n<minconn> connections, never more than <maxconn>, and the limit will be on\nthe ramp between both values when the backend has less than <fullconn>\nconcurrent connections. This makes it possible to limit the load on the\nserver during normal loads, but push it further for important loads without\noverloading the server during exceptional loads. See also the \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\"\nand \"maxqueue\" parameters, as well as the \"fullconn\" backend keyword.\n\n```\n\n**[namespace](#5.2-namespace)**<name>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nOn Linux, it is possible to specify which network namespace a socket will\nbelong to. This directive makes it possible to explicitly bind a server to\na namespace different from the default one. Please refer to your operating\nsystem's documentation to find more details about network namespaces.\n\n```\n\n**[no-agent-check](#5.2-no-agent-check)**```\nMay be used in the following contexts: tcp, http, log\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"agent-check\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"agent-check\" setting.\n\n```\n\n**[no-backup](#5.2-no-backup)**```\nMay be used in the following contexts: tcp, http, log\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"backup\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"backup\" setting.\n\n```\n\n**[no-check](#5.2-no-check)**```\nMay be used in the following contexts: tcp, http, log\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"check\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"check\" setting.\n\n```\n\n**[no-check-reuse-pool](#5.2-no-check-reuse-pool)**```\nMay be used in the following contexts: tcp, http\n\nThis option reverts any previous \"check-reuse-pool\" possibly inherited from a\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\". Any checks will be conducted on its dedicated connection.\n\n```\n\n**[no-check-ssl](#5.2-no-check-ssl)**```\nMay be used in the following contexts: tcp, http, log\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"check-ssl\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"check-ssl\" setting.\n\n```\n\n**[no-send-proxy](#5.2-no-send-proxy)**```\nMay be used in the following contexts: tcp, http\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"send-proxy\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"send-proxy\" setting.\n\n```\n\n**[no-send-proxy-v2](#5.2-no-send-proxy-v2)**```\nMay be used in the following contexts: tcp, http\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"send-proxy-v2\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"send-proxy-v2\" setting.\n\n```\n\n**[no-send-proxy-v2-ssl](#5.2-no-send-proxy-v2-ssl)**```\nMay be used in the following contexts: tcp, http\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"send-proxy-v2-ssl\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"send-proxy-v2-ssl\" setting.\n\n```\n\n**[no-send-proxy-v2-ssl-cn](#5.2-no-send-proxy-v2-ssl-cn)**```\nMay be used in the following contexts: tcp, http\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"send-proxy-v2-ssl-cn\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"send-proxy-v2-ssl-cn\" setting.\n\n```\n\n**[no-ssl](#5.2-no-ssl)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"sslThis keyword is available in sections :Bind optionsServer and default-server options\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" setting.\n\nNote that using `default-server ssl` setting and `no-ssl` on server will\nhowever init SSL connection, so it can be later be enabled through the\nruntime API: see `set server` commands in management doc.\n\n```\n\n**[no-ssl-reuse](#5.2-no-ssl-reuse)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option disables SSL session reuse when SSL is used to communicate with\nthe server. It will force the server to perform a full handshake for every\nnew connection. It's probably only useful for benchmarking, troubleshooting,\nand for paranoid users.\n\n```\n\n**[no-sslv3](#5.2-no-sslv3)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option disables support for SSLv3 when SSL is used to communicate with\nthe server. Note that SSLv2 is disabled in the code and cannot be enabled\nusing any configuration option. Use \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\" instead.\n\nSupported in default-server: No\n\n```\n\n**[no-tls-tickets](#5.2-no-tls-tickets)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis setting is only available when support for OpenSSL was built in. It\ndisables the stateless session resumption (RFC 5077 TLS Ticket\nextension) and force to use stateful session resumption. Stateless\nsession resumption is more expensive in CPU usage for servers. This option\nis also available on global statement \"ssl-default-server-options\".\nThe TLS ticket mechanism is only used up to TLS 1.2.\nForward Secrecy is compromised with TLS tickets, unless ticket keys\nare periodically rotated (via reload or by using \"tls-ticket-keys\").\nSee also \"tls-ticketsThis keyword is available in sections :Bind optionsServer and default-server options\".\n\n```\n\n**[no-tlsv10](#5.2-no-tlsv10)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option disables support for TLSv1.0 when SSL is used to communicate with\nthe server. Note that SSLv2 is disabled in the code and cannot be enabled\nusing any configuration option. TLSv1 is more expensive than SSLv3 so it\noften makes sense to disable it when communicating with local servers. This\noption is also available on global statement \"ssl-default-server-options\".\nUse \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\" instead.\n\nSupported in default-server: No\n\n```\n\n**[no-tlsv11](#5.2-no-tlsv11)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option disables support for TLSv1.1 when SSL is used to communicate with\nthe server. Note that SSLv2 is disabled in the code and cannot be enabled\nusing any configuration option. TLSv1 is more expensive than SSLv3 so it\noften makes sense to disable it when communicating with local servers. This\noption is also available on global statement \"ssl-default-server-options\".\nUse \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\" instead.\n\nSupported in default-server: No\n\n```\n\n**[no-tlsv12](#5.2-no-tlsv12)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option disables support for TLSv1.2 when SSL is used to communicate with\nthe server. Note that SSLv2 is disabled in the code and cannot be enabled\nusing any configuration option. TLSv1 is more expensive than SSLv3 so it\noften makes sense to disable it when communicating with local servers. This\noption is also available on global statement \"ssl-default-server-options\".\nUse \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\" instead.\n\nSupported in default-server: No\n\n```\n\n**[no-tlsv13](#5.2-no-tlsv13)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option disables support for TLSv1.3 when SSL is used to communicate with\nthe server. Note that SSLv2 is disabled in the code and cannot be enabled\nusing any configuration option. TLSv1 is more expensive than SSLv3 so it\noften makes sense to disable it when communicating with local servers. This\noption is also available on global statement \"ssl-default-server-options\".\nUse \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\" and \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\" instead.\n\nSupported in default-server: No\n\n```\n\n**[no-verifyhost](#5.2-no-verifyhost)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"verifyhost\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"verifyhost\" setting.\n\n```\n\n**[no-tfo](#5.2-no-tfo)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"tfoThis keyword is available in sections :Bind optionsServer and default-server options\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"tfoThis keyword is available in sections :Bind optionsServer and default-server options\" setting.\n\n```\n\n**[non-stick](#5.2-non-stick)**```\nMay be used in the following contexts: tcp, http\n\nNever add connections allocated to this sever to a stick-table.\nThis may be used in conjunction with backup to ensure that\nstick-table persistence is disabled for backup servers.\n\n```\n\n**[npn](#5.2-npn)**<protocols>```\nMay be used in the following contexts: tcp, http\n\nThis enables the NPN TLS extension and advertises the specified protocol list\nas supported on top of NPN. The protocol list consists in a comma-delimited\nlist of protocol names, for instance: \"http/1.1,http/1.0\" (without quotes).\nThis requires that the SSL library is built with support for TLS extensions\nenabled (check with haproxy -vv). Note that the NPN extension has been\nreplaced with the ALPN extension (see the \"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" keyword), though this one is\nonly available starting with OpenSSL 1.0.2.\n\n```\n\n**[observe](#5.2-observe)**<mode>```\nMay be used in the following contexts: tcp, http\n\nThis option enables health adjusting based on observing communication with\nthe server. By default this functionality is disabled and enabling it also\nrequires to enable health checks. There are two supported modes: \"layer4\" and\n\"layer7\". In layer4 mode, only successful/unsuccessful tcp connections are\nsignificant. In layer7, which is only allowed for http proxies, responses\nreceived from server are verified, like valid/wrong http code, unparsable\nheaders, a timeout, etc. Valid status codes include 100 to 499, 501 and 505.\n\nSee also the \"check\", \"on-error\" and \"error-limit\".\n\n```\n\n**[on-error](#5.2-on-error)**<mode>```\nMay be used in the following contexts: tcp, http, log\n\nSelect what should happen when enough consecutive errors are detected.\nCurrently, four modes are available:\n- fastinter: force fastinter\n- fail-check: simulate a failed check, also forces fastinter (default)\n- sudden-death: simulate a pre-fatal failed health check, one more failed\n  check will mark a server down, forces fastinter\n- mark-down: mark the server immediately down and force fastinter\n\nSee also the \"check\", \"observe\" and \"error-limit\".\n\n```\n\n**[on-marked-down](#5.2-on-marked-down)**<action>```\nMay be used in the following contexts: tcp, http, log\n\nModify what occurs when a server is marked down.\nCurrently one action is available:\n- shutdown-sessions: Shutdown peer streams. When this setting is enabled,\n  all connections to the server are immediately terminated when the server\n  goes down. It might be used if the health check detects more complex cases\n  than a simple connection status, and long timeouts would cause the service\n  to remain unresponsive for too long a time. For instance, a health check\n  might detect that a database is stuck and that there's no chance to reuse\n  existing connections anymore. Connections killed this way are logged with\n  a 'D' termination code (for \"Down\").\n\nActions are disabled by default\n\n```\n\n**[on-marked-up](#5.2-on-marked-up)**<action>```\nMay be used in the following contexts: tcp, http, log\n\nModify what occurs when a server is marked up.\nCurrently one action is available:\n- shutdown-backup-sessions: Shutdown streams on all backup servers. This is\n  done only if the server is not in backup state and if it is not disabled\n  (it must have an effective weight > 0). This can be used sometimes to force\n  an active server to take all the traffic back after recovery when dealing\n  with long sessions (e.g. LDAP, SQL, ...). Doing this can cause more trouble\n  than it tries to solve (e.g. incomplete transactions), so use this feature\n  with extreme care. Streams killed because a server comes up are logged\n  with an 'U' termination code (for \"Up\").\n\nActions are disabled by default\n\n```\n\n**[pool-conn-name](#5.2-pool-conn-name)**<expr>```\nMay be used in the following contexts: http\n\nWhen a backend connection is established, this expression is evaluated to\ngenerate the connection name. This name is one of the key properties of the\nconnection in the idle server pool. See the \"http-reuse\" keyword. When a\nrequest looks up an existing idle connection, this expression is evaluated to\nmatch an identical connection.\n\nIn context where SSL SNI is used for backend connection, the connection name\nis automatically assigned to the result of the \"sni\" expression. This suits\nthe most common usage. For more advanced setup, \"pool-conn-name\" may be used\nto override this.\n\n```\n\n**See also:**\"[http-reuse](#http-reuse)\", \"[sni](#sni)\"**[pool-low-conn](#5.2-pool-low-conn)**<max>```\nMay be used in the following contexts: http\n\nSet a low threshold on the number of idling connections for a server, below\nwhich a thread will not try to steal a connection from another thread. This\ncan be useful to improve CPU usage patterns in scenarios involving many very\nfast servers, in order to ensure all threads will keep a few idle connections\nall the time instead of letting them accumulate over one thread and migrating\nthem from thread to thread. Typical values of twice the number of threads\nseem to show very good performance already with sub-millisecond response\ntimes. The default is zero, indicating that any idle connection can be used\nat any time. It is the recommended setting for normal use. This only applies\nto connections that can be shared according to the same principles as those\napplying to \"http-reuse\". In case connection sharing between threads would\nbe disabled via \"tune.idle-pool.shared\", it can become very important to use\nthis setting to make sure each thread always has a few connections, or the\nconnection reuse rate will decrease as thread count increases.\n\n```\n\n**[pool-max-conn](#5.2-pool-max-conn)**<max>```\nMay be used in the following contexts: http\n\nSet the maximum number of idling connections for a server. -1 means unlimited\nconnections, 0 means no idle connections. The default is -1. When idle\nconnections are enabled, orphaned idle connections which do not belong to any\nclient session anymore are moved to a dedicated pool so that they remain\nusable by future clients. This only applies to connections that can be shared\naccording to the same principles as those applying to \"http-reuse\".\n\n```\n\n**[pool-purge-delay](#5.2-pool-purge-delay)**<delay>```\nMay be used in the following contexts: http\n\nSets the delay to start purging idle connections. Each <delay> interval, half\nof the idle connections are closed. 0 means we don't keep any idle connection.\nThe default is 5s.\n\n```\n\n**[port](#5.2-port)**<port>```\nMay be used in the following contexts: tcp, http, log\n\nUsing the \"port\" parameter, it becomes possible to use a different port to\nsend health-checks or to probe the agent-check. On some servers, it may be\ndesirable to dedicate a port to a specific component able to perform complex\ntests which are more suitable to health-checks than the application. It is\ncommon to run a simple script in inetd for instance. This parameter is\nignored if the \"check\" parameter is not set. See also the \"addr\" parameter.\n\n```\n\n**[proto](#5.2-proto)**<name>```\nMay be used in the following contexts: tcp, http\n\nForces the multiplexer's protocol to use for the outgoing connections to this\nserver. It must be compatible with the mode of the backend (TCP or HTTP). It\nmust also be usable on the backend side. The list of available protocols is\nreported in haproxy -vv.The protocols properties are reported : the mode\n(TCP/HTTP), the side (FE/BE), the mux name and its flags.\n\nSome protocols are subject to the head-of-line blocking on server side\n(flag=HOL_RISK). Finally some protocols don't support upgrades (flag=NO_UPG).\nThe HTX compatibility is also reported (flag=HTX).\n\nHere are the protocols that may be used as argument to a \"protoThis keyword is available in sections :Bind optionsServer and default-server options\" directive on\na server line :\n\n  h2   : mode=HTTP  side=FE|BE  mux=H2    flags=HTX|HOL_RISK|NO_UPG\n  fcgi : mode=HTTP  side=BE     mux=FCGI  flags=HTX|HOL_RISK|NO_UPG\n  h1   : mode=HTTP  side=FE|BE  mux=H1    flags=HTX|NO_UPG\n  none : mode=TCP   side=FE|BE  mux=PASS  flags=NO_UPG\n\nIdea behind this option is to bypass the selection of the best multiplexer's\nprotocol for all connections established to this server.\n\nSee also \"ws\" to use an alternative protocol for websocket streams.\n\n```\n\n**[redir](#5.2-redir)**<prefix>```\nMay be used in the following contexts: http\n\nThe \"redir\" parameter enables the redirection mode for all GET and HEAD\nrequests addressing this server. This means that instead of having HAProxy\nforward the request to the server, it will send an \"HTTP 302\" response with\nthe \"Location\" header composed of this prefix immediately followed by the\nrequested URI beginning at the leading '/' of the path component. That means\nthat no trailing slash should be used after <prefix>. All invalid requests\nwill be rejected, and all non-GET or HEAD requests will be normally served by\nthe server. Note that since the response is completely forged, no header\nmangling nor cookie insertion is possible in the response. However, cookies in\nrequests are still analyzed, making this solution completely usable to direct\nusers to a remote location in case of local disaster. Main use consists in\nincreasing bandwidth for static servers by having the clients directly\nconnect to them. Note: never use a relative location here, it would cause a\nloop between the client and HAProxy!\n\n```\n\nExample :```\n\nserver srv1 192.168.1.1:80 redir http://image1.mydomain.com check\n```\n\n**[rise](#5.2-rise)**<count>```\nMay be used in the following contexts: tcp, http, log\n\nThe \"rise\" parameter states that a server will be considered as operational\nafter <count> consecutive successful health checks. This value defaults to 2\nif unspecified. See also the \"check\", \"inter\" and \"fall\" parameters.\n\n```\n\n**[resolve-opts](#5.2-resolve-opts)**<option>,<option>,...```\nMay be used in the following contexts: tcp, http, log\n\nComma separated list of options to apply to DNS resolution linked to this\nserver.\n\nAvailable options:\n\n* allow-dup-ip\n  By default, HAProxy prevents IP address duplication in a backend when DNS\n  resolution at runtime is in operation.\n  That said, for some cases, it makes sense that two servers (in the same\n  backend, being resolved by the same FQDN) have the same IP address.\n  For such case, simply enable this option.\n  This is the opposite of prevent-dup-ip.\n\n* ignore-weight\n  Ignore any weight that is set within an SRV record.  This is useful when\n  you would like to control the weights using an alternate method, such as\n  using an \"agent-check\" or through the runtime api.\n\n* prevent-dup-ip\n  Ensure HAProxy's default behavior is enforced on a server: prevent reusing\n  an IP address already set to a server in the same backend and sharing the\n  same fqdn.\n  This is the opposite of allow-dup-ip.\n\n```\n\nExample:```\n\nbackend b_myapp\n  default-server init-addr none resolvers dns\n  server s1 myapp.example.com:80 check resolve-opts allow-dup-ip\n  server s2 myapp.example.com:81 check resolve-opts allow-dup-ip\n\n```\n\n```\nWith the option allow-dup-ip set:\n* if the nameserver returns a single IP address, then both servers will use\n  it\n* If the nameserver returns 2 IP addresses, then each server will pick up a\n  different address\n\nDefault value: not set\n\n```\n\n**[resolve-prefer](#5.2-resolve-prefer)**<family>```\nMay be used in the following contexts: tcp, http, log\n\nWhen DNS resolution is enabled for a server and multiple IP addresses from\ndifferent families are returned, HAProxy will prefer using an IP address\nfrom the family mentioned in the \"resolve-prefer\" parameter. See also the\nglobal \"dns-accept-family\" keyword to enforce strict usage of a specific\nfamily. Available families: \"ipv4\" and \"ipv6\".\n\nDefault value: ipv6\n\n```\n\nExample:```\n\nserver s1 app1.domain.com:80 resolvers mydns resolve-prefer ipv6\n\n```\n\n**[resolve-net](#5.2-resolve-net)**<network>[,<network[,...]]```\nMay be used in the following contexts: tcp, http, log\n\nThis option prioritizes the choice of an ip address matching a network. This is\nuseful with clouds to prefer a local ip. In some cases, a cloud high\navailability service can be announced with many ip addresses on many\ndifferent datacenters. The latency between datacenter is not negligible, so\nthis patch permits to prefer a local datacenter. If no address matches the\nconfigured network, another address is selected.\n\n```\n\nExample:```\n\nserver s1 app1.domain.com:80 resolvers mydns resolve-net 10.0.0.0/8\n\n```\n\n**[resolvers](#5.2-resolvers)**<id>```\nMay be used in the following contexts: tcp, http, log\n\nPoints to an existing \"resolversThis keyword is available in sections :Server and default-server optionsThe resolvers section\" section to resolve current server's\nhostname. It is often recommended to disable libc-based resolution when using\nresolvers, though exceptions exist (see section 5.3.1). In any case it is a\ngood practice to explicitly specify \"init-addr\" when using resolvers in order\nnot to overlook this element.\n\n```\n\nExample:```\n\nserver s1 app1.domain.com:80 init-addr last,none check resolvers mydns\n\n```\n\n```\nSee also section 5.3 for implementation details and traps to be aware of.\n\n```\n\n**[send-proxy](#5.2-send-proxy)**```\nMay be used in the following contexts: tcp, http\n\nThe \"send-proxy\" parameter enforces use of the PROXY protocol over any\nconnection established to this server. The PROXY protocol informs the other\nend about the layer 3/4 addresses of the incoming connection, so that it can\nknow the client's address or the public address it accessed to, whatever the\nupper layer protocol. For connections accepted by an \"accept-proxy\" or\n\"accept-netscaler-cip\" listener, the advertised address will be used. Only\nTCPv4 and TCPv6 address families are supported. Other families such as\nUnix sockets, will report an UNKNOWN family. Servers using this option can\nfully be chained to another instance of HAProxy listening with an\n\"accept-proxy\" setting. This setting must not be used if the server isn't\naware of the protocol. When health checks are sent to the server, the PROXY\nprotocol is automatically used when this option is set, unless there is an\nexplicit \"port\" or \"addr\" directive, in which case an explicit\n\"check-send-proxy\" directive would also be needed to use the PROXY protocol.\nSee also the \"no-send-proxy\" option of this section and \"accept-proxy\" and\n\"accept-netscaler-cip\" option of the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" keyword.\n\n```\n\n**[send-proxy-v2](#5.2-send-proxy-v2)**```\nMay be used in the following contexts: tcp, http\n\nThe \"send-proxy-v2\" parameter enforces use of the PROXY protocol version 2\nover any connection established to this server. The PROXY protocol informs\nthe other end about the layer 3/4 addresses of the incoming connection, so\nthat it can know the client's address or the public address it accessed to,\nwhatever the upper layer protocol. It also send ALPN information if an alpn\nhave been negotiated. This setting must not be used if the server isn't aware\nof this version of the protocol. See also the \"no-send-proxy-v2\" option of\nthis section and send-proxy\" option of the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" keyword.\n\n```\n\n**[set-proxy-v2-tlv-fmt](#5.2-set-proxy-v2-tlv-fmt)**(<id>)<fmt>```\nMay be used in the following contexts: tcp, http\n\nThe \"set-proxy-v2-tlv-fmt\" parameter is used to send arbitrary PROXY protocol\nversion 2 TLVs. For the type (<id>) range of the defined TLV type please refer\nto section 2.2.8. of the proxy protocol specification. However, the value can\nbe chosen freely as long as it does not exceed the maximum length of 65,535\nbytes. It can also be used for forwarding TLVs by using the fetch \"fc_pp_tlv\"\nto retrieve a received TLV from the frontend. It may be used as a server or\na default-server option. It must be used in combination with send-proxy-v2\nsuch that PPv2 TLVs are actually sent out.\n\n```\n\nExample:```\n\nserver srv1 192.168.1.1:80 send-proxy-v2 set-proxy-v2-tlv-fmt(0x20) %[fc_pp_tlv(0x20)]\n\n```\n\n```\nIn this case, we fetch the TLV with the type 0x20 as a string and set as the value\nof a newly created TLV that also has the type 0x20.\n\n```\n\n**[proxy-v2-options](#5.2-proxy-v2-options)**<option>[,<option>]*```\nMay be used in the following contexts: tcp, http\n\nThe \"proxy-v2-options\" parameter add options to send in PROXY protocol\nversion 2 when \"send-proxy-v2\" is used. Options available are:\n\n- ssl       : See also \"send-proxy-v2-ssl\".\n- cert-cn   : See also \"send-proxy-v2-ssl-cn\".\n- ssl-cipher: Name of the used cipher.\n- cert-sig  : Signature algorithm of the used certificate.\n- cert-key  : Key algorithm of the used certificate\n- authority : Host name value passed by the client (only SNI from a TLS\n              connection is supported).\n- crc32c    : Checksum of the PROXYv2 header.\n- unique-id : Send a unique ID generated using the frontend's\n              \"unique-id-format\" within the PROXYv2 header.\n              This unique-id is primarily meant for \"mode tcp\". It can\n              lead to unexpected results in \"mode http\", because the\n              generated unique ID is also used for the first HTTP request\n              within a Keep-Alive connection.\n\n```\n\n**[send-proxy-v2-ssl](#5.2-send-proxy-v2-ssl)**```\nMay be used in the following contexts: tcp, http\n\nThe \"send-proxy-v2-ssl\" parameter enforces use of the PROXY protocol version\n2 over any connection established to this server. The PROXY protocol informs\nthe other end about the layer 3/4 addresses of the incoming connection, so\nthat it can know the client's address or the public address it accessed to,\nwhatever the upper layer protocol. In addition, the SSL information extension\nof the PROXY protocol is added to the PROXY protocol header. This setting\nmust not be used if the server isn't aware of this version of the protocol.\nSee also the \"no-send-proxy-v2-ssl\" option of this section and the\n\"send-proxy-v2\" option of the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" keyword.\n\n```\n\n**[send-proxy-v2-ssl-cn](#5.2-send-proxy-v2-ssl-cn)**```\nMay be used in the following contexts: tcp, http\n\nThe \"send-proxy-v2-ssl\" parameter enforces use of the PROXY protocol version\n2 over any connection established to this server. The PROXY protocol informs\nthe other end about the layer 3/4 addresses of the incoming connection, so\nthat it can know the client's address or the public address it accessed to,\nwhatever the upper layer protocol. In addition, the SSL information extension\nof the PROXY protocol, along along with the Common Name from the subject of\nthe client certificate (if any), is added to the PROXY protocol header. This\nsetting must not be used if the server isn't aware of this version of the\nprotocol. See also the \"no-send-proxy-v2-ssl-cn\" option of this section and\nthe \"send-proxy-v2\" option of the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" keyword.\n\n```\n\n**[shard](#5.2-shard)**<shard>```\nMay be used in the following contexts: peers\n\nThis parameter in used only in the context of stick-tables synchronisation\nwith peers protocol. The \"shard\" parameter identifies the peers which will\nreceive all the stick-table updates for keys with this shard as distribution\nhash. The accepted values are 0 up to \"shardsThis keyword is available in sections :Peers declarationBind options\" parameter value specified in\nthe \"peers\" section. 0 value is the default value meaning that the peer will\nreceive all the key updates. Greater values than \"shardsThis keyword is available in sections :Peers declarationBind options\" will be ignored.\nThis is also the case for any value provided to the local peer.\n\n```\n\nExample :```\n\npeers mypeers\n     shards 3\n     peer A 127.0.0.1:40001 # local peer without shard value (0 internally)\n     peer B 127.0.0.1:40002 shard 1\n     peer C 127.0.0.1:40003 shard 2\n     peer D 127.0.0.1:40004 shard 3\n\n```\n\n**[sigalgs](#5.2-sigalgs)**<sigalgs>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis setting is only available when support for OpenSSL was built in. It sets\nthe string describing the list of signature algorithms that are negotiated\nduring the TLSv1.2 and TLSv1.3 handshake. The format of the string is defined\nin \"man 3 SSL_CTX_set1_sigalgs\" from the OpenSSL man pages. It is not\nrecommended to use this setting unless compatibility with a middlebox is\nrequired.\n\n```\n\n**[slowstart](#5.2-slowstart)**<start_time_in_ms>```\nMay be used in the following contexts: tcp, http\n\nThe \"slowstart\" parameter for a server accepts a value in milliseconds which\nindicates after how long a server which has just come back up will run at\nfull speed. Just as with every other time-based parameter, it can be entered\nin any other explicit unit among { us, ms, s, m, h, d }. The speed grows\nlinearly from 0 to 100% during this time. The limitation applies to two\nparameters :\n\n- maxconn: the number of connections accepted by the server will grow from 1\n  to 100% of the usual dynamic limit defined by (minconn,maxconn,fullconn).\n\n- weight: when the backend uses a dynamic weighted algorithm, the weight\n  grows linearly from 1 to 100%. In this case, the weight is updated at every\n  health-check. For this reason, it is important that the \"inter\" parameter\n  is smaller than the \"slowstart\", in order to maximize the number of steps.\n\nThe slowstart never applies when HAProxy starts, otherwise it would cause\ntrouble to running servers. It only applies when a server has been previously\nseen as failed.\n\n```\n\n**[sni](#5.2-sni)**<expression>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThe \"sni\" parameter evaluates the sample fetch expression, converts it to a\nstring and uses the result as the host name sent in the SNI TLS extension to\nthe server. A typical use case is to send the SNI received from the client in\na bridged TCP/SSL scenario, using the \"ssl_fc_sni\" sample fetch for the\nexpression. THIS MUST NOT BE USED FOR HTTPS, where req.hdr(host) should be\nused instead, since SNI in HTTPS must always match the Host field and clients\nare allowed to use different host names over the same connection). If\n\"verify required\" is set (which is the recommended setting), the resulting\nname will also be matched against the server certificate's names. See the\n\"verifyThis keyword is available in sections :Bind optionsServer and default-server options\" directive for more details. If you want to set a SNI for health\nchecks, see the \"check-sni\" directive for more details.\n\nBy default, the SNI is assigned to the connection name for \"http-reuse\",\nunless overridden by the \"pool-conn-name\" server keyword.\n\n```\n\n**[source](#5.2-source)**<addr>[:<pl>[-<ph>]][usesrc{<addr2>[:<port2>]| client | clientip }]**[source](#5.2-source)**<addr>[:<port>][usesrc{<addr2>[:<port2>]| hdr_ip(<hdr>[,<occ>]) }]**[source](#5.2-source)**<addr>[:<pl>[-<ph>]][interface<name>]...```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThe \"sourceThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\" parameter sets the source address which will be used when\nconnecting to the server. It follows the exact same parameters and principle\nas the backend \"sourceThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\" keyword, except that it only applies to the server\nreferencing it. Please consult the \"sourceThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\" keyword for details.\n\nAdditionally, the \"sourceThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\" statement on a server line allows one to specify a\nsource port range by indicating the lower and higher bounds delimited by a\ndash ('-'). Some operating systems might require a valid IP address when a\nsource port range is specified. It is permitted to have the same IP/range for\nseveral servers. Doing so makes it possible to bypass the maximum of 64k\ntotal concurrent connections. The limit will then reach 64k connections per\nserver.\n\nSince Linux 4.2/libc 2.23 IP_BIND_ADDRESS_NO_PORT is set for connections\nspecifying the source address without port(s).\n\n```\n\n**[ssl](#5.2-ssl)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option enables SSL ciphering on outgoing connections to the server. It\nis critical to verify server certificates using \"verifyThis keyword is available in sections :Bind optionsServer and default-server options\" when using SSL to\nconnect to servers, otherwise the communication is prone to trivial man in\nthe-middle attacks rendering SSL useless. When this option is used, health\nchecks are automatically sent in SSL too unless there is a \"port\" or an\n\"addr\" directive indicating the check should be sent to a different location.\nSee the \"no-ssl\" to disable \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option and \"check-ssl\" option to force\nSSL health checks.\n\n```\n\n**[ssl-max-ver](#5.2-ssl-max-ver)**[ SSLv3 | TLSv1.0 | TLSv1.1 | TLSv1.2 | TLSv1.3 ]```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option enforces use of <version> or lower when SSL is used to communicate\nwith the server. This option is also available on global statement\n\"ssl-default-server-options\". See also \"ssl-min-verThis keyword is available in sections :Bind optionsServer and default-server options\".\n\n```\n\n**[ssl-min-ver](#5.2-ssl-min-ver)**[ SSLv3 | TLSv1.0 | TLSv1.1 | TLSv1.2 | TLSv1.3 ]```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option enforces use of <version> or upper when SSL is used to communicate\nwith the server. This option is also available on global statement\n\"ssl-default-server-options\". See also \"ssl-max-verThis keyword is available in sections :Bind optionsServer and default-server options\".\n\n```\n\n**[ssl-reuse](#5.2-ssl-reuse)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"no-ssl-reuse\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"no-ssl-reuse\" setting.\n\n```\n\n**[stick](#5.2-stick)**```\nMay be used in the following contexts: tcp, http\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"non-stick\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"non-stick\" setting.\n\n```\n\n**[strict-maxconn](#5.2-strict-maxconn)**```\nMay be used in the following contexts: tcp, http\n\nmaxconn to servers is a bit of a misnomer, it actually configure the maximum\nnumber of requests we send to a server, but with idle connections, we may\nhave more total connections to the server. If a strict limit of connections\nto a server is required, then adding strict-maxconn can be used. We will\nthen never establish more connections to a server than maxconn, and try to\nreuse or kill connections if needed. Please note, however, than it may lead\nto failed requests in case we can't establish a new connection, and no\nidle connection is available. This can happen when 'private\" connections\nare established, connections tied only to a session, because authentication\nhappened.\n\n```\n\n**[socks4](#5.2-socks4)**<addr>:<port>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option enables upstream socks4 tunnel for outgoing connections to the\nserver. Using this option won't force the health check to go via socks4 by\ndefault. You will have to use the keyword \"check-via-socks4\" to enable it.\n\n```\n\n**[tcp-ut](#5.2-tcp-ut)**<delay>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nSets the TCP User Timeout for all outgoing connections to this server. This\noption is available on Linux since version 2.6.37. It allows HAProxy to\nconfigure a timeout for sockets which contain data not receiving an\nacknowledgment for the configured delay. This is especially useful on\nlong-lived connections experiencing long idle periods such as remote\nterminals or database connection pools, where the client and server timeouts\nmust remain high to allow a long period of idle, but where it is important to\ndetect that the server has disappeared in order to release all resources\nassociated with its connection (and the client's session). One typical use\ncase is also to force dead server connections to die when health checks are\ntoo slow or during a soft reload since health checks are then disabled. The\nargument is a delay expressed in milliseconds by default. This only works for\nregular TCP connections, and is ignored for other protocols.\n\n```\n\n**[tfo](#5.2-tfo)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option enables using TCP fast open when connecting to servers, on\nsystems that support it (currently only the Linux kernel >= 4.11).\nSee the \"tfoThis keyword is available in sections :Bind optionsServer and default-server options\" bind option for more information about TCP fast open.\nPlease note that when using tfo, you should also use the \"conn-failure\",\n\"empty-response\" and \"response-timeout\" keywords for \"retry-on\", or HAProxy\nwon't be able to retry the connection on failure. See also \"no-tfo\".\n\n```\n\n**[track](#5.2-track)**[<backend>/]<server>```\nMay be used in the following contexts: tcp, http, log\n\nThis option enables ability to set the current state of the server by tracking\nanother one. It is possible to track a server which itself tracks another\nserver, provided that at the end of the chain, a server has health checks\nenabled. If <backend> is omitted the current one is used. If disable-on-404 is\nused, it has to be enabled on both proxies.\n\n```\n\nExample :```\n\nbackend A\nserver a1 1.1.1.1:80 track B/b1\nserver a2 1.1.1.2:80 track B/b1\n\nbackend B\nserver b1 2.2.2.2:80 check\n\n```\n\n**[tls-tickets](#5.2-tls-tickets)**```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis option may be used as \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" setting to reset any \"no-tls-ticketsThis keyword is available in sections :Bind optionsServer and default-server options\"\nsetting which would have been inherited from \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" directive as\ndefault value.\nThe TLS ticket mechanism is only used up to TLS 1.2.\nForward Secrecy is compromised with TLS tickets, unless ticket keys\nare periodically rotated (via reload or by using \"tls-ticket-keys\").\nIt may also be used as \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" setting to reset any previous\n\"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" \"no-tls-ticketsThis keyword is available in sections :Bind optionsServer and default-server options\" setting.\n\n```\n\n**[verify](#5.2-verify)**[none|required]```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis setting is only available when support for OpenSSL was built in. If set\nto 'none', server certificate is not verified. In the other case, The\ncertificate provided by the server is verified using CAs from 'ca-file' and\noptional CRLs from 'crl-file' after having checked that the names provided in\nthe certificate's subject and subjectAlternateNames attributes match either\nthe name passed using the \"sni\" directive, or if not provided, the static\nhost name passed using the \"verifyhost\" directive. When no name is found, the\ncertificate's names are ignored. For this reason, without SNI it's important\nto use \"verifyhost\". On verification failure the handshake is aborted. It is\ncritically important to verify server certificates when using SSL to connect\nto servers, otherwise the communication is prone to trivial man-in-the-middle\nattacks rendering SSL totally useless. Unless \"ssl_server_verify\" appears in\nthe global section, \"verifyThis keyword is available in sections :Bind optionsServer and default-server options\" is set to \"required\" by default.\n\n```\n\n**[verifyhost](#5.2-verifyhost)**<hostname>```\nMay be used in the following contexts: tcp, http, log, peers, ring\n\nThis setting is only available when support for OpenSSL was built in, and\nonly takes effect if 'verify required' is also specified. This directive sets\na default static hostname to check the server's certificate against when no\nSNI was used to connect to the server. If SNI is not used, this is the only\nway to enable hostname verification. This static hostname, when set, will\nalso be used for health checks (which cannot provide an SNI value). If none\nof the hostnames in the certificate match the specified hostname, the\nhandshake is aborted. The hostnames in the server-provided certificate may\ninclude wildcards. See also \"verifyThis keyword is available in sections :Bind optionsServer and default-server options\", \"sni\" and \"no-verifyhost\" options.\n\n```\n\n**[weight](#5.2-weight)**<weight>```\nMay be used in the following contexts: tcp, http\n\nThe \"weight\" parameter is used to adjust the server's weight relative to\nother servers. All servers will receive a load proportional to their weight\nrelative to the sum of all weights, so the higher the weight, the higher the\nload. The default weight is 1, and the maximal value is 256. A value of 0\nmeans the server will not participate in load-balancing but will still accept\npersistent connections. If this parameter is used to distribute the load\naccording to server's capacity, it is recommended to start with values which\ncan both grow and shrink, for instance between 10 and 100 to leave enough\nroom above and below for later adjustments.\n\n```\n\n**[ws](#5.2-ws)**{ auto | h1 | h2 }```\nMay be used in the following contexts: http\n\nThis option allows to configure the protocol used when relaying websocket\nstreams. This is most notably useful when using an HTTP/2 backend without the\nsupport for H2 websockets through the RFC8441.\n\nThe default mode is \"auto\". This will reuse the same protocol as the main\none. The only difference is when using ALPN. In this case, it can try to\ndowngrade the ALPN to \"http/1.1\" only for websocket streams if the configured\nserver ALPN contains it.\n\nThe value \"h1\" is used to force HTTP/1.1 for websockets streams, through ALPN\nif SSL ALPN is activated for the server. Similarly, \"h2\" can be used to\nforce HTTP/2.0 websockets. Use this value with care : the server must support\nRFC8441 or an error will be reported by haproxy when relaying websockets.\n\nNote that NPN is not taken into account as its usage has been deprecated in\nfavor of the ALPN extension.\n\nSee also \"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" and \"protoThis keyword is available in sections :Bind optionsServer and default-server options\".\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "5.3. Server IP address resolution using DNS", "content": "## [5.3.](#5.3)Server IP address resolution using DNS\n\n```\nHAProxy allows using a host name on the server line to retrieve its IP address\nusing name servers. By default, HAProxy resolves the name when parsing the\nconfiguration file, at startup and cache the result for the process's life.\nThis is not sufficient in some cases, such as in Amazon where a server's IP\ncan change after a reboot or an ELB Virtual IP can change based on current\nworkload.\n\nThis chapter describes how HAProxy can be configured to process server's name\nresolution at run time.\n\nWhether run time server name resolution has been enable or not, by default\nHAProxy will do the first resolution at startup during configuration parsing\nvia libc unless disabled by the \"init-addr\" parameter.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "5.3.1. Global overview", "content": "### [5.3.1.](#5.3.1)Global overview\n\n```\nAs we've seen in introduction, name resolution in HAProxy occurs at two\ndifferent steps of the process life:\n\n  1. when starting up, HAProxy parses the server line definition and matches a\n     host name. It uses libc functions to get the host name resolved. This\n     resolution relies on /etc/resolv.conf file.\n\n  2. at run time, HAProxy performs periodically name resolutions for servers\n     requiring DNS resolutions.\n\nA few other events can trigger a name resolution at run time:\n  - when a server's health check ends up in a connection timeout: this may be\n    because the server has a new IP address. So we need to trigger a name\n    resolution to know this new IP.\n\nWhen using resolvers, the server name can either be a hostname, or a SRV label.\nHAProxy considers anything that starts with an underscore as a SRV label. If a\nSRV label is specified, then the corresponding SRV records will be retrieved\nfrom the DNS server, and the provided hostnames will be used. The SRV label\nwill be checked periodically, and if any server are added or removed, HAProxy\nwill automatically do the same.\n\nA few things important to notice:\n  - all the name servers are queried in the meantime. HAProxy will process the\n    first valid response.\n\n  - a resolution is considered as invalid (NX, timeout, refused), when all the\n    servers return an error.\n\n  - The DNS client implemented in HAProxy is very basic and will not understand\n    the vast number of options and advanced setups that an operating system's\n    resolver can deal with. As such, except for really trivial setups where a\n    server known by its FQDN only has exactly one IP address at a time and\n    might occasionally renew it (e.g. a reboot), it is highly recommended to\n    avoid mixing libc-based init-time resolution with DNS-based runtime\n    resolution, as such setups are known to cause failures upon address\n    renewal. As a conclusion, unless you know exactly what you are doing, you\n    should always exclude \"libc\" from \"init-addr\" when using \"resolversThis keyword is available in sections :Server and default-server optionsThe resolvers section\" on a\n    server line.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "5.3.2. The resolvers section", "content": "### [5.3.2.](#5.3.2)The resolvers section\n\n```\nThis section is dedicated to host information related to name resolution in\nHAProxy. There can be as many as resolvers section as needed. Each section can\ncontain many name servers.\n\nAt startup, HAProxy tries to generate a resolvers section named \"default\", if\nno section was named this way in the configuration. This section is used by\ndefault by the httpclient and uses the parse-resolv-conf keyword. If HAProxy\nfailed to generate automatically this section, no error or warning are emitted.\n\nWhen multiple name servers are configured in a resolvers section, then HAProxy\nuses the first valid response. In case of invalid responses, only the last one\nis treated. Purpose is to give the chance to a slow server to deliver a valid\nanswer after a fast faulty or outdated server.\n\nWhen each server returns a different error type, then only the last error is\nused by HAProxy. The following processing is applied on this error:\n\n  1. HAProxy retries the same DNS query with a new query type. The A queries are\n     switch to AAAA or the opposite. SRV queries are not concerned here. Timeout\n     errors are also excluded.\n\n  2. When the fallback on the query type was done (or not applicable), HAProxy\n     retries the original DNS query, with the preferred query type.\n\n  3. HAProxy retries previous steps <resolve_retries> times. If no valid\n     response is received after that, it stops the DNS resolution and reports\n     the error.\n\nFor example, with 2 name servers configured in a resolvers section, the\nfollowing scenarios are possible:\n\n  - First response is valid and is applied directly, second response is\n    ignored\n\n  - First response is invalid and second one is valid, then second response is\n    applied\n\n  - First response is a NX domain and second one a truncated response, then\n    HAProxy retries the query with a new type\n\n  - First response is a NX domain and second one is a timeout, then HAProxy\n    retries the query with a new type\n\n  - Query timed out for both name servers, then HAProxy retries it with the\n    same query type\n\nAs a DNS server may not answer all the IPs in one DNS request, HAProxy keeps\na cache of previous answers, an answer will be considered obsolete after\n<hold obsolete> seconds without the IP returned.\n\n```\n\n**[resolvers](#5.3.2-resolvers)**<resolvers id>```\n  Creates a new name server list labeled <resolvers id>\n\nA resolvers section accept the following parameters:\n\n```\n\n**[accepted_payload_size](#5.3.2-accepted_payload_size)**<nb>```\nDefines the maximum payload size accepted by HAProxy and announced to all the\nname servers configured in this resolvers section.\n<nb> is in bytes. If not set, HAProxy announces 512. (minimal value defined\n     by RFC 6891)\n\nNote: the maximum allowed value is 65535. Recommended value for UDP is\n      4096 and it is not recommended to exceed 8192 except if you are sure\n      that your system and network can handle this (over 65507 makes no sense\n      since is the maximum UDP payload size). If you are using only TCP\n      nameservers to handle huge DNS responses, you should put this value\n      to the max: 65535.\n\n```\n\n**[nameserver](#5.3.2-nameserver)**<name><address>[:port][param*]```\nUsed to configure a nameserver. <name> of the nameserver should ne unique.\nBy default the <address> is considered of type datagram. This means if an\nIPv4 or IPv6 is configured without special address prefixes (paragraph 11.)\nthe UDP protocol will be used.  If an stream protocol address prefix is used,\nthe nameserver will be considered as a stream server (TCP for instance) and\n\"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" parameters found in 5.2 paragraph which are relevant for DNS\nresolving will be considered.  Note: currently, in TCP mode, 4 queries are\npipelined on the same connections. A batch of idle connections are removed\nevery 5 seconds. \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" can be configured to limit the amount of those\nconcurrent connections and TLS should also usable if the server supports.\n\n```\n\n**[parse-resolv-conf](#5.3.2-parse-resolv-conf)**```\nAdds all nameservers found in /etc/resolv.conf to this resolvers nameservers\nlist. Ordered as if each nameserver in /etc/resolv.conf was individually\nplaced in the resolvers section in place of this directive.\n\n```\n\n**[hold](#5.3.2-hold)**<status><period>```\nUpon receiving the DNS response <status>, determines whether a server's state\nshould change from UP to DOWN. To make that determination, it checks whether\nany valid status has been received during the past <period> in order to\ncounteract the just received invalid status.\n\n  <status> : last name resolution status.\n         nx        After receiving an NXDOMAIN status, check for any valid\n                   status during the concluding period.\n\n         refused   After receiving a REFUSED status, check for any valid\n                   status during the concluding period.\n\n         timeout   After the \"timeout retry\" has struck, check for any\n                   valid status during the concluding period.\n\n         other     After receiving any other invalid status, check for any\n                   valid status during the concluding period.\n\n         valid     Applies only to \"http-request do-resolve\" and\n                   \"tcp-request content do-resolve\" actions. It defines the\n                   period for which the server will maintain a valid response\n                   before triggering another resolution. It does not affect\n                   dynamic resolution of servers.\n\n         obsolete  Defines how long to wait before removing obsolete DNS\n                   records after an updated answer record is received. It\n                   applies to SRV records.\n\n  <period> : Amount of time into the past during which a valid response must\n             have been received. It follows the HAProxy time format and is in\n             milliseconds by default.\n\nFor a server that relies on dynamic DNS resolution to determine its IP\naddress, receiving an invalid DNS response, such as NXDOMAIN, will lead to\nchanging the server's state from UP to DOWN. The hold directives define how\nfar into the past to look for a valid response. If a valid response has been\nreceived within <period>, the just received invalid status will be ignored.\n\nUnless a valid response has been receiving during the concluding period, the\nserver will be marked as DOWN. For example, if \"hold nx 30s\" is set and the\nlast received DNS response was NXDOMAIN, the server will be marked DOWN\nunless a valid response has been received during the last 30 seconds.\n\nA server in the DOWN state will be marked UP immediately upon receiving a\nvalid status from the DNS server.\n\nA separate behavior exists for \"hold valid\" and \"hold obsolete\".\n\nDefault value is 10s for \"valid\", 0s for \"obsolete\" and 30s for others.\n\n```\n\n**[resolve_retries](#5.3.2-resolve_retries)**<nb>```\nDefines the number <nb> of queries to send to resolve a server name before\ngiving up.\nDefault value: 3\n\nA retry occurs on name server timeout or when the full sequence of DNS query\ntype failover is over and we need to start up from the default ANY query\ntype.\n\n```\n\n**[timeout](#5.3.2-timeout)**<event><time>```\nDefines timeouts related to name resolution\n   <event> : the event on which the <time> timeout period applies to.\n             events available are:\n             - resolve : default time to trigger name resolutions when no\n                         other time applied.\n                         Default value: 1s\n             - retry   : time between two DNS queries, when no valid response\n                         have been received.\n                         Default value: 1s\n   <time>  : time related to the event. It follows the HAProxy time format.\n             <time> is expressed in milliseconds.\n\n```\n\nExample:```\n\nresolvers mydns\n  nameserver dns1 10.0.0.1:53\n  nameserver dns2 10.0.0.2:53\n  nameserver dns3 tcp@10.0.0.3:53\n  parse-resolv-conf\n  resolve_retries       3\n  timeout resolve       1s\n  timeout retry         1s\n  hold other           30s\n  hold refused         30s\n  hold nx              30s\n  hold timeout         30s\n  hold valid           10s\n  hold obsolete        30s\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "6. Cache", "content": "# [6.](#6)Cache\n\n```\nHAProxy provides a cache, which was designed to perform cache on small objects\n(favicon, css...). This is a minimalist low-maintenance cache which runs in\nRAM.\n\nThe cache is based on a memory area shared between all threads, and split in 1kB\nblocks.\n\nIf an object is not used anymore, it can be deleted to store a new object\nindependently of its expiration date. The oldest objects are deleted first\nwhen we try to allocate a new one.\n\nThe cache uses a hash of the host header and the URI as the key.\n\nIt's possible to view the status of a cache using the Unix socket command\n\"show cache\" consult section 9.3 \"Unix Socket commands\" of Management Guide\nfor more details.\n\nWhen an object is delivered from the cache, the server name in the log is\nreplaced by \"<CACHE>\".\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "6.1. Limitation", "content": "## [6.1.](#6.1)Limitation\n\n```\nThe cache won't store and won't deliver objects in these cases:\n\n- If the response is not a 200\n- If the response contains a Vary header and either the process-vary option is\n  disabled, or a currently unmanaged header is specified in the Vary value (only\n  accept-encoding, referer and origin are managed for now)\n- If the Content-Length + the headers size is greater than \"max-object-size\"\n- If the response is not cacheable\n- If the response does not have an explicit expiration time (s-maxage or max-age\n  Cache-Control directives or Expires header) or a validator (ETag or Last-Modified\n  headers)\n- If the process-vary option is enabled and there are already max-secondary-entries\n  entries with the same primary key as the current response\n- If the process-vary option is enabled and the response has an unknown encoding (not\n  mentioned in https://www.iana.org/assignments/http-parameters/http-parameters.xhtml)\n  while varying on the accept-encoding client header\n\n- If the request is not a GET\n- If the HTTP version of the request is smaller than 1.1\n- If the request contains an Authorization header\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "6.2. Setup", "content": "## [6.2.](#6.2)Setup\n\n```\nTo setup a cache, you must define a cache section and use it in a proxy with\nthe corresponding http-request and http-response actions.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "6.2.1. Cache section", "content": "### [6.2.1.](#6.2.1)Cache section\n\n**[cache](#6.2.1-cache)**<name>```\nDeclare a cache section, allocate a shared cache memory named <name>, the\nsize of cache is mandatory (see keyword \"total-max-size\" below).\n\n```\n\n**[max-age](#6.2.1-max-age)**<seconds>```\nDefine the maximum expiration duration. The expiration is set as the lowest\nvalue between the s-maxage or max-age (in this order) directive in the\nCache-Control response header and this value. The default value is 60\nseconds, which means that you can't cache an object more than 60 seconds by\ndefault.\n\n```\n\n**[max-object-size](#6.2.1-max-object-size)**<bytes>```\nDefine the maximum size of the objects to be cached. Must not be greater than\nan half of \"total-max-size\". If not set, it equals to a 256th of the cache size.\nAll objects with sizes larger than \"max-object-size\" will not be cached.\n\n```\n\n**[max-secondary-entries](#6.2.1-max-secondary-entries)**<number>```\nDefine the maximum number of simultaneous secondary entries with the same primary\nkey in the cache. This needs the vary support to be enabled. Its default value is 10\nand should be passed a strictly positive integer.\n\n```\n\n**[process-vary](#6.2.1-process-vary)**<on/off>```\nEnable or disable the processing of the Vary header. When disabled, a response\ncontaining such a header will never be cached. When enabled, we need to calculate\na preliminary hash for a subset of request headers on all the incoming requests\n(which might come with a cpu cost) which will be used to build a secondary\nkey for a given request (see RFC 7234#4.1). The secondary key is built out of\nthe contents of the 'accept-encoding', 'referer' and 'origin' headers for\nnow. The default value is off (disabled).\n\n```\n\n**[total-max-size](#6.2.1-total-max-size)**<megabytes>```\nDefine the size in RAM of the cache in megabytes. This size is split in\nblocks of 1kB which are used by the cache entries. Its maximum value is 4095.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "6.2.2. Proxy section", "content": "### [6.2.2.](#6.2.2)Proxy section\n\n```\nThe proxy section making use of the cache will need to involve the \"cache-use\"\naction in the \"http-request\" rule set in order to look up the requested object\nfrom the cache, and the \"cache-store\" action in the \"http-response\" rule set in\norder to store or update the retrieved object into the cache. Each of these\nactions may optionally involve conditions. For example, one could decide to\nskip the \"cache-use\" action for a certain sub-directory that is known not to\nbe cacheable, or to skip the \"cache-store\" action for certain content-types\nthat are known to be worthless. Please note that the cache indexing key is\ncomputed during the \"cache-use\" action, so if this action is skipped, no\nattempt to update the cache will be made on the response path anyway.\n\n```\n\nExample:```\n\nbackend bck1\n  mode http\n\n  http-request cache-use foobar\n  http-response cache-store foobar\n  server srv1 127.0.0.1:80\n\ncache foobar\n  total-max-size 4\n  max-age 240\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7. Using ACLs and fetching samples", "content": "# [7.](#7)Using ACLs and fetching samples\n\n```\nHAProxy is capable of extracting data from request or response streams, from\nclient or server information, from tables, environmental information etc...\nThe action of extracting such data is called fetching a sample. Once retrieved,\nthese samples may be used for various purposes such as a key to a stick-table,\nbut most common usages consist in matching them against predefined constant\ndata called patterns.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.1. ACL basics", "content": "## [7.1.](#7.1)ACL basics\n\n```\nAccess Control Lists (ACL) consist in declaring a named method to compare any\npiece of information against a list of pre-defined patterns. They should be\nseen as practically equivalent to functions in most programming languages, in\nthat their declaration makes them available to be later called when needed.\nTheir evaluation only returns a match or a mismatch, which is comparable to\nbooleans in many programming languages. Contrary to functions in programming\nlanguages, ACLs may be overloaded as many times as needed in order to define\nadditional matching methods for the same name. In this case they will all be\nevaluated in their declaration order until one matches.\n\nThe use of ACLs provides a flexible solution to perform content switching and\ngenerally to take decisions based on content extracted from the request, the\nresponse or any environmental status. The principle is simple :\n\n  - extract a data sample from a stream, table or the environment\n  - optionally apply some format conversion to the extracted sample\n  - apply one or multiple pattern matching methods on this sample\n  - perform actions only when a pattern matches the sample\n\nThe actions generally consist in blocking a request, selecting a backend, or\nadding a header.\n\nIn order to define a test, the \"aclThis keyword is available in sections :Fcgi-app sectionAlphabetically sorted keywords referenceFetching samples from internal states\" keyword is used. The syntax is :\n\n   acl <aclname> <criterion> [flags] [operator] [<value>] ...\n\nThis creates a new ACL <aclname> or completes an existing one with new tests.\nThose tests apply to the portion of request/response specified in <criterion>\nand may be adjusted with optional flags [flags]. Some criteria also support\nan operator which may be specified before the set of values. Optionally some\nconversion operators may be applied to the sample, and they will be specified\nas a comma-delimited list of keywords just after the first keyword. The values\nare of the type supported by the criterion, and are separated by spaces.\n\nACL names must be formed from upper and lower case letters, digits, '-' (dash),\n'_' (underscore) , '.' (dot) and ':' (colon). ACL names are case-sensitive,\nwhich means that \"my_acl\" and \"My_Acl\" are two different ACLs.\n\nThere is no enforced limit to the number of ACLs. The unused ones do not affect\nperformance, they just consume a small amount of memory.\n\nThe criterion generally is the name of a sample fetch method, or one of its ACL\nspecific declinations. The default test method is implied by the output type of\nthis sample fetch method. The ACL declinations can describe alternate matching\nmethods of a same sample fetch method. The sample fetch methods are the only\nones supporting a conversion.\n\nSample fetch methods return data which can be of the following types :\n  - boolean\n  - integer (signed or unsigned)\n  - IPv4 or IPv6 address\n  - string\n  - data block\n\nConverters transform any of these data into any of these. For example, some\nconverters might convert a string to a lower-case string while other ones\nwould turn a string to an IPv4 address, or apply a netmask to an IP address.\nThe resulting sample is of the type of the last converter applied to the list,\nwhich defaults to the type of the sample fetch method.\n\nEach sample or converter returns data of a specific type, specified with its\nkeyword in this documentation. When an ACL is declared using a standard sample\nfetch method, certain types automatically involved a default matching method\nwhich are summarized in the table below :\n\n   +---------------------+-----------------+\n   | Sample or converter | Default         |\n   |    output type      | matching method |\n   +---------------------+-----------------+\n   | boolean             | bool            |\n   +---------------------+-----------------+\n   | integer             | int             |\n   +---------------------+-----------------+\n   | ip                  | ip              |\n   +---------------------+-----------------+\n   | string              | str             |\n   +---------------------+-----------------+\n   | binary              | none, use \"-m\"  |\n   +---------------------+-----------------+\n\nNote that in order to match a binary samples, it is mandatory to specify a\nmatching method, see below.\n\nThe ACL engine can match these types against patterns of the following types :\n  - boolean\n  - integer or integer range\n  - IP address / network\n  - string (exact, substring, suffix, prefix, subdir, domain)\n  - regular expression\n  - hex block\n\nThe following ACL flags are currently supported :\n\n   -i : ignore case during matching of all subsequent patterns.\n   -f : load patterns from a list.\n   -m : use a specific pattern matching method\n   -n : forbid the DNS resolutions\n   -M : load the file pointed by -f like a map.\n   -u : force the unique id of the ACL\n   -- : force end of flags. Useful when a string looks like one of the flags.\n\nThe \"-f\" flag is followed by the name that must follow the format described in\n2.7. about name format for maps and ACLs. It is even possible to pass multiple\n\"-f\" arguments if the patterns are to be loaded from multiple lists. if an\nexisting file is referenced, all lines will be read as individual values. Empty\nlines as well as lines beginning with a sharp ('#') will be ignored. All\nleading spaces and tabs will be stripped. If it is absolutely necessary to\ninsert a valid pattern beginning with a sharp, just prefix it with a space so\nthat it is not taken for a comment. Depending on the data type and match\nmethod, HAProxy may load the lines into a binary tree, allowing very fast\nlookups. This is true for IPv4 and exact string matching. In this case,\nduplicates will automatically be removed.\n\nThe \"-M\" flag allows an ACL to use a map. If this flag is set, the list is\nparsed as two column entries. The first column contains the patterns used by the\nACL, and the second column contain the samples. The sample can be used later by\na map. This can be useful in some rare cases where an ACL would just be used to\ncheck for the existence of a pattern in a map before a mapping is applied.\n\nThe \"-u\" flag forces the unique id of the ACL. This unique id is used with the\nsocket interface to identify ACL and dynamically change its values. Note that a\nfile is always identified by its name even if an id is set.\n\nAlso, note that the \"-i\" flag applies to subsequent entries and not to entries\nloaded from files preceding it. For instance :\n\n    acl valid-ua hdr(user-agent) -f exact-ua.lst -i -f generic-ua.lst test\n\nIn this example, each line of \"exact-ua.lst\" will be exactly matched against\nthe \"user-agent\" header of the request. Then each line of \"generic-ua\" will be\ncase-insensitively matched. Then the word \"test\" will be insensitively matched\nas well.\n\nThe \"-m\" flag is used to select a specific pattern matching method on the input\nsample. All ACL-specific criteria imply a pattern matching method and generally\ndo not need this flag. However, this flag is useful with generic sample fetch\nmethods to describe how they're going to be matched against the patterns. This\nis required for sample fetches which return data type for which there is no\nobvious matching method (e.g. string or binary). When \"-m\" is specified and\nfollowed by a pattern matching method name, this method is used instead of the\ndefault one for the criterion. This makes it possible to match contents in ways\nthat were not initially planned, or with sample fetch methods which return a\nstring. The matching method also affects the way the patterns are parsed.\n\nThe \"-n\" flag forbids the dns resolutions. It is used with the load of ip files.\nBy default, if the parser cannot parse ip address it considers that the parsed\nstring is maybe a domain name and try dns resolution. The flag \"-n\" disable this\nresolution. It is useful for detecting malformed ip lists. Note that if the DNS\nserver is not reachable, the HAProxy configuration parsing may last many minutes\nwaiting for the timeout. During this time no error messages are displayed. The\nflag \"-n\" disable this behavior. Note also that during the runtime, this\nfunction is disabled for the dynamic acl modifications.\n\nThere are some restrictions however. Not all methods can be used with all\nsample fetch methods. Also, if \"-m\" is used in conjunction with \"-f\", it must\nbe placed first. The pattern matching method must be one of the following :\n\n  - \"found\" : only check if the requested sample could be found in the stream,\n              but do not compare it against any pattern. It is recommended not\n              to pass any pattern to avoid confusion. This matching method is\n              particularly useful to detect presence of certain contents such\n              as headers, cookies, etc... even if they are empty and without\n              comparing them to anything nor counting them.\n\n  - \"boolThis keyword is available in sections :ConvertersFetching samples from internal states\"  : check the value as a boolean. It can only be applied to fetches\n              which return a boolean or integer value, and takes no pattern.\n              Value zero or false does not match, all other values do match.\n\n  - \"int\"   : match the value as an integer. It can be used with integer and\n              boolean samples. Boolean false is integer 0, true is integer 1.\n\n  - \"ip\"    : match the value as an IPv4 or IPv6 address. It is compatible\n              with IP address samples only, so it is implied and never needed.\n\n  - \"bin\"   : match the contents against a hexadecimal string representing a\n              binary sequence. This may be used with binary or string samples.\n\n  - \"len\"   : match the sample's length as an integer. This may be used with\n              binary or string samples.\n\n  - \"str\"   : exact match : match the contents against a string. This may be\n              used with binary or string samples.\n\n  - \"sub\"   : substring match : check that the contents contain at least one of\n              the provided string patterns. This may be used with binary or\n              string samples.\n\n  - \"reg\"   : regex match : match the contents against a list of regular\n              expressions. This may be used with binary or string samples.\n\n  - \"beg\"   : prefix match : check that the contents begin like the provided\n              string patterns. This may be used with binary or string samples.\n\n  - \"end\"   : suffix match : check that the contents end like the provided\n              string patterns. This may be used with binary or string samples.\n\n  - \"dir\"   : subdir match : check that a slash-delimited portion of the\n              contents exactly matches one of the provided string patterns.\n              This may be used with binary or string samples.\n\n  - \"dom\"   : domain match : check that a dot-delimited portion of the contents\n              exactly match one of the provided string patterns. This may be\n              used with binary or string samples.\n\nFor example, to quickly detect the presence of cookie \"JSESSIONID\" in an HTTP\nrequest, it is possible to do :\n\n    acl jsess_present req.cook(JSESSIONID) -m found\n\nIn order to apply a regular expression on the 500 first bytes of data in the\nbuffer, one would use the following acl :\n\n    acl script_tag req.payload(0,500) -m reg -i <script>\n\nOn systems where the regex library is much slower when using \"-i\", it is\npossible to convert the sample to lowercase before matching, like this :\n\n    acl script_tag req.payload(0,500),lower -m reg <script>\n\nAll ACL-specific criteria imply a default matching method. Most often, these\ncriteria are composed by concatenating the name of the original sample fetch\nmethod and the matching method. For example, \"hdr_beg\" applies the \"beg\" match\nto samples retrieved using the \"hdr\" fetch method. This matching method is only\nusable when the keyword is used alone, without any converter. In case any such\nconverter were to be applied after such an ACL keyword, the default matching\nmethod from the ACL keyword is simply ignored since what will matter for the\nmatching is the output type of the last converter. Since all ACL-specific\ncriteria rely on a sample fetch method, it is always possible instead to use\nthe original sample fetch method and the explicit matching method using \"-m\".\n\nIf an alternate match is specified using \"-m\" on an ACL-specific criterion,\nthe matching method is simply applied to the underlying sample fetch method.\nFor example, all ACLs below are exact equivalent :\n\n    acl short_form  hdr_beg(host)        www.\n    acl alternate1  hdr_beg(host) -m beg www.\n    acl alternate2  hdr_dom(host) -m beg www.\n    acl alternate3  hdr(host)     -m beg www.\n\n\nThe table below summarizes the compatibility matrix between sample or converter\ntypes and the pattern types to fetch against. It indicates for each compatible\ncombination the name of the matching method to be used, surrounded with angle\nbrackets \">\" and \"<\" when the method is the default one and will work by\ndefault without \"-m\".\n\n                           +-------------------------------------------------+\n                           |                Input sample type                |\n    +----------------------+---------+---------+---------+---------+---------+\n    |     pattern type     | boolean | integer |   ip    | string  | binary  |\n    +----------------------+---------+---------+---------+---------+---------+\n    | none (presence only) |  found  |  found  |  found  |  found  |  found  |\n    +----------------------+---------+---------+---------+---------+---------+\n    | none (boolean value) |>  bool <|   bool  |         |   bool  |         |\n    +----------------------+---------+---------+---------+---------+---------+\n    | integer (value)      |   int   |>  int  <|   int   |   int   |         |\n    +----------------------+---------+---------+---------+---------+---------+\n    | integer (length)     |   len   |   len   |   len   |   len   |   len   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | IP address           |         |         |>   ip  <|    ip   |    ip   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | exact string         |   str   |   str   |   str   |>  str  <|   str   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | prefix               |   beg   |   beg   |   beg   |   beg   |   beg   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | suffix               |   end   |   end   |   end   |   end   |   end   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | substring            |   sub   |   sub   |   sub   |   sub   |   sub   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | subdir               |   dir   |   dir   |   dir   |   dir   |   dir   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | domain               |   dom   |   dom   |   dom   |   dom   |   dom   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | regex                |   reg   |   reg   |   reg   |   reg   |   reg   |\n    +----------------------+---------+---------+---------+---------+---------+\n    | hex block            |         |         |         |   bin   |   bin   |\n    +----------------------+---------+---------+---------+---------+---------+\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.1.1. Matching booleans", "content": "### [7.1.1.](#7.1.1)Matching booleans\n\n```\nIn order to match a boolean, no value is needed and all values are ignored.\nBoolean matching is used by default for all fetch methods of type \"boolean\".\nWhen boolean matching is used, the fetched value is returned as-is, which means\nthat a boolean \"true\" will always match and a boolean \"false\" will never match.\n\nBoolean matching may also be enforced using \"-m bool\" on fetch methods which\nreturn an integer value. Then, integer value 0 is converted to the boolean\n\"false\" and all other values are converted to \"true\".\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.1.2. Matching integers", "content": "### [7.1.2.](#7.1.2)Matching integers\n\n```\nInteger matching applies by default to integer fetch methods. It can also be\nenforced on boolean fetches using \"-m int\". In this case, \"false\" is converted\nto the integer 0, and \"true\" is converted to the integer 1.\n\nInteger matching also supports integer ranges and operators. Note that integer\nmatching only applies to positive values. A range is a value expressed with a\nlower and an upper bound separated with a colon, both of which may be omitted.\n\nFor instance, \"1024:65535\" is a valid range to represent a range of\nunprivileged ports, and \"1024:\" would also work. \"0:1023\" is a valid\nrepresentation of privileged ports, and \":1023\" would also work.\n\nAs a special case, some ACL functions support decimal numbers which are in fact\ntwo integers separated by a dot. This is used with some version checks for\ninstance. All integer properties apply to those decimal numbers, including\nranges and operators.\n\nFor an easier usage, comparison operators are also supported. Note that using\noperators with ranges does not make much sense and is strongly discouraged.\nSimilarly, it does not make much sense to perform order comparisons with a set\nof values.\n\nAvailable operators for integer matching are :\n\n  eq : true if the tested value equals at least one value\n  ge : true if the tested value is greater than or equal to at least one value\n  gt : true if the tested value is greater than at least one value\n  le : true if the tested value is less than or equal to at least one value\n  lt : true if the tested value is less than at least one value\n\nFor instance, the following ACL matches any negative Content-Length header :\n\n  acl negative-length req.hdr_val(content-length) lt 0\n\nThis one matches SSL versions between 3.0 and 3.1 (inclusive) :\n\n  acl sslv3 req.ssl_ver 3:3.1\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.1.3. Matching strings", "content": "### [7.1.3.](#7.1.3)Matching strings\n\n```\nString matching applies to string or binary fetch methods, and exists in 6\ndifferent forms :\n\n  - exact match     (-m str) : the extracted string must exactly match the\n    patterns;\n\n  - substring match (-m sub) : the patterns are looked up inside the\n    extracted string, and the ACL matches if any of them is found inside;\n\n  - prefix match    (-m beg) : the patterns are compared with the beginning of\n    the extracted string, and the ACL matches if any of them matches.\n\n  - suffix match    (-m end) : the patterns are compared with the end of the\n    extracted string, and the ACL matches if any of them matches.\n\n  - subdir match    (-m dir) : the patterns are looked up anywhere inside the\n    extracted string, delimited with slashes (\"/\"), the beginning or the end\n    of the string. The ACL matches if any of them matches. As such, the string\n    \"/images/png/logo/32x32.png\", would match \"/images\", \"/images/png\",\n    \"images/png\", \"/png/logo\", \"logo/32x32.png\" or \"32x32.png\" but not \"png\"\n    nor \"32x32\".\n\n  - domain match    (-m dom) : the patterns are looked up anywhere inside the\n    extracted string, delimited with dots (\".\"), colons (\":\"), slashes (\"/\"),\n    question marks (\"?\"), the beginning or the end of the string. This is made\n    to be used with URLs. Leading and trailing delimiters in the pattern are\n    ignored. The ACL matches if any of them matches. As such, in the example\n    string \"http://www1.dc-eu.example.com:80/blah\", the patterns \"http\",\n    \"www1\", \".www1\", \"dc-eu\", \"example\", \"com\", \"80\", \"dc-eu.example\",\n    \"blah\", \":www1:\", \"dc-eu.example:80\" would match, but not \"eu\" nor \"dc\".\n    Using it to match domain suffixes for filtering or routing is generally\n    not a good idea, as the routing could easily be fooled by prepending the\n    matching prefix in front of another domain for example.\n\nString matching applies to verbatim strings as they are passed, with the\nexception of the backslash (\"\\\") which makes it possible to escape some\ncharacters such as the space. If the \"-i\" flag is passed before the first\nstring, then the matching will be performed ignoring the case. In order\nto match the string \"-i\", either set it second, or pass the \"--\" flag\nbefore the first string. Same applies of course to match the string \"--\".\n\nDo not use string matches for binary fetches which might contain null bytes\n(0x00), as the comparison stops at the occurrence of the first null byte.\nInstead, convert the binary fetch to a hex string with the hex converter first.\n\n```\n\nExample:```\n\n# matches if the string <tag> is present in the binary sample\nacl tag_found req.payload(0,0),hex -m sub 3C7461673E\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.1.4. Matching regular expressions (regexes)", "content": "### [7.1.4.](#7.1.4)Matching regular expressions (regexes)\n\n```\nJust like with string matching, regex matching applies to verbatim strings as\nthey are passed, with the exception of the backslash (\"\\\") which makes it\npossible to escape some characters such as the space. If the \"-i\" flag is\npassed before the first regex, then the matching will be performed ignoring\nthe case. In order to match the string \"-i\", either set it second, or pass\nthe \"--\" flag before the first string. Same principle applies of course to\nmatch the string \"--\".\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.1.5. Matching arbitrary data blocks", "content": "### [7.1.5.](#7.1.5)Matching arbitrary data blocks\n\n```\nIt is possible to match some extracted samples against a binary block which may\nnot safely be represented as a string. For this, the patterns must be passed as\na series of hexadecimal digits in an even number, when the match method is set\nto binary. Each sequence of two digits will represent a byte. The hexadecimal\ndigits may be used upper or lower case.\n\n```\n\nExample :```\n\n# match \"Hello\\n\" in the input stream (\\x48 \\x65 \\x6c \\x6c \\x6f \\x0a)\nacl hello req.payload(0,6) -m bin 48656c6c6f0a\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.1.6. Matching IPv4 and IPv6 addresses", "content": "### [7.1.6.](#7.1.6)Matching IPv4 and IPv6 addresses\n\n```\nIPv4 addresses values can be specified either as plain addresses or with a\nnetmask appended, in which case the IPv4 address matches whenever it is\nwithin the network. Plain addresses may also be replaced with a resolvable\nhost name, but this practice is generally discouraged as it makes it more\ndifficult to read and debug configurations. If hostnames are used, you should\nat least ensure that they are present in /etc/hosts so that the configuration\ndoes not depend on any random DNS match at the moment the configuration is\nparsed.\n\nThe dotted IPv4 address notation is supported in both regular as well as the\nabbreviated form with all-0-octets omitted:\n\n    +------------------+------------------+------------------+\n    |   Example 1      |     Example 2    |     Example 3    |\n    +------------------+------------------+------------------+\n    |  192.168.0.1     |   10.0.0.12      |   127.0.0.1      |\n    |  192.168.1       |   10.12          |   127.1          |\n    |  192.168.0.1/22  |   10.0.0.12/8    |   127.0.0.1/8    |\n    |  192.168.1/22    |   10.12/8        |   127.1/8        |\n    +------------------+------------------+------------------+\n\nNotice that this is different from RFC 4632 CIDR address notation in which\n192.168.42/24 would be equivalent to 192.168.42.0/24.\n\nIPv6 may be entered in their usual form, with or without a netmask appended.\nOnly bit counts are accepted for IPv6 netmasks. In order to avoid any risk of\ntrouble with randomly resolved IP addresses, host names are never allowed in\nIPv6 patterns.\n\nHAProxy is also able to match IPv4 addresses with IPv6 addresses in the\nfollowing situations :\n  - tested address is IPv4, pattern address is IPv4, the match applies\n    in IPv4 using the supplied mask if any.\n  - tested address is IPv6, pattern address is IPv6, the match applies\n    in IPv6 using the supplied mask if any.\n  - tested address is IPv6, pattern address is IPv4, the match applies in IPv4\n    using the pattern's mask if the IPv6 address matches with 2002:IPV4::,\n    ::IPV4 or ::ffff:IPV4, otherwise it fails.\n  - tested address is IPv4, pattern address is IPv6, the IPv4 address is first\n    converted to IPv6 by prefixing ::ffff: in front of it, then the match is\n    applied in IPv6 using the supplied IPv6 mask.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.2. Using ACLs to form conditions", "content": "## [7.2.](#7.2)Using ACLs to form conditions\n\n```\nSome actions are only performed upon a valid condition. A condition is a\ncombination of ACLs with operators. 3 operators are supported :\n\n  - AND (implicit)\n  - OR  (explicit with the \"or\" keyword or the \"||\" operator)\n  - Negation with the exclamation mark (\"!\")\n\nA condition is formed as a disjunctive form:\n\n   [!]acl1 [!]acl2 ... [!]acln  { or [!]acl1 [!]acl2 ... [!]acln } ...\n\nSuch conditions are generally used after an \"if\" or \"unless\" statement,\nindicating when the condition will trigger the action.\n\nFor instance, to block HTTP requests to the \"*\" URL with methods other than\n\"OPTIONS\", as well as POST requests without content-length, and GET or HEAD\nrequests with a content-length greater than 0, and finally every request which\nis not either GET/HEAD/POST/OPTIONS !\n\n   acl missing_cl req.hdr_cnt(Content-length) eq 0\n   http-request deny if HTTP_URL_STAR !METH_OPTIONS || METH_POST missing_cl\n   http-request deny if METH_GET HTTP_CONTENT\n   http-request deny unless METH_GET or METH_POST or METH_OPTIONS\n\nTo select a different backend for requests to static contents on the \"www\" site\nand to every request on the \"img\", \"video\", \"download\" and \"ftp\" hosts :\n\n   acl url_static  path_beg         /static /images /img /css\n   acl url_static  path_end         .gif .png .jpg .css .js\n   acl host_www    hdr_beg(host) -i www\n   acl host_static hdr_beg(host) -i img. video. download. ftp.\n\n   # now use backend \"static\" for all static-only hosts, and for static URLs\n   # of host \"www\". Use backend \"www\" for the rest.\n   use_backend static if host_static or host_www url_static\n   use_backend www    if host_www\n\nIt is also possible to form rules using \"anonymous ACLs\". Those are unnamed ACL\nexpressions that are built on the fly without needing to be declared. They must\nbe enclosed between braces, with a space before and after each brace (because\nthe braces must be seen as independent words). Example :\n\n   The following rule :\n\n       acl missing_cl req.hdr_cnt(Content-length) eq 0\n       http-request deny if METH_POST missing_cl\n\n   Can also be written that way :\n\n       http-request deny if METH_POST { req.hdr_cnt(Content-length) eq 0 }\n\nIt is generally not recommended to use this construct because it's a lot easier\nto leave errors in the configuration when written that way. However, for very\nsimple rules matching only one source IP address for instance, it can make more\nsense to use them than to declare ACLs with random names. Another example of\ngood use is the following :\n\n   With named ACLs :\n\n        acl site_dead nbsrv(dynamic) lt 2\n        acl site_dead nbsrv(static)  lt 2\n        monitor fail  if site_dead\n\n   With anonymous ACLs :\n\n        monitor fail if { nbsrv(dynamic) lt 2 } || { nbsrv(static) lt 2 }\n\nSee section 4.2 for detailed help on the \"http-request deny\" and \"use_backend\"\nkeywords.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.3. Fetching samples", "content": "## [7.3.](#7.3)Fetching samples\n\n```\nHistorically, sample fetch methods were only used to retrieve data to match\nagainst patterns using ACLs. With the arrival of stick-tables, a new class of\nsample fetch methods was created, most often sharing the same syntax as their\nACL counterpart. These sample fetch methods are also known as \"fetches\". As\nof now, ACLs and fetches have converged. All ACL fetch methods have been made\navailable as fetch methods, and ACLs may use any sample fetch method as well.\n\nThis section details all available sample fetch methods and their output type.\nSome sample fetch methods have deprecated aliases that are used to maintain\ncompatibility with existing configurations. They are then explicitly marked as\ndeprecated and should not be used in new setups.\n\nThe ACL derivatives are also indicated when available, with their respective\nmatching methods. These ones all have a well defined default pattern matching\nmethod, so it is never necessary (though allowed) to pass the \"-m\" option to\nindicate how the sample will be matched using ACLs.\n\nAs indicated in the sample type versus matching compatibility matrix above,\nwhen using a generic sample fetch method in an ACL, the \"-m\" option is\nmandatory unless the sample type is one of boolean, integer, IPv4 or IPv6. When\nthe same keyword exists as an ACL keyword and as a standard fetch method, the\nACL engine will automatically pick the ACL-only one by default.\n\nSome of these keywords support one or multiple mandatory arguments, and one or\nmultiple optional arguments. These arguments are strongly typed and are checked\nwhen the configuration is parsed so that there is no risk of running with an\nincorrect argument (e.g. an unresolved backend name). Fetch function arguments\nare passed between parenthesis and are delimited by commas. When an argument\nis optional, it will be indicated below between square brackets ('[ ]'). When\nall arguments are optional, the parenthesis may be omitted.\n\nThus, the syntax of a standard sample fetch method is one of the following :\n   - name\n   - name(arg1)\n   - name(arg1,arg2)\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.3.1. Converters", "content": "### [7.3.1.](#7.3.1)Converters\n\n```\nSample fetch methods may be combined with transformations to be applied on top\nof the fetched sample (also called \"converters\"). These combinations form what\nis called \"sample expressions\" and the result is a \"sample\". Initially this\nwas only supported by \"stick on\" and \"stick store-request\" directives but this\nhas now be extended to all places where samples may be used (ACLs, log-format,\nunique-id-format, add-header, ...).\n\nThese transformations are enumerated as a series of specific keywords after the\nsample fetch method. These keywords may equally be appended immediately after\nthe fetch keyword's argument, delimited by a comma. These keywords can also\nsupport some arguments (e.g. a netmask) which must be passed in parenthesis.\n\nA certain category of converters are bitwise and arithmetic operators which\nsupport performing basic operations on integers. Some bitwise operations are\nsupported (and, or, xor, cpl) and some arithmetic operations are supported\n(add, sub, mul, div, mod, neg). Some comparators are provided (odd, even, not,\nbool) which make it possible to report a match without having to write an ACL.\n\nThe following keywords are supported:\n\n```\n\nkeywordinput typeoutput type[51d.single(prop[,prop*])](#7-51d.single)stringstring[add(value)](#7-add)integerinteger[add_item(delim[,var[,suff]])](#7-add_item)stringstring[aes_gcm_dec(bits,nonce,key,aead_tag)](#7-aes_gcm_dec)binarybinary[aes_gcm_enc(bits,nonce,key,aead_tag)](#7-aes_gcm_enc)binarybinary[and(value)](#7-and)integerinteger[b64dec](#7-b64dec)stringbinary[base2](#7-base2)binarystring[base64](#7-base64)binarystring[be2dec(separator,chunk_size[,truncate])](#7-be2dec)binarystring[le2dec(separator,chunk_size[,truncate])](#7-le2dec)binarystring[be2hex([separator[,chunk_size[,truncate]]])](#7-be2hex)binarystring[bool](#7-bool)integerboolean[bytes(offset[,length])](#7-bytes)binarybinary[capture-req(id)](#7-capture-req)stringstring[capture-res(id)](#7-capture-res)stringstring[concat([start[,var[,end]]])](#7-concat)stringstring[cpl](#7-cpl)integerinteger[crc32([avalanche])](#7-crc32)binaryinteger[crc32c([avalanche])](#7-crc32c)binaryintegerkeywordinput typeoutput type[cut_crlf](#7-cut_crlf)stringstring[da-csv-conv(prop[,prop*])](#7-da-csv-conv)stringstring[date](#7-date)stringinteger[debug([prefix][,destination])](#7-debug)anysame[digest(algorithm)](#7-digest)binarybinary[div(value)](#7-div)integerinteger[djb2([avalanche])](#7-djb2)binaryinteger[even](#7-even)integerboolean[field(index,delimiters[,count])](#7-field)stringstring[fix_is_valid](#7-fix_is_valid)binaryboolean[fix_tag_value(tag)](#7-fix_tag_value)binarybinary[hex](#7-hex)binarystring[hex2i](#7-hex2i)binaryinteger[hmac(algorithm,key)](#7-hmac)binarybinary[host_only](#7-host_only)stringstring[htonl](#7-htonl)integerinteger[http_date([offset[,unit]])](#7-http_date)integerstring[iif(true,false)](#7-iif)booleanstring[in_table([table])](#7-in_table)anyboolean[ipmask(mask4[,mask6])](#7-ipmask)addressaddresskeywordinput typeoutput type[json([input-code])](#7-json)stringstring[json_query(json_path[,output_type])](#7-json_query)string_outtype_[jwt_header_query([json_path[,output_type]])](#7-jwt_header_query)stringstring[jwt_payload_query([json_path[,output_type]])](#7-jwt_payload_query)stringstring[jwt_verify(alg,key)](#7-jwt_verify)stringinteger[language(value[,default])](#7-language)stringstring[length](#7-length)stringinteger[lower](#7-lower)stringstring[ltime(format[,offset])](#7-ltime)integerstring[ltrim(chars)](#7-ltrim)stringstring[map(map_name[,default_value])](#7-map)stringstring[map_match(map_name[,default_value])](#7-map_match)_match_string[map_match_output(map_name[,default_value])](#7-map_match_output)_match__output_[mod(value)](#7-mod)integerinteger[mqtt_field_value(pkt_type,fieldname_or_prop_ID)](#7-mqtt_field_value)binarybinary[mqtt_is_valid](#7-mqtt_is_valid)binaryboolean[ms_ltime(format[,offset])](#7-ms_ltime)integerstring[ms_utime(format[,offset])](#7-ms_utime)integerstring[mul(value)](#7-mul)integerinteger[nbsrv](#7-nbsrv)stringintegerkeywordinput typeoutput type[neg](#7-neg)integerinteger[not](#7-not)integerboolean[odd](#7-odd)integerboolean[or(value)](#7-or)integerinteger[param(name[,delim])](#7-param)stringstring[port_only](#7-port_only)stringinteger[protobuf(field_number[,field_type])](#7-protobuf)binarybinary[regsub(regex,subst[,flags])](#7-regsub)stringstring[rfc7239_field(field)](#7-rfc7239_field)stringstring[rfc7239_is_valid](#7-rfc7239_is_valid)stringboolean[rfc7239_n2nn](#7-rfc7239_n2nn)stringaddress / str[rfc7239_n2np](#7-rfc7239_n2np)stringinteger / str[rfc7239_nn](#7-rfc7239_nn)address/strstring[rfc7239_np](#7-rfc7239_np)integer/strstring[rtrim(chars)](#7-rtrim)stringstring[sdbm([avalanche])](#7-sdbm)binaryinteger[secure_memcmp(var)](#7-secure_memcmp)stringboolean[set-var(var[,cond...])](#7-set-var)anysame[sha1](#7-sha1)binarybinary[sha2([bits])](#7-sha2)binarybinarykeywordinput typeoutput type[srv_is_up](#7-srv_is_up)stringboolean[srv_queue](#7-srv_queue)stringinteger[strcmp(var)](#7-strcmp)stringboolean[sub(value)](#7-sub)integerinteger[table_bytes_in_rate([table])](#7-table_bytes_in_rate)anyinteger[table_bytes_out_rate([table])](#7-table_bytes_out_rate)anyinteger[table_clr_gpc(idx[,table])](#7-table_clr_gpc)anyinteger[table_clr_gpc0([table])](#7-table_clr_gpc0)anyinteger[table_clr_gpc1([table])](#7-table_clr_gpc1)anyinteger[table_conn_cnt([table])](#7-table_conn_cnt)anyinteger[table_conn_cur([table])](#7-table_conn_cur)anyinteger[table_conn_rate([table])](#7-table_conn_rate)anyinteger[table_expire([table[,default_value]])](#7-table_expire)anyinteger[table_glitch_cnt([table])](#7-table_glitch_cnt)anyinteger[table_glitch_rate([table])](#7-table_glitch_rate)anyinteger[table_gpc(idx[,table])](#7-table_gpc)anyinteger[table_gpc0([table])](#7-table_gpc0)anyinteger[table_gpc0_rate([table])](#7-table_gpc0_rate)anyinteger[table_gpc1([table])](#7-table_gpc1)anyinteger[table_gpc1_rate([table])](#7-table_gpc1_rate)anyintegerkeywordinput typeoutput type[table_gpc_rate(idx[,table])](#7-table_gpc_rate)anyinteger[table_gpt(idx[,table])](#7-table_gpt)anyinteger[table_gpt0([table])](#7-table_gpt0)anyinteger[table_http_err_cnt([table])](#7-table_http_err_cnt)anyinteger[table_http_err_rate([table])](#7-table_http_err_rate)anyinteger[table_http_fail_cnt([table])](#7-table_http_fail_cnt)anyinteger[table_http_fail_rate([table])](#7-table_http_fail_rate)anyinteger[table_http_req_cnt([table])](#7-table_http_req_cnt)anyinteger[table_http_req_rate([table])](#7-table_http_req_rate)anyinteger[table_idle([table[,default_value]])](#7-table_idle)anyinteger[table_inc_gpc(idx[,table])](#7-table_inc_gpc)anyinteger[table_inc_gpc0([table])](#7-table_inc_gpc0)anyinteger[table_inc_gpc1([table])](#7-table_inc_gpc1)anyinteger[table_kbytes_in([table])](#7-table_kbytes_in)anyinteger[table_kbytes_out([table])](#7-table_kbytes_out)anyinteger[table_server_id([table])](#7-table_server_id)anyinteger[table_sess_cnt([table])](#7-table_sess_cnt)anyinteger[table_sess_rate([table])](#7-table_sess_rate)anyinteger[table_trackers([table])](#7-table_trackers)anyinteger[ub64dec](#7-ub64dec)stringstringkeywordinput typeoutput type[ub64enc](#7-ub64enc)stringstring[ungrpc(field_number[,field_type])](#7-ungrpc)binarybinary / int[unset-var(var)](#7-unset-var)anysame[upper](#7-upper)stringstring[url_dec([in_form])](#7-url_dec)stringstring[url_enc([enc_type])](#7-url_enc)stringstring[us_ltime(format[,offset])](#7-us_ltime)integerstring[us_utime(format[,offset])](#7-us_utime)integerstring[utime(format[,offset])](#7-utime)integerstring[when(condition)](#7-when)anysame[word(index,delimiters[,count])](#7-word)stringstring[wt6([avalanche])](#7-wt6)binaryinteger[x509_v_err_str](#7-x509_v_err_str)integerstring[xor(value)](#7-xor)integerinteger[xxh3([seed])](#7-xxh3)binaryinteger[xxh32([seed])](#7-xxh32)binaryinteger```\nThe detailed list of converter keywords follows:\n\n```\n\n**[51d.single](#7.3.1-51d.single)**(<prop>[,<prop>*])```\nReturns values for the properties requested as a string, where values are\nseparated by the delimiter specified with \"51degrees-property-separator\".\nThe device is identified using the User-Agent header passed to the\nconverter. The function can be passed up to five property names, and if a\nproperty name can't be found, the value \"NoData\" is returned.\n\n```\n\nExample :```\n\n# Here the header \"X-51D-DeviceTypeMobileTablet\" is added to the request,\n# containing values for the three properties requested by using the\n# User-Agent passed to the converter.\nfrontend http-in\n  bind *:8081\n  default_backend servers\n  http-request set-header X-51D-DeviceTypeMobileTablet \\\n    %[req.fhdr(User-Agent),51d.single(DeviceType,IsMobile,IsTablet)]\n\n```\n\n**[add](#7.3.1-add)**(<value>)```\nAdds <value> to the input value of type signed integer, and returns the\nresult as a signed integer. <value> can be a numeric value or a variable\nname. See section 2.8 about variables for details.\n\n```\n\n**[add_item](#7.3.1-add_item)**(<delim>[,<var>[,<suff>]])```\nConcatenates a minimum of 2 and up to 3 fields after the current sample which\nis then turned into a string. The first one, <delim>, is a constant string,\nthat will be appended immediately after the existing sample if an existing\nsample is not empty and either the <var> or the <suff> is not empty. The\nsecond one, <var>, is a variable name. The variable will be looked up, its\ncontents converted to a string, and it will be appended immediately after\nthe <delim> part. If the variable is not found, nothing is appended. It is\noptional and may optionally be followed by a constant string <suff>, however\nif <var> is omitted, then <suff> is mandatory. This converter is similar to\nthe concat converter and can be used to build new variables made of a\nsuccession of other variables but the main difference is that it does the\nchecks if adding a delimiter makes sense as wouldn't be the case if e.g. the\ncurrent sample is empty. That situation would require 2 separate rules using\nconcat converter where the first rule would have to check if the current\nsample string is empty before adding a delimiter. If commas or closing\nparenthesis are needed as delimiters, they must be protected by quotes or\nbackslashes, themselves protected so that they are not stripped by the first\nlevel parser (please see section 2.2 for quoting and escaping). See examples\nbelow.\n\n```\n\nExample:```\n\nhttp-request set-var(req.tagged) 'var(req.tagged),add_item(\",\",req.score1,\"(site1)\") if src,in_table(site1)'\nhttp-request set-var(req.tagged) 'var(req.tagged),add_item(\",\",req.score2,\"(site2)\") if src,in_table(site2)'\nhttp-request set-var(req.tagged) 'var(req.tagged),add_item(\",\",req.score3,\"(site3)\") if src,in_table(site3)'\nhttp-request set-header x-tagged %[var(req.tagged)]\n\nhttp-request set-var(req.tagged) 'var(req.tagged),add_item(\",\",req.score1),add_item(\",\",req.score2)'\nhttp-request set-var(req.tagged) 'var(req.tagged),add_item(\",\",,(site1))' if src,in_table(site1)\n\n```\n\n**[aes_gcm_dec](#7.3.1-aes_gcm_dec)**(<bits>,<nonce>,<key>,<aead_tag>)```\nDecrypts the raw byte input using the AES128-GCM, AES192-GCM or\nAES256-GCM algorithm, depending on the <bits> parameter. All other parameters\nneed to be base64 encoded and the returned result is in raw byte format.\nIf the <aead_tag> validation fails, the converter doesn't return any data.\nThe <nonce>, <key> and <aead_tag> can either be strings or variables. This\nconverter requires at least OpenSSL 1.0.1.\n\n```\n\nExample:```\n\nhttp-response set-header X-Decrypted-Text %[var(txn.enc),\\\n  aes_gcm_dec(128,txn.nonce,Zm9vb2Zvb29mb29wZm9vbw==,txn.aead_tag)]\n\n```\n\n**[aes_gcm_enc](#7.3.1-aes_gcm_enc)**(<bits>,<nonce>,<key>,<aead_tag>)```\nEncrypts the raw byte input using the AES128-GCM, AES192-GCM or\nAES256-GCM algorithm, depending on the <bits> parameter. <nonce> and <key>\nparameters must be base64 encoded. Last parameter, <aead_tag>, must be a\nvariable. The AEAD tag will be stored base64 encoded into that variable.\nThe returned result is in raw byte format. The <nonce> and <key> can either\nbe strings or variables. This converter requires at least OpenSSL 1.0.1.\n\n```\n\nExample:```\n\nhttp-response set-header X-Encrypted-Text %[var(txn.plain),\\\n  aes_gcm_enc(128,txn.nonce,Zm9vb2Zvb29mb29wZm9vbw==,txn.aead_tag)]\n\n```\n\n**[and](#7.3.1-and)**(<value>)```\nPerforms a bitwise \"AND\" between <value> and the input value of type signed\ninteger, and returns the result as an signed integer. <value> can be a\nnumeric value or a variable name. See section 2.8 about variables for details.\n\n```\n\n**[b64dec](#7.3.1-b64dec)**```\nConverts (decodes) a base64 encoded input string to its binary\nrepresentation. It performs the inverse operation of base64().\nFor base64url(\"URL and Filename Safe Alphabet\" (RFC 4648)) variant\nsee \"ub64dec\".\n\n```\n\n**[base2](#7.3.1-base2)**```\nConverts a binary input sample to a binary string containing eight binary\ndigits per input byte. It is used to be able to perform longest prefix match\non types where the native representation does not allow prefix matching, for\nexample IP prefixes.\n\n```\n\n**[base64](#7.3.1-base64)**```\nConverts a binary input sample to a base64 string. It is used to log or\ntransfer binary content in a way that can be reliably transferred (e.g.\nan SSL ID can be copied in a header). For base64url(\"URL and Filename\nSafe Alphabet\" (RFC 4648)) variant see \"ub64enc\".\n\n```\n\n**[be2dec](#7.3.1-be2dec)**(<separator>,<chunk_size>[,<truncate>])```\nConverts big-endian binary input sample to a string containing an unsigned\ninteger number per <chunk_size> input bytes. <separator> is put every\n<chunk_size> binary input bytes if specified. <truncate> flag indicates\nwhatever binary input is truncated at <chunk_size> boundaries. <chunk_size>\nmaximum value is limited by the size of long long int (8 bytes).\n\n```\n\nExample:```\n\nbin(01020304050607),be2dec(:,2)   # 258:772:1286:7\nbin(01020304050607),be2dec(-,2,1) # 258-772-1286\nbin(01020304050607),be2dec(,2,1)  # 2587721286\nbin(7f000001),be2dec(.,1)         # 127.0.0.1\n\n```\n\n**[le2dec](#7.3.1-le2dec)**(<separator>,<chunk_size>[,<truncate>])```\nConverts little-endian binary input sample to a string containing an unsigned\ninteger number per <chunk_size> input bytes. <separator> is inserted every\n<chunk_size> binary input bytes if specified. The <truncate> flag indicates\nwhether the binary input is truncated at <chunk_size> boundaries. The maximum\nvalue for <chunk_size> is limited by the size of long long int (8 bytes).\n\n```\n\nExample:```\n\nbin(01020304050607),le2dec(:,2)   # 513:1284:2055:7\nbin(01020304050607),le2dec(-,2,1) # 513-1284-2055\nbin(01020304050607),le2dec(,2,1)  # 51312842055\nbin(7f000001),le2dec(.,1)         # 127.0.0.1\n\n```\n\n**[be2hex](#7.3.1-be2hex)**([<separator>[,<chunk_size>[,<truncate>]]])```\nConverts big-endian binary input sample to a hex string containing two hex\ndigits per input byte. It is used to log or transfer hex dumps of some\nbinary input data in a way that can be reliably transferred (e.g. an SSL ID\ncan be copied in a header). <separator> is put every <chunk_size> binary\ninput bytes if specified. <truncate> flag indicates whatever binary input is\ntruncated at <chunk_size> boundaries.\n\n```\n\nExample:```\n\nbin(01020304050607),be2hex         # 01020304050607\nbin(01020304050607),be2hex(:,2)    # 0102:0304:0506:07\nbin(01020304050607),be2hex(--,2,1) # 0102--0304--0506\nbin(0102030405060708),be2hex(,3,1) # 010203040506\n\n```\n\n**[bool](#7.3.1-bool)**```\nReturns a boolean TRUE if the input value of type signed integer is\nnon-null, otherwise returns FALSE. Used in conjunction with and(), it can be\nused to report true/false for bit testing on input values (e.g. verify the\npresence of a flag).\n\n```\n\n**[bytes](#7.3.1-bytes)**(<offset>[,<length>])```\nExtracts some bytes from an input binary sample. The result is a binary\nsample starting at an offset (in bytes) of the original sample and\noptionally truncated at the given length. <offset> and <length> can be numeric\nvalues or variable names. The converter returns an empty sample if either\n<offset> or <length> is invalid. Invalid <offset> means a negative value or a\nvalue >= length of the input sample. Invalid <length> means a negative value\nor, in some cases, a value bigger than the length of the input sample.\n\n```\n\nExample:```\n\nhttp-request set-var(txn.input) req.hdr(input) # let's say input is \"012345\"\n\nhttp-response set-header bytes_0 \"%[var(txn.input),bytes(0)]\"  # outputs \"012345\"\nhttp-response set-header bytes_1_3 \"%[var(txn.input),bytes(1,3)]\"  # outputs \"123\"\n\nhttp-response set-var(txn.var_start) int(1)\nhttp-response set-var(txn.var_length) int(3)\nhttp-response set-header bytes_var1_var3    \"%[var(txn.input),bytes(txn.var_start,txn.var_length)]\"  # outputs \"123\"\n\n```\n\n**[capture-req](#7.3.1-capture-req)**(<id>)```\nCapture the string entry in the request slot <id> and returns the entry as\nis. If the slot doesn't exist, the capture fails silently.\n\n```\n\n**See also:**\"[declare capture](#declare%20capture)\", \"http-request capture\", \"http-response capture\", \"[capture.req.hdr](#capture.req.hdr)\" and \"[capture.res.hdr](#capture.res.hdr)\" (sample fetches).**[capture-res](#7.3.1-capture-res)**(<id>)```\nCapture the string entry in the response slot <id> and returns the entry as\nis. If the slot doesn't exist, the capture fails silently.\n\n```\n\n**See also:**\"[declare capture](#declare%20capture)\", \"http-request capture\", \"http-response capture\", \"[capture.req.hdr](#capture.req.hdr)\" and \"[capture.res.hdr](#capture.res.hdr)\" (sample fetches).**[concat](#7.3.1-concat)**([<start>[,<var>[,<end>]]])```\nConcatenates up to 3 fields after the current sample which is then turned to\na string. The first one, <start>, is a constant string, that will be appended\nimmediately after the existing sample. It may be omitted if not used. The\nsecond one, <var>, is a variable name. The variable will be looked up, its\ncontents converted to a string, and it will be appended immediately after the\n<first> part. If the variable is not found, nothing is appended. It may be\nomitted as well. The third field, <end> is a constant string that will be\nappended after the variable. It may also be omitted. Together, these elements\nallow to concatenate variables with delimiters to an existing set of\nvariables. This can be used to build new variables made of a succession of\nother variables, such as colon-delimited values. If commas or closing\nparenthesis are needed as delimiters, they must be protected by quotes or\nbackslashes, themselves protected so that they are not stripped by the first\nlevel parser. This is often used to build composite variables from other\nones, but sometimes using a format string with multiple fields may be more\nconvenient. See examples below.\n\n```\n\nExample:```\n\ntcp-request session set-var(sess.src) src\ntcp-request session set-var(sess.dn)  ssl_c_s_dn\ntcp-request session set-var(txn.sig) str(),concat(<ip=,sess.ip,>),concat(<dn=,sess.dn,>)\ntcp-request session set-var(txn.ipport) \"str(),concat('addr=(',sess.ip),concat(',',sess.port,')')\"\ntcp-request session set-var-fmt(txn.ipport) \"addr=(%[sess.ip],%[sess.port])\"  ## does the same\nhttp-request set-header x-hap-sig %[var(txn.sig)]\n\n```\n\n**[cpl](#7.3.1-cpl)**```\nTakes the input value of type signed integer, applies a ones-complement\n(flips all bits) and returns the result as an signed integer.\n\n```\n\n**[crc32](#7.3.1-crc32)**([<avalanche>])```\nHashes a binary input sample into an unsigned 32-bit quantity using the CRC32\nhash function. Optionally, it is possible to apply a full avalanche hash\nfunction to the output if the optional <avalanche> argument equals 1. This\nconverter uses the same functions as used by the various hash-based load\nbalancing algorithms, so it will provide exactly the same results. It is\nprovided for compatibility with other software which want a CRC32 to be\ncomputed on some input keys, so it follows the most common implementation as\nfound in Ethernet, Gzip, PNG, etc... It is slower than the other algorithms\nbut may provide a better or at least less predictable distribution. It must\nnot be used for security purposes as a 32-bit hash is trivial to break. See\nalso \"djb2\", \"sdbm\", \"wt6\", \"crc32c\" and the \"hash-type\" directive.\n\n```\n\n**[crc32c](#7.3.1-crc32c)**([<avalanche>])```\nHashes a binary input sample into an unsigned 32-bit quantity using the CRC32C\nhash function. Optionally, it is possible to apply a full avalanche hash\nfunction to the output if the optional <avalanche> argument equals 1. This\nconverter uses the same functions as described in RFC4960, Appendix B [8].\nIt is provided for compatibility with other software which want a CRC32C to be\ncomputed on some input keys. It is slower than the other algorithms and it must\nnot be used for security purposes as a 32-bit hash is trivial to break. See\nalso \"djb2\", \"sdbm\", \"wt6\", \"crc32\" and the \"hash-type\" directive.\n\n```\n\n**[cut_crlf](#7.3.1-cut_crlf)**```\nCuts the string representation of the input sample on the first carriage\nreturn ('\\r') or newline ('\\n') character found. Only the string length is\nupdated.\n\n```\n\n**[da-csv-conv](#7.3.1-da-csv-conv)**(<prop>[,<prop>*])```\nAsks the DeviceAtlas converter to identify the User Agent string passed on\ninput, and to emit a string made of the concatenation of the properties\nenumerated in argument, delimited by the separator defined by the global\nkeyword \"deviceatlas-property-separator\", or by default the pipe character\n('|'). There's a limit of 12 different properties imposed by the HAProxy\nconfiguration language.\n\n```\n\nExample:```\n\nfrontend www\n  bind *:8881\n  default_backend servers\n  http-request set-header X-DeviceAtlas-Data %[req.fhdr(User-Agent),da-csv(primaryHardwareType,osName,osVersion,browserName,browserVersion,browserRenderingEngine)]\n\n```\n\n**[date](#7.3.1-date)**```\nThis converter is used to convert a date from an HTTP header. It can be an IMF\ndate, an ASCTIME date or a RFC850 date. It will output an UNIX timestamp.\n\n```\n\nExample:```\n\nhttp-request return lf-string \"%[str('Sun, 06 Nov 1994 08:49:37 GMT'),date]\\n\" content-type text/plain\n\n```\n\n**[debug](#7.3.1-debug)**([<prefix][,<destination>])```\nThis converter is used as debug tool. It takes a capture of the input sample\nand sends it to event sink <destination>, which may designate a ring buffer\nsuch as \"buf0\", as well as \"stdout\", or \"stderr\". Available sinks may be\nchecked at run time by issuing \"show events\" on the CLI. When not specified,\nthe output will be \"buf0\", which may be consulted via the CLI's \"show events\"\ncommand. An optional prefix <prefix> may be passed to help distinguish\noutputs from multiple expressions. It will then appear before the colon in\nthe output message. The input sample is passed as-is on the output, so that\nit is safe to insert the debug converter anywhere in a chain, even with non-\nprintable sample types.\n\n```\n\nExample:```\n\ntcp-request connection track-sc0 src,debug(track-sc)\n\n```\n\n**[digest](#7.3.1-digest)**(<algorithm>)```\nConverts a binary input sample to a message digest. The result is a binary\nsample. The <algorithm> must be an OpenSSL message digest name (e.g. sha256).\n\nPlease note that this converter is only available when HAProxy has been\ncompiled with USE_OPENSSL.\n\n```\n\n**[div](#7.3.1-div)**(<value>)```\nDivides the input value of type signed integer by <value>, and returns the\nresult as an signed integer. If <value> is null, the largest unsigned\ninteger is returned (typically 2^63-1). <value> can be a numeric value or a\nvariable name. See section 2.8 about variables for details.\n\n```\n\n**[djb2](#7.3.1-djb2)**([<avalanche>])```\nHashes a binary input sample into an unsigned 32-bit quantity using the DJB2\nhash function. Optionally, it is possible to apply a full avalanche hash\nfunction to the output if the optional <avalanche> argument equals 1. This\nconverter uses the same functions as used by the various hash-based load\nbalancing algorithms, so it will provide exactly the same results. It is\nmostly intended for debugging, but can be used as a stick-table entry to\ncollect rough statistics. It must not be used for security purposes as a\n32-bit hash is trivial to break. See also \"crc32\", \"sdbm\", \"wt6\", \"crc32c\",\nand the \"hash-type\" directive.\n\n```\n\n**[even](#7.3.1-even)**```\nReturns a boolean TRUE if the input value of type signed integer is even\notherwise returns FALSE. It is functionally equivalent to \"not,and(1),bool\".\n\n```\n\n**[field](#7.3.1-field)**(<index>,<delimiters>[,<count>])```\nExtracts the substring at the given index counting from the beginning\n(positive index) or from the end (negative index) considering given delimiters\nfrom an input string. Indexes start at 1 or -1 and delimiters are a string\nformatted list of chars. Optionally you can specify <count> of fields to\nextract (default: 1). Value of 0 indicates extraction of all remaining\nfields.\n\n```\n\nExample :```\n\nstr(f1_f2_f3__f5),field(4,_)    # <empty>\nstr(f1_f2_f3__f5),field(5,_)    # f5\nstr(f1_f2_f3__f5),field(2,_,0)  # f2_f3__f5\nstr(f1_f2_f3__f5),field(2,_,2)  # f2_f3\nstr(f1_f2_f3__f5),field(-2,_,3) # f2_f3_\nstr(f1_f2_f3__f5),field(-3,_,0) # f1_f2_f3\n\n```\n\n**[fix_is_valid](#7.3.1-fix_is_valid)**```\nParses a binary payload and performs sanity checks regarding FIX (Financial\nInformation eXchange):\n\n- checks that all tag IDs and values are not empty and the tags IDs are well\n  numeric\n- checks the BeginString tag is the first tag with a valid FIX version\n- checks the BodyLength tag is the second one with the right body length\n- checks the MsgType tag is the third tag.\n- checks that last tag in the message is the CheckSum tag with a valid\n  checksum\n\nDue to current HAProxy design, only the first message sent by the client and\nthe server can be parsed.\n\nThis converter returns a boolean, true if the payload contains a valid FIX\nmessage, false if not.\n\nSee also the fix_tag_value converter.\n\n```\n\nExample:```\n\ntcp-request inspect-delay 10s\ntcp-request content reject unless { req.payload(0,0),fix_is_valid }\n\n```\n\n**[fix_tag_value](#7.3.1-fix_tag_value)**(<tag>)```\nParses a FIX (Financial Information eXchange) message and extracts the value\nfrom the tag <tag>. <tag> can be a string or an integer pointing to the\ndesired tag. Any integer value is accepted, but only the following strings\nare translated into their integer equivalent: BeginString, BodyLength,\nMsgType, SenderCompID, TargetCompID, CheckSum. More tag names can be easily\nadded.\n\nDue to current HAProxy design, only the first message sent by the client and\nthe server can be parsed. No message validation is performed by this\nconverter. It is highly recommended to validate the message first using\nfix_is_valid converter.\n\nSee also the fix_is_valid converter.\n\n```\n\nExample:```\n\ntcp-request inspect-delay 10s\ntcp-request content reject unless { req.payload(0,0),fix_is_valid }\n# MsgType tag ID is 35, so both lines below will return the same content\ntcp-request content set-var(txn.foo) req.payload(0,0),fix_tag_value(35)\ntcp-request content set-var(txn.bar) req.payload(0,0),fix_tag_value(MsgType)\n\n```\n\n**[hex](#7.3.1-hex)**```\nConverts a binary input sample to a hex string containing two hex digits per\ninput byte. It is used to log or transfer hex dumps of some binary input data\nin a way that can be reliably transferred (e.g. an SSL ID can be copied in a\nheader).\n\n```\n\n**[hex2i](#7.3.1-hex2i)**```\nConverts a hex string containing two hex digits per input byte to an\ninteger. If the input value cannot be converted, then zero is returned.\n\n```\n\n**[hmac](#7.3.1-hmac)**(<algorithm>,<key>)```\nConverts a binary input sample to a message authentication code with the given\nkey. The result is a binary sample. The <algorithm> must be one of the\nregistered OpenSSL message digest names (e.g. sha256). The <key> parameter must\nbe base64 encoded and can either be a string or a variable.\n\nPlease note that this converter is only available when HAProxy has been\ncompiled with USE_OPENSSL.\n\n```\n\n**[host_only](#7.3.1-host_only)**```\nConverts a string which contains a Host header value and removes its port.\nThe input must respect the format of the host header value\n(rfc9110#section-7.2). It will support that kind of input: hostname,\nhostname:80, 127.0.0.1, 127.0.0.1:80, [::1], [::1]:80.\n\nThis converter also sets the string in lowercase.\n\n```\n\n**See also:**\"[port_only](#port_only)\" converter which will return the port.**[htonl](#7.3.1-htonl)**```\nConverts the input integer value to its 32-bit binary representation in the\nnetwork byte order. Because sample fetches own signed 64-bit integer, when\nthis converter is used, the input integer value is first casted to an\nunsigned 32-bit integer.\n\n```\n\n**[http_date](#7.3.1-http_date)**([<offset[,<unit>]])```\nConverts an integer supposed to contain a date since epoch to a string\nrepresenting this date in a format suitable for use in HTTP header fields. If\nan offset value is specified, then it is added to the date before the\nconversion is operated. This is particularly useful to emit Date header fields,\nExpires values in responses when combined with a positive offset, or\nLast-Modified values when the offset is negative.\nIf a unit value is specified, then consider the timestamp as either\n\"s\" for seconds (default behavior), \"ms\" for milliseconds, or \"us\" for\nmicroseconds since epoch. Offset is assumed to have the same unit as\ninput timestamp.\n\n```\n\n**[iif](#7.3.1-iif)**(<true>,<false>)```\nReturns the <true> string if the input value is true. Returns the <false>\nstring otherwise.\n\n```\n\nExample:```\n\nhttp-request set-header x-forwarded-proto %[ssl_fc,iif(https,http)]\n\n```\n\n**[in_table](#7.3.1-in_table)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table, a\nboolean false is returned. Otherwise a boolean true is returned. This can be\nused to verify the presence of a certain key in a table tracking some\nelements (e.g. whether or not a source IP address or an Authorization header\nwas already seen).\n\n```\n\n**[ipmask](#7.3.1-ipmask)**(<mask4>[,<mask6>])```\nApply a mask to an IP address, and use the result for lookups and storage.\nThis can be used to make all hosts within a certain mask to share the same\ntable entries and as such use the same server. The mask4 can be passed in\ndotted form (e.g. 255.255.255.0) or in CIDR form (e.g. 24). The mask6 can\nbe passed in quadruplet form (e.g. ffff:ffff::) or in CIDR form (e.g. 64).\nIf no mask6 is given IPv6 addresses will fail to convert for backwards\ncompatibility reasons.\n\n```\n\n**[json](#7.3.1-json)**([<input-code>])```\nEscapes the input string and produces an ASCII output string ready to use as a\nJSON string. The converter tries to decode the input string according to the\n<input-code> parameter. It can be \"ascii\", \"utf8\", \"utf8s\", \"utf8p\" or\n\"utf8ps\". The \"ascii\" decoder never fails. The \"utf8\" decoder detects 3 types\nof errors:\n - bad UTF-8 sequence (lone continuation byte, bad number of continuation\n   bytes, ...)\n - invalid range (the decoded value is within a UTF-8 prohibited range),\n - code overlong (the value is encoded with more bytes than necessary).\n\nThe UTF-8 JSON encoding can produce a \"too long value\" error when the UTF-8\ncharacter is greater than 0xffff because the JSON string escape specification\nonly authorizes 4 hex digits for the value encoding. The UTF-8 decoder exists\nin 4 variants designated by a combination of two suffix letters : \"p\" for\n\"permissive\" and \"s\" for \"silently ignore\". The behaviors of the decoders\nare :\n - \"ascii\"  : never fails;\n - \"utf8\"   : fails on any detected errors;\n - \"utf8s\"  : never fails, but removes characters corresponding to errors;\n - \"utf8p\"  : accepts and fixes the overlong errors, but fails on any other\n              error;\n - \"utf8ps\" : never fails, accepts and fixes the overlong errors, but removes\n              characters corresponding to the other errors.\n\nThis converter is particularly useful for building properly escaped JSON for\nlogging to servers which consume JSON-formatted traffic logs.\n\n```\n\nExample:```\n\ncapture request header Host len 15\ncapture request header user-agent len 150\nlog-format '{\"ip\":\"%[src]\",\"user-agent\":\"%[capture.req.hdr(1),json(utf8s)]\"}'\n\n```\n\n```\nInput request from client 127.0.0.1:\n   GET / HTTP/1.0\n   User-Agent: Very \"Ugly\" UA 1/2\n\nOutput log:\n   {\"ip\":\"127.0.0.1\",\"user-agent\":\"Very \\\"Ugly\\\" UA 1\\/2\"}\n\n```\n\n**[json_query](#7.3.1-json_query)**(<json_path>[,<output_type>])```\nThe json_query converter supports the JSON types string, boolean, number\nand array. Floating point numbers will be returned as a string. By\nspecifying the output_type 'int' the value will be converted to an\nInteger. Arrays will be returned as string, starting and ending with a\nsquare brackets. The content is a CSV. Depending on the data type, the\narray values might be quoted. If the array values are complex types,\nthe string contains the complete json representation of each value\nseparated by a comma. Example result for a roles query to a JWT:\n\n   [\"manage-account\",\"manage-account-links\",\"view-profile\"]\n\nIf conversion is not possible the json_query converter fails.\n\n<json_path> must be a valid JSON Path string as defined in\nhttps://datatracker.ietf.org/doc/draft-ietf-jsonpath-base/\n\nNote: depending on the context and the underlying implementation, extraction\n      of duplicate JSON keys is undefined and might return the first, last,\n      or any other occurrence of the same key from the input content, and if\n      key names are passed encoded, they might not always be matched. In\n      short, this converter is not suitable for content sanitization.\n\n```\n\nExample:```\n\n# get a integer value from the request body\n# \"{\"integer\":4}\" => 5\nhttp-request set-var(txn.pay_int) req.body,json_query('$.integer','int'),add(1)\n\n# get a key with '.' in the name\n# {\"my.key\":\"myvalue\"} => myvalue\nhttp-request set-var(txn.pay_mykey) req.body,json_query('$.my\\\\.key')\n\n# {\"boolean-false\":false} => 0\nhttp-request set-var(txn.pay_boolean_false) req.body,json_query('$.boolean-false')\n\n# get the value of the key 'iss' from a JWT Bearer token\nhttp-request set-var(txn.token_payload) req.hdr(Authorization),word(2,.),ub64dec,json_query('$.iss')\n\n```\n\n**[jwt_header_query](#7.3.1-jwt_header_query)**([<json_path>[,<output_type>]])```\nWhen given a JSON Web Token (JWT) in input, either returns the decoded header\npart of the token (the first base64-url encoded part of the JWT) if no\nparameter is given, or performs a json_query on the decoded header part of\nthe token. See \"json_query\" converter for details about the accepted\njson_path and output_type parameters.\n\nPlease note that this converter is only available when HAProxy has been\ncompiled with USE_OPENSSL.\n\n```\n\n**[jwt_payload_query](#7.3.1-jwt_payload_query)**([<json_path>[,<output_type>]])```\nWhen given a JSON Web Token (JWT) in input, either returns the decoded\npayload part of the token (the second base64-url encoded part of the JWT) if\nno parameter is given, or performs a json_query on the decoded payload part\nof the token. See \"json_query\" converter for details about the accepted\njson_path and output_type parameters.\n\nPlease note that this converter is only available when HAProxy has been\ncompiled with USE_OPENSSL.\n\n```\n\n**[jwt_verify](#7.3.1-jwt_verify)**(<alg>,<key>)```\nPerforms a signature verification for the JSON Web Token (JWT) given in input\nby using the <alg> algorithm and the <key> parameter, which should either\nhold a secret or a path to a public key. The public key should either be in\nthe PKCS#1 format (for RSA keys, starting with BEGIN RSA PUBLIC KEY) or SPKI\nformat (Subject Public Key Info, starting with BEGIN PUBLIC KEY).\nReturns 1 in case of verification success, 0 in case of verification failure\nand a strictly negative value for any other error. Because of all those\nnon-null error return values, the result of this converter should never be\nconverted to a boolean. See below for a full list of the possible return\nvalues.\n\nFor now, only JWS tokens using the Compact Serialization format can be\nprocessed (three dot-separated base64-url encoded strings). All the\nalgorithms mentioned in section 3.1 of RFC7518 are managed (HS, ES, RS and PS\nwith the 256, 384 or 512 key sizes, as well as the special \"none\" case).\n\nIf the used algorithm is of the HMAC family, <key> should be the secret used\nin the HMAC signature calculation. Otherwise, <key> should be the path to the\npublic key that can be used to validate the token's signature. All the public\nkeys that might be used to verify JWTs must be known during init in order to\nbe added into a dedicated cache so that no disk access is required during\nruntime. For this reason, any used public key must be mentioned explicitly at\nleast once in a jwt_verify call. Passing an intermediate variable as second\nparameter is then not advised.\n\nThis converter only verifies the signature of the token and does not perform\na full JWT validation as specified in section 7.2 of RFC7519. We do not\nensure that the header and payload contents are fully valid JSONs once\ndecoded for instance, and no checks are performed regarding their respective\ncontents.\n\nThe possible return values are the following :\n\n+----+----------------------------------------------------------------------+\n| ID | message                                                              |\n+----+----------------------------------------------------------------------+\n|  0 | \"Verification failure\"                                               |\n|  1 | \"Verification success\"                                               |\n| -1 | \"Unknown algorithm (not mentioned in RFC7518)\"                       |\n| -2 | \"Unmanaged algorithm\"                                                |\n| -3 | \"Invalid token\"                                                      |\n| -4 | \"Out of memory\"                                                      |\n| -5 | \"Unknown certificate\"                                                |\n+----+----------------------------------------------------------------------+\n\nPlease note that this converter is only available when HAProxy has been\ncompiled with USE_OPENSSL.\n\n```\n\nExample:```\n\n# Get a JWT from the authorization header, extract the \"alg\" field of its\n# JOSE header and use a public certificate to verify a signature\nhttp-request set-var(txn.bearer) http_auth_bearer\nhttp-request set-var(txn.jwt_alg) var(txn.bearer),jwt_header_query('$.alg')\nhttp-request deny unless { var(txn.jwt_alg) -m str \"RS256\" }\nhttp-request deny unless { var(txn.bearer),jwt_verify(txn.jwt_alg,\"/path/to/pubkey.pem\") 1 }\n\n```\n\n**[language](#7.3.1-language)**(<value>[,<default>])```\nReturns the value with the highest q-factor from a list as extracted from the\n\"accept-language\" header using \"req.fhdr\". Values with no q-factor have a\nq-factor of 1. Values with a q-factor of 0 are dropped. Only values which\nbelong to the list of semi-colon delimited <values> will be considered. The\nargument <value> syntax is \"lang[;lang[;lang[;...]]]\". If no value matches the\ngiven list and a default value is provided, it is returned. Note that language\nnames may have a variant after a dash ('-'). If this variant is present in the\nlist, it will be matched, but if it is not, only the base language is checked.\nThe match is case-sensitive, and the output string is always one of those\nprovided in arguments. The ordering of arguments is meaningless, only the\nordering of the values in the request counts, as the first value among\nmultiple sharing the same q-factor is used.\n\n```\n\nExample :```\n\n# this configuration switches to the backend matching a\n# given language based on the request :\n\nacl es req.fhdr(accept-language),language(es;fr;en) -m str es\nacl fr req.fhdr(accept-language),language(es;fr;en) -m str fr\nacl en req.fhdr(accept-language),language(es;fr;en) -m str en\nuse_backend spanish if es\nuse_backend french  if fr\nuse_backend english if en\ndefault_backend choose_your_language\n\n```\n\n**[length](#7.3.1-length)**```\nGet the length of the string. This can only be placed after a string\nsample fetch function or after a transformation keyword returning a string\ntype. The result is of type integer.\n\n```\n\n**[lower](#7.3.1-lower)**```\nConvert a string sample to lower case. This can only be placed after a string\nsample fetch function or after a transformation keyword returning a string\ntype. The result is of type string.\n\n```\n\n**[ltime](#7.3.1-ltime)**(<format>[,<offset>])```\nConverts an integer supposed to contain a date since epoch to a string\nrepresenting this date in local time using a format defined by the <format>\nstring using strftime(3). The purpose is to allow any date format to be used\nin logs. An optional <offset> in seconds may be applied to the input date\n(positive or negative). See the strftime() man page for the format supported\nby your operating system. See also the utime converter.\n\n```\n\nExample :```\n\n# Emit two colons, one with the local time and another with ip:port\n# e.g.  20140710162350 127.0.0.1:57325\nlog-format %[date,ltime(%Y%m%d%H%M%S)]\\ %ci:%cp\n\n```\n\n**[ltrim](#7.3.1-ltrim)**(<chars>)```\nSkips any characters from <chars> from the beginning of the string\nrepresentation of the input sample.\n\n```\n\n**[map](#7.3.1-map)**(<map_name>[,<default_value>])```\nmap_<match_type>(<map_name>[,<default_value>])\nmap_<match_type>_<output_type>(<map_name>[,<default_value>])\n  Search the input value from <map_name> using the <match_type> matching\n  method, and return the associated value converted to the type <output_type>.\n  If the input value cannot be found in the <map_name>, the converter returns\n  the <default_value>. If the <default_value> is not set, the converter fails\n  and acts as if no input value could be fetched. If the <match_type> is not\n  set, it defaults to \"str\". Likewise, if the <output_type> is not set, it\n  defaults to \"str\". For convenience, the \"mapThis keyword is available in sections :ACMEConverters\" keyword is an alias for\n  \"map_str\" and maps a string to another string. <map_name> must follow the\n  format described in 2.7. about name format for maps and ACLs\n\n  It is important to avoid overlapping between the keys : IP addresses and\n  strings are stored in trees, so the first of the finest match will be used.\n  Other keys are stored in lists, so the first matching occurrence will be used.\n\n  The following array contains the list of all map functions available sorted by\n  input type, match type and output type.\n\n```\n\ninput typematch methodoutput type stroutput type intoutput type ipoutput type keystrstrmap_strmap_str_intmap_str_ipmap_str_keystrbegmap_begmap_beg_intmap_end_ipmap_end_keystrsubmap_submap_sub_intmap_sub_ipmap_sub_keystrdirmap_dirmap_dir_intmap_dir_ipmap_dir_keystrdommap_dommap_dom_intmap_dom_ipmap_dom_keystrendmap_endmap_end_intmap_end_ipmap_end_keystrregmap_regmap_reg_intmap_reg_ipmap_reg_keystrregmap_regmmap_reg_intmap_reg_ipmap_reg_keyintintmap_intmap_int_intmap_int_ipmap_int_keyipipmap_ipmap_ip_intmap_ip_ipmap_ip_key```\nThe special map called \"map_regm\" expect matching zone in the regular\nexpression and modify the output replacing back reference (like \"\\1\") by\nthe corresponding match text.\n\nOutput type \"key\" means that it is the matched entry's key (as found in the\nmap file) that will be returned as a string instead of the value. Note that\noptional <default_value> argument is not supported when \"key\" output type is\nused.\n\nFiles referenced by <map_name> contains one key + value per line. Lines which\nstart with '#' are ignored, just like empty lines. Leading tabs and spaces\nare stripped. The key is then the first \"word\" (series of non-space/tabs\ncharacters), and the value is what follows this series of space/tab till the\nend of the line excluding trailing spaces/tabs.\n\n```\n\nExample :```\n\n# this is a comment and is ignored\n   2.22.246.0/23    United Kingdom      \\n\n<-><-----------><--><------------><---->\n |       |       |         |        `- trailing spaces ignored\n |       |       |         `---------- value\n |       |       `-------------------- middle spaces ignored\n |       `---------------------------- key\n `------------------------------------ leading spaces ignored\n\n```\n\n**[mod](#7.3.1-mod)**(<value>)```\nDivides the input value of type signed integer by <value>, and returns the\nremainder as an signed integer. If <value> is null, then zero is returned.\n<value> can be a numeric value or a variable name. See section 2.8 about\nvariables for details.\n\n```\n\n**[mqtt_field_value](#7.3.1-mqtt_field_value)**(<packettype>,<fieldname_or_property_ID>)```\nReturns value of <fieldname> found in input MQTT payload of type\n<packettype>.\n<packettype> can be either a string (case insensitive matching) or a numeric\nvalue corresponding to the type of packet we're supposed to extract data\nfrom.\nSupported string and integers can be found here:\nhttps://docs.oasis-open.org/mqtt/mqtt/v3.1.1/os/mqtt-v3.1.1-os.html#_Toc398718021\nhttps://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901022\n\n<fieldname> depends on <packettype> and can be any of the following below.\n(note that <fieldname> matching is case insensitive).\n<property id> can only be found in MQTT v5.0 streams. check this table:\nhttps://docs.oasis-open.org/mqtt/mqtt/v5.0/os/mqtt-v5.0-os.html#_Toc3901029\n\n- CONNECT (or 1): flags, protocol_name, protocol_version, client_identifier,\n                  will_topic, will_payload, username, password, keepalive\n                  OR any property ID as a numeric value (for MQTT v5.0\n                  packets only):\n                     17: Session Expiry Interval\n                     33: Receive Maximum\n                     39: Maximum Packet Size\n                     34: Topic Alias Maximum\n                     25: Request Response Information\n                     23: Request Problem Information\n                     21: Authentication Method\n                     22: Authentication Data\n                     18: Will Delay Interval\n                      1: Payload Format Indicator\n                      2: Message Expiry Interval\n                      3: Content Type\n                      8: Response Topic\n                      9: Correlation Data\n                  Not supported yet:\n                     38: User Property\n\n- CONNACK (or 2): flags, protocol_version, reason_code\n                  OR any property ID as a numeric value (for MQTT v5.0\n                  packets only):\n                     17: Session Expiry Interval\n                     33: Receive Maximum\n                     36: Maximum QoS\n                     37: Retain Available\n                     39: Maximum Packet Size\n                     18: Assigned Client Identifier\n                     34: Topic Alias Maximum\n                     31: Reason String\n                     40; Wildcard Subscription Available\n                     41: Subscription Identifiers Available\n                     42: Shared Subscription Available\n                     19: Server Keep Alive\n                     26: Response Information\n                     28: Server Reference\n                     21: Authentication Method\n                     22: Authentication Data\n                  Not supported yet:\n                     38: User Property\n\nDue to current HAProxy design, only the first message sent by the client and\nthe server can be parsed. Thus this converter can extract data only from\nCONNECT and CONNACK packet types. CONNECT is the first message sent by the\nclient and CONNACK is the first response sent by the server.\n\n```\n\nExample:```\n\nacl data_in_buffer req.len ge 4\ntcp-request content set-var(txn.username) \\\n        req.payload(0,0),mqtt_field_value(connect,protocol_name) \\\n        if data_in_buffer\n# do the same as above\ntcp-request content set-var(txn.username) \\\n        req.payload(0,0),mqtt_field_value(1,protocol_name) \\\n        if data_in_buffer\n\n```\n\n**[mqtt_is_valid](#7.3.1-mqtt_is_valid)**```\nChecks that the binary input is a valid MQTT packet. It returns a boolean.\n\nDue to current HAProxy design, only the first message sent by the client and\nthe server can be parsed. Thus this converter can extract data only from\nCONNECT and CONNACK packet types. CONNECT is the first message sent by the\nclient and CONNACK is the first response sent by the server.\n\nOnly MQTT 3.1, 3.1.1 and 5.0 are supported.\n\n```\n\nExample:```\n\nacl data_in_buffer req.len ge 4\ntcp-request content reject unless { req.payload(0,0),mqtt_is_valid }\n\n```\n\n**[ms_ltime](#7.3.1-ms_ltime)**(<format>[,<offset>])```\nThis works like \"ltime\" but takes an input in milliseconds. It also supports\nthe %N conversion specifier inspired by date(1).\nConverts an integer supposed to contain a date since epoch to a string\nrepresenting this date in local time using a format defined by the <format>\nstring using strftime(3). The purpose is to allow any date format to be used\nin logs. An optional <offset> in milliseconds may be applied to the input date\n(positive or negative). See the strftime() man page for the format supported\nby your operating system.\n\nThe %N conversion specifier allows you to output the nanoseconds part of the\ndate, precision is limited since the input is milliseconds.\n(000000000..999000000).  %N can take a width argument between % and N. It is\nuseful to display milliseconds (%3N) or microseconds (%6N). The default and\nmaximum width is 9 (%N = %9N).\n\nSee also the utime converter for UTC as well as \"ltime\" and \"us_ltime\"\nconverters.\n\n```\n\nExample :```\n\n# Emit 3 colons, the local time, the timezone and another with ip:port\n# e.g. 2023/07/24/11:53:02.196 +0200 127.0.0.1:41530\nlog-format %[accept_date(ms),ms_ltime(\"%Y/%m/%d/%H:%M:%S.%3N %z\")]\\ %ci:%cp\n\n```\n\n**[ms_utime](#7.3.1-ms_utime)**(<format>[,<offset>])```\nThis works like \"utime\" but takes an input in milliseconds. It also supports\nthe %N conversion specifier inspired by date(1).\nConverts an integer supposed to contain a date since epoch to a string\nrepresenting this date in UTC time using a format defined by the <format>\nstring using strftime(3). The purpose is to allow any date format to be used\nin logs. An optional <offset> in milliseconds may be applied to the input date\n(positive or negative). See the strftime() man page for the format supported\nby your operating system.\n\nThe %N conversion specifier allows you to output the nanoseconds part of the\ndate, precision is limited since the input is milliseconds.\n(000000000..999000000).  %N can take a width argument between % and N. It is\nuseful to display milliseconds (%3N) or microseconds (%6N). The default and\nmaximum width is 9 (%N = %9N).\n\nSee also the ltime converter for local as well as \"utime\" and \"us_utime\"\nconverters.\n\n```\n\nExample :```\n\n# Emit 3 colons, the UTC time, the timezone and another with ip:port\n# e.g. 2023/07/24/09:53:02.196 +0000 127.0.0.1:41530\nlog-format %[accept_date(ms),ms_utime(\"%Y/%m/%d/%H:%M:%S.%3N %z\")]\\ %ci:%cp\n\n```\n\n**[mul](#7.3.1-mul)**(<value>)```\nMultiplies the input value of type signed integer by <value>, and returns\nthe product as an signed integer. In case of overflow, the largest possible\nvalue for the sign is returned so that the operation doesn't wrap around.\n<value> can be a numeric value or a variable name. See section 2.8 about\nvariables for details.\n\n```\n\n**[nbsrv](#7.3.1-nbsrv)**```\nTakes an input value of type string, interprets it as a backend name and\nreturns the number of usable servers in that backend. Can be used in places\nwhere we want to look up a backend from a dynamic name, like a result of a\nmap lookup.\n\n```\n\n**[neg](#7.3.1-neg)**```\nTakes the input value of type signed integer, computes the opposite value,\nand returns the remainder as an signed integer. 0 is identity. This operator\nis provided for reversed subtracts : in order to subtract the input from a\nconstant, simply perform a \"neg,add(value)\".\n\n```\n\n**[not](#7.3.1-not)**```\nReturns a boolean FALSE if the input value of type signed integer is\nnon-null, otherwise returns TRUE. Used in conjunction with and(), it can be\nused to report true/false for bit testing on input values (e.g. verify the\nabsence of a flag).\n\n```\n\n**[odd](#7.3.1-odd)**```\nReturns a boolean TRUE if the input value of type signed integer is odd\notherwise returns FALSE. It is functionally equivalent to \"and(1),bool\".\n\n```\n\n**[or](#7.3.1-or)**(<value>)```\nPerforms a bitwise \"OR\" between <value> and the input value of type signed\ninteger, and returns the result as an signed integer. <value> can be a\nnumeric value or a variable name. See section 2.8 about variables for details.\n\n```\n\n**[param](#7.3.1-param)**(<name>[,<delim>])```\nThis extracts the first occurrence of the parameter <name> in the input string\nwhere parameters are delimited by <delim>, which defaults to \"&\", and the name\nand value of the parameter are separated by a \"=\". If there is no \"=\" and\nvalue before the end of the parameter segment, it is treated as equivalent to\na value of an empty string.\n\nThis can be useful for extracting parameters from a query string, or possibly\na x-www-form-urlencoded body. In particular, `query,param(<name>)` can be used\nas an alternative to `urlp(<name>)` which only uses \"&\" as a delimiter,\nwhereas \"urlp\" also uses \"?\" and \";\".\n\nNote that this converter doesn't do anything special with url encoded\ncharacters. If you want to decode the value, you can use the url_dec converter\non the output. If the name of the parameter in the input might contain encoded\ncharacters, you'll probably want do normalize the input before calling\n\"param\". This can be done using \"http-request normalize-uri\", in particular\nthe percent-decode-unreserved and percent-to-uppercase options.\n\n```\n\nExample :```\n\nstr(a=b&c=d&a=r),param(a)   # b\nstr(a&b=c),param(a)         # \"\"\nstr(a=&b&c=a),param(b)      # \"\"\nstr(a=1;b=2;c=4),param(b,;) # 2\nquery,param(redirect_uri),urldec()\n\n```\n\n**[port_only](#7.3.1-port_only)**```\nConverts a string which contains a Host header value into an integer by\nreturning its port.\nThe input must respect the format of the host header value\n(rfc9110#section-7.2). It will support that kind of input: hostname,\nhostname:80, 127.0.0.1, 127.0.0.1:80, [::1], [::1]:80.\n\nIf no port were provided in the input, it will return 0.\n\n```\n\n**See also:**\"[host_only](#host_only)\" converter which will return the host.**[protobuf](#7.3.1-protobuf)**(<field_number>[,<field_type>])```\nThis extracts the protocol buffers message field in raw mode of an input binary\nsample representation of a protocol buffer message with <field_number> as field\nnumber (dotted notation) if <field_type> is not present, or as an integer sample\nif this field is present (see also \"ungrpc\" below).\nThe list of the authorized types is the following one: \"int32\", \"int64\", \"uint32\",\n\"uint64\", \"sint32\", \"sint64\", \"boolThis keyword is available in sections :ConvertersFetching samples from internal states\", \"enum\" for the \"varint\" wire type 0\n\"fixed64\", \"sfixed64\", \"double\" for the 64bit wire type 1, \"fixed32\", \"sfixed32\",\n\"float\" for the wire type 5. Note that \"string\" is considered as a length-delimited\ntype, so it does not require any <field_type> argument to be extracted.\nMore information may be found here about the protocol buffers message field types:\nhttps://developers.google.com/protocol-buffers/docs/encoding\n\n```\n\n**[regsub](#7.3.1-regsub)**(<regex>,<subst>[,<flags>])```\nApplies a regex-based substitution to the input string. It does the same\noperation as the well-known \"sed\" utility with \"s/<regex>/<subst>/\". By\ndefault it will replace in the input string the first occurrence of the\nlargest part matching the regular expression <regex> with the substitution\nstring <subst>. It is possible to replace all occurrences instead by adding\nthe flag \"g\" in the third argument <flags>. It is also possible to make the\nregex case insensitive by adding the flag \"i\" in <flags>. Since <flags> is a\nstring, it is made up from the concatenation of all desired flags. Thus if\nboth \"i\" and \"g\" are desired, using \"gi\" or \"ig\" will have the same effect.\nThe first use of this converter is to replace certain characters or sequence\nof characters with other ones.\n\nIt is highly recommended to enclose the regex part using protected quotes to\nimprove clarity and never have a closing parenthesis from the regex mixed up\nwith the parenthesis from the function. Just like in Bourne shell, the first\nlevel of quotes is processed when delimiting word groups on the line, a\nsecond level is usable for argument. It is recommended to use single quotes\noutside since these ones do not try to resolve backslashes nor dollar signs.\n\n```\n\nExamples:```\n\n# de-duplicate \"/\" in header \"x-path\".\n# input:  x-path: /////a///b/c/xzxyz/\n# output: x-path: /a/b/c/xzxyz/\nhttp-request set-header x-path \"%[hdr(x-path),regsub('/+','/','g')]\"\n\n# copy query string to x-query and drop all leading '?', ';' and '&'\nhttp-request set-header x-query \"%[query,regsub([?;&]*,'')]\"\n\n# capture groups and backreferences\n# both lines do the same.\nhttp-request redirect location %[url,'regsub(\"(foo|bar)([0-9]+)?\",\"\\2\\1\",i)']\nhttp-request redirect location %[url,regsub(\\\"(foo|bar)([0-9]+)?\\\",\\\"\\2\\1\\\",i)]\n\n```\n\n**[rfc7239_field](#7.3.1-rfc7239_field)**(<field>)```\nExtracts a single field/parameter from RFC 7239 compliant header value input.\n\nSupported fields are:\n  - proto: either 'http' or 'https'\n  - host: http compliant host\n  - for: RFC7239 node\n  - by: RFC7239 node\n\nMore info here:\n  https://www.rfc-editor.org/rfc/rfc7239.html#section-6\n\n```\n\nExample:```\n\n# extract host field from forwarded header and store it in req.fhost var\nhttp-request set-var(req.fhost) req.hdr(forwarded),rfc7239_field(host)\n#input: \"proto=https;host=\\\"haproxy.org:80\\\"\"\n#  output: \"haproxy.org:80\"\n\n# extract for field from forwarded header and store it in req.ffor var\nhttp-request set-var(req.ffor) req.hdr(forwarded),rfc7239_field(for)\n#input: \"proto=https;host=\\\"haproxy.org:80\\\";for=\\\"127.0.0.1:9999\\\"\"\n#  output: \"127.0.0.1:9999\"\n\n```\n\n**[rfc7239_is_valid](#7.3.1-rfc7239_is_valid)**```\nReturns true if input header is RFC 7239 compliant header value and false\notherwise.\n\n```\n\nExample:```\n\nacl valid req.hdr(forwarded),rfc7239_is_valid\n#input: \"for=127.0.0.1;proto=http\"\n#  output: TRUE\n#input: \"proto=custom\"\n#  output: FALSE\n\n```\n\n**[rfc7239_n2nn](#7.3.1-rfc7239_n2nn)**```\nConverts RFC7239 node (provided by 'for' or 'by' 7239 header fields)\ninto its corresponding nodename final form:\n  - ipv4 address\n  - ipv6 address\n  - 'unknown'\n  - '_obfs' identifier\n\n```\n\nExample:```\n\n# extract 'for' field from forwarded header, extract nodename from\n# resulting node identifier and store the result in req.fnn\nhttp-request set-var(req.fnn) req.hdr(forwarded),rfc7239_field(for),rfc7239_n2nn\n#input: \"127.0.0.1:9999\"\n#  output: 127.0.0.1 (ipv4)\n#input: \"[ab:cd:ff:ff:ff:ff:ff:ff]:9998\"\n#  output: ab:cd:ff:ff:ff:ff:ff:ff (ipv6)\n#input: \"_name:_port\"\n#  output: \"_name\" (string)\n\n```\n\n**[rfc7239_n2np](#7.3.1-rfc7239_n2np)**```\nConverts RFC7239 node (provided by 'for' or 'by' 7239 header fields)\ninto its corresponding nodeport final form:\n  - unsigned integer\n  - '_obfs' identifier\n\n```\n\nExample:```\n\n# extract 'by' field from forwarded header, extract node port from\n# resulting node identifier and store the result in req.fnp\nhttp-request set-var(req.fnp) req.hdr(forwarded),rfc7239_field(by),rfc7239_n2np\n#input: \"127.0.0.1:9999\"\n#  output: 9999 (integer)\n#input: \"[ab:cd:ff:ff:ff:ff:ff:ff]:9998\"\n#  output: 9998 (integer)\n#input: \"_name:_port\"\n#  output: \"_port\" (string)\n\n```\n\n**[rfc7239_nn](#7.3.1-rfc7239_nn)**```\nConverts provided address / string input into RFC7239-compliant node name.\nIt may be used to manually build 'for' or 'by' 7239 header fields.\n\nWhen provided input is string, it will be automatically prefixed with '_'\nchar to represent obfuscated identifier. String must comply with RFC7239\ncharset. If string is empty, it will be converter to \"unknown\" identifier.\n\n```\n\nExample:```\n\n#input: ipv6(ab:cd:ff:ff:ff:ff:ff:ff)\n#  output: \"[ab:cd:ff:ff:ff:ff:ff:ff]\"\n#input: str(test)\n#  output: \"_test\"\n#input: str()\n#  output: \"unknown\"\n\n```\n\n**See also:**\"[rfc7239_np](#rfc7239_np)\"**[rfc7239_np](#7.3.1-rfc7239_np)**```\nConverts provided unsigned integer / string input into RFC7239-compliant node\nport. It may be used to manually build 'for' or 'by' 7239 header fields.\n\nWhen provided input is string, it will be automatically prefixed with '_'\nchar to represent obfuscated identifier. String must comply with RFC7239\ncharset and cannot be empty.\n\n```\n\nExample:```\n\n#input: int(12)\n#  output: \"12\"\n#input: str(test)\n#  output: \"_test\"\n\n# build 'for' forwarded header field\nhttp-request set-var-fmt(txn.test) \"for=\\\"%[ipv6(::1),rfc7239_nn]:%[int(8080),rfc7239_np]\\\";\"\n#  output: \"for=\\\"[::1]:8080\\\";\"\n\n# build RFC-compliant 7239 header:\nhttp-request set-var-fmt(txn.forwarded) \"for=\\\"%[ipv6(::1),rfc7239_nn]:%[str(8888),rfc7239_np]\\\";host=\\\"haproxy.org\\\";proto=http\"\n# check RFC-compliancy:\nhttp-request set-var(txn.test) \"var(txn.forwarded),debug(test,stderr),rfc7239_is_valid,debug(test,stderr)\"\n#  stderr output:\n#    [debug] test: type=str <for=\"[::1]:_8888\";host=\"haproxy.org\";proto=http>\n#    [debug] test: type=bool <1>\n\n```\n\n**See also:**\"[rfc7239_nn](#rfc7239_nn)\"**[rtrim](#7.3.1-rtrim)**(<chars>)```\nSkips any characters from <chars> from the end of the string representation\nof the input sample.\n\n```\n\n**[sdbm](#7.3.1-sdbm)**([<avalanche>])```\nHashes a binary input sample into an unsigned 32-bit quantity using the SDBM\nhash function. Optionally, it is possible to apply a full avalanche hash\nfunction to the output if the optional <avalanche> argument equals 1. This\nconverter uses the same functions as used by the various hash-based load\nbalancing algorithms, so it will provide exactly the same results. It is\nmostly intended for debugging, but can be used as a stick-table entry to\ncollect rough statistics. It must not be used for security purposes as a\n32-bit hash is trivial to break. See also \"crc32\", \"djb2\", \"wt6\", \"crc32c\",\nand the \"hash-type\" directive.\n\n```\n\n**[secure_memcmp](#7.3.1-secure_memcmp)**(<var>)```\nCompares the contents of <var> with the input value. Both values are treated\nas a binary string. Returns a boolean indicating whether both binary strings\nmatch.\n\nIf both binary strings have the same length then the comparison will be\nperformed in constant time.\n\nPlease note that this converter is only available when HAProxy has been\ncompiled with USE_OPENSSL.\n\n```\n\nExample :```\n\nhttp-request set-var(txn.token) hdr(token)\n# Check whether the token sent by the client matches the secret token\n# value, without leaking the contents using a timing attack.\nacl token_given str(my_secret_token),secure_memcmp(txn.token)\n\n```\n\n**[set-var](#7.3.1-set-var)**(<var>[,<cond>...])```\nSets a variable with the input content and returns the content on the output\nas-is if all of the specified conditions are true (see below for a list of\npossible conditions). The variable keeps the value and the associated input\ntype. See section 2.8 about variables for details.\n\nYou can pass at most four conditions to the converter among the following\npossible conditions :\n - \"ifexists\"/\"ifnotexists\":\n      Checks if the variable already existed before the current set-var call.\n      A variable is usually created through a successful set-var call.\n      Note that variables of scope \"proc\" are created during configuration\n      parsing so the \"ifexists\" condition will always be true for them.\n - \"ifempty\"/\"ifnotempty\":\n      Checks if the input is empty or not.\n      Scalar types are never empty so the ifempty condition will be false for\n      them regardless of the input's contents (integers, booleans, IPs ...).\n - \"ifset\"/\"ifnotset\":\n      Checks if the variable was previously set or not, or if unset-var was\n      called on the variable.\n      A variable that does not exist yet is considered as not set. A \"proc\"\n      variable can exist while not being set since they are created during\n      configuration parsing.\n - \"ifgt\"/\"iflt\":\n      Checks if the content of the variable is \"greater than\" or \"less than\"\n      the input. This check can only be performed if both the input and\n      the variable are of type integer. Otherwise, the check is considered as\n      true by default.\n\n```\n\n**[sha1](#7.3.1-sha1)**```\nConverts a binary input sample to a SHA-1 digest. The result is a binary\nsample with length of 20 bytes.\n\n```\n\n**[sha2](#7.3.1-sha2)**([<bits>])```\nConverts a binary input sample to a digest in the SHA-2 family. The result\nis a binary sample with length of <bits>/8 bytes.\n\nValid values for <bits> are 224, 256, 384, 512, each corresponding to\nSHA-<bits>. The default value is 256.\n\nPlease note that this converter is only available when HAProxy has been\ncompiled with USE_OPENSSL.\n\n```\n\n**[srv_is_up](#7.3.1-srv_is_up)**```\nTakes an input value of type string, either a server name or <backend>/<server>\nformat and returns true when the designated server is currently UP. Can be used\nin places where we want to look up a server status from a dynamic name, like a\ncookie value (e.g. req.cook(SRVID),srv_is_up) and then make a decision to\ndirect a request elsewhere. Before using this, please keep in mind that using\nthis converter on uncontrolled data might allow an external observer to query\nthe state of any server in the whole configuration, which might possibly not\nbe acceptable in some environments.\n\n```\n\n**[srv_queue](#7.3.1-srv_queue)**```\nTakes an input value of type string, either a server name or <backend>/<server>\nformat and returns the number of queued streams on that server. Can be used\nin places where we want to look up queued streams from a dynamic name, like a\ncookie value (e.g. req.cook(SRVID),srv_queue) and then make a decision to break\npersistence or direct a request elsewhere. Before using this, please keep in\nmind that using this converter on uncontrolled data might allow an external\nobserver to query the state of any server in the whole configuration, which\nmight possibly not be acceptable in some environments.\n\n```\n\n**[strcmp](#7.3.1-strcmp)**(<var>)```\nCompares the contents of <var> with the input value of type string. Returns\nthe result as a signed integer compatible with strcmp(3): 0 if both strings\nare identical. A value less than 0 if the left string is lexicographically\nsmaller than the right string or if the left string is shorter. A value greater\nthan 0 otherwise (right string greater than left string or the right string is\nshorter).\n\nSee also the secure_memcmp converter if you need to compare two binary\nstrings in constant time.\n\n```\n\nExample :```\n\nhttp-request set-var(txn.host) hdr(host)\n# Check whether the client is attempting domain fronting.\nacl ssl_sni_http_host_match ssl_fc_sni,strcmp(txn.host) eq 0\n\n```\n\n**[sub](#7.3.1-sub)**(<value>)```\nSubtracts <value> from the input value of type signed integer, and returns\nthe result as an signed integer. Note: in order to subtract the input from\na constant, simply perform a \"neg,add(value)\". <value> can be a numeric value\nor a variable name. See section 2.8 about variables for details.\n\n```\n\n**[table_bytes_in_rate](#7.3.1-table_bytes_in_rate)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the average\nclient-to-server bytes rate associated with the input sample in the designated\ntable, measured in amount of bytes over the period configured in the table.\nSee also the sc_bytes_in_rate sample fetch keyword.\n\n```\n\n**[table_bytes_out_rate](#7.3.1-table_bytes_out_rate)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the average\nserver-to-client bytes rate associated with the input sample in the designated\ntable, measured in amount of bytes over the period configured in the table.\nSee also the sc_bytes_out_rate sample fetch keyword.\n\n```\n\n**[table_clr_gpc](#7.3.1-table_clr_gpc)**(<idx>[,<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. Clears the General Purpose Counter at the\nindex <idx> of the gpc array and returns its previous value. <idx> is an\ninteger between 0 and 99. If the entry is not found, an entry is created and\n0 is returned. This converter applies only to the 'gpc' array data_type (and\nnot to the legacy 'gpc0' nor 'gpc1' data_types).\nSee also the sc_clr_gpc sample fetch keyword.\n\n```\n\n**[table_clr_gpc0](#7.3.1-table_clr_gpc0)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. Clears the first General Purpose Counter\n'0' and returns its previous value. If the entry is not found, an entry is\ncreated and 0 is returned. This is typically used as a second ACL in an\nexpression in order to mark a connection when a first ACL was verified :\n\n```\n\nExample:```\n\n# block if 5 consecutive requests continue to come faster than 10 sess\n# per second, and reset the counter as soon as the traffic slows down.\nacl abuse src_http_req_rate gt 10\nacl kill  src,table_inc_gpc0 gt 5\nacl save  src,table_clr_gpc0 ge 0\ntcp-request connection accept if !abuse save\ntcp-request connection reject if abuse kill\n\n```\n\n```\nSee also the sc_clr_gpc0 sample fetch keyword.\n\n```\n\n**[table_clr_gpc1](#7.3.1-table_clr_gpc1)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. Clears the first General Purpose Counter\n'1' and returns its previous value. If the entry is not found, an entry is\ncreated and 0 is returned. This is typically used as a second ACL in an\nexpression in order to mark a connection when a first ACL was verified.\nSee also the sc_clr_gpc1 sample fetch keyword.\n\n```\n\n**[table_conn_cnt](#7.3.1-table_conn_cnt)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the cumulative\nnumber of incoming connections associated with the input sample in the\ndesignated table. See also the sc_conn_cnt sample fetch keyword.\n\n```\n\n**[table_conn_cur](#7.3.1-table_conn_cur)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the current\namount of concurrent tracked connections associated with the input sample in\nthe designated table. See also the sc_conn_cur sample fetch keyword.\n\n```\n\n**[table_conn_rate](#7.3.1-table_conn_rate)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the average\nincoming connection rate associated with the input sample in the designated\ntable. See also the sc_conn_rate sample fetch keyword.\n\n```\n\n**[table_expire](#7.3.1-table_expire)**([<table>[,<default_value>]])```\nUses the input sample to perform a look up in in the current proxy's\nstick-table or in the designated stick-table. If the key is not found in the\ntable, the converter fails except if <default_value> is set: this makes the\nconverter succeed and return <default_value>. If the key is found the\nconverter returns the key expiration delay associated with the input sample\nin the designated table. See also the table_idle sample fetch keyword.\n\n```\n\n**[table_glitch_cnt](#7.3.1-table_glitch_cnt)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the cumulative\nnumber of front connection glitches associated with the input sample in the\ndesignated table. See also the sc_glitch_cnt sample fetch keyword and\nfc_glitches for the value measured on the current front connection.\n\n```\n\n**[table_glitch_rate](#7.3.1-table_glitch_rate)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the average\nfront connection glitch rate associated with the input sample in the\ndesignated table. See also the sc_glitch_rate sample fetch keyword.\n\n```\n\n**[table_gpc](#7.3.1-table_gpc)**(<idx>[,<table>])```\nUses the input sample to perform a lookup in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the current\nvalue of the General Purpose Counter at the index <idx> of the array\nassociated to the input sample in the designated <table>. <idx> is an integer\nbetween 0 and 99. If there is no GPC stored at this index, it also returns\nthe integer value 0. This applies only to the 'gpc' array data_type (and not\nto the legacy 'gpc0' nor 'gpc1' data_types). See also the sc_get_gpc sample\nfetch keyword.\n\n```\n\n**[table_gpc0](#7.3.1-table_gpc0)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the current\nvalue of the first general purpose counter associated with the input sample\nin the designated table. See also the sc_get_gpc0 sample fetch keyword.\n\n```\n\n**[table_gpc0_rate](#7.3.1-table_gpc0_rate)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the frequency\nwhich the gpc0 counter was incremented over the configured period in the\ntable, associated with the input sample in the designated table. See also the\nsc_get_gpc0_rate sample fetch keyword.\n\n```\n\n**[table_gpc1](#7.3.1-table_gpc1)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the current\nvalue of the second general purpose counter associated with the input sample\nin the designated table. See also the sc_get_gpc1 sample fetch keyword.\n\n```\n\n**[table_gpc1_rate](#7.3.1-table_gpc1_rate)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the frequency\nwhich the gpc1 counter was incremented over the configured period in the\ntable, associated with the input sample in the designated table. See also the\nsc_get_gpc1_rate sample fetch keyword.\n\n```\n\n**[table_gpc_rate](#7.3.1-table_gpc_rate)**(<idx>[,<table>])```\nUses the input sample to perform a lookup in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the frequency\nwhich the Global Purpose Counter at index <idx> of the array (associated to\nthe input sample in the designated stick-table <table>) was incremented over\nthe configured period. <idx> is an integer between 0 and 99. If there is no\ngpc_rate stored at this index, it also returns the integer value 0. This\napplies only to the 'gpc_rate' array data_type (and not to the legacy\n'gpc0_rate' nor 'gpc1_rate' data_types). See also the sc_gpc_rate sample\nfetch keyword.\n\n```\n\n**[table_gpt](#7.3.1-table_gpt)**(<idx>[,<table>])```\nUses the input sample to perform a lookup in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the current\nvalue of the general purpose tag at the index <idx> of the array associated\nto the input sample in the designated <table>. <idx> is an integer between\n0 and 99. If there is no GPT stored at this index, it also returns the\ninteger value 0. This applies only to the 'gpt' array data_type (and not on\nthe legacy 'gpt0' data-type). See also the sc_get_gpt sample fetch keyword.\n\n```\n\n**[table_gpt0](#7.3.1-table_gpt0)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the current\nvalue of the first general purpose tag associated with the input sample in\nthe designated table. See also the sc_get_gpt0 sample fetch keyword.\n\n```\n\n**[table_http_err_cnt](#7.3.1-table_http_err_cnt)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the cumulative\nnumber of HTTP errors associated with the input sample in the designated\ntable. See also the sc_http_err_cnt sample fetch keyword.\n\n```\n\n**[table_http_err_rate](#7.3.1-table_http_err_rate)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the average rate of HTTP errors\nassociated with the input sample in the designated table, measured in amount\nof errors over the period configured in the table. See also the\nsc_http_err_rate sample fetch keyword.\n\n```\n\n**[table_http_fail_cnt](#7.3.1-table_http_fail_cnt)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the cumulative\nnumber of HTTP failures associated with the input sample in the designated\ntable. See also the sc_http_fail_cnt sample fetch keyword.\n\n```\n\n**[table_http_fail_rate](#7.3.1-table_http_fail_rate)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the average rate of HTTP failures\nassociated with the input sample in the designated table, measured in amount\nof failures over the period configured in the table. See also the\nsc_http_fail_rate sample fetch keyword.\n\n```\n\n**[table_http_req_cnt](#7.3.1-table_http_req_cnt)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the cumulative\nnumber of HTTP requests associated with the input sample in the designated\ntable. See also the sc_http_req_cnt sample fetch keyword.\n\n```\n\n**[table_http_req_rate](#7.3.1-table_http_req_rate)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the average rate of HTTP requests\nassociated with the input sample in the designated table, measured in amount\nof requests over the period configured in the table. See also the\nsc_http_req_rate sample fetch keyword.\n\n```\n\n**[table_idle](#7.3.1-table_idle)**([<table>[,<default_value>]])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table, the\nconverter fails except if <default_value> is set: this makes the converter\nsucceed and return <default_value>. If the key is found the converter returns\nthe time the key entry associated with the input sample in the designated\ntable remained idle since the last time it was updated. See also the\ntable_expire sample fetch keyword.\n\n```\n\n**[table_inc_gpc](#7.3.1-table_inc_gpc)**(<idx>[,<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. Increments the General Purpose Counter at\nindex <idx> of the array and returns its new value. <idx> is an integer\nbetween 0 and 99. If the entry is not found, an entry is created and 1 is\nreturned. This converter applies only to the 'gpc' array data_type (and not to\nthe legacy 'gpc0' nor 'gpc1' data_types). See also sc_inc_gpc.\n\n```\n\n**[table_inc_gpc0](#7.3.1-table_inc_gpc0)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. Increments the General Purpose Counter '0'\nand returns its new value. If the entry is not found, an entry is created and\n1 is returned. See also sc0/sc2/sc2_inc_gpc0. This is typically used as a\nsecond ACL in an expression in order to mark a connection when a first ACL\nwas verified :\n\n```\n\nExample:```\n\nacl abuse src,table_req_rate gt 10\nacl kill  src,table_inc_gpc0 gt 0\ntcp-request connection reject if abuse kill\n\n```\n\n**[table_inc_gpc1](#7.3.1-table_inc_gpc1)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. Increments the General Purpose Counter '1'\nand returns its new value. If the entry is not found, an entry is created and\n1 is returned. See also sc0/sc2/sc2_inc_gpc1. This is typically used as a\nsecond ACL in an expression in order to mark a connection when a first ACL\nwas verified.\n\n```\n\n**[table_kbytes_in](#7.3.1-table_kbytes_in)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the cumulative\nnumber of client-to-server data associated with the input sample in the\ndesignated table, measured in kilobytes. The test is currently performed on\n32-bit integers, which limits values to 4 terabytes. See also the sc_kbytes_in\nsample fetch keyword.\n\n```\n\n**[table_kbytes_out](#7.3.1-table_kbytes_out)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the cumulative\nnumber of server-to-client data associated with the input sample in the\ndesignated table, measured in kilobytes. The test is currently performed on\n32-bit integers, which limits values to 4 terabytes. See also the\nsc_kbytes_out sample fetch keyword.\n\n```\n\n**[table_server_id](#7.3.1-table_server_id)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the server ID\nassociated with the input sample in the designated table. A server ID is\nassociated to a sample by a \"stickThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\" rule when a connection to a server\nsucceeds. A server ID zero means that no server is associated with this key.\n\n```\n\n**[table_sess_cnt](#7.3.1-table_sess_cnt)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the cumulative\nnumber of incoming sessions associated with the input sample in the designated\ntable. Note that a session here refers to an incoming connection being\naccepted by the \"tcp-request connection\" rulesets. See also the sc_sess_cnt\nsample fetch keyword.\n\n```\n\n**[table_sess_rate](#7.3.1-table_sess_rate)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the average\nincoming session rate associated with the input sample in the designated\ntable. Note that a session here refers to an incoming connection being\naccepted by the \"tcp-request connection\" rulesets. See also the sc_sess_rate\nsample fetch keyword.\n\n```\n\n**[table_trackers](#7.3.1-table_trackers)**([<table>])```\nUses the input sample to perform a look up in the current proxy's stick-table\nor in the designated stick-table. If the key is not found in the table,\ninteger value zero is returned. Otherwise the converter returns the current\namount of concurrent connections tracking the same key as the input sample\nin the designated table. It differs from table_conn_cur in that it does not\nrely on any stored information but on the table's reference count (the \"use\"\nvalue which is returned by \"show table\" on the CLI). This may sometimes be\nmore suited for layer7 tracking. It can be used to tell a server how many\nconcurrent connections there are from a given address for example. See also\nthe sc_trackers sample fetch keyword.\n\n```\n\n**[ub64dec](#7.3.1-ub64dec)**```\nThis converter is the base64url variant of b64dec converter. base64url\nencoding is the \"URL and Filename Safe Alphabet\" variant of base64 encoding.\nIt is also the encoding used in JWT (JSON Web Token) standard.\n\n```\n\nExample:```\n\n# Decoding a JWT payload:\nhttp-request set-var(txn.token_payload) req.hdr(Authorization),word(2,.),ub64dec\n\n```\n\n**[ub64enc](#7.3.1-ub64enc)**```\nThis converter is the base64url variant of base64 converter.\n\n```\n\n**[ungrpc](#7.3.1-ungrpc)**(<field_number>[,<field_type>])```\nThis extracts the protocol buffers message field in raw mode of an input binary\nsample representation of a gRPC message with <field_number> as field number\n(dotted notation) if <field_type> is not present, or as an integer sample if this\nfield is present.\nThe list of the authorized types is the following one: \"int32\", \"int64\", \"uint32\",\n\"uint64\", \"sint32\", \"sint64\", \"boolThis keyword is available in sections :ConvertersFetching samples from internal states\", \"enum\" for the \"varint\" wire type 0\n\"fixed64\", \"sfixed64\", \"double\" for the 64bit wire type 1, \"fixed32\", \"sfixed32\",\n\"float\" for the wire type 5. Note that \"string\" is considered as a length-delimited\ntype, so it does not require any <field_type> argument to be extracted.\nMore information may be found here about the protocol buffers message field types:\nhttps://developers.google.com/protocol-buffers/docs/encoding\n\n```\n\nExample:```\n\n// with such a protocol buffer .proto file content adapted from\n// https://github.com/grpc/grpc/blob/master/examples/protos/route_guide.proto\n\nmessage Point {\n  int32 latitude = 1;\n  int32 longitude = 2;\n}\n\nmessage PPoint {\n  Point point = 59;\n}\n\nmessage Rectangle {\n  // One corner of the rectangle.\n  PPoint lo = 48;\n  // The other corner of the rectangle.\n  PPoint hi = 49;\n}\n\n```\n\n```\nlet's say a body request is made of a \"Rectangle\" object value (two PPoint\nprotocol buffers messages), the four protocol buffers fields could be\nextracted with these \"ungrpc\" directives:\n\n  req.body,ungrpc(48.59.1,int32) # \"latitude\" of \"lo\" first PPoint\n  req.body,ungrpc(48.59.2,int32) # \"longitude\" of \"lo\" first PPoint\n  req.body,ungrpc(49.59.1,int32) # \"latitude\" of \"hi\" second PPoint\n  req.body,ungrpc(49.59.2,int32) # \"longitude\" of \"hi\" second PPoint\n\nWe could also extract the intermediary 48.59 field as a binary sample as follows:\n\n  req.body,ungrpc(48.59)\n\nAs a gRPC message is always made of a gRPC header followed by protocol buffers\nmessages, in the previous example the \"latitude\" of \"lo\" first PPoint\ncould be extracted with these equivalent directives:\n\n  req.body,ungrpc(48.59),protobuf(1,int32)\n  req.body,ungrpc(48),protobuf(59.1,int32)\n  req.body,ungrpc(48),protobuf(59),protobuf(1,int32)\n\nNote that the first convert must be \"ungrpc\", the remaining ones must be\n\"protobuf\" and only the last one may have or not a second argument to\ninterpret the previous binary sample.\n\n```\n\n**[unset-var](#7.3.1-unset-var)**(<var>)```\nUnsets a variable if the input content is defined. The name of the variable\nstarts with an indication about its scope. See section 2.8 about variables\nfor details.\n\n```\n\n**[upper](#7.3.1-upper)**```\nConvert a string sample to upper case. This can only be placed after a string\nsample fetch function or after a transformation keyword returning a string\ntype. The result is of type string.\n\n```\n\n**[url_dec](#7.3.1-url_dec)**([<in_form>])```\nTakes an url-encoded string provided as input and returns the decoded version\nas output. The input and the output are of type string. If the <in_form>\nargument is set to a non-zero integer value, the input string is assumed to\nbe part of a form or query string and the '+' character will be turned into a\nspace (' '). Otherwise this will only happen after a question mark indicating\na query string ('?').\n\n```\n\n**[url_enc](#7.3.1-url_enc)**([<enc_type>])```\nTakes a string provided as input and returns the encoded version as output.\nThe input and the output are of type string. By default the type of encoding\nis meant for `query` type. There is no other type supported for now but the\noptional argument is here for future changes.\n\n```\n\n**[us_ltime](#7.3.1-us_ltime)**(<format>[,<offset>])```\nThis works like \"ltime\" but takes an input in microseconds. It also supports\nthe %N conversion specifier inspired by date(1).\nConverts an integer supposed to contain a date since epoch to a string\nrepresenting this date in local time using a format defined by the <format>\nstring using strftime(3). The purpose is to allow any date format to be used\nin logs. An optional <offset> in microseconds may be applied to the input\ndate (positive or negative). See the strftime() man page for the format\nsupported by your operating system.\n\nThe %N conversion specifier allows you to output the nanoseconds part of the\ndate, precision is limited since the input is microseconds.\n(000000000..999999000). %N can take a width argument between % and N. It is\nuseful to display milliseconds (%3N) or microseconds (%6N). The default and\nmaximum width is 9 (%N = %9N).\n\nSee also the \"utime\" converter for UTC as well as \"ltime\" and \"ms_ltime\"\nconverters.\n\n```\n\nExample :```\n\n# Emit 3 colons, the local time, the timezone and another with ip:port\n# e.g. 2023/07/24/09:53:02.196234 +0000 127.0.0.1:41530\nlog-format %[accept_date(us),us_ltime(\"%Y/%m/%d/%H:%M:%S.%6N %z\")]\\ %ci:%cp\n\n```\n\n**[us_utime](#7.3.1-us_utime)**(<format>[,<offset>])```\nThis works like \"utime\" but takes an input in microseconds. It also supports\nthe %N conversion specifier inspired by date(1).\nConverts an integer supposed to contain a date since epoch to a string\nrepresenting this date in UTC time using a format defined by the <format>\nstring using strftime(3). The purpose is to allow any date format to be used\nin logs. An optional <offset> in microseconds may be applied to the input\ndate (positive or negative). See the strftime() man page for the format\nsupported by your operating system.\n\nThe %N conversion specifier allows you to output the nanoseconds part of the\ndate, precision is limited since the input is microseconds.\n(000000000..999999000). %N can take a width argument between % and N. It is\nuseful to display milliseconds (%3N) or microseconds (%6N). The default and\nmaximum width is 9 (%N = %9N).\n\nSee also the \"ltime\" converter for local as well as \"utime\" and \"ms_utime\"\nconverters.\n\n```\n\nExample :```\n\n# Emit 3 colons, the UTC time, the timezone and another with ip:port\n# e.g. 2023/07/24/09:53:02.196234 +0000 127.0.0.1:41530\nlog-format %[accept_date(us),us_utime(\"%Y/%m/%d/%H:%M:%S.%6N %z\")]\\ %ci:%cp\n\n```\n\n**[utime](#7.3.1-utime)**(<format>[,<offset>])```\nConverts an integer supposed to contain a date since epoch to a string\nrepresenting this date in UTC time using a format defined by the <format>\nstring using strftime(3). The purpose is to allow any date format to be used\nin logs. An optional <offset> in seconds may be applied to the input date\n(positive or negative). See the strftime() man page for the format supported\nby your operating system. See also the \"ltime\" converter as well as \"ms_utime\"\nand \"us_utime\".\n\n```\n\nExample :```\n\n# Emit two colons, one with the UTC time and another with ip:port\n# e.g.  20140710162350 127.0.0.1:57325\nlog-format %[date,utime(%Y%m%d%H%M%S)]\\ %ci:%cp\n\n```\n\n**[when](#7.3.1-when)**(<condition>[,<args>...])```\nEvaluates the condition and when true, passes the input sample as-is to the\noutput, otherwise return nothing. This is designed specifically to produce\nsome rarely needed data that should only be emitted under certain conditions,\nsuch as debugging information when an error is met.\n\nThe condition is made of a keyword among the list below, optionally preceded\nby an exclamation mark ('!') to negate it, and optionally suffixed by some\narguments specific to that condition:\n\n  - \"error\" returns true when an error was encountered during the processing\n    of the request or stream. It uses the same rules as \"dontlog-normal\"\n    (e.g. a successful redispatch counts as an error).\n\n  - \"forwarded\" returns true when the request was forwarded to a backend\n    server\n\n  - \"normal\" returns true when no error happened (this is equivalent to\n    \"!error\").\n\n  - \"processed\" returns true when the request was either forwarded to a\n    backend server, or processed by an applet.\n\n  - \"stopping\" returns true if the process is currently stopping when the\n    rule is evaluated\n\n  - \"toapplet\" returns true when the request was processed by an applet.\n\n  - \"aclThis keyword is available in sections :Fcgi-app sectionAlphabetically sorted keywords referenceFetching samples from internal states\" returns true when the ACL designated by the next argument evaluates\n    to true. Note that the ACL is evaluated inline by the converter, so that\n    what it refers to must be valid in that context. A particular use case\n    consists in evaluating if the total transfer time is too long or not\n    before deciding to log detauls from abnormally long transfers.\n\nNote that the content is evaluated in any case, so doing this does not avoid\nthe generation of that information. It's only meant to avoid producing that\ninformation.\n\nAn example would be to add backend stream debugging information in the logs\nonly when an error was encountered during processing, or logging extra\ninformation when stopping, etc.\n\n```\n\nExample:```\n\n# log \"dbg={-}\" when fine, or \"dbg={... debug info ...}\" on error:\nlog-format \"$HAPROXY_HTTP_LOG_FMT dbg={%[bs.debug_str,when(!normal)]}\"\n\nHere, the \"dbg\" field in the log will only contain an dash ('-') to\nindicate a missing content when the rule is not validated, and will emit a\nwhole debugging block when it is.\n\n```\n\n```\nExample\n  # log \"dbg={-}\" when fine, or \"dbg={... debug info ...}\" on slow transfers\n  acl slow_xfer res.timer.data ge 10000   # more than 10s is slow\n  log-format \"$HAPROXY_HTTP_LOG_FMT                                         \\\n              fsdbg={%[fs.debug_str,when(acl,slow_xfer)]}                   \\\n              bsdbg={%[bs.debug_str,when(acl,slow_xfer)]}\"\n\nExample\n  # only emit the backend src/port when a real connection was issued:\n  log-format \"$HAPROXY_HTTP_LOG_FMT \\\n             src=[%[bc_src,when(forwarded)]:%[bc_src_port,when(forwarded)]]\"\n\nSince it kills the evaluation of the expression when it is not true, it is\nalso possible to use it to stop a subsequent converter from being called.\nThis may for example be used to call the debug() converter only upon error,\nto log an element only when absolutely necessary.\n\n```\n\nExample:```\n\n# emit the whole response headers list to stderr only on error and only\n# when the output is a connection. We abuse a dummy variable here.\nhttp-after-response set-var(res.test) \\\n              res.hdrs,when(error),when(forwarded),debug(hdrs,stderr)\n\n```\n\n**See also:**debug converter**[word](#7.3.1-word)**(<index>,<delimiters>[,<count>])```\nExtracts the nth word counting from the beginning (positive index) or from\nthe end (negative index) considering given delimiters from an input string.\nIndexes start at 1 or -1 and delimiters are a string formatted list of chars.\nEmpty words are skipped. This means that delimiters at the start or end of\nthe input string are ignored and consecutive delimiters within the input\nstring are considered to be a single delimiter.\nOptionally you can specify <count> of words to extract (default: 1).\nValue of 0 indicates extraction of all remaining words.\n\n```\n\nExample :```\n\nstr(f1_f2_f3__f5),word(4,_)    # f5\nstr(f1_f2_f3__f5),word(5,_)    # <not found>\nstr(f1_f2_f3__f5),word(2,_,0)  # f2_f3__f5\nstr(f1_f2_f3__f5),word(3,_,2)  # f3__f5\nstr(f1_f2_f3__f5),word(-2,_,3) # f1_f2_f3\nstr(f1_f2_f3__f5),word(-3,_,0) # f1_f2\nstr(/f1/f2/f3/f4),word(1,/)    # f1\nstr(/f1////f2/f3/f4),word(1,/) # f2\n\n```\n\n**[wt6](#7.3.1-wt6)**([<avalanche>])```\nHashes a binary input sample into an unsigned 32-bit quantity using the WT6\nhash function. Optionally, it is possible to apply a full avalanche hash\nfunction to the output if the optional <avalanche> argument equals 1. This\nconverter uses the same functions as used by the various hash-based load\nbalancing algorithms, so it will provide exactly the same results. It is\nmostly intended for debugging, but can be used as a stick-table entry to\ncollect rough statistics. It must not be used for security purposes as a\n32-bit hash is trivial to break. See also \"crc32\", \"djb2\", \"sdbm\", \"crc32c\",\nand the \"hash-type\" directive.\n\n```\n\n**[x509_v_err_str](#7.3.1-x509_v_err_str)**```\nConvert a numerical value to its corresponding X509_V_ERR constant name. It\nis useful in ACL in order to have a configuration which works with multiple\nversion of OpenSSL since some codes might change when changing version.\n\nWhen the corresponding constant name was not found, outputs the numerical\nvalue as a string.\n\nThe list of constant provided by OpenSSL can be found at\nhttps://www.openssl.org/docs/manmaster/man3/X509_STORE_CTX_get_error.html#ERROR-CODES\nBe careful to read the page for the right version of OpenSSL.\n\n```\n\nExample:```\n\nbind :443 ssl crt common.pem ca-file ca-auth.crt verify optional crt-ignore-err X509_V_ERR_CERT_REVOKED,X509_V_ERR_CERT_HAS_EXPIRED\n\nacl cert_expired ssl_c_verify,x509_v_err_str -m str X509_V_ERR_CERT_HAS_EXPIRED\nacl cert_revoked ssl_c_verify,x509_v_err_str -m str X509_V_ERR_CERT_REVOKED\nacl cert_ok      ssl_c_verify,x509_v_err_str -m str X509_V_OK\n\nhttp-response add-header X-SSL Ok if cert_ok\nhttp-response add-header X-SSL Expired if cert_expired\nhttp-response add-header X-SSL Revoked if cert_revoked\n\nhttp-response add-header X-SSL-verify %[ssl_c_verify,x509_v_err_str]\n\n```\n\n**[xor](#7.3.1-xor)**(<value>)```\nPerforms a bitwise \"XOR\" (exclusive OR) between <value> and the input value\nof type signed integer, and returns the result as an signed integer.\n<value> can be a numeric value or a variable name. See section 2.8 about\nvariables for details.\n\n```\n\n**[xxh3](#7.3.1-xxh3)**([<seed>])```\nHashes a binary input sample into a signed 64-bit quantity using the XXH3\n64-bit variant of the XXhash hash function. This hash supports a seed which\ndefaults to zero but a different value maybe passed as the <seed> argument.\nThis hash is known to be very good and very fast so it can be used to hash\nURLs and/or URL parameters for use as stick-table keys to collect statistics\nwith a low collision rate, though care must be taken as the algorithm is not\nconsidered as cryptographically secure.\n\n```\n\n**[xxh32](#7.3.1-xxh32)**([<seed>])```\nHashes a binary input sample into an unsigned 32-bit quantity using the 32-bit\nvariant of the XXHash hash function. This hash supports a seed which defaults\nto zero but a different value maybe passed as the <seed> argument. This hash\nis known to be very good and very fast so it can be used to hash URLs and/or\nURL parameters for use as stick-table keys to collect statistics with a low\ncollision rate, though care must be taken as the algorithm is not considered\nas cryptographically secure.\n\n```\n\n**[xxh64](#7.3.1-xxh64)**([<seed>])```\nHashes a binary input sample into a signed 64-bit quantity using the 64-bit\nvariant of the XXHash hash function. This hash supports a seed which defaults\nto zero but a different value maybe passed as the <seed> argument. This hash\nis known to be very good and very fast so it can be used to hash URLs and/or\nURL parameters for use as stick-table keys to collect statistics with a low\ncollision rate, though care must be taken as the algorithm is not considered\nas cryptographically secure.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.3.2. Fetching samples from internal states", "content": "### [7.3.2.](#7.3.2)Fetching samples from internal states\n\n```\nA first set of sample fetch methods applies to internal information which does\nnot even relate to any client information. These ones are sometimes used with\n\"monitor fail\" directives to report an internal status to external watchers.\nThe sample fetch methods described in this section are usable anywhere.\n\nSummary of sample fetch methods in this section and their respective types:\n\n```\n\nkeywordoutput type[acl([!]<name>[,...])](#7-acl)boolean[act_conn](#7-act_conn)integer[always_false](#7-always_false)boolean[always_true](#7-always_true)boolean[avg_queue([<backend>])](#7-avg_queue)integer[be_conn([<backend>])](#7-be_conn)integer[be_conn_free([<backend>])](#7-be_conn_free)integer[be_sess_rate([<backend>])](#7-be_sess_rate)integer[bin(<hex>)](#7-bin)bin[bool(<bool>)](#7-bool)bool[connslots([<backend>])](#7-connslots)integer[cpu_calls](#7-cpu_calls)integer[cpu_ns_avg](#7-cpu_ns_avg)integer[cpu_ns_tot](#7-cpu_ns_tot)integer[date([<offset>[,<unit>]])](#7-date)integer[date_us](#7-date_us)integer[env(<name>)](#7-env)string[fe_conn([<frontend>])](#7-fe_conn)integer[fe_req_rate([<frontend>])](#7-fe_req_rate)integer[fe_sess_rate([<frontend>])](#7-fe_sess_rate)integerkeywordoutput type[hostname](#7-hostname)string[int(<integer>)](#7-int)signed[ipv4(<ipv4>)](#7-ipv4)ipv4[ipv6(<ipv6>)](#7-ipv6)ipv6[last_entity](#7-last_entity)string[last_rule_file](#7-last_rule_file)string[last_rule_line](#7-last_rule_line)integer[lat_ns_avg](#7-lat_ns_avg)integer[lat_ns_tot](#7-lat_ns_tot)integer[meth(<method>)](#7-meth)method[nbsrv([<backend>])](#7-nbsrv)integer[pid](#7-pid)integer[prio_class](#7-prio_class)integer[prio_offset](#7-prio_offset)integer[proc](#7-proc)integer[queue([<backend>])](#7-queue)integer[quic_enabled](#7-quic_enabled)boolean[rand([<range>])](#7-rand)integer[srv_conn([<backend>/]<server>)](#7-srv_conn)integer[srv_conn_free([<backend>/]<server>)](#7-srv_conn_free)integerkeywordoutput type[srv_is_up([<backend>/]<server>)](#7-srv_is_up)boolean[srv_iweight([<backend>/]<server>)](#7-srv_iweight)integer[srv_queue([<backend>/]<server>)](#7-srv_queue)integer[srv_sess_rate([<backend>/]<server>)](#7-srv_sess_rate)integer[srv_uweight([<backend>/]<server>)](#7-srv_uweight)integer[srv_weight([<backend>/]<server>)](#7-srv_weight)integer[stopping](#7-stopping)boolean[str(<string>)](#7-str)string[table_avl([<table>])](#7-table_avl)integer[table_cnt([<table>])](#7-table_cnt)integer[term_events](#7-term_events)string[thread](#7-thread)integer[txn.id32](#7-txn.id32)integer[txn.sess_term_state](#7-txn.sess_term_state)string[uptime](#7-uptime)integer[uuid([<version>])](#7-uuid)string[var(<var-name>[,<default>])](#7-var)undefined[wait_end](#7-wait_end)boolean[waiting_entity](#7-waiting_entity)string```\nDetailed list:\n\n```\n\n**[acl](#7.3.2-acl)**([!]<name>[,...]) : boolean```\nReturns true if the evaluation of all the named ACL(s) is true, otherwise\nreturns false. Up to 12 ACLs may be provided, each delimited by comma. Each\nnamed ACL may be prefixed with a \"!\" to invert the result. If any evaluation\nproduces an error then the sample also returns an error.\nNote that HAProxy does not perform any validation checks on the referenced\nACLs, such as whether an ACL which uses a http request sample is used in\nresponse context. This behavior may be changed in the future.\n\n```\n\n**[act_conn](#7.3.2-act_conn)**: integer```\nReturns the total number of active concurrent connections on the process.\n\n```\n\n**[always_false](#7.3.2-always_false)**: boolean```\nAlways returns the boolean \"false\" value. It may be used with ACLs as a\ntemporary replacement for another one when adjusting configurations.\n\n```\n\n**[always_true](#7.3.2-always_true)**: boolean```\nAlways returns the boolean \"true\" value. It may be used with ACLs as a\ntemporary replacement for another one when adjusting configurations.\n\n```\n\n**[avg_queue](#7.3.2-avg_queue)**([<backend>]) : integer```\nReturns the total number of queued connections of the designated backend\ndivided by the number of active servers. The current backend is used if no\nbackend is specified. This is very similar to \"queue\" except that the size of\nthe farm is considered, in order to give a more accurate measurement of the\ntime it may take for a new connection to be processed. The main usage is with\nACL to return a sorry page to new users when it becomes certain they will get\na degraded service, or to pass to the backend servers in a header so that\nthey decide to work in degraded mode or to disable some functions to speed up\nthe processing a bit. Note that in the event there would not be any active\nserver anymore, twice the number of queued connections would be considered as\nthe measured value. This is a fair estimate, as we expect one server to get\nback soon anyway, but we still prefer to send new traffic to another backend\nif in better shape. See also the \"queue\", \"be_conn\", and \"be_sess_rate\"\nsample fetches.\n\n```\n\n**[be_conn](#7.3.2-be_conn)**([<backend>]) : integer```\nApplies to the number of currently established connections on the backend,\npossibly including the connection being evaluated. If no backend name is\nspecified, the current one is used. But it is also possible to check another\nbackend. It can be used to use a specific farm when the nominal one is full.\nSee also the \"fe_conn\", \"queue\", \"be_conn_free\", and \"be_sess_rate\" criteria.\n\n```\n\n**[be_conn_free](#7.3.2-be_conn_free)**([<backend>]) : integer```\nReturns an integer value corresponding to the number of available connections\nacross available servers in the backend. Queue slots are not included. Backup\nservers are also not included, unless all other servers are down. If no\nbackend name is specified, the current one is used. But it is also possible\nto check another backend. It can be used to use a specific farm when the\nnominal one is full. See also the \"be_conn\", \"connslots\", and \"srv_conn_free\"\ncriteria.\n\nOTHER CAVEATS AND NOTES: if any of the server maxconn, or maxqueue is 0\n(meaning unlimited), then this fetch clearly does not make sense, in which\ncase the value returned will be -1.\n\n```\n\n**[be_sess_rate](#7.3.2-be_sess_rate)**([<backend>]) : integer```\nReturns an integer value corresponding to the sessions creation rate on the\nbackend, in number of new sessions per second. This is used with ACLs to\nswitch to an alternate backend when an expensive or fragile one reaches too\nhigh a session rate, or to limit abuse of service (e.g. prevent sucking of an\nonline dictionary). It can also be useful to add this element to logs using a\nlog-format directive.\n\n```\n\nExample :```\n\n# Redirect to an error page if the dictionary is requested too often\nbackend dynamic\n    mode http\n    acl being_scanned be_sess_rate gt 100\n    redirect location /denied.html if being_scanned\n\n```\n\n**[bin](#7.3.2-bin)**(<hex>) : bin```\nReturns a binary chain. The input is the hexadecimal representation\nof the string.\n\n```\n\n**[bool](#7.3.2-bool)**(<bool>) : bool```\nReturns a boolean value. <bool> can be 'true', 'false', '1' or '0'.\n'false' and '0' are the same. 'true' and '1' are the same.\n\n```\n\n**[connslots](#7.3.2-connslots)**([<backend>]) : integer```\nReturns an integer value corresponding to the number of connection slots\nstill available in the backend, by totaling the maximum amount of\nconnections on all servers and the maximum queue size. This is probably only\nused with ACLs.\n\nThe basic idea here is to be able to measure the number of connection \"slots\"\nstill available (connection + queue), so that anything beyond that (intended\nusage; see \"use_backend\" keyword) can be redirected to a different backend.\n\n'connslots' = number of available server connection slots, + number of\navailable server queue slots.\n\nNote that while \"fe_conn\" may be used, \"connslots\" comes in especially\nuseful when you have a case of traffic going to one single ip, splitting into\nmultiple backends (perhaps using ACLs to do name-based load balancing) and\nyou want to be able to differentiate between different backends, and their\navailable \"connslots\". Also, whereas \"nbsrvThis keyword is available in sections :ConvertersFetching samples from internal states\" only measures servers that are\nactually *down*, this fetch is more fine-grained and looks into the number of\navailable connection slots as well. See also \"queue\" and \"avg_queue\".\n\nOTHER CAVEATS AND NOTES: at this point in time, the code does not take care\nof dynamic connections. Also, if any of the server maxconn, or maxqueue is 0,\nthen this fetch clearly does not make sense, in which case the value returned\nwill be -1.\n\n```\n\n**[cpu_calls](#7.3.2-cpu_calls)**: integer```\nReturns the number of calls to the task processing the stream or current\nrequest since it was allocated. This number is reset for each new request on\nthe same connections in case of HTTP keep-alive. This value should usually be\nlow and stable (around 2 calls for a typically simple request) but may become\nhigh if some processing (compression, caching or analysis) is performed. This\nis purely for performance monitoring purposes.\n\n```\n\n**[cpu_ns_avg](#7.3.2-cpu_ns_avg)**: integer```\nReturns the average number of nanoseconds spent in each call to the task\nprocessing the stream or current request. This number is reset for each new\nrequest on the same connections in case of HTTP keep-alive. This value\nindicates the overall cost of processing the request or the connection for\neach call. There is no good nor bad value but the time spent in a call\nautomatically causes latency for other processing (see lat_ns_avg below),\nand may affect other connection's apparent response time. Certain operations\nlike compression, complex regex matching or heavy Lua operations may directly\naffect this value, and having it in the logs will make it easier to spot the\nfaulty processing that needs to be fixed to recover decent performance.\nNote: this value is exactly cpu_ns_tot divided by cpu_calls.\n\n```\n\n**[cpu_ns_tot](#7.3.2-cpu_ns_tot)**: integer```\nReturns the total number of nanoseconds spent in each call to the task\nprocessing the stream or current request. This number is reset for each new\nrequest on the same connections in case of HTTP keep-alive. This value\nindicates the overall cost of processing the request or the connection for\neach call. There is no good nor bad value but the time spent in a call\nautomatically causes latency for other processing (see lat_ns_avg below),\ninduces CPU costs on the machine, and may affect other connection's apparent\nresponse time. Certain operations like compression, complex regex matching or\nheavy Lua operations may directly affect this value, and having it in the\nlogs will make it easier to spot the faulty processing that needs to be fixed\nto recover decent performance. The value may be artificially high due to a\nhigh cpu_calls count, for example when processing many HTTP chunks, and for\nthis reason it is often preferred to log cpu_ns_avg instead.\n\n```\n\n**[date](#7.3.2-date)**([<offset>[,<unit>]]) : integer```\nReturns the current date as the epoch (number of seconds since 01/01/1970).\n\nIf an offset value is specified, then it is added to the current date before\nreturning the value. This is particularly useful to compute relative dates,\nas both positive and negative offsets are allowed.\nIt is useful combined with the http_date converter.\n\n<unit> is facultative, and can be set to \"s\" for seconds (default behavior),\n\"ms\" for  milliseconds or \"us\" for microseconds.\nIf unit is set, return value is an integer reflecting either seconds,\nmilliseconds or microseconds since epoch, plus offset.\nIt is useful when a time resolution of less than a second is needed.\n\n```\n\nExample :```\n\n# set an expires header to now+1 hour in every response\nhttp-response set-header Expires %[date(3600),http_date]\n\n# set an expires header to now+1 hour in every response, with\n# millisecond granularity\nhttp-response set-header Expires %[date(3600000,ms),http_date(0,ms)]\n\n```\n\n**[date_us](#7.3.2-date_us)**: integer```\nReturn the microseconds part of the date (the \"second\" part is returned by\ndate sample). This sample is coherent with the date sample as it is comes\nfrom the same timeval structure.\n\n```\n\n**[env](#7.3.2-env)**(<name>) : string```\nReturns a string containing the value of environment variable <name>. As a\nreminder, environment variables are per-process and are sampled when the\nprocess starts. This can be useful to pass some information to a next hop\nserver, or with ACLs to take specific action when the process is started a\ncertain way.\n\n```\n\nExamples :```\n\n# Pass the Via header to next hop with the local hostname in it\nhttp-request add-header Via 1.1\\ %[env(HOSTNAME)]\n\n# reject cookie-less requests when the STOP environment variable is set\nhttp-request deny if !{ req.cook(SESSIONID) -m found } { env(STOP) -m found }\n\n```\n\n**[fe_conn](#7.3.2-fe_conn)**([<frontend>]) : integer```\nReturns the number of currently established connections on the frontend,\npossibly including the connection being evaluated. If no frontend name is\nspecified, the current one is used. But it is also possible to check another\nfrontend. It can be used to return a sorry page before hard-blocking, or to\nuse a specific backend to drain new requests when the farm is considered\nfull. This is mostly used with ACLs but can also be used to pass some\nstatistics to servers in HTTP headers. See also the \"dst_conn\", \"be_conn\",\n\"fe_sess_rate\" fetches.\n\n```\n\n**[fe_req_rate](#7.3.2-fe_req_rate)**([<frontend>]) : integer```\nReturns an integer value corresponding to the number of HTTP requests per\nsecond sent to a frontend. This number can differ from \"fe_sess_rate\" in\nsituations where client-side keep-alive is enabled.\n\n```\n\n**[fe_sess_rate](#7.3.2-fe_sess_rate)**([<frontend>]) : integer```\nReturns an integer value corresponding to the sessions creation rate on the\nfrontend, in number of new sessions per second. This is used with ACLs to\nlimit the incoming session rate to an acceptable range in order to prevent\nabuse of service at the earliest moment, for example when combined with other\nlayer 4 ACLs in order to force the clients to wait a bit for the rate to go\ndown below the limit. It can also be useful to add this element to logs using\na log-format directive. See also the \"rate-limit sessions\" directive for use\nin frontends.\n\n```\n\nExample :```\n\n# This frontend limits incoming mails to 10/s with a max of 100\n# concurrent connections. We accept any connection below 10/s, and\n# force excess clients to wait for 100 ms. Since clients are limited to\n# 100 max, there cannot be more than 10 incoming mails per second.\nfrontend mail\n    bind :25\n    mode tcp\n    maxconn 100\n    acl too_fast fe_sess_rate ge 10\n    tcp-request inspect-delay 100ms\n    tcp-request content accept if ! too_fast\n    tcp-request content accept if WAIT_END\n\n```\n\n**[hostname](#7.3.2-hostname)**: string```\nReturns the system hostname.\n\n```\n\n**[int](#7.3.2-int)**(<integer>) : signed integer```\nReturns a signed integer.\n\n```\n\n**[ipv4](#7.3.2-ipv4)**(<ipv4>) : ipv4```\nReturns an ipv4.\n\n```\n\n**[ipv6](#7.3.2-ipv6)**(<ipv6>) : ipv6```\nReturns an ipv6.\n\n```\n\n**[last_entity](#7.3.2-last_entity)**: string```\nThis returns the identity of the last entity that was evaluated during stream\nanalysis. It may be the final rule that matched or the filter that\ninterrupted the processing.\n\nA final rule is one that terminates the evaluation of the rule set (like an\n\"accept\", \"deny\" or \"redirectThis keyword is available in sections :Alphabetically sorted keywords referenceAlphabetically sorted actions reference\"). This works for TCP request and response\nrules acting on the \"content\" rulesets, and on HTTP rules from\n\"http-request\", \"http-response\" and \"http-after-response\" rule sets. The\nlegacy \"redirectThis keyword is available in sections :Alphabetically sorted keywords referenceAlphabetically sorted actions reference\" rulesets are not supported (such information is not stored\nthere), and neither \"tcp-request connection\" nor \"tcp-request session\"\nrulesets are supported because the information is stored at the stream level\nand streams do not exist during these rules. In that case, the returned value\nis equivalent to \"last_rule_file:last_rule_line\".\nSee also \"last_rule_file\", \"last_rule_line\".\n\nFor a filter, its identifier is returned as defined by the developers. If\nthis identifier is not defined, an hexadecimal value is returned\ncorresponding to an unique internal identifier.\n\nThe main purpose of this function is to be able to report in logs the last\nentity that interrupted a processing, in order to help debugging issues. The\ninformation returned on entities may changed in time and must not be used for\nsomething else than debugging.\n\n```\n\nExample:```\n\n# Log the last entity, if any, and only if an error is reported\nlog-format \"$HAPROXY_HTTP_LOG_FMT %{Q}[last_entity,when(error)]\n\n```\n\n**[last_rule_file](#7.3.2-last_rule_file)**: string```\nThis returns the name of the configuration file containing the last final\nrule that was matched during stream analysis. A final rule is one that\nterminates the evaluation of the rule set (like an \"accept\", \"deny\" or\n\"redirectThis keyword is available in sections :Alphabetically sorted keywords referenceAlphabetically sorted actions reference\"). This works for TCP request and response rules acting on the\n\"content\" rulesets, and on HTTP rules from \"http-request\", \"http-response\"\nand \"http-after-response\" rule sets. The legacy \"redirectThis keyword is available in sections :Alphabetically sorted keywords referenceAlphabetically sorted actions reference\" rulesets are not\nsupported (such information is not stored there), and neither \"tcp-request\nconnection\" nor \"tcp-request session\" rulesets are supported because the\ninformation is stored at the stream level and streams do not exist during\nthese rules. The main purpose of this function is to be able to report in\nlogs where was the rule that gave the final verdict, in order to help\nfigure why a request was denied for example. See also \"last_rule_line\".\n\n```\n\n**[last_rule_line](#7.3.2-last_rule_line)**: integer```\nThis returns the line number in the configuration file where is located the\nlast final rule that was matched during stream analysis. A final rule is one\nthat terminates the evaluation of the rule set (like an \"accept\", \"deny\" or\n\"redirectThis keyword is available in sections :Alphabetically sorted keywords referenceAlphabetically sorted actions reference\"). This works for TCP request and response rules acting on the\n\"content\" rulesets, and on HTTP rules from \"http-request\", \"http-response\"\nand \"http-after-response\" rule sets. The legacy \"redirectThis keyword is available in sections :Alphabetically sorted keywords referenceAlphabetically sorted actions reference\" rulesets are not\nsupported (such information is not stored there), and neither \"tcp-request\nconnection\" nor \"tcp-request session\" rulesets are supported because the\ninformation is stored at the stream level and streams do not exist during\nthese rules. The main purpose of this function is to be able to report in\nlogs where was the rule that gave the final verdict, in order to help\nfigure why a request was denied for example. See also \"last_rule_file\".\n\n```\n\n**[lat_ns_avg](#7.3.2-lat_ns_avg)**: integer```\nReturns the average number of nanoseconds spent between the moment the task\nhandling the stream is woken up and the moment it is effectively called. This\nnumber is reset for each new request on the same connections in case of HTTP\nkeep-alive. This value indicates the overall latency inflicted to the current\nrequest by all other requests being processed in parallel, and is a direct\nindicator of perceived performance due to noisy neighbours. In order to keep\nthe value low, it is possible to reduce the scheduler's run queue depth using\n\"tune.runqueue-depth\", to reduce the number of concurrent events processed at\nonce using \"tune.maxpollevents\", to decrease the stream's nice value using\nthe \"nice\" option on the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines or in the frontend, to enable low\nlatency scheduling using \"tune.sched.low-latency\", or to look for other heavy\nrequests in logs (those exhibiting large values of \"cpu_ns_avg\"), whose\nprocessing needs to be adjusted or fixed. Compression of large buffers could\nbe a culprit, like heavy regex or long lists of regex. Note: this value is\nexactly lat_ns_tot divided by cpu_calls.\n\n```\n\n**[lat_ns_tot](#7.3.2-lat_ns_tot)**: integer```\nReturns the total number of nanoseconds spent between the moment the task\nhandling the stream is woken up and the moment it is effectively called. This\nnumber is reset for each new request on the same connections in case of HTTP\nkeep-alive. This value indicates the overall latency inflicted to the current\nrequest by all other requests being processed in parallel, and is a direct\nindicator of perceived performance due to noisy neighbours. In order to keep\nthe value low, it is possible to reduce the scheduler's run queue depth using\n\"tune.runqueue-depth\", to reduce the number of concurrent events processed at\nonce using \"tune.maxpollevents\", to decrease the stream's nice value using\nthe \"nice\" option on the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines or in the frontend, to enable low\nlatency scheduling using \"tune.sched.low-latency\", or to look for other heavy\nrequests in logs (those exhibiting large values of \"cpu_ns_avg\"), whose\nprocessing needs to be adjusted or fixed. Compression of large buffers could\nbe a culprit, like heavy regex or long lists of regex. Note: while it\nmay intuitively seem that the total latency adds to a transfer time, it is\nalmost never true because while a task waits for the CPU, network buffers\ncontinue to fill up and the next call will process more at once. The value\nmay be artificially high due to a high cpu_calls count, for example when\nprocessing many HTTP chunks, and for this reason it is often preferred to log\nlat_ns_avg instead, which is a more relevant performance indicator.\n\n```\n\n**[meth](#7.3.2-meth)**(<method>) : method```\nReturns a method.\n\n```\n\n**[nbsrv](#7.3.2-nbsrv)**([<backend>]) : integer```\nReturns an integer value corresponding to the number of usable servers of\neither the current backend or the named backend. This is mostly used with\nACLs but can also be useful when added to logs. This is normally used to\nswitch to an alternate backend when the number of servers is too low to\nto handle some load. It is useful to report a failure when combined with\n\"monitor fail\".\n\n```\n\n**[pid](#7.3.2-pid)**: integer```\nReturn the PID of the current process. In most cases this is the PID of the\nworker process.\n\n```\n\n**[prio_class](#7.3.2-prio_class)**: integer```\nReturns the priority class of the current stream for http mode or connection\nfor tcp mode. The value will be that set by the last call to \"http-request\nset-priority-class\" or \"tcp-request content set-priority-class\".\n\n```\n\n**[prio_offset](#7.3.2-prio_offset)**: integer```\nReturns the priority offset of the current stream for http mode or\nconnection for tcp mode. The value will be that set by the last call to\n\"http-request set-priority-offset\" or \"tcp-request content\nset-priority-offset\".\n\n```\n\n**[proc](#7.3.2-proc)**: integer```\nAlways returns value 1 (historically it would return the calling process\nnumber).\n\n```\n\n**[queue](#7.3.2-queue)**([<backend>]) : integer```\nReturns the total number of queued connections of the designated backend,\nincluding all the connections in server queues. If no backend name is\nspecified, the current one is used, but it is also possible to check another\none. This is useful with ACLs or to pass statistics to backend servers. This\ncan be used to take actions when queuing goes above a known level, generally\nindicating a surge of traffic or a massive slowdown on the servers. One\npossible action could be to reject new users but still accept old ones. See\nalso the \"avg_queue\", \"be_conn\", and \"be_sess_rate\" fetches.\n\n```\n\n**[quic_enabled](#7.3.2-quic_enabled)**: boolean```\nReturn true when the support for QUIC transport protocol was compiled and\nif this protocol was not disabled by \"no-quic\" global option. See also \"no-quic\"\nglobal option.\n\n```\n\n**[rand](#7.3.2-rand)**([<range>]) : integer```\nReturns a random integer value within a range of <range> possible values,\nstarting at zero. If the range is not specified, it defaults to 2^32, which\ngives numbers between 0 and 4294967295. It can be useful to pass some values\nneeded to take some routing decisions for example, or just for debugging\npurposes. This random must not be used for security purposes.\n\n```\n\n**[srv_conn](#7.3.2-srv_conn)**([<backend>/]<server>) : integer```\nReturns an integer value corresponding to the number of currently established\nconnections on the designated server, possibly including the connection being\nevaluated. If <backend> is omitted, then the server is looked up in the\ncurrent backend. It can be used to use a specific farm when one server is\nfull, or to inform the server about our view of the number of active\nconnections with it. See also the \"fe_conn\", \"be_conn\", \"queue\", and\n\"srv_conn_free\" fetch methods.\n\n```\n\n**[srv_conn_free](#7.3.2-srv_conn_free)**([<backend>/]<server>) : integer```\nReturns an integer value corresponding to the number of available connections\non the designated server, possibly including the connection being evaluated.\nThe value does not include queue slots. If <backend> is omitted, then the\nserver is looked up in the current backend. It can be used to use a specific\nfarm when one server is full, or to inform the server about our view of the\nnumber of active connections with it. See also the \"be_conn_free\" and\n\"srv_conn\" fetch methods.\n\nOTHER CAVEATS AND NOTES: If the server maxconn is 0, then this fetch clearly\ndoes not make sense, in which case the value returned will be -1.\n\n```\n\n**[srv_is_up](#7.3.2-srv_is_up)**([<backend>/]<server>) : boolean```\nReturns true when the designated server is UP, and false when it is either\nDOWN or in maintenance mode. If <backend> is omitted, then the server is\nlooked up in the current backend. It is mainly used to take action based on\nan external status reported via a health check (e.g. a geographical site's\navailability). Another possible use which is more of a hack consists in\nusing dummy servers as boolean variables that can be enabled or disabled from\nthe CLI, so that rules depending on those ACLs can be tweaked in realtime.\n\n```\n\n**[srv_iweight](#7.3.2-srv_iweight)**([<backend>/]<server>) : integer```\nReturns an integer corresponding to the server's initial weight. If <backend>\nis omitted, then the server is looked up in the current backend. See also\n\"srv_weight\" and \"srv_uweight\".\n\n```\n\n**[srv_queue](#7.3.2-srv_queue)**([<backend>/]<server>) : integer```\nReturns an integer value corresponding to the number of connections currently\npending in the designated server's queue. If <backend> is omitted, then the\nserver is looked up in the current backend. It can sometimes be used together\nwith the \"use-server\" directive to force to use a known faster server when it\nis not much loaded. See also the \"srv_conn\", \"avg_queue\" and \"queue\" sample\nfetch methods.\n\n```\n\n**[srv_sess_rate](#7.3.2-srv_sess_rate)**([<backend>/]<server>) : integer```\nReturns an integer corresponding to the sessions creation rate on the\ndesignated server, in number of new sessions per second. If <backend> is\nomitted, then the server is looked up in the current backend. This is mostly\nused with ACLs but can make sense with logs too. This is used to switch to an\nalternate backend when an expensive or fragile one reaches too high a session\nrate, or to limit abuse of service (e.g. prevent latent requests from\noverloading servers).\n\n```\n\nExample :```\n\n# Redirect to a separate back\nacl srv1_full srv_sess_rate(be1/srv1) gt 50\nacl srv2_full srv_sess_rate(be1/srv2) gt 50\nuse_backend be2 if srv1_full or srv2_full\n\n```\n\n**[srv_uweight](#7.3.2-srv_uweight)**([<backend>/]<server>) : integer```\nReturns an integer corresponding to the user visible server's weight. If\n<backend> is omitted, then the server is looked up in the current\nbackend. See also \"srv_weight\" and \"srv_iweight\".\n\n```\n\n**[srv_weight](#7.3.2-srv_weight)**([<backend>/]<server>) : integer```\nReturns an integer corresponding to the current (or effective) server's\nweight. If <backend> is omitted, then the server is looked up in the current\nbackend. See also \"srv_iweight\" and \"srv_uweight\".\n\n```\n\n**[stopping](#7.3.2-stopping)**: boolean```\nReturns TRUE if the process calling the function is currently stopping. This\ncan be useful for logging, or for relaxing certain checks or helping close\ncertain connections upon graceful shutdown.\n\n```\n\n**[str](#7.3.2-str)**(<string>) : string```\nReturns a string.\n\n```\n\n**[table_avl](#7.3.2-table_avl)**([<table>]) : integer```\nReturns the total number of available entries in the current proxy's\nstick-table or in the designated stick-table. See also \"table_cnt\".\n\n```\n\n**[table_cnt](#7.3.2-table_cnt)**([<table>]) : integer```\nReturns the total number of entries currently in use in the current proxy's\nstick-table or in the designated stick-table. See also \"table_conn_cnt\" and\ntable_avl for other entry counting methods.\n\n```\n\n**[term_events](#7.3.2-term_events)**: string```\nReturns all known termination events for all entities attached a stream, on\nclient and server sides. A tuple of seven elements is returned with following info:\n\n  - the termination events of the frontend connection\n  - the termination events of the frontend mux connection\n  - the termination events of the frontend stream endpoint descriptor\n    (the mux stream or the applet)\n  - the termination events of the stream\n  - the termination events of the backend stream endpoint descriptor\n    (the mux stream or the applet)\n  - the termination events of the backend mux connection\n  - the termination events of the backend connection\n\nAt each level, the first four events are reported. An empty string is\nreturned if no event was reported yet for a specific level. If termination\nevents are not supported, a \"-\" is returned.\n\nIt must only be used for debugging purpose. The exact format is not\ndocumented because it may evolve depending on developers requirements.\n\n```\n\n**[thread](#7.3.2-thread)**: integer```\nReturns an integer value corresponding to the position of the thread calling\nthe function, between 0 and (global.nbthread-1). This is useful for logging\nand debugging purposes.\n\n```\n\n**[txn.id32](#7.3.2-txn.id32)**: integer```\nReturns the internal transaction ID. It is a 32bits integer. So, in absolute,\nits value is not unique, transaction IDs may wrap. The wrapping period\ndepends on the request rate. In practice, it should not be an issue. For a\ntrue unique ID, see \"unique-id-format\" directive.\n\n```\n\n**[txn.sess_term_state](#7.3.2-txn.sess_term_state)**: string```\nReturns the TCP or HTTP stream termination state, as reported in the log. It\nis a 2-characters string, The final stream state followed by the event which\ncaused its to terminate. See section 8.5 about stream state at disconnection\nfor the list of possible events. The current value at time the sample fetch\nis evaluated is returned. It is subject to change. Except used with ACLs in\n\"http-after-response\" rule sets or in log messages, it will always be \"--\".\n\n```\n\nExample:```\n\n# Return a 429-Too-Many-Requests if stream timed out in queue\nhttp-after-response set-status 429 if { txn.sess_term_state  \"sQ\" }\n\n```\n\n**[uptime](#7.3.2-uptime)**: integer```\nReturns the uptime of the current HAProxy worker in seconds.\n\n```\n\n**[uuid](#7.3.2-uuid)**([<version>]) : string```\nReturns a UUID following the RFC 9562 standard. If the version is not\nspecified, a UUID version 4 (fully random) is returned.\n\nVersions 4 and 7 are supported.\n\n```\n\n**[var](#7.3.2-var)**(<var-name>[,<default>]) : undefined```\nReturns a variable with the stored type. If the variable is not set, the\nsample fetch fails, unless a default value is provided, in which case it will\nreturn it as a string. Empty strings are permitted. See section 2.8 about\nvariables for details.\n\n```\n\n**[wait_end](#7.3.2-wait_end)**: boolean```\nThis fetch either returns true when the inspection period is over, or does\nnot fetch. It is only used in ACLs, in conjunction with content analysis to\navoid returning a wrong verdict early. It may also be used to delay some\nactions, such as a delayed reject for some special addresses. Since it either\nstops the rules evaluation or immediately returns true, it is recommended to\nuse this acl as the last one in a rule. Please note that the default ACL\n\"WAIT_END\" is always usable without prior declaration. This test was designed\nto be used with TCP request content inspection.\n\n```\n\nExamples :```\n\n# delay every incoming request by 2 seconds\ntcp-request inspect-delay 2s\ntcp-request content accept if WAIT_END\n\n# don't immediately tell bad guys they are rejected\ntcp-request inspect-delay 10s\nacl goodguys src 10.0.0.0/24\nacl badguys  src 10.0.1.0/24\ntcp-request content accept if goodguys\ntcp-request content reject if badguys WAIT_END\ntcp-request content reject\n\n```\n\n**[waiting_entity](#7.3.2-waiting_entity)**: string```\nThis returns the identity of the entity that was waiting to continue its\nprocessing when an error or a timeout was encountered. It may be the a rule\nor a filter for instance. However, this list is not exhaustive and the format\nof all possible entities is not forcefully documented.\n\nWhen the entity is a rule, its location is returned. It is the configuration\nfile containing the rule followed by the line where the rule is defined in\nthis file, separated by a colon.\n\nFor a filter, its identifier is returned as defined by the developers. If\nthis identifier is not defined, an hexadecimal value is returned\ncorresponding to an unique internal identifier.\n\nThe main purpose of this function is to be able to report in logs the entity\nblocking the stream analysis when an error or a timeout was encountered,\ninterrupting this processing, in order to help debugging issues. The\ninformation returned on entities may changed in time and must not be used for\nsomething else than debugging.\n\n```\n\nExample:```\n\n# Log the waiting entity, if any, and only if an error is reported\nlog-format \"$HAPROXY_HTTP_LOG_FMT %{Q}[waiting_entity,when(error)]\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.3.3. Fetching samples at Layer 4", "content": "### [7.3.3.](#7.3.3)Fetching samples at Layer 4\n\n```\nThe layer 4 usually describes just the transport layer which in HAProxy is\nclosest to the connection, where no content is yet made available. The fetch\nmethods described here are usable as low as the \"tcp-request connection\" rule\nsets unless they require some future information. Those generally include\nTCP/IP addresses and ports, as well as elements from stick-tables related to\nthe incoming connection. For retrieving a value from a sticky counters, the\ncounter number can be explicitly set as 0, 1, or 2 using the pre-defined\n\"sc0_\", \"sc1_\", or \"sc2_\" prefix. These three pre-defined prefixes can only be\nused if the global \"tune.stick-counters\" value does not exceed 3, otherwise the\ncounter number can be specified as the first integer argument when using the\n\"sc_\" prefix starting from \"sc_0\" to \"sc_N\" where N is (tune.stick-counters-1).\nAn optional table may be specified with the \"sc*\" form, in which case the\ncurrently tracked key will be looked up into this alternate table instead of\nthe table currently being tracked.\n\nSummary of sample fetch methods in this section and their respective types:\n\n```\n\nkeywordoutput type[accept_date([<unit>])](#7-accept_date)integer[bc.timer.connect](#7-bc.timer.connect)integer[bc_be_queue](#7-bc_be_queue)integer[bc_dst](#7-bc_dst)ip[bc_dst_port](#7-bc_dst_port)integer[bc_err](#7-bc_err)integer[bc_err_name](#7-bc_err_name)string[bc_err_str](#7-bc_err_str)string[bc_glitches](#7-bc_glitches)integer[bc_http_major](#7-bc_http_major)integer[bc_nb_streams](#7-bc_nb_streams)integer[bc_reused](#7-bc_reused)boolean[bc_rtt(<unit>)](#7-bc_rtt)integer[bc_rttvar(<unit>)](#7-bc_rttvar)integer[bc_settings_streams_limit](#7-bc_settings_streams_limit)integer[bc_src](#7-bc_src)ip[bc_src_port](#7-bc_src_port)integer[bc_srv_queue](#7-bc_srv_queue)integer[be_id](#7-be_id)integer[be_name](#7-be_name)stringkeywordoutput type[be_server_timeout](#7-be_server_timeout)integer[be_tunnel_timeout](#7-be_tunnel_timeout)integer[bytes_in](#7-bytes_in)integer[bytes_out](#7-bytes_out)integer[cur_client_timeout](#7-cur_client_timeout)integer[cur_server_timeout](#7-cur_server_timeout)integer[cur_tunnel_timeout](#7-cur_tunnel_timeout)integer[dst](#7-dst)ip[dst_conn](#7-dst_conn)integer[dst_is_local](#7-dst_is_local)boolean[dst_port](#7-dst_port)integer[fc.timer.handshake](#7-fc.timer.handshake)integer[fc.timer.total](#7-fc.timer.total)integer[fc_dst](#7-fc_dst)ip[fc_dst_is_local](#7-fc_dst_is_local)boolean[fc_dst_port](#7-fc_dst_port)integer[fc_err](#7-fc_err)integer[fc_err_name](#7-fc_err_name)string[fc_err_str](#7-fc_err_str)string[fc_fackets](#7-fc_fackets)integerkeywordoutput type[fc_glitches](#7-fc_glitches)integer[fc_http_major](#7-fc_http_major)integer[fc_lost](#7-fc_lost)integer[fc_nb_streams](#7-fc_nb_streams)integer[fc_pp_authority](#7-fc_pp_authority)string[fc_pp_tlv(<id>)](#7-fc_pp_tlv)string[fc_pp_unique_id](#7-fc_pp_unique_id)string[fc_rcvd_proxy](#7-fc_rcvd_proxy)boolean[fc_reordering](#7-fc_reordering)integer[fc_retrans](#7-fc_retrans)integer[fc_rtt(<unit>)](#7-fc_rtt)integer[fc_rttvar(<unit>)](#7-fc_rttvar)integer[fc_sacked](#7-fc_sacked)integer[fc_settings_streams_limit](#7-fc_settings_streams_limit)integer[fc_src](#7-fc_src)ip[fc_src_is_local](#7-fc_src_is_local)boolean[fc_src_port](#7-fc_src_port)integer[fc_unacked](#7-fc_unacked)integer[fe_client_timeout](#7-fe_client_timeout)integer[fe_defbe](#7-fe_defbe)stringkeywordoutput type[fe_id](#7-fe_id)integer[fe_name](#7-fe_name)string[res.timer.data](#7-res.timer.data)integer[sc0_bytes_in_rate([<table>])](#7-sc0_bytes_in_rate)integer[sc0_bytes_out_rate([<table>])](#7-sc0_bytes_out_rate)integer[sc0_clr_gpc0([<table>])](#7-sc0_clr_gpc0)integer[sc0_clr_gpc1([<table>])](#7-sc0_clr_gpc1)integer[sc0_conn_cnt([<table>])](#7-sc0_conn_cnt)integer[sc0_conn_cur([<table>])](#7-sc0_conn_cur)integer[sc0_conn_rate([<table>])](#7-sc0_conn_rate)integer[sc0_get_gpc0([<table>])](#7-sc0_get_gpc0)integer[sc0_get_gpc1([<table>])](#7-sc0_get_gpc1)integer[sc0_get_gpt0([<table>])](#7-sc0_get_gpt0)integer[sc0_glitch_cnt([<table>])](#7-sc0_glitch_cnt)integer[sc0_glitch_rate([<table>])](#7-sc0_glitch_rate)integer[sc0_gpc0_rate([<table>])](#7-sc0_gpc0_rate)integer[sc0_gpc1_rate([<table>])](#7-sc0_gpc1_rate)integer[sc0_http_err_cnt([<table>])](#7-sc0_http_err_cnt)integer[sc0_http_err_rate([<table>])](#7-sc0_http_err_rate)integer[sc0_http_fail_cnt([<table>])](#7-sc0_http_fail_cnt)integerkeywordoutput type[sc0_http_fail_rate([<table>])](#7-sc0_http_fail_rate)integer[sc0_http_req_cnt([<table>])](#7-sc0_http_req_cnt)integer[sc0_http_req_rate([<table>])](#7-sc0_http_req_rate)integer[sc0_inc_gpc0([<table>])](#7-sc0_inc_gpc0)integer[sc0_inc_gpc1([<table>])](#7-sc0_inc_gpc1)integer[sc0_kbytes_in([<table>])](#7-sc0_kbytes_in)integer[sc0_kbytes_out([<table>])](#7-sc0_kbytes_out)integer[sc0_key](#7-sc0_key)any[sc0_sess_cnt([<table>])](#7-sc0_sess_cnt)integer[sc0_sess_rate([<table>])](#7-sc0_sess_rate)integer[sc0_tracked([<table>])](#7-sc0_tracked)boolean[sc0_trackers([<table>])](#7-sc0_trackers)integer[sc1_bytes_in_rate([<table>])](#7-sc1_bytes_in_rate)integer[sc1_bytes_out_rate([<table>])](#7-sc1_bytes_out_rate)integer[sc1_clr_gpc0([<table>])](#7-sc1_clr_gpc0)integer[sc1_clr_gpc1([<table>])](#7-sc1_clr_gpc1)integer[sc1_conn_cnt([<table>])](#7-sc1_conn_cnt)integer[sc1_conn_cur([<table>])](#7-sc1_conn_cur)integer[sc1_conn_rate([<table>])](#7-sc1_conn_rate)integer[sc1_get_gpc0([<table>])](#7-sc1_get_gpc0)integerkeywordoutput type[sc1_get_gpc1([<table>])](#7-sc1_get_gpc1)integer[sc1_get_gpt0([<table>])](#7-sc1_get_gpt0)integer[sc1_glitch_cnt([<table>])](#7-sc1_glitch_cnt)integer[sc1_glitch_rate([<table>])](#7-sc1_glitch_rate)integer[sc1_gpc0_rate([<table>])](#7-sc1_gpc0_rate)integer[sc1_gpc1_rate([<table>])](#7-sc1_gpc1_rate)integer[sc1_http_err_cnt([<table>])](#7-sc1_http_err_cnt)integer[sc1_http_err_rate([<table>])](#7-sc1_http_err_rate)integer[sc1_http_fail_cnt([<table>])](#7-sc1_http_fail_cnt)integer[sc1_http_fail_rate([<table>])](#7-sc1_http_fail_rate)integer[sc1_http_req_cnt([<table>])](#7-sc1_http_req_cnt)integer[sc1_http_req_rate([<table>])](#7-sc1_http_req_rate)integer[sc1_inc_gpc0([<table>])](#7-sc1_inc_gpc0)integer[sc1_inc_gpc1([<table>])](#7-sc1_inc_gpc1)integer[sc1_kbytes_in([<table>])](#7-sc1_kbytes_in)integer[sc1_kbytes_out([<table>])](#7-sc1_kbytes_out)integer[sc1_key](#7-sc1_key)any[sc1_sess_cnt([<table>])](#7-sc1_sess_cnt)integer[sc1_sess_rate([<table>])](#7-sc1_sess_rate)integer[sc1_tracked([<table>])](#7-sc1_tracked)booleankeywordoutput type[sc1_trackers([<table>])](#7-sc1_trackers)integer[sc2_bytes_in_rate([<table>])](#7-sc2_bytes_in_rate)integer[sc2_bytes_out_rate([<table>])](#7-sc2_bytes_out_rate)integer[sc2_clr_gpc0([<table>])](#7-sc2_clr_gpc0)integer[sc2_clr_gpc1([<table>])](#7-sc2_clr_gpc1)integer[sc2_conn_cnt([<table>])](#7-sc2_conn_cnt)integer[sc2_conn_cur([<table>])](#7-sc2_conn_cur)integer[sc2_conn_rate([<table>])](#7-sc2_conn_rate)integer[sc2_get_gpc0([<table>])](#7-sc2_get_gpc0)integer[sc2_get_gpc1([<table>])](#7-sc2_get_gpc1)integer[sc2_get_gpt0([<table>])](#7-sc2_get_gpt0)integer[sc2_glitch_cnt([<table>])](#7-sc2_glitch_cnt)integer[sc2_glitch_rate([<table>])](#7-sc2_glitch_rate)integer[sc2_gpc0_rate([<table>])](#7-sc2_gpc0_rate)integer[sc2_gpc1_rate([<table>])](#7-sc2_gpc1_rate)integer[sc2_http_err_cnt([<table>])](#7-sc2_http_err_cnt)integer[sc2_http_err_rate([<table>])](#7-sc2_http_err_rate)integer[sc2_http_fail_cnt([<table>])](#7-sc2_http_fail_cnt)integer[sc2_http_fail_rate([<table>])](#7-sc2_http_fail_rate)integer[sc2_http_req_cnt([<table>])](#7-sc2_http_req_cnt)integerkeywordoutput type[sc2_http_req_rate([<table>])](#7-sc2_http_req_rate)integer[sc2_inc_gpc0([<table>])](#7-sc2_inc_gpc0)integer[sc2_inc_gpc1([<table>])](#7-sc2_inc_gpc1)integer[sc2_kbytes_in([<table>])](#7-sc2_kbytes_in)integer[sc2_kbytes_out([<table>])](#7-sc2_kbytes_out)integer[sc2_key](#7-sc2_key)any[sc2_sess_cnt([<table>])](#7-sc2_sess_cnt)integer[sc2_sess_rate([<table>])](#7-sc2_sess_rate)integer[sc2_tracked([<table>])](#7-sc2_tracked)boolean[sc2_trackers([<table>])](#7-sc2_trackers)integer[sc_bytes_in_rate(<ctr>[,<table>])](#7-sc_bytes_in_rate)integer[sc_bytes_out_rate(<ctr>[,<table>])](#7-sc_bytes_out_rate)integer[sc_clr_gpc(<idx>,<ctr>[,<table>])](#7-sc_clr_gpc)integer[sc_clr_gpc0(<ctr>[,<table>])](#7-sc_clr_gpc0)integer[sc_clr_gpc1(<ctr>[,<table>])](#7-sc_clr_gpc1)integer[sc_conn_cnt(<ctr>[,<table>])](#7-sc_conn_cnt)integer[sc_conn_cur(<ctr>[,<table>])](#7-sc_conn_cur)integer[sc_conn_rate(<ctr>[,<table>])](#7-sc_conn_rate)integer[sc_get_gpc(<idx>,<ctr>[,<table>])](#7-sc_get_gpc)integer[sc_get_gpc0(<ctr>[,<table>])](#7-sc_get_gpc0)integerkeywordoutput type[sc_get_gpc1(<ctr>[,<table>])](#7-sc_get_gpc1)integer[sc_get_gpt(<idx>,<ctr>[,<table>])](#7-sc_get_gpt)integer[sc_get_gpt0(<ctr>[,<table>])](#7-sc_get_gpt0)integer[sc_glitch_cnt(<ctr>[,<table>])](#7-sc_glitch_cnt)integer[sc_glitch_rate(<ctr>[,<table>])](#7-sc_glitch_rate)integer[sc_gpc0_rate(<ctr>[,<table>])](#7-sc_gpc0_rate)integer[sc_gpc1_rate(<ctr>[,<table>])](#7-sc_gpc1_rate)integer[sc_gpc_rate(<idx>,<ctr>[,<table>])](#7-sc_gpc_rate)integer[sc_http_err_cnt(<ctr>[,<table>])](#7-sc_http_err_cnt)integer[sc_http_err_rate(<ctr>[,<table>])](#7-sc_http_err_rate)integer[sc_http_fail_cnt(<ctr>[,<table>])](#7-sc_http_fail_cnt)integer[sc_http_fail_rate(<ctr>[,<table>])](#7-sc_http_fail_rate)integer[sc_http_req_cnt(<ctr>[,<table>])](#7-sc_http_req_cnt)integer[sc_http_req_rate(<ctr>[,<table>])](#7-sc_http_req_rate)integer[sc_inc_gpc(<idx>,<ctr>[,<table>])](#7-sc_inc_gpc)integer[sc_inc_gpc0(<ctr>[,<table>])](#7-sc_inc_gpc0)integer[sc_inc_gpc1(<ctr>[,<table>])](#7-sc_inc_gpc1)integer[sc_kbytes_in(<ctr>[,<table>])](#7-sc_kbytes_in)integer[sc_kbytes_out(<ctr>[,<table>])](#7-sc_kbytes_out)integer[sc_key(<ctr>)](#7-sc_key)anykeywordoutput type[sc_sess_cnt(<ctr>[,<table>])](#7-sc_sess_cnt)integer[sc_sess_rate(<ctr>[,<table>])](#7-sc_sess_rate)integer[sc_tracked(<ctr>[,<table>])](#7-sc_tracked)boolean[sc_trackers(<ctr>[,<table>])](#7-sc_trackers)integer[so_id](#7-so_id)integer[so_name](#7-so_name)string[src](#7-src)ip[src_bytes_in_rate([<table>])](#7-src_bytes_in_rate)integer[src_bytes_out_rate([<table>])](#7-src_bytes_out_rate)integer[src_clr_gpc(<idx>[,<table>])](#7-src_clr_gpc)integer[src_clr_gpc0([<table>])](#7-src_clr_gpc0)integer[src_clr_gpc1([<table>])](#7-src_clr_gpc1)integer[src_conn_cnt([<table>])](#7-src_conn_cnt)integer[src_conn_cur([<table>])](#7-src_conn_cur)integer[src_conn_rate([<table>])](#7-src_conn_rate)integer[src_get_gpc(<idx>[,<table>])](#7-src_get_gpc)integer[src_get_gpc0([<table>])](#7-src_get_gpc0)integer[src_get_gpc1([<table>])](#7-src_get_gpc1)integer[src_get_gpt(<idx>[,<table>])](#7-src_get_gpt)integer[src_get_gpt0([<table>])](#7-src_get_gpt0)integerkeywordoutput type[src_glitch_cnt([<table>])](#7-src_glitch_cnt)integer[src_glitch_rate([<table>])](#7-src_glitch_rate)integer[src_gpc0_rate([<table>])](#7-src_gpc0_rate)integer[src_gpc1_rate([<table>])](#7-src_gpc1_rate)integer[src_gpc_rate(<idx>[,<table>])](#7-src_gpc_rate)integer[src_http_err_cnt([<table>])](#7-src_http_err_cnt)integer[src_http_err_rate([<table>])](#7-src_http_err_rate)integer[src_http_fail_cnt([<table>])](#7-src_http_fail_cnt)integer[src_http_fail_rate([<table>])](#7-src_http_fail_rate)integer[src_http_req_cnt([<table>])](#7-src_http_req_cnt)integer[src_http_req_rate([<table>])](#7-src_http_req_rate)integer[src_inc_gpc(<idx>[,<table>])](#7-src_inc_gpc)integer[src_inc_gpc0([<table>])](#7-src_inc_gpc0)integer[src_inc_gpc1([<table>])](#7-src_inc_gpc1)integer[src_is_local](#7-src_is_local)boolean[src_kbytes_in([<table>])](#7-src_kbytes_in)integer[src_kbytes_out([<table>])](#7-src_kbytes_out)integer[src_port](#7-src_port)integer[src_sess_cnt([<table>])](#7-src_sess_cnt)integer[src_sess_rate([<table>])](#7-src_sess_rate)integerkeywordoutput type[src_updt_conn_cnt([<table>])](#7-src_updt_conn_cnt)integer[srv_id](#7-srv_id)integer[srv_name](#7-srv_name)string[txn.conn_retries](#7-txn.conn_retries)integer[txn.redispatched](#7-txn.redispatched)boolean```\nDetailed list:\n\n```\n\n**[accept_date](#7.3.3-accept_date)**([<unit>]) : integer```\nThis is the exact date when the connection was received by HAProxy\n(which might be very slightly different from the date observed on the\nnetwork if there was some queuing in the system's backlog). This is usually\nthe same date which may appear in any upstream firewall's log. When used in\nHTTP mode, the accept_date field will be reset to the first moment the\nconnection is ready to receive a new request (end of previous response for\nHTTP/1, immediately after previous request for HTTP/2).\n\nReturns a value in number of seconds since epoch.\n\n<unit> is facultative, and can be set to \"s\" for seconds (default behavior),\n\"ms\" for  milliseconds or \"us\" for microseconds.\nIf unit is set, return value is an integer reflecting either seconds,\nmilliseconds or microseconds since epoch.\nIt is useful when a time resolution of less than a second is needed.\n\n```\n\n**[bc.timer.connect](#7.3.3-bc.timer.connect)**: integer```\nTotal time to establish the TCP connection to the server.  This is the\nequivalent of %Tc in the log-format. This is reported in milliseconds (ms).\nFor more information see Section 8.4 \"Timing events\"\n\n```\n\n**[bc_be_queue](#7.3.3-bc_be_queue)**: integer```\nNumber of streams de-queued while waiting for a connection slot on the\ntarget backend. This is the equivalent of %bq in the log-format.\n\n```\n\n**[bc_dst](#7.3.3-bc_dst)**: ip```\nThis is the destination ip address of the connection on the server side,\nwhich is the server address HAProxy connected to. It is of type IP and works\non both IPv4 and IPv6 tables.  On IPv6 tables, IPv4 address is mapped to its\nIPv6 equivalent, according to RFC 4291.\n\n```\n\n**[bc_dst_port](#7.3.3-bc_dst_port)**: integer```\nReturns an integer value corresponding to the destination TCP port of the\nconnection on the server side, which is the port HAProxy connected to.\n\n```\n\n**[bc_err](#7.3.3-bc_err)**: integer```\nReturns the ID of the error that might have occurred on the current backend\nconnection. See the \"fc_err_str\" fetch for a full list of error codes\nand their corresponding error message.\n\n```\n\n**[bc_err_name](#7.3.3-bc_err_name)**: string```\nReturns the internal error name describing what problem happened on the\nbackend connection, resulting in a connection failure. This string is made of\na single word and is empty when no error is present. It corresponds to the\n\"name\" column in the table presented in the \"fc_err_str\" keyword.\n\n```\n\n**[bc_err_str](#7.3.3-bc_err_str)**: string```\nReturns an error message describing what problem happened on the current\nbackend connection, resulting in a connection failure. See the\n\"fc_err_str\" fetch for a full list of error codes and their\ncorresponding error message.\n\n```\n\n**[bc_glitches](#7.3.3-bc_glitches)**: integer```\nReturns the number of protocol glitches counted on the backend connection.\nThese generally cover protocol violations as well as small anomalies that\ngenerally indicate a bogus or misbehaving server that may cause trouble in\nthe infrastructure (e.g. cause connections to be aborted early, inducing\nfrequent TLS renegotiations). These may also be caused by too large responses\nthat cannot fit into a single buffer, explaining HTTP 502 errors. Ideally\nthis number should remain zero, though it's generally fine if it remains very\nlow compared to the total number of requests. These values should normally\nnot be considered as alarming (especially small ones), though a sudden jump\nmay indicate an anomaly somewhere. Not all protocol multiplexers measure this\nmetric and the only way to get more details about the events is to enable\ntraces to capture all exchanges.\n\n```\n\n**[bc_http_major](#7.3.3-bc_http_major)**: integer```\nReturns the backend connection's HTTP major version encoding, which may be 1\nfor HTTP/0.9 to HTTP/1.1 or 2 for HTTP/2. Note, this is based on the on-wire\nencoding and not the version present in the request header.\n\n```\n\n**[bc_nb_streams](#7.3.3-bc_nb_streams)**: integer```\nReturns the number of streams opened on the backend connection.\n\n```\n\n**[bc_reused](#7.3.3-bc_reused)**: boolean```\nReturns true if the transfer was performed via a reused backend connection.\n\n```\n\n**[bc_rtt](#7.3.3-bc_rtt)**(<unit>) : integer```\nReturns the Round Trip Time (RTT) measured by the kernel for the backend\nconnection. <unit> is facultative, by default the unit is milliseconds. <unit>\ncan be set to \"ms\" for milliseconds or \"us\" for microseconds. If the server\nconnection is not established, if the connection is not TCP or if the\noperating system does not support TCP_INFO, for example Linux kernels before\n2.4, the sample fetch fails.\n\n```\n\n**[bc_rttvar](#7.3.3-bc_rttvar)**(<unit>) : integer```\nReturns the Round Trip Time (RTT) variance measured by the kernel for the\nbackend connection. <unit> is facultative, by default the unit is milliseconds.\n<unit> can be set to \"ms\" for milliseconds or \"us\" for microseconds. If the\nserver connection is not established, if the connection is not TCP or if the\noperating system does not support TCP_INFO, for example Linux kernels before\n2.4, the sample fetch fails.\n\n```\n\n**[bc_settings_streams_limit](#7.3.3-bc_settings_streams_limit)**: integer```\nReturns the maximum number of streams allowed on the backend connection. For\nTCP and HTTP/1.1 connections, it is always 1. For other protocols, it depends\non the settings negotiated with the server.\n\n```\n\n**[bc_src](#7.3.3-bc_src)**: ip```\nThis is the source ip address of the connection on the server side, which is\nthe server address HAProxy connected from. It is of type IP and works on both\nIPv4 and IPv6 tables. On IPv6 tables, IPv4 addresses are mapped to their IPv6\nequivalent, according to RFC 4291.\n\n```\n\n**[bc_src_port](#7.3.3-bc_src_port)**: integer```\nReturns an integer value corresponding to the TCP source port of the\nconnection on the server side, which is the port HAProxy connected from.\n\n```\n\n**[bc_srv_queue](#7.3.3-bc_srv_queue)**: integer```\nNumber of streams de-queued while waiting for a connection slot on the\ntarget server. This is the equivalent of %sq in the log-format.\n\n```\n\n**[be_id](#7.3.3-be_id)**: integer```\nReturns an integer containing the current backend's id. It can be used in\nfrontends with responses to check which backend processed the request. If\nused in a frontend and no backend was used, it returns the current\nfrontend's id. It can also be used in a tcp-check or an http-check ruleset.\n\n```\n\n**[be_name](#7.3.3-be_name)**: string```\nReturns a string containing the current backend's name. It can be used in\nfrontends with responses to check which backend processed the request. If\nused in a frontend and no backend was used, it returns the current\nfrontend's name. It can also be used in a tcp-check or an http-check\nruleset.\n\n```\n\n**[be_server_timeout](#7.3.3-be_server_timeout)**: integer```\nReturns the configuration value in millisecond for the server timeout of the\ncurrent backend. This timeout can be overwritten by a \"set-timeout\" rule. See\nalso the \"cur_server_timeout\".\n\n```\n\n**[be_tunnel_timeout](#7.3.3-be_tunnel_timeout)**: integer```\nReturns the configuration value in millisecond for the tunnel timeout of the\ncurrent backend. This timeout can be overwritten by a \"set-timeout\" rule. See\nalso the \"cur_tunnel_timeout\".\n\n```\n\n**[bytes_in](#7.3.3-bytes_in)**: integer```\nThis returns the number of bytes uploaded from the client to the server. The\nvalue corresponds to what was received by HAProxy, including some headers and\nsome internal encoding overhead. Request compression does not affect the\nvalue reported here.\n\n```\n\n**[bytes_out](#7.3.3-bytes_out)**: integer```\nThis is the number of bytes transmitted from the server to the client. The\nvalue corresponds to what was received by HAProxy, including some headers and\nsome internal encoding overhead. Response compression does not affect the\nvalue reported here.\n\n```\n\n**[cur_client_timeout](#7.3.3-cur_client_timeout)**: integer```\nReturns the currently applied client timeout in millisecond for the stream.\nIn the default case, this will be equal to fe_client_timeout unless a\n\"set-timeout\" rule has been applied. See also \"fe_client_timeout\".\n\n```\n\n**[cur_server_timeout](#7.3.3-cur_server_timeout)**: integer```\nReturns the currently applied server timeout in millisecond for the stream.\nIn the default case, this will be equal to be_server_timeout unless a\n\"set-timeout\" rule has been applied. See also \"be_server_timeout\".\n\n```\n\n**[cur_tunnel_timeout](#7.3.3-cur_tunnel_timeout)**: integer```\nReturns the currently applied tunnel timeout in millisecond for the stream.\nIn the default case, this will be equal to be_tunnel_timeout unless a\n\"set-timeout\" rule has been applied. See also \"be_tunnel_timeout\".\n\n```\n\n**[dst](#7.3.3-dst)**: ip```\nThis is the destination IP address of the connection on the client side,\nwhich is the address the client connected to. Any tcp/http rules may alter\nthis address. It can be useful when running in transparent mode. It is of\ntype IP and works on both IPv4 and IPv6 tables.  On IPv6 tables, IPv4 address\nis mapped to its IPv6 equivalent, according to RFC 4291. When the incoming\nconnection passed through address translation or redirection involving\nconnection tracking, the original destination address before the redirection\nwill be reported. On Linux systems, the source and destination may seldom\nappear reversed if the nf_conntrack_tcp_loose sysctl is set, because a late\nresponse may reopen a timed out connection and switch what is believed to be\nthe source and the destination.\n\n```\n\n**[dst_conn](#7.3.3-dst_conn)**: integer```\nReturns an integer value corresponding to the number of currently established\nconnections on the same socket including the one being evaluated. It is\nnormally used with ACLs but can as well be used to pass the information to\nservers in an HTTP header or in logs. It can be used to either return a sorry\npage before hard-blocking, or to use a specific backend to drain new requests\nwhen the socket is considered saturated. This offers the ability to assign\ndifferent limits to different listening ports or addresses. See also the\n\"fe_conn\" and \"be_conn\" fetches.\n\n```\n\n**[dst_is_local](#7.3.3-dst_is_local)**: boolean```\nReturns true if the destination address of the incoming connection is local\nto the system, or false if the address doesn't exist on the system, meaning\nthat it was intercepted in transparent mode. It can be useful to apply\ncertain rules by default to forwarded traffic and other rules to the traffic\ntargeting the real address of the machine. For example the stats page could\nbe delivered only on this address, or SSH access could be locally redirected.\nPlease note that the check involves a few system calls, so it's better to do\nit only once per connection.\n\n```\n\n**[dst_port](#7.3.3-dst_port)**: integer```\nReturns an integer value corresponding to the destination TCP port of the\nconnection on the client side, which is the port the client connected to.\nAny tcp/http rules may alter this address. This might be used when running in\ntransparent mode, when assigning dynamic ports to some clients for a whole\napplication session, to stick all users to a same server, or to pass the\ndestination port information to a server using an HTTP header.\n\n```\n\n**[fc.timer.handshake](#7.3.3-fc.timer.handshake)**: integer```\nTotal time to accept tcp connection and execute handshakes for low level\nprotocols. Currently, these protocols are proxy-protocol and SSL. This is the\nequivalent of %Th in the log-format.  This is reported in milliseconds (ms).\nFor more information see Section 8.4 \"Timing events\"\n\n```\n\n**[fc.timer.total](#7.3.3-fc.timer.total)**: integer```\nTotal stream duration time, between the moment the proxy accepted it and the\nmoment both ends were closed. This is the equivalent of %Tt in the log-format.\nThis is reported in milliseconds (ms). For more information see Section 8.4\n\"Timing events\"\n\n```\n\n**[fc_dst](#7.3.3-fc_dst)**: ip```\nThis is the original destination IP address of the connection on the client\nside. Only \"tcp-request connection\" rules may alter this address. See \"dst\"\nfor details.\n\n```\n\n**[fc_dst_is_local](#7.3.3-fc_dst_is_local)**: boolean```\nReturns true if the original destination address of the incoming connection\nis local to the system, or false if the address doesn't exist on the\nsystem. See \"dst_is_local\" for details.\n\n```\n\n**[fc_dst_port](#7.3.3-fc_dst_port)**: integer```\nReturns an integer value corresponding to the original destination TCP port\nof the connection on the client side. Only \"tcp-request connection\" rules may\nalter this address. See \"dst-port\" for details.\n\n```\n\n**[fc_err](#7.3.3-fc_err)**: integer```\nReturns the ID of the error that might have occurred on the current\nconnection. Any strictly positive value of this fetch indicates that the\nconnection did not succeed and would result in an error log being output (as\ndescribed in section 8.2.5). See the \"fc_err_str\" fetch for a full list of\nerror codes and their corresponding error message.\n\n```\n\n**[fc_err_name](#7.3.3-fc_err_name)**: string```\nReturns the internal error name describing what problem happened on the\nfrontend connection, resulting in a connection failure. This string is made\nof a single word and is empty when no error is present. It corresponds to the\n\"name\" column in the table presented in the \"fc_err_str\" keyword.\n\n```\n\n**[fc_err_str](#7.3.3-fc_err_str)**: string```\nReturns an error message describing what problem happened on the current\nconnection, resulting in a connection failure. This string corresponds to the\n\"message\" part of the error log format (see section 8.2.5). See below for a\nfull list of error codes and their corresponding error messages :\n\n+----+------------------+-------------------------------------------------------------------------+\n| ID | name             | message                                                                 |\n+----+------------------+-------------------------------------------------------------------------+\n| 0  | -                | \"Success\"                                                               |\n| 1  | CONF_FDLIM       | \"Reached configured maxconn value\"                                      |\n| 2  | PROC_FDLIM       | \"Too many sockets on the process\"                                       |\n| 3  | SYS_FDLIM        | \"Too many sockets on the system\"                                        |\n| 4  | SYS_MEMLIM       | \"Out of system buffers\"                                                 |\n| 5  | NOPROTO          | \"Protocol or address family not supported\"                              |\n| 6  | SOCK_ERR         | \"General socket error\"                                                  |\n| 7  | PORT_RANGE       | \"Source port range exhausted\"                                           |\n| 8  | CANT_BIND        | \"Can't bind to source address\"                                          |\n| 9  | FREE_PORTS       | \"Out of local source ports on the system\"                               |\n| 10 | ADDR_INUSE       | \"Local source address already in use\"                                   |\n| 11 | PRX_EMPTY        | \"Connection closed while waiting for PROXY protocol header\"             |\n| 12 | PRX_ABORT        | \"Connection error while waiting for PROXY protocol header\"              |\n| 13 | PRX_TIMEOUT      | \"Timeout while waiting for PROXY protocol header\"                       |\n| 14 | PRX_TRUNCATED    | \"Truncated PROXY protocol header received\"                              |\n| 15 | PRX_NOT_HDR      | \"Received something which does not look like a PROXY protocol header\"   |\n| 16 | PRX_BAD_HDR      | \"Received an invalid PROXY protocol header\"                             |\n| 17 | PRX_BAD_PROTO    | \"Received an unhandled protocol in the PROXY protocol header\"           |\n| 18 | CIP_EMPTY        | \"Connection closed while waiting for NetScaler Client IP header\"        |\n| 19 | CIP_ABORT        | \"Connection error while waiting for NetScaler Client IP header\"         |\n| 20 | CIP_TIMEOUT      | \"Timeout while waiting for a NetScaler Client IP header\"                |\n| 21 | CIP_TRUNCATED    | \"Truncated NetScaler Client IP header received\"                         |\n| 22 | CIP_BAD_MAGIC    | \"Received an invalid NetScaler Client IP magic number\"                  |\n| 23 | CIP_BAD_PROTO    | \"Received an unhandled protocol in the NetScaler Client IP header\"      |\n| 24 | SSL_EMPTY        | \"Connection closed during SSL handshake\"                                |\n| 25 | SSL_ABORT        | \"Connection error during SSL handshake\"                                 |\n| 26 | SSL_TIMEOUT      | \"Timeout during SSL handshake\"                                          |\n| 27 | SSL_TOO_MANY     | \"Too many SSL connections\"                                              |\n| 28 | SSL_NO_MEM       | \"Out of memory when initializing an SSL connection\"                     |\n| 29 | SSL_RENEG        | \"Rejected a client-initiated SSL renegotiation attempt\"                 |\n| 30 | SSL_CA_FAIL      | \"SSL client CA chain cannot be verified\"                                |\n| 31 | SSL_CRT_FAIL     | \"SSL client certificate not trusted\"                                    |\n| 32 | SSL_MISMATCH     | \"Server presented an SSL certificate different from the configured one\" |\n| 33 | SSL_MISMATCH_SNI | \"Server presented an SSL certificate different from the expected one\"   |\n| 34 | SSL_HANDSHAKE    | \"SSL handshake failure\"                                                 |\n| 35 | SSL_HANDSHAKE_HB | \"SSL handshake failure after heartbeat\"                                 |\n| 36 | SSL_KILLED_HB    | \"Stopped a TLSv1 heartbeat attack (CVE-2014-0160)\"                      |\n| 37 | SSL_NO_TARGET    | \"Attempt to use SSL on an unknown target (internal error)\"              |\n| 38 | SSL_EARLY_FAILED | \"Server refused early data\"                                             |\n| 39 | SOCKS4_SEND      | \"SOCKS4 Proxy write error during handshake\"                             |\n| 40 | SOCKS4_RECV      | \"SOCKS4 Proxy read error during handshake\"                              |\n| 41 | SOCKS4_DENY      | \"SOCKS4 Proxy deny the request\"                                         |\n| 42 | SOCKS4_ABORT     | \"SOCKS4 Proxy handshake aborted by server\"                              |\n| 43 | SSL_FATAL        | \"SSL fatal error\"                                                       |\n| 44 | REVERSE          | \"Reverse connect failure\"                                               |\n| 45 | POLLERR          | \"Poller reported POLLERR\"                                               |\n| 46 | EREFUSED         | \"ECONNREFUSED returned by OS\"                                           |\n| 47 | ERESET           | \"ECONNRESET returned by OS\"                                             |\n| 48 | EUNREACH         | \"ENETUNREACH returned by OS\"                                            |\n| 49 | ENOMEM           | \"ENOMEM returned by OS\"                                                 |\n| 50 | EBADF            | \"EBADF returned by OS\"                                                  |\n| 51 | EFAULT           | \"EFAULT returned by OS\"                                                 |\n| 52 | EINVAL           | \"EINVAL returned by OS\"                                                 |\n| 53 | ENCONN           | \"ENCONN returned by OS\"                                                 |\n| 54 | ENSOCK           | \"ENSOCK returned by OS\"                                                 |\n| 55 | ENOBUFS          | \"ENOBUFS returned by OS\"                                                |\n| 56 | EPIPE            | \"EPIPE returned by OS\"                                                  |\n+----+------------------+-------------------------------------------------------------------------+\n\n```\n\n**[fc_fackets](#7.3.3-fc_fackets)**: integer```\nReturns the fack counter measured by the kernel for the client\nconnection. If the server connection is not established, if the connection is\nnot TCP or if the operating system does not support TCP_INFO, for example\nLinux kernels before 2.4, the sample fetch fails.\n\n```\n\n**[fc_glitches](#7.3.3-fc_glitches)**: integer```\nReturns the number of protocol glitches counted on the frontend connection.\nThese generally cover protocol violations as well as small anomalies that\ngenerally indicate a bogus or misbehaving client that may cause trouble in\nthe infrastructure, such as excess of errors in the logs, or many connections\nbeing aborted early, inducing frequent TLS renegotiations. These may also be\ncaused by too large requests that cannot fit into a single buffer, explaining\nHTTP 400 errors. Ideally this number should remain zero, though it may be\npossible that some browsers playing with the protocol boundaries trigger it\nonce in a while. These values should normally not be considered as alarming\n(especially small ones), though a sudden jump may indicate an anomaly\nsomewhere. Large values (i.e. hundreds to thousands per connection, or as\nmany as the requests) may indicate a purposely built client that is trying to\nfingerprint or attack the protocol stack. Not all protocol multiplexers\nmeasure this metric, and the only way to get more details about the events is\nto enable traces to capture all exchanges.\n\n```\n\n**[fc_http_major](#7.3.3-fc_http_major)**: integer```\nReports the front connection's HTTP major version encoding, which may be 1\nfor HTTP/0.9 to HTTP/1.1 or 2 for HTTP/2. Note, this is based on the on-wire\nencoding and not on the version present in the request header.\n\n```\n\n**[fc_lost](#7.3.3-fc_lost)**: integer```\nIf the connection is not TCP, nor QUIC, the sample fetch fails.\nFor QUIC, returns the number of lost QUIC packets by the client connection.\nFor TCP, returns the lost counter measured by the kernel for the client\nconnection. If the server connection is not established, or if the operating\nsystem does not support TCP_INFO, for example Linux kernels before 2.4, the\nsample fetch fails.\n\n```\n\n**[fc_nb_streams](#7.3.3-fc_nb_streams)**: integer```\nReturns the number of streams opened on the frontend connection.\n\n```\n\n**[fc_pp_authority](#7.3.3-fc_pp_authority)**: string```\nReturns the first authority TLV sent by the client in the PROXY protocol\nheader, if any.\n\n```\n\n**[fc_pp_tlv](#7.3.3-fc_pp_tlv)**(<id>) : string```\nReturns the TLV value for the given TLV ID. The ID must either be a numeric\nvalue between 0 and 255 or one of the following supported symbolic names\nthat correspond to the TLV constant suffixes in the PPv2 spec:\n\"ALPN\": PP2_TYPE_ALPN, \"AUTHORITY\": PP2_TYPE_AUTHORITY,\n\"CRC32\": PP2_TYPE_CRC32C, \"NETNS\": PP2_TYPE_NETNS, \"NOOP: PP2_TYPE_NOOP\",\n\"SSL\": PP2_TYPE_SSL, \"SSL_CIPHER\": PP2_SUBTYPE_SSL_CIPHER,\n\"SSL_CN\": PP2_SUBTYPE_SSL_CN, \"SSL_KEY_ALG\": PP2_SUBTYPE_SSL_KEY_ALG,\n\"SSL_SIG_ALG\": PP2_SUBTYPE_SSL_SIG_ALG,\n\"SSL_VERSION\": PP2_SUBTYPE_SSL_VERSION, \"UNIQUE_ID\": PP2_TYPE_UNIQUE_ID.\n\nThe received value must be smaller or equal to 1024 bytes. This is done to\nprevent potential DoS attacks. Values smaller or equal to 256 bytes will be\nable to be memory pooled. Therefore, try to restrict the length of sent\nvalues to 256 bytes for optimal performance.\n\nNote that unlike fc_pp_authority and fc_pp_unique_id, fc_pp_tlv is able to\niterate over all occurrences of a requested TLV in case there are duplicate\nTLV IDs. The order of iteration matches the position in the PROXY protocol\nheader. However, relying on duplicates should mostly be avoided as TLVs are\ntypically assumed to be unique. Generally, finding duplicated TLV IDs\nindicates an error on the sender side of the PROXY protocol header.\n\n```\n\n**[fc_pp_unique_id](#7.3.3-fc_pp_unique_id)**: string```\nReturns the first unique ID TLV sent by the client in the PROXY protocol\nheader, if any.\n\n```\n\n**[fc_rcvd_proxy](#7.3.3-fc_rcvd_proxy)**: boolean```\nReturns true if the client initiated the connection with a PROXY protocol\nheader.\n\n```\n\n**[fc_reordering](#7.3.3-fc_reordering)**: integer```\nIf the connection is not TCP, nor QUIC, the sample fetch fails.\nFor QUIC, return the number of QUIC reordered packets for the client connection.\nFor TCP, returns the reordering counter measured by the kernel for the client\nconnection. If the server connection is not established, or if the operating\nsystem does not support TCP_INFO, for example Linux kernels before 2.4, the\nsample fetch fails.\n\n```\n\n**[fc_retrans](#7.3.3-fc_retrans)**: integer```\nReturns the retransmits counter measured by the kernel for the client\nconnection. If the server connection is not established, if the connection is\nnot TCP or if the operating system does not support TCP_INFO, for example\nLinux kernels before 2.4, the sample fetch fails.\n\n```\n\n**[fc_rtt](#7.3.3-fc_rtt)**(<unit>) : integer```\nIf the connection is not TCP, nor QUIC, the sample fetch fails.\nFor QUIC, returns Smoothed Round Trip Time for the client connection.\nFor TCP, returns the Round Trip Time (RTT) measured by the kernel for the client\nconnection. <unit> is facultative, by default the unit is milliseconds. <unit>\ncan be set to \"ms\" for milliseconds or \"us\" for microseconds. If the server\nconnection is not established, or if the operating system does not support\nTCP_INFO, for example Linux kernels before 2.4, the sample fetch fails.\n\n```\n\n**[fc_rttvar](#7.3.3-fc_rttvar)**(<unit>) : integer```\nIf the connection is not TCP, nor QUIC, the sample fetch fails.\nFor QUIC, returns Smoothed Round Trip Time variance for the client connection.\nFor TCP, returns the Round Trip Time (RTT) variance measured by the kernel for\nthe client connection. <unit> is facultative, by default the unit is milliseconds.\n<unit> can be set to \"ms\" for milliseconds or \"us\" for microseconds. If the\nserver connection is not established, or if the operating system does not\nsupport TCP_INFO, for example Linux kernels before 2.4, the sample fetch fails.\n\n```\n\n**[fc_sacked](#7.3.3-fc_sacked)**: integer```\nReturns the sacked counter measured by the kernel for the client connection.\nIf the server connection is not established, if the connection is not TCP or\nif the operating system does not support TCP_INFO, for example Linux kernels\nbefore 2.4, the sample fetch fails.\n\n```\n\n**[fc_settings_streams_limit](#7.3.3-fc_settings_streams_limit)**: integer```\nReturns the maximum number of streams allowed on the frontend connection. For\nTCP and HTTP/1.1 connections, it is always 1. For other protocols, it depends\non the settings negotiated with the client.\n\n```\n\n**[fc_src](#7.3.3-fc_src)**: ip```\nThis is the original source IP address of the connection on the client side\nOnly \"tcp-request connection\" rules may alter this address. See \"src\" for\ndetails.\n\n```\n\n**[fc_src_is_local](#7.3.3-fc_src_is_local)**: boolean```\nReturns true if the source address of incoming connection is local to the\nsystem, or false if the address doesn't exist on the system. See\n\"src_is_local\" for details.\n\n```\n\n**[fc_src_port](#7.3.3-fc_src_port)**: integer```\nReturns an integer value corresponding to the TCP source port of the\nconnection on the client side. Only \"tcp-request connection\" rules may alter\nthis address. See \"src-port\" for details.\n\n```\n\n**[fc_unacked](#7.3.3-fc_unacked)**: integer```\nReturns the unacked counter measured by the kernel for the client connection.\nIf the server connection is not established, if the connection is not TCP or\nif the operating system does not support TCP_INFO, for example Linux kernels\nbefore 2.4, the sample fetch fails.\n\n```\n\n**[fe_client_timeout](#7.3.3-fe_client_timeout)**: integer```\nReturns the configuration value in millisecond for the client timeout of the\ncurrent frontend. This timeout can be overwritten by a \"set-timeout\" rule.\n\n```\n\n**[fe_defbe](#7.3.3-fe_defbe)**: string```\nReturns a string containing the frontend's default backend name. It can be\nused in frontends to check which backend will handle requests by default.\n\n```\n\n**[fe_id](#7.3.3-fe_id)**: integer```\nReturns an integer containing the current frontend's id. It can be used in\nbackends to check from which frontend it was called, or to stick all users\ncoming via a same frontend to the same server.\n\n```\n\n**[fe_name](#7.3.3-fe_name)**: string```\nReturns a string containing the current frontend's name. It can be used in\nbackends to check from which frontend it was called, or to stick all users\ncoming via a same frontend to the same server.\n\n```\n\n**[res.timer.data](#7.3.3-res.timer.data)**: integer```\nthis is the total transfer time of the response payload till the last byte\nsent to the client. In HTTP it starts after the last response header (after\nTr). This is the equivalent of %Td in the log-format and is reported in\nmilliseconds (ms).  For more information see Section 8.4 \"Timing events\"\n\n```\n\n**[sc_bytes_in_rate](#7.3.3-sc_bytes_in_rate)**(<ctr>[,<table>]) : integer**[sc0_bytes_in_rate](#7.3.3-sc0_bytes_in_rate)**([<table>]) : integer**[sc1_bytes_in_rate](#7.3.3-sc1_bytes_in_rate)**([<table>]) : integer**[sc2_bytes_in_rate](#7.3.3-sc2_bytes_in_rate)**([<table>]) : integer```\nReturns the average client-to-server bytes rate from the currently tracked\ncounters, measured in amount of bytes over the period configured in the\ntable. See also \"table_bytes_in_rate\".\n\n```\n\n**[sc_bytes_out_rate](#7.3.3-sc_bytes_out_rate)**(<ctr>[,<table>]) : integer**[sc0_bytes_out_rate](#7.3.3-sc0_bytes_out_rate)**([<table>]) : integer**[sc1_bytes_out_rate](#7.3.3-sc1_bytes_out_rate)**([<table>]) : integer**[sc2_bytes_out_rate](#7.3.3-sc2_bytes_out_rate)**([<table>]) : integer```\nReturns the average server-to-client bytes rate from the currently tracked\ncounters, measured in amount of bytes over the period configured in the\ntable. See also \"table_bytes_out_rate\".\n\n```\n\n**[sc_clr_gpc](#7.3.3-sc_clr_gpc)**(<idx>,<ctr>[,<table>]) : integer```\nClears the General Purpose Counter at the index <idx> of the array\nassociated to the designated tracked counter of ID <ctr> from current\nproxy's stick table or from the designated stick-table <table>, and\nreturns its previous value. <idx> is an integer between 0 and 99 and\n<ctr> an integer between 0 and 2.\nBefore the first invocation, the stored value is zero, so first invocation\nwill always return zero.\nThis fetch applies only to the 'gpc' array data_type (and not to the legacy\n'gpc0' nor 'gpc1' data_types).\n\n```\n\n**[sc_clr_gpc0](#7.3.3-sc_clr_gpc0)**(<ctr>[,<table>]) : integer**[sc0_clr_gpc0](#7.3.3-sc0_clr_gpc0)**([<table>]) : integer**[sc1_clr_gpc0](#7.3.3-sc1_clr_gpc0)**([<table>]) : integer**[sc2_clr_gpc0](#7.3.3-sc2_clr_gpc0)**([<table>]) : integer```\nClears the first General Purpose Counter associated to the currently tracked\ncounters, and returns its previous value. Before the first invocation, the\nstored value is zero, so first invocation will always return zero. This is\ntypically used as a second ACL in an expression in order to mark a connection\nwhen a first ACL was verified :\n\n```\n\nExample:```\n\n# block if 5 consecutive requests continue to come faster than 10 sess\n# per second, and reset the counter as soon as the traffic slows down.\nacl abuse sc0_http_req_rate gt 10\nacl kill  sc0_inc_gpc0 gt 5\nacl save  sc0_clr_gpc0 ge 0\ntcp-request connection accept if !abuse save\ntcp-request connection reject if abuse kill\n\n```\n\n**[sc_clr_gpc1](#7.3.3-sc_clr_gpc1)**(<ctr>[,<table>]) : integer**[sc0_clr_gpc1](#7.3.3-sc0_clr_gpc1)**([<table>]) : integer**[sc1_clr_gpc1](#7.3.3-sc1_clr_gpc1)**([<table>]) : integer**[sc2_clr_gpc1](#7.3.3-sc2_clr_gpc1)**([<table>]) : integer```\nClears the second General Purpose Counter associated to the currently tracked\ncounters, and returns its previous value. Before the first invocation, the\nstored value is zero, so first invocation will always return zero. This is\ntypically used as a second ACL in an expression in order to mark a connection\nwhen a first ACL was verified.\n\n```\n\n**[sc_conn_cnt](#7.3.3-sc_conn_cnt)**(<ctr>[,<table>]) : integer**[sc0_conn_cnt](#7.3.3-sc0_conn_cnt)**([<table>]) : integer**[sc1_conn_cnt](#7.3.3-sc1_conn_cnt)**([<table>]) : integer**[sc2_conn_cnt](#7.3.3-sc2_conn_cnt)**([<table>]) : integer```\nReturns the cumulative number of incoming connections from currently tracked\ncounters. See also \"table_conn_cnt\".\n\n```\n\n**[sc_conn_cur](#7.3.3-sc_conn_cur)**(<ctr>[,<table>]) : integer**[sc0_conn_cur](#7.3.3-sc0_conn_cur)**([<table>]) : integer**[sc1_conn_cur](#7.3.3-sc1_conn_cur)**([<table>]) : integer**[sc2_conn_cur](#7.3.3-sc2_conn_cur)**([<table>]) : integer```\nReturns the current amount of concurrent connections tracking the same\ntracked counters. This number is automatically incremented when tracking\nbegins and decremented when tracking stops. See also \"table_conn_cur\".\n\n```\n\n**[sc_conn_rate](#7.3.3-sc_conn_rate)**(<ctr>[,<table>]) : integer**[sc0_conn_rate](#7.3.3-sc0_conn_rate)**([<table>]) : integer**[sc1_conn_rate](#7.3.3-sc1_conn_rate)**([<table>]) : integer**[sc2_conn_rate](#7.3.3-sc2_conn_rate)**([<table>]) : integer```\nReturns the average connection rate from the currently tracked counters,\nmeasured in amount of connections over the period configured in the table.\nSee also \"table_conn_rate\".\n\n```\n\n**[sc_get_gpc](#7.3.3-sc_get_gpc)**(<idx>,<ctr>[,<table>]) : integer```\nReturns the value of the General Purpose Counter at the index <idx>\nin the GPC array and associated to the currently tracked counter of\nID <ctr> from the current proxy's stick-table or from the designated\nstick-table <table>. <idx> is an integer between 0 and 99 and\n<ctr> an integer between 0 and 2. If there is not gpc stored at this\nindex, zero is returned.\nThis fetch applies only to the 'gpc' array data_type (and not to the legacy\n'gpc0' nor 'gpc1' data_types). See also \"table_gpc\" and \"sc_inc_gpc\".\n\n```\n\n**[sc_get_gpc0](#7.3.3-sc_get_gpc0)**(<ctr>[,<table>]) : integer**[sc0_get_gpc0](#7.3.3-sc0_get_gpc0)**([<table>]) : integer**[sc1_get_gpc0](#7.3.3-sc1_get_gpc0)**([<table>]) : integer**[sc2_get_gpc0](#7.3.3-sc2_get_gpc0)**([<table>]) : integer```\nReturns the value of the first General Purpose Counter associated to the\ncurrently tracked counters. See also \"table_gpc0\" and sc/sc0/sc1/sc2_inc_gpc0.\n\n```\n\n**[sc_get_gpc1](#7.3.3-sc_get_gpc1)**(<ctr>[,<table>]) : integer**[sc0_get_gpc1](#7.3.3-sc0_get_gpc1)**([<table>]) : integer**[sc1_get_gpc1](#7.3.3-sc1_get_gpc1)**([<table>]) : integer**[sc2_get_gpc1](#7.3.3-sc2_get_gpc1)**([<table>]) : integer```\nReturns the value of the second General Purpose Counter associated to the\ncurrently tracked counters. See also \"table_gpc1\" and sc/sc0/sc1/sc2_inc_gpc1.\n\n```\n\n**[sc_get_gpt](#7.3.3-sc_get_gpt)**(<idx>,<ctr>[,<table>]) : integer```\nReturns the value of the first General Purpose Tag at the index <idx> of\nthe array associated to the tracked counter of ID <ctr> and from the\ncurrent proxy's sitck-table or the designated stick-table <table>. <idx>\nis an integer between 0 and 99 and <ctr> an integer between 0 and 2.\nIf there is no GPT stored at this index, zero is returned.\nThis fetch applies only to the 'gpt' array data_type (and not on\nthe legacy 'gpt0' data-type). See also \"table_gpt\".\n\n```\n\n**[sc_get_gpt0](#7.3.3-sc_get_gpt0)**(<ctr>[,<table>]) : integer**[sc0_get_gpt0](#7.3.3-sc0_get_gpt0)**([<table>]) : integer**[sc1_get_gpt0](#7.3.3-sc1_get_gpt0)**([<table>]) : integer**[sc2_get_gpt0](#7.3.3-sc2_get_gpt0)**([<table>]) : integer```\nReturns the value of the first General Purpose Tag associated to the\ncurrently tracked counters. See also \"table_gpt0\".\n\n```\n\n**[sc_glitch_cnt](#7.3.3-sc_glitch_cnt)**(<ctr>[,<table>]) : integer**[sc0_glitch_cnt](#7.3.3-sc0_glitch_cnt)**([<table>]) : integer**[sc1_glitch_cnt](#7.3.3-sc1_glitch_cnt)**([<table>]) : integer**[sc2_glitch_cnt](#7.3.3-sc2_glitch_cnt)**([<table>]) : integer```\nReturns the cumulative number of front connection glitches that were observed\non connections associated with the currently tracked counters. Usually these\nresult in requests or connections to be aborted so the returned value will\noften correspond to past connections. There is no good nor bad value, but a\npoor quality client may occasionally cause a few glitches per connection,\nwhile a very bogus or malevolent client may quickly cause thousands of events\nto be added on a connection. See also fc_glitches for the number affecting\nthe current connection, src_glitch_cnt to look them up per source, and\nsc_glitch_rate for the event rate measurements.\n\n```\n\n**[sc_glitch_rate](#7.3.3-sc_glitch_rate)**(<ctr>[,<table>]) : integer**[sc0_glitch_rate](#7.3.3-sc0_glitch_rate)**([<table>]) : integer**[sc1_glitch_rate](#7.3.3-sc1_glitch_rate)**([<table>]) : integer**[sc2_glitch_rate](#7.3.3-sc2_glitch_rate)**([<table>]) : integer```\nReturns the average rate at which front connection glitches were observed for\nthe currently tracked counters, measured in amount of events over the period\nconfigured in the table. Usually these glitches result in requests or\nconnections to be aborted so the returned value will often be related to past\nconnections. There is no good nor bad value, but a poor quality client may\noccasionally cause a few glitches per connection, hence a low rate is\ngenerally expected. However, a very bogus or malevolent client may quickly\ncause thousands of events to be added per connection, and maintain a high\nrate here. See also \"table_glitch_rate\" and \"sc_glitch_cnt\".\n\n```\n\n**[sc_gpc_rate](#7.3.3-sc_gpc_rate)**(<idx>,<ctr>[,<table>]) : integer```\nReturns the average increment rate of the General Purpose Counter at the\nindex <idx> of the array associated to the tracked counter of ID <ctr> from\nthe current proxy's table or from the designated stick-table <table>.\nIt reports the frequency which the gpc counter was incremented over the\nconfigured period. <idx> is an integer between 0 and 99 and <ctr> an integer\nbetween 0 and 2.\nNote that the 'gpc_rate' counter array  must be stored in the stick-table\nfor a value to be returned, as 'gpc' only holds the event count.\nThis fetch applies only to the 'gpc_rate' array data_type (and not to\nthe legacy 'gpc0_rate' nor 'gpc1_rate' data_types).\nSee also \"table_gpc_rate\", \"sc_get_gpc\", and \"sc_inc_gpc\".\n\n```\n\n**[sc_gpc0_rate](#7.3.3-sc_gpc0_rate)**(<ctr>[,<table>]) : integer**[sc0_gpc0_rate](#7.3.3-sc0_gpc0_rate)**([<table>]) : integer**[sc1_gpc0_rate](#7.3.3-sc1_gpc0_rate)**([<table>]) : integer**[sc2_gpc0_rate](#7.3.3-sc2_gpc0_rate)**([<table>]) : integer```\nReturns the average increment rate of the first General Purpose Counter\nassociated to the currently tracked counters. It reports the frequency\nwhich the gpc0 counter was incremented over the configured period. See also\nsrc_gpc0_rate, sc/sc0/sc1/sc2_get_gpc0, and sc/sc0/sc1/sc2_inc_gpc0. Note\nthat the \"gpc0_rate\" counter must be stored in the stick-table for a value to\nbe returned, as \"gpc0\" only holds the event count.\n\n```\n\n**[sc_gpc1_rate](#7.3.3-sc_gpc1_rate)**(<ctr>[,<table>]) : integer**[sc0_gpc1_rate](#7.3.3-sc0_gpc1_rate)**([<table>]) : integer**[sc1_gpc1_rate](#7.3.3-sc1_gpc1_rate)**([<table>]) : integer**[sc2_gpc1_rate](#7.3.3-sc2_gpc1_rate)**([<table>]) : integer```\nReturns the average increment rate of the second General Purpose Counter\nassociated to the currently tracked counters. It reports the frequency\nwhich the gpc1 counter was incremented over the configured period. See also\nsrc_gpcA_rate, sc/sc0/sc1/sc2_get_gpc1, and sc/sc0/sc1/sc2_inc_gpc1. Note\nthat the \"gpc1_rate\" counter must be stored in the stick-table for a value to\nbe returned, as \"gpc1\" only holds the event count.\n\n```\n\n**[sc_http_err_cnt](#7.3.3-sc_http_err_cnt)**(<ctr>[,<table>]) : integer**[sc0_http_err_cnt](#7.3.3-sc0_http_err_cnt)**([<table>]) : integer**[sc1_http_err_cnt](#7.3.3-sc1_http_err_cnt)**([<table>]) : integer**[sc2_http_err_cnt](#7.3.3-sc2_http_err_cnt)**([<table>]) : integer```\nReturns the cumulative number of HTTP errors from the currently tracked\ncounters. This includes the both request errors and 4xx error responses.\nSee also \"table_http_err_cnt\".\n\n```\n\n**[sc_http_err_rate](#7.3.3-sc_http_err_rate)**(<ctr>[,<table>]) : integer**[sc0_http_err_rate](#7.3.3-sc0_http_err_rate)**([<table>]) : integer**[sc1_http_err_rate](#7.3.3-sc1_http_err_rate)**([<table>]) : integer**[sc2_http_err_rate](#7.3.3-sc2_http_err_rate)**([<table>]) : integer```\nReturns the average rate of HTTP errors from the currently tracked counters,\nmeasured in amount of errors over the period configured in the table. This\nincludes the both request errors and 4xx error responses. See also\nsrc_http_err_rate.\n\n```\n\n**[sc_http_fail_cnt](#7.3.3-sc_http_fail_cnt)**(<ctr>[,<table>]) : integer**[sc0_http_fail_cnt](#7.3.3-sc0_http_fail_cnt)**([<table>]) : integer**[sc1_http_fail_cnt](#7.3.3-sc1_http_fail_cnt)**([<table>]) : integer**[sc2_http_fail_cnt](#7.3.3-sc2_http_fail_cnt)**([<table>]) : integer```\nReturns the cumulative number of HTTP response failures from the currently\ntracked counters. This includes the both response errors and 5xx status codes\nother than 501 and 505. See also \"table_http_fail_cnt\".\n\n```\n\n**[sc_http_fail_rate](#7.3.3-sc_http_fail_rate)**(<ctr>[,<table>]) : integer**[sc0_http_fail_rate](#7.3.3-sc0_http_fail_rate)**([<table>]) : integer**[sc1_http_fail_rate](#7.3.3-sc1_http_fail_rate)**([<table>]) : integer**[sc2_http_fail_rate](#7.3.3-sc2_http_fail_rate)**([<table>]) : integer```\nReturns the average rate of HTTP response failures from the currently tracked\ncounters, measured in amount of failures over the period configured in the\ntable. This includes the both response errors and 5xx status codes other than\n501 and 505. See also \"table_http_fail_rate\".\n\n```\n\n**[sc_http_req_cnt](#7.3.3-sc_http_req_cnt)**(<ctr>[,<table>]) : integer**[sc0_http_req_cnt](#7.3.3-sc0_http_req_cnt)**([<table>]) : integer**[sc1_http_req_cnt](#7.3.3-sc1_http_req_cnt)**([<table>]) : integer**[sc2_http_req_cnt](#7.3.3-sc2_http_req_cnt)**([<table>]) : integer```\nReturns the cumulative number of HTTP requests from the currently tracked\ncounters. This includes every started request, valid or not. See also\nsrc_http_req_cnt.\n\n```\n\n**[sc_http_req_rate](#7.3.3-sc_http_req_rate)**(<ctr>[,<table>]) : integer**[sc0_http_req_rate](#7.3.3-sc0_http_req_rate)**([<table>]) : integer**[sc1_http_req_rate](#7.3.3-sc1_http_req_rate)**([<table>]) : integer**[sc2_http_req_rate](#7.3.3-sc2_http_req_rate)**([<table>]) : integer```\nReturns the average rate of HTTP requests from the currently tracked\ncounters, measured in amount of requests over the period configured in\nthe table. This includes every started request, valid or not. See also\nsrc_http_req_rate.\n\n```\n\n**[sc_inc_gpc](#7.3.3-sc_inc_gpc)**(<idx>,<ctr>[,<table>]) : integer```\nIncrements the General Purpose Counter at the index <idx> of the array\nassociated to the designated tracked counter of ID <ctr> from current\nproxy's stick table or from the designated stick-table <table>, and\nreturns its new value. <idx> is an integer between 0 and 99 and\n<ctr> an integer between 0 and 2.\nBefore the first invocation, the stored value is zero, so first invocation\nwill increase it to 1 and will return 1.\nThis fetch applies only to the 'gpc' array data_type (and not to the legacy\n'gpc0' nor 'gpc1' data_types).\n\n```\n\n**[sc_inc_gpc0](#7.3.3-sc_inc_gpc0)**(<ctr>[,<table>]) : integer**[sc0_inc_gpc0](#7.3.3-sc0_inc_gpc0)**([<table>]) : integer**[sc1_inc_gpc0](#7.3.3-sc1_inc_gpc0)**([<table>]) : integer**[sc2_inc_gpc0](#7.3.3-sc2_inc_gpc0)**([<table>]) : integer```\nIncrements the first General Purpose Counter associated to the currently\ntracked counters, and returns its new value. Before the first invocation,\nthe stored value is zero, so first invocation will increase it to 1 and will\nreturn 1. This is typically used as a second ACL in an expression in order\nto mark a connection when a first ACL was verified :\n\n```\n\nExample:```\n\nacl abuse sc0_http_req_rate gt 10\nacl kill  sc0_inc_gpc0 gt 0\ntcp-request connection reject if abuse kill\n\n```\n\n**[sc_inc_gpc1](#7.3.3-sc_inc_gpc1)**(<ctr>[,<table>]) : integer**[sc0_inc_gpc1](#7.3.3-sc0_inc_gpc1)**([<table>]) : integer**[sc1_inc_gpc1](#7.3.3-sc1_inc_gpc1)**([<table>]) : integer**[sc2_inc_gpc1](#7.3.3-sc2_inc_gpc1)**([<table>]) : integer```\nIncrements the second General Purpose Counter associated to the currently\ntracked counters, and returns its new value. Before the first invocation,\nthe stored value is zero, so first invocation will increase it to 1 and will\nreturn 1. This is typically used as a second ACL in an expression in order\nto mark a connection when a first ACL was verified.\n\n```\n\n**[sc_kbytes_in](#7.3.3-sc_kbytes_in)**(<ctr>[,<table>]) : integer**[sc0_kbytes_in](#7.3.3-sc0_kbytes_in)**([<table>]) : integer**[sc1_kbytes_in](#7.3.3-sc1_kbytes_in)**([<table>]) : integer**[sc2_kbytes_in](#7.3.3-sc2_kbytes_in)**([<table>]) : integer```\nReturns the total amount of client-to-server data from the currently tracked\ncounters, measured in kilobytes. The test is currently performed on 32-bit\nintegers, which limits values to 4 terabytes. See also \"table_kbytes_in\".\n\n```\n\n**[sc_kbytes_out](#7.3.3-sc_kbytes_out)**(<ctr>[,<table>]) : integer**[sc0_kbytes_out](#7.3.3-sc0_kbytes_out)**([<table>]) : integer**[sc1_kbytes_out](#7.3.3-sc1_kbytes_out)**([<table>]) : integer**[sc2_kbytes_out](#7.3.3-sc2_kbytes_out)**([<table>]) : integer```\nReturns the total amount of server-to-client data from the currently tracked\ncounters, measured in kilobytes. The test is currently performed on 32-bit\nintegers, which limits values to 4 terabytes. See also \"table_kbytes_out\".\n\n```\n\n**[sc_key](#7.3.3-sc_key)**(<ctr>) : any**[sc0_key](#7.3.3-sc0_key)**: any**[sc1_key](#7.3.3-sc1_key)**: any**[sc2_key](#7.3.3-sc2_key)**: any```\nReturns the key used to match the currently tracked counter.\n\n```\n\n**[sc_sess_cnt](#7.3.3-sc_sess_cnt)**(<ctr>[,<table>]) : integer**[sc0_sess_cnt](#7.3.3-sc0_sess_cnt)**([<table>]) : integer**[sc1_sess_cnt](#7.3.3-sc1_sess_cnt)**([<table>]) : integer**[sc2_sess_cnt](#7.3.3-sc2_sess_cnt)**([<table>]) : integer```\nReturns the cumulative number of incoming connections that were transformed\ninto sessions, which means that they were accepted by a \"tcp-request\nconnection\" rule, from the currently tracked counters. A backend may count\nmore sessions than connections because each connection could result in many\nbackend sessions if some HTTP keep-alive is performed over the connection\nwith the client. See also \"table_sess_cnt\".\n\n```\n\n**[sc_sess_rate](#7.3.3-sc_sess_rate)**(<ctr>[,<table>]) : integer**[sc0_sess_rate](#7.3.3-sc0_sess_rate)**([<table>]) : integer**[sc1_sess_rate](#7.3.3-sc1_sess_rate)**([<table>]) : integer**[sc2_sess_rate](#7.3.3-sc2_sess_rate)**([<table>]) : integer```\nReturns the average session rate from the currently tracked counters,\nmeasured in amount of sessions over the period configured in the table. A\nsession is a connection that got past the early \"tcp-request connection\"\nrules. A backend may count more sessions than connections because each\nconnection could result in many backend sessions if some HTTP keep-alive is\nperformed over the connection with the client. See also \"table_sess_rate\".\n\n```\n\n**[sc_tracked](#7.3.3-sc_tracked)**(<ctr>[,<table>]) : boolean**[sc0_tracked](#7.3.3-sc0_tracked)**([<table>]) : boolean**[sc1_tracked](#7.3.3-sc1_tracked)**([<table>]) : boolean**[sc2_tracked](#7.3.3-sc2_tracked)**([<table>]) : boolean```\nReturns true if the designated session counter is currently being tracked by\nthe current session. This can be useful when deciding whether or not we want\nto set some values in a header passed to the server.\n\n```\n\n**[sc_trackers](#7.3.3-sc_trackers)**(<ctr>[,<table>]) : integer**[sc0_trackers](#7.3.3-sc0_trackers)**([<table>]) : integer**[sc1_trackers](#7.3.3-sc1_trackers)**([<table>]) : integer**[sc2_trackers](#7.3.3-sc2_trackers)**([<table>]) : integer```\nReturns the current amount of concurrent connections tracking the same\ntracked counters. This number is automatically incremented when tracking\nbegins and decremented when tracking stops. It differs from sc0_conn_cur in\nthat it does not rely on any stored information but on the table's reference\ncount (the \"use\" value which is returned by \"show table\" on the CLI). This\nmay sometimes be more suited for layer7 tracking. It can be used to tell a\nserver how many concurrent connections there are from a given address for\nexample.\n\n```\n\n**[so_id](#7.3.3-so_id)**: integer```\nReturns an integer containing the current listening socket's id. It is useful\nin frontends involving many \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines, or to stick all users coming via a\nsame socket to the same server.\n\n```\n\n**[so_name](#7.3.3-so_name)**: string```\nReturns a string containing the current listening socket's name, as defined\nwith name on a \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line. It can serve the same purposes as so_id but with\nstrings instead of integers.\n\n```\n\n**[src](#7.3.3-src)**: ip```\nThis is the source IP address of the client of the session. Any tcp/http\nrules may alter this address. It is of type IP and works on both IPv4 and\nIPv6 tables. On IPv6 tables, IPv4 addresses are mapped to their IPv6\nequivalent, according to RFC 4291. Note that it is the TCP-level source\naddress which is used, and not the address of a client behind a\nproxy. However if the \"accept-proxy\" or \"accept-netscaler-cip\" bind directive\nis used, it can be the address of a client behind another PROXY-protocol\ncompatible component for all rule sets except \"tcp-request connection\" which\nsees the real address. When the incoming connection passed through address\ntranslation or redirection involving connection tracking, the original\ndestination address before the redirection will be reported. On Linux\nsystems, the source and destination may seldom appear reversed if the\nnf_conntrack_tcp_loose sysctl is set, because a late response may reopen a\ntimed out connection and switch what is believed to be the source and the\ndestination.\n\n```\n\nExample:```\n\n# add an HTTP header in requests with the originating address' country\nhttp-request set-header X-Country %[src,map_ip(geoip.lst)]\n\n```\n\n**[src_bytes_in_rate](#7.3.3-src_bytes_in_rate)**([<table>]) : integer```\nSame as \"table_bytes_in_rate\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_bytes_in_rate([<table>])\n\n```\n\n**[src_bytes_out_rate](#7.3.3-src_bytes_out_rate)**([<table>]) : integer```\nSame as \"table_bytes_out_rate\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_bytes_out_rate([<table>])\n\n```\n\n**[src_clr_gpc](#7.3.3-src_clr_gpc)**(<idx>[,<table>]) : integer```\nSame as \"table_clr_gpc\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_clr_gpc(<idx>[,<table>])\n\n```\n\n**[src_clr_gpc0](#7.3.3-src_clr_gpc0)**([<table>]) : integer```\nSame as \"table_clr_gpc0\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_clr_gpc0([<table>])\n\n```\n\n**[src_clr_gpc1](#7.3.3-src_clr_gpc1)**([<table>]) : integer```\nSame as \"table_clr_gpc1\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_clr_gpc1([<table>])\n\n```\n\n**[src_conn_cnt](#7.3.3-src_conn_cnt)**([<table>]) : integer```\nSame as \"table_conn_cnt\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_conn_cnt([<table>])\n\n```\n\n**[src_conn_cur](#7.3.3-src_conn_cur)**([<table>]) : integer```\nSame as \"table_conn_cur\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_conn_cur([<table>])\n\n```\n\n**[src_conn_rate](#7.3.3-src_conn_rate)**([<table>]) : integer```\nSame as \"table_conn_rate\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_conn_rate([<table>])\n\n```\n\n**[src_get_gpc](#7.3.3-src_get_gpc)**(<idx>[,<table>]) : integer```\nSame as \"table_gpc\" converter with key set to the incoming connection's\nsource address.\n\nEquivalent to: src,table_gpc(<idx>[,<table>])\n\n```\n\n**[src_get_gpc0](#7.3.3-src_get_gpc0)**([<table>]) : integer```\nSame as \"table_gpc0\" converter with key set to the incoming connection's\nsource address.\n\nEquivalent to: src,table_gpc0([<table>])\n\n```\n\n**[src_get_gpc1](#7.3.3-src_get_gpc1)**([<table>]) : integer```\nSame as \"table_gpc1\" converter with key set to the incoming connection's\nsource address.\n\nEquivalent to: src,table_gpc1([<table>])\n\n```\n\n**[src_get_gpt](#7.3.3-src_get_gpt)**(<idx>[,<table>]) : integer```\nSame as \"table_gpt\" converter with key set to the incoming connection's\nsource address.\n\nEquivalent to: src,table_gpt(<idx>[,<table>])\n\n```\n\n**[src_get_gpt0](#7.3.3-src_get_gpt0)**([<table>]) : integer```\nSame as \"table_gpt0\" converter with key set to the incoming connection's\nsource address.\n\nEquivalent to: src,table_gpt0([<table>])\n\n```\n\n**[src_glitch_cnt](#7.3.3-src_glitch_cnt)**([<table>]) : integer```\nSame as \"table_glitch_cnt\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_glitch_cnt([<table>])\n\n```\n\n**[src_glitch_rate](#7.3.3-src_glitch_rate)**([<table>]) : integer```\nSame as \"table_glitch_rate\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_glitch_rate([<table>])\n\n```\n\n**[src_gpc_rate](#7.3.3-src_gpc_rate)**(<idx>[,<table>]) : integer```\nSame as \"table_gpc_rate\" converter with key set to the incoming connection's\nsource address.\n\nEquivalent to: src,table_gpc_rate(<idx>[,<table>])\n\n```\n\n**[src_gpc0_rate](#7.3.3-src_gpc0_rate)**([<table>]) : integer```\nSame as \"table_gpc0_rate\" converter with key set to the incoming connection's\nsource address.\n\nEquivalent to: src,table_gpc0_rate([<table>])\n\n```\n\n**[src_gpc1_rate](#7.3.3-src_gpc1_rate)**([<table>]) : integer```\nSame as \"table_gpc1_rate\" converter with key set to the incoming connection's\nsource address.\n\nEquivalent to: src,table_gpc1_rate([<table>])\n\n```\n\n**[src_http_err_cnt](#7.3.3-src_http_err_cnt)**([<table>]) : integer```\nSame as \"table_http_err_cnt\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_http_err_cnt([<table>])\n\n```\n\n**[src_http_err_rate](#7.3.3-src_http_err_rate)**([<table>]) : integer```\nSame as \"table_http_err_rate\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_http_err_rate([<table>])\n\n```\n\n**[src_http_fail_cnt](#7.3.3-src_http_fail_cnt)**([<table>]) : integer```\nSame as \"table_http_fail_cnt\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_http_fail_cnt([<table>])\n\n```\n\n**[src_http_fail_rate](#7.3.3-src_http_fail_rate)**([<table>]) : integer```\nSame as \"table_http_fail_rate\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_http_fail_rate([<table>])\n\n```\n\n**[src_http_req_cnt](#7.3.3-src_http_req_cnt)**([<table>]) : integer```\nSame as \"table_http_req_cnt\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_http_req_cnt([<table>])\n\n```\n\n**[src_http_req_rate](#7.3.3-src_http_req_rate)**([<table>]) : integer```\nSame as \"table_http_req_rate\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_http_req_rate([<table>])\n\n```\n\n**[src_inc_gpc](#7.3.3-src_inc_gpc)**(<idx>[,<table>]) : integer```\nSame as \"src_inc_gpc\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_inc_gpc(<idx>[,<table>])\n\n```\n\n**[src_inc_gpc0](#7.3.3-src_inc_gpc0)**([<table>]) : integer```\nSame as \"src_inc_gpc0\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_inc_gpc0([<table>])\n\n```\n\n**[src_inc_gpc1](#7.3.3-src_inc_gpc1)**([<table>]) : integer```\nSame as \"src_inc_gpc1\" converter with key set to the incoming\nconnection's source address.\n\nEquivalent to: src,table_inc_gpc1([<table>])\n\n```\n\n**[src_is_local](#7.3.3-src_is_local)**: boolean```\nReturns true if the source address of the incoming connection is local to the\nsystem, or false if the address doesn't exist on the system, meaning that it\ncomes from a remote machine. Note that UNIX addresses are considered local.\nIt can be useful to apply certain access restrictions based on where the\nclient comes from (e.g. require auth or https for remote machines). Please\nnote that the check involves a few system calls, so it's better to do it only\nonce per connection.\n\n```\n\n**[src_kbytes_in](#7.3.3-src_kbytes_in)**([<table>]) : integer```\nSame as \"table_kbytes_in\" converter with key set to the incoming connection's\nsource address.\n\nEquivalent to: src,table_kbytes_in([<table>])\n\n```\n\n**[src_kbytes_out](#7.3.3-src_kbytes_out)**([<table>]) : integer```\nSame as \"table_kbytes_out\" converter with key set to the incoming connection's\nsource address.\n\nEquivalent to: src,table_kbytes_out([<table>])\n\n```\n\n**[src_port](#7.3.3-src_port)**: integer```\nReturns an integer value corresponding to the TCP source port of the\nconnection on the client side, which is the port the client connected\nfrom. Any tcp/http rules may alter this address. Usage of this function is\nvery limited as modern protocols do not care much about source ports\nnowadays.\n\n```\n\n**[src_sess_cnt](#7.3.3-src_sess_cnt)**([<table>]) : integer```\nSame as \"table_sess_cnt\" converter with key set to the incoming connection's\nsource address.\n\nEquivalent to: src,table_sess_cnt([<table>])\n\n```\n\n**[src_sess_rate](#7.3.3-src_sess_rate)**([<table>]) : integer```\nSame as \"table_sess_rate\" converter with key set to the incoming connection's\nsource address.\n\nEquivalent to: src,table_sess_rate([<table>])\n\n```\n\n**[src_updt_conn_cnt](#7.3.3-src_updt_conn_cnt)**([<table>]) : integer```\nCreates or updates the entry associated to the incoming connection's source\naddress in the current proxy's stick-table or in the designated stick-table.\nThis table must be configured to store the \"conn_cnt\" data type, otherwise\nthe match will be ignored. The current count is incremented by one, and the\nexpiration timer refreshed. The updated count is returned, so this match\ncan't return zero. This was used to reject service abusers based on their\nsource address. Note: it is recommended to use the more complete \"track-sc*\"\nactions in \"tcp-request\" rules instead.\n\n```\n\nExample :```\n\n# This frontend limits incoming SSH connections to 3 per 10 second for\n# each source address, and rejects excess connections until a 10 second\n# silence is observed. At most 20 addresses are tracked.\nlisten ssh\n    bind :22\n    mode tcp\n    maxconn 100\n    stick-table type ip size 20 expire 10s store conn_cnt\n    tcp-request content reject if { src_updt_conn_cnt gt 3 }\n    server local 127.0.0.1:22\n\n```\n\n**[srv_id](#7.3.3-srv_id)**: integer```\nReturns an integer containing the server's id when processing the response.\nWhile it's almost only used with ACLs, it may be used for logging or\ndebugging. It can also be used in a tcp-check or an http-check ruleset.\n\n```\n\n**[srv_name](#7.3.3-srv_name)**: string```\nReturns a string containing the server's name when processing the response.\nWhile it's almost only used with ACLs, it may be used for logging or\ndebugging. It can also be used in a tcp-check or an http-check ruleset.\n\n```\n\n**[txn.conn_retries](#7.3.3-txn.conn_retries)**: integer```\nReturns the the number of connection retries experienced by this stream when\ntrying to connect to the server. This value is subject to change while the\nconnection is not fully established. For HTTP connections, the value may be\naffected by L7 retries.\n\n```\n\n**[txn.redispatched](#7.3.3-txn.redispatched)**: boolean```\nReturns true if the connection has experienced redispatch upon retry according\nto \"option redispatch\" configuration. This value is subject to change while\nthe connection is not fully established. For HTTP connections, the value may\nbe affected by L7 retries.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.3.4. Fetching samples at Layer 5", "content": "### [7.3.4.](#7.3.4)Fetching samples at Layer 5\n\n```\nThe layer 5 usually describes just the session layer which in HAProxy is\nclosest to the session once all the connection handshakes are finished, but\nwhen no content is yet made available. The fetch methods described here are\nusable as low as the \"tcp-request content\" rule sets unless they require some\nfuture information. Those generally include the results of SSL negotiations.\n\nSummary of sample fetch methods in this section and their respective types:\n\n```\n\nkeywordoutput type[51d.all(<prop>[,<prop>*])](#7-51d.all)string[bs.aborted](#7-bs.aborted)boolean[bs.debug_str([<bitmap>])](#7-bs.debug_str)string[bs.id](#7-bs.id)integer[bs.rst_code](#7-bs.rst_code)integer[fs.aborted](#7-fs.aborted)boolean[fs.debug_str([<bitmap>])](#7-fs.debug_str)string[fs.id](#7-fs.id)integer[fs.rst_code](#7-fs.rst_code)integer[ssl_bc](#7-ssl_bc)boolean[ssl_bc_alg_keysize](#7-ssl_bc_alg_keysize)integer[ssl_bc_alpn](#7-ssl_bc_alpn)string[ssl_bc_cipher](#7-ssl_bc_cipher)string[ssl_bc_client_early_traffic_secret](#7-ssl_bc_client_early_traffic_secret)string[ssl_bc_client_handshake_traffic_secret](#7-ssl_bc_client_handshake_traffic_secret)string[ssl_bc_client_random](#7-ssl_bc_client_random)binary[ssl_bc_client_traffic_secret_0](#7-ssl_bc_client_traffic_secret_0)string[ssl_bc_curve](#7-ssl_bc_curve)string[ssl_bc_early_exporter_secret](#7-ssl_bc_early_exporter_secret)string[ssl_bc_err](#7-ssl_bc_err)integerkeywordoutput type[ssl_bc_err_str](#7-ssl_bc_err_str)string[ssl_bc_exporter_secret](#7-ssl_bc_exporter_secret)string[ssl_bc_is_resumed](#7-ssl_bc_is_resumed)boolean[ssl_bc_npn](#7-ssl_bc_npn)string[ssl_bc_protocol](#7-ssl_bc_protocol)string[ssl_bc_server_handshake_traffic_secret](#7-ssl_bc_server_handshake_traffic_secret)string[ssl_bc_server_random](#7-ssl_bc_server_random)binary[ssl_bc_server_traffic_secret_0](#7-ssl_bc_server_traffic_secret_0)string[ssl_bc_session_id](#7-ssl_bc_session_id)binary[ssl_bc_session_key](#7-ssl_bc_session_key)binary[ssl_bc_sni](#7-ssl_bc_sni)string[ssl_bc_unique_id](#7-ssl_bc_unique_id)binary[ssl_bc_use_keysize](#7-ssl_bc_use_keysize)integer[ssl_c_ca_err](#7-ssl_c_ca_err)integer[ssl_c_ca_err_depth](#7-ssl_c_ca_err_depth)integer[ssl_c_chain_der](#7-ssl_c_chain_der)binary[ssl_c_der](#7-ssl_c_der)binary[ssl_c_err](#7-ssl_c_err)integer[ssl_c_i_dn([<entry>[,<occ>[,<format>]]])](#7-ssl_c_i_dn)string[ssl_c_key_alg](#7-ssl_c_key_alg)stringkeywordoutput type[ssl_c_notafter](#7-ssl_c_notafter)string[ssl_c_notbefore](#7-ssl_c_notbefore)string[ssl_c_r_dn([<entry>[,<occ>[,<format>]]])](#7-ssl_c_r_dn)string[ssl_c_s_dn([<entry>[,<occ>[,<format>]]])](#7-ssl_c_s_dn)string[ssl_c_san](#7-ssl_c_san)string[ssl_c_serial](#7-ssl_c_serial)binary[ssl_c_sha1](#7-ssl_c_sha1)binary[ssl_c_sig_alg](#7-ssl_c_sig_alg)string[ssl_c_used](#7-ssl_c_used)boolean[ssl_c_verify](#7-ssl_c_verify)integer[ssl_c_version](#7-ssl_c_version)integer[ssl_f_der](#7-ssl_f_der)binary[ssl_f_i_dn([<entry>[,<occ>[,<format>]]])](#7-ssl_f_i_dn)string[ssl_f_key_alg](#7-ssl_f_key_alg)string[ssl_f_notafter](#7-ssl_f_notafter)string[ssl_f_notbefore](#7-ssl_f_notbefore)string[ssl_f_s_dn([<entry>[,<occ>[,<format>]]])](#7-ssl_f_s_dn)string[ssl_f_serial](#7-ssl_f_serial)binary[ssl_f_sha1](#7-ssl_f_sha1)binary[ssl_f_sig_alg](#7-ssl_f_sig_alg)stringkeywordoutput type[ssl_f_version](#7-ssl_f_version)integer[ssl_fc](#7-ssl_fc)boolean[ssl_fc_alg_keysize](#7-ssl_fc_alg_keysize)integer[ssl_fc_alpn](#7-ssl_fc_alpn)string[ssl_fc_cipher](#7-ssl_fc_cipher)string[ssl_fc_cipherlist_bin([<filter_option>])](#7-ssl_fc_cipherlist_bin)binary[ssl_fc_cipherlist_hex([<filter_option>])](#7-ssl_fc_cipherlist_hex)string[ssl_fc_cipherlist_str([<filter_option>])](#7-ssl_fc_cipherlist_str)string[ssl_fc_cipherlist_xxh](#7-ssl_fc_cipherlist_xxh)integer[ssl_fc_client_early_traffic_secret](#7-ssl_fc_client_early_traffic_secret)string[ssl_fc_client_handshake_traffic_secret](#7-ssl_fc_client_handshake_traffic_secret)string[ssl_fc_client_random](#7-ssl_fc_client_random)binary[ssl_fc_client_traffic_secret_0](#7-ssl_fc_client_traffic_secret_0)string[ssl_fc_curve](#7-ssl_fc_curve)string[ssl_fc_early_exporter_secret](#7-ssl_fc_early_exporter_secret)string[ssl_fc_ecformats_bin](#7-ssl_fc_ecformats_bin)binary[ssl_fc_eclist_bin([<filter_option>])](#7-ssl_fc_eclist_bin)binary[ssl_fc_err](#7-ssl_fc_err)integer[ssl_fc_err_str](#7-ssl_fc_err_str)string[ssl_fc_exporter_secret](#7-ssl_fc_exporter_secret)stringkeywordoutput type[ssl_fc_extlist_bin([<filter_option>])](#7-ssl_fc_extlist_bin)binary[ssl_fc_has_crt](#7-ssl_fc_has_crt)boolean[ssl_fc_has_early](#7-ssl_fc_has_early)boolean[ssl_fc_has_sni](#7-ssl_fc_has_sni)boolean[ssl_fc_is_resumed](#7-ssl_fc_is_resumed)boolean[ssl_fc_npn](#7-ssl_fc_npn)string[ssl_fc_protocol](#7-ssl_fc_protocol)string[ssl_fc_protocol_hello_id](#7-ssl_fc_protocol_hello_id)integer[ssl_fc_server_handshake_traffic_secret](#7-ssl_fc_server_handshake_traffic_secret)string[ssl_fc_server_random](#7-ssl_fc_server_random)binary[ssl_fc_server_traffic_secret_0](#7-ssl_fc_server_traffic_secret_0)string[ssl_fc_session_id](#7-ssl_fc_session_id)binary[ssl_fc_session_key](#7-ssl_fc_session_key)binary[ssl_fc_sigalgs_bin([<filter_option>])](#7-ssl_fc_sigalgs_bin)binary[ssl_fc_sni](#7-ssl_fc_sni)string[ssl_fc_supported_versions_bin([<filter_option>])](#7-ssl_fc_supported_versions_bin)binary[ssl_fc_unique_id](#7-ssl_fc_unique_id)binary[ssl_fc_use_keysize](#7-ssl_fc_use_keysize)integer[ssl_s_chain_der](#7-ssl_s_chain_der)binary[ssl_s_der](#7-ssl_s_der)binarykeywordoutput type[ssl_s_i_dn([<entry>[,<occ>[,<format>]]])](#7-ssl_s_i_dn)string[ssl_s_key_alg](#7-ssl_s_key_alg)string[ssl_s_notafter](#7-ssl_s_notafter)string[ssl_s_notbefore](#7-ssl_s_notbefore)string[ssl_s_s_dn([<entry>[,<occ>[,<format>]]])](#7-ssl_s_s_dn)string[ssl_s_serial](#7-ssl_s_serial)binary[ssl_s_sha1](#7-ssl_s_sha1)binary[ssl_s_sig_alg](#7-ssl_s_sig_alg)string[ssl_s_version](#7-ssl_s_version)integer[txn.timer.user](#7-txn.timer.user)integer```\nDetailed list:\n\n```\n\n**[51d.all](#7.3.4-51d.all)**(<prop>[,<prop>*]) : string```\nReturns values for the properties requested as a string, where values are\nseparated by the delimiter specified with \"51degrees-property-separator\".\nThe device is identified using all the important HTTP headers from the\nrequest. The function can be passed up to five property names, and if a\nproperty name can't be found, the value \"NoData\" is returned.\n\n```\n\nExample :```\n\n# Here the header \"X-51D-DeviceTypeMobileTablet\" is added to the request\n# containing the three properties requested using all relevant headers from\n# the request.\nfrontend http-in\n  bind *:8081\n  default_backend servers\n  http-request set-header X-51D-DeviceTypeMobileTablet \\\n    %[51d.all(DeviceType,IsMobile,IsTablet)]\n\n```\n\n**[bs.aborted](#7.3.4-bs.aborted)**: boolean```\nReturns true is an abort was received from the server for the current\nstream. Otherwise false is returned.\n\n```\n\n**[bs.debug_str](#7.3.4-bs.debug_str)**([<bitmap>]) : string```\nThis function is meant to be used by developers during certain complex\ntroubleshooting sessions. It extracts some internal states from the lower\nlayers of the backend stream and connection, and arranges them as a string,\ngenerally in the form of a series of \"name=value\" delimited with spaces. The\n<bitmap> optional argument indicates what layer(s) to extract information\nfrom, and is an arithmetic OR (or a sum) of the following values:\n   - socket layer: 16\n   - connection layer: 8\n   - transport layer (e.g. SSL): 4\n   - mux connection: 2\n   - mux stream: 1\n\nThese values might change across versions. The default value of zero is\nspecial and enables all layers. Please do not rely on the output of this\nfunction for long-term production monitoring. It is meant to evolve even\nwithin a stable branch, as the needs for increased details arise. One use\ntypical use case is to concatenate these information at the very end of a\nlog-format, along with fs.debug_str(). Example:\n\n   log-format \"$HAPROXY_HTTP_LOG_FMT fs=<%[fs.debug_str]> bs=<%[bs.debug_str]>\"\n\n```\n\n**[bs.id](#7.3.4-bs.id)**: integer```\nReturns the multiplexer's stream ID on the server side. It is the\nmultiplexer's responsibility to return the appropriate information.\n\n```\n\n**[bs.rst_code](#7.3.4-bs.rst_code)**: integer```\nReturns the reset code received from the server for the current stream. The\ncode of the H2 RST_STREAM frame or the QUIC STOP_SENDING frame received from\nthe server is returned. The sample fetch fails if no abort was received or if\nthe server stream is not an H2/QUIC stream.\n\n```\n\n**[fs.aborted](#7.3.4-fs.aborted)**: boolean```\nReturns true is an abort was received from the client for the current\nstream. Otherwise false is returned.\n\n```\n\n**[fs.debug_str](#7.3.4-fs.debug_str)**([<bitmap>]) : string```\nThis function is meant to be used by developers during certain complex\ntroubleshooting sessions. It extracts some internal states from the lower\nlayers of the frontend stream and connection, and arranges them as a string,\ngenerally in the form of a series of \"name=value\" delimited with spaces. The\n<bitmap> optional argument indicates what layer(s) to extract information\nfrom, and is an arithmetic OR (or a sum) of the following values:\n   - socket layer: 16\n   - connection layer: 8\n   - transport layer (e.g. SSL): 4\n   - mux connection: 2\n   - mux stream: 1\n\nThese values might change across versions. The default value of zero is\nspecial and enables all layers. Please do not rely on the output of this\nfunction for long-term production monitoring. It is meant to evolve even\nwithin a stable branch, as the needs for increased details arise. One use\ntypical use case is to concatenate these information at the very end of a\nlog-format, along with bs.debug_str(). Example:\n\n   log-format \"$HAPROXY_HTTP_LOG_FMT fs=<%[fs.debug_str]> bs=<%[bs.debug_str]>\"\n\n```\n\n**[fs.id](#7.3.4-fs.id)**: integer```\nReturns the multiplexer's stream ID on the client side. It is the\nmultiplexer's responsibility to return the appropriate information. For\ninstance, on a raw TCP, 0 is always returned because there is no stream.\n\n```\n\n**[fs.rst_code](#7.3.4-fs.rst_code)**: integer```\nReturns the reset code received from the client for the current stream. The\ncode of the H2 RST_STREAM frame or the QUIC STOP_SENDING frame received from\nthe client is returned. The sample fetch fails if no abort was received or\nif the client stream is not an H2/QUIC stream.\n\n```\n\n**[ssl_bc](#7.3.4-ssl_bc)**: boolean```\nReturns true when the back connection was made via an SSL/TLS transport\nlayer and is locally deciphered. This means the outgoing connection was made\nto a server with the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option. It can be used in a tcp-check or an\nhttp-check ruleset.\n\n```\n\n**[ssl_bc_alg_keysize](#7.3.4-ssl_bc_alg_keysize)**: integer```\nReturns the symmetric cipher key size supported in bits when the outgoing\nconnection was made over an SSL/TLS transport layer. It can be used in a\ntcp-check or an http-check ruleset.\n\n```\n\n**[ssl_bc_alpn](#7.3.4-ssl_bc_alpn)**: string```\nThis extracts the Application Layer Protocol Negotiation field from an\noutgoing connection made via a TLS transport layer.\nThe result is a string containing the protocol name negotiated with the\nserver. The SSL library must have been built with support for TLS\nextensions enabled (check haproxy -vv). Note that the TLS ALPN extension is\nnot advertised unless the \"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" keyword on the \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" line specifies a\nprotocol list. Also, nothing forces the server to pick a protocol from this\nlist, any other one may be requested. The TLS ALPN extension is meant to\nreplace the TLS NPN extension. See also \"ssl_bc_npn\". It can be used in a\ntcp-check or an http-check ruleset.\n\n```\n\n**[ssl_bc_cipher](#7.3.4-ssl_bc_cipher)**: string```\nReturns the name of the used cipher when the outgoing connection was made\nover an SSL/TLS transport layer. It can be used in a tcp-check or an\nhttp-check ruleset.\n\n```\n\n**[ssl_bc_client_early_traffic_secret](#7.3.4-ssl_bc_client_early_traffic_secret)**: string```\nReturn the CLIENT_EARLY_TRAFFIC_SECRET as an hexadecimal string for the\nback connection when the outgoing connection was made over a TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_bc_client_handshake_traffic_secret](#7.3.4-ssl_bc_client_handshake_traffic_secret)**: string```\nReturn the CLIENT_HANDSHAKE_TRAFFIC_SECRET as an hexadecimal string for the\nbacl connection when the outgoing connection was made over a TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_bc_client_random](#7.3.4-ssl_bc_client_random)**: binary```\nReturns the client random of the back connection when the incoming connection\nwas made over an SSL/TLS transport layer. It is useful to to decrypt traffic\nsent using ephemeral ciphers. This requires OpenSSL >= 1.1.0, or BoringSSL.\nIt can be used in a tcp-check or an http-check ruleset.\n\n```\n\n**[ssl_bc_client_traffic_secret_0](#7.3.4-ssl_bc_client_traffic_secret_0)**: string```\nReturn the CLIENT_TRAFFIC_SECRET_0 as an hexadecimal string for the\nback connection when the outgoing connection was made over a TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_bc_curve](#7.3.4-ssl_bc_curve)**: string```\nReturns the name of the curve used in the key agreement when the outgoing\nconnection was made over an SSL/TLS transport layer. This requires\nOpenSSL >= 3.0.0 or AWS-LC >= 1.57.0.\n\n```\n\n**[ssl_bc_early_exporter_secret](#7.3.4-ssl_bc_early_exporter_secret)**: string```\nReturn the EARLY_EXPORTER_SECRET as an hexadecimal string for the\nback connection when the outgoing connection was made over an TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_bc_err](#7.3.4-ssl_bc_err)**: integer```\nWhen the outgoing connection was made over an SSL/TLS transport layer,\nreturns the ID of the last error of the first error stack raised on the\nbackend side. It can raise handshake errors as well as other read or write\nerrors occurring during the connection's lifetime. In order to get a text\ndescription of this error code, you can either use the \"ssl_bc_err_str\"\nsample fetch or use the \"openssl errstr\" command (which takes an error code\nin hexadecimal representation as parameter). Please refer to your SSL\nlibrary's documentation to find the exhaustive list of error codes.\n\n```\n\n**[ssl_bc_err_str](#7.3.4-ssl_bc_err_str)**: string```\nWhen the outgoing connection was made over an SSL/TLS transport layer,\nreturns a string representation of the last error of the first error stack\nthat was raised on the connection from the backend's perspective. See also\n\"ssl_fc_err\".\n\n```\n\n**[ssl_bc_exporter_secret](#7.3.4-ssl_bc_exporter_secret)**: string```\nReturn the EXPORTER_SECRET as an hexadecimal string for the\nback connection when the outgoing connection was made over a TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_bc_is_resumed](#7.3.4-ssl_bc_is_resumed)**: boolean```\nReturns true when the back connection was made over an SSL/TLS transport\nlayer and the newly created SSL session was resumed using a cached\nsession or a TLS ticket. It can be used in a tcp-check or an http-check\nruleset.\n\n```\n\n**[ssl_bc_npn](#7.3.4-ssl_bc_npn)**: string```\nThis extracts the Next Protocol Negotiation field from an outgoing connection\nmade via a TLS transport layer. The result is a string containing the\nprotocol name negotiated with the server . The SSL library must have been\nbuilt with support for TLS extensions enabled (check haproxy -vv). Note that\nthe TLS NPN extension is not advertised unless the \"npnThis keyword is available in sections :Bind optionsServer and default-server options\" keyword on the\n\"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" line specifies a protocol list. Also, nothing forces the server to\npick a protocol from this list, any other one may be used. Please note that\nthe TLS NPN extension was replaced with ALPN. It can be used in a tcp-check\nor an http-check ruleset.\n\n```\n\n**[ssl_bc_protocol](#7.3.4-ssl_bc_protocol)**: string```\nReturns the name of the used protocol when the outgoing connection was made\nover an SSL/TLS transport layer. It can be used in a tcp-check or an\nhttp-check ruleset.\n\n```\n\n**[ssl_bc_server_handshake_traffic_secret](#7.3.4-ssl_bc_server_handshake_traffic_secret)**: string```\nReturn the SERVER_HANDSHAKE_TRAFFIC_SECRET as an hexadecimal string for the\nback connection when the outgoing connection was made over a TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_bc_server_random](#7.3.4-ssl_bc_server_random)**: binary```\nReturns the server random of the back connection when the incoming connection\nwas made over an SSL/TLS transport layer. It is useful to to decrypt traffic\nsent using ephemeral ciphers. This requires OpenSSL >= 1.1.0, or BoringSSL.\nIt can be used in a tcp-check or an http-check ruleset.\n\n```\n\n**[ssl_bc_server_traffic_secret_0](#7.3.4-ssl_bc_server_traffic_secret_0)**: string```\nReturn the SERVER_TRAFFIC_SECRET_0 as an hexadecimal string for the\nback connection when the outgoing connection was made over an TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_bc_session_id](#7.3.4-ssl_bc_session_id)**: binary```\nReturns the SSL ID of the back connection when the outgoing connection was\nmade over an SSL/TLS transport layer. It is useful to log if we want to know\nif session was reused or not. It can be used in a tcp-check or an http-check\nruleset.\n\n```\n\n**[ssl_bc_session_key](#7.3.4-ssl_bc_session_key)**: binary```\nReturns the SSL session master key of the back connection when the outgoing\nconnection was made over an SSL/TLS transport layer. It is useful to decrypt\ntraffic sent using ephemeral ciphers. This requires OpenSSL >= 1.1.0, or\nBoringSSL. It can be used in a tcp-check or an http-check ruleset.\n\n```\n\n**[ssl_bc_sni](#7.3.4-ssl_bc_sni)**: string```\nThis retrieves the Server Name Indication TLS extension (SNI) field that was\nused on the connection to the server. The result (when present) typically is\na string matching the HTTPS host name (253 chars or less). The main use case\nis for logging and debugging purposes (e.g. figure what SNI was used when the\nconnection was established to match it against what the server has seen).\n\n```\n\n**[ssl_bc_unique_id](#7.3.4-ssl_bc_unique_id)**: binary```\nWhen the outgoing connection was made over an SSL/TLS transport layer,\nreturns the TLS unique ID as defined in RFC5929 section 3. The unique id\ncan be encoded to base64 using the converter: \"ssl_bc_unique_id,base64\". It\ncan be used in a tcp-check or an http-check ruleset.\n\n```\n\n**[ssl_bc_use_keysize](#7.3.4-ssl_bc_use_keysize)**: integer```\nReturns the symmetric cipher key size used in bits when the outgoing\nconnection was made over an SSL/TLS transport layer. It can be used in a\ntcp-check or an http-check ruleset.\n\n```\n\n**[ssl_c_ca_err](#7.3.4-ssl_c_ca_err)**: integer```\nWhen the incoming connection was made over an SSL/TLS transport layer,\nreturns the ID of the first error detected during verification of the client\ncertificate at depth > 0, or 0 if no error was encountered during this\nverification process. Please refer to your SSL library's documentation to\nfind the exhaustive list of error codes.\n\n```\n\n**[ssl_c_ca_err_depth](#7.3.4-ssl_c_ca_err_depth)**: integer```\nWhen the incoming connection was made over an SSL/TLS transport layer,\nreturns the depth in the CA chain of the first error detected during the\nverification of the client certificate. If no error is encountered, 0 is\nreturned.\n\n```\n\n**[ssl_c_chain_der](#7.3.4-ssl_c_chain_der)**: binary```\nReturns the DER formatted chain certificate presented by the client when the\nincoming connection was made over an SSL/TLS transport layer. When used for\nan ACL, the value(s) to match against can be passed in hexadecimal form. One\ncan parse the result with any lib accepting ASN.1 DER data. It currently\ndoes not support resumed sessions.\n\n```\n\n**[ssl_c_der](#7.3.4-ssl_c_der)**: binary```\nReturns the DER formatted certificate presented by the client when the\nincoming connection was made over an SSL/TLS transport layer. When used for\nan ACL, the value(s) to match against can be passed in hexadecimal form.\n\n```\n\n**[ssl_c_err](#7.3.4-ssl_c_err)**: integer```\nWhen the incoming connection was made over an SSL/TLS transport layer,\nreturns the ID of the first error detected during verification at depth 0, or\n0 if no error was encountered during this verification process. Please refer\nto your SSL library's documentation to find the exhaustive list of error\ncodes.\n\n```\n\n**[ssl_c_i_dn](#7.3.4-ssl_c_i_dn)**([<entry>[,<occ>[,<format>]]]) : string```\nWhen the incoming connection was made over an SSL/TLS transport layer,\nreturns the full distinguished name of the issuer of the certificate\npresented by the client when no <entry> is specified, or the value of the\nfirst given entry found from the beginning of the DN. If a positive/negative\noccurrence number is specified as the optional second argument, it returns\nthe value of the nth given entry value from the beginning/end of the DN.\nFor instance, \"ssl_c_i_dn(OU,2)\" the second organization unit, and\n\"ssl_c_i_dn(CN)\" retrieves the common name.\nThe <format> parameter allows you to receive the DN suitable for\nconsumption by different protocols. Currently supported is rfc2253 for\nLDAP v3.\nIf you'd like to modify the format only you can specify an empty string\nand zero for the first two parameters. Example: ssl_c_i_dn(,0,rfc2253)\n\n```\n\n**[ssl_c_key_alg](#7.3.4-ssl_c_key_alg)**: string```\nReturns the name of the algorithm used to generate the key of the certificate\npresented by the client when the incoming connection was made over an SSL/TLS\ntransport layer.\n\n```\n\n**[ssl_c_notafter](#7.3.4-ssl_c_notafter)**: string```\nReturns the end date presented by the client as a formatted string\nYYMMDDhhmmss[Z] when the incoming connection was made over an SSL/TLS\ntransport layer.\n\n```\n\n**[ssl_c_notbefore](#7.3.4-ssl_c_notbefore)**: string```\nReturns the start date presented by the client as a formatted string\nYYMMDDhhmmss[Z] when the incoming connection was made over an SSL/TLS\ntransport layer.\n\n```\n\n**[ssl_c_r_dn](#7.3.4-ssl_c_r_dn)**([<entry>[,<occ>[,<format>]]]) : string```\nWhen the incoming connection was made over an SSL/TLS transport layer, and is\nsuccessfully validated with the configured ca-file, returns the full\ndistinguished name of the root CA of the certificate presented by the client\nwhen no <entry> is specified, or the value of the first given entry found from\nthe beginning of the DN. If a positive/negative occurrence number is specified\nas the optional second argument, it returns the value of the nth given entry\nvalue from the beginning/end of the DN. For instance, \"ssl_c_r_dn(OU,2)\" the\nsecond organization unit, and \"ssl_c_r_dn(CN)\" retrieves the common name. The\n<format> parameter allows you to receive the DN suitable for consumption by\ndifferent protocols. Currently supported is rfc2253 for LDAP v3. If you'd like\nto modify the format only you can specify an empty string and zero for the\nfirst two parameters. Example: ssl_c_r_dn(,0,rfc2253)\n\n```\n\n**[ssl_c_s_dn](#7.3.4-ssl_c_s_dn)**([<entry>[,<occ>[,<format>]]]) : string```\nWhen the incoming connection was made over an SSL/TLS transport layer,\nreturns the full distinguished name of the subject of the certificate\npresented by the client when no <entry> is specified, or the value of the\nfirst given entry found from the beginning of the DN. If a positive/negative\noccurrence number is specified as the optional second argument, it returns\nthe value of the nth given entry value from the beginning/end of the DN.\nFor instance, \"ssl_c_s_dn(OU,2)\" the second organization unit, and\n\"ssl_c_s_dn(CN)\" retrieves the common name.\nThe <format> parameter allows you to receive the DN suitable for\nconsumption by different protocols. Currently supported is rfc2253 for\nLDAP v3.\nIf you'd like to modify the format only you can specify an empty string\nand zero for the first two parameters. Example: ssl_c_s_dn(,0,rfc2253)\n\n```\n\n**[ssl_c_san](#7.3.4-ssl_c_san)**: string```\nWhen the incoming connection was made over an SSL/TLS transport layer, and was\nprovided with a client certificate. Returns a string of comma separated\nSubject Alt Name fields contained into the provided certificate.\n\nThis can be used to inspect the client certificate.\n\n```\n\nExample:```\n\nacl is_valid_client_cert ssl_c_used && ! ssl_c_verify\nhttp-request set-header X-SSL-Client-SAN %[ssl_c_san] if is_valid_client_cert\n\n```\n\n```\nwill results in:\n\n  X-SSL-Client-SAN: IP Address:127.0.0.1, IP Address:127.0.0.2, IP Address:127.0.0.3, URI:http://docs.haproxy.org/2.7/, DNS:ca.tests.haproxy.com\n\n```\n\n**[ssl_c_serial](#7.3.4-ssl_c_serial)**: binary```\nReturns the serial of the certificate presented by the client when the\nincoming connection was made over an SSL/TLS transport layer. When used for\nan ACL, the value(s) to match against can be passed in hexadecimal form.\n\n```\n\n**[ssl_c_sha1](#7.3.4-ssl_c_sha1)**: binary```\nReturns the SHA-1 fingerprint of the certificate presented by the client when\nthe incoming connection was made over an SSL/TLS transport layer. This can be\nused to stick a client to a server, or to pass this information to a server.\nNote that the output is binary, so if you want to pass that signature to the\nserver, you need to encode it in hex or base64, such as in the example below:\n\n```\n\nExample:```\n\nhttp-request set-header X-SSL-Client-SHA1 %[ssl_c_sha1,hex]\n\n```\n\n**[ssl_c_sig_alg](#7.3.4-ssl_c_sig_alg)**: string```\nReturns the name of the algorithm used to sign the certificate presented by\nthe client when the incoming connection was made over an SSL/TLS transport\nlayer.\n\n```\n\n**[ssl_c_used](#7.3.4-ssl_c_used)**: boolean```\nReturns true if current SSL session uses a client certificate even if current\nconnection uses SSL session resumption. See also \"ssl_fc_has_crt\".\n\n```\n\n**[ssl_c_verify](#7.3.4-ssl_c_verify)**: integer```\nReturns the verify result error ID when the incoming connection was made over\nan SSL/TLS transport layer, otherwise zero if no error is encountered. Please\nrefer to your SSL library's documentation for an exhaustive list of error\ncodes.\n\n```\n\n**[ssl_c_version](#7.3.4-ssl_c_version)**: integer```\nReturns the version of the certificate presented by the client when the\nincoming connection was made over an SSL/TLS transport layer.\n\n```\n\n**[ssl_f_der](#7.3.4-ssl_f_der)**: binary```\nReturns the DER formatted certificate presented by the frontend when the\nincoming connection was made over an SSL/TLS transport layer. When used for\nan ACL, the value(s) to match against can be passed in hexadecimal form.\n\n```\n\n**[ssl_f_i_dn](#7.3.4-ssl_f_i_dn)**([<entry>[,<occ>[,<format>]]]) : string```\nWhen the incoming connection was made over an SSL/TLS transport layer,\nreturns the full distinguished name of the issuer of the certificate\npresented by the frontend when no <entry> is specified, or the value of the\nfirst given entry found from the beginning of the DN. If a positive/negative\noccurrence number is specified as the optional second argument, it returns\nthe value of the nth given entry value from the beginning/end of the DN.\nFor instance, \"ssl_f_i_dn(OU,2)\" the second organization unit, and\n\"ssl_f_i_dn(CN)\" retrieves the common name.\nThe <format> parameter allows you to receive the DN suitable for\nconsumption by different protocols. Currently supported is rfc2253 for\nLDAP v3.\nIf you'd like to modify the format only you can specify an empty string\nand zero for the first two parameters. Example: ssl_f_i_dn(,0,rfc2253)\n\n```\n\n**[ssl_f_key_alg](#7.3.4-ssl_f_key_alg)**: string```\nReturns the name of the algorithm used to generate the key of the certificate\npresented by the frontend when the incoming connection was made over an\nSSL/TLS transport layer.\n\n```\n\n**[ssl_f_notafter](#7.3.4-ssl_f_notafter)**: string```\nReturns the end date presented by the frontend as a formatted string\nYYMMDDhhmmss[Z] when the incoming connection was made over an SSL/TLS\ntransport layer.\n\n```\n\n**[ssl_f_notbefore](#7.3.4-ssl_f_notbefore)**: string```\nReturns the start date presented by the frontend as a formatted string\nYYMMDDhhmmss[Z] when the incoming connection was made over an SSL/TLS\ntransport layer.\n\n```\n\n**[ssl_f_s_dn](#7.3.4-ssl_f_s_dn)**([<entry>[,<occ>[,<format>]]]) : string```\nWhen the incoming connection was made over an SSL/TLS transport layer,\nreturns the full distinguished name of the subject of the certificate\npresented by the frontend when no <entry> is specified, or the value of the\nfirst given entry found from the beginning of the DN. If a positive/negative\noccurrence number is specified as the optional second argument, it returns\nthe value of the nth given entry value from the beginning/end of the DN.\nFor instance, \"ssl_f_s_dn(OU,2)\" the second organization unit, and\n\"ssl_f_s_dn(CN)\" retrieves the common name.\nThe <format> parameter allows you to receive the DN suitable for\nconsumption by different protocols. Currently supported is rfc2253 for\nLDAP v3.\nIf you'd like to modify the format only you can specify an empty string\nand zero for the first two parameters. Example: ssl_f_s_dn(,0,rfc2253)\n\n```\n\n**[ssl_f_serial](#7.3.4-ssl_f_serial)**: binary```\nReturns the serial of the certificate presented by the frontend when the\nincoming connection was made over an SSL/TLS transport layer. When used for\nan ACL, the value(s) to match against can be passed in hexadecimal form.\n\n```\n\n**[ssl_f_sha1](#7.3.4-ssl_f_sha1)**: binary```\nReturns the SHA-1 fingerprint of the certificate presented by the frontend\nwhen the incoming connection was made over an SSL/TLS transport layer. This\ncan be used to know which certificate was chosen using SNI.\n\n```\n\n**[ssl_f_sig_alg](#7.3.4-ssl_f_sig_alg)**: string```\nReturns the name of the algorithm used to sign the certificate presented by\nthe frontend when the incoming connection was made over an SSL/TLS transport\nlayer.\n\n```\n\n**[ssl_f_version](#7.3.4-ssl_f_version)**: integer```\nReturns the version of the certificate presented by the frontend when the\nincoming connection was made over an SSL/TLS transport layer.\n\n```\n\n**[ssl_fc](#7.3.4-ssl_fc)**: boolean```\nReturns true when the front connection was made via an SSL/TLS transport\nlayer and is locally deciphered. This means it has matched a socket declared\nwith a \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line having the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option.\n\n```\n\nExample :```\n\n# This passes \"X-Proto: https\" to servers when client connects over SSL\nlisten http-https\n    bind :80\n    bind :443 ssl crt /etc/haproxy.pem\n    http-request add-header X-Proto https if { ssl_fc }\n\n```\n\n**[ssl_fc_alg_keysize](#7.3.4-ssl_fc_alg_keysize)**: integer```\nReturns the symmetric cipher key size supported in bits when the incoming\nconnection was made over an SSL/TLS transport layer.\n\n```\n\n**[ssl_fc_alpn](#7.3.4-ssl_fc_alpn)**: string```\nThis extracts the Application Layer Protocol Negotiation field from an\nincoming connection made via a TLS transport layer and locally deciphered by\nHAProxy. The result is a string containing the protocol name advertised by\nthe client. The SSL library must have been built with support for TLS\nextensions enabled (check haproxy -vv). Note that the TLS ALPN extension is\nnot advertised unless the \"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" keyword on the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line specifies a\nprotocol list. Also, nothing forces the client to pick a protocol from this\nlist, any other one may be requested. The TLS ALPN extension is meant to\nreplace the TLS NPN extension. See also \"ssl_fc_npn\".\n\n```\n\n**[ssl_fc_cipher](#7.3.4-ssl_fc_cipher)**: string```\nReturns the name of the used cipher when the incoming connection was made\nover an SSL/TLS transport layer.\n\n```\n\n**[ssl_fc_cipherlist_bin](#7.3.4-ssl_fc_cipherlist_bin)**([<filter_option>]) : binary```\nReturns the binary form of the client hello cipher list. The maximum\nreturned value length is limited by the shared capture buffer size\ncontrolled by \"tune.ssl.capture-buffer-size\" setting. Setting\n<filter_option> allows to filter returned data. Accepted values:\n  0 : return the full list of ciphers (default)\n  1 : exclude GREASE (RFC8701) values from the output\n\n```\n\nExample:```\n\nhttp-request set-header X-SSL-JA3 %[ssl_fc_protocol_hello_id],\\\n    %[ssl_fc_cipherlist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_extlist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_eclist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_ecformats_bin,be2dec(-,1)]\nacl is_malware req.fhdr(x-ssl-ja3),digest(md5),hex \\\n    -f /path/to/file/with/malware-ja3.lst\nhttp-request set-header X-Malware True if is_malware\nhttp-request set-header X-Malware False if !is_malware\n\n```\n\n**[ssl_fc_cipherlist_hex](#7.3.4-ssl_fc_cipherlist_hex)**([<filter_option>]) : string```\nReturns the binary form of the client hello cipher list encoded as\nhexadecimal. The maximum returned value length is limited by the shared\ncapture buffer size controlled by \"tune.ssl.capture-buffer-size\" setting.\nSetting <filter_option> allows to filter returned data. Accepted values:\n  0 : return the full list of ciphers (default)\n  1 : exclude GREASE (RFC8701) values from the output\n\n```\n\n**[ssl_fc_cipherlist_str](#7.3.4-ssl_fc_cipherlist_str)**([<filter_option>]) : string```\nReturns the decoded text form of the client hello cipher list. The maximum\nreturned value length is limited by the shared capture buffer size\ncontrolled by \"tune.ssl.capture-buffer-size\" setting. Setting\n<filter_option> allows to filter returned data. Accepted values:\n  0 : return the full list of ciphers (default)\n  1 : exclude GREASE (RFC8701) values from the output\nNote that this sample-fetch is only available with OpenSSL >= 1.0.2. If the\nfunction is not enabled, this sample-fetch returns the hash like\n\"ssl_fc_cipherlist_xxh\".\n\n```\n\n**[ssl_fc_cipherlist_xxh](#7.3.4-ssl_fc_cipherlist_xxh)**: integer```\nReturns a xxh64 of the cipher list. This hash can return only if the value\n\"tune.ssl.capture-buffer-size\" is set greater than 0, however the hash take\ninto account all the data of the cipher list.\n\n```\n\n**[ssl_fc_client_early_traffic_secret](#7.3.4-ssl_fc_client_early_traffic_secret)**: string```\nReturn the CLIENT_EARLY_TRAFFIC_SECRET as an hexadecimal string for the\nfront connection when the incoming connection was made over a TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_fc_client_handshake_traffic_secret](#7.3.4-ssl_fc_client_handshake_traffic_secret)**: string```\nReturn the CLIENT_HANDSHAKE_TRAFFIC_SECRET as an hexadecimal string for the\nfront connection when the incoming connection was made over a TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_fc_client_random](#7.3.4-ssl_fc_client_random)**: binary```\nReturns the client random of the front connection when the incoming connection\nwas made over an SSL/TLS transport layer. It is useful to to decrypt traffic\nsent using ephemeral ciphers. This requires OpenSSL >= 1.1.0, or BoringSSL.\n\n```\n\n**[ssl_fc_client_traffic_secret_0](#7.3.4-ssl_fc_client_traffic_secret_0)**: string```\nReturn the CLIENT_TRAFFIC_SECRET_0 as an hexadecimal string for the\nfront connection when the incoming connection was made over a TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_fc_curve](#7.3.4-ssl_fc_curve)**: string```\nReturns the name of the curve used in the key agreement when the incoming\nconnection was made over an SSL/TLS transport layer. This requires\nOpenSSL >= 3.0.0.\n\n```\n\n**[ssl_fc_early_rcvd](#7.3.4-ssl_fc_early_rcvd)**: boolean```\nReturns true if early data were seen over that connection, regardless of the\nfact that the handshake has since completed. It has no practical use case for\ntraffic processing, however it's about the only way to \"see\" that a client\nused 0-RTT to send early data, and is sometimes useful when debugging, since\nthe only other alternatives are network traffic captures or logging the front\nconnection's flags and matching them in the code. It may also be useful to\nget statistics on clients' capabilities. See also \"ssl_fc_has_early\".\n\n```\n\n**[ssl_fc_early_exporter_secret](#7.3.4-ssl_fc_early_exporter_secret)**: string```\nReturn the EARLY_EXPORTER_SECRET as an hexadecimal string for the\nfront connection when the incoming connection was made over an TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_fc_ecformats_bin](#7.3.4-ssl_fc_ecformats_bin)**: binary```\nReturn the binary form of the client hello supported elliptic curve point\nformats. The maximum returned value length is limited by the shared capture\nbuffer size controlled by \"tune.ssl.capture-buffer-size\" setting.\n\n```\n\nExample:```\n\nhttp-request set-header X-SSL-JA3 %[ssl_fc_protocol_hello_id],\\\n    %[ssl_fc_cipherlist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_extlist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_eclist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_ecformats_bin,be2dec(-,1)]\nacl is_malware req.fhdr(x-ssl-ja3),digest(md5),hex \\\n    -f /path/to/file/with/malware-ja3.lst\nhttp-request set-header X-Malware True if is_malware\nhttp-request set-header X-Malware False if !is_malware\n\n```\n\n**[ssl_fc_eclist_bin](#7.3.4-ssl_fc_eclist_bin)**([<filter_option>]) : binary```\nReturns the binary form of the client hello supported elliptic curves. The\nmaximum returned value length is limited by the shared capture buffer size\ncontrolled by \"tune.ssl.capture-buffer-size\" setting. Setting\n<filter_option> allows to filter returned data. Accepted values:\n  0 : return the full list of supported elliptic curves (default)\n  1 : exclude GREASE (RFC8701) values from the output\n\n```\n\nExample:```\n\nhttp-request set-header X-SSL-JA3 %[ssl_fc_protocol_hello_id],\\\n    %[ssl_fc_cipherlist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_extlist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_eclist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_ecformats_bin,be2dec(-,1)]\nacl is_malware req.fhdr(x-ssl-ja3),digest(md5),hex \\\n    -f /path/to/file/with/malware-ja3.lst\nhttp-request set-header X-Malware True if is_malware\nhttp-request set-header X-Malware False if !is_malware\n\n```\n\n**[ssl_fc_err](#7.3.4-ssl_fc_err)**: integer```\nWhen the incoming connection was made over an SSL/TLS transport layer,\nreturns the ID of the last error of the first error stack raised on the\nfrontend side, or 0 if no error was encountered. It can be used to identify\nhandshake related errors other than verify ones (such as cipher mismatch), as\nwell as other read or write errors occurring during the connection's\nlifetime.  Any error happening during the client's certificate verification\nprocess will not be raised through this fetch but via the existing\n\"ssl_c_err\", \"ssl_c_ca_err\" and \"ssl_c_ca_err_depth\" fetches. In order to get\na text description of this error code, you can either use the\n\"ssl_fc_err_str\" sample fetch or use the \"openssl errstr\" command (which\ntakes an error code in hexadecimal representation as parameter). Please refer\nto your SSL library's documentation to find the exhaustive list of error\ncodes.\n\n```\n\n**[ssl_fc_err_str](#7.3.4-ssl_fc_err_str)**: string```\nWhen the incoming connection was made over an SSL/TLS transport layer,\nreturns a string representation of the last error of the first error stack\nthat was raised on the frontend side. Any error happening during the client's\ncertificate verification process will not be raised through this fetch. See\nalso \"ssl_fc_err\".\n\n```\n\n**[ssl_fc_exporter_secret](#7.3.4-ssl_fc_exporter_secret)**: string```\nReturn the EXPORTER_SECRET as an hexadecimal string for the\nfront connection when the incoming connection was made over a TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_fc_extlist_bin](#7.3.4-ssl_fc_extlist_bin)**([<filter_option>]) : binary```\nReturns the binary form of the client hello extension list. The maximum\nreturned value length is limited by the shared capture buffer size\ncontrolled by \"tune.ssl.capture-buffer-size\" setting. Setting\n<filter_option> allows to filter returned data. Accepted values:\n  0 : return the full list of extensions (default)\n  1 : exclude GREASE (RFC8701) values from the output\n\n```\n\nExample:```\n\nhttp-request set-header X-SSL-JA3 %[ssl_fc_protocol_hello_id],\\\n    %[ssl_fc_cipherlist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_extlist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_eclist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_ecformats_bin,be2dec(-,1)]\nacl is_malware req.fhdr(x-ssl-ja3),digest(md5),hex \\\n    -f /path/to/file/with/malware-ja3.lst\nhttp-request set-header X-Malware True if is_malware\nhttp-request set-header X-Malware False if !is_malware\n\n```\n\n**[ssl_fc_has_crt](#7.3.4-ssl_fc_has_crt)**: boolean```\nReturns true if a client certificate is present in an incoming connection over\nSSL/TLS transport layer. Useful if 'verify' statement is set to 'optional'.\nNote: on SSL session resumption with Session ID or TLS ticket, client\ncertificate is not present in the current connection but may be retrieved\nfrom the cache or the ticket. So prefer \"ssl_c_used\" if you want to check if\ncurrent SSL session uses a client certificate.\n\n```\n\n**[ssl_fc_has_early](#7.3.4-ssl_fc_has_early)**: boolean```\nReturns true if early data were sent, and the handshake didn't complete yet.\nAs it has security implications, it is useful to be able to refuse those, or\nwait until the handshake completes (via the \"wait-for-handshake\" action). See\nalso \"ssl_fc_early_rcvd\".\n\n```\n\n**[ssl_fc_has_sni](#7.3.4-ssl_fc_has_sni)**: boolean```\nThis checks for the presence of a Server Name Indication TLS extension (SNI)\nin an incoming connection was made over an SSL/TLS transport layer. Returns\ntrue when the incoming connection presents a TLS SNI field. This requires\nthat the SSL library is built with support for TLS extensions enabled (check\nhaproxy -vv).\n\n```\n\n**[ssl_fc_is_resumed](#7.3.4-ssl_fc_is_resumed)**: boolean```\nReturns true if the SSL/TLS session has been resumed through the use of\nSSL session cache or TLS tickets on an incoming connection over an SSL/TLS\ntransport layer.\n\n```\n\n**[ssl_fc_npn](#7.3.4-ssl_fc_npn)**: string```\nThis extracts the Next Protocol Negotiation field from an incoming connection\nmade via a TLS transport layer and locally deciphered by HAProxy. The result\nis a string containing the protocol name advertised by the client. The SSL\nlibrary must have been built with support for TLS extensions enabled (check\nhaproxy -vv). Note that the TLS NPN extension is not advertised unless the\n\"npnThis keyword is available in sections :Bind optionsServer and default-server options\" keyword on the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line specifies a protocol list. Also, nothing\nforces the client to pick a protocol from this list, any other one may be\nrequested. Please note that the TLS NPN extension was replaced with ALPN.\n\n```\n\n**[ssl_fc_protocol](#7.3.4-ssl_fc_protocol)**: string```\nReturns the name of the used protocol when the incoming connection was made\nover an SSL/TLS transport layer.\n\n```\n\n**[ssl_fc_protocol_hello_id](#7.3.4-ssl_fc_protocol_hello_id)**: integer```\nThe version of the TLS protocol by which the client wishes to communicate\nduring the session as indicated in client hello message. This value can\nreturn only if the value \"tune.ssl.capture-buffer-size\" is set greater than\n0.\n\n```\n\nExample:```\n\nhttp-request set-header X-SSL-JA3 %[ssl_fc_protocol_hello_id],\\\n    %[ssl_fc_cipherlist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_extlist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_eclist_bin(1),be2dec(-,2)],\\\n    %[ssl_fc_ecformats_bin,be2dec(-,1)]\nacl is_malware req.fhdr(x-ssl-ja3),digest(md5),hex \\\n    -f /path/to/file/with/malware-ja3.lst\nhttp-request set-header X-Malware True if is_malware\nhttp-request set-header X-Malware False if !is_malware\n\n```\n\n**[ssl_fc_server_handshake_traffic_secret](#7.3.4-ssl_fc_server_handshake_traffic_secret)**: string```\nReturn the SERVER_HANDSHAKE_TRAFFIC_SECRET as an hexadecimal string for the\nfront connection when the incoming connection was made over a TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_fc_server_random](#7.3.4-ssl_fc_server_random)**: binary```\nReturns the server random of the front connection when the incoming connection\nwas made over an SSL/TLS transport layer. It is useful to to decrypt traffic\nsent using ephemeral ciphers. This requires OpenSSL >= 1.1.0, or BoringSSL.\n\n```\n\n**[ssl_fc_server_traffic_secret_0](#7.3.4-ssl_fc_server_traffic_secret_0)**: string```\nReturn the SERVER_TRAFFIC_SECRET_0 as an hexadecimal string for the\nfront connection when the incoming connection was made over an TLS 1.3\ntransport layer.\nRequire OpenSSL >= 1.1.1. This is one of the keys dumped by the OpenSSL\nkeylog callback to generate the SSLKEYLOGFILE. The SSL Key logging must be\nactivated with \"tune.ssl.keylog on\" in the global section. See also\n\"tune.ssl.keylog\"\n\n```\n\n**[ssl_fc_session_id](#7.3.4-ssl_fc_session_id)**: binary```\nReturns the SSL ID of the front connection when the incoming connection was\nmade over an SSL/TLS transport layer. It is useful to stick a given client to\na server. It is important to note that some browsers refresh their session ID\nevery few minutes.\n\n```\n\n**[ssl_fc_session_key](#7.3.4-ssl_fc_session_key)**: binary```\nReturns the SSL session master key of the front connection when the incoming\nconnection was made over an SSL/TLS transport layer. It is useful to decrypt\ntraffic sent using ephemeral ciphers. This requires OpenSSL >= 1.1.0, or\nBoringSSL.\n\n```\n\n**[ssl_fc_sigalgs_bin](#7.3.4-ssl_fc_sigalgs_bin)**([<filter_option>]) : binary```\nReturns the content of the signatures_algorithms (13) TLS extension presented\nduring the Client Hello. It provides a binary list of 2-bytes algorithms\ndefined in the TLS RFC: https://datatracker.ietf.org/doc/html/rfc8446#section-4.2.3.\n\nThis value can return only if the value \"tune.ssl.capture-buffer-size\" is set\ngreater than 0. Setting <filter_option> allows to filter returned data.\nAccepted values:\n0 : return the full list of ciphers (default)\n1 : exclude GREASE (RFC8701) values from the output\n\n```\n\n**[ssl_fc_sni](#7.3.4-ssl_fc_sni)**: string```\nThis extracts the Server Name Indication TLS extension (SNI) field from an\nincoming connection made via an SSL/TLS transport layer and locally\ndeciphered by HAProxy. The result (when present) typically is a string\nmatching the HTTPS host name (253 chars or less). The SSL library must have\nbeen built with support for TLS extensions enabled (check haproxy -vv).\n\nThis fetch is different from \"req.ssl_sni\" above in that it applies to the\nconnection being deciphered by HAProxy and not to SSL contents being blindly\nforwarded. See also \"ssl_fc_sni_end\" and \"ssl_fc_sni_reg\" below. This\nrequires that the SSL library is built with support for TLS extensions\nenabled (check haproxy -vv).\n\nCAUTION! Except under very specific conditions, it is normally not correct to\nuse this field as a substitute for the HTTP \"Host\" header field. For example,\nwhen forwarding an HTTPS connection to a server, the SNI field must be set\nfrom the HTTP Host header field using \"req.hdr(host)\" and not from the front\nSNI value. The reason is that SNI is solely used to select the certificate\nthe server side will present, and that clients are then allowed to send\nrequests with different Host values as long as they match the names in the\ncertificate. As such, \"ssl_fc_sni\" should normally not be used as an argument\nto the \"sni\" server keyword, unless the backend works in TCP mode.\n\nACL derivatives :\n  ssl_fc_sni_end : suffix match\n  ssl_fc_sni_reg : regex match\n\n```\n\n**[ssl_fc_supported_versions_bin](#7.3.4-ssl_fc_supported_versions_bin)**([<filter_option>]) : binary```\nReturns the content of the supported_versions (43) TLS extension presented\nduring the Client Hello. It provides a binary list of 2-bytes versions.\nTLSv1.3 (0x0304), TLSv1.2 (0x0303).\n\nThis value can return only if the value \"tune.ssl.capture-buffer-size\" is set\ngreater than 0. Setting <filter_option> allows to filter returned data.\nAccepted values:\n0 : return the full list of ciphers (default)\n1 : exclude GREASE (RFC8701) values from the output\n\n```\n\n**[ssl_fc_unique_id](#7.3.4-ssl_fc_unique_id)**: binary```\nWhen the incoming connection was made over an SSL/TLS transport layer,\nreturns the TLS unique ID as defined in RFC5929 section 3. The unique id\ncan be encoded to base64 using the converter: \"ssl_fc_unique_id,base64\".\n\n```\n\n**[ssl_fc_use_keysize](#7.3.4-ssl_fc_use_keysize)**: integer```\nReturns the symmetric cipher key size used in bits when the incoming\nconnection was made over an SSL/TLS transport layer.\n\n```\n\n**[ssl_s_chain_der](#7.3.4-ssl_s_chain_der)**: binary```\nReturns the DER formatted chain certificate presented by the server when the\noutgoing connection was made over an SSL/TLS transport layer. When used for\nan ACL, the value(s) to match against can be passed in hexadecimal form. One\ncan parse the result with any lib accepting ASN.1 DER data. It currently\ndoes not support resumed sessions.\n\n```\n\n**[ssl_s_der](#7.3.4-ssl_s_der)**: binary```\nReturns the DER formatted certificate presented by the server when the\noutgoing connection was made over an SSL/TLS transport layer. When used for\nan ACL, the value(s) to match against can be passed in hexadecimal form.\n\n```\n\n**[ssl_s_i_dn](#7.3.4-ssl_s_i_dn)**([<entry>[,<occ>[,<format>]]]) : string```\nWhen the outgoing connection was made over an SSL/TLS transport layer,\nreturns the full distinguished name of the issuer of the certificate\npresented by the server when no <entry> is specified, or the value of the\nfirst given entry found from the beginning of the DN. If a positive/negative\noccurrence number is specified as the optional second argument, it returns\nthe value of the nth given entry value from the beginning/end of the DN.\nFor instance, \"ssl_s_i_dn(OU,2)\" the second organization unit, and\n\"ssl_s_i_dn(CN)\" retrieves the common name.\nThe <format> parameter allows you to receive the DN suitable for\nconsumption by different protocols. Currently supported is rfc2253 for\nLDAP v3.\nIf you'd like to modify the format only you can specify an empty string\nand zero for the first two parameters. Example: ssl_s_i_dn(,0,rfc2253)\n\n```\n\n**[ssl_s_key_alg](#7.3.4-ssl_s_key_alg)**: string```\nReturns the name of the algorithm used to generate the key of the certificate\npresented by the server when the outgoing connection was made over an\nSSL/TLS transport layer.\n\n```\n\n**[ssl_s_notafter](#7.3.4-ssl_s_notafter)**: string```\nReturns the end date presented by the server as a formatted string\nYYMMDDhhmmss[Z] when the outgoing connection was made over an SSL/TLS\ntransport layer.\n\n```\n\n**[ssl_s_notbefore](#7.3.4-ssl_s_notbefore)**: string```\nReturns the start date presented by the server as a formatted string\nYYMMDDhhmmss[Z] when the outgoing connection was made over an SSL/TLS\ntransport layer.\n\n```\n\n**[ssl_s_s_dn](#7.3.4-ssl_s_s_dn)**([<entry>[,<occ>[,<format>]]]) : string```\nWhen the outgoing connection was made over an SSL/TLS transport layer,\nreturns the full distinguished name of the subject of the certificate\npresented by the server when no <entry> is specified, or the value of the\nfirst given entry found from the beginning of the DN. If a positive/negative\noccurrence number is specified as the optional second argument, it returns\nthe value of the nth given entry value from the beginning/end of the DN.\nFor instance, \"ssl_s_s_dn(OU,2)\" the second organization unit, and\n\"ssl_s_s_dn(CN)\" retrieves the common name.\nThe <format> parameter allows you to receive the DN suitable for\nconsumption by different protocols. Currently supported is rfc2253 for\nLDAP v3.\nIf you'd like to modify the format only you can specify an empty string\nand zero for the first two parameters. Example: ssl_s_s_dn(,0,rfc2253)\n\n```\n\n**[ssl_s_serial](#7.3.4-ssl_s_serial)**: binary```\nReturns the serial of the certificate presented by the server when the\noutgoing connection was made over an SSL/TLS transport layer. When used for\nan ACL, the value(s) to match against can be passed in hexadecimal form.\n\n```\n\n**[ssl_s_sha1](#7.3.4-ssl_s_sha1)**: binary```\nReturns the SHA-1 fingerprint of the certificate presented by the server\nwhen the outgoing connection was made over an SSL/TLS transport layer. This\ncan be used to know which certificate was chosen using SNI.\n\n```\n\n**[ssl_s_sig_alg](#7.3.4-ssl_s_sig_alg)**: string```\nReturns the name of the algorithm used to sign the certificate presented by\nthe server when the outgoing connection was made over an SSL/TLS transport\nlayer.\n\n```\n\n**[ssl_s_version](#7.3.4-ssl_s_version)**: integer```\nReturns the version of the certificate presented by the server when the\noutgoing connection was made over an SSL/TLS transport layer.\n\n```\n\n**[txn.timer.user](#7.3.4-txn.timer.user)**: integer```\nTotal estimated time as seen from client, between the moment the proxy\naccepted it and the moment both ends were closed, without idle time.\nThis is the equivalent of %Tu in the log-format and is reported in\nmilliseconds (ms). For more details see Section 8.4 \"Timing events\"\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.3.5. Fetching samples from buffer contents (Layer 6)", "content": "### [7.3.5.](#7.3.5)Fetching samples from buffer contents (Layer 6)\n\n```\nFetching samples from buffer contents is a bit different from the previous\nsample fetches above because the sampled data are ephemeral. These data can\nonly be used when they're available and will be lost when they're forwarded.\nFor this reason, samples fetched from buffer contents during a request cannot\nbe used in a response for example. Even while the data are being fetched, they\ncan change. Sometimes it is necessary to set some delays or combine multiple\nsample fetch methods to ensure that the expected data are complete and usable,\nfor example through TCP request content inspection. Please see the \"tcp-request\ncontent\" keyword for more detailed information on the subject.\n\nWarning : Following sample fetches are ignored if used from HTTP proxies. They\n          only deal with raw contents found in the buffers. On their side,\n          HTTP proxies use structured content. Thus raw representation of\n          these data are meaningless. A warning is emitted if an ACL relies on\n          one of the following sample fetches. But it is not possible to detect\n          all invalid usage (for instance inside a Custom log format or a\n          sample expression). So be careful.\n\nSummary of sample fetch methods in this section and their respective types:\n\n```\n\nkeywordoutput type[distcc_body(<token>[,<occ>])](#7-distcc_body)binary[distcc_param(<token>[,<occ>])](#7-distcc_param)integer[payload(<offset>,<length>)](#7-payload)binary[payload_lv(<offset1>,<length>[,<offset2>])](#7-payload_lv)binary[rdp_cookie([<name>])](#7-rdp_cookie)string[rdp_cookie_cnt([name])](#7-rdp_cookie_cnt)integer[rep_ssl_hello_type](#7-rep_ssl_hello_type)integer[req.len](#7-req.len)integer[req.payload(<offset>,<length>)](#7-req.payload)binary[req.payload_lv(<offset1>,<length>[,<offset2>])](#7-req.payload_lv)binary[req.proto_http](#7-req.proto_http)boolean[req.rdp_cookie([<name>])](#7-req.rdp_cookie)string[req.rdp_cookie_cnt([name])](#7-req.rdp_cookie_cnt)integer[req.ssl_alpn](#7-req.ssl_alpn)string[req.ssl_cipherlist](#7-req.ssl_cipherlist)binary[req.ssl_ec_ext](#7-req.ssl_ec_ext)boolean[req.ssl_hello_type](#7-req.ssl_hello_type)integer[req.ssl_keyshare_groups](#7-req.ssl_keyshare_groups)binary[req.ssl_sigalgs](#7-req.ssl_sigalgs)binary[req.ssl_sni](#7-req.ssl_sni)string[req.ssl_st_ext](#7-req.ssl_st_ext)integer[req.ssl_supported_groups](#7-req.ssl_supported_groups)binary[req.ssl_ver](#7-req.ssl_ver)integer[req_len](#7-req_len)integer[req_proto_http](#7-req_proto_http)boolean[req_ssl_hello_type](#7-req_ssl_hello_type)integer[req_ssl_sni](#7-req_ssl_sni)string[req_ssl_ver](#7-req_ssl_ver)integer[res.len](#7-res.len)integer[res.payload(<offset>,<length>)](#7-res.payload)binary[res.payload_lv(<offset1>,<length>[,<offset2>])](#7-res.payload_lv)binary[res.ssl_hello_type](#7-res.ssl_hello_type)integer```\nDetailed list:\n\n```\n\n**[distcc_body](#7.3.5-distcc_body)**(<token>[,<occ>]) : binary```\nParses a distcc message and returns the body associated to occurrence #<occ>\nof the token <token>. Occurrences start at 1, and when unspecified, any may\nmatch though in practice only the first one is checked for now. This can be\nused to extract file names or arguments in files built using distcc through\nHAProxy. Please refer to distcc's protocol documentation for the complete\nlist of supported tokens.\n\n```\n\n**[distcc_param](#7.3.5-distcc_param)**(<token>[,<occ>]) : integer```\nParses a distcc message and returns the parameter associated to occurrence\n#<occ> of the token <token>. Occurrences start at 1, and when unspecified,\nany may match though in practice only the first one is checked for now. This\ncan be used to extract certain information such as the protocol version, the\nfile size or the argument in files built using distcc through HAProxy.\nAnother use case consists in waiting for the start of the preprocessed file\ncontents before connecting to the server to avoid keeping idle connections.\nPlease refer to distcc's protocol documentation for the complete list of\nsupported tokens.\n\n```\n\nExample :```\n\n# wait up to 20s for the pre-processed file to be uploaded\ntcp-request inspect-delay 20s\ntcp-request content accept if { distcc_param(DOTI) -m found }\n# send large files to the big farm\nuse_backend big_farm if { distcc_param(DOTI) gt 1000000 }\n\n```\n\n**[payload](#7.3.5-payload)**(<offset>,<length>) : binary(deprecated)```\nThis is an alias for \"req.payload\" when used in the context of a request (e.g.\n\"stick on\", \"stick match\"), and for \"res.payload\" when used in the context of\na response such as in \"stick store response\".\n\n```\n\n**[payload_lv](#7.3.5-payload_lv)**(<offset1>,<length>[,<offset2>]) : binary(deprecated)```\nThis is an alias for \"req.payload_lv\" when used in the context of a request\n(e.g. \"stick on\", \"stick match\"), and for \"res.payload_lv\" when used in the\ncontext of a response such as in \"stick store response\".\n\n```\n\n**[req.len](#7.3.5-req.len)**: integer**[req_len](#7.3.5-req_len)**: integer(deprecated)```\nReturns an integer value corresponding to the number of bytes present in the\nrequest buffer. This is mostly used in ACL. It is important to understand\nthat this test does not return false as long as the buffer is changing. This\nmeans that a check with equality to zero will almost always immediately match\nat the beginning of the session, while a test for more data will wait for\nthat data to come in and return false only when HAProxy is certain that no\nmore data will come in. This test was designed to be used with TCP request\ncontent inspection.\n\n```\n\n**[req.payload](#7.3.5-req.payload)**(<offset>,<length>) : binary```\nThis extracts a binary block of <length> bytes and starting at byte <offset>\nin the request buffer. As a special case, if the <length> argument is zero,\nthe the whole buffer from <offset> to the end is extracted. This can be used\nwith ACLs in order to check for the presence of some content in a buffer at\nany location.\n\nACL derivatives :\n  req.payload(<offset>,<length>) : hex binary match\n\n```\n\n**[req.payload_lv](#7.3.5-req.payload_lv)**(<offset1>,<length>[,<offset2>]) : binary```\nThis extracts a binary block whose size is specified at <offset1> for <length>\nbytes, and which starts at <offset2> if specified or just after the length in\nthe request buffer. The <offset2> parameter also supports relative offsets if\nprepended with a '+' or '-' sign.\n\nACL derivatives :\n  req.payload_lv(<offset1>,<length>[,<offset2>]) : hex binary match\n\n```\n\nExample :```\n\nplease consult the example from the \"stick store-response\" keyword.\n```\n\n**[req.proto_http](#7.3.5-req.proto_http)**: boolean**[req_proto_http](#7.3.5-req_proto_http)**: boolean(deprecated)```\nReturns true when data in the request buffer look like HTTP and correctly\nparses as such. It is the same parser as the common HTTP request parser which\nis used so there should be no surprises. The test does not match until the\nrequest is complete, failed or timed out. This test may be used to report the\nprotocol in TCP logs, but the biggest use is to block TCP request analysis\nuntil a complete HTTP request is present in the buffer, for example to track\na header.\n\n```\n\nExample:```\n\n# track request counts per \"base\" (concatenation of Host+URL)\ntcp-request inspect-delay 10s\ntcp-request content reject if !HTTP\ntcp-request content track-sc0 base table req-rate\n\n```\n\n**[req.rdp_cookie](#7.3.5-req.rdp_cookie)**([<name>]) : string**[rdp_cookie](#7.3.5-rdp_cookie)**([<name>]) : string(deprecated)```\nWhen the request buffer looks like the RDP protocol, extracts the RDP cookie\n<name>, or any cookie if unspecified. The parser only checks for the first\ncookie, as illustrated in the RDP protocol specification. The cookie name is\ncase insensitive. Generally the \"MSTS\" cookie name will be used, as it can\ncontain the user name of the client connecting to the server if properly\nconfigured on the client. The \"MSTSHASH\" cookie is often used as well for\nsession stickiness to servers.\n\nThis differs from \"balance rdp-cookie\" in that any balancing algorithm may be\nused and thus the distribution of clients to backend servers is not linked to\na hash of the RDP cookie. It is envisaged that using a balancing algorithm\nsuch as \"balance roundrobin\" or \"balance leastconn\" will lead to a more even\ndistribution of clients to backend servers than the hash used by \"balance\nrdp-cookie\".\n\nACL derivatives :\n  req.rdp_cookie([<name>]) : exact string match\n\n```\n\nExample :```\n\nlisten tse-farm\n    bind 0.0.0.0:3389\n    # wait up to 5s for an RDP cookie in the request\n    tcp-request inspect-delay 5s\n    tcp-request content accept if RDP_COOKIE\n    # apply RDP cookie persistence\n    persist rdp-cookie\n    # Persist based on the mstshash cookie\n    # This is only useful makes sense if\n    # balance rdp-cookie is not used\n    stick-table type string size 204800\n    stick on req.rdp_cookie(mstshash)\n    server srv1 1.1.1.1:3389\n    server srv1 1.1.1.2:3389\n\n```\n\n**See also :**\"balance rdp-cookie\", \"[persist rdp-cookie](#persist%20rdp-cookie)\", \"[tcp-request](#tcp-request)\" and the \"[req.rdp_cookie](#req.rdp_cookie)\" ACL.**[req.rdp_cookie_cnt](#7.3.5-req.rdp_cookie_cnt)**([name]) : integer**[rdp_cookie_cnt](#7.3.5-rdp_cookie_cnt)**([name]) : integer(deprecated)```\nTries to parse the request buffer as RDP protocol, then returns an integer\ncorresponding to the number of RDP cookies found. If an optional cookie name\nis passed, only cookies matching this name are considered. This is mostly\nused in ACL.\n\nACL derivatives :\n  req.rdp_cookie_cnt([<name>]) : integer match\n\n```\n\n**[req.ssl_alpn](#7.3.5-req.ssl_alpn)**: string```\nReturns a string containing the values of the Application-Layer Protocol\nNegotiation (ALPN) TLS extension (RFC7301), sent by the client within the SSL\nClientHello message. Note that this only applies to raw contents found in the\nrequest buffer and not to the contents deciphered via an SSL data layer, so\nthis will not work with \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines having the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option. This is useful\nin ACL to make a routing decision based upon the ALPN preferences of a TLS\nclient, like in the example below. See also \"ssl_fc_alpn\".\n\n```\n\nExamples :```\n\n# Wait for a client hello for at most 5 seconds\ntcp-request inspect-delay 5s\ntcp-request content accept if { req.ssl_hello_type 1 }\nuse_backend bk_acme if { req.ssl_alpn acme-tls/1 }\ndefault_backend bk_default\n\n```\n\n**[req.ssl_cipherlist binary](#7.3.5-req.ssl_cipherlist%20binary)**```\nReturns the binary form of the list of symmetric cipher options supported by\nthe client as reported in the contents of a TLS ClientHello. Note that this\nonly applies to raw contents found in the request buffer and not to contents\ndeciphered via an SSL data layer, so this will not work with \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines\nhaving the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option. Refer to \"ssl_fc_cipherlist_bin\" which is the SSL\nbind equivalent that can be used when the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option is specified.\n\n```\n\nExamples :```\n\n# Wait for a client hello for at most 5 seconds\ntcp-request inspect-delay 5s\ntcp-request content accept if { req.ssl_hello_type 1 }\nuse-server fe3 if { req.ssl_cipherlist,be2hex(:,2),lower -m sub 1302:009f }\nserver fe3  ${htst_fe3_addr}:${htst_fe3_port}\n\n```\n\n**[req.ssl_ec_ext](#7.3.5-req.ssl_ec_ext)**: boolean```\nReturns a boolean identifying if client sent the Supported Elliptic Curves\nExtension as defined in RFC4492, section 5.1. within the SSL ClientHello\nmessage. This can be used to present ECC compatible clients with EC\ncertificate and to use RSA for all others, on the same IP address. Note that\nthis only applies to raw contents found in the request buffer and not to\ncontents deciphered via an SSL data layer, so this will not work with \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\"\nlines having the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option.\n\n```\n\n**[req.ssl_hello_type](#7.3.5-req.ssl_hello_type)**: integer**[req_ssl_hello_type](#7.3.5-req_ssl_hello_type)**: integer(deprecated)```\nReturns an integer value containing the type of the SSL hello message found\nin the request buffer if the buffer contains data that parse as a complete\nSSL (v3 or superior) client hello message. Note that this only applies to raw\ncontents found in the request buffer and not to contents deciphered via an\nSSL data layer, so this will not work with \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines having the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\"\noption. This is mostly used in ACL to detect presence of an SSL hello message\nthat is supposed to contain an SSL session ID usable for stickiness.\n\n```\n\n**[req.ssl_keyshare_groups binary](#7.3.5-req.ssl_keyshare_groups%20binary)**```\nReturn the binary format of the list of cryptographic parameters for key exchange\nsupported by the client as reported in the TLS ClientHello. In TLS v1.3, keyshare\nis part of the ClientHello message and is the final client hello extension. Note\nthat this only applies to raw contents found in the request buffer and not to\ncontents deciphered via an  SSL data layer, so this will not work with \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\"\nlines having the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option.\n\n```\n\nExamples :```\n\n# Wait for a client hello for at most 5 seconds\ntcp-request inspect-delay 5s\ntcp-request content accept if { req.ssl_hello_type 1 }\nuse-server fe3 if { req.ssl_keyshare_groups,be2hex(:,2),lower -m sub 001d  }\nserver fe3  ${htst_fe3_addr}:${htst_fe3_port}\n\n```\n\n**[req.ssl_sigalgs binary](#7.3.5-req.ssl_sigalgs%20binary)**```\nReturns the binary form of the list of signature algorithms supported by the\nclient as reported in the TLS ClientHello. This is available as a client hello\nextension. Note that this only applies to raw contents found in the request\nbuffer and not to contents deciphered via an SSL data layer, so this will not\nwork with \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines having the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option. Refer to \"ssl_fc_sigalgs_bin\"\nwhich is the SSL bind equivalent that can be used when the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option is\nspecified.\n\n```\n\nExamples :```\n\n# Wait for a client hello for at most 5 seconds\ntcp-request inspect-delay 5s\ntcp-request content accept if { req.ssl_hello_type 1 }\nuse-server fe4 if { req.ssl_sigalgs,be2hex(:,2),lower -m sub 0403:0805 }\nserver fe4  ${htst_fe4_addr}:${htst_fe4_port}\n\n```\n\n**[req.ssl_sni](#7.3.5-req.ssl_sni)**: string**[req_ssl_sni](#7.3.5-req_ssl_sni)**: string(deprecated)```\nReturns a string containing the value of the Server Name TLS extension sent\nby a client in a TLS stream passing through the request buffer if the buffer\ncontains data that parse as a complete SSL (v3 or superior) client hello\nmessage. Note that this only applies to raw contents found in the request\nbuffer and not to contents deciphered via an SSL data layer, so this will not\nwork with \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines having the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option. This will only work for actual\nimplicit TLS based protocols like HTTPS (443), IMAPS (993), SMTPS (465),\nhowever it will not work for explicit TLS based protocols, like SMTP (25/587)\nor IMAP (143). SNI normally contains the name of the host the client tries to\nconnect to (for recent browsers). SNI is useful for allowing or denying access\nto certain hosts when SSL/TLS is used by the client. This test was designed to\nbe used with TCP request content inspection. If content switching is needed,\nit is recommended to first wait for a complete client hello (type 1), like in\nthe example below. See also \"ssl_fc_sni\".\n\nACL derivatives :\n  req.ssl_sni : exact string match\n\n```\n\nExamples :```\n\n# Wait for a client hello for at most 5 seconds\ntcp-request inspect-delay 5s\ntcp-request content accept if { req.ssl_hello_type 1 }\nuse_backend bk_allow if { req.ssl_sni -f allowed_sites }\ndefault_backend bk_sorry_page\n\n```\n\n**[req.ssl_st_ext](#7.3.5-req.ssl_st_ext)**: integer```\nReturns 0 if the client didn't send a SessionTicket TLS Extension (RFC5077)\nReturns 1 if the client sent SessionTicket TLS Extension\nReturns 2 if the client also sent non-zero length TLS SessionTicket\nNote that this only applies to raw contents found in the request buffer and\nnot to contents deciphered via an SSL data layer, so this will not work with\n\"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines having the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option. This can for example be used to detect\nwhether the client sent a SessionTicket or not and stick it accordingly, if\nno SessionTicket then stick on SessionID or don't stick as there's no server\nside state is there when SessionTickets are in use.\n\n```\n\n**[req.ssl_supported_groups binary](#7.3.5-req.ssl_supported_groups%20binary)**```\nReturns the binary form of the list of supported groups supported by the client\nas reported in the TLS ClientHello and used for key exchange which can include\nboth elliptic curve and non-EC key exchange. Note that this only applies to raw\ncontents found in the request buffer and not to contents deciphered via an SSL\ndata layer, so this will not  work with \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines having the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option.\nRefer to \"ssl_fc_eclist_bin\" which is the SSL bind equivalent that can be used\nwhen the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option is specified.\n\n```\n\nExamples :```\n\n# Wait for a client hello for at most 5 seconds\ntcp-request inspect-delay 5s\ntcp-request content accept if { req.ssl_hello_type 1 }\nuse-server fe3 if { req.ssl_supported_groups, be2hex(:,2),lower -m sub 0017 }\nserver fe3  ${htst_fe3_addr}:${htst_fe3_port}\n\n```\n\n**[req.ssl_ver](#7.3.5-req.ssl_ver)**: integer**[req_ssl_ver](#7.3.5-req_ssl_ver)**: integer(deprecated)```\nReturns an integer value containing the version of the SSL/TLS protocol of a\nstream present in the request buffer. Both SSLv2 hello messages and SSLv3\nmessages are supported. TLSv1 is announced as SSL version 3.1. The value is\ncomposed of the major version multiplied by 65536, added to the minor\nversion. Note that this only applies to raw contents found in the request\nbuffer and not to contents deciphered via an SSL data layer, so this will not\nwork with \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" lines having the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\" option. The ACL version of the test\nmatches against a decimal notation in the form MAJOR.MINOR (e.g. 3.1). This\nfetch is mostly used in ACL.\n\nACL derivatives :\n  req.ssl_ver : decimal match\n\n```\n\n**[res.len](#7.3.5-res.len)**: integer```\nReturns an integer value corresponding to the number of bytes present in the\nresponse buffer. This is mostly used in ACL. It is important to understand\nthat this test does not return false as long as the buffer is changing. This\nmeans that a check with equality to zero will almost always immediately match\nat the beginning of the stream, while a test for more data will wait for\nthat data to come in and return false only when HAProxy is certain that no\nmore data will come in. This test was designed to be used with TCP response\ncontent inspection. But it may also be used in tcp-check based expect rules.\n\n```\n\n**[res.payload](#7.3.5-res.payload)**(<offset>,<length>) : binary```\nThis extracts a binary block of <length> bytes and starting at byte <offset>\nin the response buffer. As a special case, if the <length> argument is zero,\nthe whole buffer from <offset> to the end is extracted. This can be used\nwith ACLs in order to check for the presence of some content in a buffer at\nany location. It may also be used in tcp-check based expect rules.\n\n```\n\n**[res.payload_lv](#7.3.5-res.payload_lv)**(<offset1>,<length>[,<offset2>]) : binary```\nThis extracts a binary block whose size is specified at <offset1> for <length>\nbytes, and which starts at <offset2> if specified or just after the length in\nthe response buffer. The <offset2> parameter also supports relative offsets\nif prepended with a '+' or '-' sign. It may also be used in tcp-check based\nexpect rules.\n\n```\n\nExample :```\n\nplease consult the example from the \"stick store-response\" keyword.\n```\n\n**[res.ssl_hello_type](#7.3.5-res.ssl_hello_type)**: integer**[rep_ssl_hello_type](#7.3.5-rep_ssl_hello_type)**: integer(deprecated)```\nReturns an integer value containing the type of the SSL hello message found\nin the response buffer if the buffer contains data that parses as a complete\nSSL (v3 or superior) hello message. Note that this only applies to raw\ncontents found in the response buffer and not to contents deciphered via an\nSSL data layer, so this will not work with \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" lines having the \"sslThis keyword is available in sections :Bind optionsServer and default-server options\"\noption. This is mostly used in ACL to detect presence of an SSL hello message\nthat is supposed to contain an SSL session ID usable for stickiness.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.3.6. Fetching HTTP samples (Layer 7)", "content": "### [7.3.6.](#7.3.6)Fetching HTTP samples (Layer 7)\n\n```\nIt is possible to fetch samples from HTTP contents, requests and responses.\nThis application layer is also called layer 7. It is only possible to fetch the\ndata in this section when a full HTTP request or response has been parsed from\nits respective request or response buffer. This is always the case with all\nHTTP specific rules and for sections running with \"mode http\". When using TCP\ncontent inspection, it may be necessary to support an inspection delay in order\nto let the request or response come in first. These fetches may require a bit\nmore CPU resources than the layer 4 ones, but not much since the request and\nresponse are indexed.\n\nNote : Regarding HTTP processing from the tcp-request content rules, everything\n       will work as expected from an HTTP proxy. However, from a TCP proxy,\n       without an HTTP upgrade, it will only work for HTTP/1 content. For\n       HTTP/2 content, only the preface is visible. Thus, it is only possible\n       to rely to \"req.proto_http\", \"req.ver\" and eventually \"method\" sample\n       fetches. All other L7 sample fetches will fail. After an HTTP upgrade,\n       they will work in the same manner than from an HTTP proxy.\n\nSummary of sample fetch methods in this section and their respective types:\n\n```\n\nkeywordoutput type[base](#7-base)string[base32](#7-base32)integer[base32+src](#7-base32%2Bsrc)binary[baseq](#7-baseq)string[capture.req.hdr(<idx>)](#7-capture.req.hdr)string[capture.req.method](#7-capture.req.method)string[capture.req.uri](#7-capture.req.uri)string[capture.req.ver](#7-capture.req.ver)string[capture.res.hdr(<idx>)](#7-capture.res.hdr)string[capture.res.ver](#7-capture.res.ver)string[cook([<name>])](#7-cook)string[cook_cnt([<name>])](#7-cook_cnt)integer[cook_val([<name>])](#7-cook_val)integer[cookie([<name>])](#7-cookie)string[hdr([<name>[,<occ>]])](#7-hdr)string[hdr_cnt([<header>])](#7-hdr_cnt)integer[hdr_ip([<name>[,<occ>]])](#7-hdr_ip)ip[hdr_val([<name>[,<occ>]])](#7-hdr_val)integer[http_auth(<userlist>)](#7-http_auth)boolean[http_auth_bearer([<header>])](#7-http_auth_bearer)stringkeywordoutput type[http_auth_group(<userlist>)](#7-http_auth_group)string[http_auth_pass](#7-http_auth_pass)string[http_auth_type](#7-http_auth_type)string[http_auth_user](#7-http_auth_user)string[http_first_req](#7-http_first_req)boolean[method](#7-method)integer[path](#7-path)string[pathq](#7-pathq)string[query([<options>])](#7-query)string[req.body](#7-req.body)binary[req.body_len](#7-req.body_len)integer[req.body_param([<name>[,i]])](#7-req.body_param)string[req.body_size](#7-req.body_size)integer[req.cook([<name>])](#7-req.cook)string[req.cook_cnt([<name>])](#7-req.cook_cnt)integer[req.cook_names([<delim>])](#7-req.cook_names)string[req.cook_val([<name>])](#7-req.cook_val)integer[req.fhdr(<name>[,<occ>])](#7-req.fhdr)string[req.fhdr_cnt([<name>])](#7-req.fhdr_cnt)integer[req.hdr([<name>[,<occ>]])](#7-req.hdr)stringkeywordoutput type[req.hdr_cnt([<name>])](#7-req.hdr_cnt)integer[req.hdr_ip([<name>[,<occ>]])](#7-req.hdr_ip)ip[req.hdr_names([<delim>])](#7-req.hdr_names)string[req.hdr_val([<name>[,<occ>]])](#7-req.hdr_val)integer[req.hdrs](#7-req.hdrs)string[req.hdrs_bin](#7-req.hdrs_bin)binary[req.timer.hdr](#7-req.timer.hdr)integer[req.timer.idle](#7-req.timer.idle)integer[req.timer.queue](#7-req.timer.queue)integer[req.timer.tq](#7-req.timer.tq)integer[req.ver](#7-req.ver)string[req_ver](#7-req_ver)string[request_date([<unit>])](#7-request_date)integer[res.body](#7-res.body)binary[res.body_len](#7-res.body_len)integer[res.body_size](#7-res.body_size)integer[res.cache_hit](#7-res.cache_hit)boolean[res.cache_name](#7-res.cache_name)string[res.comp](#7-res.comp)boolean[res.comp_algo](#7-res.comp_algo)stringkeywordoutput type[res.cook([<name>])](#7-res.cook)string[res.cook_cnt([<name>])](#7-res.cook_cnt)integer[res.cook_names([<delim>])](#7-res.cook_names)string[res.cook_val([<name>])](#7-res.cook_val)integer[res.fhdr([<name>[,<occ>]])](#7-res.fhdr)string[res.fhdr_cnt([<name>])](#7-res.fhdr_cnt)integer[res.hdr([<name>[,<occ>]])](#7-res.hdr)string[res.hdr_cnt([<name>])](#7-res.hdr_cnt)integer[res.hdr_ip([<name>[,<occ>]])](#7-res.hdr_ip)ip[res.hdr_names([<delim>])](#7-res.hdr_names)string[res.hdr_val([<name>[,<occ>]])](#7-res.hdr_val)integer[res.hdrs](#7-res.hdrs)string[res.hdrs_bin](#7-res.hdrs_bin)binary[res.timer.hdr](#7-res.timer.hdr)integer[res.ver](#7-res.ver)string[resp_ver](#7-resp_ver)string[scook([<name>])](#7-scook)string[scook_cnt([<name>])](#7-scook_cnt)integer[scook_val([<name>])](#7-scook_val)integer[server_status](#7-server_status)integerkeywordoutput type[set-cookie([<name>])](#7-set-cookie)string[shdr([<name>[,<occ>]])](#7-shdr)string[shdr_cnt([<name>])](#7-shdr_cnt)integer[shdr_ip([<name>[,<occ>]])](#7-shdr_ip)ip[shdr_val([<name>[,<occ>]])](#7-shdr_val)integer[status](#7-status)integer[txn.status](#7-txn.status)integer[txn.timer.total](#7-txn.timer.total)integer[unique-id](#7-unique-id)string[url](#7-url)string[url32](#7-url32)integer[url32+src](#7-url32%2Bsrc)binary[url_ip](#7-url_ip)ip[url_param([<name>[,<delim>[,i]]])](#7-url_param)string[url_port](#7-url_port)integer[urlp([<name>[,<delim>[,i]]])](#7-urlp)string[urlp_val([<name>[,<delim>[,i]]])](#7-urlp_val)integer```\nDetailed list:\n\n```\n\n**[base](#7.3.6-base)**: string```\nThis returns the concatenation of the first Host header and the path part of\nthe request, which starts at the first slash and ends before the question\nmark. It can be useful in virtual hosted environments to detect URL abuses as\nwell as to improve shared caches efficiency. Using this with a limited size\nstick table also allows one to collect statistics about most commonly\nrequested objects by host/path. With ACLs it can allow simple content\nswitching rules involving the host and the path at the same time, such as\n\"www.example.com/favicon.ico\". See also \"path\" and \"uri\".\n\nACL derivatives :\n  base     : exact string match\n  base_beg : prefix match\n  base_dir : subdir match\n  base_dom : domain match\n  base_end : suffix match\n  base_len : length match\n  base_reg : regex match\n  base_sub : substring match\n\n```\n\n**[base32](#7.3.6-base32)**: integer```\nThis returns a 32-bit hash of the value returned by the \"base\" fetch method\nabove. This is useful to track per-URL activity on high traffic sites without\nhaving to store all URLs. Instead a shorter hash is stored, saving a lot of\nmemory. The output type is an unsigned integer. The hash function used is\nSDBM with full avalanche on the output. Technically, base32 is exactly equal\nto \"base,sdbm(1)\".\n\n```\n\n**[base32+src](#7.3.6-base32%2Bsrc)**: binary```\nThis returns the concatenation of the base32 fetch above and the src fetch\nbelow. The resulting type is of type binary, with a size of 8 or 20 bytes\ndepending on the source address family. This can be used to track per-IP,\nper-URL counters.\n\n```\n\n**[baseq](#7.3.6-baseq)**: string```\nThis returns the concatenation of the first Host header and the path part of\nthe request with the query-string, which starts at the first slash. Using this\ninstead of \"base\" allows one to properly identify the target resource, for\nstatistics or caching use cases. See also \"path\", \"pathq\" and \"base\".\n\n```\n\n**[capture.req.hdr](#7.3.6-capture.req.hdr)**(<idx>) : string```\nThis extracts the content of the header captured by the \"capture request\nheader\", idx is the position of the capture keyword in the configuration.\n\n```\n\n**See also:**\"[capture request header](#capture%20request%20header)\".**[capture.req.method](#7.3.6-capture.req.method)**: string```\nThis extracts the METHOD of an HTTP request. It can be used in both request\nand response. Unlike \"method\", it can be used in both request and response\nbecause it's allocated.\n\n```\n\n**[capture.req.uri](#7.3.6-capture.req.uri)**: string```\nThis extracts the request's URI, which starts at the first slash and ends\nbefore the first space in the request (without the host part). Unlike \"path\"\nand \"url\", it can be used in both request and response because it's\nallocated.\n\n```\n\n**[capture.req.ver](#7.3.6-capture.req.ver)**: string```\nThis extracts the request's HTTP version and returns either \"HTTP/1.0\" or\n\"HTTP/1.1\". Unlike \"req.ver\", it can be used in both request, response, and\nlogs because it relies on a persistent flag.\n\n```\n\n**[capture.res.hdr](#7.3.6-capture.res.hdr)**(<idx>) : string```\nThis extracts the content of the header captured by the \"capture response\nheader\", idx is the position of the capture keyword in the configuration.\nThe first entry is an index of 0.\n\n```\n\n**See also:**\"[capture response header](#capture%20response%20header)\"**[capture.res.ver](#7.3.6-capture.res.ver)**: string```\nThis extracts the response's HTTP version and returns either \"HTTP/1.0\" or\n\"HTTP/1.1\". Unlike \"res.ver\", it can be used in logs because it relies on a\npersistent flag.\n\n```\n\n**[cookie](#7.3.6-cookie)**([<name>]) : string(deprecated)```\nThis extracts the last occurrence of the cookie name <name> on a \"Cookie\"\nheader line from the request, or a \"Set-Cookie\" header from the response, and\nreturns its value as a string. A typical use is to get multiple clients\nsharing a same profile use the same server. This can be similar to what\n\"appsession\" did with the \"request-learn\" statement, but with support for\nmulti-peer synchronization and state keeping across restarts. If no name is\nspecified, the first cookie value is returned. This fetch should not be used\nanymore and should be replaced by req.cook() or res.cook() instead as it\nambiguously uses the direction based on the context where it is used.\n\n```\n\n**[hdr](#7.3.6-hdr)**([<name>[,<occ>]]) : string```\nThis is equivalent to req.hdr() when used on requests, and to res.hdr() when\nused on responses. Please refer to these respective fetches for more details.\nIn case of doubt about the fetch direction, please use the explicit ones.\nNote that contrary to the hdr() sample fetch method, the hdr_* ACL keywords\nunambiguously apply to the request headers.\n\n```\n\n**[http_auth](#7.3.6-http_auth)**(<userlist>) : boolean```\nReturns a boolean indicating whether the authentication data received from\nthe client match a username & password stored in the specified userlist. This\nfetch function is not really useful outside of ACLs. Currently only http\nbasic auth is supported.\n\n```\n\n**[http_auth_bearer](#7.3.6-http_auth_bearer)**([<header>]) : string```\nReturns the client-provided token found in the authorization data when the\nBearer scheme is used (to send JSON Web Tokens for instance). No check is\nperformed on the data sent by the client.\nIf a specific <header> is supplied, it will parse this header instead of the\nAuthorization one.\n\n```\n\n**[http_auth_group](#7.3.6-http_auth_group)**(<userlist>) : string```\nReturns a string corresponding to the user name found in the authentication\ndata received from the client if both the user name and password are valid\naccording to the specified userlist. The main purpose is to use it in ACLs\nwhere it is then checked whether the user belongs to any group within a list.\nThis fetch function is not really useful outside of ACLs. Currently only http\nbasic auth is supported.\n\nACL derivatives :\n  http_auth_group(<userlist>) : group ...\n  Returns true when the user extracted from the request and whose password is\n  valid according to the specified userlist belongs to at least one of the\n  groups.\n\n```\n\n**[http_auth_pass](#7.3.6-http_auth_pass)**: string```\nReturns the user's password found in the authentication data received from\nthe client, as supplied in the Authorization header. Not checks are\nperformed by this sample fetch. Only Basic authentication is supported.\n\n```\n\n**[http_auth_type](#7.3.6-http_auth_type)**: string```\nReturns the authentication method found in the authentication data received from\nthe client, as supplied in the Authorization header. Not checks are\nperformed by this sample fetch. Only Basic authentication is supported.\n\n```\n\n**[http_auth_user](#7.3.6-http_auth_user)**: string```\nReturns the user name found in the authentication data received from the\nclient, as supplied in the Authorization header. Not checks are performed by\nthis sample fetch. Only Basic authentication is supported.\n\n```\n\n**[http_first_req](#7.3.6-http_first_req)**: boolean```\nReturns true when the request being processed is the first one of the\nconnection. This can be used to add or remove headers that may be missing\nfrom some requests when a request is not the first one, or to help grouping\nrequests in the logs.\n\n```\n\n**[method](#7.3.6-method)**: integer + string```\nReturns an integer value corresponding to the method in the HTTP request. For\nexample, \"GET\" equals 1 (check sources to establish the matching). Value 9\nmeans \"other method\" and may be converted to a string extracted from the\nstream. This should not be used directly as a sample, this is only meant to\nbe used from ACLs, which transparently convert methods from patterns to these\ninteger + string values. Some predefined ACL already check for most common\nmethods.\n\nACL derivatives :\n  method : case insensitive method match\n\n```\n\nExample :```\n\n# only accept GET and HEAD requests\nacl valid_method method GET HEAD\nhttp-request deny if ! valid_method\n\n```\n\n**[path](#7.3.6-path)**: string```\nThis extracts the request's URL path, which starts at the first slash and\nends before the question mark (without the host part). A typical use is with\nprefetch-capable caches, and with portals which need to aggregate multiple\ninformation from databases and keep them in caches. Note that with outgoing\ncaches, it would be wiser to use \"url\" instead. With ACLs, it's typically\nused to match exact file names (e.g. \"/login.php\"), or directory parts using\nthe derivative forms. See also the \"url\" and \"base\" fetch methods. Please\nnote that any fragment reference in the URI ('#' after the path) is strictly\nforbidden by the HTTP standard and will be rejected. However, if the frontend\nreceiving the request has \"option accept-unsafe-violations-in-http-request\",\nthen this fragment part will be accepted and will also appear in the path.\n\nACL derivatives :\n  path     : exact string match\n  path_beg : prefix match\n  path_dir : subdir match\n  path_dom : domain match\n  path_end : suffix match\n  path_len : length match\n  path_reg : regex match\n  path_sub : substring match\n\n```\n\n**[pathq](#7.3.6-pathq)**: string```\nThis extracts the request's URL path with the query-string, which starts at\nthe first slash. This sample fetch is pretty handy to always retrieve a\nrelative URI, excluding the scheme and the authority part, if any. Indeed,\nwhile it is the common representation for an HTTP/1.1 request target, in\nHTTP/2, an absolute URI is often used. This sample fetch will return the same\nresult in both cases. Please note that any fragment reference in the URI ('#'\nafter the path) is strictly forbidden by the HTTP standard and will be\nrejected. However, if the frontend receiving the request has \"option\naccept-unsafe-violations-in-http-request\", then this fragment part will be\naccepted and will also appear in the path.\n\n```\n\n**[query](#7.3.6-query)**([<options>]) : string```\nThis extracts the request's query string, which starts after the first\nquestion mark. If no question mark is present, this fetch returns nothing. If\na question mark is present but nothing follows, it returns an empty string.\nThis means it's possible to easily know whether a query string is present\nusing the \"found\" matching method. This fetch is the complement of \"path\"\nwhich stops before the question mark and of \"query_string\", which include the\nquestion mark.\n\nAn optional parameter may be used to customize the return value. Following\noptions are supported:\n\n  - with_qm : Include the question mark at the beginning ot the query string,\n              if not empty.\n\n```\n\n**[req.body](#7.3.6-req.body)**: binary```\nThis returns the HTTP request's available body as a block of data. It is\nrecommended to use \"option http-buffer-request\" to be sure to wait, as much\nas possible, for the request's body.\n\n```\n\n**[req.body_len](#7.3.6-req.body_len)**: integer```\nThis returns the length of the HTTP request's available body in bytes. It may\nbe lower than the advertised length if the body is larger than the buffer. It\nis recommended to use \"option http-buffer-request\" to be sure to wait, as\nmuch as possible, for the request's body.\n\n```\n\n**[req.body_param](#7.3.6-req.body_param)**([<name>[,i]]) : string```\nThis fetch assumes that the body of the POST request is url-encoded. The user\ncan check if the \"content-type\" contains the value\n\"application/x-www-form-urlencoded\". This extracts the first occurrence of the\nparameter <name> in the body, which ends before '&'. The parameter name is\ncase-sensitive, unless \"i\" is added as a second argument. If no name is\ngiven, any parameter will match, and the first one will be returned. The\nresult is a string corresponding to the value of the parameter <name> as\npresented in the request body (no URL decoding is performed). Note that the\nACL version of this fetch iterates over multiple parameters and will\niteratively report all parameters values if no name is given.\n\n```\n\n**[req.body_size](#7.3.6-req.body_size)**: integer```\nThis returns the advertised length of the HTTP request's body in bytes. It\nwill represent the advertised Content-Length header, or the size of the\navailable data in case of chunked encoding.\n\n```\n\n**[req.cook](#7.3.6-req.cook)**([<name>]) : string**[cook](#7.3.6-cook)**([<name>]) : string(deprecated)```\nThis extracts the last occurrence of the cookie name <name> on a \"Cookie\"\nheader line from the request, and returns its value as string. If no name is\nspecified, the first cookie value is returned. When used with ACLs, all\nmatching cookies are evaluated. Spaces around the name and the value are\nignored as requested by the Cookie header specification (RFC6265). The cookie\nname is case-sensitive. Empty cookies are valid, so an empty cookie may very\nwell return an empty value if it is present. Use the \"found\" match to detect\npresence. Use the res.cook() variant for response cookies sent by the server.\n\nACL derivatives :\n  req.cook([<name>])     : exact string match\n  req.cook_beg([<name>]) : prefix match\n  req.cook_dir([<name>]) : subdir match\n  req.cook_dom([<name>]) : domain match\n  req.cook_end([<name>]) : suffix match\n  req.cook_len([<name>]) : length match\n  req.cook_reg([<name>]) : regex match\n  req.cook_sub([<name>]) : substring match\n\n```\n\n**[req.cook_cnt](#7.3.6-req.cook_cnt)**([<name>]) : integer**[cook_cnt](#7.3.6-cook_cnt)**([<name>]) : integer(deprecated)```\nReturns an integer value representing the number of occurrences of the cookie\n<name> in the request, or all cookies if <name> is not specified.\n\n```\n\n**[req.cook_names](#7.3.6-req.cook_names)**([<delim>]) : string```\nThis builds a string made from the concatenation of all cookie names as they\nappear in the request (Cookie header) when the rule is evaluated. The default\ndelimiter is the comma (',') but it may be overridden as an optional argument\n<delim>. In this case, only the first character of <delim> is considered.\n\n```\n\n**[req.cook_val](#7.3.6-req.cook_val)**([<name>]) : integer**[cook_val](#7.3.6-cook_val)**([<name>]) : integer(deprecated)```\nThis extracts the last occurrence of the cookie name <name> on a \"Cookie\"\nheader line from the request, and converts its value to an integer which is\nreturned. If no name is specified, the first cookie value is returned. When\nused in ACLs, all matching names are iterated over until a value matches.\n\n```\n\n**[req.fhdr](#7.3.6-req.fhdr)**(<name>[,<occ>]) : string```\nThis returns the full value of the last occurrence of header <name> in an\nHTTP request. It differs from req.hdr() in that any commas present in the\nvalue are returned and are not used as delimiters. This is sometimes useful\nwith headers such as User-Agent.\n\nWhen used from an ACL, all occurrences are iterated over until a match is\nfound.\n\nOptionally, a specific occurrence might be specified as a position number.\nPositive values indicate a position from the first occurrence, with 1 being\nthe first one. Negative values indicate positions relative to the last one,\nwith -1 being the last one.\n\n```\n\n**[req.fhdr_cnt](#7.3.6-req.fhdr_cnt)**([<name>]) : integer```\nReturns an integer value representing the number of occurrences of request\nheader field name <name>, or the total number of header fields if <name> is\nnot specified. Like req.fhdr() it differs from res.hdr_cnt() by not splitting\nheaders at commas.\n\n```\n\n**[req.hdr](#7.3.6-req.hdr)**([<name>[,<occ>]]) : string```\nThis returns the last comma-separated value of the header <name> in an HTTP\nrequest. The fetch considers any comma as a delimiter for distinct values.\nThis is useful if you need to process headers that are defined to be a list\nof values, such as Accept, or X-Forwarded-For. If full-line headers are\ndesired instead, use req.fhdr(). Please carefully check RFC 7231 to know how\ncertain headers are supposed to be parsed. Also, some of them are case\ninsensitive (e.g. Connection).\n\nWhen used from an ACL, all occurrences are iterated over until a match is\nfound.\n\nOptionally, a specific occurrence might be specified as a position number.\nPositive values indicate a position from the first occurrence, with 1 being\nthe first one. Negative values indicate positions relative to the last one,\nwith -1 being the last one.\n\nA typical use is with the X-Forwarded-For header once converted to IP,\nassociated with an IP stick-table.\n\nACL derivatives :\n  hdr([<name>[,<occ>]])     : exact string match\n  hdr_beg([<name>[,<occ>]]) : prefix match\n  hdr_dir([<name>[,<occ>]]) : subdir match\n  hdr_dom([<name>[,<occ>]]) : domain match\n  hdr_end([<name>[,<occ>]]) : suffix match\n  hdr_len([<name>[,<occ>]]) : length match\n  hdr_reg([<name>[,<occ>]]) : regex match\n  hdr_sub([<name>[,<occ>]]) : substring match\n\n```\n\n**[req.hdr_cnt](#7.3.6-req.hdr_cnt)**([<name>]) : integer**[hdr_cnt](#7.3.6-hdr_cnt)**([<header>]) : integer(deprecated)```\nReturns an integer value representing the number of occurrences of request\nheader field name <name>, or the total number of header field values if\n<name> is not specified. Like req.hdr() it counts each comma separated\npart of the header's value. If counting of full-line headers is desired,\nthen req.fhdr_cnt() should be used instead.\n\nWith ACLs, it can be used to detect presence, absence or abuse of a specific\nheader, as well as to block request smuggling attacks by rejecting requests\nwhich contain more than one of certain headers.\n\nRefer to req.hdr() for more information on header matching.\n\n```\n\n**[req.hdr_ip](#7.3.6-req.hdr_ip)**([<name>[,<occ>]]) : ip**[hdr_ip](#7.3.6-hdr_ip)**([<name>[,<occ>]]) : ip(deprecated)```\nThis extracts the last occurrence of header <name> in an HTTP request,\nconverts it to an IPv4 or IPv6 address and returns this address. When used\nwith ACLs, all occurrences are checked, and if <name> is omitted, every value\nof every header is checked. The parser strictly adheres to the format\ndescribed in RFC7239, with the extension that IPv4 addresses may optionally\nbe followed by a colon (':') and a valid decimal port number (0 to 65535),\nwhich will be silently dropped. All other forms will not match and will\ncause the address to be ignored.\n\nThe <occ> parameter is processed as with req.hdr().\n\nA typical use is with the X-Forwarded-For and X-Client-IP headers.\n\n```\n\n**[req.hdr_names](#7.3.6-req.hdr_names)**([<delim>]) : string```\nThis builds a string made from the concatenation of all header names as they\nappear in the request when the rule is evaluated. The default delimiter is\nthe comma (',') but it may be overridden as an optional argument <delim>. In\nthis case, only the first character of <delim> is considered.\n\n```\n\n**[req.hdr_val](#7.3.6-req.hdr_val)**([<name>[,<occ>]]) : integer**[hdr_val](#7.3.6-hdr_val)**([<name>[,<occ>]]) : integer(deprecated)```\nThis extracts the last occurrence of header <name> in an HTTP request, and\nconverts it to an integer value. When used with ACLs, all occurrences are\nchecked, and if <name> is omitted, every value of every header is checked.\n\nThe <occ> parameter is processed as with req.hdr().\n\nA typical use is with the X-Forwarded-For header.\n\n```\n\n**[req.hdrs](#7.3.6-req.hdrs)**: string```\nReturns the current request headers as string including the last empty line\nseparating headers from the request body. The last empty line can be used to\ndetect a truncated header block. This sample fetch is useful for some SPOE\nheaders analyzers and for advanced logging.\n\n```\n\n**[req.hdrs_bin](#7.3.6-req.hdrs_bin)**: binary```\nReturns the current request headers contained in preparsed binary form. This\nis useful for offloading some processing with SPOE. Each string is described\nby a length followed by the number of bytes indicated in the length. The\nlength is represented using the variable integer encoding detailed in the\nSPOE documentation. The end of the list is marked by a couple of empty header\nnames and values (length of 0 for both).\n\n*(<str:header-name><str:header-value>)<empty string><empty string>\n\nint:  refer to the SPOE documentation for the encoding\nstr:  <int:length><bytes>\n\n```\n\n**[req.timer.hdr](#7.3.6-req.timer.hdr)**: integer```\nTotal time to get the client request (HTTP mode only). It's the time elapsed\nbetween the first bytes received and the moment the proxy received the empty\nline marking the end of the HTTP headers. This is reported in milliseconds\n(ms) and is equivalent to %TR in log-format. See section 8.4 \"Timing events\"\nfor more details.\n\n```\n\n**[req.timer.idle](#7.3.6-req.timer.idle)**: integer```\nThis is the idle time before the HTTP request (HTTP mode only). This timer\ncounts between the end of the handshakes and the first byte of the HTTP\nrequest. This is reported in milliseconds and is equivalent to %Ti in\nlog-format. See section 8.4 \"Timing events\" for more details.\n\n```\n\n**[req.timer.queue](#7.3.6-req.timer.queue)**: integer```\nTotal time spent in the queues waiting for a connection slot.\nThis is reported in milliseconds and is equivalent to %Tw in\nlog-format. See section 8.4 \"Timing events\" for more details.\n\n```\n\n**[req.timer.tq](#7.3.6-req.timer.tq)**: integer```\ntotal time to get the client request from the accept date or since the\nemission of the last byte of the previous response.\nThis is reported in milliseconds and is equivalent to %Tq in\nlog-format. See section 8.4 \"Timing events\" for more details.\n\n```\n\n**[req.ver](#7.3.6-req.ver)**: string**[req_ver](#7.3.6-req_ver)**: string(deprecated)```\nReturns the version string from the HTTP request, for example \"1.1\". This can\nbe useful for ACL. For logs use the \"%HV\" logformat alias. Some predefined\nACL already check for versions 1.0 and 1.1.\n\nCommon values are \"1.0\", \"1.1\", \"2.0\" or \"3.0\".\n\nIn the case of http/2 and http/3, the value is not extracted from the HTTP\nversion in the request line but is determined by the negotiated protocol\nversion.\n\nACL derivatives :\n  req.ver : exact string match\n\n```\n\n**[request_date](#7.3.6-request_date)**([<unit>]) : integer```\nThis is the exact date when the first byte of the HTTP request was received\nby HAProxy (log-format alias %tr). This is computed from accept_date +\nhandshake time (%Th) + idle time (%Ti).\n\nReturns a value in number of seconds since epoch.\n\n<unit> is facultative, and can be set to \"s\" for seconds (default behavior),\n\"ms\" for  milliseconds or \"us\" for microseconds.\nIf unit is set, return value is an integer reflecting either seconds,\nmilliseconds or microseconds since epoch.\nIt is useful when a time resolution of less than a second is needed.\n\n```\n\n**[res.body](#7.3.6-res.body)**: binary```\nThis returns the HTTP response's available body as a block of data. Unlike\nthe request side, there is no directive to wait for the response's body. This\nsample fetch is really useful (and usable) in the health-check context.\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[res.body_len](#7.3.6-res.body_len)**: integer```\nThis returns the length of the HTTP response available body in bytes. Unlike\nthe request side, there is no directive to wait for the response's body. This\nsample fetch is really useful (and usable) in the health-check context.\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[res.body_size](#7.3.6-res.body_size)**: integer```\nThis returns the advertised length of the HTTP response body in bytes. It\nwill represent the advertised Content-Length header, or the size of the\navailable data in case of chunked encoding. Unlike the request side, there is\nno directive to wait for the response body. This sample fetch is really\nuseful (and usable) in the health-check context.\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[res.cache_hit](#7.3.6-res.cache_hit)**: boolean```\nReturns the boolean \"true\" value if the response has been built out of an\nHTTP cache entry, otherwise returns boolean \"false\".\n\n```\n\n**[res.cache_name](#7.3.6-res.cache_name)**: string```\nReturns a string containing the name of the HTTP cache that was used to\nbuild the HTTP response if res.cache_hit is true, otherwise returns an\nempty string.\n\n```\n\n**[res.comp](#7.3.6-res.comp)**: boolean```\nReturns the boolean \"true\" value if the response has been compressed by\nHAProxy, otherwise returns boolean \"false\". This may be used to add\ninformation in the logs.\n\n```\n\n**[res.comp_algo](#7.3.6-res.comp_algo)**: string```\nReturns a string containing the name of the algorithm used if the response\nwas compressed by HAProxy, for example : \"deflate\". This may be used to add\nsome information in the logs.\n\n```\n\n**[res.cook](#7.3.6-res.cook)**([<name>]) : string**[scook](#7.3.6-scook)**([<name>]) : string(deprecated)```\nThis extracts the last occurrence of the cookie name <name> on a \"Set-Cookie\"\nheader line from the response, and returns its value as string. If no name is\nspecified, the first cookie value is returned.\n\nIt may be used in tcp-check based expect rules.\n\nACL derivatives :\n  res.scook([<name>] : exact string match\n\n```\n\n**[res.cook_cnt](#7.3.6-res.cook_cnt)**([<name>]) : integer**[scook_cnt](#7.3.6-scook_cnt)**([<name>]) : integer(deprecated)```\nReturns an integer value representing the number of occurrences of the cookie\n<name> in the response, or all cookies if <name> is not specified. This is\nmostly useful when combined with ACLs to detect suspicious responses.\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[res.cook_names](#7.3.6-res.cook_names)**([<delim>]) : string```\nThis builds a string made from the concatenation of all cookie names as they\nappear in the response (Set-Cookie headers) when the rule is evaluated. The\ndefault delimiter is the comma (',') but it may be overridden as an optional\nargument <delim>. In this case, only the first character of <delim> is\nconsidered.\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[res.cook_val](#7.3.6-res.cook_val)**([<name>]) : integer**[scook_val](#7.3.6-scook_val)**([<name>]) : integer(deprecated)```\nThis extracts the last occurrence of the cookie name <name> on a \"Set-Cookie\"\nheader line from the response, and converts its value to an integer which is\nreturned. If no name is specified, the first cookie value is returned.\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[res.fhdr](#7.3.6-res.fhdr)**([<name>[,<occ>]]) : string```\nThis fetch works like the req.fhdr() fetch with the difference that it acts\non the headers within an HTTP response.\n\nLike req.fhdr() the res.fhdr() fetch returns full values. If the header is\ndefined to be a list you should use res.hdr().\n\nThis fetch is sometimes useful with headers such as Date or Expires.\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[res.fhdr_cnt](#7.3.6-res.fhdr_cnt)**([<name>]) : integer```\nThis fetch works like the req.fhdr_cnt() fetch with the difference that it\nacts on the headers within an HTTP response.\n\nLike req.fhdr_cnt() the res.fhdr_cnt() fetch acts on full values. If the\nheader is defined to be a list you should use res.hdr_cnt().\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[res.hdr](#7.3.6-res.hdr)**([<name>[,<occ>]]) : string**[shdr](#7.3.6-shdr)**([<name>[,<occ>]]) : string(deprecated)```\nThis fetch works like the req.hdr() fetch with the difference that it acts\non the headers within an HTTP response.\n\nLike req.hdr() the res.hdr() fetch considers the comma to be a delimiter. If\nthis is not desired res.fhdr() should be used.\n\nIt may be used in tcp-check based expect rules.\n\nACL derivatives :\n  res.hdr([<name>[,<occ>]])     : exact string match\n  res.hdr_beg([<name>[,<occ>]]) : prefix match\n  res.hdr_dir([<name>[,<occ>]]) : subdir match\n  res.hdr_dom([<name>[,<occ>]]) : domain match\n  res.hdr_end([<name>[,<occ>]]) : suffix match\n  res.hdr_len([<name>[,<occ>]]) : length match\n  res.hdr_reg([<name>[,<occ>]]) : regex match\n  res.hdr_sub([<name>[,<occ>]]) : substring match\n\n```\n\n**[res.hdr_cnt](#7.3.6-res.hdr_cnt)**([<name>]) : integer**[shdr_cnt](#7.3.6-shdr_cnt)**([<name>]) : integer(deprecated)```\nThis fetch works like the req.hdr_cnt() fetch with the difference that it\nacts on the headers within an HTTP response.\n\nLike req.hdr_cnt() the res.hdr_cnt() fetch considers the comma to be a\ndelimiter. If this is not desired res.fhdr_cnt() should be used.\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[res.hdr_ip](#7.3.6-res.hdr_ip)**([<name>[,<occ>]]) : ip**[shdr_ip](#7.3.6-shdr_ip)**([<name>[,<occ>]]) : ip(deprecated)```\nThis fetch works like the req.hdr_ip() fetch with the difference that it\nacts on the headers within an HTTP response.\n\nThis can be useful to learn some data into a stick table.\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[res.hdr_names](#7.3.6-res.hdr_names)**([<delim>]) : string```\nThis builds a string made from the concatenation of all header names as they\nappear in the response when the rule is evaluated. The default delimiter is\nthe comma (',') but it may be overridden as an optional argument <delim>. In\nthis case, only the first character of <delim> is considered.\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[res.hdr_val](#7.3.6-res.hdr_val)**([<name>[,<occ>]]) : integer**[shdr_val](#7.3.6-shdr_val)**([<name>[,<occ>]]) : integer(deprecated)```\nThis fetch works like the req.hdr_val() fetch with the difference that it\nacts on the headers within an HTTP response.\n\nThis can be useful to learn some data into a stick table.\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[res.hdrs](#7.3.6-res.hdrs)**: string```\nReturns the current response headers as string including the last empty line\nseparating headers from the request body. The last empty line can be used to\ndetect a truncated header block. This sample fetch is useful for some SPOE\nheaders analyzers and for advanced logging.\n\nIt may also be used in tcp-check based expect rules.\n\n```\n\n**[res.hdrs_bin](#7.3.6-res.hdrs_bin)**: binary```\nReturns the current response headers contained in preparsed binary form. This\nis useful for offloading some processing with SPOE. It may be used in\ntcp-check based expect rules. Each string is described by a length followed\nby the number of bytes indicated in the length. The length is represented\nusing the variable integer encoding detailed in the SPOE documentation. The\nend of the list is marked by a couple of empty header names and values\n(length of 0 for both).\n\n*(<str:header-name><str:header-value>)<empty string><empty string>\n\nint:  refer to the SPOE documentation for the encoding\nstr:  <int:length><bytes>\n\n```\n\n**[res.timer.hdr](#7.3.6-res.timer.hdr)**: integer```\nIt's the time elapsed between the moment the TCP connection was established\nto the server and the moment the server sent its complete response headers.\nThis is reported in milliseconds and is equivalent to %Tr in log-format. See\nsection 8.4 \"Timing events\" for more details.\n\n```\n\n**[res.ver](#7.3.6-res.ver)**: string**[resp_ver](#7.3.6-resp_ver)**: string(deprecated)```\nReturns the version string from the HTTP response, for example \"1.1\". This\ncan be useful for logs, but is mostly there for ACL.\n\nIt may be used in tcp-check based expect rules.\n\nACL derivatives :\n  resp.ver : exact string match\n\n```\n\n**[server_status](#7.3.6-server_status)**: integer```\nReturn an integer containing the HTTP status code as received from the\nserver. If no response was received from the server, the sample fetch fails.\n\n```\n\n**[set-cookie](#7.3.6-set-cookie)**([<name>]) : string(deprecated)```\nThis extracts the last occurrence of the cookie name <name> on a \"Set-Cookie\"\nheader line from the response and uses the corresponding value to match. This\ncan be comparable to what \"appsession\" did with default options, but with\nsupport for multi-peer synchronization and state keeping across restarts.\n\nThis fetch function is deprecated and has been superseded by the \"res.cook\"\nfetch. This keyword will disappear soon.\n\n```\n\n**[status](#7.3.6-status)**: integer```\nReturns an integer containing the HTTP status code in the HTTP response, for\nexample, 302. It is mostly used within ACLs and integer ranges, for example,\nto remove any Location header if the response is not a 3xx. It will be the\nstatus code received by the client if it is not changed, via a 'set-status'\naction for instance.\n\nIt may be used in tcp-check based expect rules.\n\n```\n\n**[txn.status](#7.3.6-txn.status)**: integer```\nReturn an integer containing the HTTP status code of the transaction, as\nreported in the log.\n\n```\n\n**[txn.timer.total](#7.3.6-txn.timer.total)**: integer```\nTotal active time for the HTTP request, between the moment the proxy received\nthe first byte of the request header and the emission of the last byte of the\nresponse body. This is the equivalent of %Ta in the log-format and is\nreported in milliseconds (ms).  For more information see Section 8.4 \"Timing\nevents\"\n\n```\n\n**[unique-id](#7.3.6-unique-id)**: string```\nReturns the unique-id attached to the request. The directive\n\"unique-id-format\" must be set. If it is not set, the unique-id sample fetch\nfails. Note that the unique-id is usually used with HTTP requests, however this\nsample fetch can be used with other protocols. Obviously, if it is used with\nother protocols than HTTP, the unique-id-format directive must not contain\nHTTP parts. See: unique-id-format and unique-id-header\n\n```\n\n**[url](#7.3.6-url)**: string```\nThis extracts the request's URL as presented in the request. A typical use is\nwith prefetch-capable caches, and with portals which need to aggregate\nmultiple information from databases and keep them in caches. With ACLs, using\n\"path\" is preferred over using \"url\", because clients may send a full URL as\nis normally done with proxies. The only real use is to match \"*\" which does\nnot match in \"path\", and for which there is already a predefined ACL. See\nalso \"path\" and \"base\". Please note that any fragment reference in the URI\n('#' after the path) is strictly forbidden by the HTTP standard and will be\nrejected. However, if the frontend receiving the request has \"option\naccept-unsafe-violations-in-http-request\", then this fragment part will be\naccepted and will also appear in the url.\n\nACL derivatives :\n  url     : exact string match\n  url_beg : prefix match\n  url_dir : subdir match\n  url_dom : domain match\n  url_end : suffix match\n  url_len : length match\n  url_reg : regex match\n  url_sub : substring match\n\n```\n\n**[url32](#7.3.6-url32)**: integer```\nThis returns a 32-bit hash of the value obtained by concatenating the first\nHost header and the whole URL including parameters (not only the path part of\nthe request, as in the \"base32\" fetch above). This is useful to track per-URL\nactivity. A shorter hash is stored, saving a lot of memory. The output type\nis an unsigned integer.\n\n```\n\n**[url32+src](#7.3.6-url32%2Bsrc)**: binary```\nThis returns the concatenation of the \"url32\" fetch and the \"src\" fetch. The\nresulting type is of type binary, with a size of 8 or 20 bytes depending on\nthe source address family. This can be used to track per-IP, per-URL counters.\n\n```\n\n**[url_ip](#7.3.6-url_ip)**: ip```\nThis extracts the IP address from the request's URL when the host part is\npresented as an IP address. Its use is very limited. For instance, a\nmonitoring system might use this field as an alternative for the source IP in\norder to test what path a given source address would follow, or to force an\nentry in a table for a given source address. It may be used in combination\nwith 'http-request set-dst' to emulate the older 'option http_proxy'.\n\n```\n\n**[url_port](#7.3.6-url_port)**: integer```\nThis extracts the port part from the request's URL. Note that if the port is\nnot specified in the request, port 80 is assumed..\n\n```\n\n**[urlp](#7.3.6-urlp)**([<name>[,<delim>[,i]]]) : string**[url_param](#7.3.6-url_param)**([<name>[,<delim>[,i]]]) : string```\nThis extracts the first occurrence of the parameter <name> in the query\nstring, which begins after either '?' or <delim>, and which ends before '&',\n';' or <delim>. The parameter name is case-sensitive, unless\"i\" is added as a\nthird argument. If no name is given, any parameter will match, and the first\none will be returned. The result is a string corresponding to the value of the\nparameter <name> as presented in the request (no URL decoding is performed).\nThis can be used for session stickiness based on a client ID, to extract an\napplication cookie passed as a URL parameter, or in ACLs to apply some checks.\nNote that the ACL version of this fetch iterates over multiple parameters and\nwill iteratively report all parameters values if no name is given\n\nACL derivatives :\n  urlp(<name>[,<delim>])     : exact string match\n  urlp_beg(<name>[,<delim>]) : prefix match\n  urlp_dir(<name>[,<delim>]) : subdir match\n  urlp_dom(<name>[,<delim>]) : domain match\n  urlp_end(<name>[,<delim>]) : suffix match\n  urlp_len(<name>[,<delim>]) : length match\n  urlp_reg(<name>[,<delim>]) : regex match\n  urlp_sub(<name>[,<delim>]) : substring match\n\n```\n\nExample :```\n\n# match http://example.com/foo?PHPSESSIONID=some_id\nstick on urlp(PHPSESSIONID)\n# match http://example.com/foo;JSESSIONID=some_id\nstick on urlp(JSESSIONID,;)\n\n```\n\n**[urlp_val](#7.3.6-urlp_val)**([<name>[,<delim>[,i]]]) : integer```\nSee \"urlp\" above. This one extracts the URL parameter <name> in the request\nand converts it to an integer value. This can be used for session stickiness\nbased on a user ID for example, or with ACLs to match a page number or price.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.3.7. Fetching samples for developers", "content": "### [7.3.7.](#7.3.7)Fetching samples for developers\n\n```\nThis set of sample fetch methods is reserved to developers and must never be\nused on a production environment, except on developer demand, for debugging\npurposes. Moreover, no special care will be taken on backwards compatibility.\nThere is no warranty the following sample fetches will never change, be renamed\nor simply removed. So be really careful if you should use one of them. To avoid\nany ambiguity, these sample fetches are placed in the dedicated scope \"internal\",\nfor instance \"internal.strm.is_htx\".\n\nSummary of sample fetch methods in this section and their respective types:\n\n```\n\nkeywordoutput type[internal.htx.data](#7-internal.htx.data)integer[internal.htx.free](#7-internal.htx.free)integer[internal.htx.free_data](#7-internal.htx.free_data)integer[internal.htx.has_eom](#7-internal.htx.has_eom)boolean[internal.htx.nbblks](#7-internal.htx.nbblks)integer[internal.htx.size](#7-internal.htx.size)integer[internal.htx.used](#7-internal.htx.used)integer[internal.htx_blk.size(<idx>)](#7-internal.htx_blk.size)integer[internal.htx_blk.type(<idx>)](#7-internal.htx_blk.type)string[internal.htx_blk.data(<idx>)](#7-internal.htx_blk.data)binary[internal.htx_blk.hdrname(<idx>)](#7-internal.htx_blk.hdrname)string[internal.htx_blk.hdrval(<idx>)](#7-internal.htx_blk.hdrval)string[internal.htx_blk.start_line(<idx>)](#7-internal.htx_blk.start_line)string[internal.strm.is_htx](#7-internal.strm.is_htx)boolean```\nDetailed list:\n\n```\n\n**[internal.htx.data](#7.3.7-internal.htx.data)**: integer```\nReturns the size in bytes used by data in the HTX message associated to a\nchannel. The channel is chosen depending on the sample direction.\n\n```\n\n**[internal.htx.free](#7.3.7-internal.htx.free)**: integer```\nReturns the free space (size - used) in bytes in the HTX message associated\nto a channel. The channel is chosen depending on the sample direction.\n\n```\n\n**[internal.htx.free_data](#7.3.7-internal.htx.free_data)**: integer```\nReturns the free space for the data in bytes in the HTX message associated to\na channel. The channel is chosen depending on the sample direction.\n\n```\n\n**[internal.htx.has_eom](#7.3.7-internal.htx.has_eom)**: boolean```\nReturns true if the HTX message associated to a channel contains the\nend-of-message flag (EOM). Otherwise, it returns false. The channel is chosen\ndepending on the sample direction.\n\n```\n\n**[internal.htx.nbblks](#7.3.7-internal.htx.nbblks)**: integer```\nReturns the number of blocks present in the HTX message associated to a\nchannel. The channel is chosen depending on the sample direction.\n\n```\n\n**[internal.htx.size](#7.3.7-internal.htx.size)**: integer```\nReturns the total size in bytes of the HTX message associated to a\nchannel. The channel is chosen depending on the sample direction.\n\n```\n\n**[internal.htx.used](#7.3.7-internal.htx.used)**: integer```\nReturns the total size used in bytes (data + metadata) in the HTX message\nassociated to a channel. The channel is chosen depending on the sample\ndirection.\n\n```\n\n**[internal.htx_blk.size](#7.3.7-internal.htx_blk.size)**(<idx>) : integer```\nReturns the size of the block at the position <idx> in the HTX message\nassociated to a channel or 0 if it does not exist. The channel is chosen\ndepending on the sample direction. <idx> may be any positive integer or one\nof the special value :\n  * head  : The oldest inserted block\n  * tail  : The newest inserted block\n  * first : The first block where to (re)start the analysis\n\n```\n\n**[internal.htx_blk.type](#7.3.7-internal.htx_blk.type)**(<idx>) : string```\nReturns the type of the block at the position <idx> in the HTX message\nassociated to a channel or \"HTX_BLK_UNUSED\" if it does not exist. The channel\nis chosen depending on the sample direction. <idx> may be any positive\ninteger or one of the special value :\n  * head  : The oldest inserted block\n  * tail  : The newest inserted block\n  * first : The first block where to (re)start the analysis\n\n```\n\n**[internal.htx_blk.data](#7.3.7-internal.htx_blk.data)**(<idx>) : binary```\nReturns the value of the DATA block at the position <idx> in the HTX message\nassociated to a channel or an empty string if it does not exist or if it is\nnot a DATA block. The channel is chosen depending on the sample direction.\n<idx> may be any positive integer or one of the special value :\n\n  * head  : The oldest inserted block\n  * tail  : The newest inserted block\n  * first : The first block where to (re)start the analysis\n\n```\n\n**[internal.htx_blk.hdrname](#7.3.7-internal.htx_blk.hdrname)**(<idx>) : string```\nReturns the header name of the HEADER block at the position <idx> in the HTX\nmessage associated to a channel or an empty string if it does not exist or if\nit is not an HEADER block. The channel is chosen depending on the sample\ndirection.  <idx> may be any positive integer or one of the special value :\n\n  * head  : The oldest inserted block\n  * tail  : The newest inserted block\n  * first : The first block where to (re)start the analysis\n\n```\n\n**[internal.htx_blk.hdrval](#7.3.7-internal.htx_blk.hdrval)**(<idx>) : string```\nReturns the header value of the HEADER block at the position <idx> in the HTX\nmessage associated to a channel or an empty string if it does not exist or if\nit is not an HEADER block. The channel is chosen depending on the sample\ndirection.  <idx> may be any positive integer or one of the special value :\n\n  * head  : The oldest inserted block\n  * tail  : The newest inserted block\n  * first : The first block where to (re)start the analysis\n\n```\n\n**[internal.htx_blk.start_line](#7.3.7-internal.htx_blk.start_line)**(<idx>) : string```\nReturns the value of the REQ_SL or RES_SL block at the position <idx> in the\nHTX message associated to a channel or an empty string if it does not exist\nor if it is not a SL block. The channel is chosen depending on the sample\ndirection.  <idx> may be any positive integer or one of the special value :\n\n  * head  : The oldest inserted block\n  * tail  : The newest inserted block\n  * first : The first block where to (re)start the analysis\n\n```\n\n**[internal.strm.is_htx](#7.3.7-internal.strm.is_htx)**: boolean```\nReturns true if the current stream is an HTX stream. It means the data in the\nchannels buffers are stored using the internal HTX representation. Otherwise,\nit returns false.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "7.4. Pre-defined ACLs", "content": "## [7.4.](#7.4)Pre-defined ACLs\n\n```\nSome predefined ACLs are hard-coded so that they do not have to be declared in\nevery frontend which needs them. They all have their names in upper case in\norder to avoid confusion. Their equivalence is provided below.\n\n```\n\nACL nameEquivalent to UsageFALSEalways_falsenever matchHTTPreq.proto_httpmatch if request protocol is valid HTTPHTTP_1.0req.ver 1.0match if HTTP request version is 1.0HTTP_1.1req.ver 1.1match if HTTP request version is 1.1HTTP_2.0req.ver 2.0match if HTTP request version is 2.0HTTP_3.0req.ver 3.0match if HTTP request version is 3.0HTTP_CONTENTreq.hdr_val(content-length) gt 0match an existing content-length in the HTTP requestHTTP_URL_ABSurl_reg ^[^/:]*://match absolute URL with schemeHTTP_URL_SLASHurl_beg /match URL beginning with \"/\"HTTP_URL_STARurl *match URL equal to \"*\"LOCALHOSTsrc 127.0.0.1/8 ::1match connection from local hostMETH_CONNECTmethod CONNECTmatch HTTP CONNECT methodMETH_DELETEmethod DELETEmatch HTTP DELETE methodMETH_GETmethod GET HEADmatch HTTP GET or HEAD methodMETH_HEADmethod HEADmatch HTTP HEAD methodMETH_OPTIONSmethod OPTIONSmatch HTTP OPTIONS methodMETH_POSTmethod POSTmatch HTTP POST methodMETH_PUTmethod PUTmatch HTTP PUT methodMETH_TRACEmethod TRACEmatch HTTP TRACE methodRDP_COOKIEreq.rdp_cookie_cnt gt 0match presence of an RDP cookie in the request bufferREQ_CONTENTreq.len gt 0match data in the request bufferTRUEalways_truealways matchWAIT_ENDwait_endwait for end of content analysis", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8. Logging", "content": "# [8.](#8)Logging\n\n```\nOne of HAProxy's strong points certainly lies is its precise logs. It probably\nprovides the finest level of information available for such a product, which is\nvery important for troubleshooting complex environments. Standard information\nprovided in logs include client ports, TCP/HTTP state timers, precise stream\nstate at termination and precise termination cause, information about decisions\nto direct traffic to a server, and of course the ability to capture arbitrary\nheaders.\n\nIn order to improve administrators reactivity, it offers a great transparency\nabout encountered problems, both internal and external, and it is possible to\nsend logs to different sources at the same time with different level filters :\n\n  - global process-level logs (system errors, start/stop, etc..)\n  - per-instance system and internal errors (lack of resource, bugs, ...)\n  - per-instance external troubles (servers up/down, max connections)\n  - per-instance activity (client connections), either at the establishment or\n    at the termination.\n  - per-request control of log-level, e.g.\n        http-request set-log-level silent if sensitive_request\n\nThe ability to distribute different levels of logs to different log servers\nallow several production teams to interact and to fix their problems as soon\nas possible. For example, the system team might monitor system-wide errors,\nwhile the application team might be monitoring the up/down for their servers in\nreal time, and the security team might analyze the activity logs with one hour\ndelay.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.1. Log levels", "content": "## [8.1.](#8.1)Log levels\n\n```\nTCP and HTTP connections can be logged with information such as the date, time,\nsource IP address, destination address, connection duration, response times,\nHTTP request, HTTP return code, number of bytes transmitted, conditions\nin which the stream ended, and even exchanged cookies values. For example\ntrack a particular user's problems. All messages may be sent to up to two\nsyslog servers. Check the \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\" keyword in section 4.2 for more information\nabout log facilities.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.2. Log formats", "content": "## [8.2.](#8.2)Log formats\n\n```\nHAProxy supports 5 log formats. Several fields are common between these formats\nand will be detailed in the following sections. A few of them may vary\nslightly with the configuration, due to indicators specific to certain\noptions. The supported formats are as follows :\n\n  - the default format, which is very basic and very rarely used. It only\n    provides very basic information about the incoming connection at the moment\n    it is accepted : source IP:port, destination IP:port, and frontend-name.\n    This mode will eventually disappear so it will not be described to great\n    extents.\n\n  - the TCP format, which is more advanced. This format is enabled when \"option\n    tcplog\" is set on the frontend. HAProxy will then usually wait for the\n    connection to terminate before logging. This format provides much richer\n    information, such as timers, connection counts, queue size, etc... This\n    format is recommended for pure TCP proxies.\n\n  - the HTTP format, which is the most advanced for HTTP proxying. This format\n    is enabled when \"option httplog\" is set on the frontend. It provides the\n    same information as the TCP format with some HTTP-specific fields such as\n    the request, the status code, and captures of headers and cookies. This\n    format is recommended for HTTP proxies.\n\n  - the CLF HTTP format, which is equivalent to the HTTP format, but with the\n    fields arranged in the same order as the CLF format. In this mode, all\n    timers, captures, flags, etc... appear one per field after the end of the\n    common fields, in the same order they appear in the standard HTTP format.\n\n  - the custom log format, allows you to make your own log line.\n\nNext sections will go deeper into details for each of these formats. Format\nspecification will be performed on a \"field\" basis. Unless stated otherwise, a\nfield is a portion of text delimited by any number of spaces. Since syslog\nservers are susceptible of inserting fields at the beginning of a line, it is\nalways assumed that the first field is the one containing the process name and\nidentifier.\n\nNote : Since log lines may be quite long, the log examples in sections below\n       might be broken into multiple lines. The example log lines will be\n       prefixed with 3 closing angle brackets ('>>>') and each time a log is\n       broken into multiple lines, each non-final line will end with a\n       backslash ('\\') and the next line will start indented by two characters.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.2.1. Default log format", "content": "### [8.2.1.](#8.2.1)Default log format\n\n```\nThis format is used when no specific option is set. The log is emitted as soon\nas the connection is accepted. One should note that this currently is the only\nformat which logs the request's destination IP and ports.\n\n```\n\nExample :```\n\n    listen www\n        mode http\n        log global\n        server srv1 127.0.0.1:8000\n\n>>> Feb  6 12:12:09 localhost \\\n      haproxy[14385]: Connect from 10.0.1.2:33312 to 10.0.3.31:8012 \\\n      (www/HTTP)\n\n```\n\n```\n  Field   Format                                Extract from the example above\n      1   process_name '[' pid ']:'                            haproxy[14385]:\n      2   'Connect from'                                          Connect from\n      3   source_ip ':' source_port                             10.0.1.2:33312\n      4   'to'                                                              to\n      5   destination_ip ':' destination_port                   10.0.3.31:8012\n      6   '(' frontend_name '/' mode ')'                            (www/HTTP)\n\nDetailed fields description :\n  - \"source_ip\" is the IP address of the client which initiated the connection.\n  - \"source_port\" is the TCP port of the client which initiated the connection.\n  - \"destination_ip\" is the IP address the client connected to.\n  - \"destination_port\" is the TCP port the client connected to.\n  - \"frontend_name\" is the name of the frontend (or listener) which received\n    and processed the connection.\n  - \"mode is the mode the frontend is operating (TCP or HTTP).\n\nIn case of a UNIX socket, the source and destination addresses are marked as\n\"unix:\" and the ports reflect the internal ID of the socket which accepted the\nconnection (the same ID as reported in the stats).\n\nIt is advised not to use this deprecated format for newer installations as it\nwill eventually disappear.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.2.2. TCP log format", "content": "### [8.2.2.](#8.2.2)TCP log format\n\n```\nThe TCP format is used when \"option tcplog\" is specified in the frontend, and\nis the recommended format for pure TCP proxies. It provides a lot of precious\ninformation for troubleshooting. Since this format includes timers and byte\ncounts, the log is normally emitted at the end of the session. It can be\nemitted earlier if \"option logasap\" is specified, which makes sense in most\nenvironments with long sessions such as remote terminals. Sessions which match\nthe \"monitor\" rules are never logged. It is also possible not to emit logs for\nsessions for which no data were exchanged between the client and the server, by\nspecifying \"option dontlognull\" in the frontend. Successful connections will\nnot be logged if \"option dontlog-normal\" is specified in the frontend.\n\nThe TCP log format is internally declared as a custom log format based on the\nexact following string, which may also be used as a basis to extend the format\nif required. Additionally the HAPROXY_TCP_LOG_FMT variable can be used instead.\nRefer to section 8.2.6 \"Custom log format\" to see how to use this:\n\n    # strict equivalent of \"option tcplog\"\n    log-format \"%ci:%cp [%t] %ft %b/%s %Tw/%Tc/%Tt %B %ts \\\n                %ac/%fc/%bc/%sc/%rc %sq/%bq\"\n    # or using the HAPROXY_TCP_LOG_FMT variable\n    log-format \"${HAPROXY_TCP_LOG_FMT}\"\n\nAnd the CLF log format is internally declared as a custom log format based on\nthis exact string:\n\n    # strict equivalent of \"option tcplog clf\"\n    log-format \"%{Q}o %{-Q}ci - - [%T] \\\"TCP \\\" 000 %B \\\"\\\" \\\"\\\" %cp \\\n                %ms %ft %b %s %Th %Tw %Tc %Tt %U %ts-- %ac %fc %bc \\\n                %sc %rc %sq %bq \\\"\\\" \\\"\\\" \"\n\nA few fields may slightly vary depending on some configuration options, those\nare marked with a star ('*') after the field name below.\n\n```\n\nExample :```\n\n    frontend fnt\n        mode tcp\n        option tcplog\n        log global\n        default_backend bck\n\n    backend bck\n        server srv1 127.0.0.1:8000\n\n>>> Feb  6 12:12:56 localhost \\\n      haproxy[14387]: 10.0.1.2:33313 [06/Feb/2009:12:12:51.443] fnt \\\n      bck/srv1 0/0/5007 212 -- 0/0/0/0/3 0/0\n\n```\n\n```\n  Field   Format                                Extract from the example above\n      1   process_name '[' pid ']:'                            haproxy[14387]:\n      2   client_ip ':' client_port                             10.0.1.2:33313\n      3   '[' accept_date ']'                       [06/Feb/2009:12:12:51.443]\n      4   frontend_name                                                    fnt\n      5   backend_name '/' server_name                                bck/srv1\n      6   Tw '/' Tc '/' Tt*                                           0/0/5007\n      7   bytes_read*                                                      212\n      8   termination_state                                                 --\n      9   actconn '/' feconn '/' beconn '/' srv_conn '/' retries*    0/0/0/0/3\n     10   srv_queue '/' backend_queue                                      0/0\n\nDetailed fields description :\n  - \"client_ip\" is the IP address of the client which initiated the TCP\n    connection to HAProxy. If the connection was accepted on a UNIX socket\n    instead, the IP address would be replaced with the word \"unix\". Note that\n    when the connection is accepted on a socket configured with \"accept-proxy\"\n    and the PROXY protocol is correctly used, or with a \"accept-netscaler-cip\"\n    and the NetScaler Client IP insertion protocol is correctly used, then the\n    logs will reflect the forwarded connection's information.\n\n  - \"client_port\" is the TCP port of the client which initiated the connection.\n    If the connection was accepted on a UNIX socket instead, the port would be\n    replaced with the ID of the accepting socket, which is also reported in the\n    stats interface.\n\n  - \"accept_date\" is the exact date when the connection was received by HAProxy\n    (which might be very slightly different from the date observed on the\n    network if there was some queuing in the system's backlog). This is usually\n    the same date which may appear in any upstream firewall's log. When used in\n    HTTP mode, the accept_date field will be reset to the first moment the\n    connection is ready to receive a new request (end of previous response for\n    HTTP/1, immediately after previous request for HTTP/2).\n\n  - \"frontend_name\" is the name of the frontend (or listener) which received\n    and processed the connection.\n\n  - \"backend_name\" is the name of the backend (or listener) which was selected\n    to manage the connection to the server. This will be the same as the\n    frontend if no switching rule has been applied, which is common for TCP\n    applications.\n\n  - \"server_name\" is the name of the last server to which the connection was\n    sent, which might differ from the first one if there were connection errors\n    and a redispatch occurred. Note that this server belongs to the backend\n    which processed the request. If the connection was aborted before reaching\n    a server, \"<NOSRV>\" is indicated instead of a server name.\n\n  - \"Tw\" is the total time in milliseconds spent waiting in the various queues.\n    It can be \"-1\" if the connection was aborted before reaching the queue.\n    See \"Timers\" below for more details.\n\n  - \"Tc\" is the total time in milliseconds spent waiting for the connection to\n    establish to the final server, including retries. It can be \"-1\" if the\n    connection was aborted before a connection could be established. See\n    \"Timers\" below for more details.\n\n  - \"Tt\" is the total time in milliseconds elapsed between the accept and the\n    last close. It covers all possible processing. There is one exception, if\n    \"option logasap\" was specified, then the time counting stops at the moment\n    the log is emitted. In this case, a '+' sign is prepended before the value,\n    indicating that the final one will be larger. See \"Timers\" below for more\n    details.\n\n  - \"bytes_read\" is the total number of bytes transmitted from the server to\n    the client when the log is emitted. If \"option logasap\" is specified, the\n    this value will be prefixed with a '+' sign indicating that the final one\n    may be larger. Please note that this value is a 64-bit counter, so log\n    analysis tools must be able to handle it without overflowing.\n\n  - \"termination_state\" is the condition the session was in when the session\n    ended. This indicates the session state, which side caused the end of\n    session to happen, and for what reason (timeout, error, ...). The normal\n    flags should be \"--\", indicating the session was closed by either end with\n    no data remaining in buffers. See below \"Stream state at disconnection\"\n    for more details.\n\n  - \"actconn\" is the total number of concurrent connections on the process when\n    the session was logged. It is useful to detect when some per-process system\n    limits have been reached. For instance, if actconn is close to 512 when\n    multiple connection errors occur, chances are high that the system limits\n    the process to use a maximum of 1024 file descriptors and that all of them\n    are used. See section 3 \"Global parameters\" to find how to tune the system.\n\n  - \"feconn\" is the total number of concurrent connections on the frontend when\n    the session was logged. It is useful to estimate the amount of resource\n    required to sustain high loads, and to detect when the frontend's \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\"\n    has been reached. Most often when this value increases by huge jumps, it is\n    because there is congestion on the backend servers, but sometimes it can be\n    caused by a denial of service attack.\n\n  - \"beconn\" is the total number of concurrent connections handled by the\n    backend when the session was logged. It includes the total number of\n    concurrent connections active on servers as well as the number of\n    connections pending in queues. It is useful to estimate the amount of\n    additional servers needed to support high loads for a given application.\n    Most often when this value increases by huge jumps, it is because there is\n    congestion on the backend servers, but sometimes it can be caused by a\n    denial of service attack.\n\n  - \"srv_conn\" is the total number of concurrent connections still active on\n    the server when the session was logged. It can never exceed the server's\n    configured \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" parameter. If this value is very often close or equal\n    to the server's \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\", it means that traffic regulation is involved a\n    lot, meaning that either the server's maxconn value is too low, or that\n    there aren't enough servers to process the load with an optimal response\n    time. When only one of the server's \"srv_conn\" is high, it usually means\n    that this server has some trouble causing the connections to take longer to\n    be processed than on other servers.\n\n  - \"retries\" is the number of connection retries experienced by this session\n    when trying to connect to the server. It must normally be zero, unless a\n    server is being stopped at the same moment the connection was attempted.\n    Frequent retries generally indicate either a network problem between\n    HAProxy and the server, or a misconfigured system backlog on the server\n    preventing new connections from being queued. This field may optionally be\n    prefixed with a '+' sign, indicating that the session has experienced a\n    redispatch after the maximal retry count has been reached on the initial\n    server. In this case, the server name appearing in the log is the one the\n    connection was redispatched to, and not the first one, though both may\n    sometimes be the same in case of hashing for instance. So as a general rule\n    of thumb, when a '+' is present in front of the retry count, this count\n    should not be attributed to the logged server.\n\n  - \"srv_queueThis keyword is available in sections :ConvertersFetching samples from internal states\" is the total number of requests which were processed before\n    this one in the server queue. It is zero when the request has not gone\n    through the server queue. It makes it possible to estimate the approximate\n    server's response time by dividing the time spent in queue by the number of\n    requests in the queue. It is worth noting that if a session experiences a\n    redispatch and passes through two server queues, their positions will be\n    cumulative. A request should not pass through both the server queue and the\n    backend queue unless a redispatch occurs.\n\n  - \"backend_queue\" is the total number of requests which were processed before\n    this one in the backend's global queue. It is zero when the request has not\n    gone through the global queue. It makes it possible to estimate the average\n    queue length, which easily translates into a number of missing servers when\n    divided by a server's \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" parameter. It is worth noting that if a\n    session experiences a redispatch, it may pass twice in the backend's queue,\n    and then both positions will be cumulative. A request should not pass\n    through both the server queue and the backend queue unless a redispatch\n    occurs.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.2.3. HTTP log format", "content": "### [8.2.3.](#8.2.3)HTTP log format\n\n```\nThe HTTP format is the most complete and the best suited for HTTP proxies. It\nis enabled by when \"option httplog\" is specified in the frontend. It provides\nthe same level of information as the TCP format with additional features which\nare specific to the HTTP protocol. Just like the TCP format, the log is usually\nemitted at the end of the stream, unless \"option logasap\" is specified, which\ngenerally only makes sense for download sites. A stream which matches the\n\"monitor\" rules will never logged. It is also possible not to log streams for\nwhich no data were sent by the client by specifying \"option dontlognull\" in the\nfrontend. Successful connections will not be logged if \"option dontlog-normal\"\nis specified in the frontend.\n\nThe HTTP log format is internally declared as a custom log format based on the\nexact following string, which may also be used as a basis to extend the format\nif required. Additionally the HAPROXY_HTTP_LOG_FMT variable can be used\ninstead. Refer to section 8.2.6 \"Custom log format\" to see how to use this:\n\n    # strict equivalent of \"option httplog\"\n    log-format \"%ci:%cp [%tr] %ft %b/%s %TR/%Tw/%Tc/%Tr/%Ta %ST %B %CC \\\n                %CS %tsc %ac/%fc/%bc/%sc/%rc %sq/%bq %hr %hs %{+Q}r\"\n    # or using the HAPROXY_HTTP_LOG_FMT variable\n    log-format \"${HAPROXY_HTTP_LOG_FMT}\"\n\nAnd the CLF log format is internally declared as a custom log format based on\nthis exact string:\n\n    # strict equivalent of \"option httplog clf\"\n    log-format \"%{+Q}o %{-Q}ci - - [%trg] %r %ST %B \\\"\\\" \\\"\\\" %cp \\\n                %ms %ft %b %s %TR %Tw %Tc %Tr %Ta %tsc %ac %fc \\\n                %bc %sc %rc %sq %bq %CC %CS %hrl %hsl\"\n\nMost fields are shared with the TCP log, some being different. A few fields may\nslightly vary depending on some configuration options. Those ones are marked\nwith a star ('*') after the field name below.\n\n```\n\nExample :```\n\n    frontend http-in\n        mode http\n        option httplog\n        log global\n        default_backend bck\n\n    backend static\n        server srv1 127.0.0.1:8000\n\n>>> Feb  6 12:14:14 localhost \\\n      haproxy[14389]: 10.0.1.2:33317 [06/Feb/2009:12:14:14.655] http-in \\\n      static/srv1 10/0/30/69/109 200 2750 - - ---- 1/1/1/1/0 0/0 {1wt.eu} \\\n      {} \"GET /index.html HTTP/1.1\"\n\n```\n\n```\n  Field   Format                                Extract from the example above\n      1   process_name '[' pid ']:'                            haproxy[14389]:\n      2   client_ip ':' client_port                             10.0.1.2:33317\n      3   '[' request_date ']'                      [06/Feb/2009:12:14:14.655]\n      4   frontend_name                                                http-in\n      5   backend_name '/' server_name                             static/srv1\n      6   TR '/' Tw '/' Tc '/' Tr '/' Ta*                       10/0/30/69/109\n      7   status_code                                                      200\n      8   bytes_read*                                                     2750\n      9   captured_request_cookie                                            -\n     10   captured_response_cookie                                           -\n     11   termination_state                                               ----\n     12   actconn '/' feconn '/' beconn '/' srv_conn '/' retries*    1/1/1/1/0\n     13   srv_queue '/' backend_queue                                      0/0\n     14   '{' captured_request_headers* '}'                   {haproxy.1wt.eu}\n     15   '{' captured_response_headers* '}'                                {}\n     16   '\"' http_request '\"'                      \"GET /index.html HTTP/1.1\"\n\nDetailed fields description :\n  - \"client_ip\" is the IP address of the client which initiated the TCP\n    connection to HAProxy. If the connection was accepted on a UNIX socket\n    instead, the IP address would be replaced with the word \"unix\". Note that\n    when the connection is accepted on a socket configured with \"accept-proxy\"\n    and the PROXY protocol is correctly used, or with a \"accept-netscaler-cip\"\n    and the NetScaler Client IP insertion protocol is correctly used, then the\n    logs will reflect the forwarded connection's information.\n\n  - \"client_port\" is the TCP port of the client which initiated the connection.\n    If the connection was accepted on a UNIX socket instead, the port would be\n    replaced with the ID of the accepting socket, which is also reported in the\n    stats interface.\n\n  - \"request_date\" is the exact date when the first byte of the HTTP request\n    was received by HAProxy (log field %tr).\n\n  - \"frontend_name\" is the name of the frontend (or listener) which received\n    and processed the connection.\n\n  - \"backend_name\" is the name of the backend (or listener) which was selected\n    to manage the connection to the server. This will be the same as the\n    frontend if no switching rule has been applied.\n\n  - \"server_name\" is the name of the last server to which the connection was\n    sent, which might differ from the first one if there were connection errors\n    and a redispatch occurred. Note that this server belongs to the backend\n    which processed the request. If the request was aborted before reaching a\n    server, \"<NOSRV>\" is indicated instead of a server name. If the request was\n    intercepted by the stats subsystem, \"<STATS>\" is indicated instead.\n\n  - \"TR\" is the total time in milliseconds spent waiting for a full HTTP\n    request from the client (not counting body) after the first byte was\n    received. It can be \"-1\" if the connection was aborted before a complete\n    request could be received or a bad request was received. It should\n    always be very small because a request generally fits in one single packet.\n    Large times here generally indicate network issues between the client and\n    HAProxy or requests being typed by hand. See section 8.4 \"Timing Events\"\n    for more details.\n\n  - \"Tw\" is the total time in milliseconds spent waiting in the various queues.\n    It can be \"-1\" if the connection was aborted before reaching the queue.\n    See section 8.4 \"Timing Events\" for more details.\n\n  - \"Tc\" is the total time in milliseconds spent waiting for the connection to\n    establish to the final server, including retries. It can be \"-1\" if the\n    request was aborted before a connection could be established. See section\n    8.4 \"Timing Events\" for more details.\n\n  - \"Tr\" is the total time in milliseconds spent waiting for the server to send\n    a full HTTP response, not counting data. It can be \"-1\" if the request was\n    aborted before a complete response could be received. It generally matches\n    the server's processing time for the request, though it may be altered by\n    the amount of data sent by the client to the server. Large times here on\n    \"GET\" requests generally indicate an overloaded server. See section 8.4\n    \"Timing Events\" for more details.\n\n  - \"Ta\" is the time the request remained active in HAProxy, which is the total\n    time in milliseconds elapsed between the first byte of the request was\n    received and the last byte of response was sent. It covers all possible\n    processing except the handshake (see Th) and idle time (see Ti). There is\n    one exception, if \"option logasap\" was specified, then the time counting\n    stops at the moment the log is emitted. In this case, a '+' sign is\n    prepended before the value, indicating that the final one will be larger.\n    See section 8.4 \"Timing Events\" for more details.\n\n  - \"status_code\" is the HTTP status code returned to the client. This status\n    is generally set by the server, but it might also be set by HAProxy when\n    the server cannot be reached or when its response is blocked by HAProxy.\n\n  - \"bytes_read\" is the total number of bytes transmitted to the client when\n    the log is emitted. This does include HTTP headers. If \"option logasap\" is\n    specified, this value will be prefixed with a '+' sign indicating that\n    the final one may be larger. Please note that this value is a 64-bit\n    counter, so log analysis tools must be able to handle it without\n    overflowing.\n\n  - \"captured_request_cookie\" is an optional \"name=value\" entry indicating that\n    the client had this cookie in the request. The cookie name and its maximum\n    length are defined by the \"capture cookie\" statement in the frontend\n    configuration. The field is a single dash ('-') when the option is not\n    set. Only one cookie may be captured, it is generally used to track session\n    ID exchanges between a client and a server to detect session crossing\n    between clients due to application bugs. For more details, please consult\n    the section \"Capturing HTTP headers and cookies\" below.\n\n  - \"captured_response_cookie\" is an optional \"name=value\" entry indicating\n    that the server has returned a cookie with its response. The cookie name\n    and its maximum length are defined by the \"capture cookie\" statement in the\n    frontend configuration. The field is a single dash ('-') when the option is\n    not set. Only one cookie may be captured, it is generally used to track\n    session ID exchanges between a client and a server to detect session\n    crossing between clients due to application bugs. For more details, please\n    consult the section \"Capturing HTTP headers and cookies\" below.\n\n  - \"termination_state\" is the condition the stream was in when the stream\n    ended. This indicates the stream state, which side caused the end of\n    stream to happen, for what reason (timeout, error, ...), just like in TCP\n    logs, and information about persistence operations on cookies in the last\n    two characters. The normal flags should begin with \"--\", indicating the\n    stream was closed by either end with no data remaining in buffers. See\n    below \"Stream state at disconnection\" for more details.\n\n  - \"actconn\" is the total number of concurrent connections on the process when\n    the stream was logged. It is useful to detect when some per-process system\n    limits have been reached. For instance, if actconn is close to 512 or 1024\n    when multiple connection errors occur, chances are high that the system\n    limits the process to use a maximum of 1024 file descriptors and that all\n    of them are used. See section 3 \"Global parameters\" to find how to tune the\n    system.\n\n  - \"feconn\" is the total number of concurrent connections on the frontend when\n    the stream was logged. It is useful to estimate the amount of resource\n    required to sustain high loads, and to detect when the frontend's \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\"\n    has been reached. Most often when this value increases by huge jumps, it is\n    because there is congestion on the backend servers, but sometimes it can be\n    caused by a denial of service attack.\n\n  - \"beconn\" is the total number of concurrent connections handled by the\n    backend when the stream was logged. It includes the total number of\n    concurrent connections active on servers as well as the number of\n    connections pending in queues. It is useful to estimate the amount of\n    additional servers needed to support high loads for a given application.\n    Most often when this value increases by huge jumps, it is because there is\n    congestion on the backend servers, but sometimes it can be caused by a\n    denial of service attack.\n\n  - \"srv_conn\" is the total number of concurrent connections still active on\n    the server when the stream was logged. It can never exceed the server's\n    configured \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" parameter. If this value is very often close or equal\n    to the server's \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\", it means that traffic regulation is involved a\n    lot, meaning that either the server's maxconn value is too low, or that\n    there aren't enough servers to process the load with an optimal response\n    time. When only one of the server's \"srv_conn\" is high, it usually means\n    that this server has some trouble causing the requests to take longer to be\n    processed than on other servers.\n\n  - \"retries\" is the number of connection retries experienced by this stream\n    when trying to connect to the server. It must normally be zero, unless a\n    server is being stopped at the same moment the connection was attempted.\n    Frequent retries generally indicate either a network problem between\n    HAProxy and the server, or a misconfigured system backlog on the server\n    preventing new connections from being queued. This field may optionally be\n    prefixed with a '+' sign, indicating that the stream has experienced a\n    redispatch after the maximal retry count has been reached on the initial\n    server. In this case, the server name appearing in the log is the one the\n    connection was redispatched to, and not the first one, though both may\n    sometimes be the same in case of hashing for instance. So as a general rule\n    of thumb, when a '+' is present in front of the retry count, this count\n    should not be attributed to the logged server.\n\n  - \"srv_queueThis keyword is available in sections :ConvertersFetching samples from internal states\" is the total number of requests which were processed before\n    this one in the server queue. It is zero when the request has not gone\n    through the server queue. It makes it possible to estimate the approximate\n    server's response time by dividing the time spent in queue by the number of\n    requests in the queue. It is worth noting that if a stream experiences a\n    redispatch and passes through two server queues, their positions will be\n    cumulative. A request should not pass through both the server queue and the\n    backend queue unless a redispatch occurs.\n\n  - \"backend_queue\" is the total number of requests which were processed before\n    this one in the backend's global queue. It is zero when the request has not\n    gone through the global queue. It makes it possible to estimate the average\n    queue length, which easily translates into a number of missing servers when\n    divided by a server's \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" parameter. It is worth noting that if a\n    stream experiences a redispatch, it may pass twice in the backend's queue,\n    and then both positions will be cumulative. A request should not pass\n    through both the server queue and the backend queue unless a redispatch\n    occurs.\n\n  - \"captured_request_headers\" is a list of headers captured in the request due\n    to the presence of the \"capture request header\" statement in the frontend.\n    Multiple headers can be captured, they will be delimited by a vertical bar\n    ('|'). When no capture is enabled, the braces do not appear, causing a\n    shift of remaining fields. It is important to note that this field may\n    contain spaces, and that using it requires a smarter log parser than when\n    it's not used. Please consult the section \"Capturing HTTP headers and\n    cookies\" below for more details.\n\n  - \"captured_response_headers\" is a list of headers captured in the response\n    due to the presence of the \"capture response header\" statement in the\n    frontend. Multiple headers can be captured, they will be delimited by a\n    vertical bar ('|'). When no capture is enabled, the braces do not appear,\n    causing a shift of remaining fields. It is important to note that this\n    field may contain spaces, and that using it requires a smarter log parser\n    than when it's not used. Please consult the section \"Capturing HTTP headers\n    and cookies\" below for more details.\n\n  - \"http_request\" is the complete HTTP request line, including the method,\n    request and HTTP version string. Non-printable characters are encoded (see\n    below the section \"Non-printable characters\"). This is always the last\n    field, and it is always delimited by quotes and is the only one which can\n    contain quotes. If new fields are added to the log format, they will be\n    added before this field. This field might be truncated if the request is\n    huge and does not fit in the standard syslog buffer (1024 characters). This\n    is the reason why this field must always remain the last one.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.2.4. HTTPS log format", "content": "### [8.2.4.](#8.2.4)HTTPS log format\n\n```\nThe HTTPS format is the best suited for HTTP over SSL connections. It is an\nextension of the HTTP format (see section 8.2.3) to which SSL related\ninformation are added. It is enabled when \"option httpslog\" is specified in the\nfrontend. Just like the TCP and HTTP formats, the log is usually emitted at the\nend of the stream, unless \"option logasap\" is specified. A stream which\nmatches the \"monitor\" rules will never logged. It is also possible not to log\nstreams for which no data were sent by the client by specifying \"option\ndontlognull\" in the frontend. Successful connections will not be logged if\n\"option dontlog-normal\" is specified in the frontend.\n\nThe HTTPS log format is internally declared as a custom log format based on the\nexact following string, which may also be used as a basis to extend the format\nif required. Additionally the HAPROXY_HTTPS_LOG_FMT variable can be used\ninstead. Refer to section 8.2.6 \"Custom log format\" to see how to use this:\n\n    # strict equivalent of \"option httpslog\"\n    log-format \"%ci:%cp [%tr] %ft %b/%s %TR/%Tw/%Tc/%Tr/%Ta %ST %B %CC \\\n               %CS %tsc %ac/%fc/%bc/%sc/%rc %sq/%bq %hr %hs %{+Q}r \\\n               %[fc_err]/%[ssl_fc_err,hex]/%[ssl_c_err]/\\\n               %[ssl_c_ca_err]/%[ssl_fc_is_resumed] %[ssl_fc_sni]/%sslv/%sslc\"\n    # or using the HAPROXY_HTTPS_LOG_FMT variable\n    log-format \"${HAPROXY_HTTPS_LOG_FMT}\"\n\nThis format is basically the HTTP one (see section 8.2.3) with new fields\nappended to it. The new fields (lines 17 and 18) will be detailed here. For the\nHTTP ones, refer to the HTTP section.\n\n```\n\nExample :```\n\n    frontend https-in\n        mode http\n        option httpslog\n        log global\n        bind *:443 ssl crt mycerts/srv.pem ...\n        default_backend bck\n\n    backend static\n        server srv1 127.0.0.1:8000 ssl crt mycerts/clt.pem ...\n\n>>> Feb  6 12:14:14 localhost \\\n      haproxy[14389]: 10.0.1.2:33317 [06/Feb/2009:12:14:14.655] https-in \\\n      static/srv1 10/0/30/69/109 200 2750 - - ---- 1/1/1/1/0 0/0 {1wt.eu} \\\n      {} \"GET /index.html HTTP/1.1\" 0/0/0/0/0 \\\n      1wt.eu/TLSv1.3/TLS_AES_256_GCM_SHA384\n\n```\n\n```\n  Field   Format                                  Extract from the example above\n      1   process_name '[' pid ']:'                              haproxy[14389]:\n      2   client_ip ':' client_port                               10.0.1.2:33317\n      3   '[' request_date ']'                        [06/Feb/2009:12:14:14.655]\n      4   frontend_name                                                 https-in\n      5   backend_name '/' server_name                               static/srv1\n      6   TR '/' Tw '/' Tc '/' Tr '/' Ta*                         10/0/30/69/109\n      7   status_code                                                        200\n      8   bytes_read*                                                       2750\n      9   captured_request_cookie                                              -\n     10   captured_response_cookie                                             -\n     11   termination_state                                                 ----\n     12   actconn '/' feconn '/' beconn '/' srv_conn '/' retries*      1/1/1/1/0\n     13   srv_queue '/' backend_queue                                        0/0\n     14   '{' captured_request_headers* '}'                     {haproxy.1wt.eu}\n     15   '{' captured_response_headers* '}'                                  {}\n     16   '\"' http_request '\"'                        \"GET /index.html HTTP/1.1\"\n     17   fc_err '/' ssl_fc_err '/' ssl_c_err\n          '/' ssl_c_ca_err '/' ssl_fc_is_resumed                       0/0/0/0/0\n     18   ssl_fc_sni '/' ssl_version\n          '/' ssl_ciphers                  1wt.eu/TLSv1.3/TLS_AES_256_GCM_SHA384\n\nDetailed fields description :\n  - \"fc_err\" is the status of the connection on the frontend's side. It\n    corresponds to the \"fc_err\" sample fetch. See the \"fc_err\" and \"fc_err_str\"\n    sample fetch functions for more information.\n\n  - \"ssl_fc_err\" is the last error of the first SSL error stack that was\n    raised on the connection from the frontend's perspective. It might be used\n    to detect SSL handshake errors for instance. It will be 0 if everything\n    went well. See the \"ssl_fc_err\" sample fetch's description for more\n    information.\n\n  - \"ssl_c_err\" is the status of the client's certificate verification process.\n    The handshake might be successful while having a non-null verification\n    error code if it is an ignored one. See the \"ssl_c_err\" sample fetch and\n    the \"crt-ignore-err\" option.\n\n  - \"ssl_c_ca_err\" is the status of the client's certificate chain verification\n    process.  The handshake might be successful while having a non-null\n    verification error code if it is an ignored one. See the \"ssl_c_ca_err\"\n    sample fetch and the \"ca-ignore-err\" option.\n\n  - \"ssl_fc_is_resumed\" is true if the incoming TLS session was resumed with\n    the stateful cache or a stateless ticket. Don't forgot that a TLS session\n    can be shared by multiple requests.\n\n  - \"ssl_fc_sni\" is the SNI (Server Name Indication) presented by the client\n    to select the certificate to be used. It usually matches the host name for\n    the first request of a connection. An absence of this field may indicate\n    that the SNI was not sent by the client, and will lead haproxy to use the\n    default certificate, or to reject the connection in case of strict-sni.\n\n  - \"ssl_version\" is the SSL version of the frontend.\n\n  - \"ssl_ciphers\" is the SSL cipher used for the connection.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.2.5. Error log format", "content": "### [8.2.5.](#8.2.5)Error log format\n\n```\nWhen an incoming connection fails due to an SSL handshake or an invalid PROXY\nprotocol header, HAProxy will log the event using a shorter, fixed line format,\nunless a dedicated error log format is defined through an \"error-log-format\"\nline. By default, logs are emitted at the LOG_INFO level, unless the option\n\"log-separate-errors\" is set in the backend, in which case the LOG_ERR level\nwill be used. Connections on which no data are exchanged (e.g. probes) are not\nlogged if the \"dontlognull\" option is set.\n\nThe default format looks like this :\n\n    >>> Dec  3 18:27:14 localhost \\\n          haproxy[6103]: 127.0.0.1:56059 [03/Dec/2012:17:35:10.380] frt/f1: \\\n          Connection error during SSL handshake\n\n  Field   Format                                Extract from the example above\n      1   process_name '[' pid ']:'                             haproxy[6103]:\n      2   client_ip ':' client_port                            127.0.0.1:56059\n      3   '[' accept_date ']'                       [03/Dec/2012:17:35:10.380]\n      4   frontend_name \"/\" bind_name \":\"                              frt/f1:\n      5   message                        Connection error during SSL handshake\n\nThese fields just provide minimal information to help debugging connection\nfailures.\n\nBy using the \"error-log-format\" directive, the legacy log format described\nabove will not be used anymore, and all error log lines will follow the\ndefined format.\n\nAn example of reasonably complete error-log-format follows, it will report the\nsource address and port, the connection accept() date, the frontend name, the\nnumber of active connections on the process and on thit frontend, haproxy's\ninternal error identifier on the front connection, the hexadecimal OpenSSL\nerror number (that can be copy-pasted to \"openssl errstr\" for full decoding),\nthe client certificate extraction status (0 indicates no error), the client\ncertificate validation status using the CA (0 indicates no error), a boolean\nindicating if the connection is new or was resumed, the optional server name\nindication (SNI) provided by the client, the SSL version name and the SSL\nciphers used on the connection, if any. Note that backend connection errors\nare never reported here since in order for a backend connection to fail, it\nwould have passed through a successful stream, hence will be available as\nregular traffic log (see option httplog or option httpslog).\n\n   # detailed frontend connection error log\n   error-log-format \"%ci:%cp [%tr] %ft %ac/%fc %[fc_err]/\\\n         %[ssl_fc_err,hex]/%[ssl_c_err]/%[ssl_c_ca_err]/%[ssl_fc_is_resumed] \\\n         %[ssl_fc_sni]/%sslv/%sslc\"\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.2.6. Custom log format", "content": "### [8.2.6.](#8.2.6)Custom log format\n\n```\nHistorically, custom log formats were only used to produce logs. But their\nconvenience when used to produce a string by assembling multiple complex\nexpressions has got them adopted by many directives which used to take only\na string in argument and which may now also take an such a Custom log format\ndefinition. Such arguments, which are commonly designated by \"<fmt>\" in this\ndocument, are defined exactly the same way as the argument to the \"log-format\"\ndirective, described here.\n\nWhen it comes to logs and when the default log formats are not sufficient, it\nis possible to define new ones in very fine details. As creating a log-format\nfrom scratch is not always a trivial task, it is strongly recommended to first\nhave a look at the existing formats (\"option tcplog\", \"option httplog\", \"option\nhttpslog\"), pick the one looking the closest to the expectation, copy its\n\"log-format\" equivalent string and adjust it.\n\nA Custom log format definition is a single argument from a configuration\nperspective. This means that it may not contain blanks (spaces or tabs), unless\nthese blanks are escaped using the backslash character ('\\'), or the whole\ndefinition is enclosed between quotes (which is the recommended way to use\nthem). The use of unquoted format strings is not recommended anymore as history\nhas shown that it was very error prone since a single missing backslash\ncharacter could result in silent truncation of the format. Such configurations\nare still commonly encountered due to the massive adoption of log formats after\nversion 1.5-dev9, 3 years before quotes were usable, but it is recommended to\nconvert them to quoted strings and to drop the backslashes now.\n\nA log format definition is made of any number of log format items separated\nby text and spaces. A log format item starts with character '%'. In order to\nemit a verbatim '%', it must be preceded by another '%' resulting in '%%'.\n\nLogformat items may either be aliases or sample expressions:\n\nIf an item is named between square brackets ('[' .. ']') then it is used\nas a sample expression rule (see section 7.3). This it useful to add some\nless common information such as the client's SSL certificate's DN, or to log\nthe key that would be used to store an entry into a stick table. It is also\ncommonly used with non-log actions (header manipulation, variables etc).\n\nElse if the item is named using an alpha-numerical name, it is an alias.\n(Refer to the table below for the list of available aliases)\n\nItems can take arguments using braces ('{}'), and multiple arguments are\nseparated by commas within the braces. Flags may be added or removed by\nprefixing them with a '+' or '-' sign (see below for the list of available\nflags).\n\nSpecial alias \"%o\" may be used to propagate its flags to all other\nlogformat items on the same format string. This is particularly handy with\nquoted (\"Q\") and escaped (\"E\") string formats.\n\nSpecial alias \"%OG\" may be used to retrieve the log origin (when / where\nthe log was generated) in a human readable format. It is particularly useful\nwith \"option logasap\" because some log variables or sample fetches could report\nincomplete values or behave differently depending on when / where the logformat\nexpression was evaluated. Possible values are:\n  - \"sess_error\": log was generated during session error handling\n  - \"sess_killed\": log was generated during session abortion (killed\n    embryonic session)\n  - \"txn_accept\": log was generated right after frontend conn was accepted\n  - \"txn_request\": log was generated after client request was received\n  - \"txn_connect\": log was generated after backend connection establishment\n  - \"txn_response\": log was generated during server response handling\n  - \"txn_close\": log was generated at the final txn step, before closing\n  - \"unspec\": unknown or not specified\n\"%OG\" is only relevant in logging context.\n\nItems can optionally be named using ('()'). The name must be provided right\nafter '%' (before arguments). It will automatically be used as key name when\nencoding flag such as \"json\" or \"cbor\" is set. When no encoding flag is\nspecified (default), item name will be ignored. It is also possible to force\nthe item's output to a given type by appending ':type' after the name, like\nthis: %(itemname:itemtype)aliasname or %(itemname:itemtype)[expr] where\nitemtype may be 'str', 'sint' or 'bool'. Specifying the type is only relevant\nwhen an encoding method is used. Also, it is supported to provide an empty name\nto force the output type on an anonymous item: %(:itemtype), ie: when encoding\nis not set globally, see flags definitions below for more information.\n\nDue to the original goal of custom log formats to be used for logging only,\nthere is a special case made of non-printable and unsafe characters (those\noutside ASCII codes 32 to 126 plus a few other ones) depending where they are\nused. Section 8.6 describes what's done exactly for logs in order to make sure\none will not send unsafe codes that alter the readability of the output in a\nterminal. When used to form header fields, health checks or payload responses,\nthe rules are less strict and only characters forbidden in HTTP header fields\nare replaced by their hexadecimal encoding preceded by character '%'. This is\nnormally not a problem, but it might affect the output when the character was\nexpected to be reproduced verbatim (e.g. when building an error page or a full\nresponse payload, where line feeds could appear as \"%0A\").\n\nNote: in configuration directives \"log-format\", \"log-format-sd\" and\n\"unique-id-format\", spaces are considered as delimiters and are merged.\n\nNote: when using the RFC5424 syslog message format, the characters '\"',\n'\\' and ']' inside PARAM-VALUE should be escaped with '\\' as prefix (see\nhttps://tools.ietf.org/html/rfc5424#section-6.3.3 for more details). In\nsuch cases, the use of the flag \"E\" should be considered.\n\nSupported item flags are (may be enabled/disabled from item's arguments):\n  * Q: quote a string\n  * X: hexadecimal representation (IPs, Ports, %Ts, %rt, %pid)\n  * E: escape characters '\"', '\\' and ']' in a string with '\\' as prefix\n       (intended purpose is for the RFC5424 structured-data log formats)\n  * bin: try to preserve binary data, this can be useful with sample\n         expressions that output binary data in order to preserve the original\n         data. Be careful however, because it can obviously generate non-\n         printable chars, including NULL-byte, which most syslog endpoints\n         don't expect. Thus it is mainly intended for use with set-var-fmt,\n         rings and binary-capable log endpoints.\n         This option can only be set globally (with %o), it will be ignored\n         if set on an individual item's options.\n  * json: automatically encode value in JSON format\n          (when set globally, only named logformat items are considered)\n          Incomplete numerical values (e.g.: '%B' when logasap is used),\n          which are normally prefixed with '+' without encoding, will be\n          encoded as-is. Also, '+E' option will be ignored.\n  * cbor: automatically encode value in CBOR format\n          (when set globally, only named logformat items are considered)\n          By default, cbor encoded data is represented in HEX form so\n          that it remains printable on stdout an can be used with usual\n          syslog endpoints.\n          As with json encoding, incomplete numerical values will be encoded\n          as-is and '+E' option will be ignored.\n          When combined with '+bin' option, it will directly generate raw\n          binary CBOR payload. Be careful, because it will obviously generate\n          non-printable chars, thus it is mainly intended for use with\n          set-var-fmt, rings and binary-capable log endpoints.\n\n```\n\nExample:```\n\nlog-format %T\\ %t\\ Some\\ Text\nlog-format %{+Q}o\\ %t\\ %s\\ %{-Q}r\n\nlog-format-sd %{+Q,+E}o\\ [exampleSDID@1234\\ header=%[capture.req.hdr(0)]]\n\nlog-format \"%{+json}o %(request)r %(custom_expr)[str(custom)]\"\nlog-format \"%{+cbor}o %(request)r %(custom_expr)[str(custom)]\"\n\n```\n\n```\nPlease refer to the table below for currently defined aliases :\n\n  +---+------+------------------------------------------------------+---------+\n  | R | alias| field name (8.2.2 and 8.2.3 for description)         | type    |\n  |   |      | sample fetch alternative                             |         |\n  +===+======+======================================================+=========+\n  |   | %o   | special, apply flags on all following items          |         |\n  +---+------+------------------------------------------------------+---------+\n  |                          date formats                                     |\n  +---+------+------------------------------------------------------+---------+\n  |   | %T   | Accept date UTC + timezone                           |         |\n  |   |      | %[accept_date,utime(\"%d/%b/%Y:%H:%M:%S %z\")]         | date    |\n  +---+------+------------------------------------------------------+---------+\n  |   | %Tl  | Accept date local + timezone                         |         |\n  |   |      | %[accept_date,ltime(\"%d/%b/%Y:%H:%M:%S %z\")]         | date    |\n  +---+------+------------------------------------------------------+---------+\n  |   | %Ts  | Accept date as a UNIX timestamp                      | numeric |\n  |   |      | %[accept_date]                                       |         |\n  +---+------+------------------------------------------------------+---------+\n  |   | %t   | Accept date local (with millisecond resolution)      |         |\n  |   |      | %[accept_date(ms),ms_ltime(\"%d/%b/%Y:%H:%M:%S.%3N\")] | date    |\n  +---+------+------------------------------------------------------+---------+\n  |   | %ms  | Accept date milliseconds                             |         |\n  |   |      | %[accept_date(ms),ms_utime(\"%3N\")]                   | numeric |\n  +---+------+------------------------------------------------------+---------+\n  | H | %tr  | Request date local (with millisecond resolution)     |         |\n  |   |      | %[request_date(ms),ms_ltime(\"%d/%b/%Y:%H:%M:%S.%3N\")]| date    |\n  +---+------+------------------------------------------------------+---------+\n  | H | %trg | Request date UTC + timezone                          |         |\n  |   |      | %[request_date,utime(\"%d/%b/%Y:%H:%M:%S %z\")]        | date    |\n  +---+------+------------------------------------------------------+---------+\n  | H | %trl | Request date local + timezone                        |         |\n  |   |      | %[request_date,ltime(\"%d/%b/%Y:%H:%M:%S %z\")]        | date    |\n  +---+------+------------------------------------------------------+---------+\n  |                          Timing events                                    |\n  +---+------+------------------------------------------------------+---------+\n  | H | %Ta  | Active time of the request (from TR to end)          |         |\n  |   |      | %[txn.timer.total]                                   | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %Tc  | Tc                                                   |         |\n  |   |      | %[bc.timer.connect]                                  | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %Td  | Td = Tt - (Tq + Tw + Tc + Tr)                        |         |\n  |   |      | %[res.timer.data]                                    | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %Th  | connection handshake time (SSL, PROXY proto)         |         |\n  |   |      | %[fc.timer.handshake]                                | numeric |\n  +---+------+------------------------------------------------------+---------+\n  | H | %Ti  | idle time before the HTTP request                    |         |\n  |   |      | %[req.timer.idle]                                    | numeric |\n  +---+------+------------------------------------------------------+---------+\n  | H | %Tq  | Th + Ti + TR                                         |         |\n  |   |      | %[req.timer.tq]                                      | numeric |\n  +---+------+------------------------------------------------------+---------+\n  | H | %TR  | time to receive the full request from 1st byte       |         |\n  |   |      | %[req.timer.hdr]                                     | numeric |\n  +---+------+------------------------------------------------------+---------+\n  | H | %Tr  | Tr (response time)                                   |         |\n  |   |      | %[res.timer.hdr]                                     | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %Tt  | Tt                                                   |         |\n  |   |      | %[fc.timer.total]                                    | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %Tu  | Tu                                                   |         |\n  |   |      | %[txn.timer.user]                                    | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %Tw  | Tw                                                   |         |\n  |   |      | %[req.timer.queue]                                   | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |                          Others                                           |\n  +---+------+------------------------------------------------------+---------+\n  |   | %B   | bytes_read           (from server to client)         | numeric |\n  |   |      | %[bytes_out]                                         |         |\n  +---+------+------------------------------------------------------+---------+\n  | H | %CC  | captured_request_cookie                              | string  |\n  +---+------+------------------------------------------------------+---------+\n  | H | %CS  | captured_response_cookie                             | string  |\n  +---+------+------------------------------------------------------+---------+\n  |   | %H   | hostname                                             | string  |\n  |   |      | %[hostname]                                          |         |\n  +---+------+------------------------------------------------------+---------+\n  | H | %HM  | HTTP method (ex: POST)                               | string  |\n  |   |      | %[method]\n  +---+------+------------------------------------------------------+---------+\n  | H | %HP  | HTTP request URI without query string                | string  |\n  +---+------+------------------------------------------------------+---------+\n  | H | %HPO | HTTP path only (without host nor query string)       | string  |\n  +---+------+------------------------------------------------------+---------+\n  | H | %HQ  | HTTP request URI query string (ex: ?bar=baz)         | string  |\n  |   |      | ?%[query]                                            |         |\n  +---+------+------------------------------------------------------+---------+\n  | H | %HU  | HTTP request URI (ex: /foo?bar=baz)                  | string  |\n  +---+------+------------------------------------------------------+---------+\n  | H | %HV  | HTTP version (ex: HTTP/1.0)                          | string  |\n  |   |      | HTTP/%[req.ver]                                      |         |\n  +---+------+------------------------------------------------------+---------+\n  |   | %ID  | unique-id                                            | string  |\n  |   |      | %[unique-id]                                         |         |\n  +---+------+------------------------------------------------------+---------+\n  |   | %ST  | status_code                                          | numeric |\n  |   |      | %[txn.status]                                        |         |\n  +---+------+------------------------------------------------------+---------+\n  |   | %U   | bytes_uploaded       (from client to server)         | numeric |\n  |   |      | %[bytes_in]                                          |         |\n  +---+------+------------------------------------------------------+---------+\n  |   | %ac  | actconn                                              |         |\n  |   |      | %[act_conn]                                          | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %b   | backend_name                                         |         |\n  |   |      | %[be_name]                                           | string  |\n  +---+------+------------------------------------------------------+---------+\n  |   | %bc  | beconn      (backend concurrent connections)         | numeric |\n  |   |      | %[be_conn]                                           |         |\n  +---+------+------------------------------------------------------+---------+\n  |   | %bi  | backend_source_ip       (connecting address)         |         |\n  |   |      | %[bc_src]                                            | IP      |\n  +---+------+------------------------------------------------------+---------+\n  |   | %bp  | backend_source_port     (connecting address)         |         |\n  |   |      | %[bc_src_port]                                       | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %bq  | backend_queue                                        | numeric |\n  |   |      | %[bc_be_queue]                                       |         |\n  +---+------+------------------------------------------------------+---------+\n  |   | %ci  | client_ip                 (accepted address)         |         |\n  |   |      | %[src]                                               | IP      |\n  +---+------+------------------------------------------------------+---------+\n  |   | %cp  | client_port               (accepted address)         |         |\n  |   |      | %[src_port]                                          | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %f   | frontend_name                                        | string  |\n  |   |      | %[fe_name]                                           |         |\n  +---+------+------------------------------------------------------+---------+\n  |   | %fc  | feconn     (frontend concurrent connections)         | numeric |\n  |   |      | %[fe_conn]                                           |         |\n  +---+------+------------------------------------------------------+---------+\n  |   | %fi  | frontend_ip              (accepting address)         |         |\n  |   |      | %[dst]                                               | IP      |\n  +---+------+------------------------------------------------------+---------+\n  |   | %fp  | frontend_port            (accepting address)         |         |\n  |   |      | %[dst_port]                                          | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %ft  | frontend_name_transport ('~' suffix for SSL)         | string  |\n  +---+------+------------------------------------------------------+---------+\n  |   | %lc  | frontend_log_counter                                 | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %hr  | captured_request_headers default style               | string  |\n  +---+------+------------------------------------------------------+---------+\n  |   | %hrl | captured_request_headers CLF style                   | string  |\n  |   |      |                                                      | list    |\n  +---+------+------------------------------------------------------+---------+\n  |   | %hs  | captured_response_headers default style              | string  |\n  +---+------+------------------------------------------------------+---------+\n  |   | %hsl | captured_response_headers CLF style                  | string  |\n  |   |      |                                                      | list    |\n  +---+------+------------------------------------------------------+---------+\n  | L | %OG  | human readable log origin                            | string  |\n  +---+------+------------------------------------------------------+---------+\n  |   | %pid | PID                                                  |         |\n  |   |      | %[pid]                                               | numeric |\n  +---+------+------------------------------------------------------+---------+\n  | H | %r   | http_request                                         | string  |\n  +---+------+------------------------------------------------------+---------+\n  |   | %rc  | retries                                              | numeric |\n  |   |      | %[txn.redispatched,iif(+,)]%[txn.conn_retries]       |         |\n  +---+------+------------------------------------------------------+---------+\n  |   | %rt  | request_counter (HTTP req or TCP session)            | numeric |\n  |   |      | %[txn.id32]                                          |         |\n  +---+------+------------------------------------------------------+---------+\n  |   | %s   | server_name                                          | string  |\n  |   |      | %[srv_name]                                          |         |\n  +---+------+------------------------------------------------------+---------+\n  |   | %sc  | srv_conn     (server concurrent connections)         | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %si  | server_IP                   (target address)         |         |\n  |   |      | %[bc_dst]                                            | IP      |\n  +---+------+------------------------------------------------------+---------+\n  |   | %sp  | server_port                 (target address)         |         |\n  |   |      | %[bc_dst_port]                                       | numeric |\n  +---+------+------------------------------------------------------+---------+\n  |   | %sq  | srv_queue                                            | numeric |\n  |   |      | %[bc_srv_queue]                                      |         |\n  +---+------+------------------------------------------------------+---------+\n  | S | %sslc| ssl_ciphers (ex: AES-SHA)                            |         |\n  |   |      | %[ssl_fc_cipher]                                     | string  |\n  +---+------+------------------------------------------------------+---------+\n  | S | %sslv| ssl_version (ex: TLSv1)                              |         |\n  |   |      | %[ssl_fc_protocol]                                   | string  |\n  +---+------+------------------------------------------------------+---------+\n  |   | %ts  | termination_state                                    | string  |\n  |   |      | %[txn.sess_term_state]                               |         |\n  +---+------+------------------------------------------------------+---------+\n  | H | %tsc | termination_state with cookie status                 | string  |\n  +---+------+------------------------------------------------------+---------+\n\n    R = Restrictions : H = mode http only ; S = SSL only ; L = log only\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.3. Advanced logging options", "content": "## [8.3.](#8.3)Advanced logging options\n\n```\nSome advanced logging options are often looked for but are not easy to find out\njust by looking at the various options. Here is an entry point for the few\noptions which can enable better logging. Please refer to the keywords reference\nfor more information about their usage.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.3.1. Disabling logging of external tests", "content": "### [8.3.1.](#8.3.1)Disabling logging of external tests\n\n```\nIt is quite common to have some monitoring tools perform health checks on\nHAProxy. Sometimes it will be a layer 3 load-balancer such as LVS or any\ncommercial load-balancer, and sometimes it will simply be a more complete\nmonitoring system such as Nagios. When the tests are very frequent, users often\nask how to disable logging for those checks. There are three possibilities :\n\n  - if connections come from everywhere and are just TCP probes, it is often\n    desired to simply disable logging of connections without data exchange, by\n    setting \"option dontlognull\" in the frontend. It also disables logging of\n    port scans, which may or may not be desired.\n\n  - it is possible to use the \"http-request set-log-level silent\" action using\n    a variety of conditions (source networks, paths, user-agents, etc).\n\n  - if the tests are performed on a known URI, use \"monitor-uri\" to declare\n    this URI as dedicated to monitoring. Any host sending this request will\n    only get the result of a health-check, and the request will not be logged.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.3.2. Logging before waiting for the stream to terminate", "content": "### [8.3.2.](#8.3.2)Logging before waiting for the stream to terminate\n\n```\nThe problem with logging at end of connection is that you have no clue about\nwhat is happening during very long streams, such as remote terminal sessions\nor large file downloads. This problem can be worked around by specifying\n\"option logasap\" in the frontend. HAProxy will then log as soon as possible,\njust before data transfer begins. This means that in case of TCP, it will still\nlog the connection status to the server, and in case of HTTP, it will log just\nafter processing the server headers. In this case, the number of bytes reported\nis the number of header bytes sent to the client. In order to avoid confusion\nwith normal logs, the total time field and the number of bytes are prefixed\nwith a '+' sign which means that real numbers are certainly larger.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.3.3. Raising log level upon errors", "content": "### [8.3.3.](#8.3.3)Raising log level upon errors\n\n```\nSometimes it is more convenient to separate normal traffic from errors logs,\nfor instance in order to ease error monitoring from log files. When the option\n\"log-separate-errors\" is used, connections which experience errors, timeouts,\nretries, redispatches or HTTP status codes 5xx will see their syslog level\nraised from \"info\" to \"err\". This will help a syslog daemon store the log in\na separate file. It is very important to keep the errors in the normal traffic\nfile too, so that log ordering is not altered. You should also be careful if\nyou already have configured your syslog daemon to store all logs higher than\n\"notice\" in an \"admin\" file, because the \"err\" level is higher than \"notice\".\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.3.4. Disabling logging of successful connections", "content": "### [8.3.4.](#8.3.4)Disabling logging of successful connections\n\n```\nAlthough this may sound strange at first, some large sites have to deal with\nmultiple thousands of logs per second and are experiencing difficulties keeping\nthem intact for a long time or detecting errors within them. If the option\n\"dontlog-normal\" is set on the frontend, all normal connections will not be\nlogged. In this regard, a normal connection is defined as one without any\nerror, timeout, retry nor redispatch. In HTTP, the status code is checked too,\nand a response with a status 5xx is not considered normal and will be logged\ntoo. Of course, doing is is really discouraged as it will remove most of the\nuseful information from the logs. Do this only if you have no other\nalternative.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.3.5. Log profiles", "content": "### [8.3.5.](#8.3.5)Log profiles\n\n```\nWhile some directives such as \"log-format\", \"log-format-sd\", \"error-log-format\"\nor \"log-tagThis keyword is available in sections :Process management and securityAlphabetically sorted keywords referenceLog profiles\" make it possible to configure log formatting globally or at the\nproxy level, it may be relevant to configure such settings as close as possible\nto the log endpoints, that is, per \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\" directive.\n\nThis is where \"log-profile\" section comes into play: \"log-profile\" may be\ndefined anywhere in the configuration. This section accepts a set of different\nkeywords that are used to describe how the logs emitted for a given `log`\ndirective should be built.\n\nFrom a \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\" directive, one can choose to use a specific log-profile by its\nname. The same profile may be used from multiple \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\" directives.\n\n```\n\n**[log-profile](#8.3.5-log-profile)**<name>```\nCreates a new log profile identified as <name>\n\n```\n\n**[log-tag](#8.3.5-log-tag)**<string>```\nOverride syslog log tag set globally or per-proxy using \"log-tagThis keyword is available in sections :Process management and securityAlphabetically sorted keywords referenceLog profiles\" directive.\n\n```\n\n**[on](#8.3.5-on)**<step>[drop][format<fmt>][sd<sd_fmt>]```\nOverride the log-format string normally used to build the log line at\n<step> logging step. <fmt> is used to override \"log-format\" or\n\"error-log-format\" strings (depending on the <step>) whereas <sd_fmt> is\nused to override \"log-format-sd\" string (both can be combined).\n\n\"drop\" special keyword may be used to specify that no log should be\nemitted for the given <step>. It takes precedence over \"format\" and\n\"sd\" if previously defined.\n\nPossible values for <step> are:\n\n- \"accept\"   : override log-format if the log is generated right after\n               frontend conn was accepted\n- \"request\"  : override log-format if the log is generated after client\n               request was received\n- \"connect\"  : override log-format if the log is generated after backend\n               connection establishment\n- \"response\" : override log-format if the log is generated during server\n               response handling\n- \"close\"    : override log-format if the log is generated at the final\n               transaction (txn) step\n- \"error\"    : override error-log-format for if the log is generated due\n               to a transaction error\n- \"any\"      : override both log-format and error-log-format for all logging\n               steps, unless a more precise step override is declared.\n\nSee \"do-log\" action for relevant additional <step> values.\n\nThis setting is only relevant for \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\" directives used from contexts where\nusing \"log-format\" directive makes sense (e.g.: http and tcp proxies).\nElse it will simply be ignored.\n\n```\n\nExample :```\n\nlog-profile myprof\n\n  log-tag \"custom-tag\"\n\n  on error format \"%ci: error\"\n  on connect drop\n  on any sd \"custom-sd\"\n\nlisten myproxy\n  mode http\n  option httplog\n  log-tag \"normal\"\n\n  log stdout format rfc5424 local0\n  # success:\n  # <134>1 2024-06-12T10:09:11.823400+02:00 - normal 224482 - - 127.0.0.1:53594 [12/Jun/2024:10:09:11.814] myproxy myproxy/<NOSRV> 0/-1/-1/-1/0 200 49 - - LR-- 1/1/0/0/0 0/0 \"GET / HTTP/1.1\"\n  #\n  # error:\n  # <134>1 2024-06-12T10:09:44.810929+02:00 - normal 224482 - - 127.0.0.1:59258 [12/Jun/2024:10:09:44.426] myproxy myproxy/<NOSRV> -1/-1/-1/-1/384 400 0 - - CR-- 1/1/0/0/0 0/0 \"<BADREQ>\"\n\n  log 127.0.0.1:514 format rfc5424 profile myprof local0\n  # success:\n  # <134>1 2024-06-12T10:09:11.823428+02:00 - custom-tag 224482 - custom-sd 127.0.0.1:53594 [12/Jun/2024:10:09:11.814] myproxy myproxy/<NOSRV> 0/-1/-1/-1/0 200 49 - - LR-- 1/1/0/0/0 0/0 \"GET / HTTP/1.1\"\n  #\n  # error:\n  # <134>1 2024-06-12T10:09:51.566524+02:00 - custom-tag 224482 - - 127.0.0.1: error\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.4. Timing events", "content": "## [8.4.](#8.4)Timing events\n\n```\nTimers provide a great help in troubleshooting network problems. All values are\nreported in milliseconds (ms). These timers should be used in conjunction with\nthe stream termination flags. In TCP mode with \"option tcplog\" set on the\nfrontend, 3 control points are reported under the form \"Tw/Tc/Tt\", and in HTTP\nmode, 5 control points are reported under the form \"TR/Tw/Tc/Tr/Ta\". In\naddition, three other measures are provided, \"Th\", \"Ti\", and \"Tq\".\n\nTimings events in HTTP mode:\n\n                 first request               2nd request\n      |<-------------------------------->|<-------------- ...\n      t         tr                       t    tr ...\n   ---|----|----|----|----|----|----|----|----|--\n      : Th   Ti   TR   Tw   Tc   Tr   Td : Ti   ...\n      :<---- Tq ---->:                   :\n      :<-------------- Tt -------------->:\n      :<--        -----Tu--------------->:\n                :<--------- Ta --------->:\n\nTimings events in TCP mode:\n\n           TCP session\n      |<----------------->|\n      t                   t\n   ---|----|----|----|----|---\n      | Th   Tw   Tc   Td |\n      |<------ Tt ------->|\n\n  - Th: total time to accept tcp connection and execute handshakes for low level\n    protocols. Currently, these protocols are proxy-protocol and SSL. This may\n    only happen once during the whole connection's lifetime. A large time here\n    may indicate that the client only pre-established the connection without\n    speaking, that it is experiencing network issues preventing it from\n    completing a handshake in a reasonable time (e.g. MTU issues), or that an\n    SSL handshake was very expensive to compute. Please note that this time is\n    reported only before the first request, so it is safe to average it over\n    all request to calculate the amortized value. The second and subsequent\n    request will always report zero here.\n\n    This timer is named %Th as a log-format alias, and fc.timer.handshake as a\n    sample fetch.\n\n  - Ti: is the idle time before the HTTP request (HTTP mode only). This timer\n    counts between the end of the handshakes and the first byte of the HTTP\n    request. When dealing with a second request in keep-alive mode, it starts\n    to count after the end of the transmission the previous response. When a\n    multiplexed protocol such as HTTP/2 is used, it starts to count immediately\n    after the previous request. Some browsers pre-establish connections to a\n    server in order to reduce the latency of a future request, and keep them\n    pending until they need it. This delay will be reported as the idle time. A\n    value of -1 indicates that nothing was received on the connection.\n\n    This timer is named %Ti as a log-format alias, and req.timer.idle as a\n    sample fetch.\n\n  - TR: total time to get the client request (HTTP mode only). It's the time\n    elapsed between the first bytes received and the moment the proxy received\n    the empty line marking the end of the HTTP headers. The value \"-1\"\n    indicates that the end of headers has never been seen. This happens when\n    the client closes prematurely or times out. This time is usually very short\n    since most requests fit in a single packet. A large time may indicate a\n    request typed by hand during a test.\n\n    This timer is named %TR as a log-format alias, and req.timer.hdr as a\n    sample fetch.\n\n  - Tq: total time to get the client request from the accept date or since the\n    emission of the last byte of the previous response (HTTP mode only). It's\n    exactly equal to Th + Ti + TR unless any of them is -1, in which case it\n    returns -1 as well. This timer used to be very useful before the arrival of\n    HTTP keep-alive and browsers' pre-connect feature. It's recommended to drop\n    it in favor of TR nowadays, as the idle time adds a lot of noise to the\n    reports.\n\n    This timer is named %Tq as a log-format alias, and req.timer.tq as a\n    sample fetch.\n\n  - Tw: total time spent in the queues waiting for a connection slot. It\n    accounts for backend queue as well as the server queues, and depends on the\n    queue size, and the time needed for the server to complete previous\n    requests. The value \"-1\" means that the request was killed before reaching\n    the queue, which is generally what happens with invalid or denied requests.\n\n    This timer is named %Tw as a log-format alias, and req.timer.queue as a\n    sample fetch.\n\n  - Tc: total time to establish the TCP connection to the server. It's the time\n    elapsed between the moment the proxy sent the connection request, and the\n    moment it was acknowledged by the server, or between the TCP SYN packet and\n    the matching SYN/ACK packet in return. The value \"-1\" means that the\n    connection never established.\n\n    This timer is named %Tc as a log-format alias, and bc.timer.connect as a\n    sample fetch.\n\n  - Tr: server response time (HTTP mode only). It's the time elapsed between\n    the moment the TCP connection was established to the server and the moment\n    the server sent its complete response headers. It purely shows its request\n    processing time, without the network overhead due to the data transmission.\n    It is worth noting that when the client has data to send to the server, for\n    instance during a POST request, the time already runs, and this can distort\n    apparent response time. For this reason, it's generally wise not to trust\n    too much this field for POST requests initiated from clients behind an\n    untrusted network. A value of \"-1\" here means that the last response header\n    (empty line) was never seen, most likely because the server timeout stroke\n    before the server managed to process the request or because the server\n    returned an invalid response.\n\n    This timer is named %Tr as a log-format alias, and res.timer.hdr as a\n    sample fetch.\n\n  - Td: this is the total transfer time of the response payload till the last\n    byte sent to the client. In HTTP it starts after the last response header\n    (after Tr).\n\n    The data sent are not guaranteed to be received by the client, they can be\n    stuck in either the kernel or the network.\n\n    This timer is named %Td as a log-format alias, and res.timer.data as a\n    sample fetch.\n\n  - Ta: total active time for the HTTP request, between the moment the proxy\n    received the first byte of the request header and the emission of the last\n    byte of the response body. The exception is when the \"logasap\" option is\n    specified. In this case, it only equals (TR+Tw+Tc+Tr), and is prefixed with\n    a '+' sign. From this field, we can deduce \"Td\", the data transmission time,\n    by subtracting other timers when valid :\n\n        Td = Ta - (TR + Tw + Tc + Tr)\n\n    Timers with \"-1\" values have to be excluded from this equation. Note that\n    \"Ta\" can never be negative.\n\n    This timer is named %Ta as a log-format alias, and txn.timer.total as a\n    sample fetch.\n\n  - Tt: total stream duration time, between the moment the proxy accepted it\n    and the moment both ends were closed. The exception is when the \"logasap\"\n    option is specified. In this case, it only equals (Th+Ti+TR+Tw+Tc+Tr), and\n    is prefixed with a '+' sign. From this field, we can deduce \"Td\", the data\n    transmission time, by subtracting other timers when valid :\n\n        Td = Tt - (Th + Ti + TR + Tw + Tc + Tr)\n\n    Timers with \"-1\" values have to be excluded from this equation. In TCP\n    mode, \"Ti\", \"Tq\" and \"Tr\" have to be excluded too. Note that \"Tt\" can never\n    be negative and that for HTTP, Tt is simply equal to (Th+Ti+Ta).\n\n    This timer is named %Tt as a log-format alias, and fc.timer.total as a\n    sample fetch.\n\n  - Tu: total estimated time as seen from client, between the moment the proxy\n    accepted it and the moment both ends were closed, without idle time.\n    This is useful to roughly measure end-to-end time as a user would see it,\n    without idle time pollution from keep-alive time between requests. This\n    timer in only an estimation of time seen by user as it assumes network\n    latency is the same in both directions. The exception is when the \"logasap\"\n    option is specified. In this case, it only equals (Th+TR+Tw+Tc+Tr), and is\n    prefixed with a '+' sign.\n\n    This timer is named %Tu as a log-format alias, and txn.timer.user as a\n    sample fetch.\n\nThese timers provide precious indications on trouble causes. Since the TCP\nprotocol defines retransmit delays of 3, 6, 12... seconds, we know for sure\nthat timers close to multiples of 3s are nearly always related to lost packets\ndue to network problems (wires, negotiation, congestion). Moreover, if \"Ta\" or\n\"Tt\" is close to a timeout value specified in the configuration, it often means\nthat a stream has been aborted on timeout.\n\nMost common cases :\n\n  - If \"Th\" or \"Ti\" are close to 3000, a packet has probably been lost between\n    the client and the proxy. This is very rare on local networks but might\n    happen when clients are on far remote networks and send large requests. It\n    may happen that values larger than usual appear here without any network\n    cause. Sometimes, during an attack or just after a resource starvation has\n    ended, HAProxy may accept thousands of connections in a few milliseconds.\n    The time spent accepting these connections will inevitably slightly delay\n    processing of other connections, and it can happen that request times in the\n    order of a few tens of milliseconds are measured after a few thousands of\n    new connections have been accepted at once. Using one of the keep-alive\n    modes may display larger idle times since \"Ti\" measures the time spent\n    waiting for additional requests.\n\n  - If \"Tc\" is close to 3000, a packet has probably been lost between the\n    server and the proxy during the server connection phase. This value should\n    always be very low, such as 1 ms on local networks and less than a few tens\n    of ms on remote networks.\n\n  - If \"Tr\" is nearly always lower than 3000 except some rare values which seem\n    to be the average majored by 3000, there are probably some packets lost\n    between the proxy and the server.\n\n  - If \"Ta\" is large even for small byte counts, it generally is because\n    neither the client nor the server decides to close the connection while\n    HAProxy is running in tunnel mode and both have agreed on a keep-alive\n    connection mode. In order to solve this issue, it will be needed to specify\n    one of the HTTP options to manipulate keep-alive or close options on either\n    the frontend or the backend. Having the smallest possible 'Ta' or 'Tt' is\n    important when connection regulation is used with the \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" option on\n    the servers, since no new connection will be sent to the server until\n    another one is released.\n\nOther noticeable HTTP log cases ('xx' means any value to be ignored) :\n\n  TR/Tw/Tc/Tr/+Ta  The \"option logasap\" is present on the frontend and the log\n                   was emitted before the data phase. All the timers are valid\n                   except \"Ta\" which is shorter than reality.\n\n  -1/xx/xx/xx/Ta   The client was not able to send a complete request in time\n                   or it aborted too early. Check the stream termination flags\n                   then \"timeout http-request\" and \"timeout clientThis keyword is available in sections :Log forwardingAlphabetically sorted keywords reference\" settings.\n\n  TR/-1/xx/xx/Ta   It was not possible to process the request, maybe because\n                   servers were out of order, because the request was invalid\n                   or forbidden by ACL rules. Check the stream termination\n                   flags.\n\n  TR/Tw/-1/xx/Ta   The connection could not establish on the server. Either it\n                   actively refused it or it timed out after Ta-(TR+Tw) ms.\n                   Check the stream termination flags, then check the\n                   \"timeout connectThis keyword is available in sections :RingsAlphabetically sorted keywords reference\" setting. Note that the tarpit action might\n                   return similar-looking patterns, with \"Tw\" equal to the time\n                   the client connection was maintained open.\n\n  TR/Tw/Tc/-1/Ta   The server has accepted the connection but did not return\n                   a complete response in time, or it closed its connection\n                   unexpectedly after Ta-(TR+Tw+Tc) ms. Check the stream\n                   termination flags, then check the \"timeout serverThis keyword is available in sections :RingsAlphabetically sorted keywords reference\" setting.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.5. Stream state at disconnection", "content": "## [8.5.](#8.5)Stream state at disconnection\n\n```\nTCP and HTTP logs provide a stream termination indicator in the\n\"termination_state\" field, just before the number of active connections. It is\n2-characters long in TCP mode, and is extended to 4 characters in HTTP mode,\neach of which has a special meaning :\n\n  - On the first character, a code reporting the first event which caused the\n    stream to terminate :\n\n        C : the TCP session was unexpectedly aborted by the client.\n\n        S : the TCP session was unexpectedly aborted by the server, or the\n            server explicitly refused it.\n\n        P : the stream or session was prematurely aborted by the proxy, because\n            of a connection limit enforcement, because a DENY filter was\n            matched, because of a security check which detected and blocked a\n            dangerous error in server response which might have caused\n            information leak (e.g. cacheable cookie).\n\n        L : the stream was locally processed by HAProxy.\n\n        R : a resource on the proxy has been exhausted (memory, sockets, source\n            ports, ...). Usually, this appears during the connection phase, and\n            system logs should contain a copy of the precise error. If this\n            happens, it must be considered as a very serious anomaly which\n            should be fixed as soon as possible by any means.\n\n        I : an internal error was identified by the proxy during a self-check.\n            This should NEVER happen, and you are encouraged to report any log\n            containing this, because this would almost certainly be a bug. It\n            would be wise to preventively restart the process after such an\n            event too, in case it would be caused by memory corruption.\n\n        D : the stream was killed by HAProxy because the server was detected\n            as down and was configured to kill all connections when going down.\n\n        U : the stream was killed by HAProxy on this backup server because an\n            active server was detected as up and was configured to kill all\n            backup connections when going up.\n\n        K : the stream was actively killed by an admin operating on HAProxy.\n\n        c : the client-side timeout expired while waiting for the client to\n            send or receive data.\n\n        s : the server-side timeout expired while waiting for the server to\n            send or receive data.\n\n        - : normal stream completion, both the client and the server closed\n            with nothing left in the buffers.\n\n  - on the second character, the TCP or HTTP stream state when it was closed :\n\n        R : the proxy was waiting for a complete, valid REQUEST from the client\n            (HTTP mode only). Nothing was sent to any server.\n\n        Q : the proxy was waiting in the QUEUE for a connection slot. This can\n            only happen when servers have a 'maxconn' parameter set. It can\n            also happen in the global queue after a redispatch consecutive to\n            a failed attempt to connect to a dying server. If no redispatch is\n            reported, then no connection attempt was made to any server.\n\n        C : the proxy was waiting for the CONNECTION to establish on the\n            server. The server might at most have noticed a connection attempt.\n\n        H : the proxy was waiting for complete, valid response HEADERS from the\n            server (HTTP only).\n\n        D : the stream was in the DATA phase.\n\n        L : the proxy was still transmitting LAST data to the client while the\n            server had already finished. This one is very rare as it can only\n            happen when the client dies while receiving the last packets.\n\n        T : the request was tarpitted. It has been held open with the client\n            during the whole \"timeout tarpit\" duration or until the client\n            closed, both of which will be reported in the \"Tw\" timer.\n\n        - : normal stream completion after end of data transfer.\n\n  - the third character tells whether the persistence cookie was provided by\n    the client (only in HTTP mode) :\n\n        N : the client provided NO cookie. This is usually the case for new\n            visitors, so counting the number of occurrences of this flag in the\n            logs generally indicate a valid trend for the site frequentation.\n\n        I : the client provided an INVALID cookie matching no known server.\n            This might be caused by a recent configuration change, mixed\n            cookies between HTTP/HTTPS sites, persistence conditionally\n            ignored, or an attack.\n\n        D : the client provided a cookie designating a server which was DOWN,\n            so either \"option persist\" was used and the client was sent to\n            this server, or it was not set and the client was redispatched to\n            another server.\n\n        V : the client provided a VALID cookie, and was sent to the associated\n            server.\n\n        E : the client provided a valid cookie, but with a last date which was\n            older than what is allowed by the \"maxidle\" cookie parameter, so\n            the cookie is consider EXPIRED and is ignored. The request will be\n            redispatched just as if there was no cookie.\n\n        O : the client provided a valid cookie, but with a first date which was\n            older than what is allowed by the \"maxlife\" cookie parameter, so\n            the cookie is consider too OLD and is ignored. The request will be\n            redispatched just as if there was no cookie.\n\n        U : a cookie was present but was not used to select the server because\n            some other server selection mechanism was used instead (typically a\n            \"use-server\" rule).\n\n        - : does not apply (no cookie set in configuration).\n\n  - the last character reports what operations were performed on the persistence\n    cookie returned by the server (only in HTTP mode) :\n\n        N : NO cookie was provided by the server, and none was inserted either.\n\n        I : no cookie was provided by the server, and the proxy INSERTED one.\n            Note that in \"cookie insert\" mode, if the server provides a cookie,\n            it will still be overwritten and reported as \"I\" here.\n\n        U : the proxy UPDATED the last date in the cookie that was presented by\n            the client. This can only happen in insert mode with \"maxidle\". It\n            happens every time there is activity at a different date than the\n            date indicated in the cookie. If any other change happens, such as\n            a redispatch, then the cookie will be marked as inserted instead.\n\n        P : a cookie was PROVIDED by the server and transmitted as-is.\n\n        R : the cookie provided by the server was REWRITTEN by the proxy, which\n            happens in \"cookie rewrite\" or \"cookie prefix\" modes.\n\n        D : the cookie provided by the server was DELETED by the proxy.\n\n        - : does not apply (no cookie set in configuration).\n\nThe combination of the two first flags gives a lot of information about what\nwas happening when the stream or session terminated, and why it did terminate.\nIt can be helpful to detect server saturation, network troubles, local system\nresource starvation, attacks, etc...\n\nThe most common termination flags combinations are indicated below. They are\nalphabetically sorted, with the lowercase set just after the upper case for\neasier finding and understanding.\n\n  Flags   Reason\n\n     --   Normal termination.\n\n     CC   The client aborted before the connection could be established to the\n          server. This can happen when HAProxy tries to connect to a recently\n          dead (or unchecked) server, and the client aborts while HAProxy is\n          waiting for the server to respond or for \"timeout connectThis keyword is available in sections :RingsAlphabetically sorted keywords reference\" to expire.\n\n     CD   The client unexpectedly aborted during data transfer. This can be\n          caused by a browser crash, by an intermediate equipment between the\n          client and HAProxy which decided to actively break the connection,\n          by network routing issues between the client and HAProxy, or by a\n          keep-alive stream between the server and the client terminated first\n          by the client.\n\n     cD   The client did not send nor acknowledge any data for as long as the\n          \"timeout clientThis keyword is available in sections :Log forwardingAlphabetically sorted keywords reference\" delay. This is often caused by network failures on\n          the client side, or the client simply leaving the net uncleanly.\n\n     CH   The client aborted while waiting for the server to start responding.\n          It might be the server taking too long to respond or the client\n          clicking the 'Stop' button too fast.\n\n     cH   The \"timeout clientThis keyword is available in sections :Log forwardingAlphabetically sorted keywords reference\" stroke while waiting for client data during a\n          POST request. This is sometimes caused by too large TCP MSS values\n          for PPPoE networks which cannot transport full-sized packets. It can\n          also happen when client timeout is smaller than server timeout and\n          the server takes too long to respond.\n\n     CQ   The client aborted while its stream was queued, waiting for a server\n          with enough empty slots to accept it. It might be that either all the\n          servers were saturated or that the assigned server was taking too\n          long a time to respond.\n\n     CR   The client aborted before sending a full HTTP request. Most likely\n          the request was typed by hand using a telnet client, and aborted\n          too early. The HTTP status code is likely a 400 here. Sometimes this\n          might also be caused by an IDS killing the connection between HAProxy\n          and the client. \"option http-ignore-probes\" can be used to ignore\n          connections without any data transfer.\n\n     cR   The \"timeout http-request\" stroke before the client sent a full HTTP\n          request. This is sometimes caused by too large TCP MSS values on the\n          client side for PPPoE networks which cannot transport full-sized\n          packets, or by clients sending requests by hand and not typing fast\n          enough, or forgetting to enter the empty line at the end of the\n          request. The HTTP status code is likely a 408 here. Note: recently,\n          some browsers started to implement a \"pre-connect\" feature consisting\n          in speculatively connecting to some recently visited web sites just\n          in case the user would like to visit them. This results in many\n          connections being established to web sites, which end up in 408\n          Request Timeout if the timeout strikes first, or 400 Bad Request when\n          the browser decides to close them first. These ones pollute the log\n          and feed the error counters. Some versions of some browsers have even\n          been reported to display the error code. It is possible to work\n          around the undesirable effects of this behavior by adding \"option\n          http-ignore-probes\" in the frontend, resulting in connections with\n          zero data transfer to be totally ignored. This will definitely hide\n          the errors of people experiencing connectivity issues though.\n\n     CT   The client aborted while its stream was tarpitted. It is important to\n          check if this happens on valid requests, in order to be sure that no\n          wrong tarpit rules have been written. If a lot of them happen, it\n          might make sense to lower the \"timeout tarpit\" value to something\n          closer to the average reported \"Tw\" timer, in order not to consume\n          resources for just a few attackers.\n\n     LC   The request was intercepted and locally handled by HAProxy. The\n          request was not sent to the server. It only happens with a redirect\n          because of a \"redir\" parameter on the server line.\n\n     LR   The request was intercepted and locally handled by HAProxy. The\n          request was not sent to the server. Generally it means a redirect was\n          returned, an HTTP return statement was processed or the request was\n          handled by an applet (stats, cache, Prometheus exported, lua applet...).\n\n     LH   The response was intercepted and locally handled by HAProxy. Generally\n          it means a redirect was returned or an HTTP return statement was\n          processed.\n\n     SC   The server or an equipment between it and HAProxy explicitly refused\n          the TCP connection (the proxy received a TCP RST or an ICMP message\n          in return). Under some circumstances, it can also be the network\n          stack telling the proxy that the server is unreachable (e.g. no route,\n          or no ARP response on local network). When this happens in HTTP mode,\n          the status code is likely a 502 or 503 here.\n\n     sC   The \"timeout connectThis keyword is available in sections :RingsAlphabetically sorted keywords reference\" stroke before a connection to the server could\n          complete. When this happens in HTTP mode, the status code is likely a\n          503 or 504 here.\n\n     SD   The connection to the server died with an error during the data\n          transfer. This usually means that HAProxy has received an RST from\n          the server or an ICMP message from an intermediate equipment while\n          exchanging data with the server. This can be caused by a server crash\n          or by a network issue on an intermediate equipment.\n\n     sD   The server did not send nor acknowledge any data for as long as the\n          \"timeout serverThis keyword is available in sections :RingsAlphabetically sorted keywords reference\" setting during the data phase. This is often caused\n          by too short timeouts on L4 equipment before the server (firewalls,\n          load-balancers, ...), as well as keep-alive sessions maintained\n          between the client and the server expiring first on HAProxy.\n\n     SH   The server aborted before sending its full HTTP response headers, or\n          it crashed while processing the request. Since a server aborting at\n          this moment is very rare, it would be wise to inspect its logs to\n          control whether it crashed and why. The logged request may indicate a\n          small set of faulty requests, demonstrating bugs in the application.\n          Sometimes this might also be caused by an IDS killing the connection\n          between HAProxy and the server.\n\n     sH   The \"timeout serverThis keyword is available in sections :RingsAlphabetically sorted keywords reference\" stroke before the server could return its\n          response headers. This is the most common anomaly, indicating too\n          long transactions, probably caused by server or database saturation.\n          The immediate workaround consists in increasing the \"timeout serverThis keyword is available in sections :RingsAlphabetically sorted keywords reference\"\n          setting, but it is important to keep in mind that the user experience\n          will suffer from these long response times. The only long term\n          solution is to fix the application.\n\n     sQ   The stream spent too much time in queue and has been expired. See\n          the \"timeout queue\" and \"timeout connectThis keyword is available in sections :RingsAlphabetically sorted keywords reference\" settings to find out how to\n          fix this if it happens too often. If it often happens massively in\n          short periods, it may indicate general problems on the affected\n          servers due to I/O or database congestion, or saturation caused by\n          external attacks.\n\n     PC   The proxy refused to establish a connection to the server because the\n          process's socket limit has been reached while attempting to connect.\n          The global \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" parameter may be increased in the configuration\n          so that it does not happen anymore. This status is very rare and\n          might happen when the global \"ulimit-n\" parameter is forced by hand.\n\n     PD   The proxy blocked an incorrectly formatted chunked encoded message in\n          a request or a response, after the server has emitted its headers. In\n          most cases, this will indicate an invalid message from the server to\n          the client. HAProxy supports chunk sizes of up to 2GB - 1 (2147483647\n          bytes). Any larger size will be considered as an error.\n\n     PH   The proxy blocked the server's response, because it was invalid,\n          incomplete, dangerous (cache control), or matched a security filter.\n          In any case, an HTTP 502 error is sent to the client. One possible\n          cause for this error is an invalid syntax in an HTTP header name\n          containing unauthorized characters. It is also possible but quite\n          rare, that the proxy blocked a chunked-encoding request from the\n          client due to an invalid syntax, before the server responded. In this\n          case, an HTTP 400 error is sent to the client and reported in the\n          logs. Finally, it may be due to an HTTP header rewrite failure on the\n          response. In this case, an HTTP 500 error is sent (see\n          \"tune.maxrewrite\" and \"http-response strict-mode\" for more\n          inforomation).\n\n     PR   The proxy blocked the client's HTTP request, either because of an\n          invalid HTTP syntax, in which case it returned an HTTP 400 error to\n          the client, or because a deny filter matched, in which case it\n          returned an HTTP 403 error.  It may also be due to an HTTP header\n          rewrite failure on the request. In this case, an HTTP 500 error is\n          sent (see \"tune.maxrewrite\" and \"http-request strict-mode\" for more\n          inforomation).\n\n     PT   The proxy blocked the client's request and has tarpitted its\n          connection before returning it a 500 server error. Nothing was sent\n          to the server. The connection was maintained open for as long as\n          reported by the \"Tw\" timer field.\n\n     RC   A local resource has been exhausted (memory, sockets, source ports)\n          preventing the connection to the server from establishing. The error\n          logs will tell precisely what was missing. This is very rare and can\n          only be solved by proper system tuning.\n\nThe combination of the two last flags gives a lot of information about how\npersistence was handled by the client, the server and by HAProxy. This is very\nimportant to troubleshoot disconnections, when users complain they have to\nre-authenticate. The commonly encountered flags are :\n\n     --   Persistence cookie is not enabled.\n\n     NN   No cookie was provided by the client, none was inserted in the\n          response. For instance, this can be in insert mode with \"postonly\"\n          set on a GET request.\n\n     II   A cookie designating an invalid server was provided by the client,\n          a valid one was inserted in the response. This typically happens when\n          a \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" entry is removed from the configuration, since its cookie\n          value can be presented by a client when no other server knows it.\n\n     NI   No cookie was provided by the client, one was inserted in the\n          response. This typically happens for first requests from every user\n          in \"insert\" mode, which makes it an easy way to count real users.\n\n     VN   A cookie was provided by the client, none was inserted in the\n          response. This happens for most responses for which the client has\n          already got a cookie.\n\n     VU   A cookie was provided by the client, with a last visit date which is\n          not completely up-to-date, so an updated cookie was provided in\n          response. This can also happen if there was no date at all, or if\n          there was a date but the \"maxidle\" parameter was not set, so that the\n          cookie can be switched to unlimited time.\n\n     EI   A cookie was provided by the client, with a last visit date which is\n          too old for the \"maxidle\" parameter, so the cookie was ignored and a\n          new cookie was inserted in the response.\n\n     OI   A cookie was provided by the client, with a first visit date which is\n          too old for the \"maxlife\" parameter, so the cookie was ignored and a\n          new cookie was inserted in the response.\n\n     DI   The server designated by the cookie was down, a new server was\n          selected and a new cookie was emitted in the response.\n\n     VI   The server designated by the cookie was not marked dead but could not\n          be reached. A redispatch happened and selected another one, which was\n          then advertised in the response.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.6. Non-printable characters", "content": "## [8.6.](#8.6)Non-printable characters\n\n```\nIn order not to cause trouble to log analysis tools or terminals during log\nconsulting, non-printable characters are not sent as-is into log files, but are\nconverted to the two-digits hexadecimal representation of their ASCII code,\nprefixed by the character '#'. The only characters that can be logged without\nbeing escaped are comprised between 32 and 126 (inclusive). Obviously, the\nescape character '#' itself is also encoded to avoid any ambiguity (\"#23\"). It\nis the same for the character '\"' which becomes \"#22\", as well as '{', '|' and\n'}' when logging headers.\n\nNote that the space character (' ') is not encoded in headers, which can cause\nissues for tools relying on space count to locate fields. A typical header\ncontaining spaces is \"User-Agent\".\n\nLast, it has been observed that some syslog daemons such as syslog-ng escape\nthe quote ('\"') with a backslash ('\\'). The reverse operation can safely be\nperformed since no quote may appear anywhere else in the logs.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.7. Capturing HTTP cookies", "content": "## [8.7.](#8.7)Capturing HTTP cookies\n\n```\nCookie capture simplifies the tracking a complete user session. This can be\nachieved using the \"capture cookie\" statement in the frontend. Please refer to\nsection 4.2 for more details. Only one cookie can be captured, and the same\ncookie will simultaneously be checked in the request (\"Cookie:\" header) and in\nthe response (\"Set-Cookie:\" header). The respective values will be reported in\nthe HTTP logs at the \"captured_request_cookie\" and \"captured_response_cookie\"\nlocations (see section 8.2.3 about HTTP log format). When either cookie is\nnot seen, a dash ('-') replaces the value. This way, it's easy to detect when a\nuser switches to a new session for example, because the server will reassign it\na new cookie. It is also possible to detect if a server unexpectedly sets a\nwrong cookie to a client, leading to session crossing.\n\n```\n\nExamples :```\n\n# capture the first cookie whose name starts with \"ASPSESSION\"\ncapture cookie ASPSESSION len 32\n\n# capture the first cookie whose name is exactly \"vgnvisitor\"\ncapture cookie vgnvisitor= len 32\n\n```\n\n```\nIt is possible to perform more advanced captures using \"http-request\" and\n\"http-response\" rules to assign cookies to variables of scope \"txn\". The cookie\nvalues may then be extracted from the request or response using the \"req.cook\"\nand \"res.cook\" sample fetch functions (see section 7.3.6) and assigned to a\nvariable using the \"set-varThis keyword is available in sections :Process management and securityAlphabetically sorted actions referenceConverters\" or \"set-var-fmtThis keyword is available in sections :Process management and securityAlphabetically sorted actions reference\" actions (see section 4.3). A\ncustom log-format will then permit to present these variables where desired\n(see section 8.2.6).\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.8. Capturing HTTP headers (legacy)", "content": "## [8.8.](#8.8)Capturing HTTP headers (legacy)\n\n```\nHeader captures are useful to track unique request identifiers set by an upper\nproxy, virtual host names, user-agents, POST content-length, referrers, etc. In\nthe response, one can search for information about the response length, how the\nserver asked the cache to behave, or an object location during a redirection.\n\nThere are two ways to perform header captures. The modern one involves setting\nvariables from the headers to be captured, or from composite samples returned\nby \"req.hdr_names\", \"req.hdrs\", \"res.hdr_names\", \"res.hdrs\" (see section 7.3.6)\nfor all possibilities. These can be assigned to variables of scope \"txn\" using\nthe \"set-varThis keyword is available in sections :Process management and securityAlphabetically sorted actions referenceConverters\" and \"set-var-fmtThis keyword is available in sections :Process management and securityAlphabetically sorted actions reference\" actions from the \"http-request\" and\n\"http-response\" rulesets (see section 4.3), which can then be referenced from\ncustom log formats (see section 8.2.6). This is the recommended way to capture\nHTTP headers.\n\nThere is also the legacy method which predates the http-request rules and\nvariables, which does not involve adjusting the log format, and which has also\nlong been used both for logging and as an artificial way to convey request\ninformation all along the HTTP transaction, using the older \"captureThis keyword is available in sections :Alphabetically sorted keywords referenceAlphabetically sorted actions reference\" rulesets.\nThis is what is described in this section.\n\nLegacy header captures are performed using the \"capture request header\" and\n\"capture response header\" statements in the frontend. Please consult their\ndefinition in section 4.2 for more details.\n\nIt is possible to include both request headers and response headers at the same\ntime. Non-existent headers are logged as empty strings, and if one header\nappears more than once, only its last occurrence will be logged. Request headers\nare grouped within braces '{' and '}' in the same order as they were declared,\nand delimited with a vertical bar '|' without any space. Response headers\nfollow the same representation, but are displayed after a space following the\nrequest headers block. These blocks are displayed just before the HTTP request\nin the logs.\n\nAs a special case, it is possible to specify an HTTP header capture in a TCP\nfrontend. The purpose is to enable logging of headers which will be parsed in\nan HTTP backend if the request is then switched to this HTTP backend.\n\n```\n\nExample :```\n\n    # This instance chains to the outgoing proxy\n    listen proxy-out\n        mode http\n        option httplog\n        option logasap\n        log global\n        server cache1 192.168.1.1:3128\n\n        # log the name of the virtual server\n        capture request  header Host len 20\n\n        # log the amount of data uploaded during a POST\n        capture request  header Content-Length len 10\n\n        # log the beginning of the referrer\n        capture request  header Referer len 20\n\n        # server name (useful for outgoing proxies only)\n        capture response header Server len 20\n\n        # logging the content-length is useful with \"option logasap\"\n        capture response header Content-Length len 10\n\n        # log the expected cache behavior on the response\n        capture response header Cache-Control len 8\n\n        # the Via header will report the next proxy's name\n        capture response header Via len 20\n\n        # log the URL location during a redirection\n        capture response header Location len 20\n\n>>> Aug  9 20:26:09 localhost \\\n      haproxy[2022]: 127.0.0.1:34014 [09/Aug/2004:20:26:09] proxy-out \\\n      proxy-out/cache1 0/0/0/162/+162 200 +350 - - ---- 0/0/0/0/0 0/0 \\\n      {fr.adserver.yahoo.co||http://fr.f416.mail.} {|864|private||} \\\n      \"GET http://fr.adserver.yahoo.com/\"\n\n>>> Aug  9 20:30:46 localhost \\\n      haproxy[2022]: 127.0.0.1:34020 [09/Aug/2004:20:30:46] proxy-out \\\n      proxy-out/cache1 0/0/0/182/+182 200 +279 - - ---- 0/0/0/0/0 0/0 \\\n      {w.ods.org||} {Formilux/0.1.8|3495|||} \\\n      \"GET http://trafic.1wt.eu/ HTTP/1.1\"\n\n>>> Aug  9 20:30:46 localhost \\\n      haproxy[2022]: 127.0.0.1:34028 [09/Aug/2004:20:30:46] proxy-out \\\n      proxy-out/cache1 0/0/2/126/+128 301 +223 - - ---- 0/0/0/0/0 0/0 \\\n      {www.sytadin.equipement.gouv.fr||http://trafic.1wt.eu/} \\\n      {Apache|230|||http://www.sytadin.} \\\n      \"GET http://www.sytadin.equipement.gouv.fr/ HTTP/1.1\"\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "8.9. Examples of logs", "content": "## [8.9.](#8.9)Examples of logs\n\n```\nThese are real-world examples of logs accompanied with an explanation. Some of\nthem have been made up by hand. The syslog part has been removed for better\nreading. Their sole purpose is to explain how to decipher them.\n\n    >>> haproxy[674]: 127.0.0.1:33318 [15/Oct/2003:08:31:57.130] px-http \\\n          px-http/srv1 6559/0/7/147/6723 200 243 - - ---- 5/3/3/1/0 0/0 \\\n          \"HEAD / HTTP/1.0\"\n\n    => long request (6.5s) entered by hand through 'telnet'. The server replied\n       in 147 ms, and the session ended normally ('----')\n\n    >>> haproxy[674]: 127.0.0.1:33319 [15/Oct/2003:08:31:57.149] px-http \\\n          px-http/srv1 6559/1230/7/147/6870 200 243 - - ---- 324/239/239/99/0 \\\n          0/9 \"HEAD / HTTP/1.0\"\n\n    => Idem, but the request was queued in the global queue behind 9 other\n       requests, and waited there for 1230 ms.\n\n    >>> haproxy[674]: 127.0.0.1:33320 [15/Oct/2003:08:32:17.654] px-http \\\n          px-http/srv1 9/0/7/14/+30 200 +243 - - ---- 3/3/3/1/0 0/0 \\\n          \"GET /image.iso HTTP/1.0\"\n\n    => request for a long data transfer. The \"logasap\" option was specified, so\n       the log was produced just before transferring data. The server replied in\n       14 ms, 243 bytes of headers were sent to the client, and total time from\n       accept to first data byte is 30 ms.\n\n    >>> haproxy[674]: 127.0.0.1:33320 [15/Oct/2003:08:32:17.925] px-http \\\n          px-http/srv1 9/0/7/14/30 502 243 - - PH-- 3/2/2/0/0 0/0 \\\n          \"GET /cgi-bin/bug.cgi? HTTP/1.0\"\n\n    => the proxy blocked a server response either because of an \"http-response\n       deny\" rule, or because the response was improperly formatted and not\n       HTTP-compliant, or because it blocked sensitive information which risked\n       being cached. In this case, the response is replaced with a \"502 bad\n       gateway\". The flags (\"PH--\") tell us that it was HAProxy who decided to\n       return the 502 and not the server.\n\n    >>> haproxy[18113]: 127.0.0.1:34548 [15/Oct/2003:15:18:55.798] px-http \\\n          px-http/<NOSRV> -1/-1/-1/-1/8490 -1 0 - - CR-- 2/2/2/0/0 0/0 \"\"\n\n    => the client never completed its request and aborted itself (\"C---\") after\n       8.5s, while the proxy was waiting for the request headers (\"-R--\").\n       Nothing was sent to any server.\n\n    >>> haproxy[18113]: 127.0.0.1:34549 [15/Oct/2003:15:19:06.103] px-http \\\n         px-http/<NOSRV> -1/-1/-1/-1/50001 408 0 - - cR-- 2/2/2/0/0 0/0 \"\"\n\n    => The client never completed its request, which was aborted by the\n       time-out (\"c---\") after 50s, while the proxy was waiting for the request\n       headers (\"-R--\"). Nothing was sent to any server, but the proxy could\n       send a 408 return code to the client.\n\n    >>> haproxy[18989]: 127.0.0.1:34550 [15/Oct/2003:15:24:28.312] px-tcp \\\n          px-tcp/srv1 0/0/5007 0 cD 0/0/0/0/0 0/0\n\n    => This log was produced with \"option tcplog\". The client timed out after\n       5 seconds (\"c----\").\n\n    >>> haproxy[18989]: 10.0.0.1:34552 [15/Oct/2003:15:26:31.462] px-http \\\n          px-http/srv1 3183/-1/-1/-1/11215 503 0 - - SC-- 205/202/202/115/3 \\\n          0/0 \"HEAD / HTTP/1.0\"\n\n    => The request took 3s to complete (probably a network problem), and the\n       connection to the server failed ('SC--') after 4 attempts of 2 seconds\n       (config says 'retries 3'), and no redispatch (otherwise we would have\n       seen \"/+3\"). Status code 503 was returned to the client. There were 115\n       connections on this server, 202 connections on this proxy, and 205 on\n       the global process. It is possible that the server refused the\n       connection because of too many already established.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "9. Supported filters", "content": "# [9.](#9)Supported filters\n\n```\nHere are listed officially supported filters with the list of parameters they\naccept. Depending on compile options, some of these filters might be\nunavailable. The list of available filters is reported in haproxy -vv.\n\n```\n\n**See also :**\"[filter](#)- This keyword is available in sections :\n- [Alphabetically sorted keywords reference](#filter%20%28Alphabetically%20sorted%20keywords%20reference%29)\n- [Trace](#filter%20%28Trace%29)\n- [HTTP compression](#filter%20%28HTTP%20compression%29)\n- [Stream Processing Offload Engine (SPOE)](#filter%20%28Stream%20Processing%20Offload%20Engine%20%28SPOE%29%29)\n- [Cache](#filter%20%28Cache%29)\n- [fcgi-app](#filter%20%28fcgi-app%29)\n- [OpenTracing](#filter%20%28OpenTracing%29)\n- [Bandwidth limitation](#filter%20%28Bandwidth%20limitation%29)\n\n\"", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "9.1. Trace", "content": "## [9.1.](#9.1)Trace\n\n**[filter trace](#9.1-filter%20trace)**[name<name>][random-forwarding][hexdump]Arguments:```\n<name>               is an arbitrary name that will be reported in\n                     messages. If no name is provided, \"TRACE\" is used.\n\n<quiet>              inhibits trace messages.\n\n<random-forwarding>  enables the random forwarding of parsed data. By\n                     default, this filter forwards all previously parsed\n                     data. With this parameter, it only forwards a random\n                     amount of the parsed data.\n\n<hexdump>             dumps all forwarded data to the server and the client.\n```\n\n```\nThis filter can be used as a base to develop new filters. It defines all\ncallbacks and print a message on the standard error stream (stderr) with useful\ninformation for all of them. It may be useful to debug the activity of other\nfilters or, quite simply, HAProxy's activity.\n\nUsing <random-parsing> and/or <random-forwarding> parameters is a good way to\ntests the behavior of a filter that parses data exchanged between a client and\na server by adding some latencies in the processing.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "9.2. HTTP compression", "content": "## [9.2.](#9.2)HTTP compression\n\n**[filter compression](#9.2-filter%20compression)**```\nThe HTTP compression has been moved in a filter in HAProxy 1.7. \"compression\"\nkeyword must still be used to enable and configure the HTTP compression. And\nwhen no other filter is used, it is enough. When used with the cache or the\nfcgi-app enabled, it is also enough. In this case, the compression is always\ndone after the response is stored in the cache. But it is mandatory to\nexplicitly use a filter line to enable the HTTP compression when at least one\nfilter other than the cache or the fcgi-app is used for the same\nlistener/frontend/backend. This is important to know the filters evaluation\norder.\n\n```\n\n**See also :**\"[compression](#compression)\",[section 9.4](#9.4)about the cache filter and[section 9.5](#9.5)about the fcgi-app filter.", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "9.3. Stream Processing Offload Engine (SPOE)", "content": "## [9.3.](#9.3)Stream Processing Offload Engine (SPOE)\n\n**[filter spoe](#9.3-filter%20spoe)**[engine<name>]config<file>Arguments :```\n<name>      is the engine name that will be used to find the right scope in\n            the configuration file. If not provided, all the file will be\n            parsed.\n\n<file>      is the path of the engine configuration file. This file can\n            contain configuration of several engines. In this case, each\n            part must be placed in its own scope.\n```\n\n```\nThe Stream Processing Offload Engine (SPOE) is a filter communicating with\nexternal components. It allows the offload of some specifics processing on the\nstreams in tiered applications. These external components and information\nexchanged with them are configured in dedicated files, for the main part. It\nalso requires dedicated backends, defined in HAProxy configuration.\n\nSPOE communicates with external components using an in-house binary protocol,\nthe Stream Processing Offload Protocol (SPOP).\n\nWhen the SPOE is used on a stream, a dedicated stream is spawned to handle the\ncommunication with the external component. The main stream is the parent stream\nof this \"SPOE\" stream. It means it is possible to retrieve variables of the\nmain stream from the \"SPOE\" stream. See section 2.8 about variables for\ndetails.\n\nFor all information about the SPOE configuration and the SPOP specification, see\n\"doc/SPOE.txt\".\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "9.4. Cache", "content": "## [9.4.](#9.4)Cache\n\n**[filter cache](#9.4-filter%20cache)**<name>Arguments :```\n<name>      is name of the cache section this filter will use.\n```\n\n```\nThe cache uses a filter to store cacheable responses. The HTTP rules\n\"cache-store\" and \"cache-use\" must be used to define how and when to use a\ncache. By default the corresponding filter is implicitly defined. And when no\nother filters than fcgi-app or compression are used, it is enough. In such\ncase, the compression filter is always evaluated after the cache filter. But it\nis mandatory to explicitly use a filter line to use a cache when at least one\nfilter other than the compression or the fcgi-app is used for the same\nlistener/frontend/backend. This is important to know the filters evaluation\norder.\n\n```\n\n**See also :**[section 9.2](#9.2)about the compression filter,[section 9.5](#9.5)about the fcgi-app filter and[section 6](#6)about cache.", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "9.5. Fcgi-app", "content": "## [9.5.](#9.5)Fcgi-app\n\n**[filter fcgi-app](#9.5-filter%20fcgi-app)**<name>Arguments :```\n<name>      is name of the fcgi-app section this filter will use.\n```\n\n```\nThe FastCGI application uses a filter to evaluate all custom parameters on the\nrequest path, and to process the headers on the response path. the <name> must\nreference an existing fcgi-app section. The directive \"use-fcgi-appThis keyword is available in sections :Proxy sectionAlphabetically sorted keywords reference\" should be\nused to define the application to use. By default the corresponding filter is\nimplicitly defined. And when no other filters than cache or compression are\nused, it is enough. But it is mandatory to explicitly use a filter line to a\nfcgi-app when at least one filter other than the compression or the cache is\nused for the same backend. This is important to know the filters evaluation\norder.\n\n```\n\n**See also:**\"[use-fcgi-app](#)- This keyword is available in sections :\n- [Proxy section](#use-fcgi-app%20%28Proxy%20section%29)\n- [Alphabetically sorted keywords reference](#use-fcgi-app%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\",[section 9.2](#9.2)about the compression filter,[section 9.4](#9.4)about the cache filter and[section 10](#10)about FastCGI application.", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "9.6. OpenTracing", "content": "## [9.6.](#9.6)OpenTracing\n\n```\nThe OpenTracing filter adds native support for using distributed tracing in\nHAProxy. This is enabled by sending an OpenTracing compliant request to one\nof the supported tracers such as Datadog, Jaeger, Lightstep and Zipkin tracers.\nPlease note: tracers are not listed by any preference, but alphabetically.\n\nThis feature is only enabled when HAProxy was built with USE_OT=1.\n\nThe OpenTracing filter activation is done explicitly by specifying it in the\nHAProxy configuration. If this is not done, the OpenTracing filter in no way\nparticipates in the work of HAProxy.\n\n```\n\n**[filter opentracing](#9.6-filter%20opentracing)**[id<id>]config<file>Arguments :```\n<id>        is the OpenTracing filter id that will be used to find the\n            right scope in the configuration file. If no filter id is\n            specified, 'ot-filter' is used as default.  If scope is not\n            specified in the configuration file, it applies to all defined\n            OpenTracing filters.\n\n<file>      is the path of the OpenTracing configuration file. The same\n            file can contain configurations for multiple OpenTracing\n            filters simultaneously. In that case we do not need to define\n            scope so the same configuration applies to all filters or each\n            filter must have its own scope defined.\n```\n\n```\nMore detailed documentation related to the operation, configuration and use\nof the filter can be found in the addons/ot directory.\n\nNote: The OpenTracing filter shouldn't be used for new designs as OpenTracing\n      itself is no longer maintained nor supported by its authors. A\n      replacement filter base on OpenTelemetry is currently under development\n      and is expected to be ready around HAProxy 3.2. As such OpenTracing will\n      be deprecated in 3.3 and removed in 3.5.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "9.7. Bandwidth limitation", "content": "## [9.7.](#9.7)Bandwidth limitation\n\n**[filter bwlim-in](#9.7-filter%20bwlim-in)**<name>default-limit<size>default-period<time>[min-size<sz>]**[filter bwlim-out](#9.7-filter%20bwlim-out)**<name>default-limit<size>default-period<time>[min-size<sz>]**[filter bwlim-in](#9.7-filter%20bwlim-in)**<name>limit<size>key<pattern>[table<table>][min-size<sz>]**[filter bwlim-out](#9.7-filter%20bwlim-out)**<name>limit<size>key<pattern>[table<table>][min-size<sz>]Arguments :```\n<name>      is the filter name that will be used by 'set-bandwidth-limit'\n            actions to reference a specific bandwidth limitation filter.\n\n<size>      is max number of bytes that can be forwarded over the period.\n            The value must be specified for per-stream and shared bandwidth\n            limitation filters. It follows the HAProxy size format and is\n            expressed in bytes.\n\n<pattern>   is a sample expression rule as described in section 7.3. It\n            describes what elements will be analyzed, extracted, combined,\n            and used to select which table entry to update the counters. It\n            must be specified for shared bandwidth limitation filters only.\n\n<table>     is an optional table to be used instead of the default one,\n            which is the stick-table declared in the current proxy. It can\n            be specified for shared bandwidth limitation filters only.\n\n<time>      is the default time period used to evaluate the bandwidth\n            limitation rate. It can be specified for per-stream bandwidth\n            limitation filters only. It follows the HAProxy time format and\n            is expressed in milliseconds.\n\n<min-size>  is the optional minimum number of bytes forwarded at a time by\n            a stream excluding the last packet that may be smaller. This\n            value can be specified for per-stream and shared bandwidth\n            limitation filters. It follows the HAProxy size format and is\n            expressed in bytes.\n```\n\n```\nBandwidth limitation filters should be used to restrict the data forwarding\nspeed at the stream level. By extension, such filters limit the network\nbandwidth consumed by a resource. Several bandwidth limitation filters can be\nused. For instance, it is possible to define a limit per source address to be\nsure a client will never consume all the network bandwidth, thereby penalizing\nother clients, and another one per stream to be able to fairly handle several\nconnections for a given client.\n\nThe definition order of these filters is important. If several bandwidth\nfilters are enabled on a stream, the filtering will be applied in their\ndefinition order. It is also important to understand the definition order of\nthe other filters have an influence. For instance, depending on the HTTP\ncompression filter is defined before or after a bandwidth limitation filter,\nthe limit will be applied on the compressed payload or not. The same is true\nfor the cache filter.\n\nThere are two kinds of bandwidth limitation filters. The first one enforces a\ndefault limit and is applied per stream. The second one uses a stickiness table\nto enforce a limit equally divided between all streams sharing the same entry in\nthe table.\n\nIn addition, for a given filter, depending on the filter keyword used, the\nlimitation can be applied on incoming data, received from the client and\nforwarded to a server, or on outgoing data, received from a server and sent to\nthe client. To apply a limit on incoming data, \"bwlim-in\" keyword must be\nused. To apply it on outgoing data, \"bwlim-out\" keyword must be used. In both\ncases, the bandwidth limitation is applied on forwarded data, at the stream\nlevel.\n\nThe bandwidth limitation is applied at the stream level and not at the\nconnection level. For multiplexed protocols (H2, H3 and FastCGI), the streams\nof the same connection may have different limits.\n\nFor a per-stream bandwidth limitation filter, default period and limit must be\ndefined. As their names suggest, they are the default values used to setup the\nbandwidth limitation rate for a stream. However, for this kind of filter and\nonly this one, it is possible to redefine these values using sample expressions\nwhen the filter is enabled with a TCP/HTTP \"set-bandwidth-limit\" action.\n\nFor a shared bandwidth limitation filter, depending on whether it is applied on\nincoming or outgoing data, the stickiness table used must store the\ncorresponding bytes rate information. \"bytes_in_rate(<period>)\" counter must be\nstored to limit incoming data and \"bytes_out_rate(<period>)\" counter must be\nused to limit outgoing data.\n\nFinally, it is possible to set the minimum number of bytes that a bandwidth\nlimitation filter can forward at a time for a given stream. It should be used\nto not forward too small amount of data, to reduce the CPU usage. It must\ncarefully be defined. Too small, a value can increase the CPU usage. Too high,\nit can increase the latency. It is also highly linked to the defined bandwidth\nlimit. If it is too close to the bandwidth limit, some pauses may be\nexperienced to not exceed the limit because too many bytes will be consumed at\na time. It is highly dependent on the filter configuration. A good idea is to\nstart with something around 2 TCP MSS, typically 2896 bytes, and tune it after\nsome experimentations.\n\n```\n\nExample:```\n\nfrontend http\n    bind *:80\n    mode http\n\n    # If this filter is enabled, the stream will share the download limit\n    # of 10m/s with all other streams with the same source address.\n    filter bwlim-out limit-by-src key src table limit-by-src limit 10m\n\n    # If this filter is enabled, the stream will be limited to download at 1m/s,\n    # independently of all other streams.\n    filter bwlim-out limit-by-strm default-limit 1m default-period 1s\n\n    # Limit all streams to 1m/s (the default limit) and those accessing the\n    # internal API to 100k/s. Limit each source address to 10m/s. The shared\n    # limit is applied first. Both are limiting the download rate.\n    http-request set-bandwidth-limit limit-by-strm\n    http-request set-bandwidth-limit limit-by-strm limit 100k if { path_beg /internal }\n    http-request set-bandwidth-limit limit-by-src\n    ...\n\nbackend limit-by-src\n    # The stickiness table used by <limit-by-src> filter\n    stick-table type ip size 1m expire 3600s store bytes_out_rate(1s)\n\n```\n\n**See also :**\"tcp-request content set-bandwidth-limit\", \"tcp-response content set-bandwidth-limit\", \"http-request set-bandwidth-limit\" and \"http-response set-bandwidth-limit\".", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "10. FastCGI applications", "content": "# [10.](#10)FastCGI applications\n\n```\nHAProxy is able to send HTTP requests to Responder FastCGI applications. This\nfeature was added in HAProxy 2.1. To do so, servers must be configured to use\nthe FastCGI protocol (using the keyword \"proto fcgi\" on the server line) and a\nFastCGI application must be configured and used by the backend managing these\nservers (using the keyword \"use-fcgi-appThis keyword is available in sections :Proxy sectionAlphabetically sorted keywords reference\" into the proxy section). Several\nFastCGI applications may be defined, but only one can be used at a time by a\nbackend.\n\nHAProxy implements all features of the FastCGI specification for Responder\napplication. Especially it is able to multiplex several requests on a simple\nconnection.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "10.1. Setup", "content": "## [10.1.](#10.1)Setup\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "10.1.1. Fcgi-app section", "content": "### [10.1.1.](#10.1.1)Fcgi-app section\n\n**[fcgi-app](#10.1.1-fcgi-app)**<name>```\nDeclare a FastCGI application named <name>. To be valid, at least the\ndocument root must be defined.\n\n```\n\n**[acl](#10.1.1-acl)**<aclname><criterion>[flags][operator]<value>...```\nDeclare or complete an access list.\n\nSee \"aclThis keyword is available in sections :Fcgi-app sectionAlphabetically sorted keywords referenceFetching samples from internal states\" keyword in section 4.2 and section 7 about ACL usage for\ndetails. ACLs defined for a FastCGI application are private. They cannot be\nused by any other application or by any proxy. In the same way, ACLs defined\nin any other section are not usable by a FastCGI application. However,\nPre-defined ACLs are available.\n\n```\n\n**[docroot](#10.1.1-docroot)**<path>Define the document root on the remote host.<path>will be used to build the default value of FastCGI parameters SCRIPT_FILENAME and PATH_TRANSLATED. It is a mandatory setting.**[index](#10.1.1-index)**<script-name>```\nDefine the script name that will be appended after an URI that ends with a\nslash (\"/\") to set the default value of the FastCGI parameter SCRIPT_NAME. It\nis an optional setting.\n\n```\n\nExample :```\n\nindex index.php\n\n```\n\n**[log-stderr global](#10.1.1-log-stderr%20global)****[log-stderr](#10.1.1-log-stderr)**<target>[len<length>][format<format>][sample<ranges>:<sample_size>]<facility>[<level>[<minlevel>]]```\nEnable logging of STDERR messages reported by the FastCGI application.\n\nSee \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\" keyword in section 4.2 for details. It is an optional setting. By\ndefault STDERR messages are ignored.\n\n```\n\n**[pass-header](#10.1.1-pass-header)**<name>[{ if | unless }<condition>]```\nSpecify the name of a request header which will be passed to the FastCGI\napplication. It may optionally be followed by an ACL-based condition, in\nwhich case it will only be evaluated if the condition is true.\n\nMost request headers are already available to the FastCGI application,\nprefixed with \"HTTP_\". Thus, this directive is only required to pass headers\nthat are purposefully omitted. Currently, the headers \"Authorization\",\n\"Proxy-Authorization\" and hop-by-hop headers are omitted.\n\nNote that the headers \"Content-type\" and \"Content-length\" are never passed to\nthe FastCGI application because they are already converted into parameters.\n\n```\n\n**[path-info](#10.1.1-path-info)**<regex>```\nDefine a regular expression to extract the script-name and the path-info from\nthe URL-decoded path. Thus, <regex> may have two captures: the first one to\ncapture the script name and the second one to capture the path-info. The\nfirst one is mandatory, the second one is optional. This way, it is possible\nto extract the script-name from the path ignoring the path-info. It is an\noptional setting. If it is not defined, no matching is performed on the\npath. and the FastCGI parameters PATH_INFO and PATH_TRANSLATED are not\nfilled.\n\nFor security reason, when this regular expression is defined, the newline and\nthe null characters are forbidden from the path, once URL-decoded. The reason\nto such limitation is because otherwise the matching always fails (due to a\nlimitation one the way regular expression are executed in HAProxy). So if one\nof these two characters is found in the URL-decoded path, an error is\nreturned to the client. The principle of least astonishment is applied here.\n\n```\n\nExample :```\n\npath-info ^(/.+\\.php)(/.*)?$ # both script-name and path-info may be set\npath-info ^(/.+\\.php)        # the path-info is ignored\n\n```\n\n**[option get-values](#10.1.1-option%20get-values)****[no option get-values](#10.1.1-no%20option%20get-values)**```\nEnable or disable the retrieve of variables about connection management.\n\nHAProxy is able to send the record FCGI_GET_VALUES on connection\nestablishment to retrieve the value for following variables:\n\n  * FCGI_MAX_REQS     The maximum number of concurrent requests this\n                      application will accept.\n\n  * FCGI_MPXS_CONNS   \"0\" if this application does not multiplex connections,\n                      \"1\" otherwise.\n\nSome FastCGI applications does not support this feature. Some others close\nthe connection immediately after sending their response. So, by default, this\noption is disabled.\n\nNote that the maximum number of concurrent requests accepted by a FastCGI\napplication is a connection variable. It only limits the number of streams\nper connection. If the global load must be limited on the application, the\nserver parameters \"maxconnThis keyword is available in sections :Log forwardingPerformance tuningAlphabetically sorted keywords referenceBind optionsServer and default-server options\" and \"pool-max-conn\" must be set. In addition, if\nan application does not support connection multiplexing, the maximum number\nof concurrent requests is automatically set to 1.\n\n```\n\n**[option keep-conn](#10.1.1-option%20keep-conn)****[no option keep-conn](#10.1.1-no%20option%20keep-conn)**```\nInstruct the FastCGI application to keep the connection open or not after\nsending a response.\n\n If disabled, the FastCGI application closes the connection after responding\n to this request. By default, this option is enabled.\n\n```\n\n**[option max-reqs](#10.1.1-option%20max-reqs)**<reqs>```\nDefine the maximum number of concurrent requests this application will\naccept.\n\nThis option may be overwritten if the variable FCGI_MAX_REQS is retrieved\nduring connection establishment. Furthermore, if the application does not\nsupport connection multiplexing, this option will be ignored. By default set\nto 1.\n\n```\n\n**[option mpxs-conns](#10.1.1-option%20mpxs-conns)****[no option mpxs-conns](#10.1.1-no%20option%20mpxs-conns)**```\nEnable or disable the support of connection multiplexing.\n\nThis option may be overwritten if the variable FCGI_MPXS_CONNS is retrieved\nduring connection establishment. It is disabled by default.\n\n```\n\n**[set-param](#10.1.1-set-param)**<name><fmt>[{ if | unless }<condition>]```\nSet a FastCGI parameter that should be passed to this application. Its\nvalue, defined by <fmt> must follows the Custom log format rules (see section\n8.2.6 \"Custom Log format\"). It may optionally be followed by an ACL-based\ncondition, in which case it will only be evaluated if the condition is true.\n\nWith this directive, it is possible to overwrite the value of default FastCGI\nparameters. If the value is evaluated to an empty string, the rule is\nignored. These directives are evaluated in their declaration order.\n\n```\n\nExample :```\n\n# PHP only, required if PHP was built with --enable-force-cgi-redirect\nset-param REDIRECT_STATUS 200\n\nset-param PHP_AUTH_DIGEST %[req.hdr(Authorization)]\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "10.1.2. Proxy section", "content": "### [10.1.2.](#10.1.2)Proxy section\n\n**[use-fcgi-app](#10.1.2-use-fcgi-app)**<name>```\nDefine the FastCGI application to use for the backend.\n\n```\n\nArguments :```\n<name>    is the name of the FastCGI application to use.\n```\n\n```\nThis keyword is only available for HTTP proxies with the backend capability\nand with at least one FastCGI server. However, FastCGI servers can be mixed\nwith HTTP servers. But except there is a good reason to do so, it is not\nrecommended (see section 10.3 about the limitations for details). Only one\napplication may be defined at a time per backend.\n\nNote that, once a FastCGI application is referenced for a backend, depending\non the configuration some processing may be done even if the request is not\nsent to a FastCGI server. Rules to set parameters or pass headers to an\napplication are evaluated.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "10.1.3. Example", "content": "### [10.1.3.](#10.1.3)Example\n\n```\nfrontend front-http\n    mode http\n    bind *:80\n    bind *:\n\n    use_backend back-dynamic if { path_reg ^/.+\\.php(/.*)?$ }\n    default_backend back-static\n\nbackend back-static\n    mode http\n    server www A.B.C.D:80\n\nbackend back-dynamic\n    mode http\n    use-fcgi-app php-fpm\n    server php-fpm A.B.C.D:9000 proto fcgi\n\nfcgi-app php-fpm\n    log-stderr global\n    option keep-conn\n\n    docroot /var/www/my-app\n    index index.php\n    path-info ^(/.+\\.php)(/.*)?$\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "10.2. Default parameters", "content": "## [10.2.](#10.2)Default parameters\n\n```\nA Responder FastCGI application has the same purpose as a CGI/1.1 program. In\nthe CGI/1.1 specification (RFC3875), several variables must be passed to the\nscript. So HAProxy set them and some others commonly used by FastCGI\napplications. All these variables may be overwritten, with caution though.\n\n  +-------------------+-----------------------------------------------------+\n  | AUTH_TYPE         | Identifies the mechanism, if any, used by HAProxy   |\n  |                   | to authenticate the user. Concretely, only the      |\n  |                   | BASIC authentication mechanism is supported.        |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | CONTENT_LENGTH    | Contains the size of the message-body attached to   |\n  |                   | the request. It means only requests with a known    |\n  |                   | size are considered as valid and sent to the        |\n  |                   | application.                                        |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | CONTENT_TYPE      | Contains the type of the message-body attached to   |\n  |                   | the request. It may not be set.                     |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | DOCUMENT_ROOT     | Contains the document root on the remote host under |\n  |                   | which the script should be executed, as defined in  |\n  |                   | the application's configuration.                    |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | GATEWAY_INTERFACE | Contains the dialect of CGI being used by HAProxy   |\n  |                   | to communicate with the FastCGI application.        |\n  |                   | Concretely, it is set to \"CGI/1.1\".                 |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | PATH_INFO         | Contains the portion of the URI path hierarchy      |\n  |                   | following the part that identifies the script       |\n  |                   | itself. To be set, the directive \"path-info\" must   |\n  |                   | be defined.                                         |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | PATH_TRANSLATED   | If PATH_INFO is set, it is its translated version.  |\n  |                   | It is the concatenation of DOCUMENT_ROOT and        |\n  |                   | PATH_INFO. If PATH_INFO is not set, this parameters |\n  |                   | is not set too.                                     |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | QUERY_STRING      | Contains the request's query string. It may not be  |\n  |                   | set.                                                |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | REMOTE_ADDR       | Contains the network address of the client sending  |\n  |                   | the request.                                        |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | REMOTE_USER       | Contains the user identification string supplied by |\n  |                   | client as part of user authentication.              |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | REQUEST_METHOD    | Contains the method which should be used by the     |\n  |                   | script to process the request.                      |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | REQUEST_URI       | Contains the request's URI.                         |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | SCRIPT_FILENAME   | Contains the absolute pathname of the script. it is |\n  |                   | the concatenation of DOCUMENT_ROOT and SCRIPT_NAME. |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | SCRIPT_NAME       | Contains the name of the script. If the directive   |\n  |                   | \"path-info\" is defined, it is the first part of the |\n  |                   | URI path hierarchy, ending with the script name.    |\n  |                   | Otherwise, it is the entire URI path.               |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | SERVER_NAME       | Contains the name of the server host to which the   |\n  |                   | client request is directed. It is the value of the  |\n  |                   | header \"Host\", if defined. Otherwise, the           |\n  |                   | destination address of the connection on the client |\n  |                   | side.                                               |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | SERVER_PORT       | Contains the destination TCP port of the connection |\n  |                   | on the client side, which is the port the client    |\n  |                   | connected to.                                       |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | SERVER_PROTOCOL   | Contains the request's protocol.                    |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | SERVER_SOFTWARE   | Contains the string \"HAProxy\" followed by the       |\n  |                   | current HAProxy version.                            |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n  | HTTPS             | Set to a non-empty value (\"on\") if the script was   |\n  |                   | queried through the HTTPS protocol.                 |\n  |                   |                                                     |\n  +-------------------+-----------------------------------------------------+\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "10.3. Limitations", "content": "## [10.3.](#10.3)Limitations\n\n```\nThe current implementation have some limitations. The first one is about the\nway some request headers are hidden to the FastCGI applications. This happens\nduring the headers analysis, on the backend side, before the connection\nestablishment. At this stage, HAProxy know the backend is using a FastCGI\napplication but it don't know if the request will be routed to a FastCGI server\nor not. But to hide request headers, it simply removes them from the HTX\nmessage. So, if the request is finally routed to an HTTP server, it never see\nthese headers. For this reason, it is not recommended to mix FastCGI servers\nand HTTP servers under the same backend.\n\nSimilarly, the rules \"set-param\" and \"pass-header\" are evaluated during the\nrequest headers analysis. So the evaluation is always performed, even if the\nrequests is finally forwarded to an HTTP server.\n\nAbout the rules \"set-param\", when a rule is applied, a pseudo header is added\ninto the HTX message. So, the same way than for HTTP header rewrites, it may\nfail if the buffer is full. The rules \"set-param\" will compete with\n\"http-request\" ones.\n\nFinally, all FastCGI params and HTTP headers are sent into a unique record\nFCGI_PARAM. Encoding of this record must be done in one pass, otherwise a\nprocessing error is returned. It means the record FCGI_PARAM, once encoded,\nmust not exceeds the size of a buffer. However, there is no reserve to respect\nhere.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "11. Stick-tables and Peers", "content": "# [11.](#11)Stick-tables and Peers\n\n```\nStick-tables in HAProxy are a mechanism which permits to associate a certain\nnumber of information and metrics with a key of a certain type, and this for a\ncertain duration after the last update. This can be seen as a multicolumn line\nin a table, where the line number is defined by the key value, and the columns\nall represent distinct criteria.\n\nStick-tables were originally designed to store client-server stickiness\ninformation in order to maintain persistent sessions between these entities. A\nclient would connect or send a request, this client would be identified via a\ndiscriminator (source address, cookie, URL parameter) and the chosen server\nwould be stored in association with this discriminator in a stick table for a\nconfigurable duration so that subsequent accesses from the same client could\nautomatically be routed to the same server, where the client had created its\napplication session.\n\nNowadays, stick-tables can store more information than just a server number,\nelements such as activity metrics related to a specific client can be stored\n(request counts/rates, connection counts/rates, byte counts/rates etc), as well\nas some arbitrary event counters (\"gpc\" for \"General Purpose Counters\") and\nsome tags to label a client with certain characteristics (\"gpt\" for \"General\nPurpose Tag\").\n\nStick-tables may be referenced by the \"stickThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server options\" directives, which are used for\nclient-server stickiness, by \"track-sc\" rules, which are used to describe what\nkey to track in which table in order to collect metrics, as well as by a number\nof sample-fetch functions and converters which can perform an immediate lookup\nof a given key to retrieve a specific metric or data. The general principle is\nthat updates to tables (gpt/gpc/metrics) as well as lookups of stickiness\ninformation refresh the accessed entry and postpone its expiration, while mere\nlookups from sample-fetch functions and converters only extract the data\nwithout postponing the entry's expiration.\n\nIn order for the mechanism to scale and to resist to HAProxy reloads and fail-\nover, it is possible to share stick-tables updates with other nodes called\n\"peers\" via the \"Peers\" mechanism described in section 11.2. In order to finely\ntune the communication with peers, it is possible to also decide that some\ntables only receive information from peers, or that updates from peers should\ninstead be forwarded to a different table.\n\nFinally, stick-tables may be declared either in proxy sections (frontends,\nbackends) using the \"stick-tableThis keyword is available in sections :Stick-tables declarationAlphabetically sorted keywords reference\" keyword, where there may only be one per\nsection and where they will get the name of that section, or in peers sections\nwith the \"tableThis keyword is available in sections :Stick-tables declarationPeers declaration\" keyword followed by the table's name, and which permits to\ndeclare multiple stick-tables in the same \"peers\" section. If multiple\nstick-tables are needed, usually the recommended solution is either to declare\nthem in a peers section (in case they intend to be shared), or to create extra\nbackend sections, each with only the \"stick-tableThis keyword is available in sections :Stick-tables declarationAlphabetically sorted keywords reference\" definition in them.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "11.1. stick-table declaration", "content": "## [11.1.](#11.1)stick-table declaration\n\n```\nThe declaration of a stick-table in a proxy section (\"frontend\", \"backend\",\n\"listen\") and in \"peers\" sections is very similar, with the differences being\nthat the one in the peers section requires a mandatory name and doesn't take a\n\"peers\" option.\n\nIn a \"frontend\", \"backend\" or \"listen\" section:\n\n```\n\n**[stick-table type](#11.1-stick-table%20type)**<type>size<size>[expire<expire>][nopurge][recv-only][write-to<wtable>][srvkey<srvkey>][store<data_type>]*[brates-factor<factor>][peers<peersect>]```\nIn a \"peers\" section:\n\n```\n\n**[table](#11.1-table)**<name>type<type>size<size>[expire<expire>][nopurge][recv-only][write-to<wtable>][srvkey<srvkey>][store<data_type>]*[brates-factor<factor>]Arguments:(mandatory ones first, then alphabetically sorted):```\n- type <type>\n           This mandatory argument sets the key type to <type>, which\n           usually is a single word but may also have its own arguments:\n\n   * ip        This type should be avoided in favor of a more explicit one such\n               as \"ipv4\" or \"ipv6\". Prior to version 3.2 it was the only way to\n               configure IPv4. In 3.2, \"ip\" is an alias for \"ipv4\", and \"ipv4\"\n               is preferred. In a future version, \"ip\" will instead correspond\n               to \"ipv6\". It is only meant to ease the transition from pre-3.2\n               to post-3.2.\n\n   * ipv4      A table declared with this type will only store IPv4 addresses.\n               This form is very compact (about 50 bytes per entry) and allows\n               very fast entry lookup and stores with almost no overhead. This\n               is mainly used to store client source IP addresses.\n\n   * ipv6      A table declared with \"type ipv6\" will only store IPv6 addresses.\n               This form is very compact (about 60 bytes per entry) and allows\n               very fast entry lookup and stores with almost no overhead. This\n               is mainly used to store client source IP addresses.\n\n   * integer   A table declared with \"type integer\" will store 32bit integers\n               which can represent a client identifier found in a request for\n               instance.\n\n   * string [len <len>]\n               A table declared with \"type string\" will store substrings of\n               up to <len> characters. If the string provided by the pattern\n               extractor is larger than <len>, it will be truncated before\n               being stored. During matching, at most <len> characters will\n               be compared between the string in the table and the extracted\n               pattern. When not specified, the string is automatically\n               limited to 32 characters. Increasing the length can have a\n               non-negligible memory usage impact.\n\n   * binary [len <len>]\n               A table declared with \"type binary\" will store binary blocks\n               of <len> bytes. If the block provided by the pattern\n               extractor is larger than <len>, it will be truncated before\n               being stored. If the block provided by the sample expression\n               is shorter than <len>, it will be padded by 0. When not\n               specified, the block is automatically limited to 32\n               bytes. Increasing the length can have a non-negligible memory\n               usage impact.\n\n- size <size>\n           This mandatory argument sets maximum number of entries that can\n           fit in the table to <size>. This value directly impacts memory\n           usage. Count approximately 50 bytes per entry in addition to the\n           key size above, and optionally stored metrics, plus the size of a\n           string if any. The size supports suffixes \"k\", \"m\", \"g\" for 2^10,\n           2^20 and 2^30 factors.\n\n- expire <delay>\n           Defines the maximum duration of an entry in the table since it was\n           last created, refreshed using 'track-sc' or matched using 'stick\n           match' or 'stick on' rule. The expiration delay <delay> is defined\n           using the standard time format, similarly as the various timeouts,\n           defaulting to milliseconds. The maximum duration is slightly above\n           24 days. See section 2.5 for more information. If this delay is\n           not specified, sessions won't automatically expire, but oldest\n           entries will be removed upon creation once full. Be sure not to\n           use the \"nopurge\" parameter if not expiration delay is specified.\n           Note: 'table_*' converters performs lookups but won't update touch\n           expire since they don't require 'track-sc'.\n\n- brates-factor <factor>\n           Specifies a factor to be applied to in/out bytes rate. Instead of\n           counting each bytes, blocks of bytes are counted. Internally,\n           rates are defined on 32-bits counters, limiting them to about 4\n           billion per period. By using this parameter, it is possible to\n           have rates exceeding this 4G limit over the defined period. The\n           factor must be greater than 0 and lower than or equal to 1024.\n\n- nopurge  indicates that we refuse to purge older entries when the table is\n           full. When not specified and the table is full when HAProxy wants\n           to store an entry in it, it will flush a few of the oldest entries\n           in order to release some space for the new ones. This is most\n           often the desired behavior. In some specific cases, it will be\n           desirable to refuse new entries instead of purging the older ones.\n           That may be the case when the amount of data to store is far above\n           the hardware limits and we prefer not to offer access to new\n           clients than to reject the ones already connected. When using this\n           parameter, be sure to properly set the \"expire\" parameter (see\n           above).\n\n- recv-only\n           indicates that we don't intend to use the table to perform updates\n           on it, but that we only plan on using the table to retrieve data\n           from a remote peer which we are interested in. Indeed, the use of\n           this keyword enables the retrieval of local-only values such as\n           \"conn_cur\" that are not learned by default as they would conflict\n           with local updates performed on the table by the local peer. Use\n           of this option is only relevant for tables that are not involved\n           in tracking rules or methods that perform update operations on the\n           table, or put simpler: remote tables that are only used to\n           retrieve information.\n\n- peers <peersect>\n           Entries that are created, updated or refreshed will be sent to the\n           peers in section <peersect> for synchronization, and keys learned\n           from peers in this section will also be inserted or updated in the\n           table. Additionally, on startup, an attempt may be done to learn\n           entries from an older instance of the process, designated as the\n           \"local peer\" via this section.\n\n- srvkey <srvkey>\n           Specifies how each server is identified for the purposes of the\n           stick table. The valid values are \"name\" and \"addr\". If \"name\" is\n           given, then <name> argument for the server (may be generated by a\n           template). If \"addr\" is given, then the server is identified by\n           its current network address, including the port. \"addr\" is\n           especially useful if you are using service discovery to generate\n           the addresses for servers with peered stick-tables and want to\n           consistently use the same host across peers for a stickiness\n           token.\n\n- store <data_type>\n           This is used to store additional information in the stick-table.\n           This may be used by ACLs in order to control various criteria\n           related to the activity of the client matching the stick-table.\n           For each item specified here, the size of each entry will be\n           inflated so that the additional data can fit. Several data types\n           may be stored with an entry. Multiple data types may be specified\n           after the \"store\" keyword, as a comma-separated list.\n           Alternatively, it is possible to repeat the \"store\" keyword\n           followed by one or several data types. Except for the \"server_id\"\n           type which is automatically detected and enabled, all data types\n           must be explicitly declared to be stored. If an ACL references a\n           data type which is not stored, the ACL will simply not match. Some\n           data types require an argument which must be passed just after the\n           type between parenthesis. See below for the supported data types\n           and their arguments.\n\n- write-to <wtable>\n           Specifies the name of another stick table where peers updates will\n           be written to in addition to the source table. <wtable> must be of\n           the same type as the table being defined and must have the same\n           key length, and source table cannot be used as a target table\n           itself. Every time an entry update will be received on the source\n           table through a peer, HAProxy will try to refresh related <wtable>\n           entry. If the entry doesn't exist yet, it will be created, else\n           its values will be updated as well as its timer. Note that only\n           types that are not involved in arithmetic ops such as server_id,\n           server_key and gpt will be written to <wtable> to prevent\n           processed values from a remote table from interfering with\n           arithmetic operations performed on the local target table. (ie:\n           prevent shared cumulative counter from growing indefinitely) One\n           common use of this option is to be able to use sticking rules (for\n           server persistence) in a peers cluster setup, because matching\n           keys will be learned from remote tables.\n```\n\n```\nThe data types that can be associated with an entry via the \"store\" directive\nare listed below. It is important to keep in mind that memory requirements may\nbe important when storing many data types. Indeed, storing all indicators below\nat once in each entry can requires hundreds of bytes per entry, or hundreds of\nMB for a 1-million entries table. For this reason, the approximate storage size\nis mentioned below for each type between brackets after the argument.\n\n```\n\nArguments:```\n- bytes_in_cnt [4 bytes]\n           This is the client to server byte count. It is a positive 64-bit\n           integer which counts the cumulative number of bytes received from\n           clients which matched this entry. Headers are included in the\n           count. This may be used to limit abuse of upload features on photo\n           or video servers. Note that the values are measured when the data\n           enter haproxy, thus the counts are not affected by compression.\n\n- bytes_in_rate(<period>) [12 bytes]\n           This is a rate counter on bytes from the client to the server.\n           It takes an integer parameter <period> which indicates in\n           milliseconds the length of the period over which the average is\n           measured. It reports the average incoming bytes rate over that\n           period, in bytes per period. It may be used to detect users which\n           upload too much and too fast. Warning: with large uploads, it is\n           possible that the amount of uploaded data will be counted once\n           upon termination, thus causing spikes in the average transfer\n           speed instead of having a smooth one. This may partially be\n           smoothed with \"option contstats\" though this is not perfect.  Use\n           of byte_in_cnt is recommended for better fairness.\n\n- bytes_out_cnt [4 bytes]\n           This is the server to client byte count. It is a positive 64-bit\n           integer which counts the cumulative number of bytes sent to\n           clients which matched this entry. Headers are included in the\n           count. This may be used to limit abuse of bots sucking the whole\n           site. Note that the values are measured when the data enter\n           haproxy, thus the counts are not affected by compression.\n\n- bytes_out_rate(<period>) [12 bytes]\n           This is a rate counter on bytes from the server to the client.\n           It takes an integer parameter <period> which indicates in\n           milliseconds the length of the period over which the average is\n           measured. It reports the average outgoing bytes rate over that\n           period, in bytes per period. It may be used to detect users which\n           download too much and too fast. Warning: with large transfers, it\n           is possible that the amount of transferred data will be counted\n           once upon termination, thus causing spikes in the average transfer\n           speed instead of having a smooth one. This may partially be\n           smoothed with \"option contstats\" though this is not perfect\n           yet. Use of byte_out_cnt is recommended for better fairness.\n\n- conn_cnt [4 bytes]\n           This is the Connection Count. It is a positive 32-bit integer\n           which counts the absolute number of connections received from\n           clients which matched this entry. It does not mean the connections\n           were accepted, just that they were received.\n\n- conn_cur [4 bytes]\n           This is the Current Connections count. It is a positive 32-bit\n           integer which stores the concurrent connection count for the\n           entry. It is incremented once an incoming connection matches the\n           entry, and decremented once the connection leaves. That way it is\n           possible to know at any time the exact number of concurrent\n           connections for an entry. This type is not learned from other\n           peers by default as it wouldn't represent anything given that it\n           would ignore the local count. However, in combination with\n           recv-only it can be used to learn the number of concurrent\n           connections seen by peers.\n\n- conn_rate(<period>) [12 bytes]\n           This is a connection frequency counter. It takes an integer\n           parameter <period> which indicates in milliseconds the length of\n           the period over which the average is measured. It reports the\n           average incoming connection rate over that period, in connections\n           per period. The result is an integer which can be matched using\n           ACLs. Whether connections are accepted or rejected has no effect\n           on their measurement.\n\n- glitch_cnt [4 bytes]\n           This is the front glitches count. It is a positive 32-bit integer\n           which counts the cumulative number of glitches reported on a front\n           connection. Glitches correspond to either unusual or unexpected\n           actions (protocol- wise) from the client that could indicate a\n           badly defective client or possibly an attacker. As such, this\n           counter can help in order to decide how to act with them in such\n           case.\n\n- glitch_rate(<period>) [12 bytes]\n           This is a frequency counter on glitches. It takes an integer\n           parameter <period> which indicates in milliseconds the length of\n           the period over which the average is measured. It reports the\n           average front glitches rate over that period. It may be used to\n           detect defective clients or potential attackers that perform\n           uncommon or unexpected actions from a protocol point of view,\n           provided that HAProxy flagged them them as such.\n\n- gpc(<nb>) [4 * <nb> bytes]\n           This is an array of <nb> General Purpose Counter elements. This is\n           an array of positive 32-bit integers which may be used to count\n           anything. Most of the time they will be used as a incremental\n           counters on some entries, for instance to note that a limit is\n           reached and trigger some actions. This array is limited to a\n           maximum of 100 elements: gpc0 to gpc99, to ensure that the build\n           of a peer update message can fit into the buffer. Users should\n           take in consideration that a large amount of counters will\n           increase the data size and the traffic load using peers protocol\n           since all data/counters are pushed each time any of them is\n           updated. This data_type will exclude the usage of the legacy\n           data_types 'gpc0' and 'gpc1' on the same table. Using the 'gpc'\n           array data_type, all 'gpc0' and 'gpc1' related sample fetch\n           functions and actions will apply to the two first elements of this\n           array.\n\n- gpc_rate(<nb>,<period>) [12 * <nb> bytes]\n           This is an array of increment rates of General Purpose Counters\n           over a period. Those elements are positive 32-bit integers which\n           may be used for anything. Just like <gpc>, the count events, but\n           instead of keeping a cumulative number, they maintain the rate at\n           which the counter is incremented. Most of the time it will be\n           used to measure the frequency of occurrence of certain events\n           (e.g. requests to a specific URL). This array is limited to a\n           maximum of 100 elements: gpt(100) allowing the storage of gpc0 to\n           gpc99, to ensure that the build of a peer update message can fit\n           into the buffer.  The array cannot contain less than 1 element:\n           use gpc(1) if you want to store only the counter gpc0.  Users\n           should take in consideration that a large amount of counters will\n           increase the data size and the traffic load using peers protocol\n           since all data/counters are pushed each time any of them is\n           updated.  This data_type will exclude the usage of the legacy\n           data_types 'gpc0_rate' and 'gpc1_rate' on the same table. Using\n           the 'gpc_rate' array data_type, all 'gpc0' and 'gpc1' related\n           fetches and actions will apply to the two first elements of this\n           array.\n\n- gpc0 [4 bytes]\n           This is the first General Purpose Counter. It is a positive 32-bit\n           integer integer which may be used for anything. Most of the time\n           it will be used to put a special tag on some entries, for instance\n           to note that a specific behavior was detected and must be known\n           for future matches.\n\n- gpc0_rate(<period>) [12 bytes]\n           This is the increment rate of the first General Purpose Counter\n           over a period. It is a positive 32-bit integer integer which may\n           be used for anything. Just like <gpc0>, it counts events, but\n           instead of keeping a cumulative number, it maintains the rate at\n           which the counter is incremented. Most of the time it will be used\n           to measure the frequency of occurrence of certain events\n           (e.g. requests to a specific URL).\n\n- gpc1 [4 bytes]\n           This is the second General Purpose Counter. It is a positive\n           32-bit integer integer which may be used for anything. Most of the\n           time it will be used to put a special tag on some entries, for\n           instance to note that a specific behavior was detected and must be\n           known for future matches.\n\n- gpc1_rate(<period>) [12 bytes]\n           This is the increment rate of the second General Purpose Counter\n           over a period. It is a positive 32-bit integer integer which may\n           be used for anything. Just like <gpc1>, it counts events, but\n           instead of keeping a cumulative number, it maintains the rate at\n           which the counter is incremented. Most of the time it will be used\n           to measure the frequency of occurrence of certain events\n           (e.g. requests to a specific URL).\n\n- gpt(<nb>) [4 * <nb> bytes]\n           This is an array of <nb> General Purpose Tags elements. This is an\n           array of positive 32-bit integers which may be used for anything.\n           Most of the time they will be used to put a special tags on some\n           entries, for instance to note that a specific behavior was\n           detected and must be known for future matches. This array is\n           limited to a maximum of 100 elements: gpt(100) allowing the\n           storage of gpt0 to gpt99, to ensure that the build of a peer\n           update message can fit into the buffer. The array cannot contain\n           less than 1 element: use gpt(1) if you want to to store only the\n           tag gpt0. Users should take in consideration that a large amount\n           of counters will increase the data size and the traffic load using\n           peers protocol since all data/counters are pushed each time any of\n           them is updated.  This data_type will exclude the usage of the\n           legacy data_type 'gpt0' on the same table. Using the 'gpt' array\n           data_type, all 'gpt0' related fetches and actions will apply to\n           the first element of this array.\n\n- gpt0 [4 bytes]\n           This is the first General Purpose Tag. It is a positive 32-bit\n           integer which may be used for anything. Most of the time it will\n           be used to put a special tag on some entries, for instance to note\n           that a specific behavior was detected and must be known for future\n           matches.\n\n- http_req_cnt [4 bytes]\n           This is the HTTP request Count. It is a positive 32-bit integer\n           which counts the absolute number of HTTP requests received from\n           clients which matched this entry. It does not matter whether they\n           are valid requests or not. Note that this is different from\n           sessions when keep-alive is used on the client side.\n\n- http_req_rate(<period>) [12 bytes]\n           This is a request frequency counter. It takes an integer parameter\n           <period> which indicates in milliseconds the length of the period\n           over which the average is measured. It reports the average HTTP\n           request rate over that period, in requests per period. The result\n           is an integer which can be matched using ACLs. It does not matter\n           whether they are valid requests or not. Note that this is\n           different from sessions when keep-alive is used on the client\n           side.\n\n- http_err_cnt [4 bytes]\n           This is the HTTP request Error Count. It is a positive 32-bit\n           integer which counts the absolute number of HTTP requests errors\n           induced by clients which matched this entry. Errors are counted on\n           invalid and truncated requests, as well as on denied or tarpitted\n           requests, and on failed authentications. If the server responds\n           with 4xx, then the request is also counted as an error since it's\n           an error triggered by the client (e.g. vulnerability scan).\n\n- http_err_rate(<period>) [12 bytes]\n           This is an HTTP request frequency counter. It takes an integer\n           parameter <period> which indicates in milliseconds the length of\n           the period over which the average is measured. It reports the\n           average HTTP request error rate over that period, in requests per\n           period (see http_err_cnt above for what is accounted as an\n           error). The result is an integer which can be matched using ACLs.\n\n- http_fail_cnt [4 bytes]\n           This is the HTTP response Failure Count. It is a positive 32-bit\n           integer which counts the absolute number of HTTP response failures\n           induced by servers which matched this entry. Errors are counted on\n           invalid and truncated responses, as well as any 5xx response other\n           than 501 or 505. It aims at being used combined with path or URI\n           to detect service failures.\n\n- http_fail_rate(<period>) [12 bytes]\n           This is an HTTP response failure frequency counter. It takes an\n           integer parameter <period> which indicates in milliseconds the\n           length of the period over which the average is measured. It\n           reports the average HTTP response failure rate over that period,\n           in requests per period (see http_fail_cnt above for what is\n           accounted as a failure). The result is an integer which can be\n           matched using ACLs.\n\n- server_id [4 bytes]\n           This is an integer which holds the numeric ID of the server a\n           request was assigned to. It is used by the \"stick match\", \"stick\n           store\", and \"stick on\" rules. It is automatically enabled when\n           referenced. It is important to understand that stickiness based on\n           learning information has some limitations, including the fact that\n           all learned associations are lost upon restart unless peers are\n           properly configured to transfer such information upon restart\n           (recommended). In general it can be good as a complement to other\n           stickiness mechanisms but not always as the sole mechanism.\n\n- sess_cnt  [4 bytes]\n           This is the Session Count. It is a positive 32-bit integer which\n           counts the absolute number of sessions received from clients which\n           matched this entry. A session is a connection that was accepted by\n           the layer 4 rules (\"tcp-request connection\").\n\n- sess_rate(<period>) [12 bytes]\n           This is a session frequency counter. It takes an integer parameter\n           <period> which indicates in milliseconds the length of the period\n           over which the average is measured. It reports the average\n           incoming session rate over that period, in sessions per\n           period. The result is an integer which can be matched using ACLs.\n```\n\nExample:```\n\n# Keep track of counters of up to 1 million IP addresses over 5 minutes\n# and store a general purpose counter and the average connection rate\n# computed over a sliding window of 30 seconds.\nstick-table type ip size 1m expire 5m store gpc0,conn_rate(30s)\n\n```\n\n**See also :**\"[stick match](#stick%20match)\", \"[stick on](#stick%20on)\", \"[stick store-request](#stick%20store-request)\", \"track-sc\",[section 2.5](#2.5)about time format,[section 11.2](#11.2)about peers,[section 9.7](#9.7)about bandwidth limitations, and[section 7](#7)about ACLs.", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "11.2. Peers declaration", "content": "## [11.2.](#11.2)Peers declaration\n\n```\nIt is possible to propagate entries of any data-types in stick-tables between\nseveral HAProxy instances over TCP connections in a multi-master fashion. Each\ninstance pushes its local updates and insertions to remote peers. The pushed\nvalues overwrite remote ones without aggregation.\n\nOne exception is the data type \"conn_cur\" which is never learned from peers by\ndefault as it is supposed to reflect local values. Earlier versions used to\nsynchronize it by default which was known to cause negative values in active-\nactive setups, and always-growing values upon reloads or active-passive\nswitches because the local value would reflect more connections than locally\npresent. However there are some setups where it could be relevant to learn\nthis value from peers, for instance when the table is a passive remote table\nsolely used to learn/monitor data from it without relying on it for write-\noriented operations or updates. To achieve this, the \"recv-only\" keyword can\nbe added on the table declaration. In any case, the \"conn_cur\" info is always\npushed so that monitoring systems can watch it.\n\nInterrupted exchanges are automatically detected and recovered from the last\nknown point. In addition, during a soft restart, the old process connects to\nthe new one using such a TCP connection to push all its entries before the new\nprocess tries to connect to other peers. That ensures very fast replication\nduring a reload, it typically takes a fraction of a second even for large\ntables.\n\nNote that Server IDs are used to identify servers remotely, so it is important\nthat configurations look similar or at least that the same IDs are forced on\neach server on all participants.\n\n```\n\n**[peers](#11.2-peers)**<peersect>```\nCreates a new peer list with name <peersect>. It is an independent section,\nwhich is referenced by one or more stick-tables.\n\n```\n\n**[bind](#11.2-bind)**[<address>]:port[param*]**[bind](#11.2-bind)**/<path>[param*]```\nDefines the binding parameters of the local peer of this \"peers\" section.\nSuch lines are not supported with \"peer\" line in the same \"peers\" section.\n\n```\n\n**[disabled](#11.2-disabled)**```\nDisables a peers section. It disables both listening and any synchronization\nrelated to this section. This is provided to disable synchronization of stick\ntables without having to comment out all \"peers\" references.\n\n```\n\n**[default-bind](#11.2-default-bind)**[param*]```\nDefines the binding parameters for the local peer, excepted its address.\n\n```\n\n**[default-server](#11.2-default-server)**[param*]```\nChange default options for a server in a \"peers\" section.\n\n```\n\nArguments:```\n<param*>  is a list of parameters for this server. The \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\"\n          keyword accepts an important number of options and has a complete\n          section dedicated to it. In a peers section, the transport\n          parameters of a \"default-serverThis keyword is available in sections :Peers declarationAlphabetically sorted keywords reference\" line are supported. Please refer\n          to section 5 for more details, and the \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" keyword below in\n          this section for some of the restrictions.\n```\n\n**See also:**\"[server](#)- This keyword is available in sections :\n- [Peers declaration](#server%20%28Peers%20declaration%29)\n- [Rings](#server%20%28Rings%29)\n- [Alphabetically sorted keywords reference](#server%20%28Alphabetically%20sorted%20keywords%20reference%29)\n\n\" and[section 5](#5)about server options**[enabled](#11.2-enabled)**```\nThis re-enables a peers section which was previously disabled via the\n\"disabledThis keyword is available in sections :Peers declarationAlphabetically sorted keywords referenceServer and default-server options\" keyword.\n\n```\n\n**[log](#11.2-log)**<target>[len<length>][format<format>][sample<ranges>:<sample_size>]<facility>[<level>[<minlevel>]]```\n\"peers\" sections support the same \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\" keyword as for the proxies to\nlog information about the \"peers\" listener. See \"logThis keyword is available in sections :Peers declarationLog forwardingProcess management and securityAlphabetically sorted keywords reference\" option for proxies for\nmore details.\n\n```\n\n**[peer](#11.2-peer)**<peername>[<address>]:port[param*]**[peer](#11.2-peer)**<peername>/<path>[param*]```\nDefines a peer inside a peers section.\nIf <peername> is set to the local peer name (by default hostname, or forced\nusing \"-L\" command line option or \"localpeer\" global configuration setting),\nHAProxy will listen for incoming remote peer connection on the provided\naddress.  Otherwise, the address defines where to connect to in order to join\nthe remote peer, and <peername> is used at the protocol level to identify and\nvalidate the remote peer on the server side.\n\nDuring a soft restart, local peer address is used by the old instance to\nconnect the new one and initiate a complete replication (teaching process).\n\nIt is strongly recommended to have the exact same peers declaration on all\npeers and to only rely on the \"-L\" command line argument or the \"localpeer\"\nglobal configuration setting to change the local peer name. This makes it\neasier to maintain coherent configuration files across all peers.\n\nYou may want to reference some environment variables in the address\nparameter, see section 2.3 about environment variables.\n\nNote: \"peer\" keyword may transparently be replaced by \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" keyword (see\n\"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" keyword explanation below).\n\n```\n\n**[server](#11.2-server)**<peername>[<address>:<port>][param*]**[server](#11.2-server)**<peername>[/<path>][param*]```\nAs previously mentioned, \"peer\" keyword may be replaced by \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" keyword\nwith a support for all \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" parameters found in 5.2 paragraph that are\nrelated to transport settings. If the underlying peer is local, the address\nparameter must not be present; it must be provided on a \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" line (see\n\"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" keyword of this \"peers\" section).\n\nA number of \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" parameters are irrelevant for \"peers\" sections. Peers by\nnature do not support dynamic host name resolution nor health checks, hence\nparameters like \"init_addr\", \"resolversThis keyword is available in sections :Server and default-server optionsThe resolvers section\", \"check\", \"agent-check\", or \"track\"\nare not supported. Similarly, there is no load balancing nor stickiness, thus\nparameters such as \"weight\" or \"cookieThis keyword is available in sections :Alphabetically sorted keywords referenceServer and default-server optionsFetching HTTP samples (Layer 7)\" have no effect.\n\n```\n\nExample:```\n\n # The old way.\n peers mypeers\n     peer haproxy1 192.168.0.1:1024\n     peer haproxy2 192.168.0.2:1024\n     peer haproxy3 10.2.0.1:1024\n\n backend mybackend\n     mode tcp\n     balance roundrobin\n     stick-table type ip size 20k peers mypeers\n     stick on src\n\n     server srv1 192.168.0.30:80\n     server srv2 192.168.0.31:80\n\nExample:\n  peers mypeers\n     bind 192.168.0.1:1024 ssl crt mycerts/pem\n     default-server ssl verify none\n     server haproxy1 #local peer\n     server haproxy2 192.168.0.2:1024\n     server haproxy3 10.2.0.1:1024\n\n```\n\n**[shards](#11.2-shards)**<shards>```\nIn some configurations, one would like to distribute the stick-table contents\nto some peers in place of sending all the stick-table contents to each peer\ndeclared in the \"peers\" section. In such cases, \"shardsThis keyword is available in sections :Peers declarationBind options\" specifies the\nnumber of peer involved in this stick-table contents distribution.\nSee also \"shard\" server parameter.\n\n```\n\n**[table](#11.2-table)**<tablename>type{ip | integer | string[len<length>]| binary[len<length>]}size<size>[expire<expire>][write-to<wtable>][nopurge][store<data_type>]*[recv-only]```\nConfigure a stickiness table for the current section. This line is parsed\nexactly the same way as the \"stick-tableThis keyword is available in sections :Stick-tables declarationAlphabetically sorted keywords reference\" keyword in others section, except\nfor the \"peers\" argument which is not required here and with an additional\nmandatory first parameter to designate the stick-table. Contrary to others\nsections, there may be several \"tableThis keyword is available in sections :Stick-tables declarationPeers declaration\" lines in \"peers\" sections (see also\nthe complete definition of the \"tableThis keyword is available in sections :Stick-tables declarationPeers declaration\" and \"stick-tableThis keyword is available in sections :Stick-tables declarationAlphabetically sorted keywords reference\" keywords in\nsection 11.1 above).\n\nAlso be aware of the fact that \"peers\" sections have their own stick-table\nnamespaces to avoid collisions between stick-table names identical in\ndifferent \"peers\" section. This is internally handled prepending the \"peers\"\nsections names to the name of the stick-tables followed by a '/' character.\nIf somewhere else in the configuration file you have to refer to such\nstick-tables declared in \"peers\" sections you must use the prefixed version\nof the stick-table name as follows:\n\n    peers mypeers\n        peer A ...\n        peer B ...\n        table t1 ...\n\n    frontend fe1\n        tcp-request content track-sc0 src table mypeers/t1\n\nThis is also this prefixed version of the stick-table names which must be\nused to refer to stick-tables through the CLI.\n\nAbout \"peers\" protocol, as only \"peers\" belonging to the same section may\ncommunicate with each others, there is no need to do such a distinction.\nSeveral \"peers\" sections may declare stick-tables with the same name.\nThis is shorter version of the stick-table name  which is sent over the network.\nThere is only a '/' character as prefix to avoid stick-table name collisions between\nstick-tables declared as backends and stick-table declared in \"peers\" sections\nas follows in this weird but supported configuration:\n\n    peers mypeers\n        peer A ...\n        peer B ...\n        table t1 type string size 10m store gpc0\n\n    backend t1\n        stick-table type string size 10m store gpc0 peers mypeers\n\nHere \"t1\" table declared in \"mypeers\" section has \"mypeers/t1\" as global name.\n\"t1\" table declared as a backend as \"t1\" as global name. But at peer protocol\nlevel the former table is named \"/t1\", the latter is again named \"t1\".\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "12. Other sections", "content": "# [12.](#12)Other sections\n\n```\nThe sections described below are less commonly used and usually support only a\nfew parameters. There is no implicit relation between any of them. They're all\nstarted using a single keyword. None of them is permitted before a \"global\"\nsection. The support for some of them might be conditionned by build options\n(e.g. anything SSL-related).\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "12.1. Traces", "content": "## [12.1.](#12.1)Traces\n\n```\nFor debugging purpose, it is possible to activate traces on an HAProxy's\nsubsystem. This will dump debug messages about a specific subsystem. It is a\nvery powerful tool to diagnose issues. Traces can be dynamically configured via\nthe CLI. It is also possible to predefined some settings in the configuration\nfile, in dedicated \"traces\" sections. More details about traces can be found in\nthe management guide. It remains a developer tools used during complex\ndebugging sessions.  It is pretty verbose and have a cost, so use it with\ncaution. And because it is a developer tool, there is no warranty about the\nbackward compatibility of this section.\n\n```\n\n**[traces](#12.1-traces)**```\nStarts a new traces section. One or multiple \"traces\" section may be\nused. All direcitives are evaluated in the declararion order, the last ones\noverriding previous ones.\n\n```\n\n**[trace](#12.1-trace)**<source><args...>```\nConfigures on \"trace\" subsystem. Each of them can be found in the management\nmanual, and follow the exact same syntax. Any output that the \"trace\"\ncommand would produce will be emitted during the parsing step of the\nsection. Most of the time these will be errors and warnings, but certain\nincomplete commands might list permissible choices. This command is not meant\nfor regular use, it will generally only be suggested by developers along\ncomplex debugging sessions. It is important to keep in mind that depending on\nthe trace level and details, enabling traces can severely degrade the global\nperformance. Please refer to the management manual for the statements syntax.\n\n```\n\nExample:```\n\nring buf1\n  size 10485760 # 10MB\n  format timed\n  backing-file /tmp/h1.traces\n\nring buf2\n  size 10485760 # 10MB\n  format timed\n  backing-file /tmp/h2.traces\n\ntraces\n  trace h1 sink buf1 level developer verbosity complete start now\n  trace h2 sink buf1 level developer verbosity complete start now\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "12.2. Userlists", "content": "## [12.2.](#12.2)Userlists\n\n```\nIt is possible to control access to frontend/backend/listen sections or to\nhttp stats by allowing only authenticated and authorized users. To do this,\nit is required to create at least one userlist and to define users.\n\n```\n\n**[userlist](#12.2-userlist)**<listname>```\nCreates new userlist with name <listname>. Many independent userlists can be\nused to store authentication & authorization data for independent customers.\n\n```\n\n**[group](#12.2-group)**<groupname>[users<user>,<user>,(...)]```\nAdds group <groupname> to the current userlist. It is also possible to\nattach users to this group by using a comma separated list of names\nproceeded by \"users\" keyword.\n\n```\n\n**[user](#12.2-user)**<username>[password|insecure-password<password>][groups<group>,<group>,(...)]```\nAdds user <username> to the current userlist. Both secure (encrypted) and\ninsecure (unencrypted) passwords can be used. Encrypted passwords are\nevaluated using the crypt(3) function, so depending on the system's\ncapabilities, different algorithms are supported. For example, modern Glibc\nbased Linux systems support MD5, SHA-256, SHA-512, and, of course, the\nclassic DES-based method of encrypting passwords.\n\nAttention: Be aware that using encrypted passwords might cause significantly\nincreased CPU usage, depending on the number of requests, and the algorithm\nused. For any of the hashed variants, the password for each request must\nbe processed through the chosen algorithm, before it can be compared to the\nvalue specified in the config file. Most current algorithms are deliberately\ndesigned to be expensive to compute to achieve resistance against brute\nforce attacks. They do not simply salt/hash the clear text password once,\nbut thousands of times. This can quickly become a major factor in HAProxy's\noverall CPU consumption, and can even lead to application crashes!\n\nTo address the high CPU usage of hash functions, one approach is to reduce\nthe number of rounds of the hash function (SHA family algorithms) or decrease\nthe \"cost\" of the function, if the algorithm supports it.\n\nAs a side note, musl (e.g. Alpine Linux) implementations are known to be\nslower than their glibc counterparts when calculating hashes, so you might\nwant to consider this aspect too.\n\nAll passwords are considered normal arguments and are therefor subject to\nregular section 2.2 Quoting and escaping. Single quoting passwords is\ntherefor recommended.\n\n```\n\nExample:```\n\nuserlist L1\n  group G1 users tiger,scott\n  group G2 users xdb,scott\n\n  user tiger password $6$k6y3o.eP$JlKBx9za9667qe4(...)xHSwRv6J.C0/D7cV91\n  user scott insecure-password 'elgato'\n  user xdb insecure-password 'hello'\n\nuserlist L2\n  group G1\n  group G2\n\n  user tiger password $6$k6y3o.eP$JlKBx(...)xHSwRv6J.C0/D7cV91 groups G1\n  user scott insecure-password 'elgato' groups G1,G2\n  user xdb insecure-password 'hello' groups G2\n\n```\n\n```\nPlease note that both lists are functionally identical.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "12.3. Mailers", "content": "## [12.3.](#12.3)Mailers\n\n```\nIt is possible to send email alerts when the state of servers changes.\nIf configured email alerts are sent to each mailer that is configured\nin a mailers section. Email is sent to mailers through Lua (see\nexamples/lua/mailers.lua).\n\n```\n\n**[mailers](#12.3-mailers)**<mailersect>```\nCreates a new mailer list with the name <mailersect>. It is an\nindependent section which is referenced by one or more proxies.\n\n```\n\n**[mailer](#12.3-mailer)**<mailername><ip>:<port>```\nDefines a mailer inside a mailers section.\n\n```\n\nExample:```\n\nglobal\n    # mailers.lua file as provided in the git repository\n    # adjust path as needed\n    lua-load examples/lua/mailers.lua\n\nmailers mymailers\n    mailer smtp1 192.168.0.1:587\n    mailer smtp2 192.168.0.2:587\n\nbackend mybackend\n    mode tcp\n    balance roundrobin\n\n    email-alert mailers mymailers\n    email-alert from test1@horms.org\n    email-alert to test2@horms.org\n\n    server srv1 192.168.0.30:80\n    server srv2 192.168.0.31:80\n\n```\n\n**[timeout mail](#12.3-timeout%20mail)**<time>```\nDefines the time available for a mail/connection to be made and send to\nthe mail-server. If not defined the default value is 10 seconds. To allow\nfor at least two SYN-ACK packets to be send during initial TCP handshake it\nis advised to keep this value above 4 seconds.\n\n```\n\nExample:```\n\nmailers mymailers\n    timeout mail 20s\n    mailer smtp1 192.168.0.1:587\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "12.4. HTTP-errors", "content": "## [12.4.](#12.4)HTTP-errors\n\n```\nIt is possible to globally declare several groups of HTTP errors, to be\nimported afterwards in any proxy section. Same group may be referenced at\nseveral places and can be fully or partially imported.\n\n```\n\n**[http-errors](#12.4-http-errors)**<name>```\nCreate a new http-errors group with the name <name>. It is an independent\nsection that may be referenced by one or more proxies using its name.\n\n```\n\n**[errorfile](#12.4-errorfile)**<code><file>```\nAssociate a file contents to an HTTP error code\n\n```\n\nArguments :```\n<code>    is the HTTP status code. Currently, HAProxy is capable of\n          generating codes 200, 400, 401, 403, 404, 405, 407, 408, 410,\n          425, 429, 500, 501, 502, 503, and 504.\n\n<file>    designates a file containing the full HTTP response. It is\n          recommended to follow the common practice of appending \".http\" to\n          the filename so that people do not confuse the response with HTML\n          error pages, and to use absolute paths, since files are read\n          before any chroot is performed.\n```\n\n```\nPlease referrers to \"errorfileThis keyword is available in sections :HTTP-errorsAlphabetically sorted keywords reference\" keyword in section 4 for details.\n\n```\n\nExample:```\n\nhttp-errors website-1\n    errorfile 400 /etc/haproxy/errorfiles/site1/400.http\n    errorfile 404 /etc/haproxy/errorfiles/site1/404.http\n    errorfile 408 /dev/null  # work around Chrome pre-connect bug\n\nhttp-errors website-2\n    errorfile 400 /etc/haproxy/errorfiles/site2/400.http\n    errorfile 404 /etc/haproxy/errorfiles/site2/404.http\n    errorfile 408 /dev/null  # work around Chrome pre-connect bug\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "12.5. Rings", "content": "## [12.5.](#12.5)Rings\n\n```\nIt is possible to globally declare ring-buffers, to be used as target for log\nservers or traces.\n\n```\n\n**[ring](#12.5-ring)**<ringname>```\nCreates a new ring-buffer with name <ringname>.\n\n```\n\n**[backing-file](#12.5-backing-file)**<path>```\nThis replaces the regular memory allocation by a RAM-mapped file to store the\nring. This can be useful for collecting traces or logs for post-mortem\nanalysis, without having to attach a slow client to the CLI. Newer contents\nwill automatically replace older ones so that the latest contents are always\navailable. The contents written to the ring will be visible in that file once\nthe process stops (most often they will even be seen very soon after but\nthere is no such guarantee since writes are not synchronous).\n\nWhen this option is used, the total storage area is reduced by the size of\nthe \"struct ring\" that starts at the beginning of the area, and that is\nrequired to recover the area's contents. The file will be created with the\nstarting user's ownership, with mode 0600 and will be of the size configured\nby the \"size\" directive. When the directive is parsed (thus even during\nconfig checks), any existing non-empty file will first be renamed with the\nextra suffix \".bak\", and any previously existing file with suffix \".bak\" will\nbe removed. This ensures that instant reload or restart of the process will\nnot wipe precious debugging information, and will leave time for an admin to\nspot this new \".bak\" file and to archive it if needed. As such, after a crash\nthe file designated by <path> will contain the freshest information, and if\nthe service is restarted, the \"<path>.bak\" file will have it instead. This\nmeans that the total storage capacity required will be double of the ring\nsize. Failures to rotate the file are silently ignored, so placing the file\ninto a directory without write permissions will be sufficient to avoid the\nbackup file if not desired.\n\nWARNING: there are stability and security implications in using this feature.\nFirst, backing the ring to a slow device (e.g. physical hard drive) may cause\nperceptible slowdowns during accesses, and possibly even panics if too many\nthreads compete for accesses. Second, an external process modifying the area\ncould cause the haproxy process to crash or to overwrite some of its own\nmemory with traces. Third, if the file system fills up before the ring,\nwrites to the ring may cause the process to crash.\n\nThe information present in this ring are structured and are NOT directly\nreadable using a text editor (even though most of it looks barely readable).\nThe output of this file is only intended for developers.\n\n```\n\n**[description](#12.5-description)**<text>```\nThe description is an optional description string of the ring. It will\nappear on CLI. By default, <name> is reused to fill this field.\n\n```\n\n**[format](#12.5-format)**<format>```\nFormat used to store events into the ring buffer.\n\n```\n\nArguments:```\n<format> is the log format used when generating syslog messages. It may be\n         one of the following :\n\n  iso     A message containing only the ISO date, followed by the text.\n          The PID, process name and system name are omitted. This is\n          designed to be used with a local log server.\n\n  local   Analog to rfc3164 syslog message format except that hostname\n          field is stripped. This is the default.\n          Note: option \"log-send-hostname\" switches the default to\n          rfc3164.\n\n  raw     A message containing only the text. The level, PID, date, time,\n          process name and system name are omitted. This is designed to be\n          used in containers or during development, where the severity\n          only depends on the file descriptor used (stdout/stderr). This\n          is the default.\n\n  rfc3164 The RFC3164 syslog message format.\n          (https://tools.ietf.org/html/rfc3164)\n\n  rfc5424 The RFC5424 syslog message format.\n          (https://tools.ietf.org/html/rfc5424)\n\n  short   A message containing only a level between angle brackets such as\n          '<3>', followed by the text. The PID, date, time, process name\n          and system name are omitted. This is designed to be used with a\n          local log server. This format is compatible with what the systemd\n          logger consumes.\n\n priority A message containing only a level plus syslog facility between angle\n          brackets such as '<63>', followed by the text. The PID, date, time,\n          process name and system name are omitted. This is designed to be used\n          with a local log server.\n\n  timed   A message containing only a level between angle brackets such as\n          '<3>', followed by ISO date and by the text. The PID, process\n          name and system name are omitted. This is designed to be\n          used with a local log server.\n```\n\n**[maxlen](#12.5-maxlen)**<length>```\nThe maximum length of an event message stored into the ring,\nincluding formatted header. If an event message is longer than\n<length>, it will be truncated to this length.\n\n```\n\n**[server](#12.5-server)**<name><address>[param*]```\nUsed to configure a syslog tcp server to forward messages from ring buffer.\nThis supports for all \"serverThis keyword is available in sections :Peers declarationRingsAlphabetically sorted keywords reference\" parameters found in 5.2 paragraph. Some of\nthese parameters are irrelevant for \"ring\" sections. Important point: there\nis little reason to add more than one server to a ring, because all servers\nwill receive the exact same copy of the ring contents, and as such the ring\nwill progress at the speed of the slowest server. If one server does not\nrespond, it will prevent old messages from being purged and may block new\nmessages from being inserted into the ring. The proper way to send messages\nto multiple servers is to use one distinct ring per log server, not to\nattach multiple servers to the same ring. Note that specific server directive\n\"log-proto\" is used to set the protocol used to send messages.\n\n```\n\n**[size](#12.5-size)**<size>```\nThis is the optional size in bytes for the ring-buffer. Default value is\nset to BUFSIZE.\n\n```\n\n**[timeout connect](#12.5-timeout%20connect)**<timeout>```\nSet the maximum time to wait for a connection attempt to a server to succeed.\n\n```\n\nArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\n**[timeout server](#12.5-timeout%20server)**<timeout>```\nSet the maximum time for pending data staying into output buffer.\n\n```\n\nArguments :```\n<timeout> is the timeout value specified in milliseconds by default, but\n          can be in any other unit if the number is suffixed by the unit,\n          as explained at the top of this document.\n```\n\nExample:```\n\nglobal\n    log ring@myring local7\n\nring myring\n    description \"My local buffer\"\n    format rfc5424\n    maxlen 1200\n    size 32764\n    timeout connect 5s\n    timeout server 10s\n    server mysyslogsrv 127.0.0.1:6514 log-proto octet-count\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "12.6. Log forwarding", "content": "## [12.6.](#12.6)Log forwarding\n\n```\nIt is possible to declare one or multiple log forwarding section,\nHAProxy will forward all received log messages to a log servers list.\n\n```\n\n**[log-forward](#12.6-log-forward)**<name>```\nCreates a new log forwarder proxy identified as <name>.\n\n```\n\n**[backlog](#12.6-backlog)**<conns>```\nGive hints to the system about the approximate listen backlog desired size\non connections accept.\n\n```\n\n**[bind](#12.6-bind)**<addr>[param*]```\nUsed to configure a stream log listener to receive messages to forward.\nThis supports the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" parameters found in 5.1 paragraph including\nthose about ssl but some statements such as \"alpnThis keyword is available in sections :Bind optionsServer and default-server options\" may be irrelevant for\nsyslog protocol over TCP.\nThose listeners support both \"Octet Counting\" and \"Non-Transparent-Framing\"\nmodes as defined in rfc-6587.\n\n```\n\n**[dgram-bind](#12.6-dgram-bind)**<addr>[param*]```\nUsed to configure a datagram log listener to receive messages to forward.\nAddresses must be in IPv4 or IPv6 form,followed by a port. This supports\nfor some of the \"bindThis keyword is available in sections :Peers declarationLog forwardingAlphabetically sorted keywords reference\" parameters found in 5.1 paragraph among which\n\"interface\", \"namespaceThis keyword is available in sections :Bind optionsServer and default-server options\" or \"transparent\", the other ones being\nsilently ignored as irrelevant for UDP/syslog case.\n\n```\n\n**[log global](#12.6-log%20global)****[log](#12.6-log)**<target>[len<length>][format<format>][sample<ranges>:<sample_size>]<facility>[<level>[<minlevel>]]```\nUsed to configure target log servers. See more details on proxies\ndocumentation.\nIf no format specified, HAProxy tries to keep the incoming log format.\nConfigured facility is ignored, except if incoming message does not\npresent a facility but one is mandatory on the outgoing format.\nIf there is no timestamp available in the input format, but the field\nexists in output format, HAProxy will use the local date.\n\n```\n\nExample:```\n\nglobal\n   log stderr format iso local7\n\nring myring\n    description \"My local buffer\"\n    format rfc5424\n    maxlen 1200\n    size 32764\n    timeout connect 5s\n    timeout server 10s\n    # syslog tcp server\n    server mysyslogsrv 127.0.0.1:514 log-proto octet-count\n\nlog-forward sylog-loadb\n    dgram-bind 127.0.0.1:1514\n    bind 127.0.0.1:1514\n    # all messages on stderr\n    log global\n    # all messages on local tcp syslog server\n    log ring@myring local0\n    # load balance messages on 4 udp syslog servers\n    log 127.0.0.1:10001 sample 1:4 local0\n    log 127.0.0.1:10002 sample 2:4 local0\n    log 127.0.0.1:10003 sample 3:4 local0\n    log 127.0.0.1:10004 sample 4:4 local0\n\n```\n\n**[maxconn](#12.6-maxconn)**<conns>```\nFix the maximum number of concurrent connections on a log forwarder.\n10 is the default.\n\n```\n\n**[timeout client](#12.6-timeout%20client)**<timeout>```\nSet the maximum inactivity time on the client side.\n\n```\n\n**[option assume-rfc6587-ntf](#12.6-option%20assume-rfc6587-ntf)**```\nDirects HAProxy to treat incoming TCP log streams always as using\nnon-transparent framing. This option simplifies the framing logic and ensures\nconsistent handling of messages, particularly useful when dealing with\nimproperly formed starting characters.\n\n```\n\n**[option dont-parse-log](#12.6-option%20dont-parse-log)**```\nEnables HAProxy to relay syslog messages without attempting to parse and\nrestructure them, useful for forwarding messages that may not conform to\ntraditional formats. This option should be used with the format raw setting on\ndestination log targets to ensure the original message content is preserved.\n\n```\n\n**[option host](#12.6-option%20host)**{ replace | fill | keep | append }```\nSet the host strategy that should be used on the log-forward section\nregarding syslog hostname field for outbound rfc3164 or rfc5424 messages.\n\n    replace If input message already contains a value for the hostname field,\n            we replace it by the source IP address from the sender.\n            If input message doesn't contain a value for the hostname field\n            (ie: '-' as input rfc5424 message or non compliant rfc3164 or\n            rfc5424 message), we use the source IP address from the sender as\n            hostname field.\n\n    fill    If input message already contains a value for the hostname field,\n            we keep it.\n            If input message doesn't contain a value for the hostname field\n            (ie: '-' as input rfc5424 message or non compliant rfc3164 or\n            rfc5424 message), we use the source IP address from the sender as\n            hostname field.\n            (This is the default)\n\n    keep    If input message already contains a value for the hostname field,\n            we keep it.\n            If input message doesn't contain a value for the hostname field,\n            we set it to 'localhost' (rfc3164) or '-' (rfc5424).\n\n    append  If input message already contains a value for the hostname field,\n            we append a comma followed by the IP address from the sender.\n            If input message doesn't contain a value for the hostname field,\n            we use the source IP address from the sender.\n\nFor all options above, if the source IP address from the sender is not\navailable (ie: UNIX/ABNS socket), then the resulting strategy is \"keep\".\n\nNote that this option is only relevant for rfc3164 or rfc5424 destination\nlog format. Else setting the option will have no visible effect.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "12.7. Certificate Storage", "content": "## [12.7.](#12.7)Certificate Storage\n\n```\nHAProxy uses an internal storage mechanism to load and store certificates used\nin the configuration. This storage can be configured by using a \"crt-store\"\nsection. It allows to configure certificate definitions and which files should\nbe loaded in it. A certificate definition must be written before it is used\nelsewhere in the configuration.\n\n```\n\n**[crt-store](#12.7-crt-store)**[<name>]```\nThe \"crt-store\" takes an optional name in argument. If a name is specified,\nevery certificate of this store must be referenced using \"@<name>/<crt>\" or\n\"@<name>/<alias>\".\n\nFiles in the certificate storage can also be updated dynamically with the CLI.\nSee \"set ssl cert\" in the section 9.3 of the management guide.\n\n\nThe following keywords are supported in the \"crt-store\" section :\n  - crt-base\n  - key-base\n  - load\n\n```\n\n**[crt-base](#12.7-crt-base)**<dir>```\nAssigns a default directory to fetch SSL certificates from when a relative\npath is used with \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\" directives. Absolute locations specified prevail and\nignore \"crt-baseThis keyword is available in sections :Certificate StorageProcess management and security\". When used in a crt-store, the crt-base of the global\nsection is ignored.\n\n```\n\n**[key-base](#12.7-key-base)**<dir>```\nAssigns a default directory to fetch SSL private keys from when a relative\npath is used with \"key\" directives. Absolute locations specified prevail and\nignore \"key-baseThis keyword is available in sections :Certificate StorageProcess management and security\". When used in a crt-store, the key-base of the global\nsection is ignored.\n\n```\n\n**[load](#12.7-load)**[crt<filename>][param*]```\nLoad SSL files in the certificate storage. For the parameter list, see section\n\"12.7.1. Load options\"\n\n```\n\nExample:```\n\ncrt-store\n    load crt \"site1.crt\" key \"site1.key\" ocsp \"site1.ocsp\" alias \"site1\"\n    load crt \"site2.crt\" key \"site2.key\"\n\nfrontend in2\n    bind *:443 ssl crt \"@/site1\" crt \"site2.crt\"\n\ncrt-store web\n    crt-base /etc/ssl/certs/\n    key-base /etc/ssl/private/\n    load crt \"site3.crt\" alias \"site3\"\n    load crt \"site4.crt\" key \"site4.key\"\n\nfrontend in2\n    bind *:443 ssl crt \"@/site1\" crt \"site2.crt\"  crt \"@web/site3\" crt \"@web/site4.crt\"\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "12.7.1. Load options", "content": "### [12.7.1.](#12.7.1)Load options\n\n```\nLoad SSL files in the certificate storage. The load keyword can take multiple\nparameters which are listed below. These keywords are also usable in a\ncrt-list.\n\n```\n\n**[crt](#12.7.1-crt)**<filename>```\nThis argument is mandatory, it loads a PEM which must contain the public\ncertificate but could also contain the intermediate certificates and the\nprivate key.  If no private key is provided in this file, a key can be provided\nwith the \"key\" keyword.\n\n```\n\n**[acme](#12.7.1-acme)**<string>```\nThis option allows to configure the ACME protocol for a given certificate.\nThis is an experimental feature which needs the\n\"expose-experimental-directives\" keyword in the global section.\n\nSee also Section 12.8 (\"ACME\") and \"domains\" in this section.\n\n```\n\n**[alias](#12.7.1-alias)**<string>```\nOptional argument. Allow to name the certificate with an alias, so it can be\nreferenced with it in the configuration. An alias must be prefixed with '@/'\nwhen called elsewhere in the configuration.\n\n```\n\n**[domains](#12.7.1-domains)**<string>```\nConfigure the list of domains that will be used for ACME certificates. The\nfirst domain of the list is used as the CN. Domains are separated by commas in the list.\n\nSee also Section 12.8 (\"ACME\") and \"acmeThis keyword is available in sections :Load optionsACME\" in this section.\n\n```\n\nExample:```\n\nload crt \"example.com.pem\" acme LE domains \"bar.example.com,foo.example.com\"\n\n```\n\n**[key](#12.7.1-key)**<filename>```\nThis argument is optional. Load a private key in PEM format. If a private key\nwas already defined in \"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\", it will overwrite it.\n\n```\n\n**[ocsp](#12.7.1-ocsp)**<filename>```\nThis argument is optional, it loads an OCSP response in DER format. It can\nbe updated with the CLI.\n\n```\n\n**[issuer](#12.7.1-issuer)**<filename>```\nThis argument is optional. Load the OCSP issuer in PEM format. In order to\nidentify which certificate an OCSP Response applies to, the issuer's\ncertificate is necessary.  If the issuer's certificate is not found in the\n\"crtThis keyword is available in sections :Load optionsBind optionsServer and default-server options\" file, it could be loaded from a file with this argument.\n\n```\n\n**[sctl](#12.7.1-sctl)**<filename>```\nThis argument is optional. Support for Certificate Transparency (RFC6962) TLS\nextension is enabled. The file must contain a valid Signed Certificate\nTimestamp List, as described in RFC. File is parsed to check basic syntax,\nbut no signatures are verified.\n\n```\n\n**[ocsp-update](#12.7.1-ocsp-update)**[ off | on ]```\nEnable automatic OCSP response update when set to 'on', disable it otherwise.\nIts value defaults to 'off'.\nTo enable the OCSP auto update on a bind line, you can use this option in a\ncrt-store or you can use the global option \"tune.ocsp-update.mode\".\nIf a given certificate is used in multiple crt-lists with different values of\nthe 'ocsp-update' set, an error will be raised. Likewise, if a certificate\ninherits from the global option on a bind line and has an incompatible\nexplicit 'ocsp-update' option set in a crt-list, the same error will be\nraised.\n\n```\n\nExamples:```\n\nHere is an example configuration enabling it with a crt-list:\n\n```\n\n```\nhaproxy.cfg:\n    frontend fe\n        bind :443 ssl crt-list haproxy.list\n\nhaproxy.list:\n    server_cert.pem [ocsp-update on] foo.bar\n\nHere is an example configuration enabling it with a crt-store:\n\nhaproxy.cfg:\n\n    crt-store\n      load crt foobar.pem ocsp-update on\n\n    frontend fe\n        bind :443 ssl crt foobar.pem\n\nWhen the option is set to 'on', we will try to get an ocsp response whenever\nan ocsp uri is found in the frontend's certificate. The only limitation of\nthis mode is that the certificate's issuer will have to be known in order for\nthe OCSP certid to be built.\nEach OCSP response will be updated at least once an hour, and even more\nfrequently if a given OCSP response has an expire date earlier than this one\nhour limit. A minimum update interval of 5 minutes will still exist in order\nto avoid updating too often responses that have a really short expire time or\neven no 'Next Update' at all. Because of this hard limit, please note that\nwhen auto update is set to 'on', any OCSP response loaded during init will\nnot be updated until at least 5 minutes, even if its expire time ends before\nnow+5m. This should not be too much of a hassle since an OCSP response must\nbe valid when it gets loaded during init (its expire time must be in the\nfuture) so it is unlikely that this response expires in such a short time\nafter init.\nOn the other hand, if a certificate has an OCSP uri specified and no OCSP\nresponse, setting this option to 'on' for the given certificate will ensure\nthat the OCSP response gets fetched automatically right after init.\nThe default minimum and maximum delays (5 minutes and 1 hour respectively)\ncan be configured by the \"ocsp-update.maxdelay\" and \"ocsp-update.mindelay\"\nglobal options.\n\nWhenever an OCSP response is updated by the auto update task or following a\ncall to the \"update ssl ocsp-response\" CLI command, a dedicated log line is\nemitted. It follows a dedicated format that contains the following header\n\"<OCSP-UPDATE>\" and is followed by specific OCSP-related information:\n  - the path of the corresponding frontend certificate\n  - a numerical update status\n  - a textual update status\n  - the number of update failures for the given response\n  - the number of update successes for the givan response\nSee \"show ssl ocsp-updates\" CLI command for a full list of error codes and\nerror messages. This line is emitted regardless of the success or failure of\nthe concerned OCSP response update.\nThe OCSP request/response is sent and received through an http_client\ninstance that has the dontlog-normal option set and that uses the regular\nHTTP log format in case of error (unreachable OCSP responder for instance).\nIf such an error occurs, another log line that contains HTTP-related\ninformation will then be emitted alongside the \"regular\" OCSP one (which will\nlikely have \"HTTP error\" as text status). But if a purely HTTP error happens\n(unreachable OCSP responder for instance), an extra log line that follows the\nregular HTTP log-format will be emitted.\nHere are two examples of such log lines, with a successful OCSP update log\nline first and then an example of an HTTP error with the two different lines\n(lines were spit and the URL was shortened for readability):\n  <133>Mar  6 11:16:53 haproxy[14872]: <OCSP-UPDATE> /path_to_cert/foo.pem 1 \\\n          \"Update successful\" 0 1\n\n  <133>Mar  6 11:18:55 haproxy[14872]: <OCSP-UPDATE> /path_to_cert/bar.pem 2 \\\n          \"HTTP error\" 1 0\n  <133>Mar  6 11:18:55 haproxy[14872]: -:- [06/Mar/2023:11:18:52.200] \\\n          <OCSP-UPDATE> -/- 2/0/-1/-1/3009 503 217 - - SC-- 0/0/0/0/3 0/0 {} \\\n          \"GET http://127.0.0.1:12345/MEMwQT HTTP/1.1\"\n\nTroubleshooting:\nA common error that can happen with let's encrypt certificates is if the DNS\nresolution provides an IPv6 address and your system does not have a valid\noutgoing IPv6 route. In such a case, you can either create the appropriate\nroute or set the \"httpclient.resolvers.prefer ipv4\" option in the global\nsection.\nIn case of \"OCSP response check failure\" error, you might want to check that\nthe issuer certificate that you provided is valid.\nA more precise error message might also be displayed between parenthesis\nafter the \"generic\" error message. It can happen for \"OCSP response check\nfailure\" or \"Error during insertion\" errors.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "12.8. ACME", "content": "## [12.8.](#12.8)ACME\n\n**[acme](#12.8-acme)**<name>```\nThe ACME protocol can be configured using the \"acmeThis keyword is available in sections :Load optionsACME\" section. The section takes\na \"<name>\" argument, which is used to link a certificate to the section.\n\nThe ACME section allows to configure HAProxy as an ACMEv2 client. This feature\nis experimental meaning that \"expose-experimental-directives\" must be in the\nglobal section so this can be used.\n\nCurrent limitations as of 3.2:\n- The feature is limited to the HTTP-01 or DNS-01 challenges for now. HTTP-01\n  is completely handled by HAProxy, but DNS-01 needs either the dataplaneAPI or\n  another 3rd party tool to talk to a DNS provider API.\n- Configuring acme needs a configuration with a crt, it's currently not\n  possible to start without this crt on the disk, a key-pair must already exist\n  to start haproxy. It is recommanded to use an expired certificate for that.\n- The current HAProxy architecture is a non-blocking model, access to the disk\n  is not supposed to be done after the configuration is loaded, because it\n  could block the event loop, blocking the traffic on the same thread. Meaning\n  that the certificates and keys generated from HAProxy will need to be dumped\n  from outside HAProxy using \"dump ssl cert\" on the stats socket. It's possible\n  to automate the dump of the certificates by using the dataplaneAPI or the\n  haproxy-dump-certs script provided in the admin/cli/ directory.\n- External Account Binding (EAB) is not supported.\n\nThe ACME scheduler starts at HAProxy startup, it will loop over the\ncertificates and start an ACME renewal task when the notAfter task is past\ncurtime + (notAfter - notBefore) / 12, or 7 days if notBefore is not defined.\nThe scheduler will then sleep and wakeup after 12 hours.\nIt is possible to start manually a renewal task with \"acme renew'.\nSee also \"acme status\" in the management guide.\n\nThe following keywords are usable in the ACME section:\n\n```\n\n**[account-key](#12.8-account-key)**<filename>```\nConfigure the path to the account key. The key need to be generated before\nlaunching HAProxy. If no account keyword is used, the acme section will try\nto load a filename using the section name \"<name>.account.key\". If the file\ndoesn't exist, HAProxy will generate one, using the parameters from the acme\nsection.\n\nYou can also generate manually an RSA private key with openssl:\n\n  openssl genrsa -out account.key 2048\n\nOr an ecdsa one:\n\n  openssl ecparam -name secp384r1 -genkey -noout -out account.key\n\n```\n\n**[bits](#12.8-bits)**<number>```\nConfigure the number of bits to generate an RSA certificate. Default to 2048.\nSetting a too high value can trigger a warning if your machine is not\npowerful enough. (This can be configured with \"warn-blocked-traffic-after\"\nbut blocking the traffic too long could trigger the watchdog.)\n\n```\n\n**[challenge](#12.8-challenge)**<string>```\nTakes a challenge type as parameter, this must be http-01 or dns-01. When not\nused the default is http-01.\n\n```\n\n**[contact](#12.8-contact)**<string>```\nThe contact email that will be associated to the account key in the CA.\n\n```\n\n**[curves](#12.8-curves)**<string>```\nWhen using the ECDSA keytype, configure the curves. The default is P-384.\n\n```\n\n**[directory](#12.8-directory)**<string>```\nThis keyword configures the directory URL for the CA used by this acme\nsection. This keyword is mandatory as there is no default URL.\n\n```\n\nExample:```\n\ndirectory https://acme-staging-v02.api.letsencrypt.org/directory\n\n```\n\n**[keytype](#12.8-keytype)**<string>```\nConfigure the type of key that will be generated. Value can be either \"RSA\"\nor \"ECDSA\". You can also configure the \"curvesThis keyword is available in sections :ACMEBind optionsServer and default-server options\" for ECDSA and the number of\n\"bits\" for RSA. By default EC384 keys are generated.\n\n```\n\n**[map](#12.8-map)**<map>```\nConfigure the map which will be used to store token (key) and thumbprint\n(value), which is useful to reply to a challenge when there are multiple\naccount used. The acme task will add entries before validating the challenge\nand will remove the entries at the end of the task.\n\n```\n\n**[reuse-key](#12.8-reuse-key)**{ on | off }```\nIf set to \"on\", HAProxy won't generate a new private key and will keep the\nprevious one. Rotating private keys is recommended, when enabling this option\nit is recommended to regenerate manually the keys regularly.\n\nThis option might be useful when using RSA keys bigger than 2048 that can\ntake time to generate and might slow down one thread doing so.\n\nUsing the same key can be useful when using the cache of your ACME server, it\ncan help to retrieve a valid certificate corresponding to the current key.\n\nThe default setting is \"off\".\n\n```\n\nExample:```\n\nglobal\n    expose-experimental-directives\n    httpclient.resolvers.prefer ipv4\n\nfrontend in\n    bind *:80\n    bind *:443 ssl\n    http-request return status 200 content-type text/plain lf-string \"%[path,field(-1,/)].%[path,field(-1,/),map(virt@acme)]\\n\" if { path_beg '/.well-known/acme-challenge/' }\n    ssl-f-use crt \"foo.example.com.pem.rsa\"   acme LE1 domains \"foo.example.com.pem,bar.example.com\"\n    ssl-f-use crt \"foo.example.com.pem.ecdsa\" acme LE2 domains \"foo.example.com.pem,bar.example.com\"\n\nacme LE1\n    directory https://acme-staging-v02.api.letsencrypt.org/directory\n    account-key /etc/haproxy/letsencrypt.account.key\n    contact john.doe@example.com\n    challenge http-01\n    keytype RSA\n    bits 2048\n    map virt@acme\n\nacme LE2\n    directory https://acme-staging-v02.api.letsencrypt.org/directory\n    account-key /etc/haproxy/letsencrypt.account.key\n    contact john.doe@example.com\n    challenge http-01\n    keytype ECDSA\n    curves P-384\n    map virt@acme\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "12.9. Programs (deprecated)", "content": "## [12.9.](#12.9)Programs (deprecated)\n\n```\nThis section is deprecated and should disappear with HAProxy 3.3. The section\ncould be replaced easily by separated process managers. Systemd unit files or\nsysvinit scripts could replace this section as they are more reliable. In docker\nenvironments, some alternatives can also be found such as s6 or supervisord.\n\nIn master-worker mode, it is possible to launch external binaries with the\nmaster, these processes are called programs. These programs are launched and\nmanaged the same way as the workers.\n\nSince version 3.1, the program section has a slightly different behavior, the\nsection is parsed and the program is started from the master, but the rest of\nthe configuration is loaded in the worker. This mean the program configuration\nis completely separated from the worker configuration, and a program could be\nreexecuted even if the worker configuration is wrong upon a reload.\n\nDuring a reload of HAProxy, those processes are dealing with the same\nsequence as a worker:\n\n  - the master is re-executed\n  - the master sends a SIGUSR1 signal to the program\n  - if \"option start-on-reload\" is not disabled, the master launches a new\n    instance of the program\n\nDuring a stop, or restart, a SIGTERM is sent to the programs.\n\n```\n\n**[program](#12.9-program)**<name>```\nThis is a new program section, this section will create an instance <name>\nwhich is visible in \"show proc\" on the master CLI. (See \"9.4. Master CLI\" in\nthe management guide).\n\n```\n\n**[command](#12.9-command)**<command>[arguments*]```\nDefine the command to start with optional arguments. The command is looked\nup in the current PATH if it does not include an absolute path. This is a\nmandatory option of the program section. Arguments containing spaces must\nbe enclosed in quotes or double quotes or be prefixed by a backslash.\n\n```\n\n**[user](#12.9-user)**<user name>```\nChanges the executed command user ID to the <user name> from /etc/passwd.\nSee also \"groupThis keyword is available in sections :UserlistsPrograms (deprecated)Process management and securityBind options\".\n\n```\n\n**[group](#12.9-group)**<group name>```\nChanges the executed command group ID to the <group name> from /etc/group.\nSee also \"userThis keyword is available in sections :UserlistsPrograms (deprecated)Process management and securityBind options\".\n\n```\n\n**[option start-on-reload](#12.9-option%20start-on-reload)****[no option start-on-reload](#12.9-no%20option%20start-on-reload)**```\nStart (or not) a new instance of the program upon a reload of the master.\nThe default is to start a new instance. This option may only be used in a\nprogram section.\n\n```\n\nHAProxy 3.2.13-3  Configuration Manual, 2026/02/19", "url": "https://docs.haproxy.org/3.2/configuration.html"}
{"title": "1. Prerequisites", "content": "# [1.](#1)Prerequisites\n\n```\nIn this document it is assumed that the reader has sufficient administration\nskills on a UNIX-like operating system, uses the shell on a daily basis and is\nfamiliar with troubleshooting utilities such as strace and tcpdump.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "2. Quick reminder about HAProxy's architecture", "content": "# [2.](#2)Quick reminder about HAProxy's architecture\n\n```\nHAProxy is a multi-threaded, event-driven, non-blocking daemon. This means it\nuses event multiplexing to schedule all of its activities instead of relying on\nthe system to schedule between multiple activities. Most of the time it runs as\na single process, so the output of \"ps aux\" on a system will report only one\n\"haproxy\" process, unless a soft reload is in progress and an older process is\nfinishing its job in parallel to the new one. It is thus always easy to trace\nits activity using the strace utility. In order to scale with the number of\navailable processors, by default haproxy will start one worker thread per\nprocessor it is allowed to run on. Unless explicitly configured differently,\nthe incoming traffic is spread over all these threads, all running the same\nevent loop. A great care is taken to limit inter-thread dependencies to the\nstrict minimum, so as to try to achieve near-linear scalability. This has some\nimpacts such as the fact that a given connection is served by a single thread.\nThus in order to use all available processing capacity, it is needed to have at\nleast as many connections as there are threads, which is almost always granted.\n\nHAProxy is designed to isolate itself into a chroot jail during startup, where\nit cannot perform any file-system access at all. This is also true for the\nlibraries it depends on (eg: libc, libssl, etc). The immediate effect is that\na running process will not be able to reload a configuration file to apply\nchanges, instead a new process will be started using the updated configuration\nfile. Some other less obvious effects are that some timezone files or resolver\nfiles the libc might attempt to access at run time will not be found, though\nthis should generally not happen as they're not needed after startup. A nice\nconsequence of this principle is that the HAProxy process is totally stateless,\nand no cleanup is needed after it's killed, so any killing method that works\nwill do the right thing.\n\nHAProxy doesn't write log files, but it relies on the standard syslog protocol\nto send logs to a remote server (which is often located on the same system).\n\nHAProxy uses its internal clock to enforce timeouts, that is derived from the\nsystem's time but where unexpected drift is corrected. This is done by limiting\nthe time spent waiting in poll() for an event, and measuring the time it really\ntook. In practice it never waits more than one second. This explains why, when\nrunning strace over a completely idle process, periodic calls to poll() (or any\nof its variants) surrounded by two gettimeofday() calls are noticed. They are\nnormal, completely harmless and so cheap that the load they imply is totally\nundetectable at the system scale, so there's nothing abnormal there. Example :\n\n  16:35:40.002320 gettimeofday({1442759740, 2605}, NULL) = 0\n  16:35:40.002942 epoll_wait(0, {}, 200, 1000) = 0\n  16:35:41.007542 gettimeofday({1442759741, 7641}, NULL) = 0\n  16:35:41.007998 gettimeofday({1442759741, 8114}, NULL) = 0\n  16:35:41.008391 epoll_wait(0, {}, 200, 1000) = 0\n  16:35:42.011313 gettimeofday({1442759742, 11411}, NULL) = 0\n\nHAProxy is a TCP proxy, not a router. It deals with established connections that\nhave been validated by the kernel, and not with packets of any form nor with\nsockets in other states (eg: no SYN_RECV nor TIME_WAIT), though their existence\nmay prevent it from binding a port. It relies on the system to accept incoming\nconnections and to initiate outgoing connections. An immediate effect of this is\nthat there is no relation between packets observed on the two sides of a\nforwarded connection, which can be of different size, numbers and even family.\nSince a connection may only be accepted from a socket in LISTEN state, all the\nsockets it is listening to are necessarily visible using the \"netstat\" utility\nto show listening sockets. Example :\n\n  # netstat -ltnp\n  Active Internet connections (only servers)\n  Proto Recv-Q Send-Q Local Address   Foreign Address   State    PID/Program name\n  tcp        0      0 0.0.0.0:22      0.0.0.0:*         LISTEN   1629/sshd\n  tcp        0      0 0.0.0.0:80      0.0.0.0:*         LISTEN   2847/haproxy\n  tcp        0      0 0.0.0.0:443     0.0.0.0:*         LISTEN   2847/haproxy\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "3. Starting HAProxy", "content": "# [3.](#3)Starting HAProxy\n\n```\nHAProxy is started by invoking the \"haproxy\" program with a number of arguments\npassed on the command line. The actual syntax is :\n\n  $ haproxy [<options>]*\n\n```\n\n**[where](#3-where)**[<options>]* is any number of options. An option always starts with '-'```\nfollowed by one of more letters, and possibly followed by one or multiple extra\narguments. Without any option, HAProxy displays the help page with a reminder\nabout supported options. Available options may vary slightly based on the\noperating system. A fair number of these options overlap with an equivalent one\nin the \"global\" section. In this case, the command line always has precedence\nover the configuration file, so that the command line can be used to quickly\nenforce some settings without touching the configuration files. The current\nlist of options is :\n\n  -- <cfgfile>* : all the arguments following \"--\" are paths to configuration\n    file/directory to be loaded and processed in the declaration order. It is\n    mostly useful when relying on the shell to load many files that are\n    numerically ordered. See also \"-f\". The difference between \"--\" and \"-f\" is\n    that one \"-f\" must be placed before each file name, while a single \"--\" is\n    needed before all file names. Both options can be used together, the\n    command line ordering still applies. When more than one file is specified,\n    each file must start on a section boundary, so the first keyword of each\n    file must be one of \"global\", \"defaults\", \"peers\", \"listen\", \"frontend\",\n    \"backend\", and so on. A file cannot contain just a server list for example.\n\n  -f <cfgfile|cfgdir> : adds <cfgfile> to the list of configuration files to be\n    loaded. If <cfgdir> is a directory, all the files (and only files) it\n    contains are added in lexical order (using LC_COLLATE=C) to the list of\n    configuration files to be loaded ; only files with \".cfg\" extension are\n    added, only non hidden files (not prefixed with \".\") are added.\n    Configuration files are loaded and processed in their declaration order.\n    This option may be specified multiple times to load multiple files. See\n    also \"--\". The difference between \"--\" and \"-f\" is that one \"-f\" must be\n    placed before each file name, while a single \"--\" is needed before all file\n    names. Both options can be used together, the command line ordering still\n    applies. When more than one file is specified, each file must start on a\n    section boundary, so the first keyword of each file must be one of\n    \"global\", \"defaults\", \"peers\", \"listen\", \"frontend\", \"backend\", and so on.\n    A file cannot contain just a server list for example.\n\n  -C <dir> : changes to directory <dir> before loading configuration\n    files. This is useful when using relative paths. Warning when using\n    wildcards after \"--\" which are in fact replaced by the shell before\n    starting haproxy.\n\n  -D : start as a daemon. The process detaches from the current terminal after\n    forking, and errors are not reported anymore in the terminal. It is\n    equivalent to the \"daemon\" keyword in the \"global\" section of the\n    configuration. It is recommended to always force it in any init script so\n    that a faulty configuration doesn't prevent the system from booting.\n\n  -L <name> : change the local peer name to <name>, which defaults to the local\n    hostname. This is used only with peers replication. You can use the\n    variable $HAPROXY_LOCALPEER in the configuration file to reference the\n    peer name.\n\n  -N <limit> : sets the default per-proxy maxconn to <limit> instead of the\n    builtin default value (usually 2000). Only useful for debugging.\n\n  -V : enable verbose mode (disables quiet mode). Reverts the effect of \"-q\" or\n    \"quiet\".\n\n  -W : master-worker mode. It is equivalent to the \"master-worker\" keyword in\n    the \"global\" section of the configuration. This mode will launch a \"master\"\n    which will monitor the \"workers\". Using this mode, you can reload HAProxy\n    directly by sending a SIGUSR2 signal to the master.  The master-worker mode\n    is compatible either with the foreground or daemon mode.  It is\n    recommended to use this mode with multiprocess and systemd.\n\n  -Ws : master-worker mode with support of `notify` type of systemd service.\n\n  -4 : force DNS resolvers to query and accept IPv4 addresses only (\"A\"\n       records). This can be used when facing difficulties in certain\n       environments lacking end-to-end dual-stack connectivity. It overrides\n       the global \"dns-accept-family\" directive and forces it to \"ipv4\".\n\n  -c : only performs a check of the configuration files and exits before trying\n    to bind. The exit status is zero if everything is OK, or non-zero if an\n    error is encountered. Presence of warnings will be reported if any.\n    By default this option does not report a success message. Combined with\n    \"-V\" this will print the message \"Configuration file is valid\" upon\n    success.\n\n    Scripts must use the exit status to determine the success of the\n    command.\n\n  -cc : evaluates a condition as used within a conditional block of the\n    configuration. The exit status is zero if the condition is true, 1 if the\n    condition is false or 2 if an error is encountered.\n\n  -d : enable debug mode. This disables daemon mode, forces the process to stay\n    in foreground and to show incoming and outgoing events. It must never be\n    used in an init script.\n\n  -dC[key] : dump the configuration file. It is performed after the lines are\n    tokenized, so comments are stripped and indenting is forced. If a non-zero\n    key is specified, lines are truncated before sensitive/confidential fields,\n    and identifiers and addresses are emitted hashed with this key using the\n    same algorithm as the one used by the anonymized mode on the CLI. This\n    means that the output may safely be shared with a developer who needs it\n    to figure what's happening in a dump that was anonymized using the same\n    key. Please also see the CLI's \"set anon\" command.\n\n  -dD : enable diagnostic mode. This mode will output extra warnings about\n    suspicious configuration statements. This will never prevent startup even in\n    \"zero-warning\" mode nor change the exit status code.\n\n  -dF : disable data fast-forward. It is a mechanism to optimize the data\n    forwarding by passing data directly from a side to the other one without\n    waking the stream up. Thanks to this directive, it is possible to disable\n    this optimization. Note it also disable any kernel tcp splicing. This\n    command is not meant for regular use, it will generally only be suggested by\n    developers along complex debugging sessions.\n\n  -dG : disable use of getaddrinfo() to resolve host names into addresses. It\n    can be used when suspecting that getaddrinfo() doesn't work as expected.\n    This option was made available because many bogus implementations of\n    getaddrinfo() exist on various systems and cause anomalies that are\n    difficult to troubleshoot.\n\n  -dI : enable the insecure fork. This is the equivalent of the\n    \"insecure-fork-wanted\" in the global section. It can be useful when running\n    all the reg-tests with ASAN which need to fork addr2line to resolve the\n    addresses.\n\n  -dK<class[,class]*> : dumps the list of registered keywords in each class.\n    The list of classes is available with \"-dKhelp\". All classes may be dumped\n    using \"-dKall\", otherwise a selection of those shown in the help can be\n    specified as a comma-delimited list. The output format will vary depending\n    on what class of keywords is being dumped (e.g. \"cfg\" will show the known\n    configuration keywords in a format resembling the config file format while\n    \"smp\" will show sample fetch functions prefixed with a compatibility matrix\n    with each rule set). These may rarely be used as-is by humans but can be of\n    great help for external tools that try to detect the appearance of new\n    keywords at certain places to automatically update some documentation,\n    syntax highlighting files, configuration parsers, API etc. The output\n    format may evolve a bit over time so it is really recommended to use this\n    output mostly to detect differences with previous archives. Note that not\n    all keywords are listed because many keywords have existed long before the\n    different keyword registration subsystems were created, and they do not\n    appear there. However since new keywords are only added via the modern\n    mechanisms, it's reasonably safe to assume that this output may be used to\n    detect language additions with a good accuracy. The keywords are only\n    dumped after the configuration is fully parsed, so that even dynamically\n    created keywords can be dumped. A good way to dump and exit is to run a\n    silent config check on an existing configuration:\n\n       ./haproxy -dKall -q -c -f foo.cfg\n\n    If no configuration file is available, using \"-f /dev/null\" will work as\n    well to dump all default keywords, but then the return status will not be\n    zero since there will be no listener, and will have to be ignored.\n\n  -dL : dumps the list of dynamic shared libraries that are loaded at the end\n   of the config processing. This will generally also include deep dependencies\n   such as anything loaded from Lua code for example, as well as the executable\n   itself. The list is printed in a format that ought to be easy enough to\n   sanitize to directly produce a tarball of all dependencies. Since it doesn't\n   stop the program's startup, it is recommended to only use it in combination\n   with \"-c\" and \"-q\" where only the list of loaded objects will be displayed\n   (or nothing in case of error). In addition, keep in mind that when providing\n   such a package to help with a core file analysis, most libraries are in fact\n   symbolic links that need to be dereferenced when creating the archive:\n\n       ./haproxy -W -q -c -dL -f foo.cfg | tar -T - -hzcf archive.tgz\n\n   When started in verbose mode (-V) the shared libraries' address ranges are\n   also enumerated, unless the quiet mode is in use (-q).\n\n  -dM[<byte>[,]][help|options,...] : forces memory poisoning, and/or changes\n    memory other debugging options. Memory poisonning means that each and every\n    memory region allocated with malloc() or pool_alloc() will be filled with\n    <byte> before being passed to the caller. When <byte> is not specified, it\n    defaults to 0x50 ('P'). While this slightly slows down operations, it is\n    useful to reliably trigger issues resulting from missing initializations in\n    the code that cause random crashes. Note that -dM0 has the effect of\n    turning any malloc() into a calloc(). In any case if a bug appears or\n    disappears when using this option it means there is a bug in haproxy, so\n    please report it. A number of other options are available either alone or\n    after a comma following the byte. The special option \"help\" will list the\n    currently supported options and their current value. Each debugging option\n    may be forced on or off. The most optimal options are usually chosen at\n    build time based on the operating system and do not need to be adjusted,\n    unless suggested by a developer. Supported debugging options include\n    (set/clear):\n      - fail / no-fail:\n        This enables randomly failing memory allocations, in conjunction with\n        the global \"tune.fail-alloc\" setting. This is used to detect missing\n        error checks in the code. Setting the option presets the ratio to 1%\n        failure rate.\n\n      - no-merge / merge:\n        By default, pools of very similar sizes are merged, resulting in more\n        efficiency, but this complicates the analysis of certain memory dumps.\n        This option allows to disable this mechanism, and may slightly increase\n        the memory usage.\n\n      - cold-first / hot-first:\n        In order to optimize the CPU cache hit ratio, by default the most\n        recently released objects (\"hot\") are recycled for new allocations.\n        But doing so also complicates analysis of memory dumps and may hide\n        use-after-free bugs. This option allows to instead pick the coldest\n        objects first, which may result in a slight increase of CPU usage.\n\n      - integrity / no-integrity:\n        When this option is enabled, memory integrity checks are enabled on\n        the allocated area to verify that it hasn't been modified since it was\n        last released. This works best with \"no-merge\", \"cold-first\" and \"tag\".\n        Enabling this option will slightly increase the CPU usage.\n\n      - backup / no-backup:\n        This option performs a copy of each released object at release time,\n        allowing developers to inspect them. It also performs a comparison at\n        allocation time to detect if anything changed in between, indicating a\n        use-after-free condition. This doubles the memory usage and slightly\n        increases the CPU usage (similar to \"integrity\"). If combined with\n        \"integrity\", it still duplicates the contents but doesn't perform the\n        comparison (which is performed by \"integrity\"). Just like \"integrity\",\n        it works best with \"no-merge\", \"cold-first\" and \"tag\".\n\n      - no-global / global:\n        Depending on the operating system, a process-wide global memory cache\n        may be enabled if it is estimated that the standard allocator is too\n        slow or inefficient with threads. This option allows to forcefully\n        disable it or enable it. Disabling it may result in a CPU usage\n        increase with inefficient allocators. Enabling it may result in a\n        higher memory usage with efficient allocators.\n\n      - no-cache / cache:\n        Each thread uses a very fast local object cache for allocations, which\n        is always enabled by default. This option allows to disable it. Since\n        the global cache also passes via the local caches, this will\n        effectively result in disabling all caches and allocating directly from\n        the default allocator. This may result in a significant increase of CPU\n        usage, but may also result in small memory savings on tiny systems.\n\n      - caller / no-caller:\n        Enabling this option reserves some extra space in each allocated object\n        to store the address of the last caller that allocated or released it.\n        This helps developers go back in time when analysing memory dumps and\n        to guess how something unexpected happened.\n\n      - tag / no-tag:\n        Enabling this option reserves some extra space in each allocated object\n        to store a tag that allows to detect bugs such as double-free, freeing\n        an invalid object, and buffer overflows. It offers much stronger\n        reliability guarantees at the expense of 4 or 8 extra bytes per\n        allocation. It usually is the first step to detect memory corruption.\n\n      - poison / no-poison:\n        Enabling this option will fill allocated objects with a fixed pattern\n        that will make sure that some accidental values such as 0 will not be\n        present if a newly added field was mistakenly forgotten in an\n        initialization routine. Such bugs tend to rarely reproduce, especially\n        when pools are not merged. This is normally enabled by directly passing\n        the byte's value to -dM but using this option allows to disable/enable\n        use of a previously set value.\n\n  -dR : disable SO_REUSEPORT socket option on listening ports. It is equivalent\n    to the \"global\" section's \"noreuseport\" keyword. This may be applied in\n    multi-threading scenarios, when load distribution issues observed among the\n    haproxy threads (could be monitored with top).\n\n  -dS : disable use of the splice() system call. It is equivalent to the\n    \"global\" section's \"nosplice\" keyword. This may be used when splice() is\n    suspected to behave improperly or to cause performance issues, or when\n    using strace to see the forwarded data (which do not appear when using\n    splice()).\n\n  -dV : disable SSL verify on the server side. It is equivalent to having\n    \"ssl-server-verify none\" in the \"global\" section. This is useful when\n    trying to reproduce production issues out of the production\n    environment. Never use this in an init script as it degrades SSL security\n    to the servers.\n\n  -dW : if set, haproxy will refuse to start if any warning was emitted while\n   processing the configuration. This helps detect subtle mistakes and keep the\n   configuration clean and portable across versions. It is recommended to set\n   this option in service scripts when configurations are managed by humans,\n   but it is recommended not to use it with generated configurations, which\n   tend to emit more warnings. It may be combined with \"-c\" to cause warnings\n   in checked configurations to fail. This is equivalent to global option\n   \"zero-warning\".\n\n  -dZ : disable forwarding of data in \"zero-copy\" mode. It is equivalent to the\n   \"global\" section's \"tune.disable-zero-copy-forwarding\" keyword. This may be\n   helpful in case of issues with data loss or data integrity, or when using\n   strace to see the forwarded data, as it also disables any kernel tcp\n   splicing.\n\n  -db : disable background mode and multi-process mode. The process remains in\n    foreground. It is mainly used during development or during small tests, as\n    Ctrl-C is enough to stop the process. Never use it in an init script.\n\n  -dc : enable CPU affinity debugging. The list of selected and evicted CPUs as\n    well as their topology will be reported before starting.\n\n  -de : disable the use of the \"epoll\" poller. It is equivalent to the \"global\"\n    section's keyword \"noepoll\". It is mostly useful when suspecting a bug\n    related to this poller. On systems supporting epoll, the fallback will\n    generally be the \"poll\" poller.\n\n  -dk : disable the use of the \"kqueue\" poller. It is equivalent to the\n    \"global\" section's keyword \"nokqueue\". It is mostly useful when suspecting\n    a bug related to this poller. On systems supporting kqueue, the fallback\n    will generally be the \"poll\" poller.\n\n  -dp : disable the use of the \"poll\" poller. It is equivalent to the \"global\"\n    section's keyword \"nopoll\". It is mostly useful when suspecting a bug\n    related to this poller. On systems supporting poll, the fallback will\n    generally be the \"select\" poller, which cannot be disabled and is limited\n    to 1024 file descriptors.\n\n  -dr : ignore server address resolution failures. It is very common when\n    validating a configuration out of production not to have access to the same\n    resolvers and to fail on server address resolution, making it difficult to\n    test a configuration. This option simply appends the \"none\" method to the\n    list of address resolution methods for all servers, ensuring that even if\n    the libc fails to resolve an address, the startup sequence is not\n    interrupted.\n\n  -dt [<trace_desc>,...] : activates traces on stderr. Without argument, this\n    enables all trace sources on error level. This can notably be useful to\n    detect protocol violations from clients or servers. An optional argument\n    can be used to specify a list of various trace configurations using ',' as\n    separator. Each element activates one or all trace sources. Additionally,\n    level and verbosity can be optionally specified on each element using ':'\n    as inner separator with trace name. When entering an invalid verbosity or\n    level name, the list of available keywords is presented. For example it can\n    be convenient to pass 'help' for each field to consult the list first.\n\n  -dv : disable the use of the \"evports\" poller. It is equivalent to the\n    \"global\" section's keyword \"noevports\". It is mostly useful when suspecting\n    a bug related to this poller. On systems supporting event ports (SunOS\n    derived from Solaris 10 and later), the fallback will generally be the\n    \"poll\" poller.\n\n  -m <limit> : limit allocatable memory, which is used to keep process's data,\n    to <limit> megabytes. This may cause some connection refusals or some\n    slowdowns depending on the amount of memory needed for normal operations.\n    This is mostly used to force haproxy process to work in a constrained\n    resource consumption scenario. It is important to note that the memory is\n    not shared between haproxy processes and a child process created via fork()\n    system call inherits its parent's resource limits. So, in a master-worker\n    mode this memory limit is separately applied to the master and its forked\n    worker process.\n\n  -n <limit> : limits the per-process connection limit to <limit>. This is\n    equivalent to the global section's keyword \"maxconn\". It has precedence\n    over this keyword. This may be used to quickly force lower limits to avoid\n    a service outage on systems where resource limits are too low.\n\n  -p <file> : write all processes' pids into <file> during startup. This is\n    equivalent to the \"global\" section's keyword \"pidfile\". The file is opened\n    before entering the chroot jail, and after doing the chdir() implied by\n    \"-C\". Each pid appears on its own line.\n\n  -q : set \"quiet\" mode. This disables the output messages. It can be used in\n    combination with \"-c\" to just check if a configuration file is valid or not.\n\n  -S <bind>[,bind_options...]: in master-worker mode, bind a master CLI, which\n    allows the access to every processes, running or leaving ones.\n    For security reasons, it is recommended to bind the master CLI to a local\n    UNIX socket. The bind options are the same as the keyword \"bind\" in\n    the configuration file with words separated by commas instead of spaces.\n\n    Note that this socket can't be used to retrieve the listening sockets from\n    an old process during a seamless reload.\n\n  -sf <pid>* : send the \"finish\" signal (SIGUSR1) to older processes after boot\n    completion to ask them to finish what they are doing and to leave. <pid>\n    is a list of pids to signal (one per argument). The list ends on any\n    option starting with a \"-\". It is not a problem if the list of pids is\n    empty, so that it can be built on the fly based on the result of a command\n    like \"pidof\" or \"pgrep\".\n\n  -st <pid>* : send the \"terminate\" signal (SIGTERM) to older processes after\n    boot completion to terminate them immediately without finishing what they\n    were doing. <pid> is a list of pids to signal (one per argument). The list\n    ends on any option starting with a \"-\". It is not a problem if the list\n    of pids is empty, so that it can be built on the fly based on the result of\n    a command like \"pidof\" or \"pgrep\".\n\n  -v : report the version and build date.\n\n  -vv : display the version, build options, libraries versions and usable\n    pollers. This output is systematically requested when filing a bug report.\n\n  -x <unix_socket> : connect to the specified socket and try to retrieve any\n    listening sockets from the old process, and use them instead of trying to\n    bind new ones. This is useful to avoid missing any new connection when\n    reloading the configuration on Linux.\n\n    Without master-worker mode, the capability must be enable on the stats\n    socket using \"expose-fd listeners\" in your configuration.\n\n    In master-worker mode, it does not need \"expose-fd listeners\", the master\n    will use automatically this option upon a reload with the \"sockpair@\"\n    syntax, which allows the master to connect directly to a worker without using\n    any stats socket declared in the configuration. If you want to disable this,\n    you can pass -x /dev/null.\n\nA safe way to start HAProxy from an init file consists in forcing the daemon\nmode, storing existing pids to a pid file and using this pid file to notify\nolder processes to finish before leaving :\n\n   haproxy -f /etc/haproxy.cfg \\\n           -D -p /var/run/haproxy.pid -sf $(cat /var/run/haproxy.pid)\n\nWhen the configuration is split into a few specific files (eg: tcp vs http),\nit is recommended to use the \"-f\" option :\n\n   haproxy -f /etc/haproxy/global.cfg -f /etc/haproxy/stats.cfg \\\n           -f /etc/haproxy/default-tcp.cfg -f /etc/haproxy/tcp.cfg \\\n           -f /etc/haproxy/default-http.cfg -f /etc/haproxy/http.cfg \\\n           -D -p /var/run/haproxy.pid -sf $(cat /var/run/haproxy.pid)\n\nWhen an unknown number of files is expected, such as customer-specific files,\nit is recommended to assign them a name starting with a fixed-size sequence\nnumber and to use \"--\" to load them, possibly after loading some defaults :\n\n   haproxy -f /etc/haproxy/global.cfg -f /etc/haproxy/stats.cfg \\\n           -f /etc/haproxy/default-tcp.cfg -f /etc/haproxy/tcp.cfg \\\n           -f /etc/haproxy/default-http.cfg -f /etc/haproxy/http.cfg \\\n           -D -p /var/run/haproxy.pid -sf $(cat /var/run/haproxy.pid) \\\n           -f /etc/haproxy/default-customers.cfg -- /etc/haproxy/customers/*\n\nSometimes a failure to start may happen for whatever reason. Then it is\nimportant to verify if the version of HAProxy you are invoking is the expected\nversion and if it supports the features you are expecting (eg: SSL, PCRE,\ncompression, Lua, etc). This can be verified using \"haproxy -vv\". Some\nimportant information such as certain build options, the target system and\nthe versions of the libraries being used are reported there. It is also what\nyou will systematically be asked for when posting a bug report :\n\n  $ haproxy -vv\n  HAProxy version 1.6-dev7-a088d3-4 2015/10/08\n  Copyright 2000-2015 Willy Tarreau <willy@haproxy.org>\n\n  Build options :\n    TARGET  = linux2628\n    CPU     = generic\n    CC      = gcc\n    CFLAGS  = -pg -O0 -g -fno-strict-aliasing -Wdeclaration-after-statement \\\n              -DBUFSIZE=8030 -DMAXREWRITE=1030 -DSO_MARK=36 -DTCP_REPAIR=19\n    OPTIONS = USE_ZLIB=1 USE_DLMALLOC=1 USE_OPENSSL=1 USE_LUA=1 USE_PCRE=1\n\n  Default settings :\n    maxconn = 2000, bufsize = 8030, maxrewrite = 1030, maxpollevents = 200\n\n  Encrypted password support via crypt(3): yes\n  Built with zlib version : 1.2.6\n  Compression algorithms supported : identity(\"identity\"), deflate(\"deflate\"), \\\n                                     raw-deflate(\"deflate\"), gzip(\"gzip\")\n  Built with OpenSSL version : OpenSSL 1.0.1o 12 Jun 2015\n  Running on OpenSSL version : OpenSSL 1.0.1o 12 Jun 2015\n  OpenSSL library supports TLS extensions : yes\n  OpenSSL library supports SNI : yes\n  OpenSSL library supports prefer-server-ciphers : yes\n  Built with PCRE version : 8.12 2011-01-15\n  PCRE library supports JIT : no (USE_PCRE_JIT not set)\n  Built with Lua version : Lua 5.3.1\n  Built with transparent proxy support using: IP_TRANSPARENT IP_FREEBIND\n\n  Available polling systems :\n        epoll : pref=300,  test result OK\n         poll : pref=200,  test result OK\n       select : pref=150,  test result OK\n  Total: 3 (3 usable), will use epoll.\n\nThe relevant information that many non-developer users can verify here are :\n  - the version : 1.6-dev7-a088d3-4 above means the code is currently at commit\n    ID \"a088d3\" which is the 4th one after after official version \"1.6-dev7\".\n    Version 1.6-dev7 would show as \"1.6-dev7-8c1ad7\". What matters here is in\n    fact \"1.6-dev7\". This is the 7th development version of what will become\n    version 1.6 in the future. A development version not suitable for use in\n    production (unless you know exactly what you are doing). A stable version\n    will show as a 3-numbers version, such as \"1.5.14-16f863\", indicating the\n    14th level of fix on top of version 1.5. This is a production-ready version.\n\n  - the release date : 2015/10/08. It is represented in the universal\n    year/month/day format. Here this means August 8th, 2015. Given that stable\n    releases are issued every few months (1-2 months at the beginning, sometimes\n    6 months once the product becomes very stable), if you're seeing an old date\n    here, it means you're probably affected by a number of bugs or security\n    issues that have since been fixed and that it might be worth checking on the\n    official site.\n\n  - build options : they are relevant to people who build their packages\n    themselves, they can explain why things are not behaving as expected. For\n    example the development version above was built for Linux 2.6.28 or later,\n    targeting a generic CPU (no CPU-specific optimizations), and lacks any\n    code optimization (-O0) so it will perform poorly in terms of performance.\n\n  - libraries versions : zlib version is reported as found in the library\n    itself. In general zlib is considered a very stable product and upgrades\n    are almost never needed. OpenSSL reports two versions, the version used at\n    build time and the one being used, as found on the system. These ones may\n    differ by the last letter but never by the numbers. The build date is also\n    reported because most OpenSSL bugs are security issues and need to be taken\n    seriously, so this library absolutely needs to be kept up to date. Seeing a\n    4-months old version here is highly suspicious and indeed an update was\n    missed. PCRE provides very fast regular expressions and is highly\n    recommended. Certain of its extensions such as JIT are not present in all\n    versions and still young so some people prefer not to build with them,\n    which is why the build status is reported as well. Regarding the Lua\n    scripting language, HAProxy expects version 5.3 which is very young since\n    it was released a little time before HAProxy 1.6. It is important to check\n    on the Lua web site if some fixes are proposed for this branch.\n\n  - Available polling systems will affect the process's scalability when\n    dealing with more than about one thousand of concurrent connections. These\n    ones are only available when the correct system was indicated in the TARGET\n    variable during the build. The \"epoll\" mechanism is highly recommended on\n    Linux, and the kqueue mechanism is highly recommended on BSD. Lacking them\n    will result in poll() or even select() being used, causing a high CPU usage\n    when dealing with a lot of connections.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "4. Stopping and restarting HAProxy", "content": "# [4.](#4)Stopping and restarting HAProxy\n\n```\nHAProxy supports a graceful and a hard stop. The hard stop is simple, when the\nSIGTERM signal is sent to the haproxy process, it immediately quits and all\nestablished connections are closed. The graceful stop is triggered when the\nSIGUSR1 signal is sent to the haproxy process. It consists in only unbinding\nfrom listening ports, but continue to process existing connections until they\nclose. Once the last connection is closed, the process leaves.\n\nThe hard stop method is used for the \"stop\" or \"restart\" actions of the service\nmanagement script. The graceful stop is used for the \"reload\" action which\ntries to seamlessly reload a new configuration in a new process.\n\nBoth of these signals may be sent by the new haproxy process itself during a\nreload or restart, so that they are sent at the latest possible moment and only\nif absolutely required. This is what is performed by the \"-st\" (hard) and \"-sf\"\n(graceful) options respectively.\n\nIn master-worker mode, it is not needed to start a new haproxy process in\norder to reload the configuration. The master process reacts to the SIGUSR2\nsignal by reexecuting itself with the -sf parameter followed by the PIDs of\nthe workers. The master will then parse the configuration file and fork new\nworkers.\n\nTo understand better how these signals are used, it is important to understand\nthe whole restart mechanism.\n\nFirst, an existing haproxy process is running. The administrator uses a system\nspecific command such as \"/etc/init.d/haproxy reload\" to indicate they want to\ntake the new configuration file into effect. What happens then is the following.\nFirst, the service script (/etc/init.d/haproxy or equivalent) will verify that\nthe configuration file parses correctly using \"haproxy -c\". After that it will\ntry to start haproxy with this configuration file, using \"-st\" or \"-sf\".\n\nThen HAProxy tries to bind to all listening ports. If some fatal errors happen\n(eg: address not present on the system, permission denied), the process quits\nwith an error. If a socket binding fails because a port is already in use, then\nthe process will first send a SIGTTOU signal to all the pids specified in the\n\"-st\" or \"-sf\" pid list. This is what is called the \"pause\" signal. It instructs\nall existing haproxy processes to temporarily stop listening to their ports so\nthat the new process can try to bind again. During this time, the old process\ncontinues to process existing connections. If the binding still fails (because\nfor example a port is shared with another daemon), then the new process sends a\nSIGTTIN signal to the old processes to instruct them to resume operations just\nas if nothing happened. The old processes will then restart listening to the\nports and continue to accept connections. Note that this mechanism is system\ndependent and some operating systems may not support it in multi-process mode.\n\nIf the new process manages to bind correctly to all ports, then it sends either\nthe SIGTERM (hard stop in case of \"-st\") or the SIGUSR1 (graceful stop in case\nof \"-sf\") to all processes to notify them that it is now in charge of operations\nand that the old processes will have to leave, either immediately or once they\nhave finished their job.\n\nIt is important to note that during this timeframe, there are two small windows\nof a few milliseconds each where it is possible that a few connection failures\nwill be noticed during high loads. Typically observed failure rates are around\n1 failure during a reload operation every 10000 new connections per second,\nwhich means that a heavily loaded site running at 30000 new connections per\nsecond may see about 3 failed connection upon every reload. The two situations\nwhere this happens are :\n\n  - if the new process fails to bind due to the presence of the old process,\n    it will first have to go through the SIGTTOU+SIGTTIN sequence, which\n    typically lasts about one millisecond for a few tens of frontends, and\n    during which some ports will not be bound to the old process and not yet\n    bound to the new one. HAProxy works around this on systems that support the\n    SO_REUSEPORT socket options, as it allows the new process to bind without\n    first asking the old one to unbind. Most BSD systems have been supporting\n    this almost forever. Linux has been supporting this in version 2.0 and\n    dropped it around 2.2, but some patches were floating around by then. It\n    was reintroduced in kernel 3.9, so if you are observing a connection\n    failure rate above the one mentioned above, please ensure that your kernel\n    is 3.9 or newer, or that relevant patches were backported to your kernel\n    (less likely).\n\n  - when the old processes close the listening ports, the kernel may not always\n    redistribute any pending connection that was remaining in the socket's\n    backlog. Under high loads, a SYN packet may happen just before the socket\n    is closed, and will lead to an RST packet being sent to the client. In some\n    critical environments where even one drop is not acceptable, these ones are\n    sometimes dealt with using firewall rules to block SYN packets during the\n    reload, forcing the client to retransmit. This is totally system-dependent,\n    as some systems might be able to visit other listening queues and avoid\n    this RST. A second case concerns the ACK from the client on a local socket\n    that was in SYN_RECV state just before the close. This ACK will lead to an\n    RST packet while the haproxy process is still not aware of it. This one is\n    harder to get rid of, though the firewall filtering rules mentioned above\n    will work well if applied one second or so before restarting the process.\n\nFor the vast majority of users, such drops will never ever happen since they\ndon't have enough load to trigger the race conditions. And for most high traffic\nusers, the failure rate is still fairly within the noise margin provided that at\nleast SO_REUSEPORT is properly supported on their systems.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "5. File-descriptor limitations", "content": "# [5.](#5)File-descriptor limitations\n\n```\nIn order to ensure that all incoming connections will successfully be served,\nHAProxy computes at load time the total number of file descriptors that will be\nneeded during the process's life. A regular Unix process is generally granted\n1024 file descriptors by default, and a privileged process can raise this limit\nitself. This is one reason for starting HAProxy as root and letting it adjust\nthe limit. The default limit of 1024 file descriptors roughly allow about 500\nconcurrent connections to be processed. The computation is based on the global\nmaxconn parameter which limits the total number of connections per process, the\nnumber of listeners, the number of servers which have a health check enabled,\nthe agent checks, the peers, the loggers and possibly a few other technical\nrequirements. A simple rough estimate of this number consists in simply\ndoubling the maxconn value and adding a few tens to get the approximate number\nof file descriptors needed.\n\nOriginally HAProxy did not know how to compute this value, and it was necessary\nto pass the value using the \"ulimit-n\" setting in the global section. This\nexplains why even today a lot of configurations are seen with this setting\npresent. Unfortunately it was often miscalculated resulting in connection\nfailures when approaching maxconn instead of throttling incoming connection\nwhile waiting for the needed resources. For this reason it is important to\nremove any vestigial \"ulimit-n\" setting that can remain from very old versions.\n\nRaising the number of file descriptors to accept even moderate loads is\nmandatory but comes with some OS-specific adjustments. First, the select()\npolling system is limited to 1024 file descriptors. In fact on Linux it used\nto be capable of handling more but since certain OS ship with excessively\nrestrictive SELinux policies forbidding the use of select() with more than\n1024 file descriptors, HAProxy now refuses to start in this case in order to\navoid any issue at run time. On all supported operating systems, poll() is\navailable and will not suffer from this limitation. It is automatically picked\nso there is nothing to do to get a working configuration. But poll's becomes\nvery slow when the number of file descriptors increases. While HAProxy does its\nbest to limit this performance impact (eg: via the use of the internal file\ndescriptor cache and batched processing), a good rule of thumb is that using\npoll() with more than a thousand concurrent connections will use a lot of CPU.\n\nFor Linux systems base on kernels 2.6 and above, the epoll() system call will\nbe used. It's a much more scalable mechanism relying on callbacks in the kernel\nthat guarantee a constant wake up time regardless of the number of registered\nmonitored file descriptors. It is automatically used where detected, provided\nthat HAProxy had been built for one of the Linux flavors. Its presence and\nsupport can be verified using \"haproxy -vv\".\n\nFor BSD systems which support it, kqueue() is available as an alternative. It\nis much faster than poll() and even slightly faster than epoll() thanks to its\nbatched handling of changes. At least FreeBSD and OpenBSD support it. Just like\nwith Linux's epoll(), its support and availability are reported in the output\nof \"haproxy -vv\".\n\nHaving a good poller is one thing, but it is mandatory that the process can\nreach the limits. When HAProxy starts, it immediately sets the new process's\nfile descriptor limits and verifies if it succeeds. In case of failure, it\nreports it before forking so that the administrator can see the problem. As\nlong as the process is started by as root, there should be no reason for this\nsetting to fail. However, it can fail if the process is started by an\nunprivileged user. If there is a compelling reason for *not* starting haproxy\nas root (eg: started by end users, or by a per-application account), then the\nfile descriptor limit can be raised by the system administrator for this\nspecific user. The effectiveness of the setting can be verified by issuing\n\"ulimit -n\" from the user's command line. It should reflect the new limit.\n\nWarning: when an unprivileged user's limits are changed in this user's account,\nit is fairly common that these values are only considered when the user logs in\nand not at all in some scripts run at system boot time nor in crontabs. This is\ntotally dependent on the operating system, keep in mind to check \"ulimit -n\"\nbefore starting haproxy when running this way. The general advice is never to\nstart haproxy as an unprivileged user for production purposes. Another good\nreason is that it prevents haproxy from enabling some security protections.\n\nOnce it is certain that the system will allow the haproxy process to use the\nrequested number of file descriptors, two new system-specific limits may be\nencountered. The first one is the system-wide file descriptor limit, which is\nthe total number of file descriptors opened on the system, covering all\nprocesses. When this limit is reached, accept() or socket() will typically\nreturn ENFILE. The second one is the per-process hard limit on the number of\nfile descriptors, it prevents setrlimit() from being set higher. Both are very\ndependent on the operating system. On Linux, the system limit is set at boot\nbased on the amount of memory. It can be changed with the \"fs.file-max\" sysctl.\nAnd the per-process hard limit is set to 1048576 by default, but it can be\nchanged using the \"fs.nr_open\" sysctl.\n\nFile descriptor limitations may be observed on a running process when they are\nset too low. The strace utility will report that accept() and socket() return\n\"-1 EMFILE\" when the process's limits have been reached. In this case, simply\nraising the \"ulimit-n\" value (or removing it) will solve the problem. If these\nsystem calls return \"-1 ENFILE\" then it means that the kernel's limits have\nbeen reached and that something must be done on a system-wide parameter. These\ntrouble must absolutely be addressed, as they result in high CPU usage (when\naccept() fails) and failed connections that are generally visible to the user.\nOne solution also consists in lowering the global maxconn value to enforce\nserialization, and possibly to disable HTTP keep-alive to force connections\nto be released and reused faster.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "6. Memory management", "content": "# [6.](#6)Memory management\n\n```\nHAProxy uses a simple and fast pool-based memory management. Since it relies on\na small number of different object types, it's much more efficient to pick new\nobjects from a pool which already contains objects of the appropriate size than\nto call malloc() for each different size. The pools are organized as a stack or\nLIFO, so that newly allocated objects are taken from recently released objects\nstill hot in the CPU caches. Pools of similar sizes are merged together, in\norder to limit memory fragmentation.\n\nBy default, since the focus is set on performance, each released object is put\nback into the pool it came from, and allocated objects are never freed since\nthey are expected to be reused very soon.\n\nOn the CLI, it is possible to check how memory is being used in pools thanks to\nthe \"show pools\" command :\n\n  > show pools\n  Dumping pools usage. Use SIGQUIT to flush them.\n    - Pool cache_st (16 bytes) : 0 allocated (0 bytes), 0 used, 0 failures, 1 users, @0x9ccc40=03 [SHARED]\n    - Pool pipe (32 bytes) : 5 allocated (160 bytes), 5 used, 0 failures, 2 users, @0x9ccac0=00 [SHARED]\n    - Pool comp_state (48 bytes) : 3 allocated (144 bytes), 3 used, 0 failures, 5 users, @0x9cccc0=04 [SHARED]\n    - Pool filter (64 bytes) : 0 allocated (0 bytes), 0 used, 0 failures, 3 users, @0x9ccbc0=02 [SHARED]\n    - Pool vars (80 bytes) : 0 allocated (0 bytes), 0 used, 0 failures, 2 users, @0x9ccb40=01 [SHARED]\n    - Pool uniqueid (128 bytes) : 0 allocated (0 bytes), 0 used, 0 failures, 2 users, @0x9cd240=15 [SHARED]\n    - Pool task (144 bytes) : 55 allocated (7920 bytes), 55 used, 0 failures, 1 users, @0x9cd040=11 [SHARED]\n    - Pool session (160 bytes) : 1 allocated (160 bytes), 1 used, 0 failures, 1 users, @0x9cd140=13 [SHARED]\n    - Pool h2s (208 bytes) : 0 allocated (0 bytes), 0 used, 0 failures, 2 users, @0x9ccec0=08 [SHARED]\n    - Pool h2c (288 bytes) : 0 allocated (0 bytes), 0 used, 0 failures, 1 users, @0x9cce40=07 [SHARED]\n    - Pool spoe_ctx (304 bytes) : 0 allocated (0 bytes), 0 used, 0 failures, 2 users, @0x9ccf40=09 [SHARED]\n    - Pool connection (400 bytes) : 2 allocated (800 bytes), 2 used, 0 failures, 1 users, @0x9cd1c0=14 [SHARED]\n    - Pool hdr_idx (416 bytes) : 0 allocated (0 bytes), 0 used, 0 failures, 1 users, @0x9cd340=17 [SHARED]\n    - Pool dns_resolut (480 bytes) : 0 allocated (0 bytes), 0 used, 0 failures, 1 users, @0x9ccdc0=06 [SHARED]\n    - Pool dns_answer_ (576 bytes) : 0 allocated (0 bytes), 0 used, 0 failures, 1 users, @0x9ccd40=05 [SHARED]\n    - Pool stream (960 bytes) : 1 allocated (960 bytes), 1 used, 0 failures, 1 users, @0x9cd0c0=12 [SHARED]\n    - Pool requri (1024 bytes) : 0 allocated (0 bytes), 0 used, 0 failures, 1 users, @0x9cd2c0=16 [SHARED]\n    - Pool buffer (8030 bytes) : 3 allocated (24090 bytes), 2 used, 0 failures, 1 users, @0x9cd3c0=18 [SHARED]\n    - Pool trash (8062 bytes) : 1 allocated (8062 bytes), 1 used, 0 failures, 1 users, @0x9cd440=19\n  Total: 19 pools, 42296 bytes allocated, 34266 used.\n\nThe pool name is only indicative, it's the name of the first object type using\nthis pool. The size in parenthesis is the object size for objects in this pool.\nObject sizes are always rounded up to the closest multiple of 16 bytes. The\nnumber of objects currently allocated and the equivalent number of bytes is\nreported so that it is easy to know which pool is responsible for the highest\nmemory usage. The number of objects currently in use is reported as well in the\n\"used\" field. The difference between \"allocated\" and \"used\" corresponds to the\nobjects that have been freed and are available for immediate use. The address\nat the end of the line is the pool's address, and the following number is the\npool index when it exists, or is reported as -1 if no index was assigned.\n\nIt is possible to limit the amount of memory allocated per process using the\n\"-m\" command line option, followed by a number of megabytes. It covers all of\nthe process's addressable space, so that includes memory used by some libraries\nas well as the stack, but it is a reliable limit when building a resource\nconstrained system. It works the same way as \"ulimit -v\" on systems which have\nit, or \"ulimit -d\" for the other ones.\n\nIf a memory allocation fails due to the memory limit being reached or because\nthe system doesn't have any enough memory, then haproxy will first start to\nfree all available objects from all pools before attempting to allocate memory\nagain. This mechanism of releasing unused memory can be triggered by sending\nthe signal SIGQUIT to the haproxy process. When doing so, the pools state prior\nto the flush will also be reported to stderr when the process runs in\nforeground.\n\nDuring a reload operation, the process switched to the graceful stop state also\nautomatically performs some flushes after releasing any connection so that all\npossible memory is released to save it for the new process.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "7. CPU usage", "content": "# [7.](#7)CPU usage\n\n```\nHAProxy normally spends most of its time in the system and a smaller part in\nuserland. A finely tuned 3.5 GHz CPU can sustain a rate about 80000 end-to-end\nconnection setups and closes per second at 100% CPU on a single core. When one\ncore is saturated, typical figures are :\n  - 95% system, 5% user for long TCP connections or large HTTP objects\n  - 85% system and 15% user for short TCP connections or small HTTP objects in\n    close mode\n  - 70% system and 30% user for small HTTP objects in keep-alive mode\n\nThe amount of rules processing and regular expressions will increase the user\nland part. The presence of firewall rules, connection tracking, complex routing\ntables in the system will instead increase the system part.\n\nOn most systems, the CPU time observed during network transfers can be cut in 4\nparts :\n  - the interrupt part, which concerns all the processing performed upon I/O\n    receipt, before the target process is even known. Typically Rx packets are\n    accounted for in interrupt. On some systems such as Linux where interrupt\n    processing may be deferred to a dedicated thread, it can appear as softirq,\n    and the thread is called ksoftirqd/0 (for CPU 0). The CPU taking care of\n    this load is generally defined by the hardware settings, though in the case\n    of softirq it is often possible to remap the processing to another CPU.\n    This interrupt part will often be perceived as parasitic since it's not\n    associated with any process, but it actually is some processing being done\n    to prepare the work for the process.\n\n  - the system part, which concerns all the processing done using kernel code\n    called from userland. System calls are accounted as system for example. All\n    synchronously delivered Tx packets will be accounted for as system time. If\n    some packets have to be deferred due to queues filling up, they may then be\n    processed in interrupt context later (eg: upon receipt of an ACK opening a\n    TCP window).\n\n  - the user part, which exclusively runs application code in userland. HAProxy\n    runs exclusively in this part, though it makes heavy use of system calls.\n    Rules processing, regular expressions, compression, encryption all add to\n    the user portion of CPU consumption.\n\n  - the idle part, which is what the CPU does when there is nothing to do. For\n    example HAProxy waits for an incoming connection, or waits for some data to\n    leave, meaning the system is waiting for an ACK from the client to push\n    these data.\n\nIn practice regarding HAProxy's activity, it is in general reasonably accurate\n(but totally inexact) to consider that interrupt/softirq are caused by Rx\nprocessing in kernel drivers, that user-land is caused by layer 7 processing\nin HAProxy, and that system time is caused by network processing on the Tx\npath.\n\nSince HAProxy runs around an event loop, it waits for new events using poll()\n(or any alternative) and processes all these events as fast as possible before\ngoing back to poll() waiting for new events. It measures the time spent waiting\nin poll() compared to the time spent doing processing events. The ratio of\npolling time vs total time is called the \"idle\" time, it's the amount of time\nspent waiting for something to happen. This ratio is reported in the stats page\non the \"idle\" line, or \"Idle_pct\" on the CLI. When it's close to 100%, it means\nthe load is extremely low. When it's close to 0%, it means that there is\nconstantly some activity. While it cannot be very accurate on an overloaded\nsystem due to other processes possibly preempting the CPU from the haproxy\nprocess, it still provides a good estimate about how HAProxy considers it is\nworking : if the load is low and the idle ratio is low as well, it may indicate\nthat HAProxy has a lot of work to do, possibly due to very expensive rules that\nhave to be processed. Conversely, if HAProxy indicates the idle is close to\n100% while things are slow, it means that it cannot do anything to speed things\nup because it is already waiting for incoming data to process. In the example\nbelow, haproxy is completely idle :\n\n  $ echo \"show info\" | socat - /var/run/haproxy.sock | grep ^Idle\n  Idle_pct: 100\n\nWhen the idle ratio starts to become very low, it is important to tune the\nsystem and place processes and interrupts correctly to save the most possible\nCPU resources for all tasks. If a firewall is present, it may be worth trying\nto disable it or to tune it to ensure it is not responsible for a large part\nof the performance limitation. It's worth noting that unloading a stateful\nfirewall generally reduces both the amount of interrupt/softirq and of system\nusage since such firewalls act both on the Rx and the Tx paths. On Linux,\nunloading the nf_conntrack and ip_conntrack modules will show whether there is\nanything to gain. If so, then the module runs with default settings and you'll\nhave to figure how to tune it for better performance. In general this consists\nin considerably increasing the hash table size. On FreeBSD, \"pfctl -d\" will\ndisable the \"pf\" firewall and its stateful engine at the same time.\n\nIf it is observed that a lot of time is spent in interrupt/softirq, it is\nimportant to ensure that they don't run on the same CPU. Most systems tend to\npin the tasks on the CPU where they receive the network traffic because for\ncertain workloads it improves things. But with heavily network-bound workloads\nit is the opposite as the haproxy process will have to fight against its kernel\ncounterpart. Pinning haproxy to one CPU core and the interrupts to another one,\nall sharing the same L3 cache tends to sensibly increase network performance\nbecause in practice the amount of work for haproxy and the network stack are\nquite close, so they can almost fill an entire CPU each. On Linux this is done\nusing taskset (for haproxy) or using cpu-map (from the haproxy config), and the\ninterrupts are assigned under /proc/irq. Many network interfaces support\nmultiple queues and multiple interrupts. In general it helps to spread them\nacross a small number of CPU cores provided they all share the same L3 cache.\nPlease always stop irq_balance which always does the worst possible thing on\nsuch workloads.\n\nFor CPU-bound workloads consisting in a lot of SSL traffic or a lot of\ncompression, it may be worth using multiple processes dedicated to certain\ntasks, though there is no universal rule here and experimentation will have to\nbe performed.\n\nIn order to increase the CPU capacity, it is possible to make HAProxy run as\nseveral processes, using the \"nbproc\" directive in the global section. There\nare some limitations though :\n  - health checks are run per process, so the target servers will get as many\n    checks as there are running processes ;\n  - maxconn values and queues are per-process so the correct value must be set\n    to avoid overloading the servers ;\n  - outgoing connections should avoid using port ranges to avoid conflicts\n  - stick-tables are per process and are not shared between processes ;\n  - each peers section may only run on a single process at a time ;\n  - the CLI operations will only act on a single process at a time.\n\nWith this in mind, it appears that the easiest setup often consists in having\none first layer running on multiple processes and in charge for the heavy\nprocessing, passing the traffic to a second layer running in a single process.\nThis mechanism is suited to SSL and compression which are the two CPU-heavy\nfeatures. Instances can easily be chained over UNIX sockets (which are cheaper\nthan TCP sockets and which do not waste ports), and the proxy protocol which is\nuseful to pass client information to the next stage. When doing so, it is\ngenerally a good idea to bind all the single-process tasks to process number 1\nand extra tasks to next processes, as this will make it easier to generate\nsimilar configurations for different machines.\n\nOn Linux versions 3.9 and above, running HAProxy in multi-process mode is much\nmore efficient when each process uses a distinct listening socket on the same\nIP:port ; this will make the kernel evenly distribute the load across all\nprocesses instead of waking them all up. Please check the \"process\" option of\nthe \"bind\" keyword lines in the configuration manual for more information.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "8. Logging", "content": "# [8.](#8)Logging\n\n```\nFor logging, HAProxy always relies on a syslog server since it does not perform\nany file-system access. The standard way of using it is to send logs over UDP\nto the log server (by default on port 514). Very commonly this is configured to\n127.0.0.1 where the local syslog daemon is running, but it's also used over the\nnetwork to log to a central server. The central server provides additional\nbenefits especially in active-active scenarios where it is desirable to keep\nthe logs merged in arrival order. HAProxy may also make use of a UNIX socket to\nsend its logs to the local syslog daemon, but it is not recommended at all,\nbecause if the syslog server is restarted while haproxy runs, the socket will\nbe replaced and new logs will be lost. Since HAProxy will be isolated inside a\nchroot jail, it will not have the ability to reconnect to the new socket. It\nhas also been observed in field that the log buffers in use on UNIX sockets are\nvery small and lead to lost messages even at very light loads. But this can be\nfine for testing however.\n\nIt is recommended to add the following directive to the \"global\" section to\nmake HAProxy log to the local daemon using facility \"local0\" :\n\n      log 127.0.0.1:514 local0\n\nand then to add the following one to each \"defaults\" section or to each frontend\nand backend section :\n\n      log global\n\nThis way, all logs will be centralized through the global definition of where\nthe log server is.\n\nSome syslog daemons do not listen to UDP traffic by default, so depending on\nthe daemon being used, the syntax to enable this will vary :\n\n  - on sysklogd, you need to pass argument \"-r\" on the daemon's command line\n    so that it listens to a UDP socket for \"remote\" logs ; note that there is\n    no way to limit it to address 127.0.0.1 so it will also receive logs from\n    remote systems ;\n\n  - on rsyslogd, the following lines must be added to the configuration file :\n\n      $ModLoad imudp\n      $UDPServerAddress *\n      $UDPServerRun 514\n\n  - on syslog-ng, a new source can be created the following way, it then needs\n    to be added as a valid source in one of the \"log\" directives :\n\n      source s_udp {\n        udp(ip(127.0.0.1) port(514));\n      };\n\nPlease consult your syslog daemon's manual for more information. If no logs are\nseen in the system's log files, please consider the following tests :\n\n  - restart haproxy. Each frontend and backend logs one line indicating it's\n    starting. If these logs are received, it means logs are working.\n\n  - run \"strace -tt -s100 -etrace=sendmsg -p <haproxy's pid>\" and perform some\n    activity that you expect to be logged. You should see the log messages\n    being sent using sendmsg() there. If they don't appear, restart using\n    strace on top of haproxy. If you still see no logs, it definitely means\n    that something is wrong in your configuration.\n\n  - run tcpdump to watch for port 514, for example on the loopback interface if\n    the traffic is being sent locally : \"tcpdump -As0 -ni lo port 514\". If the\n    packets are seen there, it's the proof they're sent then the syslogd daemon\n    needs to be troubleshooted.\n\nWhile traffic logs are sent from the frontends (where the incoming connections\nare accepted), backends also need to be able to send logs in order to report a\nserver state change consecutive to a health check. Please consult HAProxy's\nconfiguration manual for more information regarding all possible log settings.\n\nIt is convenient to chose a facility that is not used by other daemons. HAProxy\nexamples often suggest \"local0\" for traffic logs and \"local1\" for admin logs\nbecause they're never seen in field. A single facility would be enough as well.\nHaving separate logs is convenient for log analysis, but it's also important to\nremember that logs may sometimes convey confidential information, and as such\nthey must not be mixed with other logs that may accidentally be handed out to\nunauthorized people.\n\nFor in-field troubleshooting without impacting the server's capacity too much,\nit is recommended to make use of the \"halog\" utility provided with HAProxy.\nThis is sort of a grep-like utility designed to process HAProxy log files at\na very fast data rate. Typical figures range between 1 and 2 GB of logs per\nsecond. It is capable of extracting only certain logs (eg: search for some\nclasses of HTTP status codes, connection termination status, search by response\ntime ranges, look for errors only), count lines, limit the output to a number\nof lines, and perform some more advanced statistics such as sorting servers\nby response time or error counts, sorting URLs by time or count, sorting client\naddresses by access count, and so on. It is pretty convenient to quickly spot\nanomalies such as a bot looping on the site, and block them.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "9. Statistics and monitoring", "content": "# [9.](#9)Statistics and monitoring\n\n```\nIt is possible to query HAProxy about its status. The most commonly used\nmechanism is the HTTP statistics page. This page also exposes an alternative\nCSV output format for monitoring tools. The same format is provided on the\nUnix socket.\n\nStatistics are regroup in categories labelled as domains, corresponding to the\nmultiple components of HAProxy. There are two domains available: proxy and\nresolvers. If not specified, the proxy domain is selected. Note that only the\nproxy statistics are printed on the HTTP page.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "9.1. Tricks for easier configuration management", "content": "## [9.1.](#9.1)CSV format\n\n```\nThe statistics may be consulted either from the unix socket or from the HTTP\npage. Both means provide a CSV format whose fields follow. The first line\nbegins with a sharp ('#') and has one word per comma-delimited field which\nrepresents the title of the column. All other lines starting at the second one\nuse a classical CSV format using a comma as the delimiter, and the double quote\n('\"') as an optional text delimiter, but only if the enclosed text is ambiguous\n(if it contains a quote or a comma). The double-quote character ('\"') in the\ntext is doubled ('\"\"'), which is the format that most tools recognize. Please\ndo not insert any column before these ones in order not to break tools which\nuse hard-coded column positions.\n\nFor proxy statistics, after each field name, the types which may have a value\nfor that field are specified in brackets. The types are L (Listeners), F\n(Frontends), B (Backends), and S (Servers). There is a fixed set of static\nfields that are always available in the same order. A column containing the\ncharacter '-' delimits the end of the static fields, after which presence or\norder of the fields are not guaranteed.\n\nHere is the list of static fields using the proxy statistics domain:\n  0. pxname [LFBS]: proxy name\n  1. svname [LFBS]: service name (FRONTEND for frontend, BACKEND for backend,\n     any name for server/listener)\n  2. qcur [..BS]: current queued requests. For the backend this reports the\n     number queued without a server assigned.\n  3. qmax [..BS]: max value of qcur\n  4. scur [LFBS]: current sessions\n  5. smax [LFBS]: max sessions\n  6. slim [LFBS]: configured session limit\n  7. stot [LFBS]: cumulative number of sessions\n  8. bin [LFBS]: bytes in\n  9. bout [LFBS]: bytes out\n 10. dreq [LFB.]: requests denied because of security concerns.\n     - For tcp this is because of a matched tcp-request content rule.\n     - For http this is because of a matched http-request or tarpit rule.\n 11. dresp [LFBS]: responses denied because of security concerns.\n     - For http this is because of a matched http-request rule, or\n       \"option checkcache\".\n 12. ereq [LF..]: request errors. Some of the possible causes are:\n     - early termination from the client, before the request has been sent.\n     - read error from the client\n     - client timeout\n     - client closed connection\n     - various bad requests from the client.\n     - request was tarpitted.\n 13. econ [..BS]: number of requests that encountered an error trying to\n     connect to a backend server. The backend stat is the sum of the stat\n     for all servers of that backend, plus any connection errors not\n     associated with a particular server (such as the backend having no\n     active servers).\n 14. eresp [..BS]: response errors. srv_abrt will be counted here also.\n     Some other errors are:\n     - write error on the client socket (won't be counted for the server stat)\n     - failure applying filters to the response.\n 15. wretr [..BS]: number of times a connection to a server was retried.\n 16. wredis [..BS]: number of times a request was redispatched to another\n     server. The server value counts the number of times that server was\n     switched away from.\n 17. status [LFBS]: status (UP/DOWN/NOLB/MAINT/MAINT(via)/MAINT(resolution)...)\n 18. weight [..BS]: total effective weight (backend), effective weight (server)\n 19. act [..BS]: number of active servers (backend), server is active (server)\n 20. bck [..BS]: number of backup servers (backend), server is backup (server)\n 21. chkfail [...S]: number of failed checks. (Only counts checks failed when\n     the server is up.)\n 22. chkdown [..BS]: number of UP->DOWN transitions. The backend counter counts\n     transitions to the whole backend being down, rather than the sum of the\n     counters for each server.\n 23. lastchg [..BS]: number of seconds since the last UP<->DOWN transition\n 24. downtime [..BS]: total downtime (in seconds). The value for the backend\n     is the downtime for the whole backend, not the sum of the server downtime.\n 25. qlimit [...S]: configured maxqueue for the server, or nothing in the\n     value is 0 (default, meaning no limit)\n 26. pid [LFBS]: process id (0 for first instance, 1 for second, ...)\n 27. iid [LFBS]: unique proxy id\n 28. sid [L..S]: server id (unique inside a proxy)\n 29. throttle [...S]: current throttle percentage for the server, when\n     slowstart is active, or no value if not in slowstart.\n 30. lbtot [..BS]: total number of times a server was selected, either for new\n     sessions, or when re-dispatching. The server counter is the number\n     of times that server was selected.\n 31. tracked [...S]: id of proxy/server if tracking is enabled.\n 32. type [LFBS]: (0=frontend, 1=backend, 2=server, 3=socket/listener)\n 33. rate [.FBS]: number of sessions per second over last elapsed second\n 34. rate_lim [.F..]: configured limit on new sessions per second\n 35. rate_max [.FBS]: max number of new sessions per second\n 36. check_status [...S]: status of last health check, one of:\n        UNK     -> unknown\n        INI     -> initializing\n        SOCKERR -> socket error\n        L4OK    -> check passed on layer 4, no upper layers testing enabled\n        L4TOUT  -> layer 1-4 timeout\n        L4CON   -> layer 1-4 connection problem, for example\n                   \"Connection refused\" (tcp rst) or \"No route to host\" (icmp)\n        L6OK    -> check passed on layer 6\n        L6TOUT  -> layer 6 (SSL) timeout\n        L6RSP   -> layer 6 invalid response - protocol error\n        L7OK    -> check passed on layer 7\n        L7OKC   -> check conditionally passed on layer 7, for example 404 with\n                   disable-on-404\n        L7TOUT  -> layer 7 (HTTP/SMTP) timeout\n        L7RSP   -> layer 7 invalid response - protocol error\n        L7STS   -> layer 7 response error, for example HTTP 5xx\n     Notice: If a check is currently running, the last known status will be\n     reported, prefixed with \"* \". e. g. \"* L7OK\".\n 37. check_code [...S]: layer5-7 code, if available\n 38. check_duration [...S]: time in ms took to finish last health check\n 39. hrsp_1xx [.FBS]: http responses with 1xx code\n 40. hrsp_2xx [.FBS]: http responses with 2xx code\n 41. hrsp_3xx [.FBS]: http responses with 3xx code\n 42. hrsp_4xx [.FBS]: http responses with 4xx code\n 43. hrsp_5xx [.FBS]: http responses with 5xx code\n 44. hrsp_other [.FBS]: http responses with other codes (protocol error)\n 45. hanafail [...S]: failed health checks details\n 46. req_rate [.F..]: HTTP requests per second over last elapsed second\n 47. req_rate_max [.F..]: max number of HTTP requests per second observed\n 48. req_tot [.FB.]: total number of HTTP requests received\n 49. cli_abrt [..BS]: number of data transfers aborted by the client\n 50. srv_abrt [..BS]: number of data transfers aborted by the server\n     (inc. in eresp)\n 51. comp_in [.FB.]: number of HTTP response bytes fed to the compressor\n 52. comp_out [.FB.]: number of HTTP response bytes emitted by the compressor\n 53. comp_byp [.FB.]: number of bytes that bypassed the HTTP compressor\n     (CPU/BW limit)\n 54. comp_rsp [.FB.]: number of HTTP responses that were compressed\n 55. lastsess [..BS]: number of seconds since last session assigned to\n     server/backend\n 56. last_chk [...S]: last health check contents or textual error\n 57. last_agt [...S]: last agent check contents or textual error\n 58. qtime [..BS]: the average queue time in ms over the 1024 last requests\n 59. ctime [..BS]: the average connect time in ms over the 1024 last requests\n 60. rtime [..BS]: the average response time in ms over the 1024 last requests\n     (0 for TCP)\n 61. ttime [..BS]: the average total session time in ms over the 1024 last\n     requests\n 62. agent_status [...S]: status of last agent check, one of:\n        UNK     -> unknown\n        INI     -> initializing\n        SOCKERR -> socket error\n        L4OK    -> check passed on layer 4, no upper layers testing enabled\n        L4TOUT  -> layer 1-4 timeout\n        L4CON   -> layer 1-4 connection problem, for example\n                   \"Connection refused\" (tcp rst) or \"No route to host\" (icmp)\n        L7OK    -> agent reported \"up\"\n        L7STS   -> agent reported \"fail\", \"stop\", or \"down\"\n 63. agent_code [...S]: numeric code reported by agent if any (unused for now)\n 64. agent_duration [...S]: time in ms taken to finish last check\n 65. check_desc [...S]: short human-readable description of check_status\n 66. agent_desc [...S]: short human-readable description of agent_status\n 67. check_rise [...S]: server's \"rise\" parameter used by checks\n 68. check_fall [...S]: server's \"fall\" parameter used by checks\n 69. check_health [...S]: server's health check value between 0 and rise+fall-1\n 70. agent_rise [...S]: agent's \"rise\" parameter, normally 1\n 71. agent_fall [...S]: agent's \"fall\" parameter, normally 1\n 72. agent_health [...S]: agent's health parameter, between 0 and rise+fall-1\n 73. addr [L..S]: address:port or \"unix\". IPv6 has brackets around the address.\n 74: cookie [..BS]: server's cookie value or backend's cookie name\n 75: mode [LFBS]: proxy mode (tcp, http, health, unknown)\n 76: algo [..B.]: load balancing algorithm\n 77: conn_rate [.F..]: number of connections over the last elapsed second\n 78: conn_rate_max [.F..]: highest known conn_rate\n 79: conn_tot [.F..]: cumulative number of connections\n 80: intercepted [.FB.]: cum. number of intercepted requests (monitor, stats)\n 81: dcon [LF..]: requests denied by \"tcp-request connection\" rules\n 82: dses [LF..]: requests denied by \"tcp-request session\" rules\n 83: wrew [LFBS]: cumulative number of failed header rewriting warnings\n 84: connect [..BS]: cumulative number of connection establishment attempts\n 85: reuse [..BS]: cumulative number of connection reuses\n 86: cache_lookups [.FB.]: cumulative number of cache lookups\n 87: cache_hits [.FB.]: cumulative number of cache hits\n 88: srv_icur [...S]: current number of idle connections available for reuse\n 89: src_ilim [...S]: limit on the number of available idle connections\n 90. qtime_max [..BS]: the maximum observed queue time in ms\n 91. ctime_max [..BS]: the maximum observed connect time in ms\n 92. rtime_max [..BS]: the maximum observed response time in ms (0 for TCP)\n 93. ttime_max [..BS]: the maximum observed total session time in ms\n 94. eint [LFBS]: cumulative number of internal errors\n 95. idle_conn_cur [...S]: current number of unsafe idle connections\n 96. safe_conn_cur [...S]: current number of safe idle connections\n 97. used_conn_cur [...S]: current number of connections in use\n 98. need_conn_est [...S]: estimated needed number of connections\n 99. uweight [..BS]: total user weight (backend), server user weight (server)\n 100. agg_server_status [..B.]: backend aggregated gauge of server's status\n 101. agg_server_status_check [..B.]: (deprecated)\n 102. agg_check_status [..B.]: backend aggregated gauge of server's state check\n      status\n 103. srid [...S]: server id revision\n 104. sess_other [.F..]: total number of sessions other than HTTP since process\n      started\n 105. h1_sess [.F..]: total number of HTTP/1 sessions since process started\n 106. h2_sess [.F..]: total number of HTTP/2 sessions since process started\n 107. h3_sess [.F..]: total number of HTTP/3 sessions since process started\n 108. req_other [.F..]: total number of sessions other than HTTP processed by\n      this object since the worker process started\n 109. h1req [.F..]: total number of HTTP/1 sessions processed by this object\n      since the worker process started\n 110. h2req [.F..]: total number of hTTP/2 sessions processed by this object\n      since the worker process started\n 111. h3req [.F..]: total number of HTTP/3 sessions processed by this object\n      since the worker process started\n 112. proto [L...]: protocol\n\nFor all other statistics domains, the presence or the order of the fields are\nnot guaranteed. In this case, the header line should always be used to parse\nthe CSV data.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "9.2. Tricks for easier configuration management", "content": "## [9.2.](#9.2)Typed output format\n\n```\nBoth \"show info\" and \"show stat\" support a mode where each output value comes\nwith its type and sufficient information to know how the value is supposed to\nbe aggregated between processes and how it evolves.\n\nIn all cases, the output consists in having a single value per line with all\nthe information split into fields delimited by colons (':').\n\nThe first column designates the object or metric being dumped. Its format is\nspecific to the command producing this output and will not be described in this\nsection. Usually it will consist in a series of identifiers and field names.\n\nThe second column contains 3 characters respectively indicating the origin, the\nnature and the scope of the value being reported. The first character (the\norigin) indicates where the value was extracted from. Possible characters are :\n\n  M   The value is a metric. It is valid at one instant any may change depending\n      on its nature .\n\n  S   The value is a status. It represents a discrete value which by definition\n      cannot be aggregated. It may be the status of a server (\"UP\" or \"DOWN\"),\n      the PID of the process, etc.\n\n  K   The value is a sorting key. It represents an identifier which may be used\n      to group some values together because it is unique among its class. All\n      internal identifiers are keys. Some names can be listed as keys if they\n      are unique (eg: a frontend name is unique). In general keys come from the\n      configuration, even though some of them may automatically be assigned. For\n      most purposes keys may be considered as equivalent to configuration.\n\n  C   The value comes from the configuration. Certain configuration values make\n      sense on the output, for example a concurrent connection limit or a cookie\n      name. By definition these values are the same in all processes started\n      from the same configuration file.\n\n  P   The value comes from the product itself. There are very few such values,\n      most common use is to report the product name, version and release date.\n      These elements are also the same between all processes.\n\nThe second character (the nature) indicates the nature of the information\ncarried by the field in order to let an aggregator decide on what operation to\nuse to aggregate multiple values. Possible characters are :\n\n  A   The value represents an age since a last event. This is a bit different\n      from the duration in that an age is automatically computed based on the\n      current date. A typical example is how long ago did the last session\n      happen on a server. Ages are generally aggregated by taking the minimum\n      value and do not need to be stored.\n\n  a   The value represents an already averaged value. The average response times\n      and server weights are of this nature. Averages can typically be averaged\n      between processes.\n\n  C   The value represents a cumulative counter. Such measures perpetually\n      increase until they wrap around. Some monitoring protocols need to tell\n      the difference between a counter and a gauge to report a different type.\n      In general counters may simply be summed since they represent events or\n      volumes. Examples of metrics of this nature are connection counts or byte\n      counts.\n\n  D   The value represents a duration for a status. There are a few usages of\n      this, most of them include the time taken by the last health check and\n      the time a server has spent down. Durations are generally not summed,\n      most of the time the maximum will be retained to compute an SLA.\n\n  G   The value represents a gauge. It's a measure at one instant. The memory\n      usage or the current number of active connections are of this nature.\n      Metrics of this type are typically summed during aggregation.\n\n  L   The value represents a limit (generally a configured one). By nature,\n      limits are harder to aggregate since they are specific to the point where\n      they were retrieved. In certain situations they may be summed or be kept\n      separate.\n\n  M   The value represents a maximum. In general it will apply to a gauge and\n      keep the highest known value. An example of such a metric could be the\n      maximum amount of concurrent connections that was encountered in the\n      product's life time. To correctly aggregate maxima, you are supposed to\n      output a range going from the maximum of all maxima and the sum of all\n      of them. There is indeed no way to know if they were encountered\n      simultaneously or not.\n\n  m   The value represents a minimum. In general it will apply to a gauge and\n      keep the lowest known value. An example of such a metric could be the\n      minimum amount of free memory pools that was encountered in the product's\n      life time. To correctly aggregate minima, you are supposed to output a\n      range going from the minimum of all minima and the sum of all of them.\n      There is indeed no way to know if they were encountered simultaneously\n      or not.\n\n  N   The value represents a name, so it is a string. It is used to report\n      proxy names, server names and cookie names. Names have configuration or\n      keys as their origin and are supposed to be the same among all processes.\n\n  O   The value represents a free text output. Outputs from various commands,\n      returns from health checks, node descriptions are of such nature.\n\n  R   The value represents an event rate. It's a measure at one instant. It is\n      quite similar to a gauge except that the recipient knows that this measure\n      moves slowly and may decide not to keep all values. An example of such a\n      metric is the measured amount of connections per second. Metrics of this\n      type are typically summed during aggregation.\n\n  T   The value represents a date or time. A field emitting the current date\n      would be of this type. The method to aggregate such information is left\n      as an implementation choice. For now no field uses this type.\n\nThe third character (the scope) indicates what extent the value reflects. Some\nelements may be per process while others may be per configuration or per system.\nThe distinction is important to know whether or not a single value should be\nkept during aggregation or if values have to be aggregated. The following\ncharacters are currently supported :\n\n  C   The value is valid for a whole cluster of nodes, which is the set of nodes\n      communicating over the peers protocol. An example could be the amount of\n      entries present in a stick table that is replicated with other peers. At\n      the moment no metric use this scope.\n\n  P   The value is valid only for the process reporting it. Most metrics use\n      this scope.\n\n  S   The value is valid for the whole service, which is the set of processes\n      started together from the same configuration file. All metrics originating\n      from the configuration use this scope. Some other metrics may use it as\n      well for some shared resources (eg: shared SSL cache statistics).\n\n  s   The value is valid for the whole system, such as the system's hostname,\n      current date or resource usage. At the moment this scope is not used by\n      any metric.\n\nConsumers of these information will generally have enough of these 3 characters\nto determine how to accurately report aggregated information across multiple\nprocesses.\n\nAfter this column, the third column indicates the type of the field, among \"s32\"\n(signed 32-bit integer), \"s64\" (signed 64-bit integer), \"u32\" (unsigned 32-bit\ninteger), \"u64\" (unsigned 64-bit integer), \"str\" (string). It is important to\nknow the type before parsing the value in order to properly read it. For example\na string containing only digits is still a string an not an integer (eg: an\nerror code extracted by a check).\n\nThen the fourth column is the value itself, encoded according to its type.\nStrings are dumped as-is immediately after the colon without any leading space.\nIf a string contains a colon, it will appear normally. This means that the\noutput should not be exclusively split around colons or some check outputs\nor server addresses might be truncated.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "9.3. Tricks for easier configuration management", "content": "## [9.3.](#9.3)Unix Socket commands\n\n```\nThe stats socket is not enabled by default. In order to enable it, it is\nnecessary to add one line in the global section of the haproxy configuration.\nA second line is recommended to set a larger timeout, always appreciated when\nissuing commands by hand :\n\n    global\n        stats socket /var/run/haproxy.sock mode 600 level admin\n        stats timeout 2m\n\nIt is also possible to add multiple instances of the stats socket by repeating\nthe line, and make them listen to a TCP port instead of a UNIX socket. This is\nnever done by default because this is dangerous, but can be handy in some\nsituations :\n\n    global\n        stats socket /var/run/haproxy.sock mode 600 level admin\n        stats socket ipv4@192.168.0.1:9999 level admin\n        stats timeout 2m\n\nTo access the socket, an external utility such as \"socat\" is required. Socat is\na swiss-army knife to connect anything to anything. We use it to connect\nterminals to the socket, or a couple of stdin/stdout pipes to it for scripts.\nThe two main syntaxes we'll use are the following :\n\n    # socat /var/run/haproxy.sock stdio\n    # socat /var/run/haproxy.sock readline\n\nThe first one is used with scripts. It is possible to send the output of a\nscript to haproxy, and pass haproxy's output to another script. That's useful\nfor retrieving counters or attack traces for example.\n\nThe second one is only useful for issuing commands by hand. It has the benefit\nthat the terminal is handled by the readline library which supports line\nediting and history, which is very convenient when issuing repeated commands\n(eg: watch a counter).\n\nThe socket supports three operation modes :\n  - non-interactive, silent\n  - interactive, silent\n  - interactive with prompt\n\nThe non-interactive mode is the default when socat connects to the socket. In\nthis mode, a single line may be sent. It is processed as a whole, responses are\nsent back, and the connection closes after the end of the response. This is the\nmode that scripts and monitoring tools use. It is possible to send multiple\ncommands in this mode, they need to be delimited by a semi-colon (';'). For\nexample :\n\n    # echo \"show info;show stat;show table\" | socat /var/run/haproxy stdio\n\nIf a command needs to use a semi-colon or a backslash (eg: in a value), it\nmust be preceded by a backslash ('\\').\n\nThe interactive mode allows new commands to be sent after the ones from the\nprevious lines finish. It exists in two variants, one silent, which works like\nthe non-interactive mode except that the socket waits for a new command instead\nof closing, and one where a prompt is displayed ('>') at the beginning of the\nline. The interactive mode is preferred for advanced tools while the prompt\nmode is preferred for humans.\n\nThe mode can be changed using the \"promptThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" command. By default, it toggles the\ninteractive+prompt modes. Entering \"promptThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" in interactive mode will switch to\nprompt mode. The command optionally takes a specific mode among which:\n\n  - \"n\" : non-interactive mode (single command and quits)\n  - \"i\" : interactive mode (multiple commands, no prompt)\n  - \"p\" : prompt mode (multiple commands with a prompt)\n\nSince the default mode is non-interactive, \"promptThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" must be used as the first\ncommand in order to switch it, otherwise the previous command will cause the\nconnection to be closed. Switching to non-interactive mode will result in the\nconnection to be closed after all the commands of the same line complete.\n\nFor this reason, when debugging by hand, it's quite common to start with the\n\"promptThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" command :\n\n   # socat /var/run/haproxy readline\n   prompt\n   > show info\n   ...\n   >\n\nInteractive tools might prefer starting with \"prompt i\" to switch to interactive\nmode without the prompt.\n\nOptionally the process' uptime may be displayed in the prompt. In order to\nenable this, the \"prompt timed\" command will enable the prompt and toggle the\ndisplaying of the time. The uptime is displayed in format \"d:hh:mm:ss\" where\n\"d\" is the number of days, and \"hh\", \"mm\", \"ss\" are respectively the number\nof hours, minutes and seconds on two digits each:\n\n   # socat /var/run/haproxy readline\n   prompt timed\n\n   [23:03:34:39]> show version\n   2.8-dev9-e5e622-18\n\n   [23:03:34:41]> quit\n\nWhen the timed prompt is set on the master CLI, the prompt will display the\ncurrently selected process' uptime, so this will work for the master, current\nworker or an older worker:\n\n  master> prompt timed\n  [0:00:00:50] master> show proc\n  (...)\n  [0:00:00:58] master> @!11955     <-- master, switch to current worker\n  [0:00:01:03] 11955> @!11942      <-- current worker, switch to older worker\n  [0:00:02:17] 11942> @            <-- older worker, switch back to master\n  [0:00:01:10] master>\n\nSince multiple commands may be issued at once, haproxy uses the empty line as a\ndelimiter to mark an end of output for each command, and takes care of ensuring\nthat no command can emit an empty line on output. A script can thus easily\nparse the output even when multiple commands were pipelined on a single line.\n\nSome commands may take an optional payload. To add one to a command, the first\nline needs to end with the \"<<\\n\" pattern. The next lines will be treated as\nthe payload and can contain as many lines as needed. To validate a command with\na payload, it needs to end with an empty line.\n\nThe payload pattern can be customized in order to change the way the payload\nends. In order to end a payload with something else than an empty line, a\ncustomized pattern can be set between '<<' and '\\n'. Only 7 characters can be\nused in addiction to '<<', otherwise this won't be considered a payload.\nFor example, to use a PEM file that contains empty lines and comments:\n\n  # echo -e \"set ssl cert common.pem <<%EOF%\\n$(cat common.pem)\\n%EOF%\\n\" | \\\n  socat /var/run/haproxy.stat -\n\nLimitations do exist: the length of the whole buffer passed to the CLI must\nnot be greater than tune.bfsize and the pattern \"<<\" must not be glued to the\nlast word of the line.\n\nWhen entering a payload while in interactive mode, the prompt will change from\n\"> \" to \"+ \".\n\nIt is important to understand that when multiple haproxy processes are started\non the same sockets, any process may pick up the request and will output its\nown stats.\n\nThe list of commands currently supported on the stats socket is provided below.\nIf an unknown command is sent, haproxy displays the usage message which reminds\nall supported commands. Some commands support a more complex syntax, generally\nit will explain what part of the command is invalid when this happens.\n\nSome commands require a higher level of privilege to work. If you do not have\nenough privilege, you will get an error \"Permission denied\". Please check\nthe \"level\" option of the \"bind\" keyword lines in the configuration manual\nfor more information.\n\n```\n\n**[abort ssl ca-file](#9.3-abort%20ssl%20ca-file)**<cafile>```\nAbort and destroy a temporary CA file update transaction.\n\nSee also \"set ssl ca-file\" and \"commit ssl ca-file\".\n\n```\n\n**[abort ssl cert](#9.3-abort%20ssl%20cert)**<filename>```\nAbort and destroy a temporary SSL certificate update transaction.\n\nSee also \"set ssl cert\" and \"commit ssl cert\".\n\n```\n\n**[abort ssl crl-file](#9.3-abort%20ssl%20crl-file)**<crlfile>```\nAbort and destroy a temporary CRL file update transaction.\n\nSee also \"set ssl crl-file\" and \"commit ssl crl-file\".\n\n```\n\n**[acme renew](#9.3-acme%20renew)**<certificate>```\nStarts an ACME certificate generation task with the given certificate name.\nThe certificate must be linked to an acme section, see section 12.8 \"ACME\"\nof the configuration manual. See also \"acme status\".\n\n```\n\n**[acme status](#9.3-acme%20status)**```\nShow the status of every certificates that were configured with ACME.\n\nThis command outputs, separated by a tab:\n- The name of the certificate configured in haproxy\n- The acme section used in the configuration\n- The state of the acme task, either \"Running\", \"Scheduled\" or \"Stopped\"\n- The UTC expiration date of the certificate in ISO8601 format\n- The relative expiration time (0d if expired)\n- The UTC scheduled date of the certificate in ISO8601 format\n- The relative schedule time (0d if Running)\n\n```\n\nExample:```\n\n$ echo \"@1; acme status\" | socat /tmp/master.sock - | column -t -s $'\\t'\n# certificate   section  state      expiration date (UTC)  expires in        scheduled date (UTC)  scheduled in\necdsa.pem       LE       Running    2020-01-18T09:31:12Z   0d 0h00m00s       2020-01-15T21:31:12Z  0d 0h00m00s\nfoobar.pem.rsa  LE       Scheduled  2025-08-04T11:50:54Z   89d 23h01m13s     2025-07-27T23:50:55Z  82d 11h01m14s\n\n```\n\n**[add acl](#9.3-add%20acl)**[@<ver>]<acl><pattern>```\nAdd an entry into the acl <acl>. <acl> is the #<id> or the <name> returned by\n\"show acl\". This command does not verify if the entry already exists. Entries\nare added to the current version of the ACL, unless a specific version is\nspecified with \"@<ver>\". This version number must have preliminary been\nallocated by \"prepare acl\", and it will be comprised between the versions\nreported in \"curr_ver\" and \"next_ver\" on the output of \"show acl\". Entries\nadded with a specific version number will not match until a \"commit acl\"\noperation is performed on them. They may however be consulted using the\n\"show acl @<ver>\" command, and cleared using a \"clear acl @<ver>\" command.\nThis command cannot be used if the reference <acl> is a name also used with\na map. In this case, the \"add map\" command must be used instead.\n\n```\n\n**[add map](#9.3-add%20map)**[@<ver>]<map><key><value>**[add map](#9.3-add%20map)**[@<ver>]<map><payload>```\nAdd an entry into the map <map> to associate the value <value> to the key\n<key>. This command does not verify if the entry already exists. It is\nmainly used to fill a map after a \"clear\" or \"prepare\" operation. Entries\nare added to the current version of the ACL, unless a specific version is\nspecified with \"@<ver>\". This version number must have preliminary been\nallocated by \"prepare acl\", and it will be comprised between the versions\nreported in \"curr_ver\" and \"next_ver\" on the output of \"show acl\". Entries\nadded with a specific version number will not match until a \"commit map\"\noperation is performed on them. They may however be consulted using the\n\"show map @<ver>\" command, and cleared using a \"clear acl @<ver>\" command.\nIf the designated map is also used as an ACL, the ACL will only match the\n<key> part and will ignore the <value> part. Using the payload syntax it is\npossible to add multiple key/value pairs by entering them on separate lines.\nOn each new line, the first word is the key and the rest of the line is\nconsidered to be the value which can even contains spaces.\n\n```\n\nExample:```\n\n# socat /tmp/sock1 -\nprompt\n\n> add map #-1 <<\n+ key1 value1\n+ key2 value2 with spaces\n+ key3 value3 also with spaces\n+ key4 value4\n\n>\n\n```\n\n**[add server](#9.3-add%20server)**<backend>/<server>[args]*```\nInstantiate a new server attached to the backend <backend>.\n\nThe <server> name must not be already used in the backend. A special\nrestriction is put on the backend which must used a dynamic load-balancing\nalgorithm. A subset of keywords from the server config file statement can be\nused to configure the server behavior (see \"add server help\" to list them).\nAlso note that no settings will be reused from an hypothetical\n'default-server' statement in the same backend.\n\nCurrently a dynamic server is statically initialized with the \"none\"\ninit-addr method. This means that no resolution will be undertaken if a FQDN\nis specified as an address, even if the server creation will be validated.\n\nTo support the reload operations, it is expected that the server created via\nthe CLI is also manually inserted in the relevant haproxy configuration file.\nA dynamic server not present in the configuration won't be restored after a\nreload operation.\n\nA dynamic server may use the \"track\" keyword to follow the check status of\nanother server from the configuration. However, it is not possible to track\nanother dynamic server. This is to ensure that the tracking chain is kept\nconsistent even in the case of dynamic servers deletion.\n\nUse the \"check\" keyword to enable health-check support. Note that the\nhealth-check is disabled by default and must be enabled independently from\nthe server using the \"enable health\" command. For agent checks, use the\n\"agent-check\" keyword and the \"enable agent\" command. Note that in this case\nthe server may be activated via the agent depending on the status reported,\nwithout an explicit \"enable server\" command. This also means that extra care\nis required when removing a dynamic server with agent check. The agent should\nbe first deactivated via \"disable agent\" to be able to put the server in the\nrequired maintenance mode before removal.\n\nIt may be possible to reach the fd limit when using a large number of dynamic\nservers. Please refer to the \"u-limit\" global keyword documentation in this\ncase.\n\n```\n\n**[add server help](#9.3-add%20server%20help)**```\nList the keywords supported for dynamic servers by the current haproxy\nversion. Keyword syntax is similar to the server line from the configuration\nfile, please refer to their individual documentation for details.\n\n```\n\n**[add ssl ca-file](#9.3-add%20ssl%20ca-file)**<cafile><payload>Add a new certificate to a ca-file. This command is useful when you reached the buffer size limit on the CLI and want to add multiple certificates. Instead of doing a \"[set](#set)\" with all the certificates you are able to add each certificate individually. A \"[set ssl ca-file](#set%20ssl%20ca-file)\" will reset the ca-file.Example:```\n\necho -e \"set ssl ca-file cafile.pem <<\\n$(cat rootCA.crt)\\n\" | \\\nsocat /var/run/haproxy.stat -\necho -e \"add ssl ca-file cafile.pem <<\\n$(cat intermediate1.crt)\\n\" | \\\nsocat /var/run/haproxy.stat -\necho -e \"add ssl ca-file cafile.pem <<\\n$(cat intermediate2.crt)\\n\" | \\\nsocat /var/run/haproxy.stat -\necho \"commit ssl ca-file cafile.pem\" | socat /var/run/haproxy.stat -\n\n```\n\n**[add ssl crt-list](#9.3-add%20ssl%20crt-list)**<crtlist><certificate>**[add ssl crt-list](#9.3-add%20ssl%20crt-list)**<crtlist><payload>```\nAdd an certificate in a crt-list. It can also be used for directories since\ndirectories are now loaded the same way as the crt-lists. This command allow\nyou to use a certificate name in parameter, to use SSL options or filters a\ncrt-list line must sent as a payload instead. Only one crt-list line is\nsupported in the payload. This command will load the certificate for every\nbind lines using the crt-list. To push a new certificate to HAProxy the\ncommands \"new ssl cert\" and \"set ssl cert\" must be used.\n\n```\n\nExample:```\n\n$ echo \"new ssl cert foobar.pem\" | socat /tmp/sock1 -\n$ echo -e \"set ssl cert foobar.pem <<\\n$(cat foobar.pem)\\n\" | socat\n/tmp/sock1 -\n$ echo \"commit ssl cert foobar.pem\" | socat /tmp/sock1 -\n$ echo \"add ssl crt-list certlist1 foobar.pem\" | socat /tmp/sock1 -\n\n$ echo -e 'add ssl crt-list certlist1 <<\\nfoobar.pem [allow-0rtt] foo.bar.com\n!test1.com\\n' | socat /tmp/sock1 -\n\n```\n\n**[clear counters](#9.3-clear%20counters)**```\nClear the max values of the statistics counters in each proxy (frontend &\nbackend) and in each server. The accumulated counters are not affected. The\ninternal activity counters reported by \"show activity\" are also reset. This\ncan be used to get clean counters after an incident, without having to\nrestart nor to clear traffic counters. This command is restricted and can\nonly be issued on sockets configured for levels \"operator\" or \"admin\".\n\n```\n\n**[clear counters all](#9.3-clear%20counters%20all)**```\nClear all statistics counters in each proxy (frontend & backend) and in each\nserver. This has the same effect as restarting. This command is restricted\nand can only be issued on sockets configured for level \"admin\".\n\n```\n\n**[clear acl](#9.3-clear%20acl)**[@<ver>]<acl>```\nRemove all entries from the acl <acl>. <acl> is the #<id> or the <name>\nreturned by \"show acl\". Note that if the reference <acl> is a name and is\nshared with a map, this map will be also cleared. By default only the current\nversion of the ACL is cleared (the one being matched against). However it is\npossible to specify another version using '@' followed by this version.\n\n```\n\n**[clear map](#9.3-clear%20map)**[@<ver>]<map>```\nRemove all entries from the map <map>. <map> is the #<id> or the <name>\nreturned by \"show map\". Note that if the reference <map> is a name and is\nshared with a acl, this acl will be also cleared. By default only the current\nversion of the map is cleared (the one being matched against). However it is\npossible to specify another version using '@' followed by this version.\n\n```\n\n**[clear table](#9.3-clear%20table)**<table>[ data.<type><operator><value>]|[ key<key>]|[ ptr<ptr>]```\nRemove entries from the stick-table <table>.\n\nThis is typically used to unblock some users complaining they have been\nabusively denied access to a service, but this can also be used to clear some\nstickiness entries matching a server that is going to be replaced (see \"show\ntable\" below for details).  Note that sometimes, removal of an entry will be\nrefused because it is currently tracked by a session. Retrying a few seconds\nlater after the session ends is usual enough.\n\nIn the case where no options arguments are given all entries will be removed.\n\nWhen the \"data.\" form is used entries matching a filter applied using the\nstored data (see \"stick-table\" in section 4.2) are removed.  A stored data\ntype must be specified in <type>, and this data type must be stored in the\ntable otherwise an error is reported. The data is compared according to\n<operator> with the 64-bit integer <value>.  Operators are the same as with\nthe ACLs :\n\n  - eq : match entries whose data is equal to this value\n  - ne : match entries whose data is not equal to this value\n  - le : match entries whose data is less than or equal to this value\n  - ge : match entries whose data is greater than or equal to this value\n  - lt : match entries whose data is less than this value\n  - gt : match entries whose data is greater than this value\n\nWhen the key form is used the entry <key> is removed.  The key must be of the\nsame type as the table, which currently is limited to IPv4, IPv6, integer and\nstring.\n\nWhen the ptr form is used the entry <ptr> is removed. <ptr> is written in\nthe form 0xffff and must correspond to the address returned by a previous\n\"show table\" command. Matching an entry using its pointer may be relevant if\nthe entry cannot be matched using the key due to empty key or incompatible\ncharacters on the cli.\n\nIf data.<type> is an array type, \"[]\" may be used to access a specific\nindex in the array, like so: data.gpt[1]\n\n```\n\nExample :```\n\n    $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n>>> # table: http_proxy, type: ip, size:204800, used:2\n>>> 0x80e6a4c: key=127.0.0.1 use=0 exp=3594729 gpc0=0 conn_rate(30000)=1 \\\n      bytes_out_rate(60000)=187\n>>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n>>> 0x80e6b40: key=127.0.0.3 use=0 exp=3594743 gpc0=2 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=200\n\n    $ echo \"clear table http_proxy key 127.0.0.1\" | socat stdio /tmp/sock1\n\n    $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n>>> # table: http_proxy, type: ip, size:204800, used:1\n>>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n>>> 0x80e6b40: key=127.0.0.3 use=0 exp=3594743 gpc0=2 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=200\n      bytes_out_rate(60000)=191\n    $ echo \"clear table http_proxy data.gpc0 eq 1\" | socat stdio /tmp/sock1\n    $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n>>> # table: http_proxy, type: ip, size:204800, used:1\n>>> 0x80e6b40: key=127.0.0.3 use=0 exp=3594743 gpc0=2 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=200\n\n    $ echo \"clear table http_proxy ptr 0x80e6b40\" | socat stdio /tmp/sock1\n    $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n>>> # table: http_proxy, type: ip, size:204800, used:0\n\n```\n\n```\ncommit acl @<ver> <acl>\n  Commit all changes made to version <ver> of ACL <acl>, and deletes all past\n  versions. <acl> is the #<id> or the <name> returned by \"show acl\". The\n  version number must be between \"curr_ver\"+1 and \"next_ver\" as reported in\n  \"show acl\". The contents to be committed to the ACL can be consulted with\n  \"show acl @<ver> <acl>\" if desired. The specified version number has normally\n  been created with the \"prepare acl\" command. The replacement is atomic. It\n  consists in atomically updating the current version to the specified version,\n  which will instantly cause all entries in other versions to become invisible,\n  and all entries in the new version to become visible. It is also possible to\n  use this command to perform an atomic removal of all visible entries of an\n  ACL by calling \"prepare acl\" first then committing without adding any\n  entries. This command cannot be used if the reference <acl> is a name also\n  used as a map. In this case, the \"commit map\" command must be used instead.\n\ncommit map @<ver> <map>\n  Commit all changes made to version <ver> of map <map>, and deletes all past\n  versions. <map> is the #<id> or the <name> returned by \"show map\". The\n  version number must be between \"curr_ver\"+1 and \"next_ver\" as reported in\n  \"show map\". The contents to be committed to the map can be consulted with\n  \"show map @<ver> <map>\" if desired. The specified version number has normally\n  been created with the \"prepare map\" command. The replacement is atomic. It\n  consists in atomically updating the current version to the specified version,\n  which will instantly cause all entries in other versions to become invisible,\n  and all entries in the new version to become visible. It is also possible to\n  use this command to perform an atomic removal of all visible entries of an\n  map by calling \"prepare map\" first then committing without adding any\n  entries.\n\n```\n\n**[commit ssl ca-file](#9.3-commit%20ssl%20ca-file)**<cafile>```\nCommit a temporary SSL CA file update transaction.\n\nIn the case of an existing CA file (in a \"Used\" state in \"show ssl ca-file\"),\nthe new CA file tree entry is inserted in the CA file tree and every instance\nthat used the CA file entry is rebuilt, along with the SSL contexts it needs.\nAll the contexts previously used by the rebuilt instances are removed.\nUpon success, the previous CA file entry is removed from the tree.\nUpon failure, nothing is removed or deleted, and all the original SSL\ncontexts are kept and used.\nOnce the temporary transaction is committed, it is destroyed.\n\nIn the case of a new CA file (after a \"new ssl ca-file\" and in a \"Unused\"\nstate in \"show ssl ca-file\"), the CA file will be inserted in the CA file\ntree but it won't be used anywhere in HAProxy. To use it and generate SSL\ncontexts that use it, you will need to add it to a crt-list with \"add ssl\ncrt-list\".\n\nSee also \"new ssl ca-file\", \"set ssl ca-file\", \"add ssl ca-file\",\n\"abort ssl ca-file\" and \"add ssl crt-list\".\n\n```\n\n**[commit ssl cert](#9.3-commit%20ssl%20cert)**<filename>```\nCommit a temporary SSL certificate update transaction.\n\nIn the case of an existing certificate (in a \"Used\" state in \"show ssl\ncert\"), generate every SSL contexts and SNIs it needs, insert them, and\nremove the previous ones. Replace in memory the previous SSL certificates\neverywhere the <filename> was used in the configuration. Upon failure it\ndoesn't remove or insert anything. Once the temporary transaction is\ncommitted, it is destroyed.\n\nIn the case of a new certificate (after a \"new ssl cert\" and in a \"Unused\"\nstate in \"show ssl cert\"), the certificate will be committed in a certificate\nstorage, but it won't be used anywhere in haproxy. To use it and generate\nits SNIs you will need to add it to a crt-list or a directory with \"add ssl\ncrt-list\".\n\nSee also \"new ssl cert\", \"set ssl cert\", \"abort ssl cert\" and\n\"add ssl crt-list\".\n\n```\n\n**[commit ssl crl-file](#9.3-commit%20ssl%20crl-file)**<crlfile>```\nCommit a temporary SSL CRL file update transaction.\n\nIn the case of an existing CRL file (in a \"Used\" state in \"show ssl\ncrl-file\"), the new CRL file entry is inserted in the CA file tree (which\nholds both the CA files and the CRL files) and every instance that used the\nCRL file entry is rebuilt, along with the SSL contexts it needs.\nAll the contexts previously used by the rebuilt instances are removed.\nUpon success, the previous CRL file entry is removed from the tree.\nUpon failure, nothing is removed or deleted, and all the original SSL\ncontexts are kept and used.\nOnce the temporary transaction is committed, it is destroyed.\n\nIn the case of a new CRL file (after a \"new ssl crl-file\" and in a \"Unused\"\nstate in \"show ssl crl-file\"), the CRL file will be inserted in the CRL file\ntree but it won't be used anywhere in HAProxy. To use it and generate SSL\ncontexts that use it, you will need to add it to a crt-list with \"add ssl\ncrt-list\".\n\nSee also \"new ssl crl-file\", \"set ssl crl-file\", \"abort ssl crl-file\" and\n\"add ssl crt-list\".\n\n```\n\n**[debug counters](#9.3-debug%20counters)**[reset|show|on|off|all|bug|chk|cnt|glt|?]*```\nList internal counters placed in the code, which may vary depending on some\nbuild options. Some of them depend on DEBUG_STRICT, others on DEBUG_COUNTERS.\nThe command takes a combination of multiple arguments, some defining actions\nand others defining filters:\n  - bug     enables listing the counters for BUG_ON() statements\n  - cnt     enables listing the counters for COUNT_IF() statements\n  - chk     enables listing the counters for CHECK_IF() statements\n  - glt     enables listing the counters for COUNT_GLITCH() statements\n  - all     enables showing counters that never triggered (value 0)\n  - off     action: disables updating of the COUNT_IF() counters\n  - on      action: enables updating of the COUNT_IF() counters\n  - reset   action: resets all specified counters\n  - show    action: shows all specified counters\n\nBy default, the action is \"showThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" to show counters, and the listed counters\nare all types with a non-zero value. The \"showThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" command is implicit when no\nother action is specified, and is only present to ease the production of\ncommands from scripts.\n\nThe output starts with an integer counter, followed by the type of the\ncounter in upper case, then its location in the code (file:line), the\nfunction name, and optionally \": \" followed by a description. Please note\nthat the output format might change between major versions, and new types\nand entries might be backported to stable versions for the purpose of\nimproved debugging capabilities. Any monitoring performed on them should\nonly be done in a very lenient and permissive way, and preferably not.\n\nNormally, end users will not use this command, but they may be invited to do\nso by a developer trying to figure the cause of an issue, looking for CNT or\nGLT entries. By the way, non-zero \"CHK\" entries are not expected to happen\nand should be reported to developers as they might indicate some incorrect\nassumptions in the code.\n\n```\n\n**[debug dev](#9.3-debug%20dev)**<command>[args]*```\nCall a developer-specific command. Only supported on a CLI connection running\nin expert mode (see \"expert-mode on\"). Such commands are extremely dangerous\nand not forgiving, any misuse may result in a crash of the process. They are\nintended for experts only, and must really not be used unless told to do so.\nSome of them are only available when haproxy is built with DEBUG_DEV defined\nbecause they may have security implications. All of these commands require\nadmin privileges, and are purposely not documented to avoid encouraging their\nuse by people who are not at ease with the source code.\n\n```\n\n**[del acl](#9.3-del%20acl)**<acl>[<key>|#<ref>]```\nDelete all the acl entries from the acl <acl> corresponding to the key <key>.\n<acl> is the #<id> or the <name> returned by \"show acl\". If the <ref> is used,\nthis command delete only the listed reference. The reference can be found with\nlisting the content of the acl. Note that if the reference <acl> is a name and\nis shared with a map, the entry will be also deleted in the map.\n\n```\n\n**[del map](#9.3-del%20map)**<map>[<key>|#<ref>]```\nDelete all the map entries from the map <map> corresponding to the key <key>.\n<map> is the #<id> or the <name> returned by \"show map\". If the <ref> is used,\nthis command delete only the listed reference. The reference can be found with\nlisting the content of the map. Note that if the reference <map> is a name and\nis shared with a acl, the entry will be also deleted in the map.\n\n```\n\n**[del ssl ca-file](#9.3-del%20ssl%20ca-file)**<cafile>```\nDelete a CA file tree entry from HAProxy. The CA file must be unused and\nremoved from any crt-list. \"show ssl ca-file\" displays the status of the CA\nfiles. The deletion doesn't work with a certificate referenced directly with\nthe \"ca-file\" or \"ca-verify-file\" directives in the configuration.\n\n```\n\n**[del ssl cert](#9.3-del%20ssl%20cert)**<certfile>```\nDelete a certificate store from HAProxy. The certificate must be unused and\nremoved from any crt-list or directory. \"show ssl cert\" displays the status\nof the certificate. The deletion doesn't work with a certificate referenced\ndirectly with the \"crt\" directive in the configuration.\n\n```\n\n**[del ssl crl-file](#9.3-del%20ssl%20crl-file)**<crlfile>```\nDelete a CRL file tree entry from HAProxy. The CRL file must be unused and\nremoved from any crt-list. \"show ssl crl-file\" displays the status of the CRL\nfiles. The deletion doesn't work with a certificate referenced directly with\nthe \"crl-file\" directive in the configuration.\n\n```\n\n**[del ssl crt-list](#9.3-del%20ssl%20crt-list)**<filename><certfile[:line]>```\nDelete an entry in a crt-list. This will delete every SNIs used for this\nentry in the frontends. If a certificate is used several time in a crt-list,\nyou will need to provide which line you want to delete. To display the line\nnumbers, use \"show ssl crt-list -n <crtlist>\".\n\n```\n\n**[del server](#9.3-del%20server)**<backend>/<server>```\nRemove a server attached to the backend <backend>. All servers are eligible,\nexcept servers which are referenced by other configuration elements. The\nserver must be put in maintenance mode prior to its deletion.  The operation\nis cancelled if the server still has active or idle connection or its\nconnection queue is not empty.\n\n```\n\n**[disable agent](#9.3-disable%20agent)**<backend>/<server>```\nMark the auxiliary agent check as temporarily stopped.\n\nIn the case where an agent check is being run as a auxiliary check, due\nto the agent-check parameter of a server directive, new checks are only\ninitialized when the agent is in the enabled. Thus, disable agent will\nprevent any new agent checks from begin initiated until the agent\nre-enabled using enable agent.\n\nWhen an agent is disabled the processing of an auxiliary agent check that\nwas initiated while the agent was set as enabled is as follows: All\nresults that would alter the weight, specifically \"drain\" or a weight\nreturned by the agent, are ignored. The processing of agent check is\notherwise unchanged.\n\nThe motivation for this feature is to allow the weight changing effects\nof the agent checks to be paused to allow the weight of a server to be\nconfigured using set weight without being overridden by the agent.\n\nThis command is restricted and can only be issued on sockets configured for\nlevel \"admin\".\n\n```\n\n**[disable dynamic-cookie backend](#9.3-disable%20dynamic-cookie%20backend)**<backend>```\nDisable the generation of dynamic cookies for the backend <backend>\n\n```\n\n**[disable frontend](#9.3-disable%20frontend)**<frontend>```\nMark the frontend as temporarily stopped. This corresponds to the mode which\nis used during a soft restart : the frontend releases the port but can be\nenabled again if needed. This should be used with care as some non-Linux OSes\nare unable to enable it back. This is intended to be used in environments\nwhere stopping a proxy is not even imaginable but a misconfigured proxy must\nbe fixed. That way it's possible to release the port and bind it into another\nprocess to restore operations. The frontend will appear with status \"STOP\"\non the stats page.\n\nThe frontend may be specified either by its name or by its numeric ID,\nprefixed with a sharp ('#').\n\nThis command is restricted and can only be issued on sockets configured for\nlevel \"admin\".\n\n```\n\n**[disable health](#9.3-disable%20health)**<backend>/<server>```\nMark the primary health check as temporarily stopped. This will disable\nsending of health checks, and the last health check result will be ignored.\nThe server will be in unchecked state and considered UP unless an auxiliary\nagent check forces it down.\n\nThis command is restricted and can only be issued on sockets configured for\nlevel \"admin\".\n\n```\n\n**[disable server](#9.3-disable%20server)**<backend>/<server>```\nMark the server DOWN for maintenance. In this mode, no more checks will be\nperformed on the server until it leaves maintenance.\nIf the server is tracked by other servers, those servers will be set to DOWN\nduring the maintenance.\n\nIn the statistics page, a server DOWN for maintenance will appear with a\n\"MAINT\" status, its tracking servers with the \"MAINT(via)\" one.\n\nBoth the backend and the server may be specified either by their name or by\ntheir numeric ID, prefixed with a sharp ('#').\n\nThis command is restricted and can only be issued on sockets configured for\nlevel \"admin\".\n\n```\n\n**[dump ssl cert](#9.3-dump%20ssl%20cert)**<certfile>```\nDump a certificate loaded into HAProxy memory. This will dump the certificate\nin PEM format, the private key, then the leaf certificate and finally the\nchain will be dumped. You can also dump a transaction by prefixing the\nfilename by an asterisk.\nThis is useful in order to save certificates on the filesystem when it was\nupdated on the CLI and not on the filesystem.\n\nThis command is restricted and can only be issued on sockets configured for\nlevel \"admin\".\n\n```\n\nExamples:```\n\n$ echo \"dump ssl cert cert1.pem\" | socat /tmp/sock1 -\n\n```\n\n```\n$ echo \"dump ssl cert cert1.pem\" | socat /tmp/sock1 - | openssl storeutl -noout -text /dev/stdin\n\n```\n\n**[dump stats-file](#9.3-dump%20stats-file)**```\nGenerate a stats-file which can be used to preload haproxy counters values on\nstartup. See \"Stats-file\" section for more detail.\n\n```\n\n**[echo](#9.3-echo)**<text>```\nPrint some text with the CLI. Can be useful to wrote commentaries between\ncommands when dumping the result of multiple commands.\n\n```\n\nExample:```\n\necho \"expert-mode on; echo FDs from fdtab; show fd; echo wild FDs; debug dev fd\" | socat /var/run/haproxy.sock -\n\n```\n\n**[enable agent](#9.3-enable%20agent)**<backend>/<server>```\nResume auxiliary agent check that was temporarily stopped.\n\nSee \"disable agent\" for details of the effect of temporarily starting\nand stopping an auxiliary agent.\n\nThis command is restricted and can only be issued on sockets configured for\nlevel \"admin\".\n\n```\n\n**[enable dynamic-cookie backend](#9.3-enable%20dynamic-cookie%20backend)**<backend>```\nEnable the generation of dynamic cookies for the backend <backend>.\nA secret key must also be provided.\n\n```\n\n**[enable frontend](#9.3-enable%20frontend)**<frontend>```\nResume a frontend which was temporarily stopped. It is possible that some of\nthe listening ports won't be able to bind anymore (eg: if another process\ntook them since the 'disable frontend' operation). If this happens, an error\nis displayed. Some operating systems might not be able to resume a frontend\nwhich was disabled.\n\nThe frontend may be specified either by its name or by its numeric ID,\nprefixed with a sharp ('#').\n\nThis command is restricted and can only be issued on sockets configured for\nlevel \"admin\".\n\n```\n\n**[enable health](#9.3-enable%20health)**<backend>/<server>```\nResume a primary health check that was temporarily stopped. This will enable\nsending of health checks again. Please see \"disable health\" for details.\n\nThis command is restricted and can only be issued on sockets configured for\nlevel \"admin\".\n\n```\n\n**[enable server](#9.3-enable%20server)**<backend>/<server>```\nIf the server was previously marked as DOWN for maintenance, this marks the\nserver UP and checks are re-enabled.\n\nBoth the backend and the server may be specified either by their name or by\ntheir numeric ID, prefixed with a sharp ('#').\n\nThis command is restricted and can only be issued on sockets configured for\nlevel \"admin\".\n\n```\n\n**[experimental-mode](#9.3-experimental-mode)**[on|off]```\nWithout options, this indicates whether the experimental mode is enabled or\ndisabled on the current connection. When passed \"on\", it turns the\nexperimental mode on for the current CLI connection only. With \"off\" it turns\nit off.\n\nThe experimental mode is used to access to extra features still in\ndevelopment. These features are currently not stable and should be used with\ncare. They may be subject to breaking changes across versions.\n\nWhen used from the master CLI, this command shouldn't be prefixed, as it will\nset the mode for any worker when connecting to its CLI.\n\n```\n\nExample:```\n\necho \"@1; experimental-mode on; <experimental_cmd>...\" | socat /var/run/haproxy.master -\necho \"experimental-mode on; @1 <experimental_cmd>...\" | socat /var/run/haproxy.master -\n\n```\n\n**[expert-mode](#9.3-expert-mode)**[on|off]```\nThis command is similar to experimental-mode but is used to toggle the\nexpert mode.\n\nThe expert mode enables displaying of expert commands that can be extremely\ndangerous for the process and which may occasionally help developers collect\nimportant information about complex bugs. Any misuse of these features will\nlikely lead to a process crash. Do not use this option without being invited\nto do so. Note that this command is purposely not listed in the help message.\nThis command is only accessible in admin level. Changing to another level\nautomatically resets the expert mode.\n\nWhen used from the master CLI, this command shouldn't be prefixed, as it will\nset the mode for any worker when connecting to its CLI.\n\n```\n\nExample:```\n\necho \"@1; expert-mode on; debug dev exit 1\" | socat /var/run/haproxy.master -\necho \"expert-mode on; @1 debug dev exit 1\" | socat /var/run/haproxy.master -\n\n```\n\n**[get map](#9.3-get%20map)**<map><value>**[get acl](#9.3-get%20acl)**<acl><value>```\nLookup the value <value> in the map <map> or in the ACL <acl>. <map> or <acl>\nare the #<id> or the <name> returned by \"show map\" or \"show acl\". This command\nreturns all the matching patterns associated with this map. This is useful for\ndebugging maps and ACLs. The output format is composed by one line par\nmatching type. Each line is composed by space-delimited series of words.\n\nThe first two words are:\n\n   <match method>:   The match method applied. It can be \"found\", \"bool\",\n                     \"int\", \"ip\", \"bin\", \"len\", \"str\", \"beg\", \"sub\", \"dir\",\n                     \"dom\", \"end\" or \"reg\".\n\n   <match result>:   The result. Can be \"match\" or \"no-match\".\n\nThe following words are returned only if the pattern matches an entry.\n\n   <index type>:     \"tree\" or \"list\". The internal lookup algorithm.\n\n   <case>:           \"case-insensitive\" or \"case-sensitive\". The\n                     interpretation of the case.\n\n   <entry matched>:  match=\"<entry>\". Return the matched pattern. It is\n                     useful with regular expressions.\n\nThe two last word are used to show the returned value and its type. With the\n\"acl\" case, the pattern doesn't exist.\n\n   return=nothing:        No return because there are no \"map\".\n   return=\"<value>\":      The value returned in the string format.\n   return=cannot-display: The value cannot be converted as string.\n\n   type=\"<type>\":         The type of the returned sample.\n\n```\n\n**[get var](#9.3-get%20var)**<name>```\nShow the existence, type and contents of the process-wide variable 'name'.\nOnly process-wide variables are readable, so the name must begin with\n'proc.' otherwise no variable will be found. This command requires levels\n\"operator\" or \"admin\".\n\n```\n\n**[get weight](#9.3-get%20weight)**<backend>/<server>```\nReport the current weight and the initial weight of server <server> in\nbackend <backend> or an error if either doesn't exist. The initial weight is\nthe one that appears in the configuration file. Both are normally equal\nunless the current weight has been changed. Both the backend and the server\nmay be specified either by their name or by their numeric ID, prefixed with a\nsharp ('#').\n\n```\n\n**[help](#9.3-help)**[<command>]```\nPrint the list of known keywords and their basic usage, or commands matching\nthe requested one. The same help screen is also displayed for unknown\ncommands.\n\n```\n\n**[httpclient](#9.3-httpclient)**<method><URI>```\nLaunch an HTTP client request and print the response on the CLI. Only\nsupported on a CLI connection running in expert mode (see \"expert-mode on\").\nIt's only meant for debugging. The httpclient is able to resolve a server\nname in the URL using the \"default\" resolvers section, which is populated\nwith the DNS servers of your /etc/resolv.conf by default. However it won't be\nable to resolve an host from /etc/hosts if you don't use a local dns daemon\nwhich can resolve those.\n\n```\n\n**[new ssl ca-file](#9.3-new%20ssl%20ca-file)**<cafile>```\nCreate a new empty CA file tree entry to be filled with a set of CA\ncertificates and added to a crt-list. This command should be used in\ncombination with \"set ssl ca-file\", \"add ssl ca-file\" and \"add ssl crt-list\".\n\n```\n\n**[new ssl cert](#9.3-new%20ssl%20cert)**<filename>```\nCreate a new empty SSL certificate store to be filled with a certificate and\nadded to a directory or a crt-list. This command should be used in\ncombination with \"set ssl cert\" and \"add ssl crt-list\".\n\n```\n\n**[new ssl crl-file](#9.3-new%20ssl%20crl-file)**<crlfile>```\nCreate a new empty CRL file tree entry to be filled with a set of CRLs\nand added to a crt-list. This command should be used in combination with \"set\nssl crl-file\" and \"add ssl crt-list\".\n\n```\n\n**[prepare acl](#9.3-prepare%20acl)**<acl>```\nAllocate a new version number in ACL <acl> for atomic replacement. <acl> is\nthe #<id> or the <name> returned by \"show acl\". The new version number is\nshown in response after \"New version created:\". This number will then be\nusable to prepare additions of new entries into the ACL which will then\natomically replace the current ones once committed. It is reported as\n\"next_ver\" in \"show acl\". There is no impact of allocating new versions, as\nunused versions will automatically be removed once a more recent version is\ncommitted. Version numbers are unsigned 32-bit values which wrap at the end,\nso care must be taken when comparing them in an external program. This\ncommand cannot be used if the reference <acl> is a name also used as a map.\nIn this case, the \"prepare map\" command must be used instead.\n\n```\n\n**[prepare map](#9.3-prepare%20map)**<map>```\nAllocate a new version number in map <map> for atomic replacement. <map> is\nthe #<id> or the <name> returned by \"show map\". The new version number is\nshown in response after \"New version created:\". This number will then be\nusable to prepare additions of new entries into the map which will then\natomically replace the current ones once committed. It is reported as\n\"next_ver\" in \"show map\". There is no impact of allocating new versions, as\nunused versions will automatically be removed once a more recent version is\ncommitted. Version numbers are unsigned 32-bit values which wrap at the end,\nso care must be taken when comparing them in an external program.\n\n```\n\n**[prompt](#9.3-prompt)**[help | n | i | p | timed]*```\nChanges the behavior of the interactive mode and the prompt displayed at the\nbeginning of the line in interactive mode:\n  - \"help\"    : displays the command's usage\n  - \"n\"       : switches to non-interactive mode\n  - \"i\"       : switches to interactive mode\n  - \"p\"       : switches to interactive + prompt mode\n  - \"timed\"   : toggles displaying the time in the prompt\n\nWithout any option, this will cycle through prompt mode then non-interactive\nmode. In non-interactive mode, the connection is closed after the last\ncommand of the current line compltes. In interactive mode, the connection is\nnot closed after a command completes, so that a new one can be entered. In\nprompt mode, the interactive mode is still in use, and a prompt will appear\nat the beginning of the line, indicating to the user that the interpreter is\nwaiting for a new command. The prompt consists in a right angle bracket\nfollowed by a space \"> \".\n\nThe prompt mode is more suited to human users, the interactive mode to\nadvanced scripts, and the non-interactive mode (default) to basic scripts.\nNote that the non-interactive mode is not available for the master socket.\n\n```\n\n**[quit](#9.3-quit)**```\nClose the connection when in interactive mode.\n\n```\n\n**[set anon](#9.3-set%20anon)**[on|off][<key>]```\nThis command enables or disables the \"anonymized mode\" for the current CLI\nsession, which replaces certain fields considered sensitive or confidential\nin command outputs with hashes that preserve sufficient consistency between\nelements to help developers identify relations between elements when trying\nto spot bugs, but a low enough bit count (24) to make them non-reversible due\nto the high number of possible matches. When turned on, if no key is\nspecified, the global key will be used (either specified in the configuration\nfile by \"anonkey\" or set via the CLI command \"set anon global-key\"). If no such\nkey was set, a random one will be generated. Otherwise it's possible to\nspecify the 32-bit key to be used for the current session, for example, to\nreuse the key that was used in a previous dump to help compare outputs.\nDevelopers will never need this key and it's recommended never to share it as\nit could allow to confirm/infirm some guesses about what certain hashes could\nbe hiding.\n\n```\n\n**[set dynamic-cookie-key backend](#9.3-set%20dynamic-cookie-key%20backend)**<backend><value>```\nModify the secret key used to generate the dynamic persistent cookies.\nThis will break the existing sessions.\n\n```\n\n**[set anon global-key](#9.3-set%20anon%20global-key)**<key>```\nThis sets the global anonymizing key to <key>, which must be a 32-bit\ninteger between 0 and 4294967295 (0 disables the global key). This command\nrequires admin privilege.\n\n```\n\n**[set map](#9.3-set%20map)**<map>[<key>|#<ref>]<value>```\nModify the value corresponding to each key <key> in a map <map>. <map> is the\n#<id> or <name> returned by \"show map\". If the <ref> is used in place of\n<key>, only the entry pointed by <ref> is changed. The new value is <value>.\n\n```\n\n**[set maxconn frontend](#9.3-set%20maxconn%20frontend)**<frontend><value>```\nDynamically change the specified frontend's maxconn setting. Any positive\nvalue is allowed including zero, but setting values larger than the global\nmaxconn does not make much sense. If the limit is increased and connections\nwere pending, they will immediately be accepted. If it is lowered to a value\nbelow the current number of connections, new connections acceptation will be\ndelayed until the threshold is reached. The frontend might be specified by\neither its name or its numeric ID prefixed with a sharp ('#').\n\n```\n\n**[set maxconn server](#9.3-set%20maxconn%20server)**<backend/server><value>```\nDynamically change the specified server's maxconn setting. Any positive\nvalue is allowed including zero, but setting values larger than the global\nmaxconn does not make much sense.\n\n```\n\n**[set maxconn global](#9.3-set%20maxconn%20global)**<maxconn>```\nDynamically change the global maxconn setting within the range defined by the\ninitial global maxconn setting. If it is increased and connections were\npending, they will immediately be accepted. If it is lowered to a value below\nthe current number of connections, new connections acceptation will be\ndelayed until the threshold is reached. A value of zero restores the initial\nsetting.\n\n```\n\n**[set profiling](#9.3-set%20profiling)**{ tasks | memory }{ auto | on | off }```\nEnables or disables CPU or memory profiling for the indicated subsystem. This\nis equivalent to setting or clearing the \"profiling\" settings in the \"global\"\nsection of the configuration file. Please also see \"show profiling\". Note\nthat manually setting the tasks profiling to \"on\" automatically resets the\nscheduler statistics, thus allows to check activity over a given interval.\nThe memory profiling is limited to certain operating systems (known to work\non the linux-glibc target), and requires USE_MEMORY_PROFILING to be set at\ncompile time.\n\n```\n\n**[set rate-limit connections global](#9.3-set%20rate-limit%20connections%20global)**<value>```\nChange the process-wide connection rate limit, which is set by the global\n'maxconnrate' setting. A value of zero disables the limitation. This limit\napplies to all frontends and the change has an immediate effect. The value\nis passed in number of connections per second.\n\n```\n\n**[set rate-limit http-compression global](#9.3-set%20rate-limit%20http-compression%20global)**<value>```\nChange the maximum input compression rate, which is set by the global\n'maxcomprate' setting. A value of zero disables the limitation. The value is\npassed in number of kilobytes per second. The value is available in the \"show\ninfo\" on the line \"CompressBpsRateLim\" in bytes.\n\n```\n\n**[set rate-limit sessions global](#9.3-set%20rate-limit%20sessions%20global)**<value>```\nChange the process-wide session rate limit, which is set by the global\n'maxsessrate' setting. A value of zero disables the limitation. This limit\napplies to all frontends and the change has an immediate effect. The value\nis passed in number of sessions per second.\n\n```\n\n**[set rate-limit ssl-sessions global](#9.3-set%20rate-limit%20ssl-sessions%20global)**<value>```\nChange the process-wide SSL session rate limit, which is set by the global\n'maxsslrate' setting. A value of zero disables the limitation. This limit\napplies to all frontends and the change has an immediate effect. The value\nis passed in number of sessions per second sent to the SSL stack. It applies\nbefore the handshake in order to protect the stack against handshake abuses.\n\n```\n\n**[set server](#9.3-set%20server)**<backend>/<server>addr<ip4 or ip6 address>[port<port>]```\nReplace the current IP address of a server by the one provided.\nOptionally, the port can be changed using the 'port' parameter.\nNote that changing the port also support switching from/to port mapping\n(notation with +X or -Y), only if a port is configured for the health check.\n\n```\n\n**[set server](#9.3-set%20server)**<backend>/<server>agent[ up | down ]```\nForce a server's agent to a new state. This can be useful to immediately\nswitch a server's state regardless of some slow agent checks for example.\nNote that the change is propagated to tracking servers if any.\n\n```\n\n**[set server](#9.3-set%20server)**<backend>/<server>agent-addr<addr>[port<port>]```\nChange addr for servers agent checks. Allows to migrate agent-checks to\nanother address at runtime. You can specify both IP and hostname, it will be\nresolved.\nOptionally, change the port agent.\n\n```\n\n**[set server](#9.3-set%20server)**<backend>/<server>agent-port<port>```\nChange the port used for agent checks.\n\n```\n\n**[set server](#9.3-set%20server)**<backend>/<server>agent-send<value>```\nChange agent string sent to agent check target. Allows to update string while\nchanging server address to keep those two matching.\n\n```\n\n**[set server](#9.3-set%20server)**<backend>/<server>health[ up | stopping | down ]```\nForce a server's health to a new state. This can be useful to immediately\nswitch a server's state regardless of some slow health checks for example.\nNote that the change is propagated to tracking servers if any.\n\n```\n\n**[set server](#9.3-set%20server)**<backend>/<server>check-addr<ip4 | ip6>[port<port>]```\nChange the IP address used for server health checks.\nOptionally, change the port used for server health checks.\n\n```\n\n**[set server](#9.3-set%20server)**<backend>/<server>check-port<port>```\nChange the port used for health checking to <port>\n\n```\n\n**[set server](#9.3-set%20server)**<backend>/<server>state[ ready | drain | maint ]```\nForce a server's administrative state to a new state. This can be useful to\ndisable load balancing and/or any traffic to a server. Setting the state to\n\"ready\" puts the server in normal mode, and the command is the equivalent of\nthe \"enable server\" command. Setting the state to \"maint\" disables any traffic\nto the server as well as any health checks. This is the equivalent of the\n\"disable server\" command. Setting the mode to \"drain\" only removes the server\nfrom load balancing but still allows it to be checked and to accept new\npersistent connections. Changes are propagated to tracking servers if any.\n\n```\n\n**[set server](#9.3-set%20server)**<backend>/<server>weight<weight>[%]```\nChange a server's weight to the value passed in argument. This is the exact\nequivalent of the \"set weight\" command below.\n\n```\n\n**[set server](#9.3-set%20server)**<backend>/<server>fqdn<FQDN>```\nChange a server's FQDN to the value passed in argument. This requires the\ninternal run-time DNS resolver to be configured and enabled for this server.\n\n```\n\n**[set server](#9.3-set%20server)**<backend>/<server>ssl[ on | off ](deprecated)```\nThis option configures SSL ciphering on outgoing connections to the server.\nWhen switch off, all traffic becomes plain text; health check path is not\nchanged.\n\nThis command is deprecated, create a new server dynamically with or without\nSSL instead, using the \"add server\" command.\n\n```\n\n**[set severity-output](#9.3-set%20severity-output)**[ none | number | string ]```\nChange the severity output format of the stats socket connected to for the\nduration of the current session.\n\n```\n\n**[set ssl ca-file](#9.3-set%20ssl%20ca-file)**<cafile><payload>```\nthis command is part of a transaction system, the \"commit ssl ca-file\" and\n\"abort ssl ca-file\" commands could be required.\nif there is no on-going transaction, it will create a ca file tree entry into\nwhich the certificates contained in the payload will be stored. the ca file\nentry will not be stored in the ca file tree and will only be kept in a\ntemporary transaction. if a transaction with the same filename already exists,\nthe previous ca file entry will be deleted and replaced by the new one.\nonce the modifications are done, you have to commit the transaction through\na \"commit ssl ca-file\" call. If you want to add multiple certificates\nseparately, you can use the \"add ssl ca-file\" command\n\n```\n\nExample:```\n\necho -e \"set ssl ca-file cafile.pem <<\\n$(cat rootCA.crt)\\n\" | \\\nsocat /var/run/haproxy.stat -\necho \"commit ssl ca-file cafile.pem\" | socat /var/run/haproxy.stat -\n\n```\n\n**[set ssl cert](#9.3-set%20ssl%20cert)**<filename><payload>```\nThis command is part of a transaction system, the \"commit ssl cert\" and\n\"abort ssl cert\" commands could be required.\nThis whole transaction system works on any certificate displayed by the\n\"show ssl cert\" command, so on any frontend or backend certificate.\nIf there is no on-going transaction, it will duplicate the certificate\n<filename> in memory to a temporary transaction, then update this\ntransaction with the PEM file in the payload. If a transaction exists with\nthe same filename, it will update this transaction. It's also possible to\nupdate the files linked to a certificate (.issuer, .sctl, .oscp etc.)\nOnce the modification are done, you have to \"commit ssl cert\" the\ntransaction.\n\nInjection of files over the CLI must be done with caution since an empty line\nis used to notify the end of the payload. It is recommended to inject a PEM\nfile which has been sanitized. A simple method would be to remove every empty\nline and only leave what are in the PEM sections. It could be achieved with a\nsed command.\n\n```\n\nExample:```\n\n# With some simple sanitizing\n echo -e \"set ssl cert localhost.pem <<\\n$(sed -n '/^$/d;/-BEGIN/,/-END/p' 127.0.0.1.pem)\\n\" | \\\n socat /var/run/haproxy.stat -\n\n # Complete example with commit\n echo -e \"set ssl cert localhost.pem <<\\n$(cat 127.0.0.1.pem)\\n\" | \\\n socat /var/run/haproxy.stat -\n echo -e \\\n \"set ssl cert localhost.pem.issuer <<\\n $(cat 127.0.0.1.pem.issuer)\\n\" | \\\n socat /var/run/haproxy.stat -\n echo -e \\\n \"set ssl cert localhost.pem.ocsp <<\\n$(base64 -w 1000 127.0.0.1.pem.ocsp)\\n\" | \\\n socat /var/run/haproxy.stat -\n echo \"commit ssl cert localhost.pem\" | socat /var/run/haproxy.stat -\n\n```\n\n**[set ssl crl-file](#9.3-set%20ssl%20crl-file)**<crlfile><payload>```\nThis command is part of a transaction system, the \"commit ssl crl-file\" and\n\"abort ssl crl-file\" commands could be required.\nIf there is no on-going transaction, it will create a CRL file tree entry into\nwhich the Revocation Lists contained in the payload will be stored. The CRL\nfile entry will not be stored in the CRL file tree and will only be kept in a\ntemporary transaction. If a transaction with the same filename already exists,\nthe previous CRL file entry will be deleted and replaced by the new one.\nOnce the modifications are done, you have to commit the transaction through\na \"commit ssl crl-file\" call.\n\n```\n\nExample:```\n\necho -e \"set ssl crl-file crlfile.pem <<\\n$(cat rootCRL.pem)\\n\" | \\\nsocat /var/run/haproxy.stat -\necho \"commit ssl crl-file crlfile.pem\" | socat /var/run/haproxy.stat -\n\n```\n\n**[set ssl ocsp-response](#9.3-set%20ssl%20ocsp-response)**<response | payload>```\nThis command is used to update an OCSP Response for a certificate (see \"crt\"\non \"bind\" lines). Same controls are performed as during the initial loading of\nthe response. The <response> must be passed as a base64 encoded string of the\nDER encoded response from the OCSP server. This command is not supported with\nBoringSSL.\n\n```\n\nExample:```\n\nopenssl ocsp -issuer issuer.pem -cert server.pem \\\n             -host ocsp.issuer.com:80 -respout resp.der\necho \"set ssl ocsp-response $(base64 -w 10000 resp.der)\" | \\\n             socat stdio /var/run/haproxy.stat\n\nusing the payload syntax:\necho -e \"set ssl ocsp-response <<\\n$(base64 resp.der)\\n\" | \\\n             socat stdio /var/run/haproxy.stat\n\n```\n\n**[set ssl tls-key](#9.3-set%20ssl%20tls-key)**<id><tlskey>```\nSet the next TLS key for the <id> listener to <tlskey>. This key becomes the\nultimate key, while the penultimate one is used for encryption (others just\ndecrypt). The oldest TLS key present is overwritten. <id> is either a numeric\n#<id> or <file> returned by \"show tls-keys\". <tlskey> is a base64 encoded 48\nor 80 bits TLS ticket key (ex. openssl rand 80 | openssl base64 -A).\n\n```\n\n**[set table](#9.3-set%20table)**<table>key<key>[data.<data_type><value>]***[set table](#9.3-set%20table)**<table>ptr<ptr>[data.<data_type><value>]*```\nCreate or update a stick-table entry in the table. If the key is not present,\nan entry is inserted. See stick-table in section 4.2 to find all possible\nvalues for <data_type>. The most likely use consists in dynamically entering\nentries for source IP addresses, with a flag in gpc0 to dynamically block an\nIP address or affect its quality of service. It is possible to pass multiple\ndata_types in a single call.\n\nOptional ptr lookup may be used instead of key lookup for an existing entry:\n<ptr> is written in the form 0xffff and must correspond to the address\nreturned by a previous \"show table\" command. Matching an entry using its\npointer may be relevant if the entry cannot be matched using the key due to\nempty key or incompatible characters on the cli.\n\nIf data.<data_type> is an array type, \"[]\" may be used to access a specific\nindex in the array, like so: data.gpt[1]\n\n```\n\n**[set timeout cli](#9.3-set%20timeout%20cli)**<delay>```\nChange the CLI interface timeout for current connection. This can be useful\nduring long debugging sessions where the user needs to constantly inspect\nsome indicators without being disconnected. The delay is passed in seconds.\n\n```\n\n**[set var](#9.3-set%20var)**<name><expression>**[set var](#9.3-set%20var)**<name>expr<expression>**[set var](#9.3-set%20var)**<name>fmt<format>```\nAllows to set or overwrite the process-wide variable 'name' with the result\nof expression <expression> or format string <format>. Only process-wide\nvariables may be used, so the name must begin with 'proc.' otherwise no\nvariable will be set. The <expression> and <format> may only involve\n\"internal\" sample fetch keywords and converters even though the most likely\nuseful ones will be str('something'), int(), simple strings or references to\nother variables. Note that the command line parser doesn't know about quotes,\nso any space in the expression must be preceded by a backslash. This command\nrequires levels \"operator\" or \"admin\". This command is only supported on a\nCLI connection running in experimental mode (see \"experimental-mode on\").\n\n```\n\n**[set weight](#9.3-set%20weight)**<backend>/<server><weight>[%]```\nChange a server's weight to the value passed in argument. If the value ends\nwith the '%' sign, then the new weight will be relative to the initially\nconfigured weight.  Absolute weights are permitted between 0 and 256.\nRelative weights must be positive with the resulting absolute weight is\ncapped at 256.  Servers which are part of a farm running a static\nload-balancing algorithm have stricter limitations because the weight\ncannot change once set. Thus for these servers, the only accepted values\nare 0 and 100% (or 0 and the initial weight). Changes take effect\nimmediately, though certain LB algorithms require a certain amount of\nrequests to consider changes. A typical usage of this command is to\ndisable a server during an update by setting its weight to zero, then to\nenable it again after the update by setting it back to 100%. This command\nis restricted and can only be issued on sockets configured for level\n\"admin\". Both the backend and the server may be specified either by their\nname or by their numeric ID, prefixed with a sharp ('#').\n\n```\n\n**[show acl](#9.3-show%20acl)**[[@<ver>]<acl>]```\nDump info about acl converters. Without argument, the list of all available\nacls is returned. If a <acl> is specified, its contents are dumped. <acl> is\nthe #<id> or <name>. By  default the current version of the ACL is shown (the\nversion currently being matched against and reported as 'curr_ver' in the ACL\nlist). It is possible to instead dump other versions by prepending '@<ver>'\nbefore the ACL's identifier. The version works as a filter and non-existing\nversions will simply report no result. The dump format is the same as for the\nmaps even for the sample values. The data returned are not a list of\navailable ACL, but are the list of all patterns composing any ACL. Many of\nthese patterns can be shared with maps. The 'entry_cnt' value represents the\ncount of all the ACL entries, not just the active ones, which means that it\nalso includes entries currently being added.\n\n```\n\n**[show anon](#9.3-show%20anon)**```\nDisplay the current state of the anonymized mode (enabled or disabled) and\nthe current session's key.\n\n```\n\n**[show backend](#9.3-show%20backend)**```\nDump the list of backends available in the running process\n\n```\n\n**[show cli level](#9.3-show%20cli%20level)**```\nDisplay the CLI level of the current CLI session. The result could be\n'admin', 'operator' or 'user'. See also the 'operator' and 'user' commands.\n\n```\n\nExample :```\n\n$ socat /tmp/sock1 readline\nprompt\n> operator\n> show cli level\noperator\n> user\n> show cli level\nuser\n> operator\nPermission denied\n\n```\n\n**[operator](#9.3-operator)**```\nDecrease the CLI level of the current CLI session to operator. It can't be\nincreased. It also drops expert and experimental mode. See also \"show cli\nlevel\".\n\n```\n\n**[user](#9.3-user)**```\nDecrease the CLI level of the current CLI session to user. It can't be\nincreased. It also drops expert and experimental mode. See also \"show cli\nlevel\".\n\n```\n\n**[show activity](#9.3-show%20activity)**[-1 | 0 | thread_num]```\nReports some counters about internal events that will help developers and\nmore generally people who know haproxy well enough to narrow down the causes\nof reports of abnormal behaviours. A typical example would be a properly\nrunning process never sleeping and eating 100% of the CPU. The output fields\nwill be made of one line per metric, and per-thread counters on the same\nline. These counters are 32-bit and will wrap during the process's life, which\nis not a problem since calls to this command will typically be performed\ntwice. The fields are purposely not documented so that their exact meaning is\nverified in the code where the counters are fed. These values are also reset\nby the \"clear counters\" command. On multi-threaded deployments, the first\ncolumn will indicate the total (or average depending on the nature of the\nmetric) for all threads, and the list of all threads' values will be\nrepresented between square brackets in the thread order. Optionally the\nthread number to be dumped may be specified in argument. The special value\n\"0\" will report the aggregated value (first column), and \"-1\", which is the\ndefault, will display all the columns. Note that just like in single-threaded\nmode, there will be no brackets when a single column is requested.\n\n```\n\n**[show cli sockets](#9.3-show%20cli%20sockets)**```\nList CLI sockets. The output format is composed of 3 fields separated by\nspaces. The first field is the socket address, it can be a unix socket, a\nipv4 address:port couple or a ipv6 one. Socket of other types won't be dump.\nThe second field describe the level of the socket: 'admin', 'user' or\n'operator'. The last field list the processes on which the socket is bound,\nseparated by commas, it can be numbers or 'all'.\n\n```\n\nExample :```\n\n$ echo 'show cli sockets' | socat stdio /tmp/sock1\n# socket lvl processes\n/tmp/sock1 admin all\n127.0.0.1:9999 user 2,3,4\n127.0.0.2:9969 user 2\n[::1]:9999 operator 2\n\n```\n\n**[show cache](#9.3-show%20cache)**```\nList the configured caches and the objects stored in each cache tree.\n\n$ echo 'show cache' | socat stdio /tmp/sock1\n0x7f6ac6c5b03a: foobar (shctx:0x7f6ac6c5b000, available blocks:3918)\n       1          2             3                             4\n\n1. pointer to the cache structure\n2. cache name\n3. pointer to the mmap area (shctx)\n4. number of blocks available for reuse in the shctx\n\n0x7f6ac6c5b4cc hash:286881868 vary:0x0011223344556677 size:39114 (39 blocks), refcount:9, expire:237\n         1               2               3                    4        5            6           7\n\n1. pointer to the cache entry\n2. first 32 bits of the hash\n3. secondary hash of the entry in case of vary\n4. size of the object in bytes\n5. number of blocks used for the object\n6. number of transactions using the entry\n7. expiration time, can be negative if already expired\n\n```\n\n**[show dev](#9.3-show%20dev)**```\nThis command is meant to centralize some information that HAProxy developers\nmight need to better understand the causes of a given problem. It generally\ndoes not provide useful information for the user, but these information allow\ndevelopers to eliminate certain hypothesis. The format is roughly a series of\nsections containing indented lines with one element per line, such as the OS\ntype and version, the CPU type or the boot-time FD limits for example. Some\nfields will be omitted to avoid repetition or output pollution when they do\nnot add value (e.g. unlimited values). More fields may appear in the future,\nand some may change. This output is not meant for being parsed by scripts, and\nshould not be considered with a high degree of reliability, it's essentially\naimed at saving time for those who can read it.\n\nTechnically speaking, such information are taken as-is out of an internal\nstructure that stores them together at boot time so that they can also be\nfound in a core file after a crash. As such, it may happen that developers\nask for an early output on a well behaving process to compare with what is\nfound in a core dump, or to compare between several reloads (e.g. some limits\nmight change). If anonymizing is enabled, any possibly sensitive value will\nbe anonymized as well (e.g. the node name).\n\nExample of output:\n   $ socat stdio /tmp/sock1 <<< \"show dev\"\n   Platform info\n     machine vendor: To be filled by O.E.M\n     machine family: Altra\n     cpu model: Impl 0x41 Arch 8 Part 0xd0c r3p1\n     virtual machine: no\n     container: no\n     OS name: Linux\n     OS release: 6.2.0-36-generic\n     OS version: #37~22.04.1-Ubuntu SMP PREEMPT_DYNAMIC Mon Oct  9 18:01:07 UTC 2\n     OS architecture: aarch64\n     node name: 489aaf\n   Process info\n     pid: 1735846\n     boot uid: 509\n     boot gid: 1002\n     fd limit (soft): 1024\n     fd limit (hard): 1048576\n\n```\n\n**[show env](#9.3-show%20env)**[<name>]```\nDump one or all environment variables known by the process. Without any\nargument, all variables are dumped. With an argument, only the specified\nvariable is dumped if it exists. Otherwise \"Variable not found\" is emitted.\nVariables are dumped in the same format as they are stored or returned by the\n\"env\" utility, that is, \"<name>=<value>\". This can be handy when debugging\ncertain configuration files making heavy use of environment variables to\nensure that they contain the expected values. This command is restricted and\ncan only be issued on sockets configured for levels \"operator\" or \"admin\".\n\n```\n\n**[show errors](#9.3-show%20errors)**[<iid>|<proxy>][request|response]```\nDump last known HTTP/1.x request and response errors collected by frontends\nand backends. If <iid> is specified, the limit the dump to errors concerning\neither frontend or backend whose ID is <iid>. Proxy ID \"-1\" will cause all\ninstances to be dumped. If a proxy name is specified instead, its ID will be\nused as the filter. If \"request\" or \"response\" is added after the proxy name\nor ID, only request or response errors will be dumped. This command is\nrestricted and can only be issued on sockets configured for levels \"operator\"\nor \"admin\".\n\nThe errors which may be collected are the last request and response errors\ncaused by protocol violations, often due to invalid characters in header\nnames. The report precisely indicates what exact character violated the\nprotocol. Other important information such as the exact date the error was\ndetected, frontend and backend names, the server name (when known), the\ninternal transaction ID and the source address which has initiated the\nsession are reported too.\n\nAll characters are returned, and non-printable characters are encoded. The\nmost common ones (\\t = 9, \\n = 10, \\r = 13 and \\e = 27) are encoded as one\nletter following a backslash. The backslash itself is encoded as '\\\\' to\navoid confusion. Other non-printable characters are encoded '\\xNN' where\nNN is the two-digits hexadecimal representation of the character's ASCII\ncode.\n\nLines are prefixed with the position of their first character, starting at 0\nfor the beginning of the buffer. At most one input line is printed per line,\nand large lines will be broken into multiple consecutive output lines so that\nthe output never goes beyond 79 characters wide. It is easy to detect if a\nline was broken, because it will not end with '\\n' and the next line's offset\nwill be followed by a '+' sign, indicating it is a continuation of previous\nline.\n\n```\n\nExample :```\n\n    $ echo \"show errors -1 response\" | socat stdio /tmp/sock1\n>>> [04/Mar/2009:15:46:56.081] backend http-in (#2) : invalid response\n      src 127.0.0.1, session #54, frontend fe-eth0 (#1), server s2 (#1)\n      response length 213 bytes, error at position 23:\n\n      00000  HTTP/1.0 200 OK\\r\\n\n      00017  header/bizarre:blah\\r\\n\n      00038  Location: blah\\r\\n\n      00054  Long-line: this is a very long line which should b\n      00104+ e broken into multiple lines on the output buffer,\n      00154+  otherwise it would be too large to print in a ter\n      00204+ minal\\r\\n\n      00211  \\r\\n\n\nIn the example above, we see that the backend \"http-in\" which has internal\nID 2 has blocked an invalid response from its server s2 which has internal\nID 1. The request was on transaction 54 (called \"session\" here) initiated\nby source 127.0.0.1 and received by frontend fe-eth0 whose ID is 1. The\ntotal response length was 213 bytes when the error was detected, and the\nerror was at byte 23. This is the slash ('/') in header name\n\"header/bizarre\", which is not a valid HTTP character for a header name.\n\n```\n\n**[show events](#9.3-show%20events)**[<sink>][-w][-n][-0]```\nWith no option, this lists all known event sinks and their types. With an\noption, it will dump all available events in the designated sink if it is of\ntype buffer. If option \"-w\" is passed after the sink name, then once the end\nof the buffer is reached, the command will wait for new events and display\nthem. It is possible to stop the operation by entering any input (which will\nbe discarded) or by closing the session. Finally, option \"-n\" is used to\ndirectly seek to the end of the buffer, which is often convenient when\ncombined with \"-w\" to only report new events. For convenience, \"-wn\" or \"-nw\"\nmay be used to enable both options at once. By default, all events are\ndelimited by a line feed character ('\\n' or 10 or 0x0A). It is possible to\nchange this to the NUL character ('\\0' or 0) by passing the \"-0\" argument.\n\n```\n\n**[show fd](#9.3-show%20fd)**[-!plcfbsd]*[<fd>]```\nDump the list of either all open file descriptors or just the one number <fd>\nif specified. A set of flags may optionally be passed to restrict the dump\nonly to certain FD types or to omit certain FD types. When '-' or '!' are\nencountered, the selection is inverted for the following characters in the\nsame argument. The inversion is reset before each argument word delimited by\nwhite spaces. Selectable FD types include 'p' for pipes, 'l' for listeners,\n'c' for connections (any type), 'f' for frontend connections, 'b' for backend\nconnections (any type), 's' for connections to servers, 'd' for connections\nto the \"dispatch\" address or the backend's transparent address. With this,\n'b' is a shortcut for 'sd' and 'c' for 'fb' or 'fsd'. 'c!f' is equivalent to\n'b' (\"any connections except frontend connections\" are indeed backend\nconnections). This is only aimed at developers who need to observe internal\nstates in order to debug complex issues such as abnormal CPU usages. One fd\nis reported per lines, and for each of them, its state in the poller using\nupper case letters for enabled flags and lower case for disabled flags, using\n\"P\" for \"polled\", \"R\" for \"ready\", \"A\" for \"active\", the events status using\n\"H\" for \"hangup\", \"E\" for \"error\", \"O\" for \"output\", \"P\" for \"priority\" and\n\"I\" for \"input\", a few other flags like \"N\" for \"new\" (just added into the fd\ncache), \"U\" for \"updated\" (received an update in the fd cache), \"L\" for\n\"linger_risk\", \"C\" for \"cloned\", then the cached entry position, the pointer\nto the internal owner, the pointer to the I/O callback and its name when\nknown. When the owner is a connection, the connection flags, and the target\nare reported (frontend, proxy or server). When the owner is a listener, the\nlistener's state and its frontend are reported. There is no point in using\nthis command without a good knowledge of the internals. It's worth noting\nthat the output format may evolve over time so this output must not be parsed\nby tools designed to be durable. Some internal structure states may look\nsuspicious to the function listing them, in this case the output line will be\nsuffixed with an exclamation mark ('!'). This may help find a starting point\nwhen trying to diagnose an incident.\n\n```\n\n**[show info](#9.3-show%20info)**[typed|json][desc][float]```\nDump info about haproxy status on current process. If \"typed\" is passed as an\noptional argument, field numbers, names and types are emitted as well so that\nexternal monitoring products can easily retrieve, possibly aggregate, then\nreport information found in fields they don't know. Each field is dumped on\nits own line. If \"json\" is passed as an optional argument then\ninformation provided by \"typed\" output is provided in JSON format as a\nlist of JSON objects. By default, the format contains only two columns\ndelimited by a colon (':'). The left one is the field name and the right\none is the value.  It is very important to note that in typed output\nformat, the dump for a single object is contiguous so that there is no\nneed for a consumer to store everything at once. If \"float\" is passed as an\noptional argument, some fields usually emitted as integers may switch to\nfloats for higher accuracy. It is purposely unspecified which ones are\nconcerned as this might evolve over time. Using this option implies that the\nconsumer is able to process floats. The output format used is sprintf(\"%f\").\n\nWhen using the typed output format, each line is made of 4 columns delimited\nby colons (':'). The first column is a dot-delimited series of 3 elements. The\nfirst element is the numeric position of the field in the list (starting at\nzero). This position shall not change over time, but holes are to be expected,\ndepending on build options or if some fields are deleted in the future. The\nsecond element is the field name as it appears in the default \"show info\"\noutput. The third element is the relative process number starting at 1.\n\nThe rest of the line starting after the first colon follows the \"typed output\nformat\" described in the section above. In short, the second column (after the\nfirst ':') indicates the origin, nature and scope of the variable. The third\ncolumn indicates the type of the field, among \"s32\", \"s64\", \"u32\", \"u64\" and\n\"str\". Then the fourth column is the value itself, which the consumer knows\nhow to parse thanks to column 3 and how to process thanks to column 2.\n\nThus the overall line format in typed mode is :\n\n    <field_pos>.<field_name>.<process_num>:<tags>:<type>:<value>\n\nWhen \"desc\" is appended to the command, one extra colon followed by a quoted\nstring is appended with a description for the metric. At the time of writing,\nthis is only supported for the \"typed\" and default output formats.\n\n```\n\nExample :```\n\n> show info\nName: HAProxy\nVersion: 1.7-dev1-de52ea-146\nRelease_date: 2016/03/11\nNbproc: 1\nProcess_num: 1\nPid: 28105\nUptime: 0d 0h00m04s\nUptime_sec: 4\nMemmax_MB: 0\nPoolAlloc_MB: 0\nPoolUsed_MB: 0\nPoolFailed: 0\n(...)\n\n> show info typed\n0.Name.1:POS:str:HAProxy\n1.Version.1:POS:str:1.7-dev1-de52ea-146\n2.Release_date.1:POS:str:2016/03/11\n3.Nbproc.1:CGS:u32:1\n4.Process_num.1:KGP:u32:1\n5.Pid.1:SGP:u32:28105\n6.Uptime.1:MDP:str:0d 0h00m08s\n7.Uptime_sec.1:MDP:u32:8\n8.Memmax_MB.1:CLP:u32:0\n9.PoolAlloc_MB.1:MGP:u32:0\n10.PoolUsed_MB.1:MGP:u32:0\n11.PoolFailed.1:MCP:u32:0\n(...)\n\n```\n\n```\nIn the typed format, the presence of the process ID at the end of the\nfirst column makes it very easy to visually aggregate outputs from\nmultiple processes.\n\n```\n\nExample :```\n\n$ ( echo show info typed | socat /var/run/haproxy.sock1 ;    \\\n    echo show info typed | socat /var/run/haproxy.sock2 ) |  \\\n  sort -t . -k 1,1n -k 2,2 -k 3,3n\n0.Name.1:POS:str:HAProxy\n0.Name.2:POS:str:HAProxy\n1.Version.1:POS:str:1.7-dev1-868ab3-148\n1.Version.2:POS:str:1.7-dev1-868ab3-148\n2.Release_date.1:POS:str:2016/03/11\n2.Release_date.2:POS:str:2016/03/11\n3.Nbproc.1:CGS:u32:2\n3.Nbproc.2:CGS:u32:2\n4.Process_num.1:KGP:u32:1\n4.Process_num.2:KGP:u32:2\n5.Pid.1:SGP:u32:30120\n5.Pid.2:SGP:u32:30121\n6.Uptime.1:MDP:str:0d 0h01m28s\n6.Uptime.2:MDP:str:0d 0h01m28s\n(...)\n\n```\n\n```\nThe format of JSON output is described in a schema which may be output\nusing \"show schema json\".\n\nThe JSON output contains no extra whitespace in order to reduce the\nvolume of output. For human consumption passing the output through a\npretty printer may be helpful. Example :\n\n$ echo \"show info json\" | socat /var/run/haproxy.sock stdio | \\\n  python -m json.tool\n\nThe JSON output contains no extra whitespace in order to reduce the\nvolume of output. For human consumption passing the output through a\npretty printer may be helpful. Example :\n\n$ echo \"show info json\" | socat /var/run/haproxy.sock stdio | \\\n  python -m json.tool\n\n```\n\n**[show libs](#9.3-show%20libs)**```\nDump the list of loaded shared dynamic libraries and object files, on systems\nthat support it. When available, for each shared object the range of virtual\naddresses will be indicated, the size and the path to the object. This can be\nused for example to try to estimate what library provides a function that\nappears in a dump. Note that on many systems, addresses will change upon each\nrestart (address space randomization), so that this list would need to be\nretrieved upon startup if it is expected to be used to analyse a core file.\nThis command may only be issued on sockets configured for levels \"operator\"\nor \"admin\". Note that the output format may vary between operating systems,\narchitectures and even haproxy versions, and ought not to be relied on in\nscripts.\n\n```\n\n**[show map](#9.3-show%20map)**[[@<ver>]<map>]```\nDump info about map converters. Without argument, the list of all available\nmaps is returned. If a <map> is specified, its contents are dumped. <map> is\nthe #<id> or <name>. By  default the current version of the map is shown (the\nversion currently being matched against and reported as 'curr_ver' in the map\nlist). It is possible to instead dump other versions by prepending '@<ver>'\nbefore the map's identifier. The version works as a filter and non-existing\nversions will simply report no result. The 'entry_cnt' value represents the\ncount of all the map entries, not just the active ones, which means that it\nalso includes entries currently being added.\n\nIn the output, the first column is a unique entry identifier, which is usable\nas a reference for operations \"del map\" and \"set map\". The second column is\nthe pattern and the third column is the sample if available. The data returned\nare not directly a list of available maps, but are the list of all patterns\ncomposing any map. Many of these patterns can be shared with ACL.\n\n```\n\n**[show peers](#9.3-show%20peers)**[dict|-][<peers section>]```\nDump info about the peers configured in \"peers\" sections. Without argument,\nthe list of the peers belonging to all the \"peers\" sections are listed. If\n<peers section> is specified, only the information about the peers belonging\nto this \"peers\" section are dumped. When \"dict\" is specified before the peers\nsection name, the entire Tx/Rx dictionary caches will also be dumped (very\nlarge). Passing \"-\" may be required to dump a peers section called \"dict\".\n\nHere are two examples of outputs where hostA, hostB and hostC peers belong to\n\"sharedlb\" peers sections. Only hostA and hostB are connected. Only hostA has\nsent data to hostB.\n\n$ echo \"show peers\" | socat - /tmp/hostA\n0x55deb0224320: [15/Apr/2019:11:28:01] id=sharedlb state=0 flags=0x3 \\\n  resync_timeout=<PAST> task_calls=45122\n    0x55deb022b540: id=hostC(remote) addr=127.0.0.12:10002 status=CONN \\\n      reconnect=4s confirm=0\n      flags=0x0\n    0x55deb022a440: id=hostA(local) addr=127.0.0.10:10000 status=NONE \\\n      reconnect=<NEVER> confirm=0\n      flags=0x0\n    0x55deb0227d70: id=hostB(remote) addr=127.0.0.11:10001 status=ESTA\n      reconnect=2s confirm=0\n      flags=0x20000200 appctx:0x55deb028fba0 st0=7 st1=0 task_calls=14456 \\\n        state=EST\n      xprt=RAW src=127.0.0.1:37257 addr=127.0.0.10:10000\n      remote_table:0x55deb0224a10 id=stkt local_id=1 remote_id=1\n      last_local_table:0x55deb0224a10 id=stkt local_id=1 remote_id=1\n      shared tables:\n        0x55deb0224a10 local_id=1 remote_id=1 flags=0x0 remote_data=0x65\n          last_acked=0 last_pushed=3 last_get=0 teaching_origin=0 update=3\n          table:0x55deb022d6a0 id=stkt update=3 localupdate=3 \\\n            commitupdate=3 syncing=0\n\n$ echo \"show peers\" | socat - /tmp/hostB\n0x55871b5ab320: [15/Apr/2019:11:28:03] id=sharedlb state=0 flags=0x3 \\\n  resync_timeout=<PAST> task_calls=3\n    0x55871b5b2540: id=hostC(remote) addr=127.0.0.12:10002 status=CONN \\\n      reconnect=3s confirm=0\n      flags=0x0\n    0x55871b5b1440: id=hostB(local) addr=127.0.0.11:10001 status=NONE \\\n      reconnect=<NEVER> confirm=0\n      flags=0x0\n    0x55871b5aed70: id=hostA(remote) addr=127.0.0.10:10000 status=ESTA \\\n      reconnect=2s confirm=0\n      flags=0x20000200 appctx:0x7fa46800ee00 st0=7 st1=0 task_calls=62356 \\\n        state=EST\n      remote_table:0x55871b5ab960 id=stkt local_id=1 remote_id=1\n      last_local_table:0x55871b5ab960 id=stkt local_id=1 remote_id=1\n      shared tables:\n        0x55871b5ab960 local_id=1 remote_id=1 flags=0x0 remote_data=0x65\n          last_acked=3 last_pushed=0 last_get=3 teaching_origin=0 update=0\n          table:0x55871b5b46a0 id=stkt update=1 localupdate=0 \\\n            commitupdate=0 syncing=0\n\n```\n\n**[show pools](#9.3-show%20pools)**[byname|bysize|byusage][detailed][match<pfx>][<nb>]```\nDump the status of internal memory pools. This is useful to track memory\nusage when suspecting a memory leak for example. It does exactly the same\nas the SIGQUIT when running in foreground except that it does not flush the\npools. The output is not sorted by default. If \"byname\" is specified, it is\nsorted by pool name; if \"bysize\" is specified, it is sorted by item size in\nreverse order; if \"byusage\" is specified, it is sorted by total usage in\nreverse order, and only used entries are shown. It is also possible to limit\nthe output to the <nb> first entries (e.g. when sorting by usage). It is\npossible to also dump more internal details, including the list of all pools\nthat were merged together, by specifying \"detailed\". Finally, if \"match\"\nfollowed by a prefix is specified, then only pools whose name starts with\nthis prefix will be shown. The reported total only concerns pools matching\nthe filtering criteria. Example:\n\n  $ socat - /tmp/haproxy.sock <<< \"show pools match quic byusage\"\n  Dumping pools usage. Use SIGQUIT to flush them.\n    - Pool quic_conn_r (65560 bytes) : 1337 allocated (87653720 bytes), ...\n    - Pool quic_crypto (1048 bytes) : 6685 allocated (7005880 bytes), ...\n    - Pool quic_conn (4056 bytes) : 1337 allocated (5422872 bytes), ...\n    - Pool quic_rxbuf (262168 bytes) : 8 allocated (2097344 bytes), ...\n    - Pool quic_conne (184 bytes) : 9359 allocated (1722056 bytes), ...\n    - Pool quic_frame (184 bytes) : 7938 allocated (1460592 bytes), ...\n    - Pool quic_tx_pac (152 bytes) : 6454 allocated (981008 bytes), ...\n    - Pool quic_tls_ke (56 bytes) : 12033 allocated (673848 bytes), ...\n    - Pool quic_rx_pac (408 bytes) : 1596 allocated (651168 bytes), ...\n    - Pool quic_tls_se (88 bytes) : 6685 allocated (588280 bytes), ...\n    - Pool quic_cstrea (88 bytes) : 4011 allocated (352968 bytes), ...\n    - Pool quic_tls_iv (24 bytes) : 12033 allocated (288792 bytes), ...\n    - Pool quic_dgram (344 bytes) : 732 allocated (251808 bytes), ...\n    - Pool quic_arng (56 bytes) : 4011 allocated (224616 bytes), ...\n    - Pool quic_conn_c (152 bytes) : 1337 allocated (203224 bytes), ...\n  Total: 15 pools, 109578176 bytes allocated, 109578176 used ...\n\n```\n\n**[show profiling](#9.3-show%20profiling)**[{all | status | tasks | memory}][byaddr|bytime|aggr|<max_lines>]*```\nDumps the current profiling settings, one per line, as well as the command\nneeded to change them. When tasks profiling is enabled, some per-function\nstatistics collected by the scheduler will also be emitted, with a summary\ncovering the number of calls, total/avg CPU time and total/avg latency. When\nmemory profiling is enabled, some information such as the number of\nallocations/releases and their sizes will be reported. It is possible to\nlimit the dump to only the profiling status, the tasks, or the memory\nprofiling by specifying the respective keywords; by default all profiling\ninformation are dumped. It is also possible to limit the number of lines\nof output of each category by specifying a numeric limit. If is possible to\nrequest that the output is sorted by address or by total execution time\ninstead of usage, e.g. to ease comparisons between subsequent calls or to\ncheck what needs to be optimized, and to aggregate task activity by called\nfunction instead of seeing the details. Please note that profiling is\nessentially aimed at developers since it gives hints about where CPU cycles\nor memory are wasted in the code. There is nothing useful to monitor there.\n\n```\n\n**[show resolvers](#9.3-show%20resolvers)**[<resolvers section id>]```\nDump statistics for the given resolvers section, or all resolvers sections\nif no section is supplied.\n\nFor each name server, the following counters are reported:\n  sent: number of DNS requests sent to this server\n  valid: number of DNS valid responses received from this server\n  update: number of DNS responses used to update the server's IP address\n  cname: number of CNAME responses\n  cname_error: CNAME errors encountered with this server\n  any_err: number of empty response (IE: server does not support ANY type)\n  nx: non existent domain response received from this server\n  timeout: how many time this server did not answer in time\n  refused: number of requests refused by this server\n  other: any other DNS errors\n  invalid: invalid DNS response (from a protocol point of view)\n  too_big: too big response\n  outdated: number of response arrived too late (after another name server)\n\n```\n\n**[show quic](#9.3-show%20quic)**[<format>][<filter>]```\nDump information on all active QUIC frontend connections. This command is\nrestricted and can only be issued on sockets configured for levels \"operator\"\nor \"admin\".\n\nAn optional argument can be specified to control the verbosity. Its value can\nbe interpreted in different way. The first possibility is to used predefined\nvalues, \"oneline\" for the default format, \"stream\" to list every active\nstreams and \"full\" to display all information. Alternatively, a list of\ncomma-delimited fields can be specified to restrict output. Currently\nsupported values are \"tp\", \"sock\", \"pktns\", \"cc\" and \"mux\". Finally, \"help\"\nin the format will instead show a more detailed help message.\n\nThe final argument is used to restrict or extend the connection list. By\ndefault, connections on closing or draining state are not displayed. Use the\nextra argument \"all\" to include them in the output. It's also possible to\nrestrict to a single connection by specifying its hexadecimal address.\n\n```\n\n**[show servers conn](#9.3-show%20servers%20conn)**[<backend>]```\nDump the current and idle connections state of the servers belonging to the\ndesignated backend (or all backends if none specified). A backend name or\nidentifier may be used.\n\nThe output consists in a header line showing the fields titles, then one\nserver per line with for each, the backend name and ID, server name and ID,\nthe address, port and a series or values. The number of fields varies\ndepending on thread count. The exact format of the output may vary slightly\nacross versions and depending on the number of threads. One needs to pay\nattention to the header line to match columns when extracting output values,\nand to the number of threads as the last columns are per-thread:\n\n   bkname/svname         Backend name '/' server name\n   bkid/svid             Backend ID '/' server ID\n   addr                  Server's IP address\n   port                  Server's port (or zero if none)\n   -                     Unused field, serves as a visual delimiter\n   purge_delay           Interval between connection purges, in milliseconds\n   used_cur              Number of connections currently in use\n   used_max              Highest value of used_cur since the process started\n   need_est              Floating estimate of total needed connections\n   unsafe_nb             Number of idle connections considered as \"unsafe\"\n   safe_nb               Number of idle connections considered as \"safe\"\n   idle_lim              Configured maximum number of idle connections\n   idle_cur              Total of the per-thread currently idle connections\n   idle_per_thr[NB]      Idle conns per thread for each one of the NB threads\n\nHAProxy will kill a portion of <idle_cur> every <purge_delay> when the total\nof <idle_cur> + <used_cur> exceeds the estimate <need_est>. This estimate\nvaries based on connection activity.\n\nGiven the threaded nature of idle connections, it's important to understand\nthat some values may change once read, and that as such, consistency within a\nline isn't granted. This output is mostly provided as a debugging tool and is\nnot relevant to be routinely monitored nor graphed.\n\n```\n\n**[show servers state](#9.3-show%20servers%20state)**[<backend>]```\nDump the state of the servers found in the running configuration. A backend\nname or identifier may be provided to limit the output to this backend only.\n\nThe dump has the following format:\n - first line contains the format version (1 in this specification);\n - second line contains the column headers, prefixed by a sharp ('#');\n - third line and next ones contain data;\n - each line starting by a sharp ('#') is considered as a comment.\n\nSince multiple versions of the output may co-exist, below is the list of\nfields and their order per file format version :\n 1:\n   be_id:                       Backend unique id.\n   be_name:                     Backend label.\n   srv_id:                      Server unique id (in the backend).\n   srv_name:                    Server label.\n   srv_addr:                    Server IP address.\n   srv_op_state:                Server operational state (UP/DOWN/...).\n                                  0 = SRV_ST_STOPPED\n                                    The server is down.\n                                  1 = SRV_ST_STARTING\n                                    The server is warming up (up but\n                                    throttled).\n                                  2 = SRV_ST_RUNNING\n                                    The server is fully up.\n                                  3 = SRV_ST_STOPPING\n                                    The server is up but soft-stopping\n                                    (eg: 404).\n   srv_admin_state:             Server administrative state (MAINT/DRAIN/...).\n                                The state is actually a mask of values :\n                                  0x01 = SRV_ADMF_FMAINT\n                                    The server was explicitly forced into\n                                    maintenance.\n                                  0x02 = SRV_ADMF_IMAINT\n                                    The server has inherited the maintenance\n                                    status from a tracked server.\n                                  0x04 = SRV_ADMF_CMAINT\n                                    The server is in maintenance because of\n                                    the configuration.\n                                  0x08 = SRV_ADMF_FDRAIN\n                                    The server was explicitly forced into\n                                    drain state.\n                                  0x10 = SRV_ADMF_IDRAIN\n                                    The server has inherited the drain status\n                                    from a tracked server.\n                                  0x20 = SRV_ADMF_RMAINT\n                                    The server is in maintenance because of an\n                                    IP address resolution failure.\n                                  0x40 = SRV_ADMF_HMAINT\n                                    The server FQDN was set from stats socket.\n\n   srv_uweight:                 User visible server's weight.\n   srv_iweight:                 Server's initial weight.\n   srv_time_since_last_change:  Time since last operational change.\n   srv_check_status:            Last health check status.\n   srv_check_result:            Last check result (FAILED/PASSED/...).\n                                  0 = CHK_RES_UNKNOWN\n                                    Initialized to this by default.\n                                  1 = CHK_RES_NEUTRAL\n                                    Valid check but no status information.\n                                  2 = CHK_RES_FAILED\n                                    Check failed.\n                                  3 = CHK_RES_PASSED\n                                    Check succeeded and server is fully up\n                                    again.\n                                  4 = CHK_RES_CONDPASS\n                                    Check reports the server doesn't want new\n                                    sessions.\n   srv_check_health:            Checks rise / fall current counter.\n   srv_check_state:             State of the check (ENABLED/PAUSED/...).\n                                The state is actually a mask of values :\n                                  0x01 = CHK_ST_INPROGRESS\n                                    A check is currently running.\n                                  0x02 = CHK_ST_CONFIGURED\n                                    This check is configured and may be\n                                    enabled.\n                                  0x04 = CHK_ST_ENABLED\n                                    This check is currently administratively\n                                    enabled.\n                                  0x08 = CHK_ST_PAUSED\n                                    Checks are paused because of maintenance\n                                    (health only).\n   srv_agent_state:             State of the agent check (ENABLED/PAUSED/...).\n                                This state uses the same mask values as\n                                \"srv_check_state\", adding this specific one :\n                                  0x10 = CHK_ST_AGENT\n                                    Check is an agent check (otherwise it's a\n                                    health check).\n   bk_f_forced_id:              Flag to know if the backend ID is forced by\n                                configuration.\n   srv_f_forced_id:             Flag to know if the server's ID is forced by\n                                configuration.\n   srv_fqdn:                    Server FQDN.\n   srv_port:                    Server port.\n   srvrecord:                   DNS SRV record associated to this SRV.\n   srv_use_ssl:                 use ssl for server connections.\n   srv_check_port:              Server health check port.\n   srv_check_addr:              Server health check address.\n   srv_agent_addr:              Server health agent address.\n   srv_agent_port:              Server health agent port.\n\n```\n\n**[show sess](#9.3-show%20sess)**[<options>*]```\nDump all known active streams (formerly called \"sessions\"). Avoid doing this\non slow connections as this can be huge. This command is restricted and can\nonly be issued on sockets configured for levels \"operator\" or \"admin\". Note\nthat on machines with quickly recycled connections, it is possible that this\noutput reports less entries than really exist because it will dump all\nexisting streams up to the last one that was created before the command was\nentered; those which die in the mean time will not appear.\nFor supported options, see below.\n\n```\n\n**[show sess](#9.3-show%20sess)**[<id>| all | help][<options>*]```\nDisplay a lot of internal information about the matching streams. The command\nknows two output formats: a short one, which is the default when not asking\nfor a specific stream identifier, and an extended one when listing designated\nstreams. The short format, used by default with \"show sess\", only dumps one\nstream per line with a few info, and the stream identifier at the beginning\nof the line in hexadecimal (it corresponds to the pointer to the stream).\n\nIn the extended form, used by \"show sess <id>\" or \"show sess all\", streams\nare dumped with a huge amount of debugging details over multiple lines\n(around 20 each), and still start with their identifier. The delimiter\nbetween streams here is the identifier at the beginning of the line; extra\nlines belonging to the same stream start with one or multiple spaces (the\nstream is dumped indented). Dumping many streams can produce a huge output,\ntake a lot of time and be CPU intensive, so it's always better to only dump\nthe minimum needed. Those information are useless to most users but may be\nused by HAProxy developers to troubleshoot a complex bug. The exact output\nformat is intentionally not documented so that it can freely evolve depending\non requirements, including in stable branches. This output is meant to be\ninterpreted while checking function strm_dump_to_buffer() in src/stream.c to\nfigure the exact meaning of certain fields.\n\nThe \"help\" argument will show the detailed usage of the command instead of\ndumping streams.\n\nIt is possible to set some options to customize the dump or apply some\nfilters. Here are the supported options:\n  - backend <b>  only display streams attached to this backend\n  - frontend <f> only display streams attached to this frontend\n  - older <age>  only display streams older than <age> seconds\n  - server <b/s> only show streams attached to this backend+server\n  - show-uri     dump the transaction URI, as captured during the request\n                 analysis. It is only displayed if it was captured.\n  - susp         only show streams considered as suspicious by the developers\n                 based on criteria that may in time or vary along versions.\n\n```\n\n**[show stat](#9.3-show%20stat)**[domain<resolvers|proxy>][{<iid>|<proxy>}<type><sid>]\\[typed|json][desc][up|no-maint]```\nDump statistics. The domain is used to select which statistics to print;\nresolvers and proxy are available for now. By default, the CSV format is used;\nyou can activate the extended typed output format described in the section\nabove if \"typed\" is passed after the other arguments; or in JSON if \"json\" is\npassed after the other arguments. By passing <id>, <type> and <sid>, it is\npossible to dump only selected items :\n  - <iid> is a proxy ID, -1 to dump everything. Alternatively, a proxy name\n    <proxy> may be specified. In this case, this proxy's ID will be used as\n    the ID selector.\n  - <type> selects the type of dumpable objects : 1 for frontends, 2 for\n     backends, 4 for servers, -1 for everything. These values can be ORed,\n     for example:\n        1 + 2     = 3   -> frontend + backend.\n        1 + 2 + 4 = 7   -> frontend + backend + server.\n  - <sid> is a server ID, -1 to dump everything from the selected proxy.\n\n```\n\nExample :```\n\n    $ echo \"show info;show stat\" | socat stdio unix-connect:/tmp/sock1\n>>> Name: HAProxy\n    Version: 1.4-dev2-49\n    Release_date: 2009/09/23\n    Nbproc: 1\n    Process_num: 1\n    (...)\n\n    # pxname,svname,qcur,qmax,scur,smax,slim,stot,bin,bout,dreq,  (...)\n    stats,FRONTEND,,,0,0,1000,0,0,0,0,0,0,,,,,OPEN,,,,,,,,,1,1,0, (...)\n    stats,BACKEND,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,UP,0,0,0,,0,250,(...)\n    (...)\n    www1,BACKEND,0,0,0,0,1000,0,0,0,0,0,,0,0,0,0,UP,1,1,0,,0,250, (...)\n\n    $\n\n```\n\n```\nIn this example, two commands have been issued at once. That way it's easy to\nfind which process the stats apply to in multi-process mode. This is not\nneeded in the typed output format as the process number is reported on each\nline.  Notice the empty line after the information output which marks the end\nof the first block.  A similar empty line appears at the end of the second\nblock (stats) so that the reader knows the output has not been truncated.\n\nWhen \"typed\" is specified, the output format is more suitable to monitoring\ntools because it provides numeric positions and indicates the type of each\noutput field. Each value stands on its own line with process number, element\nnumber, nature, origin and scope. This same format is available via the HTTP\nstats by passing \";typed\" after the URI. It is very important to note that in\ntyped output format, the dump for a single object is contiguous so that there\nis no need for a consumer to store everything at once.\n\nThe \"up\" modifier will result in listing only servers which reportedly up or\nnot checked. Those down, unresolved, or in maintenance will not be listed.\nThis is analogous to the \";up\" option on the HTTP stats. Similarly, the\n\"no-maint\" modifier will act like the \";no-maint\" HTTP modifier and will\nresult in disabled servers not to be listed. The difference is that those\nwhich are enabled but down will not be evicted.\n\nWhen using the typed output format, each line is made of 4 columns delimited\nby colons (':'). The first column is a dot-delimited series of 5 elements. The\nfirst element is a letter indicating the type of the object being described.\nAt the moment the following object types are known : 'F' for a frontend, 'B'\nfor a backend, 'L' for a listener, and 'S' for a server. The second element\nThe second element is a positive integer representing the unique identifier of\nthe proxy the object belongs to. It is equivalent to the \"iid\" column of the\nCSV output and matches the value in front of the optional \"id\" directive found\nin the frontend or backend section. The third element is a positive integer\ncontaining the unique object identifier inside the proxy, and corresponds to\nthe \"sid\" column of the CSV output. ID 0 is reported when dumping a frontend\nor a backend. For a listener or a server, this corresponds to their respective\nID inside the proxy. The fourth element is the numeric position of the field\nin the list (starting at zero). This position shall not change over time, but\nholes are to be expected, depending on build options or if some fields are\ndeleted in the future. The fifth element is the field name as it appears in\nthe CSV output. The sixth element is a positive integer and is the relative\nprocess number starting at 1.\n\nThe rest of the line starting after the first colon follows the \"typed output\nformat\" described in the section above. In short, the second column (after the\nfirst ':') indicates the origin, nature and scope of the variable. The third\ncolumn indicates the field type, among \"s32\", \"s64\", \"u32\", \"u64\", \"flt' and\n\"str\". Then the fourth column is the value itself, which the consumer knows\nhow to parse thanks to column 3 and how to process thanks to column 2.\n\nWhen \"desc\" is appended to the command, one extra colon followed by a quoted\nstring is appended with a description for the metric. At the time of writing,\nthis is only supported for the \"typed\" output format.\n\nThus the overall line format in typed mode is :\n\n    <obj>.<px_id>.<id>.<fpos>.<fname>.<process_num>:<tags>:<type>:<value>\n\nHere's an example of typed output format :\n\n      $ echo \"show stat typed\" | socat stdio unix-connect:/tmp/sock1\n      F.2.0.0.pxname.1:MGP:str:private-frontend\n      F.2.0.1.svname.1:MGP:str:FRONTEND\n      F.2.0.8.bin.1:MGP:u64:0\n      F.2.0.9.bout.1:MGP:u64:0\n      F.2.0.40.hrsp_2xx.1:MGP:u64:0\n      L.2.1.0.pxname.1:MGP:str:private-frontend\n      L.2.1.1.svname.1:MGP:str:sock-1\n      L.2.1.17.status.1:MGP:str:OPEN\n      L.2.1.73.addr.1:MGP:str:0.0.0.0:8001\n      S.3.13.60.rtime.1:MCP:u32:0\n      S.3.13.61.ttime.1:MCP:u32:0\n      S.3.13.62.agent_status.1:MGP:str:L4TOUT\n      S.3.13.64.agent_duration.1:MGP:u64:2001\n      S.3.13.65.check_desc.1:MCP:str:Layer4 timeout\n      S.3.13.66.agent_desc.1:MCP:str:Layer4 timeout\n      S.3.13.67.check_rise.1:MCP:u32:2\n      S.3.13.68.check_fall.1:MCP:u32:3\n      S.3.13.69.check_health.1:SGP:u32:0\n      S.3.13.70.agent_rise.1:MaP:u32:1\n      S.3.13.71.agent_fall.1:SGP:u32:1\n      S.3.13.72.agent_health.1:SGP:u32:1\n      S.3.13.73.addr.1:MCP:str:1.255.255.255:8888\n      S.3.13.75.mode.1:MAP:str:http\n      B.3.0.0.pxname.1:MGP:str:private-backend\n      B.3.0.1.svname.1:MGP:str:BACKEND\n      B.3.0.2.qcur.1:MGP:u32:0\n      B.3.0.3.qmax.1:MGP:u32:0\n      B.3.0.4.scur.1:MGP:u32:0\n      B.3.0.5.smax.1:MGP:u32:0\n      B.3.0.6.slim.1:MGP:u32:1000\n      B.3.0.55.lastsess.1:MMP:s32:-1\n      (...)\n\nIn the typed format, the presence of the process ID at the end of the\nfirst column makes it very easy to visually aggregate outputs from\nmultiple processes, as show in the example below where each line appears\nfor each process :\n\n      $ ( echo show stat typed | socat /var/run/haproxy.sock1 - ; \\\n          echo show stat typed | socat /var/run/haproxy.sock2 - ) | \\\n        sort -t . -k 1,1 -k 2,2n -k 3,3n -k 4,4n -k 5,5 -k 6,6n\n      B.3.0.0.pxname.1:MGP:str:private-backend\n      B.3.0.0.pxname.2:MGP:str:private-backend\n      B.3.0.1.svname.1:MGP:str:BACKEND\n      B.3.0.1.svname.2:MGP:str:BACKEND\n      B.3.0.2.qcur.1:MGP:u32:0\n      B.3.0.2.qcur.2:MGP:u32:0\n      B.3.0.3.qmax.1:MGP:u32:0\n      B.3.0.3.qmax.2:MGP:u32:0\n      B.3.0.4.scur.1:MGP:u32:0\n      B.3.0.4.scur.2:MGP:u32:0\n      B.3.0.5.smax.1:MGP:u32:0\n      B.3.0.5.smax.2:MGP:u32:0\n      B.3.0.6.slim.1:MGP:u32:1000\n      B.3.0.6.slim.2:MGP:u32:1000\n      (...)\n\nThe format of JSON output is described in a schema which may be output\nusing \"show schema json\".\n\nThe JSON output contains no extra whitespace in order to reduce the\nvolume of output. For human consumption passing the output through a\npretty printer may be helpful. Example :\n\n$ echo \"show stat json\" | socat /var/run/haproxy.sock stdio | \\\n  python -m json.tool\n\nThe JSON output contains no extra whitespace in order to reduce the\nvolume of output. For human consumption passing the output through a\npretty printer may be helpful. Example :\n\n$ echo \"show stat json\" | socat /var/run/haproxy.sock stdio | \\\n  python -m json.tool\n\n```\n\n**[show ssl ca-file](#9.3-show%20ssl%20ca-file)**[[*][\\]<cafile>[:<index>]]```\nDisplay the list of CA files loaded into the process and their respective\ncertificate counts. The certificates are not used by any frontend or backend\nuntil their status is \"Used\".\nA \"@system-ca\" entry can appear in the list, it is loaded by the httpclient\nby default. It contains the list of trusted CA of your system returned by\nOpenSSL.\nIf a filename is prefixed by an asterisk, it is a transaction which\nis not committed yet. If a <cafile> is specified without <index>, it will show\nthe status of the CA file (\"Used\"/\"Unused\") followed by details about all the\ncertificates contained in the CA file. The details displayed for every\ncertificate are the same as the ones displayed by a \"show ssl cert\" command.\nIf a <cafile> is specified followed by an <index>, it will only display the\ndetails of the certificate having the specified index. Indexes start from 1.\nIf the index is invalid (too big for instance), nothing will be displayed.\nThis command can be useful to check if a CA file was properly updated.\nYou can also display the details of an ongoing transaction by prefixing the\nfilename by a '*'. If the first character of the filename is a '*', it can be\nescaped with '\\*'.\n\n```\n\nExample :```\n\n$ echo \"show ssl ca-file\" | socat /var/run/haproxy.master -\n# transaction\n*cafile.crt - 2 certificate(s)\n# filename\ncafile.crt - 1 certificate(s)\n\n$ echo \"show ssl ca-file cafile.crt\" | socat /var/run/haproxy.master -\nFilename: /home/tricot/work/haproxy/reg-tests/ssl/set_cafile_ca2.crt\nStatus: Used\n\nCertificate #1:\nSerial: 11A4D2200DC84376E7D233CAFF39DF44BF8D1211\nnotBefore: Apr  1 07:40:53 2021 GMT\nnotAfter: Aug 17 07:40:53 2048 GMT\nSubject Alternative Name:\nAlgorithm: RSA4096\nSHA1 FingerPrint: A111EF0FEFCDE11D47FE3F33ADCA8435EBEA4864\nSubject: /C=FR/ST=Some-State/O=HAProxy Technologies/CN=HAProxy Technologies CA\nIssuer: /C=FR/ST=Some-State/O=HAProxy Technologies/CN=HAProxy Technologies CA\n\n$ echo \"show ssl ca-file *cafile.crt:2\" | socat /var/run/haproxy.master -\nFilename: */home/tricot/work/haproxy/reg-tests/ssl/set_cafile_ca2.crt\nStatus: Unused\n\nCertificate #2:\nSerial: 587A1CE5ED855040A0C82BF255FF300ADB7C8136\n[...]\n\n```\n\n**[show ssl cert](#9.3-show%20ssl%20cert)**[[*][\\]<filename>]```\nDisplay the list of certificates loaded into the process. They are not used\nby any frontend or backend until their status is \"Used\".\nIf a filename is prefixed by an asterisk, it is a transaction which is not\ncommitted yet. If a filename is specified, it will show details about the\ncertificate. This command can be useful to check if a certificate was well\nupdated. You can also display details on a transaction by prefixing the\nfilename by a '*'. If the first character of the filename is a '*', it can be\nescaped with '\\*'.\nThis command can also be used to display the details of a certificate's OCSP\nresponse by suffixing the filename with a \".ocsp\" extension. It works for\ncommitted certificates as well as for ongoing transactions. On a committed\ncertificate, this command is equivalent to calling \"show ssl ocsp-response\"\nwith the certificate's corresponding OCSP response ID.\n\n```\n\nExample :```\n\n$ echo \"@1 show ssl cert\" | socat /var/run/haproxy.master -\n# transaction\n*test.local.pem\n# filename\ntest.local.pem\n\n$ echo \"@1 show ssl cert test.local.pem\" | socat /var/run/haproxy.master -\nFilename: test.local.pem\nStatus: Used\nSerial: 03ECC19BA54B25E85ABA46EE561B9A10D26F\nnotBefore: Sep 13 21:20:24 2019 GMT\nnotAfter: Dec 12 21:20:24 2019 GMT\nIssuer: /C=US/O=Let's Encrypt/CN=Let's Encrypt Authority X3\nSubject: /CN=test.local\nSubject Alternative Name: DNS:test.local, DNS:imap.test.local\nAlgorithm: RSA2048\nSHA1 FingerPrint: 417A11CAE25F607B24F638B4A8AEE51D1E211477\n\n$ echo \"@1 show ssl cert *test.local.pem\" | socat /var/run/haproxy.master -\nFilename: *test.local.pem\nStatus: Unused\n[...]\n\n$ echo \"@1 show ssl cert \\*.local.pem\" | socat /var/run/haproxy.master -\nFilename: *.local.pem\nStatus: Used\n[...]\n\n```\n\n**[show ssl crl-file](#9.3-show%20ssl%20crl-file)**[[*][\\]<crlfile>[:<index>]]```\nDisplay the list of CRL files loaded into the process. They are not used\nby any frontend or backend until their status is \"Used\".\nIf a filename is prefixed by an asterisk, it is a transaction which is not\ncommitted yet. If a <crlfile> is specified without <index>, it will show the\nstatus of the CRL file (\"Used\"/\"Unused\") followed by details about all the\nRevocation Lists contained in the CRL file. The details displayed for every\nlist are based on the output of \"openssl crl -text -noout -in <file>\".\nIf a <crlfile> is specified followed by an <index>, it will only display the\ndetails of the list having the specified index. Indexes start from 1.\nIf the index is invalid (too big for instance), nothing will be displayed.\nThis command can be useful to check if a CRL file was properly updated.\nYou can also display the details of an ongoing transaction by prefixing the\nfilename by a '*'. If the first character of the filename is a '*', it can be\nescaped with '\\*'.\n\n```\n\nExample :```\n\n$ echo \"show ssl crl-file\" | socat /var/run/haproxy.master -\n# transaction\n*crlfile.pem\n# filename\ncrlfile.pem\n\n$ echo \"show ssl crl-file crlfile.pem\" | socat /var/run/haproxy.master -\nFilename: /home/tricot/work/haproxy/reg-tests/ssl/crlfile.pem\nStatus: Used\n\nCertificate Revocation List #1:\nVersion 1\nSignature Algorithm: sha256WithRSAEncryption\nIssuer: /C=FR/O=HAProxy Technologies/CN=Intermediate CA2\nLast Update: Apr 23 14:45:39 2021 GMT\nNext Update: Sep  8 14:45:39 2048 GMT\nRevoked Certificates:\n    Serial Number: 1008\n        Revocation Date: Apr 23 14:45:36 2021 GMT\n\nCertificate Revocation List #2:\nVersion 1\nSignature Algorithm: sha256WithRSAEncryption\nIssuer: /C=FR/O=HAProxy Technologies/CN=Root CA\nLast Update: Apr 23 14:30:44 2021 GMT\nNext Update: Sep  8 14:30:44 2048 GMT\nNo Revoked Certificates.\n\n```\n\n**[show ssl crt-list](#9.3-show%20ssl%20crt-list)**[-n][<filename>]```\nDisplay the list of crt-list and directories used in the HAProxy\nconfiguration. If a filename is specified, dump the content of a crt-list or\na directory. Once dumped the output can be used as a crt-list file.\nThe '-n' option can be used to display the line number, which is useful when\ncombined with the 'del ssl crt-list' option when a entry is duplicated. The\noutput with the '-n' option is not compatible with the crt-list format and\nnot loadable by haproxy.\n\n```\n\nExample:```\n\necho \"show ssl crt-list -n localhost.crt-list\" | socat /tmp/sock1 -\n# localhost.crt-list\ncommon.pem:1 !not.test1.com *.test1.com !localhost\ncommon.pem:2\necdsa.pem:3 [verify none allow-0rtt ssl-min-ver TLSv1.0 ssl-max-ver TLSv1.3] localhost !www.test1.com\necdsa.pem:4 [verify none allow-0rtt ssl-min-ver TLSv1.0 ssl-max-ver TLSv1.3]\n\n```\n\n**[show ssl ocsp-response](#9.3-show%20ssl%20ocsp-response)**[[text|base64]<id|path>]```\nDisplay the IDs of the OCSP tree entries corresponding to all the OCSP\nresponses used in HAProxy, as well as the corresponding frontend\ncertificate's path, the issuer's name and key hash and the serial number of\nthe certificate for which the OCSP response was built.\nIf a valid <id> or the <path> of a valid frontend certificate is provided,\ndisplay the contents of the corresponding OCSP response. When an <id> is\nprovided, it it possible to define the format in which the data is dumped.\nThe 'text' option is the default one and it allows to display detailed\ninformation about the OCSP response the same way as in an \"openssl ocsp\n-respin <ocsp-response> -text\" call. The 'base64' format allows to dump the\ncontents of an OCSP response in base64.\n\n```\n\nExample :```\n\n$ echo \"show ssl ocsp-response\" | socat /var/run/haproxy.master -\n# Certificate IDs\n  Certificate ID key : 303b300906052b0e03021a050004148a83e0060faff709ca7e9b95522a2e81635fda0a0414f652b0e435d5ea923851508f0adbe92d85de007a0202100a\n  Certificate path : /path_to_cert/foo.pem\n    Certificate ID:\n      Issuer Name Hash: 8A83E0060FAFF709CA7E9B95522A2E81635FDA0A\n      Issuer Key Hash: F652B0E435D5EA923851508F0ADBE92D85DE007A\n      Serial Number: 100A\n\n$ echo \"show ssl ocsp-response 303b300906052b0e03021a050004148a83e0060faff709ca7e9b95522a2e81635fda0a0414f652b0e435d5ea923851508f0adbe92d85de007a0202100a\" | socat /var/run/haproxy.master -\nOCSP Response Data:\n  OCSP Response Status: successful (0x0)\n  Response Type: Basic OCSP Response\n  Version: 1 (0x0)\n  Responder Id: C = FR, O = HAProxy Technologies, CN = ocsp.haproxy.com\n  Produced At: May 27 15:43:38 2021 GMT\n  Responses:\n  Certificate ID:\n    Hash Algorithm: sha1\n    Issuer Name Hash: 8A83E0060FAFF709CA7E9B95522A2E81635FDA0A\n    Issuer Key Hash: F652B0E435D5EA923851508F0ADBE92D85DE007A\n    Serial Number: 100A\n  Cert Status: good\n  This Update: May 27 15:43:38 2021 GMT\n  Next Update: Oct 12 15:43:38 2048 GMT\n  [...]\n\n$ echo \"show ssl ocsp-response base64 /path_to_cert/foo.pem\" | socat /var/run/haproxy.sock -\n  MIIB8woBAKCCAewwggHoBgkrBgEFBQcwAQEEggHZMIIB1TCBvqE[...]\n\n```\n\n**[show ssl ocsp-updates](#9.3-show%20ssl%20ocsp-updates)**```\nDisplay information about the entries concerned by the OCSP update mechanism.\nThe command will output one line per OCSP response and will contain the\nexpected update time of the response as well as the time of the last\nsuccessful update and counters of successful and failed updates. It will also\ngive the status of the last update (successful or not) in numerical form as\nwell as text form. See below for a full list of possible errors. The lines\nwill be sorted by ascending 'Next Update' time. The lines will also contain a\npath to the first frontend certificate that uses the OCSP response.\nSee \"show ssl ocsp-response\" command and \"ocsp-update\" option for more\ninformation on the OCSP auto update.\n\nThe update error codes and error strings can be the following:\n\n+----+-------------------------------------+\n| ID | message                             |\n+----+-------------------------------------+\n|  0 | \"Unknown\"                           |\n|  1 | \"Update successful\"                 |\n|  2 | \"HTTP error\"                        |\n|  3 | \"Missing \\\"ocsp-response\\\" header\"  |\n|  4 | \"OCSP response check failure\"       |\n|  5 | \"Error during insertion\"            |\n+----+-------------------------------------+\n\n```\n\nExample :```\n\n$ echo \"show ssl ocsp-updates\" | socat /tmp/haproxy.sock -\n  OCSP Certid | Path | Next Update | Last Update | Successes | Failures | Last Update Status | Last Update Status (str)\n      303b300906052b0e03021a050004148a83e0060faff709ca7e9b95522a2e81635fda0a0414f652b0e435d5ea923851508f0adbe92d85de007a02021015 | /path_to_cert/cert.pem | 30/Jan/2023:00:08:09 +0000 | - | 0 | 1 | 2 | HTTP error\n      304b300906052b0e03021a0500041448dac9a0fb2bd32d4ff0de68d2f567b735f9b3c40414142eb317b75856cbae500940e61faf9d8b14c2c6021203e16a7aa01542f291237b454a627fdea9c1 | /path_to_cert/other_cert.pem | 30/Jan/2023:01:07:09 +0000 | 30/Jan/2023:00:07:09 +0000 | 1 | 0 | 1 | Update successful\n\n```\n\n**[show ssl providers](#9.3-show%20ssl%20providers)**```\nDisplay the names of the providers loaded by OpenSSL during init. Provider\nloading can indeed be configured via the OpenSSL configuration file and this\noption allows to check that the right providers were loaded. This command is\nonly available with OpenSSL v3.\n\n```\n\nExample :```\n\n$ echo \"show ssl providers\" | socat /var/run/haproxy.master -\nLoaded providers :\n    - fips\n    - base\n\n```\n\n**[show ssl sni](#9.3-show%20ssl%20sni)**[-f<frontend>][-A][-t<offset>]```\nDump every SNI configured for the designated frontend, or all frontends if no\nfrontend was specified. It allows to see what SNI are offered for a frontend,\nand to identify if a SNI is defined multiple times by multiple certificates for\nthe same frontend.\n\nThe -A option allows to filter the list and only displays the certificates\nthat are past the notAfter date, allowing to show only expired certificates.\n\nThe -t option takes an offset in seconds, or with a time unit (s, m, h, d),\nwhich is added to the current time, allowing to check which certificates\nexpired after the offset when combined with -A.\nFor example if you want to check which certificates would be expired in 30d,\njust do \"show ssl sni -A -t 30d\".\n\nColumns are separated by a single \\t, allowing to parse it simply.\n\nThe 'Frontend/Bind' column shows the frontend name followed by the bind line\nposition in the configuration (frontend/file:linenum).\n\nThe 'SNI' column shows the SNI, it can be either a CN, a SAN or a filter from a crt-list.\nThe default certificates of a bind line, (which are either declared\nexplicitly by 'default-crt' or is implicitly the first certificate of a bind\nline when no 'strict-sni' is used) shows the '*' character in the SNI column.\n\nThe 'Negative Filter' column is the list of negative filters associated to a\nwildcard, this will show all negatives filters that are on the same crt-list\nline. A dash character is displayed if there are none.\n\nThe 'Type' column shows the encryption algorithm type, it can be \"rsa\", \"ecdsa\" or \"dsa\".\n\nThe 'Filename' column can be either a filename from the configuration, or an\nalias declared in a crt-store.\n\nThe 'NotAfter' and 'NotBefore' columns are directly extracted from the X509\nleaf certificate.\n\n```\n\nExample:```\n\n$ echo \"@1 show ssl sni -A -t 30d\" | socat /var/run/haproxy-master.sock - | column -t -s $'\\t'\n# Frontend/Bind        SNI        Negative Filter  Type   Filename             NotAfter                  NotBefore\nli1/haproxy.cfg:10021  *.ex.lan   !m1.ex.lan       rsa    example.lan.pem      Jun 13 13:37:21 2024 GMT  May 14 13:37:21 2024 GMT\nli1/haproxy.cfg:10021  machine10  -                ecdsa  machine10.pem.ecdsa  Jun 13 13:37:21 2024 GMT  May 14 13:37:21 2024 GMT\nli1/haproxy.cfg:10021  machine10  -                rsa    machine10.pem.rsa    Jun 13 13:37:21 2024 GMT  May 14 13:37:21 2024 GMT\nli1/haproxy.cfg:10021  machine10  -                ecdsa  machine10.pem.ecdsa  Jun 13 13:37:21 2024 GMT  May 14 13:37:21 2024 GMT\nli1/haproxy.cfg:10021  localhost  -                rsa    localhost.pem.rsa    Jun 13 13:37:11 2024 GMT  May 14 13:37:11 2024 GMT\nli1/haproxy.cfg:10021  localhost  -                ecdsa  localhost.pem.ecdsa  Jun 13 13:37:10 2024 GMT  May 14 13:37:10 2024 GMT\nli1/haproxy.cfg:10021  *          -                rsa    localhost.pem.rsa    Jun 13 13:37:11 2024 GMT  May 14 13:37:11 2024 GMT\n\n```\n\n**[show startup-logs](#9.3-show%20startup-logs)**```\nDump all messages emitted during the startup of the current haproxy process,\neach startup-logs buffer is unique to its haproxy worker.\n\nThis keyword also exists on the master CLI, which shows the latest startup or\nreload tentative.\n\n```\n\n**[show table](#9.3-show%20table)**```\nDump general information on all known stick-tables. Their name is returned\n(the name of the proxy which holds them), their type (currently zero, always\nIP), their size in maximum possible number of entries, and the number of\nentries currently in use.\n\n```\n\nExample :```\n\n    $ echo \"show table\" | socat stdio /tmp/sock1\n>>> # table: front_pub, type: ip, size:204800, used:171454\n>>> # table: back_rdp, type: ip, size:204800, used:0\n\n```\n\n**[show table](#9.3-show%20table)**<name>[ data.<type><operator><value>[data.<type>...]]|[ key<key>]|[ ptr<ptr>]```\nDump contents of stick-table <name>. In this mode, a first line of generic\ninformation about the table is reported as with \"show table\", then all\nentries are dumped. Since this can be quite heavy, it is possible to specify\na filter in order to specify what entries to display.\n\nWhen the \"data.\" form is used the filter applies to the stored data (see\n\"stick-table\" in section 4.2).  A stored data type must be specified\nin <type>, and this data type must be stored in the table otherwise an\nerror is reported. The data is compared according to <operator> with the\n64-bit integer <value>.  Operators are the same as with the ACLs :\n\n  - eq : match entries whose data is equal to this value\n  - ne : match entries whose data is not equal to this value\n  - le : match entries whose data is less than or equal to this value\n  - ge : match entries whose data is greater than or equal to this value\n  - lt : match entries whose data is less than this value\n  - gt : match entries whose data is greater than this value\n\nIn this form, you can use multiple data filter entries, up to a maximum\ndefined during build time (4 by default).\n\nWhen the key form is used the entry <key> is shown.  The key must be of the\nsame type as the table, which currently is limited to IPv4, IPv6, integer,\nand string.\n\nWhen the ptr form is used the entry <ptr> is shown. <ptr> is written in\nthe form 0xffff and must correspond to the address returned by a previous\n\"show table\" command. Matching an entry using its pointer may be relevant if\nthe entry cannot be matched using the key due empty key or incompatible\ncharacters on the cli.\n\nIf data.<type> is an array type, \"[]\" may be used to access a specific\nindex in the array, like so: data.gpt[1]\n\n```\n\nExample :```\n\n    $ echo \"show table http_proxy\" | socat stdio /tmp/sock1\n>>> # table: http_proxy, type: ip, size:204800, used:2\n>>> 0x80e6a4c: key=127.0.0.1 use=0 exp=3594729 gpc0=0 conn_rate(30000)=1  \\\n      bytes_out_rate(60000)=187\n>>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n    $ echo \"show table http_proxy data.gpc0 gt 0\" | socat stdio /tmp/sock1\n>>> # table: http_proxy, type: ip, size:204800, used:2\n>>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n    $ echo \"show table http_proxy data.conn_rate gt 5\" | \\\n        socat stdio /tmp/sock1\n>>> # table: http_proxy, type: ip, size:204800, used:2\n>>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n    $ echo \"show table http_proxy key 127.0.0.2\" | \\\n        socat stdio /tmp/sock1\n>>> # table: http_proxy, type: ip, size:204800, used:2\n>>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n    $ echo \"show table http_proxy ptr 0x80e6a80\" | \\\n        socat stdio /tmp/sock1\n>>> # table: http_proxy, type: ip, size:204800, used:2\n>>> 0x80e6a80: key=127.0.0.2 use=0 exp=3594740 gpc0=1 conn_rate(30000)=10 \\\n      bytes_out_rate(60000)=191\n\n```\n\n```\nWhen the data criterion applies to a dynamic value dependent on time such as\na bytes rate, the value is dynamically computed during the evaluation of the\nentry in order to decide whether it has to be dumped or not. This means that\nsuch a filter could match for some time then not match anymore because as\ntime goes, the average event rate drops.\n\nIt is possible to use this to extract lists of IP addresses abusing the\nservice, in order to monitor them or even blacklist them in a firewall.\n\n```\n\nExample :```\n\n$ echo \"show table http_proxy data.gpc0 gt 0\" \\\n  | socat stdio /tmp/sock1 \\\n  | fgrep 'key=' | cut -d' ' -f2 | cut -d= -f2 > abusers-ip.txt\n  ( or | awk '/key/{ print a[split($2,a,\"=\")]; }' )\n\n```\n\n```\nWhen the stick-table is synchronized to a peers section supporting sharding,\nthe shard number will be displayed for each key (otherwise '0' is reported).\nThis allows to know which peers will receive this key.\n\n```\n\nExample:```\n\n$ echo \"show table http_proxy\" | socat stdio /tmp/sock1 | fgrep shard=\n  0x7f23b0c822a8: key=10.0.0.2 use=0 exp=296398 shard=9 gpc0=0\n  0x7f23a063f948: key=10.0.0.6 use=0 exp=296075 shard=12 gpc0=0\n  0x7f23b03920b8: key=10.0.0.8 use=0 exp=296766 shard=1 gpc0=0\n  0x7f23a43c09e8: key=10.0.0.12 use=0 exp=295368 shard=8 gpc0=0\n\n```\n\n**[show tasks](#9.3-show%20tasks)**```\nDumps the number of tasks currently in the run queue, with the number of\noccurrences for each function, and their average latency when it's known\n(for pure tasks with task profiling enabled). The dump is a snapshot of the\ninstant it's done, and there may be variations depending on what tasks are\nleft in the queue at the moment it happens, especially in mono-thread mode\nas there's less chance that I/Os can refill the queue (unless the queue is\nfull). This command takes exclusive access to the process and can cause\nminor but measurable latencies when issued on a highly loaded process, so\nit must not be abused by monitoring bots.\n\n```\n\n**[show threads](#9.3-show%20threads)**```\nDumps some internal states and structures for each thread, that may be useful\nto help developers understand a problem. The output tries to be readable by\nshowing one block per thread. When haproxy is built with USE_THREAD_DUMP=1,\nan advanced dump mechanism involving thread signals is used so that each\nthread can dump its own state in turn. Without this option, the thread\nprocessing the command shows all its details but the other ones are less\ndetailed. A star ('*') is displayed in front of the thread handling the\ncommand. A right angle bracket ('>') may also be displayed in front of\nthreads which didn't make any progress since last invocation of this command,\nindicating a bug in the code which must absolutely be reported. When this\nhappens between two threads it usually indicates a deadlock. If a thread is\nalone, it's a different bug like a corrupted list. In all cases the process\nneeds is not fully functional anymore and needs to be restarted.\n\nThe output format is purposely not documented so that it can easily evolve as\nnew needs are identified, without having to maintain any form of backwards\ncompatibility, and just like with \"show activity\", the values are meaningless\nwithout the code at hand.\n\n```\n\n**[show tls-keys](#9.3-show%20tls-keys)**[id|*]```\nDump all loaded TLS ticket keys references. The TLS ticket key reference ID\nand the file from which the keys have been loaded is shown. Both of those\ncan be used to update the TLS keys using \"set ssl tls-key\". If an ID is\nspecified as parameter, it will dump the tickets, using * it will dump every\nkeys from every references.\n\n```\n\n**[show schema json](#9.3-show%20schema%20json)**```\nDump the schema used for the output of \"show info json\" and \"show stat json\".\n\nThe contains no extra whitespace in order to reduce the volume of output.\nFor human consumption passing the output through a pretty printer may be\nhelpful. Example :\n\n$ echo \"show schema json\" | socat /var/run/haproxy.sock stdio | \\\n  python -m json.tool\n\nThe schema follows \"JSON Schema\" (json-schema.org) and accordingly\nverifiers may be used to verify the output of \"show info json\" and \"show\nstat json\" against the schema.\n\n```\n\n**[show trace](#9.3-show%20trace)**[<source>]```\nShow the current trace status. For each source a line is displayed with a\nsingle-character status indicating if the trace is stopped, waiting, or\nrunning. The output sink used by the trace is indicated (or \"none\" if none\nwas set), as well as the number of dropped events in this sink, followed by a\nbrief description of the source. If a source name is specified, a detailed\nlist of all events supported by the source, and their status for each action\n(report, start, pause, stop), indicated by a \"+\" if they are enabled, or a\n\"-\" otherwise. All these events are independent and an event might trigger\na start without being reported and conversely.\n\n```\n\n**[show version](#9.3-show%20version)**```\nShow the version of the current HAProxy process. This is available from\nmaster and workers CLI.\n\n```\n\nExample:```\n\n$ echo \"show version\" | socat /var/run/haproxy.sock stdio\n2.4.9\n\n$ echo \"show version\" | socat /var/run/haproxy-master.sock stdio\n2.5.0\n\n```\n\n**[shutdown frontend](#9.3-shutdown%20frontend)**<frontend>```\nCompletely delete the specified frontend. All the ports it was bound to will\nbe released. It will not be possible to enable the frontend anymore after\nthis operation. This is intended to be used in environments where stopping a\nproxy is not even imaginable but a misconfigured proxy must be fixed. That\nway it's possible to release the port and bind it into another process to\nrestore operations. The frontend will not appear at all on the stats page\nonce it is terminated.\n\nThe frontend may be specified either by its name or by its numeric ID,\nprefixed with a sharp ('#').\n\nThis command is restricted and can only be issued on sockets configured for\nlevel \"admin\".\n\n```\n\n**[shutdown session](#9.3-shutdown%20session)**<id>```\nImmediately terminate the stream matching the specified stream identifier.\nThis identifier is the first field at the beginning of the lines in the dumps\nof \"show sess\" (it corresponds to the stream pointer). This can be used to\nterminate a long-running stream without waiting for a timeout or when an\nendless transfer is ongoing. Such terminated streams are reported with a 'K'\nflag in the logs.\n\n```\n\n**[shutdown sessions server](#9.3-shutdown%20sessions%20server)**<backend>/<server>```\nImmediately terminate all the streams attached to the specified server. This\ncan be used to terminate long-running streams after a server is put into\nmaintenance mode, for instance. Such terminated streams are reported with a\n'K' flag in the logs.\n\n```\n\n**[trace](#9.3-trace)**```\nThe \"trace\" command alone lists the trace sources, their current status, and\ntheir brief descriptions. It is only meant as a menu to enter next levels,\nsee other \"trace\" commands below.\n\n```\n\n**[trace 0](#9.3-trace%200)**```\nImmediately stops all traces. This is made to be used as a quick solution\nto terminate a debugging session or as an emergency action to be used in case\ncomplex traces were enabled on multiple sources and impact the service.\n\n```\n\n**[trace](#9.3-trace)**<source>[<args...>]```\nConfigure traces for the source <source>. Without argument, this will list all\nsupported sub-commands to the given source. Multiple sub-commands can be\nchained. Following sub-commands are supported:\n\nevent [ [+|-|!]<name> ]\n  Without argument, this will list all the events supported by the designated\n  source. They are prefixed with a \"-\" if they are not enabled, or a \"+\" if\n  they are enabled. It is important to note that a single trace may be\n  labelled with multiple events, and as long as any of the enabled events\n  matches one of the events labelled on the trace, the event will be passed to\n  the trace subsystem. For example, receiving an HTTP/2 frame of type HEADERS\n  may trigger a frame event and a stream event since the frame creates a new\n  stream. If either the frame event or the stream event are enabled for this\n  source, the frame will be passed to the trace framework.\n\n  With an argument, it is possible to toggle the state of each event and\n  individually enable or disable them. Two special keywords are supported,\n  \"none\", which matches no event, and is used to disable all events at once,\n  and \"any\" which matches all events, and is used to enable all events at\n  once. Other events are specific to the event source. It is possible to\n  enable one event by specifying its name, optionally prefixed with '+' for\n  better readability. It is possible to disable one event by specifying its\n  name prefixed by a '-' or a '!'.\n\n  One way to completely disable a trace source is to pass \"event none\", and\n  this source will instantly be totally ignored.\n\nfollow <other_source>\n  This permits the source <source> to also emit traces when the other source\n  <other_source> is locked on a criteria and the same criteria matches for the\n  current source as well. For example, if a source is locked on a session,\n  following that source from another one will make that other one emit traces\n  for all events related to this session. This may be used to some extents to\n  track backend requests along with the associated frontend connections. The\n  \"session\" source makes this easier by providing a \"new\" and an \"end\" events\n  that are usable for lock-on processing. Note that the source <source> does\n  not need to have its traces enabled in this case, and its tracing state will\n  not be affected either. It is, however, possible that some events may be\n  missing if they do not contain information that allow to correlate them with\n  the tracked element. The meta-source \"all\" may also be used with this\n  command: in this case, all sources will follow <other_source>.\n\n```\n\nExample:```\n\ntrace h1 lock session start sess_new pause sess_end follow session\n\n```\n\n```\nlevel [<level>]\n  Without argument, this will list all trace levels for this source, and the\n  current one will be indicated by a star ('*') prepended in front of it. With\n  an argument, this will change the trace level to the specified level. Detail\n  levels are a form of filters that are applied before reporting the events.\n  These filters are used to selectively include or exclude events depending on\n  their level of importance. For example a developer might need to know\n  precisely where in the code an HTTP header was considered invalid while the\n  end user may not even care about this header's validity at all. There are\n  currently 5 distinct levels for a trace :\n\n      user       this will report information that are suitable for use by a\n                 regular haproxy user who wants to observe his traffic.\n                 Typically some HTTP requests and responses will be reported\n                 without much detail. Most sources will set this as the\n                 default level to ease operations.\n\n      proto      in addition to what is reported at the \"user\" level, it also\n                 displays protocol-level updates. This can for example be the\n                 frame types or HTTP headers after decoding.\n\n      state      in addition to what is reported at the \"proto\" level, it\n                 will also display state transitions (or failed transitions)\n                 which happen in parsers, so this will show attempts to\n                 perform an operation while the \"proto\" level only shows\n                 the final operation.\n\n      data       in addition to what is reported at the \"state\" level, it\n                 will also include data transfers between the various layers.\n\n      developer  it reports everything available, which can include advanced\n                 information such as \"breaking out of this loop\" that are\n                 only relevant to a developer trying to understand a bug that\n                 only happens once in a while in field. Function names are\n                 only reported at this level.\n\n  It is highly recommended to always use the \"user\" level only and switch to\n  other levels only if instructed to do so by a developer. Also it is a good\n  idea to first configure the events before switching to higher levels, as it\n  may save from dumping many lines if no filter is applied. The meta-source\n  \"all\" may also be used with this command: in this case, the level will be\n  applied to all existing sources at once.\n\nlock [criterion]\n  Without argument, this will list all the criteria supported by this source\n  for lock-on processing, and display the current choice by a star ('*') in\n  front of it. Lock-on means that the source will focus on the first matching\n  event and only stick to the criterion which triggered this event, and ignore\n  all other ones until the trace stops. This allows for example to take a\n  trace on a single connection or on a single stream. The following criteria\n  are supported by some traces, though not necessarily all, since some of them\n  might not be available to the source :\n\n      backend      lock on the backend that started the trace\n      connection   lock on the connection that started the trace\n      frontend     lock on the frontend that started the trace\n      listener     lock on the listener that started the trace\n      nothing      do not lock on anything\n      server       lock on the server that started the trace\n      session      lock on the session that started the trace\n      thread       lock on the thread that started the trace\n\n  In addition to this, each source may provide up to 4 specific criteria such\n  as internal states or connection IDs. For example in HTTP/2 it is possible\n  to lock on the H2 stream and ignore other streams once a strace starts.\n\n  When a criterion is passed in argument, this one is used instead of the\n  other ones and any existing tracking is immediately terminated so that it\n  can restart with the new criterion. The special keyword \"nothing\" is\n  supported by all sources to permanently disable tracking.\n\n{ pause | start | stop } [ [+|-|!]event]\n  Without argument, this will list the events enabled to automatically pause,\n  start, or stop a trace for this source. These events are specific to each\n  trace source. With an argument, this will either enable the event for the\n  specified action (if optionally prefixed by a '+') or disable it (if\n  prefixed by a '-' or '!'). The special keyword \"now\" is not an event and\n  requests to take the action immediately. The keywords \"none\" and \"any\" are\n  supported just like in \"trace event\".\n\n  The 3 supported actions are respectively \"pause\", \"start\" and \"stop\". The\n  \"pause\" action enumerates events which will cause a running trace to stop\n  and wait for a new start event to restart it. The \"start\" action enumerates\n  the events which switch the trace into the waiting mode until one of the\n  start events appears. And the \"stop\" action enumerates the events which\n  definitely stop the trace until it is manually enabled again. In practice it\n  makes sense to manually start a trace using \"start now\" without caring about\n  events, and to stop it using \"stop now\". In order to capture more subtle\n  event sequences, setting \"start\" to a normal event (like receiving an HTTP\n  request) and \"stop\" to a very rare event like emitting a certain error, will\n  ensure that the last captured events will match the desired criteria. And\n  the pause event is useful to detect the end of a sequence, disable the\n  lock-on and wait for another opportunity to take a capture. In this case it\n  can make sense to enable lock-on to spot only one specific criterion (e.g. a\n  stream), and have \"start\" set to anything that starts this criterion\n  (e.g. all events which create a stream), \"stop\" set to the expected anomaly,\n  and \"pause\" to anything that ends that criterion (e.g. any end of stream\n  event). In this case the trace log will contain complete sequences of\n  perfectly clean series affecting a single object, until the last sequence\n  containing everything from the beginning to the anomaly.\n\nsink [<sink>]\n   Without argument, this will list all event sinks available for this source,\n   and the currently configured one will have a star ('*') prepended in front\n   of it. Sink \"none\" is always available and means that all events are simply\n   dropped, though their processing is not ignored (e.g. lock-on does occur).\n   Other sinks are available depending on configuration and build options, but\n   typically \"stdout\" and \"stderr\" will be usable in debug mode, and in-memory\n   ring buffers should be available as well. When a name is specified, the\n   sink instantly changes for the specified source. Events are not changed\n   during a sink change. In the worst case some may be lost if an invalid sink\n   is used (or \"none\"), but operations do continue to a different\n   destination. The meta-source \"all\" may also be used with this command: in\n   this case, the sink will be applied to all existing sources at once.\n\nverbosity [<level>]\n  Without argument, this will list all verbosity levels for this source, and\n  the current one will be indicated by a star ('*') prepended in front of\n  it. With an argument, this will change the verbosity level to the specified\n  one.\n\n  Verbosity levels indicate how far the trace decoder should go to provide\n  detailed information. It depends on the trace source, since some sources\n  will not even provide a specific decoder. Level \"quiet\" is always available\n  and disables any decoding. It can be useful when trying to figure what's\n  happening before trying to understand the details, since it will have a very\n  low impact on performance and trace size. When no verbosity levels are\n  declared by a source, level \"default\" is available and will cause a decoder\n  to be called when specified in the traces. It is an opportunistic decoding.\n  When the source declares some verbosity levels, these ones are listed with a\n  description of what they correspond to. In this case the trace decoder\n  provided by the source will be as accurate as possible based on the\n  information available at the trace point. The first level above \"quiet\" is\n  set by default.\n\n```\n\n**[update ssl ocsp-response](#9.3-update%20ssl%20ocsp-response)**<certfile>```\nCreate an OCSP request for the specified <certfile> and send it to the OCSP\nresponder whose URI should be specified in the \"Authority Information Access\"\nsection of the certificate. Only the first URI is taken into account. The\nOCSP response that we should receive in return is then checked and inserted\nin the local OCSP response tree. This command will only work for certificates\nthat already had a stored OCSP response, either because it was provided\nduring init or if it was previously set through the \"set ssl cert\" or \"set\nssl ocsp-response\" commands.\nIf the received OCSP response is valid and was properly inserted into the\nlocal tree, its contents will be displayed on the standard output. The format\nis the same as the one described in \"show ssl ocsp-response\".\n\n```\n\n**[wait](#9.3-wait)**{ -h |<delay>}[<condition>[<args>...]]```\nIn its simplest form without any condition, this simply waits for the\nrequested delay before continuing. This can be used to collect metrics around\na specific interval.\n\nWith a condition and optional arguments, the command will wait for the\nspecified condition to be satisfied, to unrecoverably fail, or to remain\nunsatisfied for the whole <delay> duration. The supported conditions are:\n\n- srv-removable <proxy>/<server> : this will wait for the specified server to\n  be removable, i.e. be in maintenance and no longer have any connection on\n  it.  Some conditions will never be accepted (e.g. not in maintenance) and\n  will cause the report of a specific error message indicating what condition\n  is not met. The server might even have been removed in parallel and no\n  longer exit. If everything is OK before the delay, a success is returned\n  and the operation is terminated.\n\nThe default unit for the delay is milliseconds, though other units are\naccepted if suffixed with the usual timer units (us, ms, s, m, h, d). When\nused with the 'socat' utility, do not forget to extend socat's close timeout\nto cover the wait time. Passing \"-h\" as the first or second argument provides\nthe command's usage.\n\n```\n\nExample:```\n\n$ socat -t20 /path/to/socket - <<< \"show activity; wait 10s; show activity\"\n\n$ socat -t5 /path/to/socket - <<< \"\n    disable server px/srv1\n    shutdown sessions server px/srv1\n    wait 2s srv-removable px/srv1\n    del server px/srv1\"\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "9.4. Tricks for easier configuration management", "content": "## [9.4.](#9.4)Master CLI\n\n```\nThe master CLI is a socket bound to the master process in master-worker mode.\nThis CLI gives access to the unix socket commands in every running or leaving\nprocesses and allows a basic supervision of those processes.\n\nThe master CLI is configurable only from the haproxy program arguments with\nthe -S option. This option also takes bind options separated by commas.\n\n```\n\nExample:```\n\n# haproxy -W -S 127.0.0.1:1234 -f test1.cfg\n# haproxy -Ws -S /tmp/master-socket,uid,1000,gid,1000,mode,600 -f test1.cfg\n# haproxy -W -S /tmp/master-socket,level,user -f test1.cfg\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "9.4.1. Tricks for easier configuration management", "content": "### [9.4.1.](#9.4.1)Master CLI commands\n\n```\n@<[!]pid>\n  The master CLI uses a special prefix notation to access the multiple\n  processes. This notation is easily identifiable as it begins by a @.\n\n  A @ prefix can be followed by a relative process number or by an exclamation\n  point and a PID. (e.g. @1 or @!1271). A @ alone could be use to specify the\n  master. Leaving processes are only accessible with the PID as relative process\n  number are only usable with the current processes.\n\n  This prefix may be used as a wrapper before a command, indicating that this\n  command and only this one will be sent to the designated process. In this\n  case the full command ends at the end of line or semi-colon like any regular\n  command.\n\n  Bugs: the sockpair@ protocol used to implement communication between the\n  master and the worker is known to not be reliable on macOS because of an\n  issue in the macOS sendmsg(2) implementation. A command might end up without\n  response because of that.\n\n```\n\nExamples:```\n\n$ socat /var/run/haproxy-master.sock readline\nprompt\nmaster> @1 show info; @2 show info\n[...]\nProcess_num: 1\nPid: 1271\n[...]\nProcess_num: 2\nPid: 1272\n[...]\nmaster>\n\n$ echo '@!1271 show info; @!1272 show info' | socat /var/run/haproxy-master.sock -\n[...]\n\n```\n\n```\nThe prefix may also be use as a standalone command to switch the default execution\ncontext to the designated process, indicating that all subsequent commands will all\nbe executed in that process, until a new '@' command changes the execution context\nagain.\n\n```\n\nExamples:```\n\n$ socat /var/run/haproxy-master.sock readline\nprompt\nmaster> @1\n1271> show info\n[...]\n1271> show stat\n[...]\n1271> @\nmaster>\n\n$ echo '@1; show info; show stat; @2; show info; show stat' | socat /var/run/haproxy-master.sock -\n[...]\n\n```\n\n```\n  Note about limitations: a few rare commands alter a CLI session's state\n  (e.g. \"set anon\", \"set timeout\") and may not behave exactly similarly once\n  run from the master CLI due to commands being sent one at a time on their own\n  CLI session. Similarly, a few rare commands (\"show events\", \"wait\") actively\n  monitor the CLI for input or closure and are immediately interrupted when the\n  CLI is closed. These commands will not work as expected through the master\n  CLI because the command's input is closed after each command. For such rare\n  casesn the \"@@\" variant below might be more suited.\n\n@@<[!]pid> [command...]\n  This prefix or command is very similar to the \"@\" prefix documented above\n  except that it enters the worker process, delivers the whole command line\n  into it as-is and stays there until the command finishes. Semi-colons are\n  delivered as well, allowing to execute a full pipelined command in a worker\n  process. The connection with the work remains open until the list of commands\n  completes. Any data sent after the commands will be forwarded to the worker\n  process' CLI and may be consumed by the commands being executed and will be\n  lost for the master process' CLI, offering a truly bidirectional connection\n  with the worker process. As such, users of such commands must be very careful\n  to wait for the command's completion before sending new commands to the\n  master CLI.\n\n  Instead of executing a single command, it is also possible to open a fully\n  interactive session on the worker process by not specifying any command\n  (i.e. \"@@1\" on its own line). This session can be terminated either by\n  closing the connection or by quitting the worker process (using the \"quit\"\n  command). In this case, the prompt mode of the master socket (interactive,\n  prompt, timed) is propagated into the worker process.\n\n  Bugs: the sockpair@ protocol used to implement communication between the\n  master and the worker is known to not be reliable on macOS because of an\n  issue in the macOS sendmsg(2) implementation. A command might end up without\n  response because of that.\n\n```\n\nExamples:```\n\n# gracefully close connections and delete a server once idle (wait max 10s)\n$ socat -t 11 /var/run/haproxy-master.sock - <<< \\\n   \"@@1 disable server app2/srv36; \\\n   wait 10000 srv-removable app2/srv36; \\\n   del server app2/srv36\"\n\n# forcefully close connections and quickly delete a server\n$ socat /var/run/haproxy-master.sock - <<< \\\n   \"@@1 disable server app2/srv36; \\\n   shutdown sessions server app2/srv36; \\\n   wait 100 srv-removable app2/srv36; \\\n   del server app2/srv36\"\n\n# show messages arriving to this ring in real time (\"tail -f\" equivalent)\n$ (echo \"show events buf0 -w\"; read) | socat /var/run/haproxy-master.sock -\n\n```\n\n**[expert-mode](#9.4.1-expert-mode)**[on|off]```\nThis command activates the \"expert-modeThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" for every worker accessed from the\nmaster CLI. Combined with \"mcli-debug-mode\" it also activates the command on\nthe master. Display the flag \"e\" in the master CLI prompt.\n\nSee also \"expert-modeThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" in Section 9.3 and \"mcli-debug-mode\" in 9.4.1.\n\n```\n\n**[experimental-mode](#9.4.1-experimental-mode)**[on|off]```\nThis command activates the \"experimental-modeThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" for every worker accessed from\nthe master CLI. Combined with \"mcli-debug-mode\" it also activates the command on\nthe master. Display the flag \"x\" in the master CLI prompt.\n\nSee also \"experimental-modeThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" in Section 9.3 and \"mcli-debug-mode\" in 9.4.1.\n\n```\n\n**[hard-reload](#9.4.1-hard-reload)**```\nThis command does the same as the \"reload\" command over the master CLI with\nthe exception that it does a hard-stop (-st) instead of a stop-stop (-sf) of\nthe previous process. This means the previous process does not wait to\nachieve anything before exiting, so all connections will be closed.\n\nSee also the \"reload\" command.\n\n```\n\n**[mcli-debug-mode](#9.4.1-mcli-debug-mode)**[on|off]```\nThis keyword allows a special mode in the master CLI which enables every\nkeywords that were meant for a worker CLI on the master CLI, allowing to debug\nthe master process. Once activated, you list the new available keywords with\n\"help\". Combined with \"experimental-modeThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" or \"expert-modeThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" it enables even\nmore keywords. Display the flag \"d\" in the master CLI prompt.\n\n```\n\n**[prompt](#9.4.1-prompt)**```\nWhen the prompt is enabled (via the \"promptThis keyword is available in sections :Unix Socket commandsMaster CLI commands\" command), the context the CLI is\nworking on is displayed in the prompt. The master is identified by the \"master\"\nstring, and other processes are identified with their PID. In case the last\nreload failed, the master prompt will be changed to \"master[ReloadFailed]>\" so\nthat it becomes visible that the process is still running on the previous\nconfiguration and that the new configuration is not operational.\n\nThe prompt of the master CLI is able to display several flags which are the\nenable modes. \"d\" for mcli-debug-mode, \"e\" for expert-mode, \"x\" for\nexperimental-mode.\n\n```\n\nExample:```\n\n$ socat /var/run/haproxy-master.sock -\nprompt\nmaster> expert-mode on\nmaster(e)> experimental-mode on\nmaster(xe)> mcli-debug-mode on\nmaster(xed)> @1\n95191(xed)>\n\n```\n\n**[reload](#9.4.1-reload)**```\nYou can also reload the HAProxy master process with the \"reload\" command which\ndoes the same as a `kill -USR2` on the master process, provided that the user\nhas at least \"operator\" or \"admin\" privileges.\n\nThis command allows you to perform a synchronous reload, the command will\nreturn a reload status, once the reload was performed. Be careful with the\ntimeout if a tool is used to parse it, it is only returned once the\nconfiguration is parsed and the new worker is forked. The \"socat\" command uses\na timeout of 0.5s by default so it will quit before showing the message if\nthe reload is too long. \"ncat\" does not have a timeout by default.\nWhen compiled with USE_SHM_OPEN=1, the reload command is also able to dump\nthe startup-logs of the master.\n\n```\n\nExample:```\n\n$ echo \"reload\" | socat -t300 /var/run/haproxy-master.sock stdin\nSuccess=1\n--\n[NOTICE]   (482713) : haproxy version is 2.7-dev7-4827fb-69\n[NOTICE]   (482713) : path to executable is ./haproxy\n[WARNING]  (482713) : config : 'http-request' rules ignored for proxy 'frt1' as they require HTTP mode.\n[NOTICE]   (482713) : New worker (482720) forked\n[NOTICE]   (482713) : Loading success.\n\n$ echo \"reload\" | socat -t300 /var/run/haproxy-master.sock stdin\nSuccess=0\n--\n[NOTICE]   (482886) : haproxy version is 2.7-dev7-4827fb-69\n[NOTICE]   (482886) : path to executable is ./haproxy\n[ALERT]    (482886) : config : parsing [test3.cfg:1]: unknown keyword 'Aglobal' out of section.\n[ALERT]    (482886) : config : Fatal errors found in configuration.\n[WARNING]  (482886) : Loading failure!\n\n$\n\n```\n\n```\nThe reload command is the last executed on the master CLI, every other\ncommand after it are ignored. Once the reload command returns its status, it\nwill close the connection to the CLI.\n\nNote that a reload will close all connections to the master CLI.\nSee also the \"hard-reload\" command.\n\n```\n\n**[show proc](#9.4.1-show%20proc)**[debug]```\nThe master CLI introduces a 'show proc' command to surpervise the\nprocesse.\n\n```\n\nExample:```\n\n$ echo 'show proc' | socat /var/run/haproxy-master.sock -\n#<PID>          <type>          <reloads>       <uptime>        <version>\n1162            master          5 [failed: 0]   0d00h02m07s     2.5-dev13\n# workers\n1271            worker          1               0d00h00m00s     2.5-dev13\n# old workers\n1233            worker          3               0d00h00m43s     2.0-dev3-6019f6-289\n# programs\n1244            foo             0               0d00h00m00s     -\n1255            bar             0               0d00h00m00s     -\n\n```\n\n```\nIn this example, the master has been reloaded 5 times but one of the old\nworker is still running and survived 3 reloads. You could access the CLI of\nthis worker to understand what's going on.\n\nThe 'debug' parameter is useful to show debug details, it currently shows the\nFDs for IPC communication. Note that the debug output is not guaranteed to be\nstable between haproxy versions.\n\n```\n\n**[show startup-logs](#9.4.1-show%20startup-logs)**```\nHAProxy needs to be compiled with USE_SHM_OPEN=1 to be used correctly on the\nmaster CLI or all messages won't be visible.\n\nLike its counterpart on the stats socket, this command is able to show the\nstartup messages of HAProxy. However it does not dump the startup messages\nof the current worker, but the startup messages of the latest startup or\nreload, which means it is able to dump the parsing messages of a failed\nreload.\n\nThose messages are also dumped with the \"reload\" command.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "9.5. Tricks for easier configuration management", "content": "## [9.5.](#9.5)Stats-file\n\n```\nA so-called stats-file can be used to preload internal haproxy counters on\nprocess startup with non-null values. Its main purpose is to preserve\nstatistics for worker processes across reloads. Only an excerpt of all the\nexposed haproxy statistics is present in a stats-file as it only makes sense to\npreload metric-type values.\n\nFor the moment, only proxy counters are supported in stats-file. This allows to\npreload values for frontends, backends, servers and listeners. However only\nobjects instances with a non-empty GUID are stored in a stats-file. This\nguarantees that value will be preloaded for object with matching type and GUID,\neven if other parameters differ.\n\nThe CLI command \"dump stats-file\" purpose is to generate a stats-file. Format\nof the stats-file is internally defined and freely subject to future changes\nand extension. It is designed to be compatible at least across adjacent\nhaproxy stable branch releases, but may require optional extra configuration\nwhen loading a stats-file to a process running on an older version.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "10. Tricks for easier configuration management", "content": "# [10.](#10)Tricks for easier configuration management\n\n```\nIt is very common that two HAProxy nodes constituting a cluster share exactly\nthe same configuration modulo a few addresses. Instead of having to maintain a\nduplicate configuration for each node, which will inevitably diverge, it is\npossible to include environment variables in the configuration. Thus multiple\nconfiguration may share the exact same file with only a few different system\nwide environment variables. This started in version 1.5 where only addresses\nwere allowed to include environment variables, and 1.6 goes further by\nsupporting environment variables everywhere. The syntax is the same as in the\nUNIX shell, a variable starts with a dollar sign ('$'), followed by an opening\ncurly brace ('{'), then the variable name followed by the closing brace ('}').\nExcept for addresses, environment variables are only interpreted in arguments\nsurrounded with double quotes (this was necessary not to break existing setups\nusing regular expressions involving the dollar symbol).\n\nEnvironment variables also make it convenient to write configurations which are\nexpected to work on various sites where only the address changes. It can also\npermit to remove passwords from some configs. Example below where the file\n\"site1.env\" file is sourced by the init script upon startup :\n\n  $ cat site1.env\n  LISTEN=192.168.1.1\n  CACHE_PFX=192.168.11\n  SERVER_PFX=192.168.22\n  LOGGER=192.168.33.1\n  STATSLP=admin:pa$$w0rd\n  ABUSERS=/etc/haproxy/abuse.lst\n  TIMEOUT=10s\n\n  $ cat haproxy.cfg\n  global\n      log \"${LOGGER}:514\" local0\n\n  defaults\n      mode http\n      timeout client \"${TIMEOUT}\"\n      timeout server \"${TIMEOUT}\"\n      timeout connect 5s\n\n  frontend public\n      bind \"${LISTEN}:80\"\n      http-request reject if { src -f \"${ABUSERS}\" }\n      stats uri /stats\n      stats auth \"${STATSLP}\"\n      use_backend cache if { path_end .jpg .css .ico }\n      default_backend server\n\n  backend cache\n      server cache1 \"${CACHE_PFX}.1:18080\" check\n      server cache2 \"${CACHE_PFX}.2:18080\" check\n\n  backend server\n      server cache1 \"${SERVER_PFX}.1:8080\" check\n      server cache2 \"${SERVER_PFX}.2:8080\" check\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "11. Well-known traps to avoid", "content": "# [11.](#11)Well-known traps to avoid\n\n```\nOnce in a while, someone reports that after a system reboot, the haproxy\nservice wasn't started, and that once they start it by hand it works. Most\noften, these people are running a clustered IP address mechanism such as\nkeepalived, to assign the service IP address to the master node only, and while\nit used to work when they used to bind haproxy to address 0.0.0.0, it stopped\nworking after they bound it to the virtual IP address. What happens here is\nthat when the service starts, the virtual IP address is not yet owned by the\nlocal node, so when HAProxy wants to bind to it, the system rejects this\nbecause it is not a local IP address. The fix doesn't consist in delaying the\nhaproxy service startup (since it wouldn't stand a restart), but instead to\nproperly configure the system to allow binding to non-local addresses. This is\neasily done on Linux by setting the net.ipv4.ip_nonlocal_bind sysctl to 1. This\nis also needed in order to transparently intercept the IP traffic that passes\nthrough HAProxy for a specific target address.\n\nMulti-process configurations involving source port ranges may apparently seem\nto work but they will cause some random failures under high loads because more\nthan one process may try to use the same source port to connect to the same\nserver, which is not possible. The system will report an error and a retry will\nhappen, picking another port. A high value in the \"retries\" parameter may hide\nthe effect to a certain extent but this also comes with increased CPU usage and\nprocessing time. Logs will also report a certain number of retries. For this\nreason, port ranges should be avoided in multi-process configurations.\n\nSince HAProxy uses SO_REUSEPORT and supports having multiple independent\nprocesses bound to the same IP:port, during troubleshooting it can happen that\nan old process was not stopped before a new one was started. This provides\nabsurd test results which tend to indicate that any change to the configuration\nis ignored. The reason is that in fact even the new process is restarted with a\nnew configuration, the old one also gets some incoming connections and\nprocesses them, returning unexpected results. When in doubt, just stop the new\nprocess and try again. If it still works, it very likely means that an old\nprocess remains alive and has to be stopped. Linux's \"netstat -lntp\" is of good\nhelp here.\n\nWhen adding entries to an ACL from the command line (eg: when blacklisting a\nsource address), it is important to keep in mind that these entries are not\nsynchronized to the file and that if someone reloads the configuration, these\nupdates will be lost. While this is often the desired effect (for blacklisting)\nit may not necessarily match expectations when the change was made as a fix for\na problem. See the \"add acl\" action of the CLI interface.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "12. Debugging and performance issues", "content": "# [12.](#12)Debugging and performance issues\n\n```\nWhen HAProxy is started with the \"-d\" option, it will stay in the foreground\nand will print one line per event, such as an incoming connection, the end of a\nconnection, and for each request or response header line seen. This debug\noutput is emitted before the contents are processed, so they don't consider the\nlocal modifications. The main use is to show the request and response without\nhaving to run a network sniffer. The output is less readable when multiple\nconnections are handled in parallel, though the \"debug2ansi\" and \"debug2html\"\nscripts found in the examples/ directory definitely help here by coloring the\noutput.\n\nIf a HTTP/1.x request or response is rejected because HAProxy finds it is\nmalformed, the best thing to do is to connect to the CLI and issue \"show\nerrors\", which will report the last captured faulty HTTP/1.x request and\nresponse for each frontend and backend, with all the necessary information to\nindicate precisely the first character of the input stream that was\nrejected. This is sometimes needed to prove to customers or to developers that a\nbug is present in their code. In this case it is often possible to relax the\nchecks (but still keep the captures) using \"option\naccept-unsafe-violations-in-http-request\" or its equivalent for responses coming\nfrom the server \"option accept-unsafe-violations-in-http-response\". Please see\nthe configuration manual for more details.\n\n```\n\nExample :```\n\n> show errors\nTotal events captured on [13/Oct/2015:13:43:47.169] : 1\n\n[13/Oct/2015:13:43:40.918] frontend HAProxyLocalStats (#2): invalid request\n  backend <NONE> (#-1), server <NONE> (#-1), event #0\n  src 127.0.0.1:51981, session #0, session flags 0x00000080\n  HTTP msg state 26, msg flags 0x00000000, tx flags 0x00000000\n  HTTP chunk len 0 bytes, HTTP body len 0 bytes\n  buffer flags 0x00808002, out 0 bytes, total 31 bytes\n  pending 31 bytes, wrapping at 8040, error at position 13:\n\n  00000  GET /invalid request HTTP/1.1\\r\\n\n\n```\n\n```\nThe output of \"show info\" on the CLI provides a number of useful information\nregarding the maximum connection rate ever reached, maximum SSL key rate ever\nreached, and in general all information which can help to explain temporary\nissues regarding CPU or memory usage. Example :\n\n  > show info\n  Name: HAProxy\n  Version: 1.6-dev7-e32d18-17\n  Release_date: 2015/10/12\n  Nbproc: 1\n  Process_num: 1\n  Pid: 7949\n  Uptime: 0d 0h02m39s\n  Uptime_sec: 159\n  Memmax_MB: 0\n  Ulimit-n: 120032\n  Maxsock: 120032\n  Maxconn: 60000\n  Hard_maxconn: 60000\n  CurrConns: 0\n  CumConns: 3\n  CumReq: 3\n  MaxSslConns: 0\n  CurrSslConns: 0\n  CumSslConns: 0\n  Maxpipes: 0\n  PipesUsed: 0\n  PipesFree: 0\n  ConnRate: 0\n  ConnRateLimit: 0\n  MaxConnRate: 1\n  SessRate: 0\n  SessRateLimit: 0\n  MaxSessRate: 1\n  SslRate: 0\n  SslRateLimit: 0\n  MaxSslRate: 0\n  SslFrontendKeyRate: 0\n  SslFrontendMaxKeyRate: 0\n  SslFrontendSessionReuse_pct: 0\n  SslBackendKeyRate: 0\n  SslBackendMaxKeyRate: 0\n  SslCacheLookups: 0\n  SslCacheMisses: 0\n  CompressBpsIn: 0\n  CompressBpsOut: 0\n  CompressBpsRateLim: 0\n  ZlibMemUsage: 0\n  MaxZlibMemUsage: 0\n  Tasks: 5\n  Run_queue: 1\n  Idle_pct: 100\n  node: wtap\n  description:\n\nWhen an issue seems to randomly appear on a new version of HAProxy (eg: every\nsecond request is aborted, occasional crash, etc), it is worth trying to enable\nmemory poisoning so that each call to malloc() is immediately followed by the\nfilling of the memory area with a configurable byte. By default this byte is\n0x50 (ASCII for 'P'), but any other byte can be used, including zero (which\nwill have the same effect as a calloc() and which may make issues disappear).\nMemory poisoning is enabled on the command line using the \"-dM\" option. It\nslightly hurts performance and is not recommended for use in production. If\nan issue happens all the time with it or never happens when poisoning uses\nbyte zero, it clearly means you've found a bug and you definitely need to\nreport it. Otherwise if there's no clear change, the problem it is not related.\n\nWhen debugging some latency issues, it is important to use both strace and\ntcpdump on the local machine, and another tcpdump on the remote system. The\nreason for this is that there are delays everywhere in the processing chain and\nit is important to know which one is causing latency to know where to act. In\npractice, the local tcpdump will indicate when the input data come in. Strace\nwill indicate when haproxy receives these data (using recv/recvfrom). Warning,\nopenssl uses read()/write() syscalls instead of recv()/send(). Strace will also\nshow when haproxy sends the data, and tcpdump will show when the system sends\nthese data to the interface. Then the external tcpdump will show when the data\nsent are really received (since the local one only shows when the packets are\nqueued). The benefit of sniffing on the local system is that strace and tcpdump\nwill use the same reference clock. Strace should be used with \"-tts200\" to get\ncomplete timestamps and report large enough chunks of data to read them.\nTcpdump should be used with \"-nvvttSs0\" to report full packets, real sequence\nnumbers and complete timestamps.\n\nIn practice, received data are almost always immediately received by haproxy\n(unless the machine has a saturated CPU or these data are invalid and not\ndelivered). If these data are received but not sent, it generally is because\nthe output buffer is saturated (ie: recipient doesn't consume the data fast\nenough). This can be confirmed by seeing that the polling doesn't notify of\nthe ability to write on the output file descriptor for some time (it's often\neasier to spot in the strace output when the data finally leave and then roll\nback to see when the write event was notified). It generally matches an ACK\nreceived from the recipient, and detected by tcpdump. Once the data are sent,\nthey may spend some time in the system doing nothing. Here again, the TCP\ncongestion window may be limited and not allow these data to leave, waiting for\nan ACK to open the window. If the traffic is idle and the data take 40 ms or\n200 ms to leave, it's a different issue (which is not an issue), it's the fact\nthat the Nagle algorithm prevents empty packets from leaving immediately, in\nhope that they will be merged with subsequent data. HAProxy automatically\ndisables Nagle in pure TCP mode and in tunnels. However it definitely remains\nenabled when forwarding an HTTP body (and this contributes to the performance\nimprovement there by reducing the number of packets). Some HTTP non-compliant\napplications may be sensitive to the latency when delivering incomplete HTTP\nresponse messages. In this case you will have to enable \"option http-no-delay\"\nto disable Nagle in order to work around their design, keeping in mind that any\nother proxy in the chain may similarly be impacted. If tcpdump reports that data\nleave immediately but the other end doesn't see them quickly, it can mean there\nis a congested WAN link, a congested LAN with flow control enabled and\npreventing the data from leaving, or more commonly that HAProxy is in fact\nrunning in a virtual machine and that for whatever reason the hypervisor has\ndecided that the data didn't need to be sent immediately. In virtualized\nenvironments, latency issues are almost always caused by the virtualization\nlayer, so in order to save time, it's worth first comparing tcpdump in the VM\nand on the external components. Any difference has to be credited to the\nhypervisor and its accompanying drivers.\n\nWhen some TCP SACK segments are seen in tcpdump traces (using -vv), it always\nmeans that the side sending them has got the proof of a lost packet. While not\nseeing them doesn't mean there are no losses, seeing them definitely means the\nnetwork is lossy. Losses are normal on a network, but at a rate where SACKs are\nnot noticeable at the naked eye. If they appear a lot in the traces, it is\nworth investigating exactly what happens and where the packets are lost. HTTP\ndoesn't cope well with TCP losses, which introduce huge latencies.\n\nThe \"netstat -i\" command will report statistics per interface. An interface\nwhere the Rx-Ovr counter grows indicates that the system doesn't have enough\nresources to receive all incoming packets and that they're lost before being\nprocessed by the network driver. Rx-Drp indicates that some received packets\nwere lost in the network stack because the application doesn't process them\nfast enough. This can happen during some attacks as well. Tx-Drp means that\nthe output queues were full and packets had to be dropped. When using TCP it\nshould be very rare, but will possibly indicate a saturated outgoing link.\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "13. Security considerations", "content": "# [13.](#13)Security considerations\n\n```\nHAProxy is designed to run with very limited privileges. The standard way to\nuse it is to isolate it into a chroot jail and to drop its privileges to a\nnon-root user without any permissions inside this jail so that if any future\nvulnerability were to be discovered, its compromise would not affect the rest\nof the system.\n\nIn order to perform a chroot, it first needs to be started as a root user. It is\npointless to build hand-made chroots to start the process there, these ones are\npainful to build, are never properly maintained and always contain way more\nbugs than the main file-system. And in case of compromise, the intruder can use\nthe purposely built file-system. Unfortunately many administrators confuse\n\"start as root\" and \"run as root\", resulting in the uid change to be done prior\nto starting haproxy, and reducing the effective security restrictions.\n\nHAProxy will need to be started as root in order to :\n  - adjust the file descriptor limits\n  - bind to privileged port numbers\n  - bind to a specific network interface\n  - transparently listen to a foreign address\n  - isolate itself inside the chroot jail\n  - drop to another non-privileged UID\n\nHAProxy may require to be run as root in order to :\n  - bind to an interface for outgoing connections\n  - bind to privileged source ports for outgoing connections\n  - transparently bind to a foreign address for outgoing connections\n\nMost users will never need the \"run as root\" case. But the \"start as root\"\ncovers most usages.\n\nA safe configuration will have :\n\n  - a chroot statement pointing to an empty location without any access\n    permissions. This can be prepared this way on the UNIX command line :\n\n      # mkdir /var/empty && chmod 0 /var/empty || echo \"Failed\"\n\n    and referenced like this in the HAProxy configuration's global section :\n\n      chroot /var/empty\n\n  - both a uid/user and gid/group statements in the global section :\n\n      user haproxy\n      group haproxy\n\n  - a stats socket whose mode, uid and gid are set to match the user and/or\n    group allowed to access the CLI so that nobody may access it :\n\n      stats socket /var/run/haproxy.stat uid hatop gid hatop mode 600\n\n```\n\n", "url": "https://docs.haproxy.org/3.2/management.html"}
{"title": "13.1", "content": "## [13.1.](#13.1)Linux capabilities support\n\n```\nSince version v2.9 haproxy supports Linux capabilities. If the binary is\ncompiled with USE_LINUX_CAP=1, it is able to preserve capabilities given in\n'setcap' keyword during switching from root user to a non-root.\n\nSince version v3.1 haproxy also checks if capabilities given in 'setcap'\nkeyword were set in its binary file Permitted set by administrator\n(capget syscall). If this a case it performs transition of these capabilities\nin its process Effective set (capset syscall), while running as a non-root\nuser.\n\nThis was done to avoid all potential use cases when haproxy starts and runs as\nroot: transparent proxy mode, binding to privileged ports.\n\n'setcap' keyword supports following network capabilities:\n- cap_net_admin: transparent proxying, binding socket to a specific network\n  interface, using set-mark action;\n- cap_net_raw (subset of cap_net_admin): transparent proxying;\n- cap_net_bind_service: binding socket to a specific network interface;\n- cap_sys_admin: creating socket in a specific network namespace.\n\nHaproxy never does the transition of these capabilities from its Permitted set\nto the Effective, if they are not listed as 'setcap' argument. See more\ninformation about 'setcap' keyword and supported capabilities in the chapter\n3.1 Process management and security in the Configuration guide.\n\nAdministrator may add needed capabilities in the haproxy binary file Permitted\nset with the following command:\n\n```\n\nExample:```\n\n# setcap cap_net_admin,cap_net_bind_service=p /usr/local/sbin/haproxy\n\n```\n\n```\nAdded capabilities will be seen in process Permitted set after its start.\nIf the same capabilities are the arguments of 'setcap' keyword, they could be\nalso seen in the process Effective set. This could be check with the following\ncommand:\n\n```\n\nExample:```\n\n# grep Cap /proc/<haproxy PID>/status\nCapInh:        0000000000000000\nCapPrm:        0000000000001400\nCapEff:        0000000000001400\nCapBnd:        000001ffffffffff\nCapAmb:        0000000000000000\n\n```\n\n```\nSee more details about setcap and capabilities sets in Linux man pages\n(capabilities(7)).\n\nIn some use cases like transparent proxying or creating socket in a specific\nnetwork namespace, configuration file parser detects that cap_net_raw or\ncap_sys_admin or some other supported capabilities are needed. Then, during\nthe initialization stage, haproxy process checks, if these capabilities could\nbe put in its Effective set. If it's not possible due to capget or capset\nsyscall failure (restrictions set on syscalls by some security modules like\nSELinux, Seccomp, etc), process emits diagnostic warnings (start with -dD).\n\nDue to support of many different platforms with different system settings,\nit's impossible for the parser to deduce from the configuration file, if\nbinding to privileged ports will be done. So, in the case of insufficient\nprivileges (run as non-root) process will terminate only with an alert\nmessage like below. It's up to a user to recheck its configuration and haproxy\nbinary capabilities set.\n\n```\n\nExample:```\n\n$ haproxy -dD -f haproxy.cfg\n...\n[ALERT]    (96797) : Binding [haproxy.cfg:36] for frontend fe: cannot bind socket (Permission denied) for [0.0.0.0:80]\n[ALERT]    (96797) : [haproxy.main()] Some protocols failed to start their listeners! Exiting.\n\n```\n\nHAProxy 3.2.13-3  Management Guide,", "url": "https://docs.haproxy.org/3.2/management.html"}
